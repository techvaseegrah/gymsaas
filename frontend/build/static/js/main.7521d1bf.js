/*! For license information please see main.7521d1bf.js.LICENSE.txt */
(()=>{var e={385:()=>{},545:function(e,t,n){var r;!function(e,a){function i(e){var t=this,n="";t.next=function(){var e=t.x^t.x>>>2;return t.x=t.y,t.y=t.z,t.z=t.w,t.w=t.v,(t.d=t.d+362437|0)+(t.v=t.v^t.v<<4^e^e<<1)|0},t.x=0,t.y=0,t.z=0,t.w=0,t.v=0,e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),r==n.length&&(t.d=t.x<<10^t.x>>>4),t.next()}function o(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t.v=e.v,t.d=e.d,t}function s(e,t){var n=new i(e),r=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,r&&("object"==typeof r&&o(r,n),a.state=function(){return o(n,{})}),a}a&&a.exports?a.exports=s:n.amdD&&n.amdO?void 0===(r=function(){return s}.call(t,n,t,a))||(a.exports=r):this.xorwow=s}(0,e=n.nmd(e),n.amdD)},551:()=>{},764:function(e,t,n){var r;"undefined"!==typeof this||window,r=function(e){return function(){"use strict";var t={662:function(e,t){var n=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0}),t.CellHookData=t.HookData=void 0;var r=function(e,t,n){this.table=t,this.pageNumber=t.pageNumber,this.pageCount=this.pageNumber,this.settings=t.settings,this.cursor=n,this.doc=e.getDocument()};t.HookData=r;var a=function(e){function t(t,n,r,a,i,o){var s=e.call(this,t,n,o)||this;return s.cell=r,s.row=a,s.column=i,s.section=a.section,s}return n(t,e),t}(r);t.CellHookData=a},790:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(148),a=n(938),i=n(323),o=n(587),s=n(49),c=n(858);t.default=function(e){e.API.autoTable=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];1===t.length?e=t[0]:(console.error("Use of deprecated autoTable initiation"),(e=t[2]||{}).columns=t[0],e.body=t[1]);var r=(0,o.parseInput)(this,e),a=(0,c.createTable)(this,r);return(0,s.drawTable)(this,a),this},e.API.lastAutoTable=!1,e.API.previousAutoTable=!1,e.API.autoTable.previous=!1,e.API.autoTableText=function(e,t,n,r){(0,a.default)(e,t,n,r,this)},e.API.autoTableSetDefaults=function(e){return i.DocHandler.setDefaults(e,this),this},e.autoTableSetDefaults=function(e,t){i.DocHandler.setDefaults(e,t)},e.API.autoTableHtmlToJson=function(e,t){if(void 0===t&&(t=!1),"undefined"===typeof window)return console.error("Cannot run autoTableHtmlToJson in non browser environment"),null;var n=new i.DocHandler(this),a=(0,r.parseHtml)(n,e,window,t,!1),o=a.head,s=a.body;return{columns:o[0].map(function(e){return e.content}),rows:s,data:s}},e.API.autoTableEndPosY=function(){console.error("Use of deprecated function: autoTableEndPosY. Use doc.lastAutoTable.finalY instead.");var e=this.lastAutoTable;return e&&e.finalY?e.finalY:0},e.API.autoTableAddPageContent=function(t){return console.error("Use of deprecated function: autoTableAddPageContent. Use jsPDF.autoTableSetDefaults({didDrawPage: () => {}}) instead."),e.API.autoTable.globalDefaults||(e.API.autoTable.globalDefaults={}),e.API.autoTable.globalDefaults.addPageContent=t,this},e.API.autoTableAddPage=function(){return console.error("Use of deprecated function: autoTableAddPage. Use doc.addPage()"),this.addPage(),this}}},938:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,r,a){r=r||{};var i=1.15,o=a.internal.scaleFactor,s=a.internal.getFontSize()/o,c="",l=1;if("middle"!==r.valign&&"bottom"!==r.valign&&"center"!==r.halign&&"right"!==r.halign||(l=(c="string"===typeof e?e.split(/\r\n|\r|\n/g):e).length||1),n+=s*(2-i),"middle"===r.valign?n-=l/2*s*i:"bottom"===r.valign&&(n-=l*s*i),"center"===r.halign||"right"===r.halign){var u=s;if("center"===r.halign&&(u*=.5),c&&l>=1){for(var h=0;h<c.length;h++)a.text(c[h],t-a.getStringUnitWidth(c[h])*u,n),n+=s*i;return a}t-=a.getStringUnitWidth(e)*u}return"justify"===r.halign?a.text(e,t,n,{maxWidth:r.maxWidth||100,align:"justify"}):a.text(e,t,n),a}},200:function(e,t){function n(e,t){var n=e>0,r=t||0===t;return n&&r?"DF":n?"S":r?"F":null}Object.defineProperty(t,"__esModule",{value:!0}),t.parseSpacing=t.getFillStyle=t.addTableBorder=t.getStringWidth=void 0,t.getStringWidth=function(e,t,n){return n.applyStyles(t,!0),(Array.isArray(e)?e:[e]).map(function(e){return n.getTextWidth(e)}).reduce(function(e,t){return Math.max(e,t)},0)},t.addTableBorder=function(e,t,r,a){var i=t.settings.tableLineWidth,o=t.settings.tableLineColor;e.applyStyles({lineWidth:i,lineColor:o});var s=n(i,!1);s&&e.rect(r.x,r.y,t.getWidth(e.pageSize().width),a.y-r.y,s)},t.getFillStyle=n,t.parseSpacing=function(e,t){var n,r,a,i;if(e=e||t,Array.isArray(e)){if(e.length>=4)return{top:e[0],right:e[1],bottom:e[2],left:e[3]};if(3===e.length)return{top:e[0],right:e[1],bottom:e[2],left:e[1]};if(2===e.length)return{top:e[0],right:e[1],bottom:e[0],left:e[1]};e=1===e.length?e[0]:t}return"object"===typeof e?("number"===typeof e.vertical&&(e.top=e.vertical,e.bottom=e.vertical),"number"===typeof e.horizontal&&(e.right=e.horizontal,e.left=e.horizontal),{left:null!==(n=e.left)&&void 0!==n?n:t,top:null!==(r=e.top)&&void 0!==r?r:t,right:null!==(a=e.right)&&void 0!==a?a:t,bottom:null!==(i=e.bottom)&&void 0!==i?i:t}):("number"!==typeof e&&(e=t),{top:e,right:e,bottom:e,left:e})}},913:function(e,t){var n=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0}),t.getTheme=t.defaultStyles=t.HtmlRowInput=t.FONT_ROW_RATIO=void 0,t.FONT_ROW_RATIO=1.15;var r=function(e){function t(t){var n=e.call(this)||this;return n._element=t,n}return n(t,e),t}(Array);t.HtmlRowInput=r,t.defaultStyles=function(e){return{font:"helvetica",fontStyle:"normal",overflow:"linebreak",fillColor:!1,textColor:20,halign:"left",valign:"top",fontSize:10,cellPadding:5/e,lineColor:200,lineWidth:0,cellWidth:"auto",minCellHeight:0,minCellWidth:0}},t.getTheme=function(e){return{striped:{table:{fillColor:255,textColor:80,fontStyle:"normal"},head:{textColor:255,fillColor:[41,128,185],fontStyle:"bold"},body:{},foot:{textColor:255,fillColor:[41,128,185],fontStyle:"bold"},alternateRow:{fillColor:245}},grid:{table:{fillColor:255,textColor:80,fontStyle:"normal",lineWidth:.1},head:{textColor:255,fillColor:[26,188,156],fontStyle:"bold",lineWidth:0},body:{},foot:{textColor:255,fillColor:[26,188,156],fontStyle:"bold",lineWidth:0},alternateRow:{}},plain:{head:{fontStyle:"bold"},foot:{fontStyle:"bold"}}}[e]}},259:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.parseCss=void 0;var r=n(200);function a(e,t){var n=i(e,t);if(!n)return null;var r=n.match(/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d*\.?\d*))?\)$/);if(!r||!Array.isArray(r))return null;var a=[parseInt(r[1]),parseInt(r[2]),parseInt(r[3])];return 0===parseInt(r[4])||isNaN(a[0])||isNaN(a[1])||isNaN(a[2])?null:a}function i(e,t){var n=t(e);return"rgba(0, 0, 0, 0)"===n||"transparent"===n||"initial"===n||"inherit"===n?null==e.parentElement?null:i(e.parentElement,t):n}t.parseCss=function(e,t,n,i,o){var s={},c=96/72,l=a(t,function(e){return o.getComputedStyle(e).backgroundColor});null!=l&&(s.fillColor=l);var u=a(t,function(e){return o.getComputedStyle(e).color});null!=u&&(s.textColor=u);var h=a(t,function(e){return o.getComputedStyle(e).borderTopColor});null!=h&&(s.lineColor=h);var d=function(e,t){var n=[e.paddingTop,e.paddingRight,e.paddingBottom,e.paddingLeft],a=96/(72/t),i=(parseInt(e.lineHeight)-parseInt(e.fontSize))/t/2,o=n.map(function(e){return parseInt(e||"0")/a}),s=(0,r.parseSpacing)(o,0);return i>s.top&&(s.top=i),i>s.bottom&&(s.bottom=i),s}(i,n);d&&(s.cellPadding=d);var f=parseInt(i.borderTopWidth||"");(f=f/c/n)&&(s.lineWidth=f);var p=["left","right","center","justify"];-1!==p.indexOf(i.textAlign)&&(s.halign=i.textAlign),-1!==(p=["middle","bottom","top"]).indexOf(i.verticalAlign)&&(s.valign=i.verticalAlign);var m=parseInt(i.fontSize||"");isNaN(m)||(s.fontSize=m/c);var g=function(e){var t="";return("bold"===e.fontWeight||"bolder"===e.fontWeight||parseInt(e.fontWeight)>=700)&&(t="bold"),"italic"!==e.fontStyle&&"oblique"!==e.fontStyle||(t+="italic"),t}(i);g&&(s.fontStyle=g);var v=(i.fontFamily||"").toLowerCase();return-1!==e.indexOf(v)&&(s.font=v),s}},323:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.DocHandler=void 0;var n={},r=function(){function e(e){this.jsPDFDocument=e,this.userStyles={textColor:e.getTextColor?this.jsPDFDocument.getTextColor():0,fontSize:e.internal.getFontSize(),fontStyle:e.internal.getFont().fontStyle,font:e.internal.getFont().fontName}}return e.setDefaults=function(e,t){void 0===t&&(t=null),t?t.__autoTableDocumentDefaults=e:n=e},e.unifyColor=function(e){return Array.isArray(e)?e:"number"===typeof e?[e,e,e]:"string"===typeof e?[e]:null},e.prototype.applyStyles=function(t,n){var r,a,i;void 0===n&&(n=!1),t.fontStyle&&this.jsPDFDocument.setFontStyle&&this.jsPDFDocument.setFontStyle(t.fontStyle);var o=this.jsPDFDocument.internal.getFont(),s=o.fontStyle,c=o.fontName;if(t.font&&(c=t.font),t.fontStyle){s=t.fontStyle;var l=this.getFontList()[c];l&&-1===l.indexOf(s)&&(this.jsPDFDocument.setFontStyle&&this.jsPDFDocument.setFontStyle(l[0]),s=l[0])}if(this.jsPDFDocument.setFont(c,s),t.fontSize&&this.jsPDFDocument.setFontSize(t.fontSize),!n){var u=e.unifyColor(t.fillColor);u&&(r=this.jsPDFDocument).setFillColor.apply(r,u),(u=e.unifyColor(t.textColor))&&(a=this.jsPDFDocument).setTextColor.apply(a,u),(u=e.unifyColor(t.lineColor))&&(i=this.jsPDFDocument).setDrawColor.apply(i,u),"number"===typeof t.lineWidth&&this.jsPDFDocument.setLineWidth(t.lineWidth)}},e.prototype.splitTextToSize=function(e,t,n){return this.jsPDFDocument.splitTextToSize(e,t,n)},e.prototype.rect=function(e,t,n,r,a){return this.jsPDFDocument.rect(e,t,n,r,a)},e.prototype.getLastAutoTable=function(){return this.jsPDFDocument.lastAutoTable||null},e.prototype.getTextWidth=function(e){return this.jsPDFDocument.getTextWidth(e)},e.prototype.getDocument=function(){return this.jsPDFDocument},e.prototype.setPage=function(e){this.jsPDFDocument.setPage(e)},e.prototype.addPage=function(){return this.jsPDFDocument.addPage()},e.prototype.getFontList=function(){return this.jsPDFDocument.getFontList()},e.prototype.getGlobalOptions=function(){return n||{}},e.prototype.getDocumentOptions=function(){return this.jsPDFDocument.__autoTableDocumentDefaults||{}},e.prototype.pageSize=function(){var e=this.jsPDFDocument.internal.pageSize;return null==e.width&&(e={width:e.getWidth(),height:e.getHeight()}),e},e.prototype.scaleFactor=function(){return this.jsPDFDocument.internal.scaleFactor},e.prototype.pageNumber=function(){var e=this.jsPDFDocument.internal.getCurrentPageInfo();return e?e.pageNumber:this.jsPDFDocument.internal.getNumberOfPages()},e}();t.DocHandler=r},148:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.parseHtml=void 0;var r=n(259),a=n(913);function i(e,t,n,i,s,c){for(var l=new a.HtmlRowInput(i),u=0;u<i.cells.length;u++){var h=i.cells[u],d=n.getComputedStyle(h);if(s||"none"!==d.display){var f=void 0;c&&(f=(0,r.parseCss)(e,h,t,d,n)),l.push({rowSpan:h.rowSpan,colSpan:h.colSpan,styles:f,_element:h,content:o(h)})}}var p=n.getComputedStyle(i);if(l.length>0&&(s||"none"!==p.display))return l}function o(e){var t=e.cloneNode(!0);return t.innerHTML=t.innerHTML.replace(/\n/g,"").replace(/ +/g," "),t.innerHTML=t.innerHTML.split(/\<br.*?\>/).map(function(e){return e.trim()}).join("\n"),t.innerText||t.textContent||""}t.parseHtml=function(e,t,n,r,a){var o,s,c;void 0===r&&(r=!1),void 0===a&&(a=!1),c="string"===typeof t?n.document.querySelector(t):t;var l=Object.keys(e.getFontList()),u=e.scaleFactor(),h=[],d=[],f=[];if(!c)return console.error("Html table could not be found with input: ",t),{head:h,body:d,foot:f};for(var p=0;p<c.rows.length;p++){var m=c.rows[p],g=null===(s=null===(o=null===m||void 0===m?void 0:m.parentElement)||void 0===o?void 0:o.tagName)||void 0===s?void 0:s.toLowerCase(),v=i(l,u,n,m,r,a);v&&("thead"===g?h.push(v):"tfoot"===g?f.push(v):d.push(v))}return{head:h,body:d,foot:f}}},587:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.parseInput=void 0;var r=n(148),a=n(360),i=n(200),o=n(323),s=n(291);t.parseInput=function(e,t){var n=new o.DocHandler(e),c=n.getDocumentOptions(),l=n.getGlobalOptions();(0,s.default)(n,l,c,t);var u,h=(0,a.assign)({},l,c,t);"undefined"!==typeof window&&(u=window);var d=function(e,t,n){for(var r={styles:{},headStyles:{},bodyStyles:{},footStyles:{},alternateRowStyles:{},columnStyles:{}},i=function(i){if("columnStyles"===i){var o=e[i],s=t[i],c=n[i];r.columnStyles=(0,a.assign)({},o,s,c)}else{var l=[e,t,n].map(function(e){return e[i]||{}});r[i]=(0,a.assign)({},l[0],l[1],l[2])}},o=0,s=Object.keys(r);o<s.length;o++)i(s[o]);return r}(l,c,t),f=function(e,t,n){for(var r={didParseCell:[],willDrawCell:[],didDrawCell:[],didDrawPage:[]},a=0,i=[e,t,n];a<i.length;a++){var o=i[a];o.didParseCell&&r.didParseCell.push(o.didParseCell),o.willDrawCell&&r.willDrawCell.push(o.willDrawCell),o.didDrawCell&&r.didDrawCell.push(o.didDrawCell),o.didDrawPage&&r.didDrawPage.push(o.didDrawPage)}return r}(l,c,t),p=function(e,t){var n,r,a,o,s,c,l,u,h,d,f,p,m,g=(0,i.parseSpacing)(t.margin,40/e.scaleFactor()),v=null!==(n=function(e,t){var n=e.getLastAutoTable(),r=e.scaleFactor(),a=e.pageNumber(),i=!1;return n&&n.startPageNumber&&(i=n.startPageNumber+n.pageNumber-1===a),"number"===typeof t?t:null!=t&&!1!==t||!i||null==(null===n||void 0===n?void 0:n.finalY)?null:n.finalY+20/r}(e,t.startY))&&void 0!==n?n:g.top;p=!0===t.showFoot?"everyPage":!1===t.showFoot?"never":null!==(r=t.showFoot)&&void 0!==r?r:"everyPage",m=!0===t.showHead?"everyPage":!1===t.showHead?"never":null!==(a=t.showHead)&&void 0!==a?a:"everyPage";var b=null!==(o=t.useCss)&&void 0!==o&&o,y=t.theme||(b?"plain":"striped"),x=!!t.horizontalPageBreak,w=null!==(s=t.horizontalPageBreakRepeat)&&void 0!==s?s:null;return{includeHiddenHtml:null!==(c=t.includeHiddenHtml)&&void 0!==c&&c,useCss:b,theme:y,startY:v,margin:g,pageBreak:null!==(l=t.pageBreak)&&void 0!==l?l:"auto",rowPageBreak:null!==(u=t.rowPageBreak)&&void 0!==u?u:"auto",tableWidth:null!==(h=t.tableWidth)&&void 0!==h?h:"auto",showHead:m,showFoot:p,tableLineWidth:null!==(d=t.tableLineWidth)&&void 0!==d?d:0,tableLineColor:null!==(f=t.tableLineColor)&&void 0!==f?f:200,horizontalPageBreak:x,horizontalPageBreakRepeat:w}}(n,h),m=function(e,t,n){var a=t.head||[],i=t.body||[],o=t.foot||[];if(t.html){var s=t.includeHiddenHtml;if(n){var c=(0,r.parseHtml)(e,t.html,n,s,t.useCss)||{};a=c.head||a,i=c.body||a,o=c.foot||a}else console.error("Cannot parse html in non browser environment")}var l=t.columns||function(e,t,n){var r=e[0]||t[0]||n[0]||[],a=[];return Object.keys(r).filter(function(e){return"_element"!==e}).forEach(function(e){var t,n=1;"object"!==typeof(t=Array.isArray(r)?r[parseInt(e)]:r[e])||Array.isArray(t)||(n=(null===t||void 0===t?void 0:t.colSpan)||1);for(var i=0;i<n;i++){var o={dataKey:Array.isArray(r)?a.length:e+(i>0?"_".concat(i):"")};a.push(o)}}),a}(a,i,o);return{columns:l,head:a,body:i,foot:o}}(n,h,u);return{id:t.tableId,content:m,hooks:f,styles:d,settings:p}}},291:function(e,t){function n(e){e.rowHeight?(console.error("Use of deprecated style rowHeight. It is renamed to minCellHeight."),e.minCellHeight||(e.minCellHeight=e.rowHeight)):e.columnWidth&&(console.error("Use of deprecated style columnWidth. It is renamed to cellWidth."),e.cellWidth||(e.cellWidth=e.columnWidth))}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r,a){for(var i=function(t){t&&"object"!==typeof t&&console.error("The options parameter should be of type object, is: "+typeof t),"undefined"!==typeof t.extendWidth&&(t.tableWidth=t.extendWidth?"auto":"wrap",console.error("Use of deprecated option: extendWidth, use tableWidth instead.")),"undefined"!==typeof t.margins&&("undefined"===typeof t.margin&&(t.margin=t.margins),console.error("Use of deprecated option: margins, use margin instead.")),t.startY&&"number"!==typeof t.startY&&(console.error("Invalid value for startY option",t.startY),delete t.startY),!t.didDrawPage&&(t.afterPageContent||t.beforePageContent||t.afterPageAdd)&&(console.error("The afterPageContent, beforePageContent and afterPageAdd hooks are deprecated. Use didDrawPage instead"),t.didDrawPage=function(n){e.applyStyles(e.userStyles),t.beforePageContent&&t.beforePageContent(n),e.applyStyles(e.userStyles),t.afterPageContent&&t.afterPageContent(n),e.applyStyles(e.userStyles),t.afterPageAdd&&n.pageNumber>1&&n.afterPageAdd(n),e.applyStyles(e.userStyles)}),["createdHeaderCell","drawHeaderRow","drawRow","drawHeaderCell"].forEach(function(e){t[e]&&console.error('The "'.concat(e,'" hook has changed in version 3.0, check the changelog for how to migrate.'))}),[["showFoot","showFooter"],["showHead","showHeader"],["didDrawPage","addPageContent"],["didParseCell","createdCell"],["headStyles","headerStyles"]].forEach(function(e){var n=e[0],r=e[1];t[r]&&(console.error("Use of deprecated option ".concat(r,". Use ").concat(n," instead")),t[n]=t[r])}),[["padding","cellPadding"],["lineHeight","rowHeight"],"fontSize","overflow"].forEach(function(e){var n="string"===typeof e?e:e[0],r="string"===typeof e?e:e[1];"undefined"!==typeof t[n]&&("undefined"===typeof t.styles[r]&&(t.styles[r]=t[n]),console.error("Use of deprecated option: "+n+", use the style "+r+" instead."))});for(var r=0,a=["styles","bodyStyles","headStyles","footStyles"];r<a.length;r++)n(t[a[r]]||{});for(var i=t.columnStyles||{},o=0,s=Object.keys(i);o<s.length;o++)n(i[s[o]]||{})},o=0,s=[t,r,a];o<s.length;o++)i(s[o])}},287:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.Column=t.Cell=t.Row=t.Table=void 0;var r=n(913),a=n(662),i=n(200),o=function(){function e(e,t){this.pageNumber=1,this.pageCount=1,this.id=e.id,this.settings=e.settings,this.styles=e.styles,this.hooks=e.hooks,this.columns=t.columns,this.head=t.head,this.body=t.body,this.foot=t.foot}return e.prototype.getHeadHeight=function(e){return this.head.reduce(function(t,n){return t+n.getMaxCellHeight(e)},0)},e.prototype.getFootHeight=function(e){return this.foot.reduce(function(t,n){return t+n.getMaxCellHeight(e)},0)},e.prototype.allRows=function(){return this.head.concat(this.body).concat(this.foot)},e.prototype.callCellHooks=function(e,t,n,r,i,o){for(var s=0,c=t;s<c.length;s++){var l=!1===(0,c[s])(new a.CellHookData(e,this,n,r,i,o));if(n.text=Array.isArray(n.text)?n.text:[n.text],l)return!1}return!0},e.prototype.callEndPageHooks=function(e,t){e.applyStyles(e.userStyles);for(var n=0,r=this.hooks.didDrawPage;n<r.length;n++)(0,r[n])(new a.HookData(e,this,t))},e.prototype.getWidth=function(e){if("number"===typeof this.settings.tableWidth)return this.settings.tableWidth;if("wrap"===this.settings.tableWidth)return this.columns.reduce(function(e,t){return e+t.wrappedWidth},0);var t=this.settings.margin;return e-t.left-t.right},e}();t.Table=o;var s=function(){function e(e,t,n,a,i){void 0===i&&(i=!1),this.height=0,this.raw=e,e instanceof r.HtmlRowInput&&(this.raw=e._element,this.element=e._element),this.index=t,this.section=n,this.cells=a,this.spansMultiplePages=i}return e.prototype.getMaxCellHeight=function(e){var t=this;return e.reduce(function(e,n){var r;return Math.max(e,(null===(r=t.cells[n.index])||void 0===r?void 0:r.height)||0)},0)},e.prototype.hasRowSpan=function(e){var t=this;return e.filter(function(e){var n=t.cells[e.index];return!!n&&n.rowSpan>1}).length>0},e.prototype.canEntireRowFit=function(e,t){return this.getMaxCellHeight(t)<=e},e.prototype.getMinimumRowHeight=function(e,t){var n=this;return e.reduce(function(e,a){var i=n.cells[a.index];if(!i)return 0;var o=i.styles.fontSize/t.scaleFactor()*r.FONT_ROW_RATIO,s=i.padding("vertical")+o;return s>e?s:e},0)},e}();t.Row=s;var c=function(){function e(e,t,n){var r,a;this.contentHeight=0,this.contentWidth=0,this.wrappedWidth=0,this.minReadableWidth=0,this.minWidth=0,this.width=0,this.height=0,this.x=0,this.y=0,this.styles=t,this.section=n,this.raw=e;var i=e;null==e||"object"!==typeof e||Array.isArray(e)?(this.rowSpan=1,this.colSpan=1):(this.rowSpan=e.rowSpan||1,this.colSpan=e.colSpan||1,i=null!==(a=null!==(r=e.content)&&void 0!==r?r:e.title)&&void 0!==a?a:e,e._element&&(this.raw=e._element));var o=null!=i?""+i:"";this.text=o.split(/\r\n|\r|\n/g)}return e.prototype.getTextPos=function(){var e,t;if("top"===this.styles.valign)e=this.y+this.padding("top");else if("bottom"===this.styles.valign)e=this.y+this.height-this.padding("bottom");else{var n=this.height-this.padding("vertical");e=this.y+n/2+this.padding("top")}if("right"===this.styles.halign)t=this.x+this.width-this.padding("right");else if("center"===this.styles.halign){var r=this.width-this.padding("horizontal");t=this.x+r/2+this.padding("left")}else t=this.x+this.padding("left");return{x:t,y:e}},e.prototype.getContentHeight=function(e){var t=(Array.isArray(this.text)?this.text.length:1)*(this.styles.fontSize/e*r.FONT_ROW_RATIO)+this.padding("vertical");return Math.max(t,this.styles.minCellHeight)},e.prototype.padding=function(e){var t=(0,i.parseSpacing)(this.styles.cellPadding,0);return"vertical"===e?t.top+t.bottom:"horizontal"===e?t.left+t.right:t[e]},e}();t.Cell=c;var l=function(){function e(e,t,n){this.wrappedWidth=0,this.minReadableWidth=0,this.minWidth=0,this.width=0,this.dataKey=e,this.raw=t,this.index=n}return e.prototype.getMaxCustomCellWidth=function(e){for(var t=0,n=0,r=e.allRows();n<r.length;n++){var a=r[n].cells[this.index];a&&"number"===typeof a.styles.cellWidth&&(t=Math.max(t,a.styles.cellWidth))}return t},e}();t.Column=l},360:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.assign=void 0,t.assign=function(e,t,n,r,a){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var i=Object(e),o=1;o<arguments.length;o++){var s=arguments[o];if(null!=s)for(var c in s)Object.prototype.hasOwnProperty.call(s,c)&&(i[c]=s[c])}return i}},858:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.createTable=void 0;var r=n(323),a=n(287),i=n(189),o=n(913),s=n(360);function c(e,t,n,r,i,o){var s={};return t.map(function(t,c){for(var l=0,h={},d=0,f=0,p=0,m=n;p<m.length;p++){var g=m[p];if(null==s[g.index]||0===s[g.index].left)if(0===f){var v=void 0,b={};"object"!==typeof(v=Array.isArray(t)?t[g.index-d-l]:t[g.dataKey])||Array.isArray(v)||(b=(null===v||void 0===v?void 0:v.styles)||{});var y=u(e,g,c,i,r,o,b),x=new a.Cell(v,y,e);h[g.dataKey]=x,h[g.index]=x,f=x.colSpan-1,s[g.index]={left:x.rowSpan-1,times:f}}else f--,d++;else s[g.index].left--,f=s[g.index].times,l++}return new a.Row(t,c,e,h)})}function l(e,t){var n={};return e.forEach(function(e){if(null!=e.raw){var r=function(e,t){if("head"===e){if("object"===typeof t)return t.header||t.title||null;if("string"===typeof t||"number"===typeof t)return t}else if("foot"===e&&"object"===typeof t)return t.footer;return null}(t,e.raw);null!=r&&(n[e.dataKey]=r)}}),Object.keys(n).length>0?n:null}function u(e,t,n,r,a,i,c){var l,u=(0,o.getTheme)(r);"head"===e?l=a.headStyles:"body"===e?l=a.bodyStyles:"foot"===e&&(l=a.footStyles);var h=(0,s.assign)({},u.table,u[e],a.styles,l),d=a.columnStyles[t.dataKey]||a.columnStyles[t.index]||{},f="body"===e?d:{},p="body"===e&&n%2===0?(0,s.assign)({},u.alternateRow,a.alternateRowStyles):{},m=(0,o.defaultStyles)(i),g=(0,s.assign)({},m,h,p,f);return(0,s.assign)(g,c)}t.createTable=function(e,t){var n=new r.DocHandler(e),o=function(e,t){var n,r=e.content,i=function(e){return e.map(function(e,t){var n,r,i;return i="object"===typeof e&&null!==(r=null!==(n=e.dataKey)&&void 0!==n?n:e.key)&&void 0!==r?r:t,new a.Column(i,e,t)})}(r.columns);(0===r.head.length&&(n=l(i,"head"))&&r.head.push(n),0===r.foot.length)&&((n=l(i,"foot"))&&r.foot.push(n));var o=e.settings.theme,s=e.styles;return{columns:i,head:c("head",r.head,i,s,o,t),body:c("body",r.body,i,s,o,t),foot:c("foot",r.foot,i,s,o,t)}}(t,n.scaleFactor()),s=new a.Table(t,o);return(0,i.calculateWidths)(n,s),n.applyStyles(n.userStyles),s}},49:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.addPage=t.drawTable=void 0;var r=n(913),a=n(200),i=n(287),o=n(323),s=n(360),c=n(938),l=n(435);function u(e,t,n){var a=e.styles.fontSize/n.scaleFactor()*r.FONT_ROW_RATIO,i=e.padding("vertical"),o=Math.floor((t-i)/a);return Math.max(0,o)}function h(e,t,n,r,a,o,c){var l=function(e,t,n,r){var a=t.settings.margin.bottom,i=t.settings.showFoot;return("everyPage"===i||"lastPage"===i&&n)&&(a+=t.getFootHeight(t.columns)),e.pageSize().height-r.y-a}(e,t,r,o);if(n.canEntireRowFit(l,c))d(e,t,n,o,c);else if(function(e,t,n,r){var a=e.pageSize().height,i=r.settings.margin,o=a-(i.top+i.bottom);"body"===t.section&&(o-=r.getHeadHeight(r.columns)+r.getFootHeight(r.columns));var s=t.getMinimumRowHeight(r.columns,e),c=s<n;if(s>o)return console.error("Will not be able to print row ".concat(t.index," correctly since it's minimum height is larger than page height")),!0;if(!c)return!1;var l=t.hasRowSpan(r.columns);return t.getMaxCellHeight(r.columns)>o?(l&&console.error("The content of row ".concat(t.index," will not be drawn correctly since drawing rows with a height larger than the page height and has cells with rowspans is not supported.")),!0):!l&&"avoid"!==r.settings.rowPageBreak}(e,n,l,t)){var f=function(e,t,n,r){var a={};e.spansMultiplePages=!0,e.height=0;for(var o=0,c=0,l=n.columns;c<l.length;c++){var h=l[c];if(b=e.cells[h.index]){Array.isArray(b.text)||(b.text=[b.text]);var d=new i.Cell(b.raw,b.styles,b.section);(d=(0,s.assign)(d,b)).text=[];var f=u(b,t,r);b.text.length>f&&(d.text=b.text.splice(f,b.text.length));var p=r.scaleFactor();b.contentHeight=b.getContentHeight(p),b.contentHeight>=t&&(b.contentHeight=t,d.styles.minCellHeight-=t),b.contentHeight>e.height&&(e.height=b.contentHeight),d.contentHeight=d.getContentHeight(p),d.contentHeight>o&&(o=d.contentHeight),a[h.index]=d}}var m=new i.Row(e.raw,-1,e.section,a,!0);m.height=o;for(var g=0,v=n.columns;g<v.length;g++){var b;h=v[g],(d=m.cells[h.index])&&(d.height=m.height),(b=e.cells[h.index])&&(b.height=e.height)}return m}(n,l,t,e);d(e,t,n,o,c),p(e,t,a,o,c),h(e,t,f,r,a,o,c)}else p(e,t,a,o,c),h(e,t,n,r,a,o,c)}function d(e,t,n,r,a){r.x=t.settings.margin.left;for(var i=0,o=a;i<o.length;i++){var s=o[i],l=n.cells[s.index];if(l)if(e.applyStyles(l.styles),l.x=r.x,l.y=r.y,!1!==t.callCellHooks(e,t.hooks.willDrawCell,l,n,s,r)){f(e,l,r);var u=l.getTextPos();(0,c.default)(l.text,u.x,u.y,{halign:l.styles.halign,valign:l.styles.valign,maxWidth:Math.ceil(l.width-l.padding("left")-l.padding("right"))},e.getDocument()),t.callCellHooks(e,t.hooks.didDrawCell,l,n,s,r),r.x+=s.width}else r.x+=s.width;else r.x+=s.width}r.y+=n.height}function f(e,t,n){var r=t.styles;if(e.getDocument().setFillColor(e.getDocument().getFillColor()),"number"===typeof r.lineWidth){var i=(0,a.getFillStyle)(r.lineWidth,r.fillColor);i&&e.rect(t.x,n.y,t.width,t.height,i)}else if("object"===typeof r.lineWidth){e.rect(t.x,n.y,t.width,t.height,"F");var o=Object.keys(r.lineWidth),s=r.lineWidth;o.map(function(i){var o=(0,a.getFillStyle)(s[i],r.fillColor);!function(e,t,n,r,a,i){var o,s,c,l;switch(r){case"top":o=n.x,s=n.y,c=n.x+t.width,l=n.y;break;case"left":o=n.x,s=n.y,c=n.x,l=n.y+t.height;break;case"right":o=n.x+t.width,s=n.y,c=n.x+t.width,l=n.y+t.height;break;default:o=n.x,s=n.y+t.height-i,c=n.x+t.width,l=n.y+t.height-i}e.getDocument().setLineWidth(i),e.getDocument().line(o,s,c,l,a)}(e,t,n,i,o||"S",s[i])})}}function p(e,t,n,r,i){void 0===i&&(i=[]),e.applyStyles(e.userStyles),"everyPage"===t.settings.showFoot&&t.foot.forEach(function(n){return d(e,t,n,r,i)}),t.callEndPageHooks(e,r);var o=t.settings.margin;(0,a.addTableBorder)(e,t,n,r),m(e),t.pageNumber++,t.pageCount++,r.x=o.left,r.y=o.top,n.y=o.top,"everyPage"===t.settings.showHead&&t.head.forEach(function(n){return d(e,t,n,r,i)})}function m(e){var t=e.pageNumber();e.setPage(t+1),e.pageNumber()===t&&e.addPage()}t.drawTable=function(e,t){var n=t.settings,r=n.startY,i=n.margin,c={x:i.left,y:r},u=t.getHeadHeight(t.columns)+t.getFootHeight(t.columns),f=r+i.bottom+u;"avoid"===n.pageBreak&&(f+=t.allRows().reduce(function(e,t){return e+t.height},0));var g=new o.DocHandler(e);("always"===n.pageBreak||null!=n.startY&&f>g.pageSize().height)&&(m(g),c.y=i.top);var v=(0,s.assign)({},c);t.startPageNumber=g.pageNumber(),!0===n.horizontalPageBreak?function(e,t,n,r){var a=l.default.calculateAllColumnsCanFitInPage(e,t);a.map(function(a,i){e.applyStyles(e.userStyles),i>0?p(e,t,n,r,a.columns):function(e,t,n,r){var a=t.settings;e.applyStyles(e.userStyles),("firstPage"===a.showHead||"everyPage"===a.showHead)&&t.head.forEach(function(a){return d(e,t,a,n,r)})}(e,t,r,a.columns),function(e,t,n,r,a){e.applyStyles(e.userStyles),t.body.forEach(function(i,o){var s=o===t.body.length-1;h(e,t,i,s,n,r,a)})}(e,t,n,r,a.columns),function(e,t,n,r){var a=t.settings;e.applyStyles(e.userStyles),("lastPage"===a.showFoot||"everyPage"===a.showFoot)&&t.foot.forEach(function(a){return d(e,t,a,n,r)})}(e,t,r,a.columns)})}(g,t,v,c):(g.applyStyles(g.userStyles),"firstPage"!==n.showHead&&"everyPage"!==n.showHead||t.head.forEach(function(e){return d(g,t,e,c,t.columns)}),g.applyStyles(g.userStyles),t.body.forEach(function(e,n){var r=n===t.body.length-1;h(g,t,e,r,v,c,t.columns)}),g.applyStyles(g.userStyles),"lastPage"!==n.showFoot&&"everyPage"!==n.showFoot||t.foot.forEach(function(e){return d(g,t,e,c,t.columns)})),(0,a.addTableBorder)(g,t,v,c),t.callEndPageHooks(g,c),t.finalY=c.y,e.lastAutoTable=t,e.previousAutoTable=t,e.autoTable&&(e.autoTable.previous=t),g.applyStyles(g.userStyles)},t.addPage=p},435:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(200),a=function(e,t){var n=(0,r.parseSpacing)(t.settings.margin,0);return e.pageSize().width-(n.left+n.right)},i=function(e,t,n){void 0===n&&(n={});var r=a(e,t),i=t.settings.horizontalPageBreakRepeat,o=null,s=[],c=[],l=t.columns.length,u=n&&n.start?n.start:0;for(null!=i&&(o=t.columns.find(function(e){return e.dataKey===i||e.index===i}))&&(s.push(o.index),c.push(t.columns[o.index]),r-=o.wrappedWidth);u<l;)if((null===o||void 0===o?void 0:o.index)!==u){var h=t.columns[u].wrappedWidth;if(r<h){0!==u&&u!==n.start||(s.push(u),c.push(t.columns[u]));break}s.push(u),c.push(t.columns[u]),r-=h,u++}else u++;return{colIndexes:s,columns:c,lastIndex:u}};t.default={getColumnsCanFitInPage:i,calculateAllColumnsCanFitInPage:function(e,t){for(var n=[],r=0,a=t.columns.length;r<a;){var o=i(e,t,{start:0===r?0:r});o&&o.columns&&o.columns.length?(r=o.lastIndex,n.push(o)):r++}return n},getPageAvailableWidth:a}},189:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.ellipsize=t.resizeColumns=t.calculateWidths=void 0;var r=n(200),a=n(435);function i(e,t,n){for(var r=t,a=e.reduce(function(e,t){return e+t.wrappedWidth},0),o=0;o<e.length;o++){var s=e[o],c=r*(s.wrappedWidth/a),l=s.width+c,u=n(s),h=l<u?u:l;t-=h-s.width,s.width=h}if(t=Math.round(1e10*t)/1e10){var d=e.filter(function(e){return!(t<0)||e.width>n(e)});d.length&&(t=i(d,t,n))}return t}function o(e,t,n,a,i){return e.map(function(e){return function(e,t,n,a,i){var o=1e4*a.scaleFactor();if((t=Math.ceil(t*o)/o)>=(0,r.getStringWidth)(e,n,a))return e;for(;t<(0,r.getStringWidth)(e+i,n,a)&&!(e.length<=1);)e=e.substring(0,e.length-1);return e.trim()+i}(e,t,n,a,i)})}t.calculateWidths=function(e,t){!function(e,t){var n=e.scaleFactor(),i=t.settings.horizontalPageBreak,o=a.default.getPageAvailableWidth(e,t);t.allRows().forEach(function(a){for(var s=0,c=t.columns;s<c.length;s++){var l=c[s],u=a.cells[l.index];if(u){var h=t.hooks.didParseCell;t.callCellHooks(e,h,u,a,l,null);var d=u.padding("horizontal");u.contentWidth=(0,r.getStringWidth)(u.text,u.styles,e)+d;var f=(0,r.getStringWidth)(u.text.join(" ").split(/\s+/),u.styles,e);if(u.minReadableWidth=f+u.padding("horizontal"),"number"===typeof u.styles.cellWidth)u.minWidth=u.styles.cellWidth,u.wrappedWidth=u.styles.cellWidth;else if("wrap"===u.styles.cellWidth||!0===i)u.contentWidth>o?(u.minWidth=o,u.wrappedWidth=o):(u.minWidth=u.contentWidth,u.wrappedWidth=u.contentWidth);else{var p=10/n;u.minWidth=u.styles.minCellWidth||p,u.wrappedWidth=u.contentWidth,u.minWidth>u.wrappedWidth&&(u.wrappedWidth=u.minWidth)}}}}),t.allRows().forEach(function(e){for(var n=0,r=t.columns;n<r.length;n++){var a=r[n],i=e.cells[a.index];if(i&&1===i.colSpan)a.wrappedWidth=Math.max(a.wrappedWidth,i.wrappedWidth),a.minWidth=Math.max(a.minWidth,i.minWidth),a.minReadableWidth=Math.max(a.minReadableWidth,i.minReadableWidth);else{var o=t.styles.columnStyles[a.dataKey]||t.styles.columnStyles[a.index]||{},s=o.cellWidth||o.minCellWidth;s&&"number"===typeof s&&(a.minWidth=s,a.wrappedWidth=s)}i&&(i.colSpan>1&&!a.minWidth&&(a.minWidth=i.minWidth),i.colSpan>1&&!a.wrappedWidth&&(a.wrappedWidth=i.minWidth))}})}(e,t);var n=[],s=0;t.columns.forEach(function(e){var r=e.getMaxCustomCellWidth(t);r?e.width=r:(e.width=e.wrappedWidth,n.push(e)),s+=e.width});var c=t.getWidth(e.pageSize().width)-s;c&&(c=i(n,c,function(e){return Math.max(e.minReadableWidth,e.minWidth)})),c&&(c=i(n,c,function(e){return e.minWidth})),c=Math.abs(c),!t.settings.horizontalPageBreak&&c>.1/e.scaleFactor()&&(c=c<1?c:Math.round(c),console.error("Of the table content, ".concat(c," units width could not fit page"))),function(e){for(var t=e.allRows(),n=0;n<t.length;n++)for(var r=t[n],a=null,i=0,o=0,s=0;s<e.columns.length;s++){var c=e.columns[s];if((o-=1)>1&&e.columns[s+1])i+=c.width,delete r.cells[c.index];else if(a){var l=a;delete r.cells[c.index],a=null,l.width=c.width+i}else{if(!(l=r.cells[c.index]))continue;if(o=l.colSpan,i=0,l.colSpan>1){a=l,i+=c.width;continue}l.width=c.width+i}}}(t),function(e,t){for(var n={count:0,height:0},r=0,a=e.allRows();r<a.length;r++){for(var i=a[r],s=0,c=e.columns;s<c.length;s++){var l=c[s],u=i.cells[l.index];if(u){t.applyStyles(u.styles,!0);var h=u.width-u.padding("horizontal");"linebreak"===u.styles.overflow?u.text=t.splitTextToSize(u.text,h+1/t.scaleFactor(),{fontSize:u.styles.fontSize}):"ellipsize"===u.styles.overflow?u.text=o(u.text,h,u.styles,t,"..."):"hidden"===u.styles.overflow?u.text=o(u.text,h,u.styles,t,""):"function"===typeof u.styles.overflow&&(u.text=u.styles.overflow(u.text,h)),u.contentHeight=u.getContentHeight(t.scaleFactor());var d=u.contentHeight/u.rowSpan;u.rowSpan>1&&n.count*n.height<d*u.rowSpan?n={height:d,count:u.rowSpan}:n&&n.count>0&&n.height>d&&(d=n.height),d>i.height&&(i.height=d)}}n.count--}}(t,e),function(e){for(var t={},n=1,r=e.allRows(),a=0;a<r.length;a++)for(var i=r[a],o=0,s=e.columns;o<s.length;o++){var c=s[o],l=t[c.index];if(n>1)n--,delete i.cells[c.index];else if(l)l.cell.height+=i.height,n=l.cell.colSpan,delete i.cells[c.index],l.left--,l.left<=1&&delete t[c.index];else{var u=i.cells[c.index];if(!u)continue;if(u.height=i.height,u.rowSpan>1){var h=r.length-a,d=u.rowSpan>h?h:u.rowSpan;t[c.index]={cell:u,left:d,row:i}}}}}(t)},t.resizeColumns=i,t.ellipsize=o},84:function(t){if("undefined"===typeof e){var n=new Error("Cannot find module 'undefined'");throw n.code="MODULE_NOT_FOUND",n}t.exports=e}},n={};function r(e){var a=n[e];if(void 0!==a)return a.exports;var i=n[e]={exports:{}};return t[e].call(i.exports,i,i.exports,r),i.exports}var a={};return function(){var e=a;Object.defineProperty(e,"__esModule",{value:!0}),e.Cell=e.Column=e.Row=e.Table=e.CellHookData=e.__drawTable=e.__createTable=e.applyPlugin=void 0;var t=r(790),n=r(587),i=r(49),o=r(858),s=r(287);Object.defineProperty(e,"Table",{enumerable:!0,get:function(){return s.Table}});var c=r(662);Object.defineProperty(e,"CellHookData",{enumerable:!0,get:function(){return c.CellHookData}});var l=r(287);function u(e){(0,t.default)(e)}Object.defineProperty(e,"Cell",{enumerable:!0,get:function(){return l.Cell}}),Object.defineProperty(e,"Column",{enumerable:!0,get:function(){return l.Column}}),Object.defineProperty(e,"Row",{enumerable:!0,get:function(){return l.Row}}),e.applyPlugin=u,e.default=function(e,t){var r=(0,n.parseInput)(e,t),a=(0,o.createTable)(e,r);(0,i.drawTable)(e,a)},e.__createTable=function(e,t){var r=(0,n.parseInput)(e,t);return(0,o.createTable)(e,r)},e.__drawTable=function(e,t){(0,i.drawTable)(e,t)};try{var h=r(84);h.jsPDF&&(h=h.jsPDF),u(h)}catch(d){}}(),a}()},e.exports=r(function(){try{return n(9019)}catch(e){}}())},1053:(e,t,n)=>{var r=n(2658),a=n(3271),i=n(545),o=n(4281),s=n(4647),c=n(2855),l=n(2583);l.alea=r,l.xor128=a,l.xorwow=i,l.xorshift7=o,l.xor4096=s,l.tychei=c,e.exports=l},1065:()=>{},1072:e=>{e.exports=n;var t=null;try{t=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(C){}function n(e,t,n){this.low=0|e,this.high=0|t,this.unsigned=!!n}function r(e){return!0===(e&&e.__isLong__)}n.prototype.__isLong__,Object.defineProperty(n.prototype,"__isLong__",{value:!0}),n.isLong=r;var a={},i={};function o(e,t){var n,r,o;return t?(o=0<=(e>>>=0)&&e<256)&&(r=i[e])?r:(n=c(e,(0|e)<0?-1:0,!0),o&&(i[e]=n),n):(o=-128<=(e|=0)&&e<128)&&(r=a[e])?r:(n=c(e,e<0?-1:0,!1),o&&(a[e]=n),n)}function s(e,t){if(isNaN(e))return t?v:g;if(t){if(e<0)return v;if(e>=f)return k}else{if(e<=-p)return S;if(e+1>=p)return w}return e<0?s(-e,t).neg():c(e%d|0,e/d|0,t)}function c(e,t,r){return new n(e,t,r)}n.fromInt=o,n.fromNumber=s,n.fromBits=c;var l=Math.pow;function u(e,t,n){if(0===e.length)throw Error("empty string");if("NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return g;if("number"===typeof t?(n=t,t=!1):t=!!t,(n=n||10)<2||36<n)throw RangeError("radix");var r;if((r=e.indexOf("-"))>0)throw Error("interior hyphen");if(0===r)return u(e.substring(1),t,n).neg();for(var a=s(l(n,8)),i=g,o=0;o<e.length;o+=8){var c=Math.min(8,e.length-o),h=parseInt(e.substring(o,o+c),n);if(c<8){var d=s(l(n,c));i=i.mul(d).add(s(h))}else i=(i=i.mul(a)).add(s(h))}return i.unsigned=t,i}function h(e,t){return"number"===typeof e?s(e,t):"string"===typeof e?u(e,t):c(e.low,e.high,"boolean"===typeof t?t:e.unsigned)}n.fromString=u,n.fromValue=h;var d=4294967296,f=d*d,p=f/2,m=o(1<<24),g=o(0);n.ZERO=g;var v=o(0,!0);n.UZERO=v;var b=o(1);n.ONE=b;var y=o(1,!0);n.UONE=y;var x=o(-1);n.NEG_ONE=x;var w=c(-1,2147483647,!1);n.MAX_VALUE=w;var k=c(-1,-1,!0);n.MAX_UNSIGNED_VALUE=k;var S=c(0,-2147483648,!1);n.MIN_VALUE=S;var N=n.prototype;N.toInt=function(){return this.unsigned?this.low>>>0:this.low},N.toNumber=function(){return this.unsigned?(this.high>>>0)*d+(this.low>>>0):this.high*d+(this.low>>>0)},N.toString=function(e){if((e=e||10)<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(S)){var t=s(e),n=this.div(t),r=n.mul(t).sub(this);return n.toString(e)+r.toInt().toString(e)}return"-"+this.neg().toString(e)}for(var a=s(l(e,6),this.unsigned),i=this,o="";;){var c=i.div(a),u=(i.sub(c.mul(a)).toInt()>>>0).toString(e);if((i=c).isZero())return u+o;for(;u.length<6;)u="0"+u;o=""+u+o}},N.getHighBits=function(){return this.high},N.getHighBitsUnsigned=function(){return this.high>>>0},N.getLowBits=function(){return this.low},N.getLowBitsUnsigned=function(){return this.low>>>0},N.getNumBitsAbs=function(){if(this.isNegative())return this.eq(S)?64:this.neg().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,t=31;t>0&&0==(e&1<<t);t--);return 0!=this.high?t+33:t+1},N.isZero=function(){return 0===this.high&&0===this.low},N.eqz=N.isZero,N.isNegative=function(){return!this.unsigned&&this.high<0},N.isPositive=function(){return this.unsigned||this.high>=0},N.isOdd=function(){return 1===(1&this.low)},N.isEven=function(){return 0===(1&this.low)},N.equals=function(e){return r(e)||(e=h(e)),(this.unsigned===e.unsigned||this.high>>>31!==1||e.high>>>31!==1)&&(this.high===e.high&&this.low===e.low)},N.eq=N.equals,N.notEquals=function(e){return!this.eq(e)},N.neq=N.notEquals,N.ne=N.notEquals,N.lessThan=function(e){return this.comp(e)<0},N.lt=N.lessThan,N.lessThanOrEqual=function(e){return this.comp(e)<=0},N.lte=N.lessThanOrEqual,N.le=N.lessThanOrEqual,N.greaterThan=function(e){return this.comp(e)>0},N.gt=N.greaterThan,N.greaterThanOrEqual=function(e){return this.comp(e)>=0},N.gte=N.greaterThanOrEqual,N.ge=N.greaterThanOrEqual,N.compare=function(e){if(r(e)||(e=h(e)),this.eq(e))return 0;var t=this.isNegative(),n=e.isNegative();return t&&!n?-1:!t&&n?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},N.comp=N.compare,N.negate=function(){return!this.unsigned&&this.eq(S)?S:this.not().add(b)},N.neg=N.negate,N.add=function(e){r(e)||(e=h(e));var t=this.high>>>16,n=65535&this.high,a=this.low>>>16,i=65535&this.low,o=e.high>>>16,s=65535&e.high,l=e.low>>>16,u=0,d=0,f=0,p=0;return f+=(p+=i+(65535&e.low))>>>16,d+=(f+=a+l)>>>16,u+=(d+=n+s)>>>16,u+=t+o,c((f&=65535)<<16|(p&=65535),(u&=65535)<<16|(d&=65535),this.unsigned)},N.subtract=function(e){return r(e)||(e=h(e)),this.add(e.neg())},N.sub=N.subtract,N.multiply=function(e){if(this.isZero())return g;if(r(e)||(e=h(e)),t)return c(t.mul(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned);if(e.isZero())return g;if(this.eq(S))return e.isOdd()?S:g;if(e.eq(S))return this.isOdd()?S:g;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(m)&&e.lt(m))return s(this.toNumber()*e.toNumber(),this.unsigned);var n=this.high>>>16,a=65535&this.high,i=this.low>>>16,o=65535&this.low,l=e.high>>>16,u=65535&e.high,d=e.low>>>16,f=65535&e.low,p=0,v=0,b=0,y=0;return b+=(y+=o*f)>>>16,v+=(b+=i*f)>>>16,b&=65535,v+=(b+=o*d)>>>16,p+=(v+=a*f)>>>16,v&=65535,p+=(v+=i*d)>>>16,v&=65535,p+=(v+=o*u)>>>16,p+=n*f+a*d+i*u+o*l,c((b&=65535)<<16|(y&=65535),(p&=65535)<<16|(v&=65535),this.unsigned)},N.mul=N.multiply,N.divide=function(e){if(r(e)||(e=h(e)),e.isZero())throw Error("division by zero");var n,a,i;if(t)return this.unsigned||-2147483648!==this.high||-1!==e.low||-1!==e.high?c((this.unsigned?t.div_u:t.div_s)(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?v:g;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return v;if(e.gt(this.shru(1)))return y;i=v}else{if(this.eq(S))return e.eq(b)||e.eq(x)?S:e.eq(S)?b:(n=this.shr(1).div(e).shl(1)).eq(g)?e.isNegative()?b:x:(a=this.sub(e.mul(n)),i=n.add(a.div(e)));if(e.eq(S))return this.unsigned?v:g;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();i=g}for(a=this;a.gte(e);){n=Math.max(1,Math.floor(a.toNumber()/e.toNumber()));for(var o=Math.ceil(Math.log(n)/Math.LN2),u=o<=48?1:l(2,o-48),d=s(n),f=d.mul(e);f.isNegative()||f.gt(a);)f=(d=s(n-=u,this.unsigned)).mul(e);d.isZero()&&(d=b),i=i.add(d),a=a.sub(f)}return i},N.div=N.divide,N.modulo=function(e){return r(e)||(e=h(e)),t?c((this.unsigned?t.rem_u:t.rem_s)(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned):this.sub(this.div(e).mul(e))},N.mod=N.modulo,N.rem=N.modulo,N.not=function(){return c(~this.low,~this.high,this.unsigned)},N.and=function(e){return r(e)||(e=h(e)),c(this.low&e.low,this.high&e.high,this.unsigned)},N.or=function(e){return r(e)||(e=h(e)),c(this.low|e.low,this.high|e.high,this.unsigned)},N.xor=function(e){return r(e)||(e=h(e)),c(this.low^e.low,this.high^e.high,this.unsigned)},N.shiftLeft=function(e){return r(e)&&(e=e.toInt()),0===(e&=63)?this:e<32?c(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):c(0,this.low<<e-32,this.unsigned)},N.shl=N.shiftLeft,N.shiftRight=function(e){return r(e)&&(e=e.toInt()),0===(e&=63)?this:e<32?c(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):c(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},N.shr=N.shiftRight,N.shiftRightUnsigned=function(e){if(r(e)&&(e=e.toInt()),0===(e&=63))return this;var t=this.high;return e<32?c(this.low>>>e|t<<32-e,t>>>e,this.unsigned):c(32===e?t:t>>>e-32,0,this.unsigned)},N.shru=N.shiftRightUnsigned,N.shr_u=N.shiftRightUnsigned,N.toSigned=function(){return this.unsigned?c(this.low,this.high,!1):this},N.toUnsigned=function(){return this.unsigned?this:c(this.low,this.high,!0)},N.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},N.toBytesLE=function(){var e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24,255&e,e>>>8&255,e>>>16&255,e>>>24]},N.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,255&e,t>>>24,t>>>16&255,t>>>8&255,255&t]},n.fromBytes=function(e,t,r){return r?n.fromBytesLE(e,t):n.fromBytesBE(e,t)},n.fromBytesLE=function(e,t){return new n(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)},n.fromBytesBE=function(e,t){return new n(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)}},1234:()=>{},1352:(e,t,n)=>{"use strict";var r=n(7119);t.createRoot=r.createRoot,t.hydrateRoot=r.hydrateRoot},1761:(e,t)=>{"use strict";function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var r=n-1>>>1,a=e[r];if(!(0<i(a,t)))break e;e[r]=t,e[n]=a,n=r}}function r(e){return 0===e.length?null:e[0]}function a(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var r=0,a=e.length,o=a>>>1;r<o;){var s=2*(r+1)-1,c=e[s],l=s+1,u=e[l];if(0>i(c,n))l<a&&0>i(u,c)?(e[r]=u,e[l]=n,r=l):(e[r]=c,e[s]=n,r=s);else{if(!(l<a&&0>i(u,n)))break e;e[r]=u,e[l]=n,r=l}}}return t}function i(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if("object"===typeof performance&&"function"===typeof performance.now){var o=performance;t.unstable_now=function(){return o.now()}}else{var s=Date,c=s.now();t.unstable_now=function(){return s.now()-c}}var l=[],u=[],h=1,d=null,f=3,p=!1,m=!1,g=!1,v="function"===typeof setTimeout?setTimeout:null,b="function"===typeof clearTimeout?clearTimeout:null,y="undefined"!==typeof setImmediate?setImmediate:null;function x(e){for(var t=r(u);null!==t;){if(null===t.callback)a(u);else{if(!(t.startTime<=e))break;a(u),t.sortIndex=t.expirationTime,n(l,t)}t=r(u)}}function w(e){if(g=!1,x(e),!m)if(null!==r(l))m=!0,D(k);else{var t=r(u);null!==t&&O(w,t.startTime-e)}}function k(e,n){m=!1,g&&(g=!1,b(E),E=-1),p=!0;var i=f;try{for(x(n),d=r(l);null!==d&&(!(d.expirationTime>n)||e&&!_());){var o=d.callback;if("function"===typeof o){d.callback=null,f=d.priorityLevel;var s=o(d.expirationTime<=n);n=t.unstable_now(),"function"===typeof s?d.callback=s:d===r(l)&&a(l),x(n)}else a(l);d=r(l)}if(null!==d)var c=!0;else{var h=r(u);null!==h&&O(w,h.startTime-n),c=!1}return c}finally{d=null,f=i,p=!1}}"undefined"!==typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var S,N=!1,C=null,E=-1,I=5,T=-1;function _(){return!(t.unstable_now()-T<I)}function A(){if(null!==C){var e=t.unstable_now();T=e;var n=!0;try{n=C(!0,e)}finally{n?S():(N=!1,C=null)}}else N=!1}if("function"===typeof y)S=function(){y(A)};else if("undefined"!==typeof MessageChannel){var R=new MessageChannel,F=R.port2;R.port1.onmessage=A,S=function(){F.postMessage(null)}}else S=function(){v(A,0)};function D(e){C=e,N||(N=!0,S())}function O(e,n){E=v(function(){e(t.unstable_now())},n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){m||p||(m=!0,D(k))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):I=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return f},t.unstable_getFirstCallbackNode=function(){return r(l)},t.unstable_next=function(e){switch(f){case 1:case 2:case 3:var t=3;break;default:t=f}var n=f;f=t;try{return e()}finally{f=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=f;f=e;try{return t()}finally{f=n}},t.unstable_scheduleCallback=function(e,a,i){var o=t.unstable_now();switch("object"===typeof i&&null!==i?i="number"===typeof(i=i.delay)&&0<i?o+i:o:i=o,e){case 1:var s=-1;break;case 2:s=250;break;case 5:s=1073741823;break;case 4:s=1e4;break;default:s=5e3}return e={id:h++,callback:a,priorityLevel:e,startTime:i,expirationTime:s=i+s,sortIndex:-1},i>o?(e.sortIndex=i,n(u,e),null===r(l)&&e===r(u)&&(g?(b(E),E=-1):g=!0,O(w,i-o))):(e.sortIndex=s,n(l,e),m||p||(m=!0,D(k))),e},t.unstable_shouldYield=_,t.unstable_wrapCallback=function(e){var t=f;return function(){var n=f;f=t;try{return e.apply(this,arguments)}finally{f=n}}}},1766:function(e,t,n){var r;r=function(e){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var a=t[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,n),a.l=!0,a.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(r,a,function(t){return e[t]}.bind(null,a));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s="./src/react-webcam.tsx")}({"./src/react-webcam.tsx":function(e,t,n){"use strict";n.r(t);var r=n("react"),a=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=function(){return i=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},i.apply(this,arguments)},o=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(n[r[a]]=e[r[a]])}return n};function s(){return!(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)}"undefined"!==typeof window&&(void 0===navigator.mediaDevices&&(navigator.mediaDevices={}),void 0===navigator.mediaDevices.getUserMedia&&(navigator.mediaDevices.getUserMedia=function(e){var t=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;return t?new Promise(function(n,r){t.call(navigator,e,n,r)}):Promise.reject(new Error("getUserMedia is not implemented in this browser"))}));var c=function(e){function t(t){var n=e.call(this,t)||this;return n.canvas=null,n.ctx=null,n.requestUserMediaId=0,n.unmounted=!1,n.state={hasUserMedia:!1},n}return a(t,e),t.prototype.componentDidMount=function(){var e=this.state,t=this.props;this.unmounted=!1,s()?(e.hasUserMedia||this.requestUserMedia(),t.children&&"function"!=typeof t.children&&console.warn("children must be a function")):t.onUserMediaError("getUserMedia not supported")},t.prototype.componentDidUpdate=function(e){var t=this.props;if(s()){var n=JSON.stringify(e.audioConstraints)!==JSON.stringify(t.audioConstraints),r=JSON.stringify(e.videoConstraints)!==JSON.stringify(t.videoConstraints),a=e.minScreenshotWidth!==t.minScreenshotWidth,i=e.minScreenshotHeight!==t.minScreenshotHeight;(r||a||i)&&(this.canvas=null,this.ctx=null),(n||r)&&(this.stopAndCleanup(),this.requestUserMedia())}else t.onUserMediaError("getUserMedia not supported")},t.prototype.componentWillUnmount=function(){this.unmounted=!0,this.stopAndCleanup()},t.stopMediaStream=function(e){e&&(e.getVideoTracks&&e.getAudioTracks?(e.getVideoTracks().map(function(t){e.removeTrack(t),t.stop()}),e.getAudioTracks().map(function(t){e.removeTrack(t),t.stop()})):e.stop())},t.prototype.stopAndCleanup=function(){var e=this.state;e.hasUserMedia&&(t.stopMediaStream(this.stream),e.src&&window.URL.revokeObjectURL(e.src))},t.prototype.getScreenshot=function(e){var t=this.state,n=this.props;if(!t.hasUserMedia)return null;var r=this.getCanvas(e);return r&&r.toDataURL(n.screenshotFormat,n.screenshotQuality)},t.prototype.getCanvas=function(e){var t=this.state,n=this.props;if(!this.video)return null;if(!t.hasUserMedia||!this.video.videoHeight)return null;if(!this.ctx){var r=this.video.videoWidth,a=this.video.videoHeight;if(!this.props.forceScreenshotSourceSize){var i=r/a;a=(r=n.minScreenshotWidth||this.video.clientWidth)/i,n.minScreenshotHeight&&a<n.minScreenshotHeight&&(r=(a=n.minScreenshotHeight)*i)}this.canvas=document.createElement("canvas"),this.canvas.width=(null===e||void 0===e?void 0:e.width)||r,this.canvas.height=(null===e||void 0===e?void 0:e.height)||a,this.ctx=this.canvas.getContext("2d")}var o=this.ctx,s=this.canvas;return o&&s&&(s.width=(null===e||void 0===e?void 0:e.width)||s.width,s.height=(null===e||void 0===e?void 0:e.height)||s.height,n.mirrored&&(o.translate(s.width,0),o.scale(-1,1)),o.imageSmoothingEnabled=n.imageSmoothing,o.drawImage(this.video,0,0,(null===e||void 0===e?void 0:e.width)||s.width,(null===e||void 0===e?void 0:e.height)||s.height),n.mirrored&&(o.scale(-1,1),o.translate(-s.width,0))),s},t.prototype.requestUserMedia=function(){var e=this,n=this.props,r=function(r,a){var i={video:"undefined"===typeof a||a};n.audio&&(i.audio="undefined"===typeof r||r),e.requestUserMediaId++;var o=e.requestUserMediaId;navigator.mediaDevices.getUserMedia(i).then(function(n){e.unmounted||o!==e.requestUserMediaId?t.stopMediaStream(n):e.handleUserMedia(null,n)}).catch(function(t){e.handleUserMedia(t)})};if("mediaDevices"in navigator)r(n.audioConstraints,n.videoConstraints);else{var a=function(e){return{optional:[{sourceId:e}]}},i=function(e){var t=e.deviceId;return"string"===typeof t?t:Array.isArray(t)&&t.length>0?t[0]:"object"===typeof t&&t.ideal?t.ideal:null};MediaStreamTrack.getSources(function(e){var t=null,o=null;e.forEach(function(e){"audio"===e.kind?t=e.id:"video"===e.kind&&(o=e.id)});var s=i(n.audioConstraints);s&&(t=s);var c=i(n.videoConstraints);c&&(o=c),r(a(t),a(o))})}},t.prototype.handleUserMedia=function(e,t){var n=this.props;if(e||!t)return this.setState({hasUserMedia:!1}),void n.onUserMediaError(e);this.stream=t;try{this.video&&(this.video.srcObject=t),this.setState({hasUserMedia:!0})}catch(r){this.setState({hasUserMedia:!0,src:window.URL.createObjectURL(t)})}n.onUserMedia(t)},t.prototype.render=function(){var e=this,t=this.state,n=this.props,a=n.audio,s=(n.forceScreenshotSourceSize,n.disablePictureInPicture),c=(n.onUserMedia,n.onUserMediaError,n.screenshotFormat,n.screenshotQuality,n.minScreenshotWidth,n.minScreenshotHeight,n.audioConstraints,n.videoConstraints,n.imageSmoothing,n.mirrored),l=n.style,u=void 0===l?{}:l,h=n.children,d=o(n,["audio","forceScreenshotSourceSize","disablePictureInPicture","onUserMedia","onUserMediaError","screenshotFormat","screenshotQuality","minScreenshotWidth","minScreenshotHeight","audioConstraints","videoConstraints","imageSmoothing","mirrored","style","children"]),f=c?i(i({},u),{transform:(u.transform||"")+" scaleX(-1)"}):u,p={getScreenshot:this.getScreenshot.bind(this)};return r.createElement(r.Fragment,null,r.createElement("video",i({autoPlay:!0,disablePictureInPicture:s,src:t.src,muted:!a,playsInline:!0,ref:function(t){e.video=t},style:f},d)),h&&h(p))},t.defaultProps={audio:!1,disablePictureInPicture:!1,forceScreenshotSourceSize:!1,imageSmoothing:!0,mirrored:!1,onUserMedia:function(){},onUserMediaError:function(){},screenshotFormat:"image/webp",screenshotQuality:.92},t}(r.Component);t.default=c},react:function(t,n){t.exports=e}}).default},e.exports=r(n(9950))},2049:(e,t)=>{"use strict";var n=Symbol.for("react.element"),r=Symbol.for("react.portal"),a=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),o=Symbol.for("react.profiler"),s=Symbol.for("react.provider"),c=Symbol.for("react.context"),l=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),f=Symbol.iterator;var p={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},m=Object.assign,g={};function v(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||p}function b(){}function y(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||p}v.prototype.isReactComponent={},v.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},v.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},b.prototype=v.prototype;var x=y.prototype=new b;x.constructor=y,m(x,v.prototype),x.isPureReactComponent=!0;var w=Array.isArray,k=Object.prototype.hasOwnProperty,S={current:null},N={key:!0,ref:!0,__self:!0,__source:!0};function C(e,t,r){var a,i={},o=null,s=null;if(null!=t)for(a in void 0!==t.ref&&(s=t.ref),void 0!==t.key&&(o=""+t.key),t)k.call(t,a)&&!N.hasOwnProperty(a)&&(i[a]=t[a]);var c=arguments.length-2;if(1===c)i.children=r;else if(1<c){for(var l=Array(c),u=0;u<c;u++)l[u]=arguments[u+2];i.children=l}if(e&&e.defaultProps)for(a in c=e.defaultProps)void 0===i[a]&&(i[a]=c[a]);return{$$typeof:n,type:e,key:o,ref:s,props:i,_owner:S.current}}function E(e){return"object"===typeof e&&null!==e&&e.$$typeof===n}var I=/\/+/g;function T(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(e){return t[e]})}(""+e.key):t.toString(36)}function _(e,t,a,i,o){var s=typeof e;"undefined"!==s&&"boolean"!==s||(e=null);var c=!1;if(null===e)c=!0;else switch(s){case"string":case"number":c=!0;break;case"object":switch(e.$$typeof){case n:case r:c=!0}}if(c)return o=o(c=e),e=""===i?"."+T(c,0):i,w(o)?(a="",null!=e&&(a=e.replace(I,"$&/")+"/"),_(o,t,a,"",function(e){return e})):null!=o&&(E(o)&&(o=function(e,t){return{$$typeof:n,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(o,a+(!o.key||c&&c.key===o.key?"":(""+o.key).replace(I,"$&/")+"/")+e)),t.push(o)),1;if(c=0,i=""===i?".":i+":",w(e))for(var l=0;l<e.length;l++){var u=i+T(s=e[l],l);c+=_(s,t,a,u,o)}else if(u=function(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=f&&e[f]||e["@@iterator"])?e:null}(e),"function"===typeof u)for(e=u.call(e),l=0;!(s=e.next()).done;)c+=_(s=s.value,t,a,u=i+T(s,l++),o);else if("object"===s)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return c}function A(e,t,n){if(null==e)return e;var r=[],a=0;return _(e,r,"","",function(e){return t.call(n,e,a++)}),r}function R(e){if(-1===e._status){var t=e._result;(t=t()).then(function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)},function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)}),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var F={current:null},D={transition:null},O={ReactCurrentDispatcher:F,ReactCurrentBatchConfig:D,ReactCurrentOwner:S};function L(){throw Error("act(...) is not supported in production builds of React.")}t.Children={map:A,forEach:function(e,t,n){A(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return A(e,function(){t++}),t},toArray:function(e){return A(e,function(e){return e})||[]},only:function(e){if(!E(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=v,t.Fragment=a,t.Profiler=o,t.PureComponent=y,t.StrictMode=i,t.Suspense=u,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=O,t.act=L,t.cloneElement=function(e,t,r){if(null===e||void 0===e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var a=m({},e.props),i=e.key,o=e.ref,s=e._owner;if(null!=t){if(void 0!==t.ref&&(o=t.ref,s=S.current),void 0!==t.key&&(i=""+t.key),e.type&&e.type.defaultProps)var c=e.type.defaultProps;for(l in t)k.call(t,l)&&!N.hasOwnProperty(l)&&(a[l]=void 0===t[l]&&void 0!==c?c[l]:t[l])}var l=arguments.length-2;if(1===l)a.children=r;else if(1<l){c=Array(l);for(var u=0;u<l;u++)c[u]=arguments[u+2];a.children=c}return{$$typeof:n,type:e.type,key:i,ref:o,props:a,_owner:s}},t.createContext=function(e){return(e={$$typeof:c,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:s,_context:e},e.Consumer=e},t.createElement=C,t.createFactory=function(e){var t=C.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:l,render:e}},t.isValidElement=E,t.lazy=function(e){return{$$typeof:d,_payload:{_status:-1,_result:e},_init:R}},t.memo=function(e,t){return{$$typeof:h,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=D.transition;D.transition={};try{e()}finally{D.transition=t}},t.unstable_act=L,t.useCallback=function(e,t){return F.current.useCallback(e,t)},t.useContext=function(e){return F.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return F.current.useDeferredValue(e)},t.useEffect=function(e,t){return F.current.useEffect(e,t)},t.useId=function(){return F.current.useId()},t.useImperativeHandle=function(e,t,n){return F.current.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return F.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return F.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return F.current.useMemo(e,t)},t.useReducer=function(e,t,n){return F.current.useReducer(e,t,n)},t.useRef=function(e){return F.current.useRef(e)},t.useState=function(e){return F.current.useState(e)},t.useSyncExternalStore=function(e,t,n){return F.current.useSyncExternalStore(e,t,n)},t.useTransition=function(){return F.current.useTransition()},t.version="18.3.1"},2284:(e,t,n)=>{"use strict";function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}n.d(t,{A:()=>r})},2583:function(e,t,n){var r;!function(a,i,o){var s,c=256,l=o.pow(c,6),u=o.pow(2,52),h=2*u,d=255;function f(e,t,n){var r=[],d=v(g((t=1==t?{entropy:!0}:t||{}).entropy?[e,b(i)]:null==e?function(){try{var e;return s&&(e=s.randomBytes)?e=e(c):(e=new Uint8Array(c),(a.crypto||a.msCrypto).getRandomValues(e)),b(e)}catch(r){var t=a.navigator,n=t&&t.plugins;return[+new Date,a,n,a.screen,b(i)]}}():e,3),r),f=new p(r),y=function(){for(var e=f.g(6),t=l,n=0;e<u;)e=(e+n)*c,t*=c,n=f.g(1);for(;e>=h;)e/=2,t/=2,n>>>=1;return(e+n)/t};return y.int32=function(){return 0|f.g(4)},y.quick=function(){return f.g(4)/4294967296},y.double=y,v(b(f.S),i),(t.pass||n||function(e,t,n,r){return r&&(r.S&&m(r,f),e.state=function(){return m(f,{})}),n?(o.random=e,t):e})(y,d,"global"in t?t.global:this==o,t.state)}function p(e){var t,n=e.length,r=this,a=0,i=r.i=r.j=0,o=r.S=[];for(n||(e=[n++]);a<c;)o[a]=a++;for(a=0;a<c;a++)o[a]=o[i=d&i+e[a%n]+(t=o[a])],o[i]=t;(r.g=function(e){for(var t,n=0,a=r.i,i=r.j,o=r.S;e--;)t=o[a=d&a+1],n=n*c+o[d&(o[a]=o[i=d&i+t])+(o[i]=t)];return r.i=a,r.j=i,n})(c)}function m(e,t){return t.i=e.i,t.j=e.j,t.S=e.S.slice(),t}function g(e,t){var n,r=[],a=typeof e;if(t&&"object"==a)for(n in e)try{r.push(g(e[n],t-1))}catch(i){}return r.length?r:"string"==a?e:e+"\0"}function v(e,t){for(var n,r=e+"",a=0;a<r.length;)t[d&a]=d&(n^=19*t[d&a])+r.charCodeAt(a++);return b(t)}function b(e){return String.fromCharCode.apply(0,e)}if(v(o.random(),i),e.exports){e.exports=f;try{s=n(1234)}catch(y){}}else void 0===(r=function(){return f}.call(t,n,t,e))||(e.exports=r)}("undefined"!==typeof self?self:this,[],Math)},2654:(e,t,n)=>{"use strict";var r=n(9950),a=Symbol.for("react.element"),i=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,s=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,c={key:!0,ref:!0,__self:!0,__source:!0};function l(e,t,n){var r,i={},l=null,u=null;for(r in void 0!==n&&(l=""+n),void 0!==t.key&&(l=""+t.key),void 0!==t.ref&&(u=t.ref),t)o.call(t,r)&&!c.hasOwnProperty(r)&&(i[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===i[r]&&(i[r]=t[r]);return{$$typeof:a,type:e,key:l,ref:u,props:i,_owner:s.current}}t.Fragment=i,t.jsx=l,t.jsxs=l},2658:function(e,t,n){var r;!function(e,a){function i(e){var t=this,n=function(){var e=4022871197,t=function(t){t=String(t);for(var n=0;n<t.length;n++){var r=.02519603282416938*(e+=t.charCodeAt(n));r-=e=r>>>0,e=(r*=e)>>>0,e+=4294967296*(r-=e)}return 2.3283064365386963e-10*(e>>>0)};return t}();t.next=function(){var e=2091639*t.s0+2.3283064365386963e-10*t.c;return t.s0=t.s1,t.s1=t.s2,t.s2=e-(t.c=0|e)},t.c=1,t.s0=n(" "),t.s1=n(" "),t.s2=n(" "),t.s0-=n(e),t.s0<0&&(t.s0+=1),t.s1-=n(e),t.s1<0&&(t.s1+=1),t.s2-=n(e),t.s2<0&&(t.s2+=1),n=null}function o(e,t){return t.c=e.c,t.s0=e.s0,t.s1=e.s1,t.s2=e.s2,t}function s(e,t){var n=new i(e),r=t&&t.state,a=n.next;return a.int32=function(){return 4294967296*n.next()|0},a.double=function(){return a()+11102230246251565e-32*(2097152*a()|0)},a.quick=a,r&&("object"==typeof r&&o(r,n),a.state=function(){return o(n,{})}),a}a&&a.exports?a.exports=s:n.amdD&&n.amdO?void 0===(r=function(){return s}.call(t,n,t,a))||(a.exports=r):this.alea=s}(0,e=n.nmd(e),n.amdD)},2855:function(e,t,n){var r;!function(e,a){function i(e){var t=this,n="";t.next=function(){var e=t.b,n=t.c,r=t.d,a=t.a;return e=e<<25^e>>>7^n,n=n-r|0,r=r<<24^r>>>8^a,a=a-e|0,t.b=e=e<<20^e>>>12^n,t.c=n=n-r|0,t.d=r<<16^n>>>16^a,t.a=a-e|0},t.a=0,t.b=0,t.c=-1640531527,t.d=1367130551,e===Math.floor(e)?(t.a=e/4294967296|0,t.b=0|e):n+=e;for(var r=0;r<n.length+20;r++)t.b^=0|n.charCodeAt(r),t.next()}function o(e,t){return t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t}function s(e,t){var n=new i(e),r=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,r&&("object"==typeof r&&o(r,n),a.state=function(){return o(n,{})}),a}a&&a.exports?a.exports=s:n.amdD&&n.amdO?void 0===(r=function(){return s}.call(t,n,t,a))||(a.exports=r):this.tychei=s}(0,e=n.nmd(e),n.amdD)},3271:function(e,t,n){var r;!function(e,a){function i(e){var t=this,n="";t.x=0,t.y=0,t.z=0,t.w=0,t.next=function(){var e=t.x^t.x<<11;return t.x=t.y,t.y=t.z,t.z=t.w,t.w^=t.w>>>19^e^e>>>8},e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),t.next()}function o(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t}function s(e,t){var n=new i(e),r=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,r&&("object"==typeof r&&o(r,n),a.state=function(){return o(n,{})}),a}a&&a.exports?a.exports=s:n.amdD&&n.amdO?void 0===(r=function(){return s}.call(t,n,t,a))||(a.exports=r):this.xor128=s}(0,e=n.nmd(e),n.amdD)},3886:()=>{},4281:function(e,t,n){var r;!function(e,a){function i(e){var t=this;t.next=function(){var e,n,r=t.x,a=t.i;return e=r[a],n=(e^=e>>>7)^e<<24,n^=(e=r[a+1&7])^e>>>10,n^=(e=r[a+3&7])^e>>>3,n^=(e=r[a+4&7])^e<<7,e=r[a+7&7],n^=(e^=e<<13)^e<<9,r[a]=n,t.i=a+1&7,n},function(e,t){var n,r=[];if(t===(0|t))r[0]=t;else for(t=""+t,n=0;n<t.length;++n)r[7&n]=r[7&n]<<15^t.charCodeAt(n)+r[n+1&7]<<13;for(;r.length<8;)r.push(0);for(n=0;n<8&&0===r[n];++n);for(8==n?r[7]=-1:r[n],e.x=r,e.i=0,n=256;n>0;--n)e.next()}(t,e)}function o(e,t){return t.x=e.x.slice(),t.i=e.i,t}function s(e,t){null==e&&(e=+new Date);var n=new i(e),r=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,r&&(r.x&&o(r,n),a.state=function(){return o(n,{})}),a}a&&a.exports?a.exports=s:n.amdD&&n.amdO?void 0===(r=function(){return s}.call(t,n,t,a))||(a.exports=r):this.xorshift7=s}(0,e=n.nmd(e),n.amdD)},4414:(e,t,n)=>{"use strict";e.exports=n(2654)},4530:()=>{},4647:function(e,t,n){var r;!function(e,a){function i(e){var t=this;t.next=function(){var e,n,r=t.w,a=t.X,i=t.i;return t.w=r=r+1640531527|0,n=a[i+34&127],e=a[i=i+1&127],n^=n<<13,e^=e<<17,n^=n>>>15,e^=e>>>12,n=a[i]=n^e,t.i=i,n+(r^r>>>16)|0},function(e,t){var n,r,a,i,o,s=[],c=128;for(t===(0|t)?(r=t,t=null):(t+="\0",r=0,c=Math.max(c,t.length)),a=0,i=-32;i<c;++i)t&&(r^=t.charCodeAt((i+32)%t.length)),0===i&&(o=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,i>=0&&(o=o+1640531527|0,a=0==(n=s[127&i]^=r+o)?a+1:0);for(a>=128&&(s[127&(t&&t.length||0)]=-1),a=127,i=512;i>0;--i)r=s[a+34&127],n=s[a=a+1&127],r^=r<<13,n^=n<<17,r^=r>>>15,n^=n>>>12,s[a]=r^n;e.w=o,e.X=s,e.i=a}(t,e)}function o(e,t){return t.i=e.i,t.w=e.w,t.X=e.X.slice(),t}function s(e,t){null==e&&(e=+new Date);var n=new i(e),r=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,r&&(r.X&&o(r,n),a.state=function(){return o(n,{})}),a}a&&a.exports?a.exports=s:n.amdD&&n.amdO?void 0===(r=function(){return s}.call(t,n,t,a))||(a.exports=r):this.xor4096=s}(0,e=n.nmd(e),n.amdD)},4980:(e,t,n)=>{"use strict";n.d(t,{A:()=>i});var r=n(2284);function a(e){var t=function(e,t){if("object"!=(0,r.A)(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var a=n.call(e,t||"default");if("object"!=(0,r.A)(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==(0,r.A)(t)?t:t+""}function i(e,t,n){return(t=a(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}},5340:(e,t,n)=>{"use strict";e.exports=n(1761)},5817:()=>{},7119:(e,t,n)=>{"use strict";!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(8345)},8108:()=>{},8345:(e,t,n)=>{"use strict";var r=n(9950),a=n(5340);function i(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var o=new Set,s={};function c(e,t){l(e,t),l(e+"Capture",t)}function l(e,t){for(s[e]=t,e=0;e<t.length;e++)o.add(t[e])}var u=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),h=Object.prototype.hasOwnProperty,d=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,f={},p={};function m(e,t,n,r,a,i,o){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=r,this.attributeNamespace=a,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=i,this.removeEmptyString=o}var g={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){g[e]=new m(e,0,!1,e,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];g[t]=new m(t,1,!1,e[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(e){g[e]=new m(e,2,!1,e.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){g[e]=new m(e,2,!1,e,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){g[e]=new m(e,3,!1,e.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(e){g[e]=new m(e,3,!0,e,null,!1,!1)}),["capture","download"].forEach(function(e){g[e]=new m(e,4,!1,e,null,!1,!1)}),["cols","rows","size","span"].forEach(function(e){g[e]=new m(e,6,!1,e,null,!1,!1)}),["rowSpan","start"].forEach(function(e){g[e]=new m(e,5,!1,e.toLowerCase(),null,!1,!1)});var v=/[\-:]([a-z])/g;function b(e){return e[1].toUpperCase()}function y(e,t,n,r){var a=g.hasOwnProperty(t)?g[t]:null;(null!==a?0!==a.type:r||!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&(function(e,t,n,r){if(null===t||"undefined"===typeof t||function(e,t,n,r){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!r&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,r))return!0;if(r)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,a,r)&&(n=null),r||null===a?function(e){return!!h.call(p,e)||!h.call(f,e)&&(d.test(e)?p[e]=!0:(f[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):a.mustUseProperty?e[a.propertyName]=null===n?3!==a.type&&"":n:(t=a.attributeName,r=a.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(a=a.type)||4===a&&!0===n?"":""+n,r?e.setAttributeNS(r,t,n):e.setAttribute(t,n))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(v,b);g[t]=new m(t,1,!1,e,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(v,b);g[t]=new m(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(v,b);g[t]=new m(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(e){g[e]=new m(e,1,!1,e.toLowerCase(),null,!1,!1)}),g.xlinkHref=new m("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(e){g[e]=new m(e,1,!1,e.toLowerCase(),null,!0,!0)});var x=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,w=Symbol.for("react.element"),k=Symbol.for("react.portal"),S=Symbol.for("react.fragment"),N=Symbol.for("react.strict_mode"),C=Symbol.for("react.profiler"),E=Symbol.for("react.provider"),I=Symbol.for("react.context"),T=Symbol.for("react.forward_ref"),_=Symbol.for("react.suspense"),A=Symbol.for("react.suspense_list"),R=Symbol.for("react.memo"),F=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var D=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var O=Symbol.iterator;function L(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=O&&e[O]||e["@@iterator"])?e:null}var P,M=Object.assign;function j(e){if(void 0===P)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);P=t&&t[1]||""}return"\n"+P+e}var B=!1;function z(e,t){if(!e||B)return"";B=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(l){var r=l}Reflect.construct(e,[],t)}else{try{t.call()}catch(l){r=l}e.call(t.prototype)}else{try{throw Error()}catch(l){r=l}e()}}catch(l){if(l&&r&&"string"===typeof l.stack){for(var a=l.stack.split("\n"),i=r.stack.split("\n"),o=a.length-1,s=i.length-1;1<=o&&0<=s&&a[o]!==i[s];)s--;for(;1<=o&&0<=s;o--,s--)if(a[o]!==i[s]){if(1!==o||1!==s)do{if(o--,0>--s||a[o]!==i[s]){var c="\n"+a[o].replace(" at new "," at ");return e.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",e.displayName)),c}}while(1<=o&&0<=s);break}}}finally{B=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?j(e):""}function U(e){switch(e.tag){case 5:return j(e.type);case 16:return j("Lazy");case 13:return j("Suspense");case 19:return j("SuspenseList");case 0:case 2:case 15:return e=z(e.type,!1);case 11:return e=z(e.type.render,!1);case 1:return e=z(e.type,!0);default:return""}}function W(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case S:return"Fragment";case k:return"Portal";case C:return"Profiler";case N:return"StrictMode";case _:return"Suspense";case A:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case I:return(e.displayName||"Context")+".Consumer";case E:return(e._context.displayName||"Context")+".Provider";case T:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case R:return null!==(t=e.displayName||null)?t:W(e.type)||"Memo";case F:t=e._payload,e=e._init;try{return W(e(t))}catch(n){}}return null}function V(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return W(t);case 8:return t===N?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"===typeof t)return t.displayName||t.name||null;if("string"===typeof t)return t}return null}function H(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function G(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function q(e){e._valueTracker||(e._valueTracker=function(e){var t=G(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof n&&"function"===typeof n.get&&"function"===typeof n.set){var a=n.get,i=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return a.call(this)},set:function(e){r=""+e,i.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(e){r=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function K(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=G(e)?e.checked?"true":"false":e.value),(e=r)!==n&&(t.setValue(e),!0)}function X(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function Y(e,t){var n=t.checked;return M({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function $(e,t){var n=null==t.defaultValue?"":t.defaultValue,r=null!=t.checked?t.checked:t.defaultChecked;n=H(null!=t.value?t.value:n),e._wrapperState={initialChecked:r,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function J(e,t){null!=(t=t.checked)&&y(e,"checked",t,!1)}function Q(e,t){J(e,t);var n=H(t.value),r=t.type;if(null!=n)"number"===r?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===r||"reset"===r)return void e.removeAttribute("value");t.hasOwnProperty("value")?ee(e,t.type,n):t.hasOwnProperty("defaultValue")&&ee(e,t.type,H(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function Z(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!("submit"!==r&&"reset"!==r||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function ee(e,t,n){"number"===t&&X(e.ownerDocument)===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var te=Array.isArray;function ne(e,t,n,r){if(e=e.options,t){t={};for(var a=0;a<n.length;a++)t["$"+n[a]]=!0;for(n=0;n<e.length;n++)a=t.hasOwnProperty("$"+e[n].value),e[n].selected!==a&&(e[n].selected=a),a&&r&&(e[n].defaultSelected=!0)}else{for(n=""+H(n),t=null,a=0;a<e.length;a++){if(e[a].value===n)return e[a].selected=!0,void(r&&(e[a].defaultSelected=!0));null!==t||e[a].disabled||(t=e[a])}null!==t&&(t.selected=!0)}}function re(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(i(91));return M({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function ae(e,t){var n=t.value;if(null==n){if(n=t.children,t=t.defaultValue,null!=n){if(null!=t)throw Error(i(92));if(te(n)){if(1<n.length)throw Error(i(93));n=n[0]}t=n}null==t&&(t=""),n=t}e._wrapperState={initialValue:H(n)}}function ie(e,t){var n=H(t.value),r=H(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=r&&(e.defaultValue=""+r)}function oe(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}function se(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function ce(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?se(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var le,ue,he=(ue=function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((le=le||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=le.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,n,r){MSApp.execUnsafeLocalFunction(function(){return ue(e,t)})}:ue);function de(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var fe={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},pe=["Webkit","ms","Moz","O"];function me(e,t,n){return null==t||"boolean"===typeof t||""===t?"":n||"number"!==typeof t||0===t||fe.hasOwnProperty(e)&&fe[e]?(""+t).trim():t+"px"}function ge(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var r=0===n.indexOf("--"),a=me(n,t[n],r);"float"===n&&(n="cssFloat"),r?e.setProperty(n,a):e[n]=a}}Object.keys(fe).forEach(function(e){pe.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),fe[t]=fe[e]})});var ve=M({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function be(e,t){if(t){if(ve[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(i(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(i(60));if("object"!==typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(i(61))}if(null!=t.style&&"object"!==typeof t.style)throw Error(i(62))}}function ye(e,t){if(-1===e.indexOf("-"))return"string"===typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var xe=null;function we(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var ke=null,Se=null,Ne=null;function Ce(e){if(e=ya(e)){if("function"!==typeof ke)throw Error(i(280));var t=e.stateNode;t&&(t=wa(t),ke(e.stateNode,e.type,t))}}function Ee(e){Se?Ne?Ne.push(e):Ne=[e]:Se=e}function Ie(){if(Se){var e=Se,t=Ne;if(Ne=Se=null,Ce(e),t)for(e=0;e<t.length;e++)Ce(t[e])}}function Te(e,t){return e(t)}function _e(){}var Ae=!1;function Re(e,t,n){if(Ae)return e(t,n);Ae=!0;try{return Te(e,t,n)}finally{Ae=!1,(null!==Se||null!==Ne)&&(_e(),Ie())}}function Fe(e,t){var n=e.stateNode;if(null===n)return null;var r=wa(n);if(null===r)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(r=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!r;break e;default:e=!1}if(e)return null;if(n&&"function"!==typeof n)throw Error(i(231,t,typeof n));return n}var De=!1;if(u)try{var Oe={};Object.defineProperty(Oe,"passive",{get:function(){De=!0}}),window.addEventListener("test",Oe,Oe),window.removeEventListener("test",Oe,Oe)}catch(ue){De=!1}function Le(e,t,n,r,a,i,o,s,c){var l=Array.prototype.slice.call(arguments,3);try{t.apply(n,l)}catch(u){this.onError(u)}}var Pe=!1,Me=null,je=!1,Be=null,ze={onError:function(e){Pe=!0,Me=e}};function Ue(e,t,n,r,a,i,o,s,c){Pe=!1,Me=null,Le.apply(ze,arguments)}function We(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function Ve(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function He(e){if(We(e)!==e)throw Error(i(188))}function Ge(e){return null!==(e=function(e){var t=e.alternate;if(!t){if(null===(t=We(e)))throw Error(i(188));return t!==e?null:e}for(var n=e,r=t;;){var a=n.return;if(null===a)break;var o=a.alternate;if(null===o){if(null!==(r=a.return)){n=r;continue}break}if(a.child===o.child){for(o=a.child;o;){if(o===n)return He(a),e;if(o===r)return He(a),t;o=o.sibling}throw Error(i(188))}if(n.return!==r.return)n=a,r=o;else{for(var s=!1,c=a.child;c;){if(c===n){s=!0,n=a,r=o;break}if(c===r){s=!0,r=a,n=o;break}c=c.sibling}if(!s){for(c=o.child;c;){if(c===n){s=!0,n=o,r=a;break}if(c===r){s=!0,r=o,n=a;break}c=c.sibling}if(!s)throw Error(i(189))}}if(n.alternate!==r)throw Error(i(190))}if(3!==n.tag)throw Error(i(188));return n.stateNode.current===n?e:t}(e))?qe(e):null}function qe(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=qe(e);if(null!==t)return t;e=e.sibling}return null}var Ke=a.unstable_scheduleCallback,Xe=a.unstable_cancelCallback,Ye=a.unstable_shouldYield,$e=a.unstable_requestPaint,Je=a.unstable_now,Qe=a.unstable_getCurrentPriorityLevel,Ze=a.unstable_ImmediatePriority,et=a.unstable_UserBlockingPriority,tt=a.unstable_NormalPriority,nt=a.unstable_LowPriority,rt=a.unstable_IdlePriority,at=null,it=null;var ot=Math.clz32?Math.clz32:function(e){return e>>>=0,0===e?32:31-(st(e)/ct|0)|0},st=Math.log,ct=Math.LN2;var lt=64,ut=4194304;function ht(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function dt(e,t){var n=e.pendingLanes;if(0===n)return 0;var r=0,a=e.suspendedLanes,i=e.pingedLanes,o=268435455&n;if(0!==o){var s=o&~a;0!==s?r=ht(s):0!==(i&=o)&&(r=ht(i))}else 0!==(o=n&~a)?r=ht(o):0!==i&&(r=ht(i));if(0===r)return 0;if(0!==t&&t!==r&&0===(t&a)&&((a=r&-r)>=(i=t&-t)||16===a&&0!==(4194240&i)))return t;if(0!==(4&r)&&(r|=16&n),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=r;0<t;)a=1<<(n=31-ot(t)),r|=e[n],t&=~a;return r}function ft(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function pt(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function mt(){var e=lt;return 0===(4194240&(lt<<=1))&&(lt=64),e}function gt(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function vt(e,t,n){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-ot(t)]=n}function bt(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var r=31-ot(n),a=1<<r;a&t|e[r]&t&&(e[r]|=t),n&=~a}}var yt=0;function xt(e){return 1<(e&=-e)?4<e?0!==(268435455&e)?16:536870912:4:1}var wt,kt,St,Nt,Ct,Et=!1,It=[],Tt=null,_t=null,At=null,Rt=new Map,Ft=new Map,Dt=[],Ot="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Lt(e,t){switch(e){case"focusin":case"focusout":Tt=null;break;case"dragenter":case"dragleave":_t=null;break;case"mouseover":case"mouseout":At=null;break;case"pointerover":case"pointerout":Rt.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ft.delete(t.pointerId)}}function Pt(e,t,n,r,a,i){return null===e||e.nativeEvent!==i?(e={blockedOn:t,domEventName:n,eventSystemFlags:r,nativeEvent:i,targetContainers:[a]},null!==t&&(null!==(t=ya(t))&&kt(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,null!==a&&-1===t.indexOf(a)&&t.push(a),e)}function Mt(e){var t=ba(e.target);if(null!==t){var n=We(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=Ve(n)))return e.blockedOn=t,void Ct(e.priority,function(){St(n)})}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function jt(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=Yt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n)return null!==(t=ya(n))&&kt(t),e.blockedOn=n,!1;var r=new(n=e.nativeEvent).constructor(n.type,n);xe=r,n.target.dispatchEvent(r),xe=null,t.shift()}return!0}function Bt(e,t,n){jt(e)&&n.delete(t)}function zt(){Et=!1,null!==Tt&&jt(Tt)&&(Tt=null),null!==_t&&jt(_t)&&(_t=null),null!==At&&jt(At)&&(At=null),Rt.forEach(Bt),Ft.forEach(Bt)}function Ut(e,t){e.blockedOn===t&&(e.blockedOn=null,Et||(Et=!0,a.unstable_scheduleCallback(a.unstable_NormalPriority,zt)))}function Wt(e){function t(t){return Ut(t,e)}if(0<It.length){Ut(It[0],e);for(var n=1;n<It.length;n++){var r=It[n];r.blockedOn===e&&(r.blockedOn=null)}}for(null!==Tt&&Ut(Tt,e),null!==_t&&Ut(_t,e),null!==At&&Ut(At,e),Rt.forEach(t),Ft.forEach(t),n=0;n<Dt.length;n++)(r=Dt[n]).blockedOn===e&&(r.blockedOn=null);for(;0<Dt.length&&null===(n=Dt[0]).blockedOn;)Mt(n),null===n.blockedOn&&Dt.shift()}var Vt=x.ReactCurrentBatchConfig,Ht=!0;function Gt(e,t,n,r){var a=yt,i=Vt.transition;Vt.transition=null;try{yt=1,Kt(e,t,n,r)}finally{yt=a,Vt.transition=i}}function qt(e,t,n,r){var a=yt,i=Vt.transition;Vt.transition=null;try{yt=4,Kt(e,t,n,r)}finally{yt=a,Vt.transition=i}}function Kt(e,t,n,r){if(Ht){var a=Yt(e,t,n,r);if(null===a)Hr(e,t,r,Xt,n),Lt(e,r);else if(function(e,t,n,r,a){switch(t){case"focusin":return Tt=Pt(Tt,e,t,n,r,a),!0;case"dragenter":return _t=Pt(_t,e,t,n,r,a),!0;case"mouseover":return At=Pt(At,e,t,n,r,a),!0;case"pointerover":var i=a.pointerId;return Rt.set(i,Pt(Rt.get(i)||null,e,t,n,r,a)),!0;case"gotpointercapture":return i=a.pointerId,Ft.set(i,Pt(Ft.get(i)||null,e,t,n,r,a)),!0}return!1}(a,e,t,n,r))r.stopPropagation();else if(Lt(e,r),4&t&&-1<Ot.indexOf(e)){for(;null!==a;){var i=ya(a);if(null!==i&&wt(i),null===(i=Yt(e,t,n,r))&&Hr(e,t,r,Xt,n),i===a)break;a=i}null!==a&&r.stopPropagation()}else Hr(e,t,r,null,n)}}var Xt=null;function Yt(e,t,n,r){if(Xt=null,null!==(e=ba(e=we(r))))if(null===(t=We(e)))e=null;else if(13===(n=t.tag)){if(null!==(e=Ve(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Xt=e,null}function $t(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Qe()){case Ze:return 1;case et:return 4;case tt:case nt:return 16;case rt:return 536870912;default:return 16}default:return 16}}var Jt=null,Qt=null,Zt=null;function en(){if(Zt)return Zt;var e,t,n=Qt,r=n.length,a="value"in Jt?Jt.value:Jt.textContent,i=a.length;for(e=0;e<r&&n[e]===a[e];e++);var o=r-e;for(t=1;t<=o&&n[r-t]===a[i-t];t++);return Zt=a.slice(e,1<t?1-t:void 0)}function tn(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function nn(){return!0}function rn(){return!1}function an(e){function t(t,n,r,a,i){for(var o in this._reactName=t,this._targetInst=r,this.type=n,this.nativeEvent=a,this.target=i,this.currentTarget=null,e)e.hasOwnProperty(o)&&(t=e[o],this[o]=t?t(a):a[o]);return this.isDefaultPrevented=(null!=a.defaultPrevented?a.defaultPrevented:!1===a.returnValue)?nn:rn,this.isPropagationStopped=rn,this}return M(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=nn)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=nn)},persist:function(){},isPersistent:nn}),t}var on,sn,cn,ln={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},un=an(ln),hn=M({},ln,{view:0,detail:0}),dn=an(hn),fn=M({},hn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Cn,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==cn&&(cn&&"mousemove"===e.type?(on=e.screenX-cn.screenX,sn=e.screenY-cn.screenY):sn=on=0,cn=e),on)},movementY:function(e){return"movementY"in e?e.movementY:sn}}),pn=an(fn),mn=an(M({},fn,{dataTransfer:0})),gn=an(M({},hn,{relatedTarget:0})),vn=an(M({},ln,{animationName:0,elapsedTime:0,pseudoElement:0})),bn=M({},ln,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),yn=an(bn),xn=an(M({},ln,{data:0})),wn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},kn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Sn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Nn(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=Sn[e])&&!!t[e]}function Cn(){return Nn}var En=M({},hn,{key:function(e){if(e.key){var t=wn[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=tn(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?kn[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Cn,charCode:function(e){return"keypress"===e.type?tn(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?tn(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),In=an(En),Tn=an(M({},fn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),_n=an(M({},hn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Cn})),An=an(M({},ln,{propertyName:0,elapsedTime:0,pseudoElement:0})),Rn=M({},fn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Fn=an(Rn),Dn=[9,13,27,32],On=u&&"CompositionEvent"in window,Ln=null;u&&"documentMode"in document&&(Ln=document.documentMode);var Pn=u&&"TextEvent"in window&&!Ln,Mn=u&&(!On||Ln&&8<Ln&&11>=Ln),jn=String.fromCharCode(32),Bn=!1;function zn(e,t){switch(e){case"keyup":return-1!==Dn.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Un(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var Wn=!1;var Vn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Hn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Vn[e.type]:"textarea"===t}function Gn(e,t,n,r){Ee(r),0<(t=qr(t,"onChange")).length&&(n=new un("onChange","change",null,n,r),e.push({event:n,listeners:t}))}var qn=null,Kn=null;function Xn(e){jr(e,0)}function Yn(e){if(K(xa(e)))return e}function $n(e,t){if("change"===e)return t}var Jn=!1;if(u){var Qn;if(u){var Zn="oninput"in document;if(!Zn){var er=document.createElement("div");er.setAttribute("oninput","return;"),Zn="function"===typeof er.oninput}Qn=Zn}else Qn=!1;Jn=Qn&&(!document.documentMode||9<document.documentMode)}function tr(){qn&&(qn.detachEvent("onpropertychange",nr),Kn=qn=null)}function nr(e){if("value"===e.propertyName&&Yn(Kn)){var t=[];Gn(t,Kn,e,we(e)),Re(Xn,t)}}function rr(e,t,n){"focusin"===e?(tr(),Kn=n,(qn=t).attachEvent("onpropertychange",nr)):"focusout"===e&&tr()}function ar(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Yn(Kn)}function ir(e,t){if("click"===e)return Yn(t)}function or(e,t){if("input"===e||"change"===e)return Yn(t)}var sr="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t};function cr(e,t){if(sr(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var a=n[r];if(!h.call(t,a)||!sr(e[a],t[a]))return!1}return!0}function lr(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function ur(e,t){var n,r=lr(e);for(e=0;r;){if(3===r.nodeType){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=lr(r)}}function hr(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?hr(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function dr(){for(var e=window,t=X();t instanceof e.HTMLIFrameElement;){try{var n="string"===typeof t.contentWindow.location.href}catch(r){n=!1}if(!n)break;t=X((e=t.contentWindow).document)}return t}function fr(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function pr(e){var t=dr(),n=e.focusedElem,r=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&hr(n.ownerDocument.documentElement,n)){if(null!==r&&fr(n))if(t=r.start,void 0===(e=r.end)&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if((e=(t=n.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var a=n.textContent.length,i=Math.min(r.start,a);r=void 0===r.end?i:Math.min(r.end,a),!e.extend&&i>r&&(a=r,r=i,i=a),a=ur(n,i);var o=ur(n,r);a&&o&&(1!==e.rangeCount||e.anchorNode!==a.node||e.anchorOffset!==a.offset||e.focusNode!==o.node||e.focusOffset!==o.offset)&&((t=t.createRange()).setStart(a.node,a.offset),e.removeAllRanges(),i>r?(e.addRange(t),e.extend(o.node,o.offset)):(t.setEnd(o.node,o.offset),e.addRange(t)))}for(t=[],e=n;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"===typeof n.focus&&n.focus(),n=0;n<t.length;n++)(e=t[n]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var mr=u&&"documentMode"in document&&11>=document.documentMode,gr=null,vr=null,br=null,yr=!1;function xr(e,t,n){var r=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;yr||null==gr||gr!==X(r)||("selectionStart"in(r=gr)&&fr(r)?r={start:r.selectionStart,end:r.selectionEnd}:r={anchorNode:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset},br&&cr(br,r)||(br=r,0<(r=qr(vr,"onSelect")).length&&(t=new un("onSelect","select",null,t,n),e.push({event:t,listeners:r}),t.target=gr)))}function wr(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var kr={animationend:wr("Animation","AnimationEnd"),animationiteration:wr("Animation","AnimationIteration"),animationstart:wr("Animation","AnimationStart"),transitionend:wr("Transition","TransitionEnd")},Sr={},Nr={};function Cr(e){if(Sr[e])return Sr[e];if(!kr[e])return e;var t,n=kr[e];for(t in n)if(n.hasOwnProperty(t)&&t in Nr)return Sr[e]=n[t];return e}u&&(Nr=document.createElement("div").style,"AnimationEvent"in window||(delete kr.animationend.animation,delete kr.animationiteration.animation,delete kr.animationstart.animation),"TransitionEvent"in window||delete kr.transitionend.transition);var Er=Cr("animationend"),Ir=Cr("animationiteration"),Tr=Cr("animationstart"),_r=Cr("transitionend"),Ar=new Map,Rr="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Fr(e,t){Ar.set(e,t),c(t,[e])}for(var Dr=0;Dr<Rr.length;Dr++){var Or=Rr[Dr];Fr(Or.toLowerCase(),"on"+(Or[0].toUpperCase()+Or.slice(1)))}Fr(Er,"onAnimationEnd"),Fr(Ir,"onAnimationIteration"),Fr(Tr,"onAnimationStart"),Fr("dblclick","onDoubleClick"),Fr("focusin","onFocus"),Fr("focusout","onBlur"),Fr(_r,"onTransitionEnd"),l("onMouseEnter",["mouseout","mouseover"]),l("onMouseLeave",["mouseout","mouseover"]),l("onPointerEnter",["pointerout","pointerover"]),l("onPointerLeave",["pointerout","pointerover"]),c("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),c("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),c("onBeforeInput",["compositionend","keypress","textInput","paste"]),c("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),c("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),c("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Lr="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Pr=new Set("cancel close invalid load scroll toggle".split(" ").concat(Lr));function Mr(e,t,n){var r=e.type||"unknown-event";e.currentTarget=n,function(e,t,n,r,a,o,s,c,l){if(Ue.apply(this,arguments),Pe){if(!Pe)throw Error(i(198));var u=Me;Pe=!1,Me=null,je||(je=!0,Be=u)}}(r,t,void 0,e),e.currentTarget=null}function jr(e,t){t=0!==(4&t);for(var n=0;n<e.length;n++){var r=e[n],a=r.event;r=r.listeners;e:{var i=void 0;if(t)for(var o=r.length-1;0<=o;o--){var s=r[o],c=s.instance,l=s.currentTarget;if(s=s.listener,c!==i&&a.isPropagationStopped())break e;Mr(a,s,l),i=c}else for(o=0;o<r.length;o++){if(c=(s=r[o]).instance,l=s.currentTarget,s=s.listener,c!==i&&a.isPropagationStopped())break e;Mr(a,s,l),i=c}}}if(je)throw e=Be,je=!1,Be=null,e}function Br(e,t){var n=t[ma];void 0===n&&(n=t[ma]=new Set);var r=e+"__bubble";n.has(r)||(Vr(t,e,2,!1),n.add(r))}function zr(e,t,n){var r=0;t&&(r|=4),Vr(n,e,r,t)}var Ur="_reactListening"+Math.random().toString(36).slice(2);function Wr(e){if(!e[Ur]){e[Ur]=!0,o.forEach(function(t){"selectionchange"!==t&&(Pr.has(t)||zr(t,!1,e),zr(t,!0,e))});var t=9===e.nodeType?e:e.ownerDocument;null===t||t[Ur]||(t[Ur]=!0,zr("selectionchange",!1,t))}}function Vr(e,t,n,r){switch($t(t)){case 1:var a=Gt;break;case 4:a=qt;break;default:a=Kt}n=a.bind(null,t,n,e),a=void 0,!De||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(a=!0),r?void 0!==a?e.addEventListener(t,n,{capture:!0,passive:a}):e.addEventListener(t,n,!0):void 0!==a?e.addEventListener(t,n,{passive:a}):e.addEventListener(t,n,!1)}function Hr(e,t,n,r,a){var i=r;if(0===(1&t)&&0===(2&t)&&null!==r)e:for(;;){if(null===r)return;var o=r.tag;if(3===o||4===o){var s=r.stateNode.containerInfo;if(s===a||8===s.nodeType&&s.parentNode===a)break;if(4===o)for(o=r.return;null!==o;){var c=o.tag;if((3===c||4===c)&&((c=o.stateNode.containerInfo)===a||8===c.nodeType&&c.parentNode===a))return;o=o.return}for(;null!==s;){if(null===(o=ba(s)))return;if(5===(c=o.tag)||6===c){r=i=o;continue e}s=s.parentNode}}r=r.return}Re(function(){var r=i,a=we(n),o=[];e:{var s=Ar.get(e);if(void 0!==s){var c=un,l=e;switch(e){case"keypress":if(0===tn(n))break e;case"keydown":case"keyup":c=In;break;case"focusin":l="focus",c=gn;break;case"focusout":l="blur",c=gn;break;case"beforeblur":case"afterblur":c=gn;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":c=pn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":c=mn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":c=_n;break;case Er:case Ir:case Tr:c=vn;break;case _r:c=An;break;case"scroll":c=dn;break;case"wheel":c=Fn;break;case"copy":case"cut":case"paste":c=yn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":c=Tn}var u=0!==(4&t),h=!u&&"scroll"===e,d=u?null!==s?s+"Capture":null:s;u=[];for(var f,p=r;null!==p;){var m=(f=p).stateNode;if(5===f.tag&&null!==m&&(f=m,null!==d&&(null!=(m=Fe(p,d))&&u.push(Gr(p,m,f)))),h)break;p=p.return}0<u.length&&(s=new c(s,l,null,n,a),o.push({event:s,listeners:u}))}}if(0===(7&t)){if(c="mouseout"===e||"pointerout"===e,(!(s="mouseover"===e||"pointerover"===e)||n===xe||!(l=n.relatedTarget||n.fromElement)||!ba(l)&&!l[pa])&&(c||s)&&(s=a.window===a?a:(s=a.ownerDocument)?s.defaultView||s.parentWindow:window,c?(c=r,null!==(l=(l=n.relatedTarget||n.toElement)?ba(l):null)&&(l!==(h=We(l))||5!==l.tag&&6!==l.tag)&&(l=null)):(c=null,l=r),c!==l)){if(u=pn,m="onMouseLeave",d="onMouseEnter",p="mouse","pointerout"!==e&&"pointerover"!==e||(u=Tn,m="onPointerLeave",d="onPointerEnter",p="pointer"),h=null==c?s:xa(c),f=null==l?s:xa(l),(s=new u(m,p+"leave",c,n,a)).target=h,s.relatedTarget=f,m=null,ba(a)===r&&((u=new u(d,p+"enter",l,n,a)).target=f,u.relatedTarget=h,m=u),h=m,c&&l)e:{for(d=l,p=0,f=u=c;f;f=Kr(f))p++;for(f=0,m=d;m;m=Kr(m))f++;for(;0<p-f;)u=Kr(u),p--;for(;0<f-p;)d=Kr(d),f--;for(;p--;){if(u===d||null!==d&&u===d.alternate)break e;u=Kr(u),d=Kr(d)}u=null}else u=null;null!==c&&Xr(o,s,c,u,!1),null!==l&&null!==h&&Xr(o,h,l,u,!0)}if("select"===(c=(s=r?xa(r):window).nodeName&&s.nodeName.toLowerCase())||"input"===c&&"file"===s.type)var g=$n;else if(Hn(s))if(Jn)g=or;else{g=ar;var v=rr}else(c=s.nodeName)&&"input"===c.toLowerCase()&&("checkbox"===s.type||"radio"===s.type)&&(g=ir);switch(g&&(g=g(e,r))?Gn(o,g,n,a):(v&&v(e,s,r),"focusout"===e&&(v=s._wrapperState)&&v.controlled&&"number"===s.type&&ee(s,"number",s.value)),v=r?xa(r):window,e){case"focusin":(Hn(v)||"true"===v.contentEditable)&&(gr=v,vr=r,br=null);break;case"focusout":br=vr=gr=null;break;case"mousedown":yr=!0;break;case"contextmenu":case"mouseup":case"dragend":yr=!1,xr(o,n,a);break;case"selectionchange":if(mr)break;case"keydown":case"keyup":xr(o,n,a)}var b;if(On)e:{switch(e){case"compositionstart":var y="onCompositionStart";break e;case"compositionend":y="onCompositionEnd";break e;case"compositionupdate":y="onCompositionUpdate";break e}y=void 0}else Wn?zn(e,n)&&(y="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(y="onCompositionStart");y&&(Mn&&"ko"!==n.locale&&(Wn||"onCompositionStart"!==y?"onCompositionEnd"===y&&Wn&&(b=en()):(Qt="value"in(Jt=a)?Jt.value:Jt.textContent,Wn=!0)),0<(v=qr(r,y)).length&&(y=new xn(y,e,null,n,a),o.push({event:y,listeners:v}),b?y.data=b:null!==(b=Un(n))&&(y.data=b))),(b=Pn?function(e,t){switch(e){case"compositionend":return Un(t);case"keypress":return 32!==t.which?null:(Bn=!0,jn);case"textInput":return(e=t.data)===jn&&Bn?null:e;default:return null}}(e,n):function(e,t){if(Wn)return"compositionend"===e||!On&&zn(e,t)?(e=en(),Zt=Qt=Jt=null,Wn=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Mn&&"ko"!==t.locale?null:t.data}}(e,n))&&(0<(r=qr(r,"onBeforeInput")).length&&(a=new xn("onBeforeInput","beforeinput",null,n,a),o.push({event:a,listeners:r}),a.data=b))}jr(o,t)})}function Gr(e,t,n){return{instance:e,listener:t,currentTarget:n}}function qr(e,t){for(var n=t+"Capture",r=[];null!==e;){var a=e,i=a.stateNode;5===a.tag&&null!==i&&(a=i,null!=(i=Fe(e,n))&&r.unshift(Gr(e,i,a)),null!=(i=Fe(e,t))&&r.push(Gr(e,i,a))),e=e.return}return r}function Kr(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function Xr(e,t,n,r,a){for(var i=t._reactName,o=[];null!==n&&n!==r;){var s=n,c=s.alternate,l=s.stateNode;if(null!==c&&c===r)break;5===s.tag&&null!==l&&(s=l,a?null!=(c=Fe(n,i))&&o.unshift(Gr(n,c,s)):a||null!=(c=Fe(n,i))&&o.push(Gr(n,c,s))),n=n.return}0!==o.length&&e.push({event:t,listeners:o})}var Yr=/\r\n?/g,$r=/\u0000|\uFFFD/g;function Jr(e){return("string"===typeof e?e:""+e).replace(Yr,"\n").replace($r,"")}function Qr(e,t,n){if(t=Jr(t),Jr(e)!==t&&n)throw Error(i(425))}function Zr(){}var ea=null,ta=null;function na(e,t){return"textarea"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var ra="function"===typeof setTimeout?setTimeout:void 0,aa="function"===typeof clearTimeout?clearTimeout:void 0,ia="function"===typeof Promise?Promise:void 0,oa="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof ia?function(e){return ia.resolve(null).then(e).catch(sa)}:ra;function sa(e){setTimeout(function(){throw e})}function ca(e,t){var n=t,r=0;do{var a=n.nextSibling;if(e.removeChild(n),a&&8===a.nodeType)if("/$"===(n=a.data)){if(0===r)return e.removeChild(a),void Wt(t);r--}else"$"!==n&&"$?"!==n&&"$!"!==n||r++;n=a}while(n);Wt(t)}function la(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t)break;if("/$"===t)return null}}return e}function ua(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}var ha=Math.random().toString(36).slice(2),da="__reactFiber$"+ha,fa="__reactProps$"+ha,pa="__reactContainer$"+ha,ma="__reactEvents$"+ha,ga="__reactListeners$"+ha,va="__reactHandles$"+ha;function ba(e){var t=e[da];if(t)return t;for(var n=e.parentNode;n;){if(t=n[pa]||n[da]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=ua(e);null!==e;){if(n=e[da])return n;e=ua(e)}return t}n=(e=n).parentNode}return null}function ya(e){return!(e=e[da]||e[pa])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function xa(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(i(33))}function wa(e){return e[fa]||null}var ka=[],Sa=-1;function Na(e){return{current:e}}function Ca(e){0>Sa||(e.current=ka[Sa],ka[Sa]=null,Sa--)}function Ea(e,t){Sa++,ka[Sa]=e.current,e.current=t}var Ia={},Ta=Na(Ia),_a=Na(!1),Aa=Ia;function Ra(e,t){var n=e.type.contextTypes;if(!n)return Ia;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var a,i={};for(a in n)i[a]=t[a];return r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=i),i}function Fa(e){return null!==(e=e.childContextTypes)&&void 0!==e}function Da(){Ca(_a),Ca(Ta)}function Oa(e,t,n){if(Ta.current!==Ia)throw Error(i(168));Ea(Ta,t),Ea(_a,n)}function La(e,t,n){var r=e.stateNode;if(t=t.childContextTypes,"function"!==typeof r.getChildContext)return n;for(var a in r=r.getChildContext())if(!(a in t))throw Error(i(108,V(e)||"Unknown",a));return M({},n,r)}function Pa(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Ia,Aa=Ta.current,Ea(Ta,e),Ea(_a,_a.current),!0}function Ma(e,t,n){var r=e.stateNode;if(!r)throw Error(i(169));n?(e=La(e,t,Aa),r.__reactInternalMemoizedMergedChildContext=e,Ca(_a),Ca(Ta),Ea(Ta,e)):Ca(_a),Ea(_a,n)}var ja=null,Ba=!1,za=!1;function Ua(e){null===ja?ja=[e]:ja.push(e)}function Wa(){if(!za&&null!==ja){za=!0;var e=0,t=yt;try{var n=ja;for(yt=1;e<n.length;e++){var r=n[e];do{r=r(!0)}while(null!==r)}ja=null,Ba=!1}catch(a){throw null!==ja&&(ja=ja.slice(e+1)),Ke(Ze,Wa),a}finally{yt=t,za=!1}}return null}var Va=[],Ha=0,Ga=null,qa=0,Ka=[],Xa=0,Ya=null,$a=1,Ja="";function Qa(e,t){Va[Ha++]=qa,Va[Ha++]=Ga,Ga=e,qa=t}function Za(e,t,n){Ka[Xa++]=$a,Ka[Xa++]=Ja,Ka[Xa++]=Ya,Ya=e;var r=$a;e=Ja;var a=32-ot(r)-1;r&=~(1<<a),n+=1;var i=32-ot(t)+a;if(30<i){var o=a-a%5;i=(r&(1<<o)-1).toString(32),r>>=o,a-=o,$a=1<<32-ot(t)+a|n<<a|r,Ja=i+e}else $a=1<<i|n<<a|r,Ja=e}function ei(e){null!==e.return&&(Qa(e,1),Za(e,1,0))}function ti(e){for(;e===Ga;)Ga=Va[--Ha],Va[Ha]=null,qa=Va[--Ha],Va[Ha]=null;for(;e===Ya;)Ya=Ka[--Xa],Ka[Xa]=null,Ja=Ka[--Xa],Ka[Xa]=null,$a=Ka[--Xa],Ka[Xa]=null}var ni=null,ri=null,ai=!1,ii=null;function oi(e,t){var n=Rl(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,null===(t=e.deletions)?(e.deletions=[n],e.flags|=16):t.push(n)}function si(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,ni=e,ri=la(t.firstChild),!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,ni=e,ri=null,!0);case 13:return null!==(t=8!==t.nodeType?null:t)&&(n=null!==Ya?{id:$a,overflow:Ja}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},(n=Rl(18,null,null,0)).stateNode=t,n.return=e,e.child=n,ni=e,ri=null,!0);default:return!1}}function ci(e){return 0!==(1&e.mode)&&0===(128&e.flags)}function li(e){if(ai){var t=ri;if(t){var n=t;if(!si(e,t)){if(ci(e))throw Error(i(418));t=la(n.nextSibling);var r=ni;t&&si(e,t)?oi(r,n):(e.flags=-4097&e.flags|2,ai=!1,ni=e)}}else{if(ci(e))throw Error(i(418));e.flags=-4097&e.flags|2,ai=!1,ni=e}}}function ui(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;ni=e}function hi(e){if(e!==ni)return!1;if(!ai)return ui(e),ai=!0,!1;var t;if((t=3!==e.tag)&&!(t=5!==e.tag)&&(t="head"!==(t=e.type)&&"body"!==t&&!na(e.type,e.memoizedProps)),t&&(t=ri)){if(ci(e))throw di(),Error(i(418));for(;t;)oi(e,t),t=la(t.nextSibling)}if(ui(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(i(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n){if(0===t){ri=la(e.nextSibling);break e}t--}else"$"!==n&&"$!"!==n&&"$?"!==n||t++}e=e.nextSibling}ri=null}}else ri=ni?la(e.stateNode.nextSibling):null;return!0}function di(){for(var e=ri;e;)e=la(e.nextSibling)}function fi(){ri=ni=null,ai=!1}function pi(e){null===ii?ii=[e]:ii.push(e)}var mi=x.ReactCurrentBatchConfig;function gi(e,t,n){if(null!==(e=n.ref)&&"function"!==typeof e&&"object"!==typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(i(309));var r=n.stateNode}if(!r)throw Error(i(147,e));var a=r,o=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===o?t.ref:(t=function(e){var t=a.refs;null===e?delete t[o]:t[o]=e},t._stringRef=o,t)}if("string"!==typeof e)throw Error(i(284));if(!n._owner)throw Error(i(290,e))}return e}function vi(e,t){throw e=Object.prototype.toString.call(t),Error(i(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function bi(e){return(0,e._init)(e._payload)}function yi(e){function t(t,n){if(e){var r=t.deletions;null===r?(t.deletions=[n],t.flags|=16):r.push(n)}}function n(n,r){if(!e)return null;for(;null!==r;)t(n,r),r=r.sibling;return null}function r(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function a(e,t){return(e=Dl(e,t)).index=0,e.sibling=null,e}function o(t,n,r){return t.index=r,e?null!==(r=t.alternate)?(r=r.index)<n?(t.flags|=2,n):r:(t.flags|=2,n):(t.flags|=1048576,n)}function s(t){return e&&null===t.alternate&&(t.flags|=2),t}function c(e,t,n,r){return null===t||6!==t.tag?((t=Ml(n,e.mode,r)).return=e,t):((t=a(t,n)).return=e,t)}function l(e,t,n,r){var i=n.type;return i===S?h(e,t,n.props.children,r,n.key):null!==t&&(t.elementType===i||"object"===typeof i&&null!==i&&i.$$typeof===F&&bi(i)===t.type)?((r=a(t,n.props)).ref=gi(e,t,n),r.return=e,r):((r=Ol(n.type,n.key,n.props,null,e.mode,r)).ref=gi(e,t,n),r.return=e,r)}function u(e,t,n,r){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=jl(n,e.mode,r)).return=e,t):((t=a(t,n.children||[])).return=e,t)}function h(e,t,n,r,i){return null===t||7!==t.tag?((t=Ll(n,e.mode,r,i)).return=e,t):((t=a(t,n)).return=e,t)}function d(e,t,n){if("string"===typeof t&&""!==t||"number"===typeof t)return(t=Ml(""+t,e.mode,n)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case w:return(n=Ol(t.type,t.key,t.props,null,e.mode,n)).ref=gi(e,null,t),n.return=e,n;case k:return(t=jl(t,e.mode,n)).return=e,t;case F:return d(e,(0,t._init)(t._payload),n)}if(te(t)||L(t))return(t=Ll(t,e.mode,n,null)).return=e,t;vi(e,t)}return null}function f(e,t,n,r){var a=null!==t?t.key:null;if("string"===typeof n&&""!==n||"number"===typeof n)return null!==a?null:c(e,t,""+n,r);if("object"===typeof n&&null!==n){switch(n.$$typeof){case w:return n.key===a?l(e,t,n,r):null;case k:return n.key===a?u(e,t,n,r):null;case F:return f(e,t,(a=n._init)(n._payload),r)}if(te(n)||L(n))return null!==a?null:h(e,t,n,r,null);vi(e,n)}return null}function p(e,t,n,r,a){if("string"===typeof r&&""!==r||"number"===typeof r)return c(t,e=e.get(n)||null,""+r,a);if("object"===typeof r&&null!==r){switch(r.$$typeof){case w:return l(t,e=e.get(null===r.key?n:r.key)||null,r,a);case k:return u(t,e=e.get(null===r.key?n:r.key)||null,r,a);case F:return p(e,t,n,(0,r._init)(r._payload),a)}if(te(r)||L(r))return h(t,e=e.get(n)||null,r,a,null);vi(t,r)}return null}function m(a,i,s,c){for(var l=null,u=null,h=i,m=i=0,g=null;null!==h&&m<s.length;m++){h.index>m?(g=h,h=null):g=h.sibling;var v=f(a,h,s[m],c);if(null===v){null===h&&(h=g);break}e&&h&&null===v.alternate&&t(a,h),i=o(v,i,m),null===u?l=v:u.sibling=v,u=v,h=g}if(m===s.length)return n(a,h),ai&&Qa(a,m),l;if(null===h){for(;m<s.length;m++)null!==(h=d(a,s[m],c))&&(i=o(h,i,m),null===u?l=h:u.sibling=h,u=h);return ai&&Qa(a,m),l}for(h=r(a,h);m<s.length;m++)null!==(g=p(h,a,m,s[m],c))&&(e&&null!==g.alternate&&h.delete(null===g.key?m:g.key),i=o(g,i,m),null===u?l=g:u.sibling=g,u=g);return e&&h.forEach(function(e){return t(a,e)}),ai&&Qa(a,m),l}function g(a,s,c,l){var u=L(c);if("function"!==typeof u)throw Error(i(150));if(null==(c=u.call(c)))throw Error(i(151));for(var h=u=null,m=s,g=s=0,v=null,b=c.next();null!==m&&!b.done;g++,b=c.next()){m.index>g?(v=m,m=null):v=m.sibling;var y=f(a,m,b.value,l);if(null===y){null===m&&(m=v);break}e&&m&&null===y.alternate&&t(a,m),s=o(y,s,g),null===h?u=y:h.sibling=y,h=y,m=v}if(b.done)return n(a,m),ai&&Qa(a,g),u;if(null===m){for(;!b.done;g++,b=c.next())null!==(b=d(a,b.value,l))&&(s=o(b,s,g),null===h?u=b:h.sibling=b,h=b);return ai&&Qa(a,g),u}for(m=r(a,m);!b.done;g++,b=c.next())null!==(b=p(m,a,g,b.value,l))&&(e&&null!==b.alternate&&m.delete(null===b.key?g:b.key),s=o(b,s,g),null===h?u=b:h.sibling=b,h=b);return e&&m.forEach(function(e){return t(a,e)}),ai&&Qa(a,g),u}return function e(r,i,o,c){if("object"===typeof o&&null!==o&&o.type===S&&null===o.key&&(o=o.props.children),"object"===typeof o&&null!==o){switch(o.$$typeof){case w:e:{for(var l=o.key,u=i;null!==u;){if(u.key===l){if((l=o.type)===S){if(7===u.tag){n(r,u.sibling),(i=a(u,o.props.children)).return=r,r=i;break e}}else if(u.elementType===l||"object"===typeof l&&null!==l&&l.$$typeof===F&&bi(l)===u.type){n(r,u.sibling),(i=a(u,o.props)).ref=gi(r,u,o),i.return=r,r=i;break e}n(r,u);break}t(r,u),u=u.sibling}o.type===S?((i=Ll(o.props.children,r.mode,c,o.key)).return=r,r=i):((c=Ol(o.type,o.key,o.props,null,r.mode,c)).ref=gi(r,i,o),c.return=r,r=c)}return s(r);case k:e:{for(u=o.key;null!==i;){if(i.key===u){if(4===i.tag&&i.stateNode.containerInfo===o.containerInfo&&i.stateNode.implementation===o.implementation){n(r,i.sibling),(i=a(i,o.children||[])).return=r,r=i;break e}n(r,i);break}t(r,i),i=i.sibling}(i=jl(o,r.mode,c)).return=r,r=i}return s(r);case F:return e(r,i,(u=o._init)(o._payload),c)}if(te(o))return m(r,i,o,c);if(L(o))return g(r,i,o,c);vi(r,o)}return"string"===typeof o&&""!==o||"number"===typeof o?(o=""+o,null!==i&&6===i.tag?(n(r,i.sibling),(i=a(i,o)).return=r,r=i):(n(r,i),(i=Ml(o,r.mode,c)).return=r,r=i),s(r)):n(r,i)}}var xi=yi(!0),wi=yi(!1),ki=Na(null),Si=null,Ni=null,Ci=null;function Ei(){Ci=Ni=Si=null}function Ii(e){var t=ki.current;Ca(ki),e._currentValue=t}function Ti(e,t,n){for(;null!==e;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==r&&(r.childLanes|=t)):null!==r&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===n)break;e=e.return}}function _i(e,t){Si=e,Ci=Ni=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(ys=!0),e.firstContext=null)}function Ai(e){var t=e._currentValue;if(Ci!==e)if(e={context:e,memoizedValue:t,next:null},null===Ni){if(null===Si)throw Error(i(308));Ni=e,Si.dependencies={lanes:0,firstContext:e}}else Ni=Ni.next=e;return t}var Ri=null;function Fi(e){null===Ri?Ri=[e]:Ri.push(e)}function Di(e,t,n,r){var a=t.interleaved;return null===a?(n.next=n,Fi(t)):(n.next=a.next,a.next=n),t.interleaved=n,Oi(e,r)}function Oi(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}var Li=!1;function Pi(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Mi(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function ji(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Bi(e,t,n){var r=e.updateQueue;if(null===r)return null;if(r=r.shared,0!==(2&Tc)){var a=r.pending;return null===a?t.next=t:(t.next=a.next,a.next=t),r.pending=t,Oi(e,n)}return null===(a=r.interleaved)?(t.next=t,Fi(r)):(t.next=a.next,a.next=t),r.interleaved=t,Oi(e,n)}function zi(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194240&n))){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,bt(e,n)}}function Ui(e,t){var n=e.updateQueue,r=e.alternate;if(null!==r&&n===(r=r.updateQueue)){var a=null,i=null;if(null!==(n=n.firstBaseUpdate)){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===i?a=i=o:i=i.next=o,n=n.next}while(null!==n);null===i?a=i=t:i=i.next=t}else a=i=t;return n={baseState:r.baseState,firstBaseUpdate:a,lastBaseUpdate:i,shared:r.shared,effects:r.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function Wi(e,t,n,r){var a=e.updateQueue;Li=!1;var i=a.firstBaseUpdate,o=a.lastBaseUpdate,s=a.shared.pending;if(null!==s){a.shared.pending=null;var c=s,l=c.next;c.next=null,null===o?i=l:o.next=l,o=c;var u=e.alternate;null!==u&&((s=(u=u.updateQueue).lastBaseUpdate)!==o&&(null===s?u.firstBaseUpdate=l:s.next=l,u.lastBaseUpdate=c))}if(null!==i){var h=a.baseState;for(o=0,u=l=c=null,s=i;;){var d=s.lane,f=s.eventTime;if((r&d)===d){null!==u&&(u=u.next={eventTime:f,lane:0,tag:s.tag,payload:s.payload,callback:s.callback,next:null});e:{var p=e,m=s;switch(d=t,f=n,m.tag){case 1:if("function"===typeof(p=m.payload)){h=p.call(f,h,d);break e}h=p;break e;case 3:p.flags=-65537&p.flags|128;case 0:if(null===(d="function"===typeof(p=m.payload)?p.call(f,h,d):p)||void 0===d)break e;h=M({},h,d);break e;case 2:Li=!0}}null!==s.callback&&0!==s.lane&&(e.flags|=64,null===(d=a.effects)?a.effects=[s]:d.push(s))}else f={eventTime:f,lane:d,tag:s.tag,payload:s.payload,callback:s.callback,next:null},null===u?(l=u=f,c=h):u=u.next=f,o|=d;if(null===(s=s.next)){if(null===(s=a.shared.pending))break;s=(d=s).next,d.next=null,a.lastBaseUpdate=d,a.shared.pending=null}}if(null===u&&(c=h),a.baseState=c,a.firstBaseUpdate=l,a.lastBaseUpdate=u,null!==(t=a.shared.interleaved)){a=t;do{o|=a.lane,a=a.next}while(a!==t)}else null===i&&(a.shared.lanes=0);Pc|=o,e.lanes=o,e.memoizedState=h}}function Vi(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var r=e[t],a=r.callback;if(null!==a){if(r.callback=null,r=n,"function"!==typeof a)throw Error(i(191,a));a.call(r)}}}var Hi={},Gi=Na(Hi),qi=Na(Hi),Ki=Na(Hi);function Xi(e){if(e===Hi)throw Error(i(174));return e}function Yi(e,t){switch(Ea(Ki,t),Ea(qi,e),Ea(Gi,Hi),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:ce(null,"");break;default:t=ce(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}Ca(Gi),Ea(Gi,t)}function $i(){Ca(Gi),Ca(qi),Ca(Ki)}function Ji(e){Xi(Ki.current);var t=Xi(Gi.current),n=ce(t,e.type);t!==n&&(Ea(qi,e),Ea(Gi,n))}function Qi(e){qi.current===e&&(Ca(Gi),Ca(qi))}var Zi=Na(0);function eo(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var to=[];function no(){for(var e=0;e<to.length;e++)to[e]._workInProgressVersionPrimary=null;to.length=0}var ro=x.ReactCurrentDispatcher,ao=x.ReactCurrentBatchConfig,io=0,oo=null,so=null,co=null,lo=!1,uo=!1,ho=0,fo=0;function po(){throw Error(i(321))}function mo(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!sr(e[n],t[n]))return!1;return!0}function go(e,t,n,r,a,o){if(io=o,oo=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,ro.current=null===e||null===e.memoizedState?Zo:es,e=n(r,a),uo){o=0;do{if(uo=!1,ho=0,25<=o)throw Error(i(301));o+=1,co=so=null,t.updateQueue=null,ro.current=ts,e=n(r,a)}while(uo)}if(ro.current=Qo,t=null!==so&&null!==so.next,io=0,co=so=oo=null,lo=!1,t)throw Error(i(300));return e}function vo(){var e=0!==ho;return ho=0,e}function bo(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===co?oo.memoizedState=co=e:co=co.next=e,co}function yo(){if(null===so){var e=oo.alternate;e=null!==e?e.memoizedState:null}else e=so.next;var t=null===co?oo.memoizedState:co.next;if(null!==t)co=t,so=e;else{if(null===e)throw Error(i(310));e={memoizedState:(so=e).memoizedState,baseState:so.baseState,baseQueue:so.baseQueue,queue:so.queue,next:null},null===co?oo.memoizedState=co=e:co=co.next=e}return co}function xo(e,t){return"function"===typeof t?t(e):t}function wo(e){var t=yo(),n=t.queue;if(null===n)throw Error(i(311));n.lastRenderedReducer=e;var r=so,a=r.baseQueue,o=n.pending;if(null!==o){if(null!==a){var s=a.next;a.next=o.next,o.next=s}r.baseQueue=a=o,n.pending=null}if(null!==a){o=a.next,r=r.baseState;var c=s=null,l=null,u=o;do{var h=u.lane;if((io&h)===h)null!==l&&(l=l.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),r=u.hasEagerState?u.eagerState:e(r,u.action);else{var d={lane:h,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};null===l?(c=l=d,s=r):l=l.next=d,oo.lanes|=h,Pc|=h}u=u.next}while(null!==u&&u!==o);null===l?s=r:l.next=c,sr(r,t.memoizedState)||(ys=!0),t.memoizedState=r,t.baseState=s,t.baseQueue=l,n.lastRenderedState=r}if(null!==(e=n.interleaved)){a=e;do{o=a.lane,oo.lanes|=o,Pc|=o,a=a.next}while(a!==e)}else null===a&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function ko(e){var t=yo(),n=t.queue;if(null===n)throw Error(i(311));n.lastRenderedReducer=e;var r=n.dispatch,a=n.pending,o=t.memoizedState;if(null!==a){n.pending=null;var s=a=a.next;do{o=e(o,s.action),s=s.next}while(s!==a);sr(o,t.memoizedState)||(ys=!0),t.memoizedState=o,null===t.baseQueue&&(t.baseState=o),n.lastRenderedState=o}return[o,r]}function So(){}function No(e,t){var n=oo,r=yo(),a=t(),o=!sr(r.memoizedState,a);if(o&&(r.memoizedState=a,ys=!0),r=r.queue,Po(Io.bind(null,n,r,e),[e]),r.getSnapshot!==t||o||null!==co&&1&co.memoizedState.tag){if(n.flags|=2048,Ro(9,Eo.bind(null,n,r,a,t),void 0,null),null===_c)throw Error(i(349));0!==(30&io)||Co(n,t,a)}return a}function Co(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=oo.updateQueue)?(t={lastEffect:null,stores:null},oo.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function Eo(e,t,n,r){t.value=n,t.getSnapshot=r,To(t)&&_o(e)}function Io(e,t,n){return n(function(){To(t)&&_o(e)})}function To(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!sr(e,n)}catch(r){return!0}}function _o(e){var t=Oi(e,1);null!==t&&nl(t,e,1,-1)}function Ao(e){var t=bo();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:xo,lastRenderedState:e},t.queue=e,e=e.dispatch=Xo.bind(null,oo,e),[t.memoizedState,e]}function Ro(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},null===(t=oo.updateQueue)?(t={lastEffect:null,stores:null},oo.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e),e}function Fo(){return yo().memoizedState}function Do(e,t,n,r){var a=bo();oo.flags|=e,a.memoizedState=Ro(1|t,n,void 0,void 0===r?null:r)}function Oo(e,t,n,r){var a=yo();r=void 0===r?null:r;var i=void 0;if(null!==so){var o=so.memoizedState;if(i=o.destroy,null!==r&&mo(r,o.deps))return void(a.memoizedState=Ro(t,n,i,r))}oo.flags|=e,a.memoizedState=Ro(1|t,n,i,r)}function Lo(e,t){return Do(8390656,8,e,t)}function Po(e,t){return Oo(2048,8,e,t)}function Mo(e,t){return Oo(4,2,e,t)}function jo(e,t){return Oo(4,4,e,t)}function Bo(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function zo(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Oo(4,4,Bo.bind(null,t,e),n)}function Uo(){}function Wo(e,t){var n=yo();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&mo(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function Vo(e,t){var n=yo();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&mo(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)}function Ho(e,t,n){return 0===(21&io)?(e.baseState&&(e.baseState=!1,ys=!0),e.memoizedState=n):(sr(n,t)||(n=mt(),oo.lanes|=n,Pc|=n,e.baseState=!0),t)}function Go(e,t){var n=yt;yt=0!==n&&4>n?n:4,e(!0);var r=ao.transition;ao.transition={};try{e(!1),t()}finally{yt=n,ao.transition=r}}function qo(){return yo().memoizedState}function Ko(e,t,n){var r=tl(e);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},Yo(e))$o(t,n);else if(null!==(n=Di(e,t,n,r))){nl(n,e,r,el()),Jo(n,t,r)}}function Xo(e,t,n){var r=tl(e),a={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(Yo(e))$o(t,a);else{var i=e.alternate;if(0===e.lanes&&(null===i||0===i.lanes)&&null!==(i=t.lastRenderedReducer))try{var o=t.lastRenderedState,s=i(o,n);if(a.hasEagerState=!0,a.eagerState=s,sr(s,o)){var c=t.interleaved;return null===c?(a.next=a,Fi(t)):(a.next=c.next,c.next=a),void(t.interleaved=a)}}catch(l){}null!==(n=Di(e,t,a,r))&&(nl(n,e,r,a=el()),Jo(n,t,r))}}function Yo(e){var t=e.alternate;return e===oo||null!==t&&t===oo}function $o(e,t){uo=lo=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function Jo(e,t,n){if(0!==(4194240&n)){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,bt(e,n)}}var Qo={readContext:Ai,useCallback:po,useContext:po,useEffect:po,useImperativeHandle:po,useInsertionEffect:po,useLayoutEffect:po,useMemo:po,useReducer:po,useRef:po,useState:po,useDebugValue:po,useDeferredValue:po,useTransition:po,useMutableSource:po,useSyncExternalStore:po,useId:po,unstable_isNewReconciler:!1},Zo={readContext:Ai,useCallback:function(e,t){return bo().memoizedState=[e,void 0===t?null:t],e},useContext:Ai,useEffect:Lo,useImperativeHandle:function(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Do(4194308,4,Bo.bind(null,t,e),n)},useLayoutEffect:function(e,t){return Do(4194308,4,e,t)},useInsertionEffect:function(e,t){return Do(4,2,e,t)},useMemo:function(e,t){var n=bo();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var r=bo();return t=void 0!==n?n(t):t,r.memoizedState=r.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},r.queue=e,e=e.dispatch=Ko.bind(null,oo,e),[r.memoizedState,e]},useRef:function(e){return e={current:e},bo().memoizedState=e},useState:Ao,useDebugValue:Uo,useDeferredValue:function(e){return bo().memoizedState=e},useTransition:function(){var e=Ao(!1),t=e[0];return e=Go.bind(null,e[1]),bo().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var r=oo,a=bo();if(ai){if(void 0===n)throw Error(i(407));n=n()}else{if(n=t(),null===_c)throw Error(i(349));0!==(30&io)||Co(r,t,n)}a.memoizedState=n;var o={value:n,getSnapshot:t};return a.queue=o,Lo(Io.bind(null,r,o,e),[e]),r.flags|=2048,Ro(9,Eo.bind(null,r,o,n,t),void 0,null),n},useId:function(){var e=bo(),t=_c.identifierPrefix;if(ai){var n=Ja;t=":"+t+"R"+(n=($a&~(1<<32-ot($a)-1)).toString(32)+n),0<(n=ho++)&&(t+="H"+n.toString(32)),t+=":"}else t=":"+t+"r"+(n=fo++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},es={readContext:Ai,useCallback:Wo,useContext:Ai,useEffect:Po,useImperativeHandle:zo,useInsertionEffect:Mo,useLayoutEffect:jo,useMemo:Vo,useReducer:wo,useRef:Fo,useState:function(){return wo(xo)},useDebugValue:Uo,useDeferredValue:function(e){return Ho(yo(),so.memoizedState,e)},useTransition:function(){return[wo(xo)[0],yo().memoizedState]},useMutableSource:So,useSyncExternalStore:No,useId:qo,unstable_isNewReconciler:!1},ts={readContext:Ai,useCallback:Wo,useContext:Ai,useEffect:Po,useImperativeHandle:zo,useInsertionEffect:Mo,useLayoutEffect:jo,useMemo:Vo,useReducer:ko,useRef:Fo,useState:function(){return ko(xo)},useDebugValue:Uo,useDeferredValue:function(e){var t=yo();return null===so?t.memoizedState=e:Ho(t,so.memoizedState,e)},useTransition:function(){return[ko(xo)[0],yo().memoizedState]},useMutableSource:So,useSyncExternalStore:No,useId:qo,unstable_isNewReconciler:!1};function ns(e,t){if(e&&e.defaultProps){for(var n in t=M({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}function rs(e,t,n,r){n=null===(n=n(r,t=e.memoizedState))||void 0===n?t:M({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var as={isMounted:function(e){return!!(e=e._reactInternals)&&We(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var r=el(),a=tl(e),i=ji(r,a);i.payload=t,void 0!==n&&null!==n&&(i.callback=n),null!==(t=Bi(e,i,a))&&(nl(t,e,a,r),zi(t,e,a))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=el(),a=tl(e),i=ji(r,a);i.tag=1,i.payload=t,void 0!==n&&null!==n&&(i.callback=n),null!==(t=Bi(e,i,a))&&(nl(t,e,a,r),zi(t,e,a))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=el(),r=tl(e),a=ji(n,r);a.tag=2,void 0!==t&&null!==t&&(a.callback=t),null!==(t=Bi(e,a,r))&&(nl(t,e,r,n),zi(t,e,r))}};function is(e,t,n,r,a,i,o){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(r,i,o):!t.prototype||!t.prototype.isPureReactComponent||(!cr(n,r)||!cr(a,i))}function os(e,t,n){var r=!1,a=Ia,i=t.contextType;return"object"===typeof i&&null!==i?i=Ai(i):(a=Fa(t)?Aa:Ta.current,i=(r=null!==(r=t.contextTypes)&&void 0!==r)?Ra(e,a):Ia),t=new t(n,i),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=as,e.stateNode=t,t._reactInternals=e,r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=a,e.__reactInternalMemoizedMaskedChildContext=i),t}function ss(e,t,n,r){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,r),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&as.enqueueReplaceState(t,t.state,null)}function cs(e,t,n,r){var a=e.stateNode;a.props=n,a.state=e.memoizedState,a.refs={},Pi(e);var i=t.contextType;"object"===typeof i&&null!==i?a.context=Ai(i):(i=Fa(t)?Aa:Ta.current,a.context=Ra(e,i)),a.state=e.memoizedState,"function"===typeof(i=t.getDerivedStateFromProps)&&(rs(e,t,i,n),a.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof a.getSnapshotBeforeUpdate||"function"!==typeof a.UNSAFE_componentWillMount&&"function"!==typeof a.componentWillMount||(t=a.state,"function"===typeof a.componentWillMount&&a.componentWillMount(),"function"===typeof a.UNSAFE_componentWillMount&&a.UNSAFE_componentWillMount(),t!==a.state&&as.enqueueReplaceState(a,a.state,null),Wi(e,n,a,r),a.state=e.memoizedState),"function"===typeof a.componentDidMount&&(e.flags|=4194308)}function ls(e,t){try{var n="",r=t;do{n+=U(r),r=r.return}while(r);var a=n}catch(i){a="\nError generating stack: "+i.message+"\n"+i.stack}return{value:e,source:t,stack:a,digest:null}}function us(e,t,n){return{value:e,source:null,stack:null!=n?n:null,digest:null!=t?t:null}}function hs(e,t){try{console.error(t.value)}catch(n){setTimeout(function(){throw n})}}var ds="function"===typeof WeakMap?WeakMap:Map;function fs(e,t,n){(n=ji(-1,n)).tag=3,n.payload={element:null};var r=t.value;return n.callback=function(){Hc||(Hc=!0,Gc=r),hs(0,t)},n}function ps(e,t,n){(n=ji(-1,n)).tag=3;var r=e.type.getDerivedStateFromError;if("function"===typeof r){var a=t.value;n.payload=function(){return r(a)},n.callback=function(){hs(0,t)}}var i=e.stateNode;return null!==i&&"function"===typeof i.componentDidCatch&&(n.callback=function(){hs(0,t),"function"!==typeof r&&(null===qc?qc=new Set([this]):qc.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}function ms(e,t,n){var r=e.pingCache;if(null===r){r=e.pingCache=new ds;var a=new Set;r.set(t,a)}else void 0===(a=r.get(t))&&(a=new Set,r.set(t,a));a.has(n)||(a.add(n),e=Cl.bind(null,e,t,n),t.then(e,e))}function gs(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function vs(e,t,n,r,a){return 0===(1&e.mode)?(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,1===n.tag&&(null===n.alternate?n.tag=17:((t=ji(-1,1)).tag=2,Bi(n,t,1))),n.lanes|=1),e):(e.flags|=65536,e.lanes=a,e)}var bs=x.ReactCurrentOwner,ys=!1;function xs(e,t,n,r){t.child=null===e?wi(t,null,n,r):xi(t,e.child,n,r)}function ws(e,t,n,r,a){n=n.render;var i=t.ref;return _i(t,a),r=go(e,t,n,r,i,a),n=vo(),null===e||ys?(ai&&n&&ei(t),t.flags|=1,xs(e,t,r,a),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a,Hs(e,t,a))}function ks(e,t,n,r,a){if(null===e){var i=n.type;return"function"!==typeof i||Fl(i)||void 0!==i.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=Ol(n.type,null,r,t,t.mode,a)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=i,Ss(e,t,i,r,a))}if(i=e.child,0===(e.lanes&a)){var o=i.memoizedProps;if((n=null!==(n=n.compare)?n:cr)(o,r)&&e.ref===t.ref)return Hs(e,t,a)}return t.flags|=1,(e=Dl(i,r)).ref=t.ref,e.return=t,t.child=e}function Ss(e,t,n,r,a){if(null!==e){var i=e.memoizedProps;if(cr(i,r)&&e.ref===t.ref){if(ys=!1,t.pendingProps=r=i,0===(e.lanes&a))return t.lanes=e.lanes,Hs(e,t,a);0!==(131072&e.flags)&&(ys=!0)}}return Es(e,t,n,r,a)}function Ns(e,t,n){var r=t.pendingProps,a=r.children,i=null!==e?e.memoizedState:null;if("hidden"===r.mode)if(0===(1&t.mode))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ea(Dc,Fc),Fc|=n;else{if(0===(1073741824&n))return e=null!==i?i.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Ea(Dc,Fc),Fc|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=null!==i?i.baseLanes:n,Ea(Dc,Fc),Fc|=r}else null!==i?(r=i.baseLanes|n,t.memoizedState=null):r=n,Ea(Dc,Fc),Fc|=r;return xs(e,t,a,n),t.child}function Cs(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function Es(e,t,n,r,a){var i=Fa(n)?Aa:Ta.current;return i=Ra(t,i),_i(t,a),n=go(e,t,n,r,i,a),r=vo(),null===e||ys?(ai&&r&&ei(t),t.flags|=1,xs(e,t,n,a),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a,Hs(e,t,a))}function Is(e,t,n,r,a){if(Fa(n)){var i=!0;Pa(t)}else i=!1;if(_i(t,a),null===t.stateNode)Vs(e,t),os(t,n,r),cs(t,n,r,a),r=!0;else if(null===e){var o=t.stateNode,s=t.memoizedProps;o.props=s;var c=o.context,l=n.contextType;"object"===typeof l&&null!==l?l=Ai(l):l=Ra(t,l=Fa(n)?Aa:Ta.current);var u=n.getDerivedStateFromProps,h="function"===typeof u||"function"===typeof o.getSnapshotBeforeUpdate;h||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(s!==r||c!==l)&&ss(t,o,r,l),Li=!1;var d=t.memoizedState;o.state=d,Wi(t,r,o,a),c=t.memoizedState,s!==r||d!==c||_a.current||Li?("function"===typeof u&&(rs(t,n,u,r),c=t.memoizedState),(s=Li||is(t,n,s,r,d,c,l))?(h||"function"!==typeof o.UNSAFE_componentWillMount&&"function"!==typeof o.componentWillMount||("function"===typeof o.componentWillMount&&o.componentWillMount(),"function"===typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount()),"function"===typeof o.componentDidMount&&(t.flags|=4194308)):("function"===typeof o.componentDidMount&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=c),o.props=r,o.state=c,o.context=l,r=s):("function"===typeof o.componentDidMount&&(t.flags|=4194308),r=!1)}else{o=t.stateNode,Mi(e,t),s=t.memoizedProps,l=t.type===t.elementType?s:ns(t.type,s),o.props=l,h=t.pendingProps,d=o.context,"object"===typeof(c=n.contextType)&&null!==c?c=Ai(c):c=Ra(t,c=Fa(n)?Aa:Ta.current);var f=n.getDerivedStateFromProps;(u="function"===typeof f||"function"===typeof o.getSnapshotBeforeUpdate)||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(s!==h||d!==c)&&ss(t,o,r,c),Li=!1,d=t.memoizedState,o.state=d,Wi(t,r,o,a);var p=t.memoizedState;s!==h||d!==p||_a.current||Li?("function"===typeof f&&(rs(t,n,f,r),p=t.memoizedState),(l=Li||is(t,n,l,r,d,p,c)||!1)?(u||"function"!==typeof o.UNSAFE_componentWillUpdate&&"function"!==typeof o.componentWillUpdate||("function"===typeof o.componentWillUpdate&&o.componentWillUpdate(r,p,c),"function"===typeof o.UNSAFE_componentWillUpdate&&o.UNSAFE_componentWillUpdate(r,p,c)),"function"===typeof o.componentDidUpdate&&(t.flags|=4),"function"===typeof o.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof o.componentDidUpdate||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!==typeof o.getSnapshotBeforeUpdate||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=p),o.props=r,o.state=p,o.context=c,r=l):("function"!==typeof o.componentDidUpdate||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!==typeof o.getSnapshotBeforeUpdate||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),r=!1)}return Ts(e,t,n,r,i,a)}function Ts(e,t,n,r,a,i){Cs(e,t);var o=0!==(128&t.flags);if(!r&&!o)return a&&Ma(t,n,!1),Hs(e,t,i);r=t.stateNode,bs.current=t;var s=o&&"function"!==typeof n.getDerivedStateFromError?null:r.render();return t.flags|=1,null!==e&&o?(t.child=xi(t,e.child,null,i),t.child=xi(t,null,s,i)):xs(e,t,s,i),t.memoizedState=r.state,a&&Ma(t,n,!0),t.child}function _s(e){var t=e.stateNode;t.pendingContext?Oa(0,t.pendingContext,t.pendingContext!==t.context):t.context&&Oa(0,t.context,!1),Yi(e,t.containerInfo)}function As(e,t,n,r,a){return fi(),pi(a),t.flags|=256,xs(e,t,n,r),t.child}var Rs,Fs,Ds,Os,Ls={dehydrated:null,treeContext:null,retryLane:0};function Ps(e){return{baseLanes:e,cachePool:null,transitions:null}}function Ms(e,t,n){var r,a=t.pendingProps,o=Zi.current,s=!1,c=0!==(128&t.flags);if((r=c)||(r=(null===e||null!==e.memoizedState)&&0!==(2&o)),r?(s=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(o|=1),Ea(Zi,1&o),null===e)return li(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(0===(1&t.mode)?t.lanes=1:"$!"===e.data?t.lanes=8:t.lanes=1073741824,null):(c=a.children,e=a.fallback,s?(a=t.mode,s=t.child,c={mode:"hidden",children:c},0===(1&a)&&null!==s?(s.childLanes=0,s.pendingProps=c):s=Pl(c,a,0,null),e=Ll(e,a,n,null),s.return=t,e.return=t,s.sibling=e,t.child=s,t.child.memoizedState=Ps(n),t.memoizedState=Ls,e):js(t,c));if(null!==(o=e.memoizedState)&&null!==(r=o.dehydrated))return function(e,t,n,r,a,o,s){if(n)return 256&t.flags?(t.flags&=-257,Bs(e,t,s,r=us(Error(i(422))))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(o=r.fallback,a=t.mode,r=Pl({mode:"visible",children:r.children},a,0,null),(o=Ll(o,a,s,null)).flags|=2,r.return=t,o.return=t,r.sibling=o,t.child=r,0!==(1&t.mode)&&xi(t,e.child,null,s),t.child.memoizedState=Ps(s),t.memoizedState=Ls,o);if(0===(1&t.mode))return Bs(e,t,s,null);if("$!"===a.data){if(r=a.nextSibling&&a.nextSibling.dataset)var c=r.dgst;return r=c,Bs(e,t,s,r=us(o=Error(i(419)),r,void 0))}if(c=0!==(s&e.childLanes),ys||c){if(null!==(r=_c)){switch(s&-s){case 4:a=2;break;case 16:a=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:a=32;break;case 536870912:a=268435456;break;default:a=0}0!==(a=0!==(a&(r.suspendedLanes|s))?0:a)&&a!==o.retryLane&&(o.retryLane=a,Oi(e,a),nl(r,e,a,-1))}return ml(),Bs(e,t,s,r=us(Error(i(421))))}return"$?"===a.data?(t.flags|=128,t.child=e.child,t=Il.bind(null,e),a._reactRetry=t,null):(e=o.treeContext,ri=la(a.nextSibling),ni=t,ai=!0,ii=null,null!==e&&(Ka[Xa++]=$a,Ka[Xa++]=Ja,Ka[Xa++]=Ya,$a=e.id,Ja=e.overflow,Ya=t),t=js(t,r.children),t.flags|=4096,t)}(e,t,c,a,r,o,n);if(s){s=a.fallback,c=t.mode,r=(o=e.child).sibling;var l={mode:"hidden",children:a.children};return 0===(1&c)&&t.child!==o?((a=t.child).childLanes=0,a.pendingProps=l,t.deletions=null):(a=Dl(o,l)).subtreeFlags=14680064&o.subtreeFlags,null!==r?s=Dl(r,s):(s=Ll(s,c,n,null)).flags|=2,s.return=t,a.return=t,a.sibling=s,t.child=a,a=s,s=t.child,c=null===(c=e.child.memoizedState)?Ps(n):{baseLanes:c.baseLanes|n,cachePool:null,transitions:c.transitions},s.memoizedState=c,s.childLanes=e.childLanes&~n,t.memoizedState=Ls,a}return e=(s=e.child).sibling,a=Dl(s,{mode:"visible",children:a.children}),0===(1&t.mode)&&(a.lanes=n),a.return=t,a.sibling=null,null!==e&&(null===(n=t.deletions)?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=a,t.memoizedState=null,a}function js(e,t){return(t=Pl({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function Bs(e,t,n,r){return null!==r&&pi(r),xi(t,e.child,null,n),(e=js(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function zs(e,t,n){e.lanes|=t;var r=e.alternate;null!==r&&(r.lanes|=t),Ti(e.return,t,n)}function Us(e,t,n,r,a){var i=e.memoizedState;null===i?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:a}:(i.isBackwards=t,i.rendering=null,i.renderingStartTime=0,i.last=r,i.tail=n,i.tailMode=a)}function Ws(e,t,n){var r=t.pendingProps,a=r.revealOrder,i=r.tail;if(xs(e,t,r.children,n),0!==(2&(r=Zi.current)))r=1&r|2,t.flags|=128;else{if(null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&zs(e,n,t);else if(19===e.tag)zs(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(Ea(Zi,r),0===(1&t.mode))t.memoizedState=null;else switch(a){case"forwards":for(n=t.child,a=null;null!==n;)null!==(e=n.alternate)&&null===eo(e)&&(a=n),n=n.sibling;null===(n=a)?(a=t.child,t.child=null):(a=n.sibling,n.sibling=null),Us(t,!1,a,n,i);break;case"backwards":for(n=null,a=t.child,t.child=null;null!==a;){if(null!==(e=a.alternate)&&null===eo(e)){t.child=a;break}e=a.sibling,a.sibling=n,n=a,a=e}Us(t,!0,n,null,i);break;case"together":Us(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Vs(e,t){0===(1&t.mode)&&null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Hs(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),Pc|=t.lanes,0===(n&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(i(153));if(null!==t.child){for(n=Dl(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Dl(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function Gs(e,t){if(!ai)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;null!==n;)null!==n.alternate&&(r=n),n=n.sibling;null===r?t||null===e.tail?e.tail=null:e.tail.sibling=null:r.sibling=null}}function qs(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,r=0;if(t)for(var a=e.child;null!==a;)n|=a.lanes|a.childLanes,r|=14680064&a.subtreeFlags,r|=14680064&a.flags,a.return=e,a=a.sibling;else for(a=e.child;null!==a;)n|=a.lanes|a.childLanes,r|=a.subtreeFlags,r|=a.flags,a.return=e,a=a.sibling;return e.subtreeFlags|=r,e.childLanes=n,t}function Ks(e,t,n){var r=t.pendingProps;switch(ti(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return qs(t),null;case 1:case 17:return Fa(t.type)&&Da(),qs(t),null;case 3:return r=t.stateNode,$i(),Ca(_a),Ca(Ta),no(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),null!==e&&null!==e.child||(hi(t)?t.flags|=4:null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,null!==ii&&(ol(ii),ii=null))),Fs(e,t),qs(t),null;case 5:Qi(t);var a=Xi(Ki.current);if(n=t.type,null!==e&&null!=t.stateNode)Ds(e,t,n,r,a),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!r){if(null===t.stateNode)throw Error(i(166));return qs(t),null}if(e=Xi(Gi.current),hi(t)){r=t.stateNode,n=t.type;var o=t.memoizedProps;switch(r[da]=t,r[fa]=o,e=0!==(1&t.mode),n){case"dialog":Br("cancel",r),Br("close",r);break;case"iframe":case"object":case"embed":Br("load",r);break;case"video":case"audio":for(a=0;a<Lr.length;a++)Br(Lr[a],r);break;case"source":Br("error",r);break;case"img":case"image":case"link":Br("error",r),Br("load",r);break;case"details":Br("toggle",r);break;case"input":$(r,o),Br("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!o.multiple},Br("invalid",r);break;case"textarea":ae(r,o),Br("invalid",r)}for(var c in be(n,o),a=null,o)if(o.hasOwnProperty(c)){var l=o[c];"children"===c?"string"===typeof l?r.textContent!==l&&(!0!==o.suppressHydrationWarning&&Qr(r.textContent,l,e),a=["children",l]):"number"===typeof l&&r.textContent!==""+l&&(!0!==o.suppressHydrationWarning&&Qr(r.textContent,l,e),a=["children",""+l]):s.hasOwnProperty(c)&&null!=l&&"onScroll"===c&&Br("scroll",r)}switch(n){case"input":q(r),Z(r,o,!0);break;case"textarea":q(r),oe(r);break;case"select":case"option":break;default:"function"===typeof o.onClick&&(r.onclick=Zr)}r=a,t.updateQueue=r,null!==r&&(t.flags|=4)}else{c=9===a.nodeType?a:a.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=se(n)),"http://www.w3.org/1999/xhtml"===e?"script"===n?((e=c.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"===typeof r.is?e=c.createElement(n,{is:r.is}):(e=c.createElement(n),"select"===n&&(c=e,r.multiple?c.multiple=!0:r.size&&(c.size=r.size))):e=c.createElementNS(e,n),e[da]=t,e[fa]=r,Rs(e,t,!1,!1),t.stateNode=e;e:{switch(c=ye(n,r),n){case"dialog":Br("cancel",e),Br("close",e),a=r;break;case"iframe":case"object":case"embed":Br("load",e),a=r;break;case"video":case"audio":for(a=0;a<Lr.length;a++)Br(Lr[a],e);a=r;break;case"source":Br("error",e),a=r;break;case"img":case"image":case"link":Br("error",e),Br("load",e),a=r;break;case"details":Br("toggle",e),a=r;break;case"input":$(e,r),a=Y(e,r),Br("invalid",e);break;case"option":default:a=r;break;case"select":e._wrapperState={wasMultiple:!!r.multiple},a=M({},r,{value:void 0}),Br("invalid",e);break;case"textarea":ae(e,r),a=re(e,r),Br("invalid",e)}for(o in be(n,a),l=a)if(l.hasOwnProperty(o)){var u=l[o];"style"===o?ge(e,u):"dangerouslySetInnerHTML"===o?null!=(u=u?u.__html:void 0)&&he(e,u):"children"===o?"string"===typeof u?("textarea"!==n||""!==u)&&de(e,u):"number"===typeof u&&de(e,""+u):"suppressContentEditableWarning"!==o&&"suppressHydrationWarning"!==o&&"autoFocus"!==o&&(s.hasOwnProperty(o)?null!=u&&"onScroll"===o&&Br("scroll",e):null!=u&&y(e,o,u,c))}switch(n){case"input":q(e),Z(e,r,!1);break;case"textarea":q(e),oe(e);break;case"option":null!=r.value&&e.setAttribute("value",""+H(r.value));break;case"select":e.multiple=!!r.multiple,null!=(o=r.value)?ne(e,!!r.multiple,o,!1):null!=r.defaultValue&&ne(e,!!r.multiple,r.defaultValue,!0);break;default:"function"===typeof a.onClick&&(e.onclick=Zr)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(t.flags|=4)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return qs(t),null;case 6:if(e&&null!=t.stateNode)Os(e,t,e.memoizedProps,r);else{if("string"!==typeof r&&null===t.stateNode)throw Error(i(166));if(n=Xi(Ki.current),Xi(Gi.current),hi(t)){if(r=t.stateNode,n=t.memoizedProps,r[da]=t,(o=r.nodeValue!==n)&&null!==(e=ni))switch(e.tag){case 3:Qr(r.nodeValue,n,0!==(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&Qr(r.nodeValue,n,0!==(1&e.mode))}o&&(t.flags|=4)}else(r=(9===n.nodeType?n:n.ownerDocument).createTextNode(r))[da]=t,t.stateNode=r}return qs(t),null;case 13:if(Ca(Zi),r=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(ai&&null!==ri&&0!==(1&t.mode)&&0===(128&t.flags))di(),fi(),t.flags|=98560,o=!1;else if(o=hi(t),null!==r&&null!==r.dehydrated){if(null===e){if(!o)throw Error(i(318));if(!(o=null!==(o=t.memoizedState)?o.dehydrated:null))throw Error(i(317));o[da]=t}else fi(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;qs(t),o=!1}else null!==ii&&(ol(ii),ii=null),o=!0;if(!o)return 65536&t.flags?t:null}return 0!==(128&t.flags)?(t.lanes=n,t):((r=null!==r)!==(null!==e&&null!==e.memoizedState)&&r&&(t.child.flags|=8192,0!==(1&t.mode)&&(null===e||0!==(1&Zi.current)?0===Oc&&(Oc=3):ml())),null!==t.updateQueue&&(t.flags|=4),qs(t),null);case 4:return $i(),Fs(e,t),null===e&&Wr(t.stateNode.containerInfo),qs(t),null;case 10:return Ii(t.type._context),qs(t),null;case 19:if(Ca(Zi),null===(o=t.memoizedState))return qs(t),null;if(r=0!==(128&t.flags),null===(c=o.rendering))if(r)Gs(o,!1);else{if(0!==Oc||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(c=eo(e))){for(t.flags|=128,Gs(o,!1),null!==(r=c.updateQueue)&&(t.updateQueue=r,t.flags|=4),t.subtreeFlags=0,r=n,n=t.child;null!==n;)e=r,(o=n).flags&=14680066,null===(c=o.alternate)?(o.childLanes=0,o.lanes=e,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=c.childLanes,o.lanes=c.lanes,o.child=c.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=c.memoizedProps,o.memoizedState=c.memoizedState,o.updateQueue=c.updateQueue,o.type=c.type,e=c.dependencies,o.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return Ea(Zi,1&Zi.current|2),t.child}e=e.sibling}null!==o.tail&&Je()>Wc&&(t.flags|=128,r=!0,Gs(o,!1),t.lanes=4194304)}else{if(!r)if(null!==(e=eo(c))){if(t.flags|=128,r=!0,null!==(n=e.updateQueue)&&(t.updateQueue=n,t.flags|=4),Gs(o,!0),null===o.tail&&"hidden"===o.tailMode&&!c.alternate&&!ai)return qs(t),null}else 2*Je()-o.renderingStartTime>Wc&&1073741824!==n&&(t.flags|=128,r=!0,Gs(o,!1),t.lanes=4194304);o.isBackwards?(c.sibling=t.child,t.child=c):(null!==(n=o.last)?n.sibling=c:t.child=c,o.last=c)}return null!==o.tail?(t=o.tail,o.rendering=t,o.tail=t.sibling,o.renderingStartTime=Je(),t.sibling=null,n=Zi.current,Ea(Zi,r?1&n|2:1&n),t):(qs(t),null);case 22:case 23:return hl(),r=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==r&&(t.flags|=8192),r&&0!==(1&t.mode)?0!==(1073741824&Fc)&&(qs(t),6&t.subtreeFlags&&(t.flags|=8192)):qs(t),null;case 24:case 25:return null}throw Error(i(156,t.tag))}function Xs(e,t){switch(ti(t),t.tag){case 1:return Fa(t.type)&&Da(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return $i(),Ca(_a),Ca(Ta),no(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 5:return Qi(t),null;case 13:if(Ca(Zi),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(i(340));fi()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return Ca(Zi),null;case 4:return $i(),null;case 10:return Ii(t.type._context),null;case 22:case 23:return hl(),null;default:return null}}Rs=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},Fs=function(){},Ds=function(e,t,n,r){var a=e.memoizedProps;if(a!==r){e=t.stateNode,Xi(Gi.current);var i,o=null;switch(n){case"input":a=Y(e,a),r=Y(e,r),o=[];break;case"select":a=M({},a,{value:void 0}),r=M({},r,{value:void 0}),o=[];break;case"textarea":a=re(e,a),r=re(e,r),o=[];break;default:"function"!==typeof a.onClick&&"function"===typeof r.onClick&&(e.onclick=Zr)}for(u in be(n,r),n=null,a)if(!r.hasOwnProperty(u)&&a.hasOwnProperty(u)&&null!=a[u])if("style"===u){var c=a[u];for(i in c)c.hasOwnProperty(i)&&(n||(n={}),n[i]="")}else"dangerouslySetInnerHTML"!==u&&"children"!==u&&"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&"autoFocus"!==u&&(s.hasOwnProperty(u)?o||(o=[]):(o=o||[]).push(u,null));for(u in r){var l=r[u];if(c=null!=a?a[u]:void 0,r.hasOwnProperty(u)&&l!==c&&(null!=l||null!=c))if("style"===u)if(c){for(i in c)!c.hasOwnProperty(i)||l&&l.hasOwnProperty(i)||(n||(n={}),n[i]="");for(i in l)l.hasOwnProperty(i)&&c[i]!==l[i]&&(n||(n={}),n[i]=l[i])}else n||(o||(o=[]),o.push(u,n)),n=l;else"dangerouslySetInnerHTML"===u?(l=l?l.__html:void 0,c=c?c.__html:void 0,null!=l&&c!==l&&(o=o||[]).push(u,l)):"children"===u?"string"!==typeof l&&"number"!==typeof l||(o=o||[]).push(u,""+l):"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&(s.hasOwnProperty(u)?(null!=l&&"onScroll"===u&&Br("scroll",e),o||c===l||(o=[])):(o=o||[]).push(u,l))}n&&(o=o||[]).push("style",n);var u=o;(t.updateQueue=u)&&(t.flags|=4)}},Os=function(e,t,n,r){n!==r&&(t.flags|=4)};var Ys=!1,$s=!1,Js="function"===typeof WeakSet?WeakSet:Set,Qs=null;function Zs(e,t){var n=e.ref;if(null!==n)if("function"===typeof n)try{n(null)}catch(r){Nl(e,t,r)}else n.current=null}function ec(e,t,n){try{n()}catch(r){Nl(e,t,r)}}var tc=!1;function nc(e,t,n){var r=t.updateQueue;if(null!==(r=null!==r?r.lastEffect:null)){var a=r=r.next;do{if((a.tag&e)===e){var i=a.destroy;a.destroy=void 0,void 0!==i&&ec(t,n,i)}a=a.next}while(a!==r)}}function rc(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var r=n.create;n.destroy=r()}n=n.next}while(n!==t)}}function ac(e){var t=e.ref;if(null!==t){var n=e.stateNode;e.tag,e=n,"function"===typeof t?t(e):t.current=e}}function ic(e){var t=e.alternate;null!==t&&(e.alternate=null,ic(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&(delete t[da],delete t[fa],delete t[ma],delete t[ga],delete t[va])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function oc(e){return 5===e.tag||3===e.tag||4===e.tag}function sc(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||oc(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function cc(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?8===n.nodeType?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(8===n.nodeType?(t=n.parentNode).insertBefore(e,n):(t=n).appendChild(e),null!==(n=n._reactRootContainer)&&void 0!==n||null!==t.onclick||(t.onclick=Zr));else if(4!==r&&null!==(e=e.child))for(cc(e,t,n),e=e.sibling;null!==e;)cc(e,t,n),e=e.sibling}function lc(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==r&&null!==(e=e.child))for(lc(e,t,n),e=e.sibling;null!==e;)lc(e,t,n),e=e.sibling}var uc=null,hc=!1;function dc(e,t,n){for(n=n.child;null!==n;)fc(e,t,n),n=n.sibling}function fc(e,t,n){if(it&&"function"===typeof it.onCommitFiberUnmount)try{it.onCommitFiberUnmount(at,n)}catch(s){}switch(n.tag){case 5:$s||Zs(n,t);case 6:var r=uc,a=hc;uc=null,dc(e,t,n),hc=a,null!==(uc=r)&&(hc?(e=uc,n=n.stateNode,8===e.nodeType?e.parentNode.removeChild(n):e.removeChild(n)):uc.removeChild(n.stateNode));break;case 18:null!==uc&&(hc?(e=uc,n=n.stateNode,8===e.nodeType?ca(e.parentNode,n):1===e.nodeType&&ca(e,n),Wt(e)):ca(uc,n.stateNode));break;case 4:r=uc,a=hc,uc=n.stateNode.containerInfo,hc=!0,dc(e,t,n),uc=r,hc=a;break;case 0:case 11:case 14:case 15:if(!$s&&(null!==(r=n.updateQueue)&&null!==(r=r.lastEffect))){a=r=r.next;do{var i=a,o=i.destroy;i=i.tag,void 0!==o&&(0!==(2&i)||0!==(4&i))&&ec(n,t,o),a=a.next}while(a!==r)}dc(e,t,n);break;case 1:if(!$s&&(Zs(n,t),"function"===typeof(r=n.stateNode).componentWillUnmount))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(s){Nl(n,t,s)}dc(e,t,n);break;case 21:dc(e,t,n);break;case 22:1&n.mode?($s=(r=$s)||null!==n.memoizedState,dc(e,t,n),$s=r):dc(e,t,n);break;default:dc(e,t,n)}}function pc(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new Js),t.forEach(function(t){var r=Tl.bind(null,e,t);n.has(t)||(n.add(t),t.then(r,r))})}}function mc(e,t){var n=t.deletions;if(null!==n)for(var r=0;r<n.length;r++){var a=n[r];try{var o=e,s=t,c=s;e:for(;null!==c;){switch(c.tag){case 5:uc=c.stateNode,hc=!1;break e;case 3:case 4:uc=c.stateNode.containerInfo,hc=!0;break e}c=c.return}if(null===uc)throw Error(i(160));fc(o,s,a),uc=null,hc=!1;var l=a.alternate;null!==l&&(l.return=null),a.return=null}catch(u){Nl(a,t,u)}}if(12854&t.subtreeFlags)for(t=t.child;null!==t;)gc(t,e),t=t.sibling}function gc(e,t){var n=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(mc(t,e),vc(e),4&r){try{nc(3,e,e.return),rc(3,e)}catch(g){Nl(e,e.return,g)}try{nc(5,e,e.return)}catch(g){Nl(e,e.return,g)}}break;case 1:mc(t,e),vc(e),512&r&&null!==n&&Zs(n,n.return);break;case 5:if(mc(t,e),vc(e),512&r&&null!==n&&Zs(n,n.return),32&e.flags){var a=e.stateNode;try{de(a,"")}catch(g){Nl(e,e.return,g)}}if(4&r&&null!=(a=e.stateNode)){var o=e.memoizedProps,s=null!==n?n.memoizedProps:o,c=e.type,l=e.updateQueue;if(e.updateQueue=null,null!==l)try{"input"===c&&"radio"===o.type&&null!=o.name&&J(a,o),ye(c,s);var u=ye(c,o);for(s=0;s<l.length;s+=2){var h=l[s],d=l[s+1];"style"===h?ge(a,d):"dangerouslySetInnerHTML"===h?he(a,d):"children"===h?de(a,d):y(a,h,d,u)}switch(c){case"input":Q(a,o);break;case"textarea":ie(a,o);break;case"select":var f=a._wrapperState.wasMultiple;a._wrapperState.wasMultiple=!!o.multiple;var p=o.value;null!=p?ne(a,!!o.multiple,p,!1):f!==!!o.multiple&&(null!=o.defaultValue?ne(a,!!o.multiple,o.defaultValue,!0):ne(a,!!o.multiple,o.multiple?[]:"",!1))}a[fa]=o}catch(g){Nl(e,e.return,g)}}break;case 6:if(mc(t,e),vc(e),4&r){if(null===e.stateNode)throw Error(i(162));a=e.stateNode,o=e.memoizedProps;try{a.nodeValue=o}catch(g){Nl(e,e.return,g)}}break;case 3:if(mc(t,e),vc(e),4&r&&null!==n&&n.memoizedState.isDehydrated)try{Wt(t.containerInfo)}catch(g){Nl(e,e.return,g)}break;case 4:default:mc(t,e),vc(e);break;case 13:mc(t,e),vc(e),8192&(a=e.child).flags&&(o=null!==a.memoizedState,a.stateNode.isHidden=o,!o||null!==a.alternate&&null!==a.alternate.memoizedState||(Uc=Je())),4&r&&pc(e);break;case 22:if(h=null!==n&&null!==n.memoizedState,1&e.mode?($s=(u=$s)||h,mc(t,e),$s=u):mc(t,e),vc(e),8192&r){if(u=null!==e.memoizedState,(e.stateNode.isHidden=u)&&!h&&0!==(1&e.mode))for(Qs=e,h=e.child;null!==h;){for(d=Qs=h;null!==Qs;){switch(p=(f=Qs).child,f.tag){case 0:case 11:case 14:case 15:nc(4,f,f.return);break;case 1:Zs(f,f.return);var m=f.stateNode;if("function"===typeof m.componentWillUnmount){r=f,n=f.return;try{t=r,m.props=t.memoizedProps,m.state=t.memoizedState,m.componentWillUnmount()}catch(g){Nl(r,n,g)}}break;case 5:Zs(f,f.return);break;case 22:if(null!==f.memoizedState){wc(d);continue}}null!==p?(p.return=f,Qs=p):wc(d)}h=h.sibling}e:for(h=null,d=e;;){if(5===d.tag){if(null===h){h=d;try{a=d.stateNode,u?"function"===typeof(o=a.style).setProperty?o.setProperty("display","none","important"):o.display="none":(c=d.stateNode,s=void 0!==(l=d.memoizedProps.style)&&null!==l&&l.hasOwnProperty("display")?l.display:null,c.style.display=me("display",s))}catch(g){Nl(e,e.return,g)}}}else if(6===d.tag){if(null===h)try{d.stateNode.nodeValue=u?"":d.memoizedProps}catch(g){Nl(e,e.return,g)}}else if((22!==d.tag&&23!==d.tag||null===d.memoizedState||d===e)&&null!==d.child){d.child.return=d,d=d.child;continue}if(d===e)break e;for(;null===d.sibling;){if(null===d.return||d.return===e)break e;h===d&&(h=null),d=d.return}h===d&&(h=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:mc(t,e),vc(e),4&r&&pc(e);case 21:}}function vc(e){var t=e.flags;if(2&t){try{e:{for(var n=e.return;null!==n;){if(oc(n)){var r=n;break e}n=n.return}throw Error(i(160))}switch(r.tag){case 5:var a=r.stateNode;32&r.flags&&(de(a,""),r.flags&=-33),lc(e,sc(e),a);break;case 3:case 4:var o=r.stateNode.containerInfo;cc(e,sc(e),o);break;default:throw Error(i(161))}}catch(s){Nl(e,e.return,s)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function bc(e,t,n){Qs=e,yc(e,t,n)}function yc(e,t,n){for(var r=0!==(1&e.mode);null!==Qs;){var a=Qs,i=a.child;if(22===a.tag&&r){var o=null!==a.memoizedState||Ys;if(!o){var s=a.alternate,c=null!==s&&null!==s.memoizedState||$s;s=Ys;var l=$s;if(Ys=o,($s=c)&&!l)for(Qs=a;null!==Qs;)c=(o=Qs).child,22===o.tag&&null!==o.memoizedState?kc(a):null!==c?(c.return=o,Qs=c):kc(a);for(;null!==i;)Qs=i,yc(i,t,n),i=i.sibling;Qs=a,Ys=s,$s=l}xc(e)}else 0!==(8772&a.subtreeFlags)&&null!==i?(i.return=a,Qs=i):xc(e)}}function xc(e){for(;null!==Qs;){var t=Qs;if(0!==(8772&t.flags)){var n=t.alternate;try{if(0!==(8772&t.flags))switch(t.tag){case 0:case 11:case 15:$s||rc(5,t);break;case 1:var r=t.stateNode;if(4&t.flags&&!$s)if(null===n)r.componentDidMount();else{var a=t.elementType===t.type?n.memoizedProps:ns(t.type,n.memoizedProps);r.componentDidUpdate(a,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var o=t.updateQueue;null!==o&&Vi(t,o,r);break;case 3:var s=t.updateQueue;if(null!==s){if(n=null,null!==t.child)switch(t.child.tag){case 5:case 1:n=t.child.stateNode}Vi(t,s,n)}break;case 5:var c=t.stateNode;if(null===n&&4&t.flags){n=c;var l=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&n.focus();break;case"img":l.src&&(n.src=l.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===t.memoizedState){var u=t.alternate;if(null!==u){var h=u.memoizedState;if(null!==h){var d=h.dehydrated;null!==d&&Wt(d)}}}break;default:throw Error(i(163))}$s||512&t.flags&&ac(t)}catch(f){Nl(t,t.return,f)}}if(t===e){Qs=null;break}if(null!==(n=t.sibling)){n.return=t.return,Qs=n;break}Qs=t.return}}function wc(e){for(;null!==Qs;){var t=Qs;if(t===e){Qs=null;break}var n=t.sibling;if(null!==n){n.return=t.return,Qs=n;break}Qs=t.return}}function kc(e){for(;null!==Qs;){var t=Qs;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{rc(4,t)}catch(c){Nl(t,n,c)}break;case 1:var r=t.stateNode;if("function"===typeof r.componentDidMount){var a=t.return;try{r.componentDidMount()}catch(c){Nl(t,a,c)}}var i=t.return;try{ac(t)}catch(c){Nl(t,i,c)}break;case 5:var o=t.return;try{ac(t)}catch(c){Nl(t,o,c)}}}catch(c){Nl(t,t.return,c)}if(t===e){Qs=null;break}var s=t.sibling;if(null!==s){s.return=t.return,Qs=s;break}Qs=t.return}}var Sc,Nc=Math.ceil,Cc=x.ReactCurrentDispatcher,Ec=x.ReactCurrentOwner,Ic=x.ReactCurrentBatchConfig,Tc=0,_c=null,Ac=null,Rc=0,Fc=0,Dc=Na(0),Oc=0,Lc=null,Pc=0,Mc=0,jc=0,Bc=null,zc=null,Uc=0,Wc=1/0,Vc=null,Hc=!1,Gc=null,qc=null,Kc=!1,Xc=null,Yc=0,$c=0,Jc=null,Qc=-1,Zc=0;function el(){return 0!==(6&Tc)?Je():-1!==Qc?Qc:Qc=Je()}function tl(e){return 0===(1&e.mode)?1:0!==(2&Tc)&&0!==Rc?Rc&-Rc:null!==mi.transition?(0===Zc&&(Zc=mt()),Zc):0!==(e=yt)?e:e=void 0===(e=window.event)?16:$t(e.type)}function nl(e,t,n,r){if(50<$c)throw $c=0,Jc=null,Error(i(185));vt(e,n,r),0!==(2&Tc)&&e===_c||(e===_c&&(0===(2&Tc)&&(Mc|=n),4===Oc&&sl(e,Rc)),rl(e,r),1===n&&0===Tc&&0===(1&t.mode)&&(Wc=Je()+500,Ba&&Wa()))}function rl(e,t){var n=e.callbackNode;!function(e,t){for(var n=e.suspendedLanes,r=e.pingedLanes,a=e.expirationTimes,i=e.pendingLanes;0<i;){var o=31-ot(i),s=1<<o,c=a[o];-1===c?0!==(s&n)&&0===(s&r)||(a[o]=ft(s,t)):c<=t&&(e.expiredLanes|=s),i&=~s}}(e,t);var r=dt(e,e===_c?Rc:0);if(0===r)null!==n&&Xe(n),e.callbackNode=null,e.callbackPriority=0;else if(t=r&-r,e.callbackPriority!==t){if(null!=n&&Xe(n),1===t)0===e.tag?function(e){Ba=!0,Ua(e)}(cl.bind(null,e)):Ua(cl.bind(null,e)),oa(function(){0===(6&Tc)&&Wa()}),n=null;else{switch(xt(r)){case 1:n=Ze;break;case 4:n=et;break;case 16:default:n=tt;break;case 536870912:n=rt}n=_l(n,al.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function al(e,t){if(Qc=-1,Zc=0,0!==(6&Tc))throw Error(i(327));var n=e.callbackNode;if(kl()&&e.callbackNode!==n)return null;var r=dt(e,e===_c?Rc:0);if(0===r)return null;if(0!==(30&r)||0!==(r&e.expiredLanes)||t)t=gl(e,r);else{t=r;var a=Tc;Tc|=2;var o=pl();for(_c===e&&Rc===t||(Vc=null,Wc=Je()+500,dl(e,t));;)try{bl();break}catch(c){fl(e,c)}Ei(),Cc.current=o,Tc=a,null!==Ac?t=0:(_c=null,Rc=0,t=Oc)}if(0!==t){if(2===t&&(0!==(a=pt(e))&&(r=a,t=il(e,a))),1===t)throw n=Lc,dl(e,0),sl(e,r),rl(e,Je()),n;if(6===t)sl(e,r);else{if(a=e.current.alternate,0===(30&r)&&!function(e){for(var t=e;;){if(16384&t.flags){var n=t.updateQueue;if(null!==n&&null!==(n=n.stores))for(var r=0;r<n.length;r++){var a=n[r],i=a.getSnapshot;a=a.value;try{if(!sr(i(),a))return!1}catch(s){return!1}}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(a)&&(2===(t=gl(e,r))&&(0!==(o=pt(e))&&(r=o,t=il(e,o))),1===t))throw n=Lc,dl(e,0),sl(e,r),rl(e,Je()),n;switch(e.finishedWork=a,e.finishedLanes=r,t){case 0:case 1:throw Error(i(345));case 2:case 5:wl(e,zc,Vc);break;case 3:if(sl(e,r),(130023424&r)===r&&10<(t=Uc+500-Je())){if(0!==dt(e,0))break;if(((a=e.suspendedLanes)&r)!==r){el(),e.pingedLanes|=e.suspendedLanes&a;break}e.timeoutHandle=ra(wl.bind(null,e,zc,Vc),t);break}wl(e,zc,Vc);break;case 4:if(sl(e,r),(4194240&r)===r)break;for(t=e.eventTimes,a=-1;0<r;){var s=31-ot(r);o=1<<s,(s=t[s])>a&&(a=s),r&=~o}if(r=a,10<(r=(120>(r=Je()-r)?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*Nc(r/1960))-r)){e.timeoutHandle=ra(wl.bind(null,e,zc,Vc),r);break}wl(e,zc,Vc);break;default:throw Error(i(329))}}}return rl(e,Je()),e.callbackNode===n?al.bind(null,e):null}function il(e,t){var n=Bc;return e.current.memoizedState.isDehydrated&&(dl(e,t).flags|=256),2!==(e=gl(e,t))&&(t=zc,zc=n,null!==t&&ol(t)),e}function ol(e){null===zc?zc=e:zc.push.apply(zc,e)}function sl(e,t){for(t&=~jc,t&=~Mc,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-ot(t),r=1<<n;e[n]=-1,t&=~r}}function cl(e){if(0!==(6&Tc))throw Error(i(327));kl();var t=dt(e,0);if(0===(1&t))return rl(e,Je()),null;var n=gl(e,t);if(0!==e.tag&&2===n){var r=pt(e);0!==r&&(t=r,n=il(e,r))}if(1===n)throw n=Lc,dl(e,0),sl(e,t),rl(e,Je()),n;if(6===n)throw Error(i(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,wl(e,zc,Vc),rl(e,Je()),null}function ll(e,t){var n=Tc;Tc|=1;try{return e(t)}finally{0===(Tc=n)&&(Wc=Je()+500,Ba&&Wa())}}function ul(e){null!==Xc&&0===Xc.tag&&0===(6&Tc)&&kl();var t=Tc;Tc|=1;var n=Ic.transition,r=yt;try{if(Ic.transition=null,yt=1,e)return e()}finally{yt=r,Ic.transition=n,0===(6&(Tc=t))&&Wa()}}function hl(){Fc=Dc.current,Ca(Dc)}function dl(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,aa(n)),null!==Ac)for(n=Ac.return;null!==n;){var r=n;switch(ti(r),r.tag){case 1:null!==(r=r.type.childContextTypes)&&void 0!==r&&Da();break;case 3:$i(),Ca(_a),Ca(Ta),no();break;case 5:Qi(r);break;case 4:$i();break;case 13:case 19:Ca(Zi);break;case 10:Ii(r.type._context);break;case 22:case 23:hl()}n=n.return}if(_c=e,Ac=e=Dl(e.current,null),Rc=Fc=t,Oc=0,Lc=null,jc=Mc=Pc=0,zc=Bc=null,null!==Ri){for(t=0;t<Ri.length;t++)if(null!==(r=(n=Ri[t]).interleaved)){n.interleaved=null;var a=r.next,i=n.pending;if(null!==i){var o=i.next;i.next=a,r.next=o}n.pending=r}Ri=null}return e}function fl(e,t){for(;;){var n=Ac;try{if(Ei(),ro.current=Qo,lo){for(var r=oo.memoizedState;null!==r;){var a=r.queue;null!==a&&(a.pending=null),r=r.next}lo=!1}if(io=0,co=so=oo=null,uo=!1,ho=0,Ec.current=null,null===n||null===n.return){Oc=1,Lc=t,Ac=null;break}e:{var o=e,s=n.return,c=n,l=t;if(t=Rc,c.flags|=32768,null!==l&&"object"===typeof l&&"function"===typeof l.then){var u=l,h=c,d=h.tag;if(0===(1&h.mode)&&(0===d||11===d||15===d)){var f=h.alternate;f?(h.updateQueue=f.updateQueue,h.memoizedState=f.memoizedState,h.lanes=f.lanes):(h.updateQueue=null,h.memoizedState=null)}var p=gs(s);if(null!==p){p.flags&=-257,vs(p,s,c,0,t),1&p.mode&&ms(o,u,t),l=u;var m=(t=p).updateQueue;if(null===m){var g=new Set;g.add(l),t.updateQueue=g}else m.add(l);break e}if(0===(1&t)){ms(o,u,t),ml();break e}l=Error(i(426))}else if(ai&&1&c.mode){var v=gs(s);if(null!==v){0===(65536&v.flags)&&(v.flags|=256),vs(v,s,c,0,t),pi(ls(l,c));break e}}o=l=ls(l,c),4!==Oc&&(Oc=2),null===Bc?Bc=[o]:Bc.push(o),o=s;do{switch(o.tag){case 3:o.flags|=65536,t&=-t,o.lanes|=t,Ui(o,fs(0,l,t));break e;case 1:c=l;var b=o.type,y=o.stateNode;if(0===(128&o.flags)&&("function"===typeof b.getDerivedStateFromError||null!==y&&"function"===typeof y.componentDidCatch&&(null===qc||!qc.has(y)))){o.flags|=65536,t&=-t,o.lanes|=t,Ui(o,ps(o,c,t));break e}}o=o.return}while(null!==o)}xl(n)}catch(x){t=x,Ac===n&&null!==n&&(Ac=n=n.return);continue}break}}function pl(){var e=Cc.current;return Cc.current=Qo,null===e?Qo:e}function ml(){0!==Oc&&3!==Oc&&2!==Oc||(Oc=4),null===_c||0===(268435455&Pc)&&0===(268435455&Mc)||sl(_c,Rc)}function gl(e,t){var n=Tc;Tc|=2;var r=pl();for(_c===e&&Rc===t||(Vc=null,dl(e,t));;)try{vl();break}catch(a){fl(e,a)}if(Ei(),Tc=n,Cc.current=r,null!==Ac)throw Error(i(261));return _c=null,Rc=0,Oc}function vl(){for(;null!==Ac;)yl(Ac)}function bl(){for(;null!==Ac&&!Ye();)yl(Ac)}function yl(e){var t=Sc(e.alternate,e,Fc);e.memoizedProps=e.pendingProps,null===t?xl(e):Ac=t,Ec.current=null}function xl(e){var t=e;do{var n=t.alternate;if(e=t.return,0===(32768&t.flags)){if(null!==(n=Ks(n,t,Fc)))return void(Ac=n)}else{if(null!==(n=Xs(n,t)))return n.flags&=32767,void(Ac=n);if(null===e)return Oc=6,void(Ac=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}if(null!==(t=t.sibling))return void(Ac=t);Ac=t=e}while(null!==t);0===Oc&&(Oc=5)}function wl(e,t,n){var r=yt,a=Ic.transition;try{Ic.transition=null,yt=1,function(e,t,n,r){do{kl()}while(null!==Xc);if(0!==(6&Tc))throw Error(i(327));n=e.finishedWork;var a=e.finishedLanes;if(null===n)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(i(177));e.callbackNode=null,e.callbackPriority=0;var o=n.lanes|n.childLanes;if(function(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var r=e.eventTimes;for(e=e.expirationTimes;0<n;){var a=31-ot(n),i=1<<a;t[a]=0,r[a]=-1,e[a]=-1,n&=~i}}(e,o),e===_c&&(Ac=_c=null,Rc=0),0===(2064&n.subtreeFlags)&&0===(2064&n.flags)||Kc||(Kc=!0,_l(tt,function(){return kl(),null})),o=0!==(15990&n.flags),0!==(15990&n.subtreeFlags)||o){o=Ic.transition,Ic.transition=null;var s=yt;yt=1;var c=Tc;Tc|=4,Ec.current=null,function(e,t){if(ea=Ht,fr(e=dr())){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var r=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(r&&0!==r.rangeCount){n=r.anchorNode;var a=r.anchorOffset,o=r.focusNode;r=r.focusOffset;try{n.nodeType,o.nodeType}catch(w){n=null;break e}var s=0,c=-1,l=-1,u=0,h=0,d=e,f=null;t:for(;;){for(var p;d!==n||0!==a&&3!==d.nodeType||(c=s+a),d!==o||0!==r&&3!==d.nodeType||(l=s+r),3===d.nodeType&&(s+=d.nodeValue.length),null!==(p=d.firstChild);)f=d,d=p;for(;;){if(d===e)break t;if(f===n&&++u===a&&(c=s),f===o&&++h===r&&(l=s),null!==(p=d.nextSibling))break;f=(d=f).parentNode}d=p}n=-1===c||-1===l?null:{start:c,end:l}}else n=null}n=n||{start:0,end:0}}else n=null;for(ta={focusedElem:e,selectionRange:n},Ht=!1,Qs=t;null!==Qs;)if(e=(t=Qs).child,0!==(1028&t.subtreeFlags)&&null!==e)e.return=t,Qs=e;else for(;null!==Qs;){t=Qs;try{var m=t.alternate;if(0!==(1024&t.flags))switch(t.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==m){var g=m.memoizedProps,v=m.memoizedState,b=t.stateNode,y=b.getSnapshotBeforeUpdate(t.elementType===t.type?g:ns(t.type,g),v);b.__reactInternalSnapshotBeforeUpdate=y}break;case 3:var x=t.stateNode.containerInfo;1===x.nodeType?x.textContent="":9===x.nodeType&&x.documentElement&&x.removeChild(x.documentElement);break;default:throw Error(i(163))}}catch(w){Nl(t,t.return,w)}if(null!==(e=t.sibling)){e.return=t.return,Qs=e;break}Qs=t.return}m=tc,tc=!1}(e,n),gc(n,e),pr(ta),Ht=!!ea,ta=ea=null,e.current=n,bc(n,e,a),$e(),Tc=c,yt=s,Ic.transition=o}else e.current=n;if(Kc&&(Kc=!1,Xc=e,Yc=a),o=e.pendingLanes,0===o&&(qc=null),function(e){if(it&&"function"===typeof it.onCommitFiberRoot)try{it.onCommitFiberRoot(at,e,void 0,128===(128&e.current.flags))}catch(t){}}(n.stateNode),rl(e,Je()),null!==t)for(r=e.onRecoverableError,n=0;n<t.length;n++)a=t[n],r(a.value,{componentStack:a.stack,digest:a.digest});if(Hc)throw Hc=!1,e=Gc,Gc=null,e;0!==(1&Yc)&&0!==e.tag&&kl(),o=e.pendingLanes,0!==(1&o)?e===Jc?$c++:($c=0,Jc=e):$c=0,Wa()}(e,t,n,r)}finally{Ic.transition=a,yt=r}return null}function kl(){if(null!==Xc){var e=xt(Yc),t=Ic.transition,n=yt;try{if(Ic.transition=null,yt=16>e?16:e,null===Xc)var r=!1;else{if(e=Xc,Xc=null,Yc=0,0!==(6&Tc))throw Error(i(331));var a=Tc;for(Tc|=4,Qs=e.current;null!==Qs;){var o=Qs,s=o.child;if(0!==(16&Qs.flags)){var c=o.deletions;if(null!==c){for(var l=0;l<c.length;l++){var u=c[l];for(Qs=u;null!==Qs;){var h=Qs;switch(h.tag){case 0:case 11:case 15:nc(8,h,o)}var d=h.child;if(null!==d)d.return=h,Qs=d;else for(;null!==Qs;){var f=(h=Qs).sibling,p=h.return;if(ic(h),h===u){Qs=null;break}if(null!==f){f.return=p,Qs=f;break}Qs=p}}}var m=o.alternate;if(null!==m){var g=m.child;if(null!==g){m.child=null;do{var v=g.sibling;g.sibling=null,g=v}while(null!==g)}}Qs=o}}if(0!==(2064&o.subtreeFlags)&&null!==s)s.return=o,Qs=s;else e:for(;null!==Qs;){if(0!==(2048&(o=Qs).flags))switch(o.tag){case 0:case 11:case 15:nc(9,o,o.return)}var b=o.sibling;if(null!==b){b.return=o.return,Qs=b;break e}Qs=o.return}}var y=e.current;for(Qs=y;null!==Qs;){var x=(s=Qs).child;if(0!==(2064&s.subtreeFlags)&&null!==x)x.return=s,Qs=x;else e:for(s=y;null!==Qs;){if(0!==(2048&(c=Qs).flags))try{switch(c.tag){case 0:case 11:case 15:rc(9,c)}}catch(k){Nl(c,c.return,k)}if(c===s){Qs=null;break e}var w=c.sibling;if(null!==w){w.return=c.return,Qs=w;break e}Qs=c.return}}if(Tc=a,Wa(),it&&"function"===typeof it.onPostCommitFiberRoot)try{it.onPostCommitFiberRoot(at,e)}catch(k){}r=!0}return r}finally{yt=n,Ic.transition=t}}return!1}function Sl(e,t,n){e=Bi(e,t=fs(0,t=ls(n,t),1),1),t=el(),null!==e&&(vt(e,1,t),rl(e,t))}function Nl(e,t,n){if(3===e.tag)Sl(e,e,n);else for(;null!==t;){if(3===t.tag){Sl(t,e,n);break}if(1===t.tag){var r=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof r.componentDidCatch&&(null===qc||!qc.has(r))){t=Bi(t,e=ps(t,e=ls(n,e),1),1),e=el(),null!==t&&(vt(t,1,e),rl(t,e));break}}t=t.return}}function Cl(e,t,n){var r=e.pingCache;null!==r&&r.delete(t),t=el(),e.pingedLanes|=e.suspendedLanes&n,_c===e&&(Rc&n)===n&&(4===Oc||3===Oc&&(130023424&Rc)===Rc&&500>Je()-Uc?dl(e,0):jc|=n),rl(e,t)}function El(e,t){0===t&&(0===(1&e.mode)?t=1:(t=ut,0===(130023424&(ut<<=1))&&(ut=4194304)));var n=el();null!==(e=Oi(e,t))&&(vt(e,t,n),rl(e,n))}function Il(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),El(e,n)}function Tl(e,t){var n=0;switch(e.tag){case 13:var r=e.stateNode,a=e.memoizedState;null!==a&&(n=a.retryLane);break;case 19:r=e.stateNode;break;default:throw Error(i(314))}null!==r&&r.delete(t),El(e,n)}function _l(e,t){return Ke(e,t)}function Al(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Rl(e,t,n,r){return new Al(e,t,n,r)}function Fl(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Dl(e,t){var n=e.alternate;return null===n?((n=Rl(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=14680064&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Ol(e,t,n,r,a,o){var s=2;if(r=e,"function"===typeof e)Fl(e)&&(s=1);else if("string"===typeof e)s=5;else e:switch(e){case S:return Ll(n.children,a,o,t);case N:s=8,a|=8;break;case C:return(e=Rl(12,n,t,2|a)).elementType=C,e.lanes=o,e;case _:return(e=Rl(13,n,t,a)).elementType=_,e.lanes=o,e;case A:return(e=Rl(19,n,t,a)).elementType=A,e.lanes=o,e;case D:return Pl(n,a,o,t);default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case E:s=10;break e;case I:s=9;break e;case T:s=11;break e;case R:s=14;break e;case F:s=16,r=null;break e}throw Error(i(130,null==e?e:typeof e,""))}return(t=Rl(s,n,t,a)).elementType=e,t.type=r,t.lanes=o,t}function Ll(e,t,n,r){return(e=Rl(7,e,r,t)).lanes=n,e}function Pl(e,t,n,r){return(e=Rl(22,e,r,t)).elementType=D,e.lanes=n,e.stateNode={isHidden:!1},e}function Ml(e,t,n){return(e=Rl(6,e,null,t)).lanes=n,e}function jl(e,t,n){return(t=Rl(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Bl(e,t,n,r,a){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=gt(0),this.expirationTimes=gt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=gt(0),this.identifierPrefix=r,this.onRecoverableError=a,this.mutableSourceEagerHydrationData=null}function zl(e,t,n,r,a,i,o,s,c){return e=new Bl(e,t,n,s,c),1===t?(t=1,!0===i&&(t|=8)):t=0,i=Rl(3,null,null,t),e.current=i,i.stateNode=e,i.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Pi(i),e}function Ul(e){if(!e)return Ia;e:{if(We(e=e._reactInternals)!==e||1!==e.tag)throw Error(i(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Fa(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(i(171))}if(1===e.tag){var n=e.type;if(Fa(n))return La(e,n,t)}return t}function Wl(e,t,n,r,a,i,o,s,c){return(e=zl(n,r,!0,e,0,i,0,s,c)).context=Ul(null),n=e.current,(i=ji(r=el(),a=tl(n))).callback=void 0!==t&&null!==t?t:null,Bi(n,i,a),e.current.lanes=a,vt(e,a,r),rl(e,r),e}function Vl(e,t,n,r){var a=t.current,i=el(),o=tl(a);return n=Ul(n),null===t.context?t.context=n:t.pendingContext=n,(t=ji(i,o)).payload={element:e},null!==(r=void 0===r?null:r)&&(t.callback=r),null!==(e=Bi(a,t,o))&&(nl(e,a,o,i),zi(e,a,o)),o}function Hl(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function Gl(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function ql(e,t){Gl(e,t),(e=e.alternate)&&Gl(e,t)}Sc=function(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps||_a.current)ys=!0;else{if(0===(e.lanes&n)&&0===(128&t.flags))return ys=!1,function(e,t,n){switch(t.tag){case 3:_s(t),fi();break;case 5:Ji(t);break;case 1:Fa(t.type)&&Pa(t);break;case 4:Yi(t,t.stateNode.containerInfo);break;case 10:var r=t.type._context,a=t.memoizedProps.value;Ea(ki,r._currentValue),r._currentValue=a;break;case 13:if(null!==(r=t.memoizedState))return null!==r.dehydrated?(Ea(Zi,1&Zi.current),t.flags|=128,null):0!==(n&t.child.childLanes)?Ms(e,t,n):(Ea(Zi,1&Zi.current),null!==(e=Hs(e,t,n))?e.sibling:null);Ea(Zi,1&Zi.current);break;case 19:if(r=0!==(n&t.childLanes),0!==(128&e.flags)){if(r)return Ws(e,t,n);t.flags|=128}if(null!==(a=t.memoizedState)&&(a.rendering=null,a.tail=null,a.lastEffect=null),Ea(Zi,Zi.current),r)break;return null;case 22:case 23:return t.lanes=0,Ns(e,t,n)}return Hs(e,t,n)}(e,t,n);ys=0!==(131072&e.flags)}else ys=!1,ai&&0!==(1048576&t.flags)&&Za(t,qa,t.index);switch(t.lanes=0,t.tag){case 2:var r=t.type;Vs(e,t),e=t.pendingProps;var a=Ra(t,Ta.current);_i(t,n),a=go(null,t,r,e,a,n);var o=vo();return t.flags|=1,"object"===typeof a&&null!==a&&"function"===typeof a.render&&void 0===a.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Fa(r)?(o=!0,Pa(t)):o=!1,t.memoizedState=null!==a.state&&void 0!==a.state?a.state:null,Pi(t),a.updater=as,t.stateNode=a,a._reactInternals=t,cs(t,r,e,n),t=Ts(null,t,r,!0,o,n)):(t.tag=0,ai&&o&&ei(t),xs(null,t,a,n),t=t.child),t;case 16:r=t.elementType;e:{switch(Vs(e,t),e=t.pendingProps,r=(a=r._init)(r._payload),t.type=r,a=t.tag=function(e){if("function"===typeof e)return Fl(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===T)return 11;if(e===R)return 14}return 2}(r),e=ns(r,e),a){case 0:t=Es(null,t,r,e,n);break e;case 1:t=Is(null,t,r,e,n);break e;case 11:t=ws(null,t,r,e,n);break e;case 14:t=ks(null,t,r,ns(r.type,e),n);break e}throw Error(i(306,r,""))}return t;case 0:return r=t.type,a=t.pendingProps,Es(e,t,r,a=t.elementType===r?a:ns(r,a),n);case 1:return r=t.type,a=t.pendingProps,Is(e,t,r,a=t.elementType===r?a:ns(r,a),n);case 3:e:{if(_s(t),null===e)throw Error(i(387));r=t.pendingProps,a=(o=t.memoizedState).element,Mi(e,t),Wi(t,r,null,n);var s=t.memoizedState;if(r=s.element,o.isDehydrated){if(o={element:r,isDehydrated:!1,cache:s.cache,pendingSuspenseBoundaries:s.pendingSuspenseBoundaries,transitions:s.transitions},t.updateQueue.baseState=o,t.memoizedState=o,256&t.flags){t=As(e,t,r,n,a=ls(Error(i(423)),t));break e}if(r!==a){t=As(e,t,r,n,a=ls(Error(i(424)),t));break e}for(ri=la(t.stateNode.containerInfo.firstChild),ni=t,ai=!0,ii=null,n=wi(t,null,r,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(fi(),r===a){t=Hs(e,t,n);break e}xs(e,t,r,n)}t=t.child}return t;case 5:return Ji(t),null===e&&li(t),r=t.type,a=t.pendingProps,o=null!==e?e.memoizedProps:null,s=a.children,na(r,a)?s=null:null!==o&&na(r,o)&&(t.flags|=32),Cs(e,t),xs(e,t,s,n),t.child;case 6:return null===e&&li(t),null;case 13:return Ms(e,t,n);case 4:return Yi(t,t.stateNode.containerInfo),r=t.pendingProps,null===e?t.child=xi(t,null,r,n):xs(e,t,r,n),t.child;case 11:return r=t.type,a=t.pendingProps,ws(e,t,r,a=t.elementType===r?a:ns(r,a),n);case 7:return xs(e,t,t.pendingProps,n),t.child;case 8:case 12:return xs(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(r=t.type._context,a=t.pendingProps,o=t.memoizedProps,s=a.value,Ea(ki,r._currentValue),r._currentValue=s,null!==o)if(sr(o.value,s)){if(o.children===a.children&&!_a.current){t=Hs(e,t,n);break e}}else for(null!==(o=t.child)&&(o.return=t);null!==o;){var c=o.dependencies;if(null!==c){s=o.child;for(var l=c.firstContext;null!==l;){if(l.context===r){if(1===o.tag){(l=ji(-1,n&-n)).tag=2;var u=o.updateQueue;if(null!==u){var h=(u=u.shared).pending;null===h?l.next=l:(l.next=h.next,h.next=l),u.pending=l}}o.lanes|=n,null!==(l=o.alternate)&&(l.lanes|=n),Ti(o.return,n,t),c.lanes|=n;break}l=l.next}}else if(10===o.tag)s=o.type===t.type?null:o.child;else if(18===o.tag){if(null===(s=o.return))throw Error(i(341));s.lanes|=n,null!==(c=s.alternate)&&(c.lanes|=n),Ti(s,n,t),s=o.sibling}else s=o.child;if(null!==s)s.return=o;else for(s=o;null!==s;){if(s===t){s=null;break}if(null!==(o=s.sibling)){o.return=s.return,s=o;break}s=s.return}o=s}xs(e,t,a.children,n),t=t.child}return t;case 9:return a=t.type,r=t.pendingProps.children,_i(t,n),r=r(a=Ai(a)),t.flags|=1,xs(e,t,r,n),t.child;case 14:return a=ns(r=t.type,t.pendingProps),ks(e,t,r,a=ns(r.type,a),n);case 15:return Ss(e,t,t.type,t.pendingProps,n);case 17:return r=t.type,a=t.pendingProps,a=t.elementType===r?a:ns(r,a),Vs(e,t),t.tag=1,Fa(r)?(e=!0,Pa(t)):e=!1,_i(t,n),os(t,r,a),cs(t,r,a,n),Ts(null,t,r,!0,e,n);case 19:return Ws(e,t,n);case 22:return Ns(e,t,n)}throw Error(i(156,t.tag))};var Kl="function"===typeof reportError?reportError:function(e){console.error(e)};function Xl(e){this._internalRoot=e}function Yl(e){this._internalRoot=e}function $l(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function Jl(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function Ql(){}function Zl(e,t,n,r,a){var i=n._reactRootContainer;if(i){var o=i;if("function"===typeof a){var s=a;a=function(){var e=Hl(o);s.call(e)}}Vl(t,o,e,a)}else o=function(e,t,n,r,a){if(a){if("function"===typeof r){var i=r;r=function(){var e=Hl(o);i.call(e)}}var o=Wl(t,r,e,0,null,!1,0,"",Ql);return e._reactRootContainer=o,e[pa]=o.current,Wr(8===e.nodeType?e.parentNode:e),ul(),o}for(;a=e.lastChild;)e.removeChild(a);if("function"===typeof r){var s=r;r=function(){var e=Hl(c);s.call(e)}}var c=zl(e,0,!1,null,0,!1,0,"",Ql);return e._reactRootContainer=c,e[pa]=c.current,Wr(8===e.nodeType?e.parentNode:e),ul(function(){Vl(t,c,n,r)}),c}(n,t,e,a,r);return Hl(o)}Yl.prototype.render=Xl.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(i(409));Vl(e,t,null,null)},Yl.prototype.unmount=Xl.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;ul(function(){Vl(null,e,null,null)}),t[pa]=null}},Yl.prototype.unstable_scheduleHydration=function(e){if(e){var t=Nt();e={blockedOn:null,target:e,priority:t};for(var n=0;n<Dt.length&&0!==t&&t<Dt[n].priority;n++);Dt.splice(n,0,e),0===n&&Mt(e)}},wt=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=ht(t.pendingLanes);0!==n&&(bt(t,1|n),rl(t,Je()),0===(6&Tc)&&(Wc=Je()+500,Wa()))}break;case 13:ul(function(){var t=Oi(e,1);if(null!==t){var n=el();nl(t,e,1,n)}}),ql(e,1)}},kt=function(e){if(13===e.tag){var t=Oi(e,134217728);if(null!==t)nl(t,e,134217728,el());ql(e,134217728)}},St=function(e){if(13===e.tag){var t=tl(e),n=Oi(e,t);if(null!==n)nl(n,e,t,el());ql(e,t)}},Nt=function(){return yt},Ct=function(e,t){var n=yt;try{return yt=e,t()}finally{yt=n}},ke=function(e,t,n){switch(t){case"input":if(Q(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var a=wa(r);if(!a)throw Error(i(90));K(r),Q(r,a)}}}break;case"textarea":ie(e,n);break;case"select":null!=(t=n.value)&&ne(e,!!n.multiple,t,!1)}},Te=ll,_e=ul;var eu={usingClientEntryPoint:!1,Events:[ya,xa,wa,Ee,Ie,ll]},tu={findFiberByHostInstance:ba,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},nu={bundleType:tu.bundleType,version:tu.version,rendererPackageName:tu.rendererPackageName,rendererConfig:tu.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:x.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=Ge(e))?null:e.stateNode},findFiberByHostInstance:tu.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var ru=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ru.isDisabled&&ru.supportsFiber)try{at=ru.inject(nu),it=ru}catch(ue){}}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=eu,t.createPortal=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!$l(t))throw Error(i(200));return function(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:k,key:null==r?null:""+r,children:e,containerInfo:t,implementation:n}}(e,t,null,n)},t.createRoot=function(e,t){if(!$l(e))throw Error(i(299));var n=!1,r="",a=Kl;return null!==t&&void 0!==t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(r=t.identifierPrefix),void 0!==t.onRecoverableError&&(a=t.onRecoverableError)),t=zl(e,1,!1,null,0,n,0,r,a),e[pa]=t.current,Wr(8===e.nodeType?e.parentNode:e),new Xl(t)},t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(i(188));throw e=Object.keys(e).join(","),Error(i(268,e))}return e=null===(e=Ge(t))?null:e.stateNode},t.flushSync=function(e){return ul(e)},t.hydrate=function(e,t,n){if(!Jl(t))throw Error(i(200));return Zl(null,e,t,!0,n)},t.hydrateRoot=function(e,t,n){if(!$l(e))throw Error(i(405));var r=null!=n&&n.hydratedSources||null,a=!1,o="",s=Kl;if(null!==n&&void 0!==n&&(!0===n.unstable_strictMode&&(a=!0),void 0!==n.identifierPrefix&&(o=n.identifierPrefix),void 0!==n.onRecoverableError&&(s=n.onRecoverableError)),t=Wl(t,null,e,1,null!=n?n:null,a,0,o,s),e[pa]=t.current,Wr(e),r)for(e=0;e<r.length;e++)a=(a=(n=r[e])._getVersion)(n._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[n,a]:t.mutableSourceEagerHydrationData.push(n,a);return new Yl(t)},t.render=function(e,t,n){if(!Jl(t))throw Error(i(200));return Zl(null,e,t,!1,n)},t.unmountComponentAtNode=function(e){if(!Jl(e))throw Error(i(40));return!!e._reactRootContainer&&(ul(function(){Zl(null,null,e,!1,function(){e._reactRootContainer=null,e[pa]=null})}),!0)},t.unstable_batchedUpdates=ll,t.unstable_renderSubtreeIntoContainer=function(e,t,n,r){if(!Jl(n))throw Error(i(200));if(null==e||void 0===e._reactInternals)throw Error(i(38));return Zl(e,t,n,!1,r)},t.version="18.3.1-next-f1338f8080-20240426"},8590:()=>{},9019:(e,t,n)=>{"use strict";n.r(t),n.d(t,{AcroForm:()=>bt,AcroFormAppearance:()=>gt,AcroFormButton:()=>lt,AcroFormCheckBox:()=>ft,AcroFormChoiceField:()=>it,AcroFormComboBox:()=>st,AcroFormEditBox:()=>ct,AcroFormListBox:()=>ot,AcroFormPasswordField:()=>mt,AcroFormPushButton:()=>ut,AcroFormRadioButton:()=>ht,AcroFormTextField:()=>pt,GState:()=>Ee,ShadingPattern:()=>Te,TilingPattern:()=>_e,default:()=>vn,jsPDF:()=>Ae});var r=n(2284),a=Uint8Array,i=Uint16Array,o=Uint32Array,s=new a([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),c=new a([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),l=new a([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),u=function(e,t){for(var n=new i(31),r=0;r<31;++r)n[r]=t+=1<<e[r-1];var a=new o(n[30]);for(r=1;r<30;++r)for(var s=n[r];s<n[r+1];++s)a[s]=s-n[r]<<5|r;return[n,a]},h=u(s,2),d=h[0],f=h[1];d[28]=258,f[258]=28;for(var p=u(c,0),m=p[0],g=p[1],v=new i(32768),b=0;b<32768;++b){var y=(43690&b)>>>1|(21845&b)<<1;y=(61680&(y=(52428&y)>>>2|(13107&y)<<2))>>>4|(3855&y)<<4,v[b]=((65280&y)>>>8|(255&y)<<8)>>>1}var x=function(e,t,n){for(var r=e.length,a=0,o=new i(t);a<r;++a)++o[e[a]-1];var s,c=new i(t);for(a=0;a<t;++a)c[a]=c[a-1]+o[a-1]<<1;if(n){s=new i(1<<t);var l=15-t;for(a=0;a<r;++a)if(e[a])for(var u=a<<4|e[a],h=t-e[a],d=c[e[a]-1]++<<h,f=d|(1<<h)-1;d<=f;++d)s[v[d]>>>l]=u}else for(s=new i(r),a=0;a<r;++a)s[a]=v[c[e[a]-1]++]>>>15-e[a];return s},w=new a(288);for(b=0;b<144;++b)w[b]=8;for(b=144;b<256;++b)w[b]=9;for(b=256;b<280;++b)w[b]=7;for(b=280;b<288;++b)w[b]=8;var k=new a(32);for(b=0;b<32;++b)k[b]=5;var S=x(w,9,0),N=x(w,9,1),C=x(k,5,0),E=x(k,5,1),I=function(e){for(var t=e[0],n=1;n<e.length;++n)e[n]>t&&(t=e[n]);return t},T=function(e,t,n){var r=t/8|0;return(e[r]|e[r+1]<<8)>>>(7&t)&n},_=function(e,t){var n=t/8|0;return(e[n]|e[n+1]<<8|e[n+2]<<16)>>>(7&t)},A=function(e){return(e/8|0)+(7&e&&1)},R=function(e,t,n){(null==t||t<0)&&(t=0),(null==n||n>e.length)&&(n=e.length);var r=new(e instanceof i?i:e instanceof o?o:a)(n-t);return r.set(e.subarray(t,n)),r},F=function(e,t,n){var r=e.length,i=!t||n,o=!n||n.i;n||(n={}),t||(t=new a(3*r));var u=function(e){var n=t.length;if(e>n){var r=new a(Math.max(2*n,e));r.set(t),t=r}},h=n.f||0,f=n.p||0,p=n.b||0,g=n.l,v=n.d,b=n.m,y=n.n,w=8*r;do{if(!g){n.f=h=T(e,f,1);var k=T(e,f+1,3);if(f+=3,!k){var S=e[(U=A(f)+4)-4]|e[U-3]<<8,C=U+S;if(C>r){if(o)throw"unexpected EOF";break}i&&u(p+S),t.set(e.subarray(U,C),p),n.b=p+=S,n.p=f=8*C;continue}if(1==k)g=N,v=E,b=9,y=5;else{if(2!=k)throw"invalid block type";var F=T(e,f,31)+257,D=T(e,f+10,15)+4,O=F+T(e,f+5,31)+1;f+=14;for(var L=new a(O),P=new a(19),M=0;M<D;++M)P[l[M]]=T(e,f+3*M,7);f+=3*D;var j=I(P),B=(1<<j)-1;if(!o&&f+O*(j+7)>w)break;var z=x(P,j,1);for(M=0;M<O;){var U,W=z[T(e,f,B)];if(f+=15&W,(U=W>>>4)<16)L[M++]=U;else{var V=0,H=0;for(16==U?(H=3+T(e,f,3),f+=2,V=L[M-1]):17==U?(H=3+T(e,f,7),f+=3):18==U&&(H=11+T(e,f,127),f+=7);H--;)L[M++]=V}}var G=L.subarray(0,F),q=L.subarray(F);b=I(G),y=I(q),g=x(G,b,1),v=x(q,y,1)}if(f>w)throw"unexpected EOF"}i&&u(p+131072);for(var K=(1<<b)-1,X=(1<<y)-1,Y=b+y+18;o||f+Y<w;){var $=(V=g[_(e,f)&K])>>>4;if((f+=15&V)>w)throw"unexpected EOF";if(!V)throw"invalid length/literal";if($<256)t[p++]=$;else{if(256==$){g=null;break}var J=$-254;if($>264){var Q=s[M=$-257];J=T(e,f,(1<<Q)-1)+d[M],f+=Q}var Z=v[_(e,f)&X],ee=Z>>>4;if(!Z)throw"invalid distance";f+=15&Z;q=m[ee];if(ee>3){Q=c[ee];q+=_(e,f)&(1<<Q)-1,f+=Q}if(f>w)throw"unexpected EOF";i&&u(p+131072);for(var te=p+J;p<te;p+=4)t[p]=t[p-q],t[p+1]=t[p+1-q],t[p+2]=t[p+2-q],t[p+3]=t[p+3-q];p=te}}n.l=g,n.p=f,n.b=p,g&&(h=1,n.m=b,n.d=v,n.n=y)}while(!h);return p==t.length?t:R(t,0,p)},D=function(e,t,n){n<<=7&t;var r=t/8|0;e[r]|=n,e[r+1]|=n>>>8},O=function(e,t,n){n<<=7&t;var r=t/8|0;e[r]|=n,e[r+1]|=n>>>8,e[r+2]|=n>>>16},L=function(e,t){for(var n=[],r=0;r<e.length;++r)e[r]&&n.push({s:r,f:e[r]});var o=n.length,s=n.slice();if(!o)return[new a(0),0];if(1==o){var c=new a(n[0].s+1);return c[n[0].s]=1,[c,1]}n.sort(function(e,t){return e.f-t.f}),n.push({s:-1,f:25001});var l=n[0],u=n[1],h=0,d=1,f=2;for(n[0]={s:-1,f:l.f+u.f,l:l,r:u};d!=o-1;)l=n[n[h].f<n[f].f?h++:f++],u=n[h!=d&&n[h].f<n[f].f?h++:f++],n[d++]={s:-1,f:l.f+u.f,l:l,r:u};var p=s[0].s;for(r=1;r<o;++r)s[r].s>p&&(p=s[r].s);var m=new i(p+1),g=P(n[d-1],m,0);if(g>t){r=0;var v=0,b=g-t,y=1<<b;for(s.sort(function(e,t){return m[t.s]-m[e.s]||e.f-t.f});r<o;++r){var x=s[r].s;if(!(m[x]>t))break;v+=y-(1<<g-m[x]),m[x]=t}for(v>>>=b;v>0;){var w=s[r].s;m[w]<t?v-=1<<t-m[w]++-1:++r}for(;r>=0&&v;--r){var k=s[r].s;m[k]==t&&(--m[k],++v)}g=t}return[new a(m),g]},P=function(e,t,n){return-1==e.s?Math.max(P(e.l,t,n+1),P(e.r,t,n+1)):t[e.s]=n},M=function(e){for(var t=e.length;t&&!e[--t];);for(var n=new i(++t),r=0,a=e[0],o=1,s=function(e){n[r++]=e},c=1;c<=t;++c)if(e[c]==a&&c!=t)++o;else{if(!a&&o>2){for(;o>138;o-=138)s(32754);o>2&&(s(o>10?o-11<<5|28690:o-3<<5|12305),o=0)}else if(o>3){for(s(a),--o;o>6;o-=6)s(8304);o>2&&(s(o-3<<5|8208),o=0)}for(;o--;)s(a);o=1,a=e[c]}return[n.subarray(0,r),t]},j=function(e,t){for(var n=0,r=0;r<t.length;++r)n+=e[r]*t[r];return n},B=function(e,t,n){var r=n.length,a=A(t+2);e[a]=255&r,e[a+1]=r>>>8,e[a+2]=255^e[a],e[a+3]=255^e[a+1];for(var i=0;i<r;++i)e[a+i+4]=n[i];return 8*(a+4+r)},z=function(e,t,n,r,a,o,u,h,d,f,p){D(t,p++,n),++a[256];for(var m=L(a,15),g=m[0],v=m[1],b=L(o,15),y=b[0],N=b[1],E=M(g),I=E[0],T=E[1],_=M(y),A=_[0],R=_[1],F=new i(19),P=0;P<I.length;++P)F[31&I[P]]++;for(P=0;P<A.length;++P)F[31&A[P]]++;for(var z=L(F,7),U=z[0],W=z[1],V=19;V>4&&!U[l[V-1]];--V);var H,G,q,K,X=f+5<<3,Y=j(a,w)+j(o,k)+u,$=j(a,g)+j(o,y)+u+14+3*V+j(F,U)+(2*F[16]+3*F[17]+7*F[18]);if(X<=Y&&X<=$)return B(t,p,e.subarray(d,d+f));if(D(t,p,1+($<Y)),p+=2,$<Y){H=x(g,v,0),G=g,q=x(y,N,0),K=y;var J=x(U,W,0);D(t,p,T-257),D(t,p+5,R-1),D(t,p+10,V-4),p+=14;for(P=0;P<V;++P)D(t,p+3*P,U[l[P]]);p+=3*V;for(var Q=[I,A],Z=0;Z<2;++Z){var ee=Q[Z];for(P=0;P<ee.length;++P){var te=31&ee[P];D(t,p,J[te]),p+=U[te],te>15&&(D(t,p,ee[P]>>>5&127),p+=ee[P]>>>12)}}}else H=S,G=w,q=C,K=k;for(P=0;P<h;++P)if(r[P]>255){te=r[P]>>>18&31;O(t,p,H[te+257]),p+=G[te+257],te>7&&(D(t,p,r[P]>>>23&31),p+=s[te]);var ne=31&r[P];O(t,p,q[ne]),p+=K[ne],ne>3&&(O(t,p,r[P]>>>5&8191),p+=c[ne])}else O(t,p,H[r[P]]),p+=G[r[P]];return O(t,p,H[256]),p+G[256]},U=new o([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),W=new a(0),V=function(e,t,n,r,l,u){var h=e.length,d=new a(r+h+5*(1+Math.floor(h/7e3))+l),p=d.subarray(r,d.length-l),m=0;if(!t||h<8)for(var v=0;v<=h;v+=65535){var b=v+65535;b<h?m=B(p,m,e.subarray(v,b)):(p[v]=u,m=B(p,m,e.subarray(v,h)))}else{for(var y=U[t-1],x=y>>>13,w=8191&y,k=(1<<n)-1,S=new i(32768),N=new i(k+1),C=Math.ceil(n/3),E=2*C,I=function(t){return(e[t]^e[t+1]<<C^e[t+2]<<E)&k},T=new o(25e3),_=new i(288),F=new i(32),D=0,O=0,L=(v=0,0),P=0,M=0;v<h;++v){var j=I(v),V=32767&v,H=N[j];if(S[V]=H,N[j]=V,P<=v){var G=h-v;if((D>7e3||L>24576)&&G>423){m=z(e,p,0,T,_,F,O,L,M,v-M,m),L=D=O=0,M=v;for(var q=0;q<286;++q)_[q]=0;for(q=0;q<30;++q)F[q]=0}var K=2,X=0,Y=w,$=V-H&32767;if(G>2&&j==I(v-$))for(var J=Math.min(x,G)-1,Q=Math.min(32767,v),Z=Math.min(258,G);$<=Q&&--Y&&V!=H;){if(e[v+K]==e[v+K-$]){for(var ee=0;ee<Z&&e[v+ee]==e[v+ee-$];++ee);if(ee>K){if(K=ee,X=$,ee>J)break;var te=Math.min($,ee-2),ne=0;for(q=0;q<te;++q){var re=v-$+q+32768&32767,ae=re-S[re]+32768&32767;ae>ne&&(ne=ae,H=re)}}}$+=(V=H)-(H=S[V])+32768&32767}if(X){T[L++]=268435456|f[K]<<18|g[X];var ie=31&f[K],oe=31&g[X];O+=s[ie]+c[oe],++_[257+ie],++F[oe],P=v+K,++D}else T[L++]=e[v],++_[e[v]]}}m=z(e,p,u,T,_,F,O,L,M,v-M,m),u||(m=B(p,m,W))}return R(d,0,r+A(m)+l)},H=function(){var e=1,t=0;return{p:function(n){for(var r=e,a=t,i=n.length,o=0;o!=i;){for(var s=Math.min(o+5552,i);o<s;++o)a+=r+=n[o];r%=65521,a%=65521}e=r,t=a},d:function(){return(e>>>8<<16|(255&t)<<8|t>>>8)+2*((255&e)<<23)}}},G=function(e,t,n,r,a){return V(e,null==t.level?6:t.level,null==t.mem?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(e.length)))):12+t.mem,n,r,!a)},q=function(e,t,n){for(;n;++t)e[t]=n,n>>>=8},K=function(e,t){var n=t.level,r=0==n?0:n<6?1:9==n?3:2;e[0]=120,e[1]=r<<6|(r?32-2*r:1)},X=function(e){if(8!=(15&e[0])||e[0]>>>4>7||(e[0]<<8|e[1])%31)throw"invalid zlib data";if(32&e[1])throw"invalid zlib data: preset dictionaries not supported"};function Y(e,t){void 0===t&&(t={});var n=H();n.p(e);var r=G(e,t,2,4);return K(r,t),q(r,r.length-4,n.d()),r}function $(e,t){return F((X(e),e.subarray(2,-4)),t)}var J=function(){return"undefined"!=typeof window?window:"undefined"!=typeof n.g?n.g:"undefined"!=typeof self?self:this}();function Q(){J.console&&"function"==typeof J.console.log&&J.console.log.apply(J.console,arguments)}var Z={log:Q,warn:function(e){J.console&&("function"==typeof J.console.warn?J.console.warn.apply(J.console,arguments):Q.call(null,arguments))},error:function(e){J.console&&("function"==typeof J.console.error?J.console.error.apply(J.console,arguments):Q(e))}};function ee(e,t,n){var r=new XMLHttpRequest;r.open("GET",e),r.responseType="blob",r.onload=function(){ie(r.response,t,n)},r.onerror=function(){Z.error("could not download file")},r.send()}function te(e){var t=new XMLHttpRequest;t.open("HEAD",e,!1);try{t.send()}catch(e){}return t.status>=200&&t.status<=299}function ne(e){try{e.dispatchEvent(new MouseEvent("click"))}catch(n){var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(t)}}var re,ae,ie=J.saveAs||("object"!==("undefined"==typeof window?"undefined":(0,r.A)(window))||window!==J?function(){}:"undefined"!=typeof HTMLAnchorElement&&"download"in HTMLAnchorElement.prototype?function(e,t,n){var r=J.URL||J.webkitURL,a=document.createElement("a");t=t||e.name||"download",a.download=t,a.rel="noopener","string"==typeof e?(a.href=e,a.origin!==location.origin?te(a.href)?ee(e,t,n):ne(a,a.target="_blank"):ne(a)):(a.href=r.createObjectURL(e),setTimeout(function(){r.revokeObjectURL(a.href)},4e4),setTimeout(function(){ne(a)},0))}:"msSaveOrOpenBlob"in navigator?function(e,t,n){if(t=t||e.name||"download","string"==typeof e)if(te(e))ee(e,t,n);else{var a=document.createElement("a");a.href=e,a.target="_blank",setTimeout(function(){ne(a)})}else navigator.msSaveOrOpenBlob(function(e,t){return void 0===t?t={autoBom:!1}:"object"!==(0,r.A)(t)&&(Z.warn("Deprecated: Expected third argument to be a object"),t={autoBom:!t}),t.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob([String.fromCharCode(65279),e],{type:e.type}):e}(e,n),t)}:function(e,t,n,a){if((a=a||open("","_blank"))&&(a.document.title=a.document.body.innerText="downloading..."),"string"==typeof e)return ee(e,t,n);var i="application/octet-stream"===e.type,o=/constructor/i.test(J.HTMLElement)||J.safari,s=/CriOS\/[\d]+/.test(navigator.userAgent);if((s||i&&o)&&"object"===("undefined"==typeof FileReader?"undefined":(0,r.A)(FileReader))){var c=new FileReader;c.onloadend=function(){var e=c.result;e=s?e:e.replace(/^data:[^;]*;/,"data:attachment/file;"),a?a.location.href=e:location=e,a=null},c.readAsDataURL(e)}else{var l=J.URL||J.webkitURL,u=l.createObjectURL(e);a?a.location=u:location.href=u,a=null,setTimeout(function(){l.revokeObjectURL(u)},4e4)}});function oe(e){var t;e=e||"",this.ok=!1,"#"==e.charAt(0)&&(e=e.substr(1,6)),e={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"}[e=(e=e.replace(/ /g,"")).toLowerCase()]||e;for(var n=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(e){return[parseInt(e[1]),parseInt(e[2]),parseInt(e[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(e){return[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(e){return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)]}}],r=0;r<n.length;r++){var a=n[r].re,i=n[r].process,o=a.exec(e);o&&(t=i(o),this.r=t[0],this.g=t[1],this.b=t[2],this.ok=!0)}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r,this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g,this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toHex=function(){var e=this.r.toString(16),t=this.g.toString(16),n=this.b.toString(16);return 1==e.length&&(e="0"+e),1==t.length&&(t="0"+t),1==n.length&&(n="0"+n),"#"+e+t+n}}function se(e,t){var n=e[0],r=e[1],a=e[2],i=e[3];n=le(n,r,a,i,t[0],7,-680876936),i=le(i,n,r,a,t[1],12,-389564586),a=le(a,i,n,r,t[2],17,606105819),r=le(r,a,i,n,t[3],22,-1044525330),n=le(n,r,a,i,t[4],7,-176418897),i=le(i,n,r,a,t[5],12,1200080426),a=le(a,i,n,r,t[6],17,-1473231341),r=le(r,a,i,n,t[7],22,-45705983),n=le(n,r,a,i,t[8],7,1770035416),i=le(i,n,r,a,t[9],12,-1958414417),a=le(a,i,n,r,t[10],17,-42063),r=le(r,a,i,n,t[11],22,-1990404162),n=le(n,r,a,i,t[12],7,1804603682),i=le(i,n,r,a,t[13],12,-40341101),a=le(a,i,n,r,t[14],17,-1502002290),n=ue(n,r=le(r,a,i,n,t[15],22,1236535329),a,i,t[1],5,-165796510),i=ue(i,n,r,a,t[6],9,-1069501632),a=ue(a,i,n,r,t[11],14,643717713),r=ue(r,a,i,n,t[0],20,-373897302),n=ue(n,r,a,i,t[5],5,-701558691),i=ue(i,n,r,a,t[10],9,38016083),a=ue(a,i,n,r,t[15],14,-660478335),r=ue(r,a,i,n,t[4],20,-405537848),n=ue(n,r,a,i,t[9],5,568446438),i=ue(i,n,r,a,t[14],9,-1019803690),a=ue(a,i,n,r,t[3],14,-187363961),r=ue(r,a,i,n,t[8],20,1163531501),n=ue(n,r,a,i,t[13],5,-1444681467),i=ue(i,n,r,a,t[2],9,-51403784),a=ue(a,i,n,r,t[7],14,1735328473),n=he(n,r=ue(r,a,i,n,t[12],20,-1926607734),a,i,t[5],4,-378558),i=he(i,n,r,a,t[8],11,-2022574463),a=he(a,i,n,r,t[11],16,1839030562),r=he(r,a,i,n,t[14],23,-35309556),n=he(n,r,a,i,t[1],4,-1530992060),i=he(i,n,r,a,t[4],11,1272893353),a=he(a,i,n,r,t[7],16,-155497632),r=he(r,a,i,n,t[10],23,-1094730640),n=he(n,r,a,i,t[13],4,681279174),i=he(i,n,r,a,t[0],11,-358537222),a=he(a,i,n,r,t[3],16,-722521979),r=he(r,a,i,n,t[6],23,76029189),n=he(n,r,a,i,t[9],4,-640364487),i=he(i,n,r,a,t[12],11,-421815835),a=he(a,i,n,r,t[15],16,530742520),n=de(n,r=he(r,a,i,n,t[2],23,-995338651),a,i,t[0],6,-198630844),i=de(i,n,r,a,t[7],10,1126891415),a=de(a,i,n,r,t[14],15,-1416354905),r=de(r,a,i,n,t[5],21,-57434055),n=de(n,r,a,i,t[12],6,1700485571),i=de(i,n,r,a,t[3],10,-1894986606),a=de(a,i,n,r,t[10],15,-1051523),r=de(r,a,i,n,t[1],21,-2054922799),n=de(n,r,a,i,t[8],6,1873313359),i=de(i,n,r,a,t[15],10,-30611744),a=de(a,i,n,r,t[6],15,-1560198380),r=de(r,a,i,n,t[13],21,1309151649),n=de(n,r,a,i,t[4],6,-145523070),i=de(i,n,r,a,t[11],10,-1120210379),a=de(a,i,n,r,t[2],15,718787259),r=de(r,a,i,n,t[9],21,-343485551),e[0]=xe(n,e[0]),e[1]=xe(r,e[1]),e[2]=xe(a,e[2]),e[3]=xe(i,e[3])}function ce(e,t,n,r,a,i){return t=xe(xe(t,e),xe(r,i)),xe(t<<a|t>>>32-a,n)}function le(e,t,n,r,a,i,o){return ce(t&n|~t&r,e,t,a,i,o)}function ue(e,t,n,r,a,i,o){return ce(t&r|n&~r,e,t,a,i,o)}function he(e,t,n,r,a,i,o){return ce(t^n^r,e,t,a,i,o)}function de(e,t,n,r,a,i,o){return ce(n^(t|~r),e,t,a,i,o)}function fe(e){var t,n=e.length,r=[1732584193,-271733879,-1732584194,271733878];for(t=64;t<=e.length;t+=64)se(r,pe(e.substring(t-64,t)));e=e.substring(t-64);var a=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<e.length;t++)a[t>>2]|=e.charCodeAt(t)<<(t%4<<3);if(a[t>>2]|=128<<(t%4<<3),t>55)for(se(r,a),t=0;t<16;t++)a[t]=0;return a[14]=8*n,se(r,a),r}function pe(e){var t,n=[];for(t=0;t<64;t+=4)n[t>>2]=e.charCodeAt(t)+(e.charCodeAt(t+1)<<8)+(e.charCodeAt(t+2)<<16)+(e.charCodeAt(t+3)<<24);return n}re=J.atob.bind(J),ae=J.btoa.bind(J);var me="0123456789abcdef".split("");function ge(e){for(var t="",n=0;n<4;n++)t+=me[e>>8*n+4&15]+me[e>>8*n&15];return t}function ve(e){return String.fromCharCode(255&e,(65280&e)>>8,(16711680&e)>>16,(4278190080&e)>>24)}function be(e){return fe(e).map(ve).join("")}var ye="5d41402abc4b2a76b9719d911017c592"!=function(e){for(var t=0;t<e.length;t++)e[t]=ge(e[t]);return e.join("")}(fe("hello"));function xe(e,t){if(ye){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}return e+t&4294967295}function we(e,t){var n,r,a,i;if(e!==n){for(var o=(a=e,i=1+(256/e.length|0),new Array(i+1).join(a)),s=[],c=0;c<256;c++)s[c]=c;var l=0;for(c=0;c<256;c++){var u=s[c];l=(l+u+o.charCodeAt(c))%256,s[c]=s[l],s[l]=u}n=e,r=s}else s=r;var h=t.length,d=0,f=0,p="";for(c=0;c<h;c++)f=(f+(u=s[d=(d+1)%256]))%256,s[d]=s[f],s[f]=u,o=s[(s[d]+s[f])%256],p+=String.fromCharCode(t.charCodeAt(c)^o);return p}var ke={print:4,modify:8,copy:16,"annot-forms":32};function Se(e,t,n,r){this.v=1,this.r=2;var a=192;e.forEach(function(e){if(void 0!==ke.perm)throw new Error("Invalid permission: "+e);a+=ke[e]}),this.padding="(\xbfN^Nu\x8aAd\0NV\xff\xfa\x01\b..\0\xb6\xd0h>\x80/\f\xa9\xfedSiz";var i=(t+this.padding).substr(0,32),o=(n+this.padding).substr(0,32);this.O=this.processOwnerPassword(i,o),this.P=-(1+(255^a)),this.encryptionKey=be(i+this.O+this.lsbFirstWord(this.P)+this.hexToBytes(r)).substr(0,5),this.U=we(this.encryptionKey,this.padding)}function Ne(e){if(/[^\u0000-\u00ff]/.test(e))throw new Error("Invalid PDF Name Object: "+e+", Only accept ASCII characters.");for(var t="",n=e.length,r=0;r<n;r++){var a=e.charCodeAt(r);t+=a<33||35===a||37===a||40===a||41===a||47===a||60===a||62===a||91===a||93===a||123===a||125===a||a>126?"#"+("0"+a.toString(16)).slice(-2):e[r]}return t}function Ce(e){if("object"!==(0,r.A)(e))throw new Error("Invalid Context passed to initialize PubSub (jsPDF-module)");var t={};this.subscribe=function(e,n,r){if(r=r||!1,"string"!=typeof e||"function"!=typeof n||"boolean"!=typeof r)throw new Error("Invalid arguments passed to PubSub.subscribe (jsPDF-module)");t.hasOwnProperty(e)||(t[e]={});var a=Math.random().toString(35);return t[e][a]=[n,!!r],a},this.unsubscribe=function(e){for(var n in t)if(t[n][e])return delete t[n][e],0===Object.keys(t[n]).length&&delete t[n],!0;return!1},this.publish=function(n){if(t.hasOwnProperty(n)){var r=Array.prototype.slice.call(arguments,1),a=[];for(var i in t[n]){var o=t[n][i];try{o[0].apply(e,r)}catch(n){J.console&&Z.error("jsPDF PubSub Error",n.message,n)}o[1]&&a.push(i)}a.length&&a.forEach(this.unsubscribe)}},this.getTopics=function(){return t}}function Ee(e){if(!(this instanceof Ee))return new Ee(e);var t="opacity,stroke-opacity".split(",");for(var n in e)e.hasOwnProperty(n)&&t.indexOf(n)>=0&&(this[n]=e[n]);this.id="",this.objectNumber=-1}function Ie(e,t){this.gState=e,this.matrix=t,this.id="",this.objectNumber=-1}function Te(e,t,n,r,a){if(!(this instanceof Te))return new Te(e,t,n,r,a);this.type="axial"===e?2:3,this.coords=t,this.colors=n,Ie.call(this,r,a)}function _e(e,t,n,r,a){if(!(this instanceof _e))return new _e(e,t,n,r,a);this.boundingBox=e,this.xStep=t,this.yStep=n,this.stream="",this.cloneIndex=0,Ie.call(this,r,a)}function Ae(e){var t,n="string"==typeof arguments[0]?arguments[0]:"p",a=arguments[1],i=arguments[2],o=arguments[3],s=[],c=1,l=16,u="S",h=null;"object"===(0,r.A)(e=e||{})&&(n=e.orientation,a=e.unit||a,i=e.format||i,o=e.compress||e.compressPdf||o,null!==(h=e.encryption||null)&&(h.userPassword=h.userPassword||"",h.ownerPassword=h.ownerPassword||"",h.userPermissions=h.userPermissions||[]),c="number"==typeof e.userUnit?Math.abs(e.userUnit):1,void 0!==e.precision&&(t=e.precision),void 0!==e.floatPrecision&&(l=e.floatPrecision),u=e.defaultPathOperation||"S"),s=e.filters||(!0===o?["FlateEncode"]:s),a=a||"mm",n=(""+(n||"P")).toLowerCase();var d=e.putOnlyUsedFonts||!1,f={},p={internal:{},__private__:{}};p.__private__.PubSub=Ce;var m="1.3",g=p.__private__.getPdfVersion=function(){return m};p.__private__.setPdfVersion=function(e){m=e};var v={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};p.__private__.getPageFormats=function(){return v};var b=p.__private__.getPageFormat=function(e){return v[e]};i=i||"a4";var y="compat",x="advanced",w=y;function k(){this.saveGraphicsState(),ee(new He(be,0,0,-be,0,Sn()*be).toString()+" cm"),this.setFontSize(this.getFontSize()/be),u="n",w=x}function S(){this.restoreGraphicsState(),u="S",w=y}var N=p.__private__.combineFontStyleAndFontWeight=function(e,t){if("bold"==e&&"normal"==t||"bold"==e&&400==t||"normal"==e&&"italic"==t||"bold"==e&&"italic"==t)throw new Error("Invalid Combination of fontweight and fontstyle");return t&&(e=400==t||"normal"===t?"italic"===e?"italic":"normal":700!=t&&"bold"!==t||"normal"!==e?(700==t?"bold":t)+""+e:"bold"),e};p.advancedAPI=function(e){var t=w===y;return t&&k.call(this),"function"!=typeof e||(e(this),t&&S.call(this)),this},p.compatAPI=function(e){var t=w===x;return t&&S.call(this),"function"!=typeof e||(e(this),t&&k.call(this)),this},p.isAdvancedAPI=function(){return w===x};var C,E=function(e){if(w!==x)throw new Error(e+" is only available in 'advanced' API mode. You need to call advancedAPI() first.")},I=p.roundToPrecision=p.__private__.roundToPrecision=function(e,n){var r=t||n;if(isNaN(e)||isNaN(r))throw new Error("Invalid argument passed to jsPDF.roundToPrecision");return e.toFixed(r).replace(/0+$/,"")};C=p.hpf=p.__private__.hpf="number"==typeof l?function(e){if(isNaN(e))throw new Error("Invalid argument passed to jsPDF.hpf");return I(e,l)}:"smart"===l?function(e){if(isNaN(e))throw new Error("Invalid argument passed to jsPDF.hpf");return I(e,e>-1&&e<1?16:5)}:function(e){if(isNaN(e))throw new Error("Invalid argument passed to jsPDF.hpf");return I(e,16)};var T=p.f2=p.__private__.f2=function(e){if(isNaN(e))throw new Error("Invalid argument passed to jsPDF.f2");return I(e,2)},_=p.__private__.f3=function(e){if(isNaN(e))throw new Error("Invalid argument passed to jsPDF.f3");return I(e,3)},A=p.scale=p.__private__.scale=function(e){if(isNaN(e))throw new Error("Invalid argument passed to jsPDF.scale");return w===y?e*be:w===x?e:void 0},R=function(e){return A(function(e){return w===y?Sn()-e:w===x?e:void 0}(e))};p.__private__.setPrecision=p.setPrecision=function(e){"number"==typeof parseInt(e,10)&&(t=parseInt(e,10))};var F,D="00000000000000000000000000000000",O=p.__private__.getFileId=function(){return D},L=p.__private__.setFileId=function(e){return D=void 0!==e&&/^[a-fA-F0-9]{32}$/.test(e)?e.toUpperCase():D.split("").map(function(){return"ABCDEF0123456789".charAt(Math.floor(16*Math.random()))}).join(""),null!==h&&(Ft=new Se(h.userPermissions,h.userPassword,h.ownerPassword,D)),D};p.setFileId=function(e){return L(e),this},p.getFileId=function(){return O()};var P=p.__private__.convertDateToPDFDate=function(e){var t=e.getTimezoneOffset(),n=t<0?"+":"-",r=Math.floor(Math.abs(t/60)),a=Math.abs(t%60),i=[n,U(r),"'",U(a),"'"].join("");return["D:",e.getFullYear(),U(e.getMonth()+1),U(e.getDate()),U(e.getHours()),U(e.getMinutes()),U(e.getSeconds()),i].join("")},M=p.__private__.convertPDFDateToDate=function(e){var t=parseInt(e.substr(2,4),10),n=parseInt(e.substr(6,2),10)-1,r=parseInt(e.substr(8,2),10),a=parseInt(e.substr(10,2),10),i=parseInt(e.substr(12,2),10),o=parseInt(e.substr(14,2),10);return new Date(t,n,r,a,i,o,0)},j=p.__private__.setCreationDate=function(e){var t;if(void 0===e&&(e=new Date),e instanceof Date)t=P(e);else{if(!/^D:(20[0-2][0-9]|203[0-7]|19[7-9][0-9])(0[0-9]|1[0-2])([0-2][0-9]|3[0-1])(0[0-9]|1[0-9]|2[0-3])(0[0-9]|[1-5][0-9])(0[0-9]|[1-5][0-9])(\+0[0-9]|\+1[0-4]|-0[0-9]|-1[0-1])'(0[0-9]|[1-5][0-9])'?$/.test(e))throw new Error("Invalid argument passed to jsPDF.setCreationDate");t=e}return F=t},B=p.__private__.getCreationDate=function(e){var t=F;return"jsDate"===e&&(t=M(F)),t};p.setCreationDate=function(e){return j(e),this},p.getCreationDate=function(e){return B(e)};var z,U=p.__private__.padd2=function(e){return("0"+parseInt(e)).slice(-2)},W=p.__private__.padd2Hex=function(e){return("00"+(e=e.toString())).substr(e.length)},V=0,H=[],G=[],q=0,K=[],X=[],Y=!1,$=G;p.__private__.setCustomOutputDestination=function(e){Y=!0,$=e};var Q=function(e){Y||($=e)};p.__private__.resetCustomOutputDestination=function(){Y=!1,$=G};var ee=p.__private__.out=function(e){return e=e.toString(),q+=e.length+1,$.push(e),$},te=p.__private__.write=function(e){return ee(1===arguments.length?e.toString():Array.prototype.join.call(arguments," "))},ne=p.__private__.getArrayBuffer=function(e){for(var t=e.length,n=new ArrayBuffer(t),r=new Uint8Array(n);t--;)r[t]=e.charCodeAt(t);return n},re=[["Helvetica","helvetica","normal","WinAnsiEncoding"],["Helvetica-Bold","helvetica","bold","WinAnsiEncoding"],["Helvetica-Oblique","helvetica","italic","WinAnsiEncoding"],["Helvetica-BoldOblique","helvetica","bolditalic","WinAnsiEncoding"],["Courier","courier","normal","WinAnsiEncoding"],["Courier-Bold","courier","bold","WinAnsiEncoding"],["Courier-Oblique","courier","italic","WinAnsiEncoding"],["Courier-BoldOblique","courier","bolditalic","WinAnsiEncoding"],["Times-Roman","times","normal","WinAnsiEncoding"],["Times-Bold","times","bold","WinAnsiEncoding"],["Times-Italic","times","italic","WinAnsiEncoding"],["Times-BoldItalic","times","bolditalic","WinAnsiEncoding"],["ZapfDingbats","zapfdingbats","normal",null],["Symbol","symbol","normal",null]];p.__private__.getStandardFonts=function(){return re};var se=e.fontSize||16;p.__private__.setFontSize=p.setFontSize=function(e){return se=w===x?e/be:e,this};var ce,le=p.__private__.getFontSize=p.getFontSize=function(){return w===y?se:se*be},ue=e.R2L||!1;p.__private__.setR2L=p.setR2L=function(e){return ue=e,this},p.__private__.getR2L=p.getR2L=function(){return ue};var he,de=p.__private__.setZoomMode=function(e){if(/^(?:\d+\.\d*|\d*\.\d+|\d+)%$/.test(e))ce=e;else if(isNaN(e)){if(-1===[void 0,null,"fullwidth","fullheight","fullpage","original"].indexOf(e))throw new Error('zoom must be Integer (e.g. 2), a percentage Value (e.g. 300%) or fullwidth, fullheight, fullpage, original. "'+e+'" is not recognized.');ce=e}else ce=parseInt(e,10)};p.__private__.getZoomMode=function(){return ce};var fe,pe=p.__private__.setPageMode=function(e){if(-1==[void 0,null,"UseNone","UseOutlines","UseThumbs","FullScreen"].indexOf(e))throw new Error('Page mode must be one of UseNone, UseOutlines, UseThumbs, or FullScreen. "'+e+'" is not recognized.');he=e};p.__private__.getPageMode=function(){return he};var me=p.__private__.setLayoutMode=function(e){if(-1==[void 0,null,"continuous","single","twoleft","tworight","two"].indexOf(e))throw new Error('Layout mode must be one of continuous, single, twoleft, tworight. "'+e+'" is not recognized.');fe=e};p.__private__.getLayoutMode=function(){return fe},p.__private__.setDisplayMode=p.setDisplayMode=function(e,t,n){return de(e),me(t),pe(n),this};var ge={title:"",subject:"",author:"",keywords:"",creator:""};p.__private__.getDocumentProperty=function(e){if(-1===Object.keys(ge).indexOf(e))throw new Error("Invalid argument passed to jsPDF.getDocumentProperty");return ge[e]},p.__private__.getDocumentProperties=function(){return ge},p.__private__.setDocumentProperties=p.setProperties=p.setDocumentProperties=function(e){for(var t in ge)ge.hasOwnProperty(t)&&e[t]&&(ge[t]=e[t]);return this},p.__private__.setDocumentProperty=function(e,t){if(-1===Object.keys(ge).indexOf(e))throw new Error("Invalid arguments passed to jsPDF.setDocumentProperty");return ge[e]=t};var ve,be,ye,xe,we,ke={},Ie={},Re=[],Fe={},De={},Oe={},Le={},Pe=null,Me=0,je=[],Be=new Ce(p),ze=e.hotfixes||[],Ue={},We={},Ve=[],He=function e(t,n,r,a,i,o){if(!(this instanceof e))return new e(t,n,r,a,i,o);isNaN(t)&&(t=1),isNaN(n)&&(n=0),isNaN(r)&&(r=0),isNaN(a)&&(a=1),isNaN(i)&&(i=0),isNaN(o)&&(o=0),this._matrix=[t,n,r,a,i,o]};Object.defineProperty(He.prototype,"sx",{get:function(){return this._matrix[0]},set:function(e){this._matrix[0]=e}}),Object.defineProperty(He.prototype,"shy",{get:function(){return this._matrix[1]},set:function(e){this._matrix[1]=e}}),Object.defineProperty(He.prototype,"shx",{get:function(){return this._matrix[2]},set:function(e){this._matrix[2]=e}}),Object.defineProperty(He.prototype,"sy",{get:function(){return this._matrix[3]},set:function(e){this._matrix[3]=e}}),Object.defineProperty(He.prototype,"tx",{get:function(){return this._matrix[4]},set:function(e){this._matrix[4]=e}}),Object.defineProperty(He.prototype,"ty",{get:function(){return this._matrix[5]},set:function(e){this._matrix[5]=e}}),Object.defineProperty(He.prototype,"a",{get:function(){return this._matrix[0]},set:function(e){this._matrix[0]=e}}),Object.defineProperty(He.prototype,"b",{get:function(){return this._matrix[1]},set:function(e){this._matrix[1]=e}}),Object.defineProperty(He.prototype,"c",{get:function(){return this._matrix[2]},set:function(e){this._matrix[2]=e}}),Object.defineProperty(He.prototype,"d",{get:function(){return this._matrix[3]},set:function(e){this._matrix[3]=e}}),Object.defineProperty(He.prototype,"e",{get:function(){return this._matrix[4]},set:function(e){this._matrix[4]=e}}),Object.defineProperty(He.prototype,"f",{get:function(){return this._matrix[5]},set:function(e){this._matrix[5]=e}}),Object.defineProperty(He.prototype,"rotation",{get:function(){return Math.atan2(this.shx,this.sx)}}),Object.defineProperty(He.prototype,"scaleX",{get:function(){return this.decompose().scale.sx}}),Object.defineProperty(He.prototype,"scaleY",{get:function(){return this.decompose().scale.sy}}),Object.defineProperty(He.prototype,"isIdentity",{get:function(){return 1===this.sx&&0===this.shy&&0===this.shx&&1===this.sy&&0===this.tx&&0===this.ty}}),He.prototype.join=function(e){return[this.sx,this.shy,this.shx,this.sy,this.tx,this.ty].map(C).join(e)},He.prototype.multiply=function(e){var t=e.sx*this.sx+e.shy*this.shx,n=e.sx*this.shy+e.shy*this.sy,r=e.shx*this.sx+e.sy*this.shx,a=e.shx*this.shy+e.sy*this.sy,i=e.tx*this.sx+e.ty*this.shx+this.tx,o=e.tx*this.shy+e.ty*this.sy+this.ty;return new He(t,n,r,a,i,o)},He.prototype.decompose=function(){var e=this.sx,t=this.shy,n=this.shx,r=this.sy,a=this.tx,i=this.ty,o=Math.sqrt(e*e+t*t),s=(e/=o)*n+(t/=o)*r;n-=e*s,r-=t*s;var c=Math.sqrt(n*n+r*r);return s/=c,e*(r/=c)<t*(n/=c)&&(e=-e,t=-t,s=-s,o=-o),{scale:new He(o,0,0,c,0,0),translate:new He(1,0,0,1,a,i),rotate:new He(e,t,-t,e,0,0),skew:new He(1,0,s,1,0,0)}},He.prototype.toString=function(e){return this.join(" ")},He.prototype.inversed=function(){var e=this.sx,t=this.shy,n=this.shx,r=this.sy,a=this.tx,i=this.ty,o=1/(e*r-t*n),s=r*o,c=-t*o,l=-n*o,u=e*o;return new He(s,c,l,u,-s*a-l*i,-c*a-u*i)},He.prototype.applyToPoint=function(e){var t=e.x*this.sx+e.y*this.shx+this.tx,n=e.x*this.shy+e.y*this.sy+this.ty;return new gn(t,n)},He.prototype.applyToRectangle=function(e){var t=this.applyToPoint(e),n=this.applyToPoint(new gn(e.x+e.w,e.y+e.h));return new vn(t.x,t.y,n.x-t.x,n.y-t.y)},He.prototype.clone=function(){var e=this.sx,t=this.shy,n=this.shx,r=this.sy,a=this.tx,i=this.ty;return new He(e,t,n,r,a,i)},p.Matrix=He;var Ge=p.matrixMult=function(e,t){return t.multiply(e)},qe=new He(1,0,0,1,0,0);p.unitMatrix=p.identityMatrix=qe;var Ke=function(e,t){if(!De[e]){var n=(t instanceof Te?"Sh":"P")+(Object.keys(Fe).length+1).toString(10);t.id=n,De[e]=n,Fe[n]=t,Be.publish("addPattern",t)}};p.ShadingPattern=Te,p.TilingPattern=_e,p.addShadingPattern=function(e,t){return E("addShadingPattern()"),Ke(e,t),this},p.beginTilingPattern=function(e){E("beginTilingPattern()"),yn(e.boundingBox[0],e.boundingBox[1],e.boundingBox[2]-e.boundingBox[0],e.boundingBox[3]-e.boundingBox[1],e.matrix)},p.endTilingPattern=function(e,t){E("endTilingPattern()"),t.stream=X[z].join("\n"),Ke(e,t),Be.publish("endTilingPattern",t),Ve.pop().restore()};var Xe,Ye=p.__private__.newObject=function(){var e=$e();return Je(e,!0),e},$e=p.__private__.newObjectDeferred=function(){return V++,H[V]=function(){return q},V},Je=function(e,t){return t="boolean"==typeof t&&t,H[e]=q,t&&ee(e+" 0 obj"),e},Qe=p.__private__.newAdditionalObject=function(){var e={objId:$e(),content:""};return K.push(e),e},Ze=$e(),et=$e(),tt=p.__private__.decodeColorString=function(e){var t=e.split(" ");if(2!==t.length||"g"!==t[1]&&"G"!==t[1])5!==t.length||"k"!==t[4]&&"K"!==t[4]||(t=[(1-t[0])*(1-t[3]),(1-t[1])*(1-t[3]),(1-t[2])*(1-t[3]),"r"]);else{var n=parseFloat(t[0]);t=[n,n,n,"r"]}for(var r="#",a=0;a<3;a++)r+=("0"+Math.floor(255*parseFloat(t[a])).toString(16)).slice(-2);return r},nt=p.__private__.encodeColorString=function(e){var t;"string"==typeof e&&(e={ch1:e});var n=e.ch1,a=e.ch2,i=e.ch3,o=e.ch4,s="draw"===e.pdfColorType?["G","RG","K"]:["g","rg","k"];if("string"==typeof n&&"#"!==n.charAt(0)){var c=new oe(n);if(c.ok)n=c.toHex();else if(!/^\d*\.?\d*$/.test(n))throw new Error('Invalid color "'+n+'" passed to jsPDF.encodeColorString.')}if("string"==typeof n&&/^#[0-9A-Fa-f]{3}$/.test(n)&&(n="#"+n[1]+n[1]+n[2]+n[2]+n[3]+n[3]),"string"==typeof n&&/^#[0-9A-Fa-f]{6}$/.test(n)){var l=parseInt(n.substr(1),16);n=l>>16&255,a=l>>8&255,i=255&l}if(void 0===a||void 0===o&&n===a&&a===i)if("string"==typeof n)t=n+" "+s[0];else if(2===e.precision)t=T(n/255)+" "+s[0];else t=_(n/255)+" "+s[0];else if(void 0===o||"object"===(0,r.A)(o)){if(o&&!isNaN(o.a)&&0===o.a)return["1.","1.","1.",s[1]].join(" ");if("string"==typeof n)t=[n,a,i,s[1]].join(" ");else if(2===e.precision)t=[T(n/255),T(a/255),T(i/255),s[1]].join(" ");else t=[_(n/255),_(a/255),_(i/255),s[1]].join(" ")}else if("string"==typeof n)t=[n,a,i,o,s[2]].join(" ");else if(2===e.precision)t=[T(n),T(a),T(i),T(o),s[2]].join(" ");else t=[_(n),_(a),_(i),_(o),s[2]].join(" ");return t},rt=p.__private__.getFilters=function(){return s},at=p.__private__.putStream=function(e){var t=(e=e||{}).data||"",n=e.filters||rt(),r=e.alreadyAppliedFilters||[],a=e.addLength1||!1,i=t.length,o=e.objectId,s=function(e){return e};if(null!==h&&void 0===o)throw new Error("ObjectId must be passed to putStream for file encryption");null!==h&&(s=Ft.encryptor(o,0));var c={};!0===n&&(n=["FlateEncode"]);var l=e.additionalKeyValues||[],u=(c=void 0!==Ae.API.processDataByFilters?Ae.API.processDataByFilters(t,n):{data:t,reverseChain:[]}).reverseChain+(Array.isArray(r)?r.join(" "):r.toString());if(0!==c.data.length&&(l.push({key:"Length",value:c.data.length}),!0===a&&l.push({key:"Length1",value:i})),0!=u.length)if(u.split("/").length-1==1)l.push({key:"Filter",value:u});else{l.push({key:"Filter",value:"["+u+"]"});for(var d=0;d<l.length;d+=1)if("DecodeParms"===l[d].key){for(var f=[],p=0;p<c.reverseChain.split("/").length-1;p+=1)f.push("null");f.push(l[d].value),l[d].value="["+f.join(" ")+"]"}}ee("<<");for(var m=0;m<l.length;m++)ee("/"+l[m].key+" "+l[m].value);ee(">>"),0!==c.data.length&&(ee("stream"),ee(s(c.data)),ee("endstream"))},it=p.__private__.putPage=function(e){var t=e.number,n=e.data,r=e.objId,a=e.contentsObjId;Je(r,!0),ee("<</Type /Page"),ee("/Parent "+e.rootDictionaryObjId+" 0 R"),ee("/Resources "+e.resourceDictionaryObjId+" 0 R"),ee("/MediaBox ["+parseFloat(C(e.mediaBox.bottomLeftX))+" "+parseFloat(C(e.mediaBox.bottomLeftY))+" "+C(e.mediaBox.topRightX)+" "+C(e.mediaBox.topRightY)+"]"),null!==e.cropBox&&ee("/CropBox ["+C(e.cropBox.bottomLeftX)+" "+C(e.cropBox.bottomLeftY)+" "+C(e.cropBox.topRightX)+" "+C(e.cropBox.topRightY)+"]"),null!==e.bleedBox&&ee("/BleedBox ["+C(e.bleedBox.bottomLeftX)+" "+C(e.bleedBox.bottomLeftY)+" "+C(e.bleedBox.topRightX)+" "+C(e.bleedBox.topRightY)+"]"),null!==e.trimBox&&ee("/TrimBox ["+C(e.trimBox.bottomLeftX)+" "+C(e.trimBox.bottomLeftY)+" "+C(e.trimBox.topRightX)+" "+C(e.trimBox.topRightY)+"]"),null!==e.artBox&&ee("/ArtBox ["+C(e.artBox.bottomLeftX)+" "+C(e.artBox.bottomLeftY)+" "+C(e.artBox.topRightX)+" "+C(e.artBox.topRightY)+"]"),"number"==typeof e.userUnit&&1!==e.userUnit&&ee("/UserUnit "+e.userUnit),Be.publish("putPage",{objId:r,pageContext:je[t],pageNumber:t,page:n}),ee("/Contents "+a+" 0 R"),ee(">>"),ee("endobj");var i=n.join("\n");return w===x&&(i+="\nQ"),Je(a,!0),at({data:i,filters:rt(),objectId:a}),ee("endobj"),r},ot=p.__private__.putPages=function(){var e,t,n=[];for(e=1;e<=Me;e++)je[e].objId=$e(),je[e].contentsObjId=$e();for(e=1;e<=Me;e++)n.push(it({number:e,data:X[e],objId:je[e].objId,contentsObjId:je[e].contentsObjId,mediaBox:je[e].mediaBox,cropBox:je[e].cropBox,bleedBox:je[e].bleedBox,trimBox:je[e].trimBox,artBox:je[e].artBox,userUnit:je[e].userUnit,rootDictionaryObjId:Ze,resourceDictionaryObjId:et}));Je(Ze,!0),ee("<</Type /Pages");var r="/Kids [";for(t=0;t<Me;t++)r+=n[t]+" 0 R ";ee(r+"]"),ee("/Count "+Me),ee(">>"),ee("endobj"),Be.publish("postPutPages")},st=function(e){Be.publish("putFont",{font:e,out:ee,newObject:Ye,putStream:at}),!0!==e.isAlreadyPutted&&(e.objectNumber=Ye(),ee("<<"),ee("/Type /Font"),ee("/BaseFont /"+Ne(e.postScriptName)),ee("/Subtype /Type1"),"string"==typeof e.encoding&&ee("/Encoding /"+e.encoding),ee("/FirstChar 32"),ee("/LastChar 255"),ee(">>"),ee("endobj"))},ct=function(e){e.objectNumber=Ye();var t=[];t.push({key:"Type",value:"/XObject"}),t.push({key:"Subtype",value:"/Form"}),t.push({key:"BBox",value:"["+[C(e.x),C(e.y),C(e.x+e.width),C(e.y+e.height)].join(" ")+"]"}),t.push({key:"Matrix",value:"["+e.matrix.toString()+"]"});var n=e.pages[1].join("\n");at({data:n,additionalKeyValues:t,objectId:e.objectNumber}),ee("endobj")},lt=function(e,t){t||(t=21);var n=Ye(),r=function(e,t){var n,r=[],a=1/(t-1);for(n=0;n<1;n+=a)r.push(n);if(r.push(1),0!=e[0].offset){var i={offset:0,color:e[0].color};e.unshift(i)}if(1!=e[e.length-1].offset){var o={offset:1,color:e[e.length-1].color};e.push(o)}for(var s="",c=0,l=0;l<r.length;l++){for(n=r[l];n>e[c+1].offset;)c++;var u=e[c].offset,h=(n-u)/(e[c+1].offset-u),d=e[c].color,f=e[c+1].color;s+=W(Math.round((1-h)*d[0]+h*f[0]).toString(16))+W(Math.round((1-h)*d[1]+h*f[1]).toString(16))+W(Math.round((1-h)*d[2]+h*f[2]).toString(16))}return s.trim()}(e.colors,t),a=[];a.push({key:"FunctionType",value:"0"}),a.push({key:"Domain",value:"[0.0 1.0]"}),a.push({key:"Size",value:"["+t+"]"}),a.push({key:"BitsPerSample",value:"8"}),a.push({key:"Range",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),a.push({key:"Decode",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),at({data:r,additionalKeyValues:a,alreadyAppliedFilters:["/ASCIIHexDecode"],objectId:n}),ee("endobj"),e.objectNumber=Ye(),ee("<< /ShadingType "+e.type),ee("/ColorSpace /DeviceRGB");var i="/Coords ["+C(parseFloat(e.coords[0]))+" "+C(parseFloat(e.coords[1]))+" ";2===e.type?i+=C(parseFloat(e.coords[2]))+" "+C(parseFloat(e.coords[3])):i+=C(parseFloat(e.coords[2]))+" "+C(parseFloat(e.coords[3]))+" "+C(parseFloat(e.coords[4]))+" "+C(parseFloat(e.coords[5])),ee(i+="]"),e.matrix&&ee("/Matrix ["+e.matrix.toString()+"]"),ee("/Function "+n+" 0 R"),ee("/Extend [true true]"),ee(">>"),ee("endobj")},ut=function(e,t){var n=$e(),r=Ye();t.push({resourcesOid:n,objectOid:r}),e.objectNumber=r;var a=[];a.push({key:"Type",value:"/Pattern"}),a.push({key:"PatternType",value:"1"}),a.push({key:"PaintType",value:"1"}),a.push({key:"TilingType",value:"1"}),a.push({key:"BBox",value:"["+e.boundingBox.map(C).join(" ")+"]"}),a.push({key:"XStep",value:C(e.xStep)}),a.push({key:"YStep",value:C(e.yStep)}),a.push({key:"Resources",value:n+" 0 R"}),e.matrix&&a.push({key:"Matrix",value:"["+e.matrix.toString()+"]"}),at({data:e.stream,additionalKeyValues:a,objectId:e.objectNumber}),ee("endobj")},ht=function(e){for(var t in e.objectNumber=Ye(),ee("<<"),e)switch(t){case"opacity":ee("/ca "+T(e[t]));break;case"stroke-opacity":ee("/CA "+T(e[t]))}ee(">>"),ee("endobj")},dt=function(e){Je(e.resourcesOid,!0),ee("<<"),ee("/ProcSet [/PDF /Text /ImageB /ImageC /ImageI]"),function(){for(var e in ee("/Font <<"),ke)ke.hasOwnProperty(e)&&(!1===d||!0===d&&f.hasOwnProperty(e))&&ee("/"+e+" "+ke[e].objectNumber+" 0 R");ee(">>")}(),function(){if(Object.keys(Fe).length>0){for(var e in ee("/Shading <<"),Fe)Fe.hasOwnProperty(e)&&Fe[e]instanceof Te&&Fe[e].objectNumber>=0&&ee("/"+e+" "+Fe[e].objectNumber+" 0 R");Be.publish("putShadingPatternDict"),ee(">>")}}(),function(e){if(Object.keys(Fe).length>0){for(var t in ee("/Pattern <<"),Fe)Fe.hasOwnProperty(t)&&Fe[t]instanceof p.TilingPattern&&Fe[t].objectNumber>=0&&Fe[t].objectNumber<e&&ee("/"+t+" "+Fe[t].objectNumber+" 0 R");Be.publish("putTilingPatternDict"),ee(">>")}}(e.objectOid),function(){if(Object.keys(Oe).length>0){var e;for(e in ee("/ExtGState <<"),Oe)Oe.hasOwnProperty(e)&&Oe[e].objectNumber>=0&&ee("/"+e+" "+Oe[e].objectNumber+" 0 R");Be.publish("putGStateDict"),ee(">>")}}(),function(){for(var e in ee("/XObject <<"),Ue)Ue.hasOwnProperty(e)&&Ue[e].objectNumber>=0&&ee("/"+e+" "+Ue[e].objectNumber+" 0 R");Be.publish("putXobjectDict"),ee(">>")}(),ee(">>"),ee("endobj")},ft=function(){var e=[];(function(){for(var e in ke)ke.hasOwnProperty(e)&&(!1===d||!0===d&&f.hasOwnProperty(e))&&st(ke[e])})(),function(){var e;for(e in Oe)Oe.hasOwnProperty(e)&&ht(Oe[e])}(),function(){for(var e in Ue)Ue.hasOwnProperty(e)&&ct(Ue[e])}(),function(e){var t;for(t in Fe)Fe.hasOwnProperty(t)&&(Fe[t]instanceof Te?lt(Fe[t]):Fe[t]instanceof _e&&ut(Fe[t],e))}(e),Be.publish("putResources"),e.forEach(dt),dt({resourcesOid:et,objectOid:Number.MAX_SAFE_INTEGER}),Be.publish("postPutResources")},pt=function(e){Ie[e.fontName]=Ie[e.fontName]||{},Ie[e.fontName][e.fontStyle]=e.id},mt=function(e,t,n,r,a){var i={id:"F"+(Object.keys(ke).length+1).toString(10),postScriptName:e,fontName:t,fontStyle:n,encoding:r,isStandardFont:a||!1,metadata:{}};return Be.publish("addFont",{font:i,instance:this}),ke[i.id]=i,pt(i),i.id},gt=p.__private__.pdfEscape=p.pdfEscape=function(e,t){return function(e,t){var n,r,a,i,o,s,c,l,u;if(a=(t=t||{}).sourceEncoding||"Unicode",o=t.outputEncoding,(t.autoencode||o)&&ke[ve].metadata&&ke[ve].metadata[a]&&ke[ve].metadata[a].encoding&&(i=ke[ve].metadata[a].encoding,!o&&ke[ve].encoding&&(o=ke[ve].encoding),!o&&i.codePages&&(o=i.codePages[0]),"string"==typeof o&&(o=i[o]),o)){for(c=!1,s=[],n=0,r=e.length;n<r;n++)(l=o[e.charCodeAt(n)])?s.push(String.fromCharCode(l)):s.push(e[n]),s[n].charCodeAt(0)>>8&&(c=!0);e=s.join("")}for(n=e.length;void 0===c&&0!==n;)e.charCodeAt(n-1)>>8&&(c=!0),n--;if(!c)return e;for(s=t.noBOM?[]:[254,255],n=0,r=e.length;n<r;n++){if((u=(l=e.charCodeAt(n))>>8)>>8)throw new Error("Character at position "+n+" of string '"+e+"' exceeds 16bits. Cannot be encoded into UCS-2 BE");s.push(u),s.push(l-(u<<8))}return String.fromCharCode.apply(void 0,s)}(e,t).replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},vt=p.__private__.beginPage=function(e){X[++Me]=[],je[Me]={objId:0,contentsObjId:0,userUnit:Number(c),artBox:null,bleedBox:null,cropBox:null,trimBox:null,mediaBox:{bottomLeftX:0,bottomLeftY:0,topRightX:Number(e[0]),topRightY:Number(e[1])}},xt(Me),Q(X[z])},bt=function(e,t){var r,a,o;switch(n=t||n,"string"==typeof e&&(r=b(e.toLowerCase()),Array.isArray(r)&&(a=r[0],o=r[1])),Array.isArray(e)&&(a=e[0]*be,o=e[1]*be),isNaN(a)&&(a=i[0],o=i[1]),(a>14400||o>14400)&&(Z.warn("A page in a PDF can not be wider or taller than 14400 userUnit. jsPDF limits the width/height to 14400"),a=Math.min(14400,a),o=Math.min(14400,o)),i=[a,o],n.substr(0,1)){case"l":o>a&&(i=[o,a]);break;case"p":a>o&&(i=[o,a])}vt(i),Qt($t),ee(sn),0!==fn&&ee(fn+" J"),0!==pn&&ee(pn+" j"),Be.publish("addPage",{pageNumber:Me})},yt=function(e){e>0&&e<=Me&&(X.splice(e,1),je.splice(e,1),Me--,z>Me&&(z=Me),this.setPage(z))},xt=function(e){e>0&&e<=Me&&(z=e)},wt=p.__private__.getNumberOfPages=p.getNumberOfPages=function(){return X.length-1},kt=function(e,t,n){var r,a=void 0;return n=n||{},e=void 0!==e?e:ke[ve].fontName,t=void 0!==t?t:ke[ve].fontStyle,r=e.toLowerCase(),void 0!==Ie[r]&&void 0!==Ie[r][t]?a=Ie[r][t]:void 0!==Ie[e]&&void 0!==Ie[e][t]?a=Ie[e][t]:!1===n.disableWarning&&Z.warn("Unable to look up font label for font '"+e+"', '"+t+"'. Refer to getFontList() for available fonts."),a||n.noFallback||null==(a=Ie.times[t])&&(a=Ie.times.normal),a},St=p.__private__.putInfo=function(){var e=Ye(),t=function(e){return e};for(var n in null!==h&&(t=Ft.encryptor(e,0)),ee("<<"),ee("/Producer ("+gt(t("jsPDF "+Ae.version))+")"),ge)ge.hasOwnProperty(n)&&ge[n]&&ee("/"+n.substr(0,1).toUpperCase()+n.substr(1)+" ("+gt(t(ge[n]))+")");ee("/CreationDate ("+gt(t(F))+")"),ee(">>"),ee("endobj")},Nt=p.__private__.putCatalog=function(e){var t=(e=e||{}).rootDictionaryObjId||Ze;switch(Ye(),ee("<<"),ee("/Type /Catalog"),ee("/Pages "+t+" 0 R"),ce||(ce="fullwidth"),ce){case"fullwidth":ee("/OpenAction [3 0 R /FitH null]");break;case"fullheight":ee("/OpenAction [3 0 R /FitV null]");break;case"fullpage":ee("/OpenAction [3 0 R /Fit]");break;case"original":ee("/OpenAction [3 0 R /XYZ null null 1]");break;default:var n=""+ce;"%"===n.substr(n.length-1)&&(ce=parseInt(ce)/100),"number"==typeof ce&&ee("/OpenAction [3 0 R /XYZ null null "+T(ce)+"]")}switch(fe||(fe="continuous"),fe){case"continuous":ee("/PageLayout /OneColumn");break;case"single":ee("/PageLayout /SinglePage");break;case"two":case"twoleft":ee("/PageLayout /TwoColumnLeft");break;case"tworight":ee("/PageLayout /TwoColumnRight")}he&&ee("/PageMode /"+he),Be.publish("putCatalog"),ee(">>"),ee("endobj")},Ct=p.__private__.putTrailer=function(){ee("trailer"),ee("<<"),ee("/Size "+(V+1)),ee("/Root "+V+" 0 R"),ee("/Info "+(V-1)+" 0 R"),null!==h&&ee("/Encrypt "+Ft.oid+" 0 R"),ee("/ID [ <"+D+"> <"+D+"> ]"),ee(">>")},Et=p.__private__.putHeader=function(){ee("%PDF-"+m),ee("%\xba\xdf\xac\xe0")},It=p.__private__.putXRef=function(){var e="0000000000";ee("xref"),ee("0 "+(V+1)),ee("0000000000 65535 f ");for(var t=1;t<=V;t++)"function"==typeof H[t]?ee((e+H[t]()).slice(-10)+" 00000 n "):void 0!==H[t]?ee((e+H[t]).slice(-10)+" 00000 n "):ee("0000000000 00000 n ")},Tt=p.__private__.buildDocument=function(){V=0,q=0,G=[],H=[],K=[],Ze=$e(),et=$e(),Q(G),Be.publish("buildDocument"),Et(),ot(),function(){Be.publish("putAdditionalObjects");for(var e=0;e<K.length;e++){var t=K[e];Je(t.objId,!0),ee(t.content),ee("endobj")}Be.publish("postPutAdditionalObjects")}(),ft(),null!==h&&(Ft.oid=Ye(),ee("<<"),ee("/Filter /Standard"),ee("/V "+Ft.v),ee("/R "+Ft.r),ee("/U <"+Ft.toHexString(Ft.U)+">"),ee("/O <"+Ft.toHexString(Ft.O)+">"),ee("/P "+Ft.P),ee(">>"),ee("endobj")),St(),Nt();var e=q;return It(),Ct(),ee("startxref"),ee(""+e),ee("%%EOF"),Q(X[z]),G.join("\n")},_t=p.__private__.getBlob=function(e){return new Blob([ne(e)],{type:"application/pdf"})},At=p.output=p.__private__.output=(Xe=function(e,t){switch("string"==typeof(t=t||{})?t={filename:t}:t.filename=t.filename||"generated.pdf",e){case void 0:return Tt();case"save":p.save(t.filename);break;case"arraybuffer":return ne(Tt());case"blob":return _t(Tt());case"bloburi":case"bloburl":if(void 0!==J.URL&&"function"==typeof J.URL.createObjectURL)return J.URL&&J.URL.createObjectURL(_t(Tt()))||void 0;Z.warn("bloburl is not supported by your system, because URL.createObjectURL is not supported by your browser.");break;case"datauristring":case"dataurlstring":var n="",r=Tt();try{n=ae(r)}catch(e){n=ae(unescape(encodeURIComponent(r)))}return"data:application/pdf;filename="+t.filename+";base64,"+n;case"pdfobjectnewwindow":if("[object Window]"===Object.prototype.toString.call(J)){var a="https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.1.1/pdfobject.min.js",i=' integrity="sha512-4ze/a9/4jqu+tX9dfOqJYSvyYd5M6qum/3HpCLr+/Jqf0whc37VUbkpNGHR7/8pSnCFw47T1fmIpwBV7UySh3g==" crossorigin="anonymous"';t.pdfObjectUrl&&(a=t.pdfObjectUrl,i="");var o='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><script src="'+a+'"'+i+'><\/script><script >PDFObject.embed("'+this.output("dataurlstring")+'", '+JSON.stringify(t)+");<\/script></body></html>",s=J.open();return null!==s&&s.document.write(o),s}throw new Error("The option pdfobjectnewwindow just works in a browser-environment.");case"pdfjsnewwindow":if("[object Window]"===Object.prototype.toString.call(J)){var c='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe id="pdfViewer" src="'+(t.pdfJsUrl||"examples/PDF.js/web/viewer.html")+"?file=&downloadName="+t.filename+'" width="500px" height="400px" /></body></html>',l=J.open();if(null!==l){l.document.write(c);var u=this;l.document.documentElement.querySelector("#pdfViewer").onload=function(){l.document.title=t.filename,l.document.documentElement.querySelector("#pdfViewer").contentWindow.PDFViewerApplication.open(u.output("bloburl"))}}return l}throw new Error("The option pdfjsnewwindow just works in a browser-environment.");case"dataurlnewwindow":if("[object Window]"!==Object.prototype.toString.call(J))throw new Error("The option dataurlnewwindow just works in a browser-environment.");var h='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe src="'+this.output("datauristring",t)+'"></iframe></body></html>',d=J.open();if(null!==d&&(d.document.write(h),d.document.title=t.filename),d||"undefined"==typeof safari)return d;break;case"datauri":case"dataurl":return J.document.location.href=this.output("datauristring",t);default:return null}},Xe.foo=function(){try{return Xe.apply(this,arguments)}catch(Xe){var e=Xe.stack||"";~e.indexOf(" at ")&&(e=e.split(" at ")[1]);var t="Error in function "+e.split("\n")[0].split("<")[0]+": "+Xe.message;if(!J.console)throw new Error(t);J.console.error(t,Xe),J.alert&&alert(t)}},Xe.foo.bar=Xe,Xe.foo),Rt=function(e){return!0===Array.isArray(ze)&&ze.indexOf(e)>-1};switch(a){case"pt":be=1;break;case"mm":be=72/25.4;break;case"cm":be=72/2.54;break;case"in":be=72;break;case"px":be=1==Rt("px_scaling")?.75:96/72;break;case"pc":case"em":be=12;break;case"ex":be=6;break;default:if("number"!=typeof a)throw new Error("Invalid unit: "+a);be=a}var Ft=null;j(),L();var Dt=p.__private__.getPageInfo=p.getPageInfo=function(e){if(isNaN(e)||e%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfo");return{objId:je[e].objId,pageNumber:e,pageContext:je[e]}},Ot=p.__private__.getPageInfoByObjId=function(e){if(isNaN(e)||e%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfoByObjId");for(var t in je)if(je[t].objId===e)break;return Dt(t)},Lt=p.__private__.getCurrentPageInfo=p.getCurrentPageInfo=function(){return{objId:je[z].objId,pageNumber:z,pageContext:je[z]}};p.addPage=function(){return bt.apply(this,arguments),this},p.setPage=function(){return xt.apply(this,arguments),Q.call(this,X[z]),this},p.insertPage=function(e){return this.addPage(),this.movePage(z,e),this},p.movePage=function(e,t){var n,r;if(e>t){n=X[e],r=je[e];for(var a=e;a>t;a--)X[a]=X[a-1],je[a]=je[a-1];X[t]=n,je[t]=r,this.setPage(t)}else if(e<t){n=X[e],r=je[e];for(var i=e;i<t;i++)X[i]=X[i+1],je[i]=je[i+1];X[t]=n,je[t]=r,this.setPage(t)}return this},p.deletePage=function(){return yt.apply(this,arguments),this},p.__private__.text=p.text=function(e,t,n,a,i){var o,s,c,l,u,h,d,p,m,g=(a=a||{}).scope||this;if("number"==typeof e&&"number"==typeof t&&("string"==typeof n||Array.isArray(n))){var v=n;n=t,t=e,e=v}if(arguments[3]instanceof He==0?(c=arguments[4],l=arguments[5],"object"===(0,r.A)(d=arguments[3])&&null!==d||("string"==typeof c&&(l=c,c=null),"string"==typeof d&&(l=d,d=null),"number"==typeof d&&(c=d,d=null),a={flags:d,angle:c,align:l})):(E("The transform parameter of text() with a Matrix value"),m=i),isNaN(t)||isNaN(n)||null==e)throw new Error("Invalid arguments passed to jsPDF.text");if(0===e.length)return g;var b,y="",k="number"==typeof a.lineHeightFactor?a.lineHeightFactor:Yt,S=g.internal.scaleFactor;function N(e){return e=e.split("\t").join(Array(a.TabLen||9).join(" ")),gt(e,d)}function I(e){for(var t,n=e.concat(),r=[],a=n.length;a--;)"string"==typeof(t=n.shift())?r.push(t):Array.isArray(e)&&(1===t.length||void 0===t[1]&&void 0===t[2])?r.push(t[0]):r.push([t[0],t[1],t[2]]);return r}function T(e,t){var n;if("string"==typeof e)n=t(e)[0];else if(Array.isArray(e)){for(var r,a,i=e.concat(),o=[],s=i.length;s--;)"string"==typeof(r=i.shift())?o.push(t(r)[0]):Array.isArray(r)&&"string"==typeof r[0]&&(a=t(r[0],r[1],r[2]),o.push([a[0],a[1],a[2]]));n=o}return n}var _=!1,R=!0;if("string"==typeof e)_=!0;else if(Array.isArray(e)){var F=e.concat();s=[];for(var D,O=F.length;O--;)("string"!=typeof(D=F.shift())||Array.isArray(D)&&"string"!=typeof D[0])&&(R=!1);_=R}if(!1===_)throw new Error('Type of text must be string or Array. "'+e+'" is not recognized.');"string"==typeof e&&(e=e.match(/[\r?\n]/)?e.split(/\r\n|\r|\n/g):[e]);var L=se/g.internal.scaleFactor,P=L*(k-1);switch(a.baseline){case"bottom":n-=P;break;case"top":n+=L-P;break;case"hanging":n+=L-2*P;break;case"middle":n+=L/2-P}if((h=a.maxWidth||0)>0&&("string"==typeof e?e=g.splitTextToSize(e,h):"[object Array]"===Object.prototype.toString.call(e)&&(e=e.reduce(function(e,t){return e.concat(g.splitTextToSize(t,h))},[]))),o={text:e,x:t,y:n,options:a,mutex:{pdfEscape:gt,activeFontKey:ve,fonts:ke,activeFontSize:se}},Be.publish("preProcessText",o),e=o.text,c=(a=o.options).angle,m instanceof He==0&&c&&"number"==typeof c){c*=Math.PI/180,0===a.rotationDirection&&(c=-c),w===x&&(c=-c);var M=Math.cos(c),j=Math.sin(c);m=new He(M,j,-j,M,0,0)}else c&&c instanceof He&&(m=c);w!==x||m||(m=qe),void 0!==(u=a.charSpace||hn)&&(y+=C(A(u))+" Tc\n",this.setCharSpace(this.getCharSpace()||0)),void 0!==(p=a.horizontalScale)&&(y+=C(100*p)+" Tz\n"),a.lang;var B=-1,z=void 0!==a.renderingMode?a.renderingMode:a.stroke,U=g.internal.getCurrentPageInfo().pageContext;switch(z){case 0:case!1:case"fill":B=0;break;case 1:case!0:case"stroke":B=1;break;case 2:case"fillThenStroke":B=2;break;case 3:case"invisible":B=3;break;case 4:case"fillAndAddForClipping":B=4;break;case 5:case"strokeAndAddPathForClipping":B=5;break;case 6:case"fillThenStrokeAndAddToPathForClipping":B=6;break;case 7:case"addToPathForClipping":B=7}var W=void 0!==U.usedRenderingMode?U.usedRenderingMode:-1;-1!==B?y+=B+" Tr\n":-1!==W&&(y+="0 Tr\n"),-1!==B&&(U.usedRenderingMode=B),l=a.align||"left";var V,H=se*k,G=g.internal.pageSize.getWidth(),q=ke[ve];u=a.charSpace||hn,h=a.maxWidth||0,d=Object.assign({autoencode:!0,noBOM:!0},a.flags);var K=[];if("[object Array]"===Object.prototype.toString.call(e)){var X;s=I(e),"left"!==l&&(V=s.map(function(e){return g.getStringUnitWidth(e,{font:q,charSpace:u,fontSize:se,doKerning:!1})*se/S}));var Y,$=0;if("right"===l){t-=V[0],e=[],O=s.length;for(var J=0;J<O;J++)0===J?(Y=nn(t),X=rn(n)):(Y=A($-V[J]),X=-H),e.push([s[J],Y,X]),$=V[J]}else if("center"===l){t-=V[0]/2,e=[],O=s.length;for(var Q=0;Q<O;Q++)0===Q?(Y=nn(t),X=rn(n)):(Y=A(($-V[Q])/2),X=-H),e.push([s[Q],Y,X]),$=V[Q]}else if("left"===l){e=[],O=s.length;for(var Z=0;Z<O;Z++)e.push(s[Z])}else{if("justify"!==l)throw new Error('Unrecognized alignment option, use "left", "center", "right" or "justify".');e=[],O=s.length,h=0!==h?h:G;for(var te=0;te<O;te++)X=0===te?rn(n):-H,Y=0===te?nn(t):0,te<O-1?K.push(C(A((h-V[te])/(s[te].split(" ").length-1)))):K.push(0),e.push([s[te],Y,X])}}!0===("boolean"==typeof a.R2L?a.R2L:ue)&&(e=T(e,function(e,t,n){return[e.split("").reverse().join(""),t,n]})),o={text:e,x:t,y:n,options:a,mutex:{pdfEscape:gt,activeFontKey:ve,fonts:ke,activeFontSize:se}},Be.publish("postProcessText",o),e=o.text,b=o.mutex.isHex||!1;var ne=ke[ve].encoding;"WinAnsiEncoding"!==ne&&"StandardEncoding"!==ne||(e=T(e,function(e,t,n){return[N(e),t,n]})),s=I(e),e=[];for(var re,ae,ie,oe=Array.isArray(s[0])?1:0,ce="",le=function(e,t,n){var r="";return n instanceof He?(n="number"==typeof a.angle?Ge(n,new He(1,0,0,1,e,t)):Ge(new He(1,0,0,1,e,t),n),w===x&&(n=Ge(new He(1,0,0,-1,0,0),n)),r=n.join(" ")+" Tm\n"):r=C(e)+" "+C(t)+" Td\n",r},he=0;he<s.length;he++){switch(ce="",oe){case 1:ie=(b?"<":"(")+s[he][0]+(b?">":")"),re=parseFloat(s[he][1]),ae=parseFloat(s[he][2]);break;case 0:ie=(b?"<":"(")+s[he]+(b?">":")"),re=nn(t),ae=rn(n)}void 0!==K&&void 0!==K[he]&&(ce=K[he]+" Tw\n"),0===he?e.push(ce+le(re,ae,m)+ie):0===oe?e.push(ce+ie):1===oe&&e.push(ce+le(re,ae,m)+ie)}e=0===oe?e.join(" Tj\nT* "):e.join(" Tj\n"),e+=" Tj\n";var de="BT\n/";return de+=ve+" "+se+" Tf\n",de+=C(se*k)+" TL\n",de+=ln+"\n",de+=y,de+=e,ee(de+="ET"),f[ve]=!0,g};var Pt=p.__private__.clip=p.clip=function(e){return ee("evenodd"===e?"W*":"W"),this};p.clipEvenOdd=function(){return Pt("evenodd")},p.__private__.discardPath=p.discardPath=function(){return ee("n"),this};var Mt=p.__private__.isValidStyle=function(e){var t=!1;return-1!==[void 0,null,"S","D","F","DF","FD","f","f*","B","B*","n"].indexOf(e)&&(t=!0),t};p.__private__.setDefaultPathOperation=p.setDefaultPathOperation=function(e){return Mt(e)&&(u=e),this};var jt=p.__private__.getStyle=p.getStyle=function(e){var t=u;switch(e){case"D":case"S":t="S";break;case"F":t="f";break;case"FD":case"DF":t="B";break;case"f":case"f*":case"B":case"B*":t=e}return t},Bt=p.close=function(){return ee("h"),this};p.stroke=function(){return ee("S"),this},p.fill=function(e){return zt("f",e),this},p.fillEvenOdd=function(e){return zt("f*",e),this},p.fillStroke=function(e){return zt("B",e),this},p.fillStrokeEvenOdd=function(e){return zt("B*",e),this};var zt=function(e,t){"object"===(0,r.A)(t)?Vt(t,e):ee(e)},Ut=function(e){null===e||w===x&&void 0===e||(e=jt(e),ee(e))};function Wt(e,t,n,r,a){var i=new _e(t||this.boundingBox,n||this.xStep,r||this.yStep,this.gState,a||this.matrix);i.stream=this.stream;var o=e+"$$"+this.cloneIndex+++"$$";return Ke(o,i),i}var Vt=function(e,t){var n=De[e.key],r=Fe[n];if(r instanceof Te)ee("q"),ee(Ht(t)),r.gState&&p.setGState(r.gState),ee(e.matrix.toString()+" cm"),ee("/"+n+" sh"),ee("Q");else if(r instanceof _e){var a=new He(1,0,0,-1,0,Sn());e.matrix&&(a=a.multiply(e.matrix||qe),n=Wt.call(r,e.key,e.boundingBox,e.xStep,e.yStep,a).id),ee("q"),ee("/Pattern cs"),ee("/"+n+" scn"),r.gState&&p.setGState(r.gState),ee(t),ee("Q")}},Ht=function(e){switch(e){case"f":case"F":case"n":return"W n";case"f*":return"W* n";case"B":case"S":return"W S";case"B*":return"W* S"}},Gt=p.moveTo=function(e,t){return ee(C(A(e))+" "+C(R(t))+" m"),this},qt=p.lineTo=function(e,t){return ee(C(A(e))+" "+C(R(t))+" l"),this},Kt=p.curveTo=function(e,t,n,r,a,i){return ee([C(A(e)),C(R(t)),C(A(n)),C(R(r)),C(A(a)),C(R(i)),"c"].join(" ")),this};p.__private__.line=p.line=function(e,t,n,r,a){if(isNaN(e)||isNaN(t)||isNaN(n)||isNaN(r)||!Mt(a))throw new Error("Invalid arguments passed to jsPDF.line");return w===y?this.lines([[n-e,r-t]],e,t,[1,1],a||"S"):this.lines([[n-e,r-t]],e,t,[1,1]).stroke()},p.__private__.lines=p.lines=function(e,t,n,r,a,i){var o,s,c,l,u,h,d,f,p,m,g,v;if("number"==typeof e&&(v=n,n=t,t=e,e=v),r=r||[1,1],i=i||!1,isNaN(t)||isNaN(n)||!Array.isArray(e)||!Array.isArray(r)||!Mt(a)||"boolean"!=typeof i)throw new Error("Invalid arguments passed to jsPDF.lines");for(Gt(t,n),o=r[0],s=r[1],l=e.length,m=t,g=n,c=0;c<l;c++)2===(u=e[c]).length?(m=u[0]*o+m,g=u[1]*s+g,qt(m,g)):(h=u[0]*o+m,d=u[1]*s+g,f=u[2]*o+m,p=u[3]*s+g,m=u[4]*o+m,g=u[5]*s+g,Kt(h,d,f,p,m,g));return i&&Bt(),Ut(a),this},p.path=function(e){for(var t=0;t<e.length;t++){var n=e[t],r=n.c;switch(n.op){case"m":Gt(r[0],r[1]);break;case"l":qt(r[0],r[1]);break;case"c":Kt.apply(this,r);break;case"h":Bt()}}return this},p.__private__.rect=p.rect=function(e,t,n,r,a){if(isNaN(e)||isNaN(t)||isNaN(n)||isNaN(r)||!Mt(a))throw new Error("Invalid arguments passed to jsPDF.rect");return w===y&&(r=-r),ee([C(A(e)),C(R(t)),C(A(n)),C(A(r)),"re"].join(" ")),Ut(a),this},p.__private__.triangle=p.triangle=function(e,t,n,r,a,i,o){if(isNaN(e)||isNaN(t)||isNaN(n)||isNaN(r)||isNaN(a)||isNaN(i)||!Mt(o))throw new Error("Invalid arguments passed to jsPDF.triangle");return this.lines([[n-e,r-t],[a-n,i-r],[e-a,t-i]],e,t,[1,1],o,!0),this},p.__private__.roundedRect=p.roundedRect=function(e,t,n,r,a,i,o){if(isNaN(e)||isNaN(t)||isNaN(n)||isNaN(r)||isNaN(a)||isNaN(i)||!Mt(o))throw new Error("Invalid arguments passed to jsPDF.roundedRect");var s=4/3*(Math.SQRT2-1);return a=Math.min(a,.5*n),i=Math.min(i,.5*r),this.lines([[n-2*a,0],[a*s,0,a,i-i*s,a,i],[0,r-2*i],[0,i*s,-a*s,i,-a,i],[2*a-n,0],[-a*s,0,-a,-i*s,-a,-i],[0,2*i-r],[0,-i*s,a*s,-i,a,-i]],e+a,t,[1,1],o,!0),this},p.__private__.ellipse=p.ellipse=function(e,t,n,r,a){if(isNaN(e)||isNaN(t)||isNaN(n)||isNaN(r)||!Mt(a))throw new Error("Invalid arguments passed to jsPDF.ellipse");var i=4/3*(Math.SQRT2-1)*n,o=4/3*(Math.SQRT2-1)*r;return Gt(e+n,t),Kt(e+n,t-o,e+i,t-r,e,t-r),Kt(e-i,t-r,e-n,t-o,e-n,t),Kt(e-n,t+o,e-i,t+r,e,t+r),Kt(e+i,t+r,e+n,t+o,e+n,t),Ut(a),this},p.__private__.circle=p.circle=function(e,t,n,r){if(isNaN(e)||isNaN(t)||isNaN(n)||!Mt(r))throw new Error("Invalid arguments passed to jsPDF.circle");return this.ellipse(e,t,n,n,r)},p.setFont=function(e,t,n){return n&&(t=N(t,n)),ve=kt(e,t,{disableWarning:!1}),this};var Xt=p.__private__.getFont=p.getFont=function(){return ke[kt.apply(p,arguments)]};p.__private__.getFontList=p.getFontList=function(){var e,t,n={};for(e in Ie)if(Ie.hasOwnProperty(e))for(t in n[e]=[],Ie[e])Ie[e].hasOwnProperty(t)&&n[e].push(t);return n},p.addFont=function(e,t,n,r,a){var i=["StandardEncoding","MacRomanEncoding","Identity-H","WinAnsiEncoding"];return arguments[3]&&-1!==i.indexOf(arguments[3])?a=arguments[3]:arguments[3]&&-1==i.indexOf(arguments[3])&&(n=N(n,r)),mt.call(this,e,t,n,a=a||"Identity-H")};var Yt,$t=e.lineWidth||.200025,Jt=p.__private__.getLineWidth=p.getLineWidth=function(){return $t},Qt=p.__private__.setLineWidth=p.setLineWidth=function(e){return $t=e,ee(C(A(e))+" w"),this};p.__private__.setLineDash=Ae.API.setLineDash=Ae.API.setLineDashPattern=function(e,t){if(e=e||[],t=t||0,isNaN(t)||!Array.isArray(e))throw new Error("Invalid arguments passed to jsPDF.setLineDash");return e=e.map(function(e){return C(A(e))}).join(" "),t=C(A(t)),ee("["+e+"] "+t+" d"),this};var Zt=p.__private__.getLineHeight=p.getLineHeight=function(){return se*Yt};p.__private__.getLineHeight=p.getLineHeight=function(){return se*Yt};var en=p.__private__.setLineHeightFactor=p.setLineHeightFactor=function(e){return"number"==typeof(e=e||1.15)&&(Yt=e),this},tn=p.__private__.getLineHeightFactor=p.getLineHeightFactor=function(){return Yt};en(e.lineHeight);var nn=p.__private__.getHorizontalCoordinate=function(e){return A(e)},rn=p.__private__.getVerticalCoordinate=function(e){return w===x?e:je[z].mediaBox.topRightY-je[z].mediaBox.bottomLeftY-A(e)},an=p.__private__.getHorizontalCoordinateString=p.getHorizontalCoordinateString=function(e){return C(nn(e))},on=p.__private__.getVerticalCoordinateString=p.getVerticalCoordinateString=function(e){return C(rn(e))},sn=e.strokeColor||"0 G";p.__private__.getStrokeColor=p.getDrawColor=function(){return tt(sn)},p.__private__.setStrokeColor=p.setDrawColor=function(e,t,n,r){return sn=nt({ch1:e,ch2:t,ch3:n,ch4:r,pdfColorType:"draw",precision:2}),ee(sn),this};var cn=e.fillColor||"0 g";p.__private__.getFillColor=p.getFillColor=function(){return tt(cn)},p.__private__.setFillColor=p.setFillColor=function(e,t,n,r){return cn=nt({ch1:e,ch2:t,ch3:n,ch4:r,pdfColorType:"fill",precision:2}),ee(cn),this};var ln=e.textColor||"0 g",un=p.__private__.getTextColor=p.getTextColor=function(){return tt(ln)};p.__private__.setTextColor=p.setTextColor=function(e,t,n,r){return ln=nt({ch1:e,ch2:t,ch3:n,ch4:r,pdfColorType:"text",precision:3}),this};var hn=e.charSpace,dn=p.__private__.getCharSpace=p.getCharSpace=function(){return parseFloat(hn||0)};p.__private__.setCharSpace=p.setCharSpace=function(e){if(isNaN(e))throw new Error("Invalid argument passed to jsPDF.setCharSpace");return hn=e,this};var fn=0;p.CapJoinStyles={0:0,butt:0,but:0,miter:0,1:1,round:1,rounded:1,circle:1,2:2,projecting:2,project:2,square:2,bevel:2},p.__private__.setLineCap=p.setLineCap=function(e){var t=p.CapJoinStyles[e];if(void 0===t)throw new Error("Line cap style of '"+e+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return fn=t,ee(t+" J"),this};var pn=0;p.__private__.setLineJoin=p.setLineJoin=function(e){var t=p.CapJoinStyles[e];if(void 0===t)throw new Error("Line join style of '"+e+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return pn=t,ee(t+" j"),this},p.__private__.setLineMiterLimit=p.__private__.setMiterLimit=p.setLineMiterLimit=p.setMiterLimit=function(e){if(e=e||0,isNaN(e))throw new Error("Invalid argument passed to jsPDF.setLineMiterLimit");return ee(C(A(e))+" M"),this},p.GState=Ee,p.setGState=function(e){(e="string"==typeof e?Oe[Le[e]]:mn(null,e)).equals(Pe)||(ee("/"+e.id+" gs"),Pe=e)};var mn=function(e,t){if(!e||!Le[e]){var n=!1;for(var r in Oe)if(Oe.hasOwnProperty(r)&&Oe[r].equals(t)){n=!0;break}if(n)t=Oe[r];else{var a="GS"+(Object.keys(Oe).length+1).toString(10);Oe[a]=t,t.id=a}return e&&(Le[e]=t.id),Be.publish("addGState",t),t}};p.addGState=function(e,t){return mn(e,t),this},p.saveGraphicsState=function(){return ee("q"),Re.push({key:ve,size:se,color:ln}),this},p.restoreGraphicsState=function(){ee("Q");var e=Re.pop();return ve=e.key,se=e.size,ln=e.color,Pe=null,this},p.setCurrentTransformationMatrix=function(e){return ee(e.toString()+" cm"),this},p.comment=function(e){return ee("#"+e),this};var gn=function(e,t){var n=e||0;Object.defineProperty(this,"x",{enumerable:!0,get:function(){return n},set:function(e){isNaN(e)||(n=parseFloat(e))}});var r=t||0;Object.defineProperty(this,"y",{enumerable:!0,get:function(){return r},set:function(e){isNaN(e)||(r=parseFloat(e))}});var a="pt";return Object.defineProperty(this,"type",{enumerable:!0,get:function(){return a},set:function(e){a=e.toString()}}),this},vn=function(e,t,n,r){gn.call(this,e,t),this.type="rect";var a=n||0;Object.defineProperty(this,"w",{enumerable:!0,get:function(){return a},set:function(e){isNaN(e)||(a=parseFloat(e))}});var i=r||0;return Object.defineProperty(this,"h",{enumerable:!0,get:function(){return i},set:function(e){isNaN(e)||(i=parseFloat(e))}}),this},bn=function(){this.page=Me,this.currentPage=z,this.pages=X.slice(0),this.pagesContext=je.slice(0),this.x=ye,this.y=xe,this.matrix=we,this.width=wn(z),this.height=Sn(z),this.outputDestination=$,this.id="",this.objectNumber=-1};bn.prototype.restore=function(){Me=this.page,z=this.currentPage,je=this.pagesContext,X=this.pages,ye=this.x,xe=this.y,we=this.matrix,kn(z,this.width),Nn(z,this.height),$=this.outputDestination};var yn=function(e,t,n,r,a){Ve.push(new bn),Me=z=0,X=[],ye=e,xe=t,we=a,vt([n,r])};for(var xn in p.beginFormObject=function(e,t,n,r,a){return yn(e,t,n,r,a),this},p.endFormObject=function(e){return function(e){if(We[e])Ve.pop().restore();else{var t=new bn,n="Xo"+(Object.keys(Ue).length+1).toString(10);t.id=n,We[e]=n,Ue[n]=t,Be.publish("addFormObject",t),Ve.pop().restore()}}(e),this},p.doFormObject=function(e,t){var n=Ue[We[e]];return ee("q"),ee(t.toString()+" cm"),ee("/"+n.id+" Do"),ee("Q"),this},p.getFormObject=function(e){var t=Ue[We[e]];return{x:t.x,y:t.y,width:t.width,height:t.height,matrix:t.matrix}},p.save=function(e,t){return e=e||"generated.pdf",(t=t||{}).returnPromise=t.returnPromise||!1,!1===t.returnPromise?(ie(_t(Tt()),e),"function"==typeof ie.unload&&J.setTimeout&&setTimeout(ie.unload,911),this):new Promise(function(t,n){try{var r=ie(_t(Tt()),e);"function"==typeof ie.unload&&J.setTimeout&&setTimeout(ie.unload,911),t(r)}catch(e){n(e.message)}})},Ae.API)Ae.API.hasOwnProperty(xn)&&("events"===xn&&Ae.API.events.length?function(e,t){var n,r,a;for(a=t.length-1;-1!==a;a--)n=t[a][0],r=t[a][1],e.subscribe.apply(e,[n].concat("function"==typeof r?[r]:r))}(Be,Ae.API.events):p[xn]=Ae.API[xn]);var wn=p.getPageWidth=function(e){return(je[e=e||z].mediaBox.topRightX-je[e].mediaBox.bottomLeftX)/be},kn=p.setPageWidth=function(e,t){je[e].mediaBox.topRightX=t*be+je[e].mediaBox.bottomLeftX},Sn=p.getPageHeight=function(e){return(je[e=e||z].mediaBox.topRightY-je[e].mediaBox.bottomLeftY)/be},Nn=p.setPageHeight=function(e,t){je[e].mediaBox.topRightY=t*be+je[e].mediaBox.bottomLeftY};return p.internal={pdfEscape:gt,getStyle:jt,getFont:Xt,getFontSize:le,getCharSpace:dn,getTextColor:un,getLineHeight:Zt,getLineHeightFactor:tn,getLineWidth:Jt,write:te,getHorizontalCoordinate:nn,getVerticalCoordinate:rn,getCoordinateString:an,getVerticalCoordinateString:on,collections:{},newObject:Ye,newAdditionalObject:Qe,newObjectDeferred:$e,newObjectDeferredBegin:Je,getFilters:rt,putStream:at,events:Be,scaleFactor:be,pageSize:{getWidth:function(){return wn(z)},setWidth:function(e){kn(z,e)},getHeight:function(){return Sn(z)},setHeight:function(e){Nn(z,e)}},encryptionOptions:h,encryption:Ft,getEncryptor:function(e){return null!==h?Ft.encryptor(e,0):function(e){return e}},output:At,getNumberOfPages:wt,pages:X,out:ee,f2:T,f3:_,getPageInfo:Dt,getPageInfoByObjId:Ot,getCurrentPageInfo:Lt,getPDFVersion:g,Point:gn,Rectangle:vn,Matrix:He,hasHotfix:Rt},Object.defineProperty(p.internal.pageSize,"width",{get:function(){return wn(z)},set:function(e){kn(z,e)},enumerable:!0,configurable:!0}),Object.defineProperty(p.internal.pageSize,"height",{get:function(){return Sn(z)},set:function(e){Nn(z,e)},enumerable:!0,configurable:!0}),function(e){for(var t=0,n=re.length;t<n;t++){var r=mt.call(this,e[t][0],e[t][1],e[t][2],re[t][3],!0);!1===d&&(f[r]=!0);var a=e[t][0].split("-");pt({id:r,fontName:a[0],fontStyle:a[1]||""})}Be.publish("addFonts",{fonts:ke,dictionary:Ie})}.call(p,re),ve="F1",bt(i,n),Be.publish("initialized"),p}Se.prototype.lsbFirstWord=function(e){return String.fromCharCode(255&e,e>>8&255,e>>16&255,e>>24&255)},Se.prototype.toHexString=function(e){return e.split("").map(function(e){return("0"+(255&e.charCodeAt(0)).toString(16)).slice(-2)}).join("")},Se.prototype.hexToBytes=function(e){for(var t=[],n=0;n<e.length;n+=2)t.push(String.fromCharCode(parseInt(e.substr(n,2),16)));return t.join("")},Se.prototype.processOwnerPassword=function(e,t){return we(be(t).substr(0,5),e)},Se.prototype.encryptor=function(e,t){var n=be(this.encryptionKey+String.fromCharCode(255&e,e>>8&255,e>>16&255,255&t,t>>8&255)).substr(0,10);return function(e){return we(n,e)}},Ee.prototype.equals=function(e){var t,n="id,objectNumber,equals";if(!e||(0,r.A)(e)!==(0,r.A)(this))return!1;var a=0;for(t in this)if(!(n.indexOf(t)>=0)){if(this.hasOwnProperty(t)&&!e.hasOwnProperty(t))return!1;if(this[t]!==e[t])return!1;a++}for(t in e)e.hasOwnProperty(t)&&n.indexOf(t)<0&&a--;return 0===a},Ae.API={events:[]},Ae.version="2.5.1";var Re=Ae.API,Fe=1,De=function(e){return e.replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},Oe=function(e){return e.replace(/\\\\/g,"\\").replace(/\\\(/g,"(").replace(/\\\)/g,")")},Le=function(e){return e.toFixed(2)},Pe=function(e){return e.toFixed(5)};Re.__acroform__={};var Me=function(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e},je=function(e){return e*Fe},Be=function(e){var t=new nt,n=gt.internal.getHeight(e)||0,r=gt.internal.getWidth(e)||0;return t.BBox=[0,0,Number(Le(r)),Number(Le(n))],t},ze=Re.__acroform__.setBit=function(e,t){if(e=e||0,t=t||0,isNaN(e)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBit");return e|1<<t},Ue=Re.__acroform__.clearBit=function(e,t){if(e=e||0,t=t||0,isNaN(e)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBit");return e&~(1<<t)},We=Re.__acroform__.getBit=function(e,t){if(isNaN(e)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBit");return 0==(e&1<<t)?0:1},Ve=Re.__acroform__.getBitForPdf=function(e,t){if(isNaN(e)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBitForPdf");return We(e,t-1)},He=Re.__acroform__.setBitForPdf=function(e,t){if(isNaN(e)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBitForPdf");return ze(e,t-1)},Ge=Re.__acroform__.clearBitForPdf=function(e,t){if(isNaN(e)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBitForPdf");return Ue(e,t-1)},qe=Re.__acroform__.calculateCoordinates=function(e,t){var n=t.internal.getHorizontalCoordinate,r=t.internal.getVerticalCoordinate,a=e[0],i=e[1],o=e[2],s=e[3],c={};return c.lowerLeft_X=n(a)||0,c.lowerLeft_Y=r(i+s)||0,c.upperRight_X=n(a+o)||0,c.upperRight_Y=r(i)||0,[Number(Le(c.lowerLeft_X)),Number(Le(c.lowerLeft_Y)),Number(Le(c.upperRight_X)),Number(Le(c.upperRight_Y))]},Ke=function(e){if(e.appearanceStreamContent)return e.appearanceStreamContent;if(e.V||e.DV){var t=[],n=e._V||e.DV,r=Xe(e,n),a=e.scope.internal.getFont(e.fontName,e.fontStyle).id;t.push("/Tx BMC"),t.push("q"),t.push("BT"),t.push(e.scope.__private__.encodeColorString(e.color)),t.push("/"+a+" "+Le(r.fontSize)+" Tf"),t.push("1 0 0 1 0 0 Tm"),t.push(r.text),t.push("ET"),t.push("Q"),t.push("EMC");var i=Be(e);return i.scope=e.scope,i.stream=t.join("\n"),i}},Xe=function(e,t){var n=0===e.fontSize?e.maxFontSize:e.fontSize,r={text:"",fontSize:""},a=(t=")"==(t="("==t.substr(0,1)?t.substr(1):t).substr(t.length-1)?t.substr(0,t.length-1):t).split(" ");a=e.multiline?a.map(function(e){return e.split("\n")}):a.map(function(e){return[e]});var i=n,o=gt.internal.getHeight(e)||0;o=o<0?-o:o;var s=gt.internal.getWidth(e)||0;s=s<0?-s:s;var c=function(t,n,r){if(t+1<a.length){var i=n+" "+a[t+1][0];return Ye(i,e,r).width<=s-4}return!1};i++;e:for(;i>0;){t="",i--;var l,u,h=Ye("3",e,i).height,d=e.multiline?o-i:(o-h)/2,f=d+=2,p=0,m=0,g=0;if(i<=0){t="(...) Tj\n",t+="% Width of Text: "+Ye(t,e,i=12).width+", FieldWidth:"+s+"\n";break}for(var v="",b=0,y=0;y<a.length;y++)if(a.hasOwnProperty(y)){var x=!1;if(1!==a[y].length&&g!==a[y].length-1){if((h+2)*(b+2)+2>o)continue e;v+=a[y][g],x=!0,m=y,y--}else{v=" "==(v+=a[y][g]+" ").substr(v.length-1)?v.substr(0,v.length-1):v;var w=parseInt(y),k=c(w,v,i),S=y>=a.length-1;if(k&&!S){v+=" ",g=0;continue}if(k||S){if(S)m=w;else if(e.multiline&&(h+2)*(b+2)+2>o)continue e}else{if(!e.multiline)continue e;if((h+2)*(b+2)+2>o)continue e;m=w}}for(var N="",C=p;C<=m;C++){var E=a[C];if(e.multiline){if(C===m){N+=E[g]+" ",g=(g+1)%E.length;continue}if(C===p){N+=E[E.length-1]+" ";continue}}N+=E[0]+" "}switch(N=" "==N.substr(N.length-1)?N.substr(0,N.length-1):N,u=Ye(N,e,i).width,e.textAlign){case"right":l=s-u-2;break;case"center":l=(s-u)/2;break;default:l=2}t+=Le(l)+" "+Le(f)+" Td\n",t+="("+De(N)+") Tj\n",t+=-Le(l)+" 0 Td\n",f=-(i+2),u=0,p=x?m:m+1,b++,v=""}break}return r.text=t,r.fontSize=i,r},Ye=function(e,t,n){var r=t.scope.internal.getFont(t.fontName,t.fontStyle),a=t.scope.getStringUnitWidth(e,{font:r,fontSize:parseFloat(n),charSpace:0})*parseFloat(n);return{height:t.scope.getStringUnitWidth("3",{font:r,fontSize:parseFloat(n),charSpace:0})*parseFloat(n)*1.5,width:a}},$e={fields:[],xForms:[],acroFormDictionaryRoot:null,printedOut:!1,internal:null,isInitialized:!1},Je=function(e,t){var n={type:"reference",object:e};void 0===t.internal.getPageInfo(e.page).pageContext.annotations.find(function(e){return e.type===n.type&&e.object===n.object})&&t.internal.getPageInfo(e.page).pageContext.annotations.push(n)},Qe=function(e,t){if(t.scope=e,void 0!==e.internal&&(void 0===e.internal.acroformPlugin||!1===e.internal.acroformPlugin.isInitialized)){if(at.FieldNum=0,e.internal.acroformPlugin=JSON.parse(JSON.stringify($e)),e.internal.acroformPlugin.acroFormDictionaryRoot)throw new Error("Exception while creating AcroformDictionary");Fe=e.internal.scaleFactor,e.internal.acroformPlugin.acroFormDictionaryRoot=new rt,e.internal.acroformPlugin.acroFormDictionaryRoot.scope=e,e.internal.acroformPlugin.acroFormDictionaryRoot._eventID=e.internal.events.subscribe("postPutResources",function(){var t;(t=e).internal.events.unsubscribe(t.internal.acroformPlugin.acroFormDictionaryRoot._eventID),delete t.internal.acroformPlugin.acroFormDictionaryRoot._eventID,t.internal.acroformPlugin.printedOut=!0}),e.internal.events.subscribe("buildDocument",function(){!function(e){e.internal.acroformPlugin.acroFormDictionaryRoot.objId=void 0;var t=e.internal.acroformPlugin.acroFormDictionaryRoot.Fields;for(var n in t)if(t.hasOwnProperty(n)){var r=t[n];r.objId=void 0,r.hasAnnotation&&Je(r,e)}}(e)}),e.internal.events.subscribe("putCatalog",function(){!function(e){if(void 0===e.internal.acroformPlugin.acroFormDictionaryRoot)throw new Error("putCatalogCallback: Root missing.");e.internal.write("/AcroForm "+e.internal.acroformPlugin.acroFormDictionaryRoot.objId+" 0 R")}(e)}),e.internal.events.subscribe("postPutPages",function(t){!function(e,t){var n=!e;for(var a in e||(t.internal.newObjectDeferredBegin(t.internal.acroformPlugin.acroFormDictionaryRoot.objId,!0),t.internal.acroformPlugin.acroFormDictionaryRoot.putStream()),e=e||t.internal.acroformPlugin.acroFormDictionaryRoot.Kids)if(e.hasOwnProperty(a)){var i=e[a],o=[],s=i.Rect;if(i.Rect&&(i.Rect=qe(i.Rect,t)),t.internal.newObjectDeferredBegin(i.objId,!0),i.DA=gt.createDefaultAppearanceStream(i),"object"===(0,r.A)(i)&&"function"==typeof i.getKeyValueListForStream&&(o=i.getKeyValueListForStream()),i.Rect=s,i.hasAppearanceStream&&!i.appearanceStreamContent){var c=Ke(i);o.push({key:"AP",value:"<</N "+c+">>"}),t.internal.acroformPlugin.xForms.push(c)}if(i.appearanceStreamContent){var l="";for(var u in i.appearanceStreamContent)if(i.appearanceStreamContent.hasOwnProperty(u)){var h=i.appearanceStreamContent[u];if(l+="/"+u+" ",l+="<<",Object.keys(h).length>=1||Array.isArray(h)){for(var a in h)if(h.hasOwnProperty(a)){var d=h[a];"function"==typeof d&&(d=d.call(t,i)),l+="/"+a+" "+d+" ",t.internal.acroformPlugin.xForms.indexOf(d)>=0||t.internal.acroformPlugin.xForms.push(d)}}else"function"==typeof(d=h)&&(d=d.call(t,i)),l+="/"+a+" "+d,t.internal.acroformPlugin.xForms.indexOf(d)>=0||t.internal.acroformPlugin.xForms.push(d);l+=">>"}o.push({key:"AP",value:"<<\n"+l+">>"})}t.internal.putStream({additionalKeyValues:o,objectId:i.objId}),t.internal.out("endobj")}n&&function(e,t){for(var n in e)if(e.hasOwnProperty(n)){var a=n,i=e[n];t.internal.newObjectDeferredBegin(i.objId,!0),"object"===(0,r.A)(i)&&"function"==typeof i.putStream&&i.putStream(),delete e[a]}}(t.internal.acroformPlugin.xForms,t)}(t,e)}),e.internal.acroformPlugin.isInitialized=!0}},Ze=Re.__acroform__.arrayToPdfArray=function(e,t,n){var a=function(e){return e};if(Array.isArray(e)){for(var i="[",o=0;o<e.length;o++)switch(0!==o&&(i+=" "),(0,r.A)(e[o])){case"boolean":case"number":case"object":i+=e[o].toString();break;case"string":"/"!==e[o].substr(0,1)?(void 0!==t&&n&&(a=n.internal.getEncryptor(t)),i+="("+De(a(e[o].toString()))+")"):i+=e[o].toString()}return i+"]"}throw new Error("Invalid argument passed to jsPDF.__acroform__.arrayToPdfArray")},et=function(e,t,n){var r=function(e){return e};return void 0!==t&&n&&(r=n.internal.getEncryptor(t)),(e=e||"").toString(),"("+De(r(e))+")"},tt=function(){this._objId=void 0,this._scope=void 0,Object.defineProperty(this,"objId",{get:function(){if(void 0===this._objId){if(void 0===this.scope)return;this._objId=this.scope.internal.newObjectDeferred()}return this._objId},set:function(e){this._objId=e}}),Object.defineProperty(this,"scope",{value:this._scope,writable:!0})};tt.prototype.toString=function(){return this.objId+" 0 R"},tt.prototype.putStream=function(){var e=this.getKeyValueListForStream();this.scope.internal.putStream({data:this.stream,additionalKeyValues:e,objectId:this.objId}),this.scope.internal.out("endobj")},tt.prototype.getKeyValueListForStream=function(){var e=[],t=Object.getOwnPropertyNames(this).filter(function(e){return"content"!=e&&"appearanceStreamContent"!=e&&"scope"!=e&&"objId"!=e&&"_"!=e.substring(0,1)});for(var n in t)if(!1===Object.getOwnPropertyDescriptor(this,t[n]).configurable){var r=t[n],a=this[r];a&&(Array.isArray(a)?e.push({key:r,value:Ze(a,this.objId,this.scope)}):a instanceof tt?(a.scope=this.scope,e.push({key:r,value:a.objId+" 0 R"})):"function"!=typeof a&&e.push({key:r,value:a}))}return e};var nt=function(){tt.call(this),Object.defineProperty(this,"Type",{value:"/XObject",configurable:!1,writable:!0}),Object.defineProperty(this,"Subtype",{value:"/Form",configurable:!1,writable:!0}),Object.defineProperty(this,"FormType",{value:1,configurable:!1,writable:!0});var e,t=[];Object.defineProperty(this,"BBox",{configurable:!1,get:function(){return t},set:function(e){t=e}}),Object.defineProperty(this,"Resources",{value:"2 0 R",configurable:!1,writable:!0}),Object.defineProperty(this,"stream",{enumerable:!1,configurable:!0,set:function(t){e=t.trim()},get:function(){return e||null}})};Me(nt,tt);var rt=function(){tt.call(this);var e,t=[];Object.defineProperty(this,"Kids",{enumerable:!1,configurable:!0,get:function(){return t.length>0?t:void 0}}),Object.defineProperty(this,"Fields",{enumerable:!1,configurable:!1,get:function(){return t}}),Object.defineProperty(this,"DA",{enumerable:!1,configurable:!1,get:function(){if(e){var t=function(e){return e};return this.scope&&(t=this.scope.internal.getEncryptor(this.objId)),"("+De(t(e))+")"}},set:function(t){e=t}})};Me(rt,tt);var at=function e(){tt.call(this);var t=4;Object.defineProperty(this,"F",{enumerable:!1,configurable:!1,get:function(){return t},set:function(e){if(isNaN(e))throw new Error('Invalid value "'+e+'" for attribute F supplied.');t=e}}),Object.defineProperty(this,"showWhenPrinted",{enumerable:!0,configurable:!0,get:function(){return Boolean(Ve(t,3))},set:function(e){!0===Boolean(e)?this.F=He(t,3):this.F=Ge(t,3)}});var n=0;Object.defineProperty(this,"Ff",{enumerable:!1,configurable:!1,get:function(){return n},set:function(e){if(isNaN(e))throw new Error('Invalid value "'+e+'" for attribute Ff supplied.');n=e}});var r=[];Object.defineProperty(this,"Rect",{enumerable:!1,configurable:!1,get:function(){if(0!==r.length)return r},set:function(e){r=void 0!==e?e:[]}}),Object.defineProperty(this,"x",{enumerable:!0,configurable:!0,get:function(){return!r||isNaN(r[0])?0:r[0]},set:function(e){r[0]=e}}),Object.defineProperty(this,"y",{enumerable:!0,configurable:!0,get:function(){return!r||isNaN(r[1])?0:r[1]},set:function(e){r[1]=e}}),Object.defineProperty(this,"width",{enumerable:!0,configurable:!0,get:function(){return!r||isNaN(r[2])?0:r[2]},set:function(e){r[2]=e}}),Object.defineProperty(this,"height",{enumerable:!0,configurable:!0,get:function(){return!r||isNaN(r[3])?0:r[3]},set:function(e){r[3]=e}});var a="";Object.defineProperty(this,"FT",{enumerable:!0,configurable:!1,get:function(){return a},set:function(e){switch(e){case"/Btn":case"/Tx":case"/Ch":case"/Sig":a=e;break;default:throw new Error('Invalid value "'+e+'" for attribute FT supplied.')}}});var i=null;Object.defineProperty(this,"T",{enumerable:!0,configurable:!1,get:function(){if(!i||i.length<1){if(this instanceof dt)return;i="FieldObject"+e.FieldNum++}var t=function(e){return e};return this.scope&&(t=this.scope.internal.getEncryptor(this.objId)),"("+De(t(i))+")"},set:function(e){i=e.toString()}}),Object.defineProperty(this,"fieldName",{configurable:!0,enumerable:!0,get:function(){return i},set:function(e){i=e}});var o="helvetica";Object.defineProperty(this,"fontName",{enumerable:!0,configurable:!0,get:function(){return o},set:function(e){o=e}});var s="normal";Object.defineProperty(this,"fontStyle",{enumerable:!0,configurable:!0,get:function(){return s},set:function(e){s=e}});var c=0;Object.defineProperty(this,"fontSize",{enumerable:!0,configurable:!0,get:function(){return c},set:function(e){c=e}});var l=void 0;Object.defineProperty(this,"maxFontSize",{enumerable:!0,configurable:!0,get:function(){return void 0===l?50/Fe:l},set:function(e){l=e}});var u="black";Object.defineProperty(this,"color",{enumerable:!0,configurable:!0,get:function(){return u},set:function(e){u=e}});var h="/F1 0 Tf 0 g";Object.defineProperty(this,"DA",{enumerable:!0,configurable:!1,get:function(){if(!(!h||this instanceof dt||this instanceof pt))return et(h,this.objId,this.scope)},set:function(e){e=e.toString(),h=e}});var d=null;Object.defineProperty(this,"DV",{enumerable:!1,configurable:!1,get:function(){if(d)return this instanceof lt==0?et(d,this.objId,this.scope):d},set:function(e){e=e.toString(),d=this instanceof lt==0?"("===e.substr(0,1)?Oe(e.substr(1,e.length-2)):Oe(e):e}}),Object.defineProperty(this,"defaultValue",{enumerable:!0,configurable:!0,get:function(){return this instanceof lt==1?Oe(d.substr(1,d.length-1)):d},set:function(e){e=e.toString(),d=this instanceof lt==1?"/"+e:e}});var f=null;Object.defineProperty(this,"_V",{enumerable:!1,configurable:!1,get:function(){if(f)return f},set:function(e){this.V=e}}),Object.defineProperty(this,"V",{enumerable:!1,configurable:!1,get:function(){if(f)return this instanceof lt==0?et(f,this.objId,this.scope):f},set:function(e){e=e.toString(),f=this instanceof lt==0?"("===e.substr(0,1)?Oe(e.substr(1,e.length-2)):Oe(e):e}}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,get:function(){return this instanceof lt==1?Oe(f.substr(1,f.length-1)):f},set:function(e){e=e.toString(),f=this instanceof lt==1?"/"+e:e}}),Object.defineProperty(this,"hasAnnotation",{enumerable:!0,configurable:!0,get:function(){return this.Rect}}),Object.defineProperty(this,"Type",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Annot":null}}),Object.defineProperty(this,"Subtype",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Widget":null}});var p,m=!1;Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return m},set:function(e){e=Boolean(e),m=e}}),Object.defineProperty(this,"page",{enumerable:!0,configurable:!0,get:function(){if(p)return p},set:function(e){p=e}}),Object.defineProperty(this,"readOnly",{enumerable:!0,configurable:!0,get:function(){return Boolean(Ve(this.Ff,1))},set:function(e){!0===Boolean(e)?this.Ff=He(this.Ff,1):this.Ff=Ge(this.Ff,1)}}),Object.defineProperty(this,"required",{enumerable:!0,configurable:!0,get:function(){return Boolean(Ve(this.Ff,2))},set:function(e){!0===Boolean(e)?this.Ff=He(this.Ff,2):this.Ff=Ge(this.Ff,2)}}),Object.defineProperty(this,"noExport",{enumerable:!0,configurable:!0,get:function(){return Boolean(Ve(this.Ff,3))},set:function(e){!0===Boolean(e)?this.Ff=He(this.Ff,3):this.Ff=Ge(this.Ff,3)}});var g=null;Object.defineProperty(this,"Q",{enumerable:!0,configurable:!1,get:function(){if(null!==g)return g},set:function(e){if(-1===[0,1,2].indexOf(e))throw new Error('Invalid value "'+e+'" for attribute Q supplied.');g=e}}),Object.defineProperty(this,"textAlign",{get:function(){var e;switch(g){case 0:default:e="left";break;case 1:e="center";break;case 2:e="right"}return e},configurable:!0,enumerable:!0,set:function(e){switch(e){case"right":case 2:g=2;break;case"center":case 1:g=1;break;default:g=0}}})};Me(at,tt);var it=function(){at.call(this),this.FT="/Ch",this.V="()",this.fontName="zapfdingbats";var e=0;Object.defineProperty(this,"TI",{enumerable:!0,configurable:!1,get:function(){return e},set:function(t){e=t}}),Object.defineProperty(this,"topIndex",{enumerable:!0,configurable:!0,get:function(){return e},set:function(t){e=t}});var t=[];Object.defineProperty(this,"Opt",{enumerable:!0,configurable:!1,get:function(){return Ze(t,this.objId,this.scope)},set:function(e){var n,r;r=[],"string"==typeof(n=e)&&(r=function(e,t,n){n||(n=1);for(var r,a=[];r=t.exec(e);)a.push(r[n]);return a}(n,/\((.*?)\)/g)),t=r}}),this.getOptions=function(){return t},this.setOptions=function(e){t=e,this.sort&&t.sort()},this.addOption=function(e){e=(e=e||"").toString(),t.push(e),this.sort&&t.sort()},this.removeOption=function(e,n){for(n=n||!1,e=(e=e||"").toString();-1!==t.indexOf(e)&&(t.splice(t.indexOf(e),1),!1!==n););},Object.defineProperty(this,"combo",{enumerable:!0,configurable:!0,get:function(){return Boolean(Ve(this.Ff,18))},set:function(e){!0===Boolean(e)?this.Ff=He(this.Ff,18):this.Ff=Ge(this.Ff,18)}}),Object.defineProperty(this,"edit",{enumerable:!0,configurable:!0,get:function(){return Boolean(Ve(this.Ff,19))},set:function(e){!0===this.combo&&(!0===Boolean(e)?this.Ff=He(this.Ff,19):this.Ff=Ge(this.Ff,19))}}),Object.defineProperty(this,"sort",{enumerable:!0,configurable:!0,get:function(){return Boolean(Ve(this.Ff,20))},set:function(e){!0===Boolean(e)?(this.Ff=He(this.Ff,20),t.sort()):this.Ff=Ge(this.Ff,20)}}),Object.defineProperty(this,"multiSelect",{enumerable:!0,configurable:!0,get:function(){return Boolean(Ve(this.Ff,22))},set:function(e){!0===Boolean(e)?this.Ff=He(this.Ff,22):this.Ff=Ge(this.Ff,22)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return Boolean(Ve(this.Ff,23))},set:function(e){!0===Boolean(e)?this.Ff=He(this.Ff,23):this.Ff=Ge(this.Ff,23)}}),Object.defineProperty(this,"commitOnSelChange",{enumerable:!0,configurable:!0,get:function(){return Boolean(Ve(this.Ff,27))},set:function(e){!0===Boolean(e)?this.Ff=He(this.Ff,27):this.Ff=Ge(this.Ff,27)}}),this.hasAppearanceStream=!1};Me(it,at);var ot=function(){it.call(this),this.fontName="helvetica",this.combo=!1};Me(ot,it);var st=function(){ot.call(this),this.combo=!0};Me(st,ot);var ct=function(){st.call(this),this.edit=!0};Me(ct,st);var lt=function(){at.call(this),this.FT="/Btn",Object.defineProperty(this,"noToggleToOff",{enumerable:!0,configurable:!0,get:function(){return Boolean(Ve(this.Ff,15))},set:function(e){!0===Boolean(e)?this.Ff=He(this.Ff,15):this.Ff=Ge(this.Ff,15)}}),Object.defineProperty(this,"radio",{enumerable:!0,configurable:!0,get:function(){return Boolean(Ve(this.Ff,16))},set:function(e){!0===Boolean(e)?this.Ff=He(this.Ff,16):this.Ff=Ge(this.Ff,16)}}),Object.defineProperty(this,"pushButton",{enumerable:!0,configurable:!0,get:function(){return Boolean(Ve(this.Ff,17))},set:function(e){!0===Boolean(e)?this.Ff=He(this.Ff,17):this.Ff=Ge(this.Ff,17)}}),Object.defineProperty(this,"radioIsUnison",{enumerable:!0,configurable:!0,get:function(){return Boolean(Ve(this.Ff,26))},set:function(e){!0===Boolean(e)?this.Ff=He(this.Ff,26):this.Ff=Ge(this.Ff,26)}});var e,t={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var e=function(e){return e};if(this.scope&&(e=this.scope.internal.getEncryptor(this.objId)),0!==Object.keys(t).length){var n,r=[];for(n in r.push("<<"),t)r.push("/"+n+" ("+De(e(t[n]))+")");return r.push(">>"),r.join("\n")}},set:function(e){"object"===(0,r.A)(e)&&(t=e)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return t.CA||""},set:function(e){"string"==typeof e&&(t.CA=e)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return e},set:function(t){e=t}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return e.substr(1,e.length-1)},set:function(t){e="/"+t}})};Me(lt,at);var ut=function(){lt.call(this),this.pushButton=!0};Me(ut,lt);var ht=function(){lt.call(this),this.radio=!0,this.pushButton=!1;var e=[];Object.defineProperty(this,"Kids",{enumerable:!0,configurable:!1,get:function(){return e},set:function(t){e=void 0!==t?t:[]}})};Me(ht,lt);var dt=function(){var e,t;at.call(this),Object.defineProperty(this,"Parent",{enumerable:!1,configurable:!1,get:function(){return e},set:function(t){e=t}}),Object.defineProperty(this,"optionName",{enumerable:!1,configurable:!0,get:function(){return t},set:function(e){t=e}});var n,a={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var e=function(e){return e};this.scope&&(e=this.scope.internal.getEncryptor(this.objId));var t,n=[];for(t in n.push("<<"),a)n.push("/"+t+" ("+De(e(a[t]))+")");return n.push(">>"),n.join("\n")},set:function(e){"object"===(0,r.A)(e)&&(a=e)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return a.CA||""},set:function(e){"string"==typeof e&&(a.CA=e)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return n},set:function(e){n=e}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return n.substr(1,n.length-1)},set:function(e){n="/"+e}}),this.caption="l",this.appearanceState="Off",this._AppearanceType=gt.RadioButton.Circle,this.appearanceStreamContent=this._AppearanceType.createAppearanceStream(this.optionName)};Me(dt,at),ht.prototype.setAppearance=function(e){if(!("createAppearanceStream"in e)||!("getCA"in e))throw new Error("Couldn't assign Appearance to RadioButton. Appearance was Invalid!");for(var t in this.Kids)if(this.Kids.hasOwnProperty(t)){var n=this.Kids[t];n.appearanceStreamContent=e.createAppearanceStream(n.optionName),n.caption=e.getCA()}},ht.prototype.createOption=function(e){var t=new dt;return t.Parent=this,t.optionName=e,this.Kids.push(t),vt.call(this.scope,t),t};var ft=function(){lt.call(this),this.fontName="zapfdingbats",this.caption="3",this.appearanceState="On",this.value="On",this.textAlign="center",this.appearanceStreamContent=gt.CheckBox.createAppearanceStream()};Me(ft,lt);var pt=function(){at.call(this),this.FT="/Tx",Object.defineProperty(this,"multiline",{enumerable:!0,configurable:!0,get:function(){return Boolean(Ve(this.Ff,13))},set:function(e){!0===Boolean(e)?this.Ff=He(this.Ff,13):this.Ff=Ge(this.Ff,13)}}),Object.defineProperty(this,"fileSelect",{enumerable:!0,configurable:!0,get:function(){return Boolean(Ve(this.Ff,21))},set:function(e){!0===Boolean(e)?this.Ff=He(this.Ff,21):this.Ff=Ge(this.Ff,21)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return Boolean(Ve(this.Ff,23))},set:function(e){!0===Boolean(e)?this.Ff=He(this.Ff,23):this.Ff=Ge(this.Ff,23)}}),Object.defineProperty(this,"doNotScroll",{enumerable:!0,configurable:!0,get:function(){return Boolean(Ve(this.Ff,24))},set:function(e){!0===Boolean(e)?this.Ff=He(this.Ff,24):this.Ff=Ge(this.Ff,24)}}),Object.defineProperty(this,"comb",{enumerable:!0,configurable:!0,get:function(){return Boolean(Ve(this.Ff,25))},set:function(e){!0===Boolean(e)?this.Ff=He(this.Ff,25):this.Ff=Ge(this.Ff,25)}}),Object.defineProperty(this,"richText",{enumerable:!0,configurable:!0,get:function(){return Boolean(Ve(this.Ff,26))},set:function(e){!0===Boolean(e)?this.Ff=He(this.Ff,26):this.Ff=Ge(this.Ff,26)}});var e=null;Object.defineProperty(this,"MaxLen",{enumerable:!0,configurable:!1,get:function(){return e},set:function(t){e=t}}),Object.defineProperty(this,"maxLength",{enumerable:!0,configurable:!0,get:function(){return e},set:function(t){Number.isInteger(t)&&(e=t)}}),Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return this.V||this.DV}})};Me(pt,at);var mt=function(){pt.call(this),Object.defineProperty(this,"password",{enumerable:!0,configurable:!0,get:function(){return Boolean(Ve(this.Ff,14))},set:function(e){!0===Boolean(e)?this.Ff=He(this.Ff,14):this.Ff=Ge(this.Ff,14)}}),this.password=!0};Me(mt,pt);var gt={CheckBox:{createAppearanceStream:function(){return{N:{On:gt.CheckBox.YesNormal},D:{On:gt.CheckBox.YesPushDown,Off:gt.CheckBox.OffPushDown}}},YesPushDown:function(e){var t=Be(e);t.scope=e.scope;var n=[],r=e.scope.internal.getFont(e.fontName,e.fontStyle).id,a=e.scope.__private__.encodeColorString(e.color),i=Xe(e,e.caption);return n.push("0.749023 g"),n.push("0 0 "+Le(gt.internal.getWidth(e))+" "+Le(gt.internal.getHeight(e))+" re"),n.push("f"),n.push("BMC"),n.push("q"),n.push("0 0 1 rg"),n.push("/"+r+" "+Le(i.fontSize)+" Tf "+a),n.push("BT"),n.push(i.text),n.push("ET"),n.push("Q"),n.push("EMC"),t.stream=n.join("\n"),t},YesNormal:function(e){var t=Be(e);t.scope=e.scope;var n=e.scope.internal.getFont(e.fontName,e.fontStyle).id,r=e.scope.__private__.encodeColorString(e.color),a=[],i=gt.internal.getHeight(e),o=gt.internal.getWidth(e),s=Xe(e,e.caption);return a.push("1 g"),a.push("0 0 "+Le(o)+" "+Le(i)+" re"),a.push("f"),a.push("q"),a.push("0 0 1 rg"),a.push("0 0 "+Le(o-1)+" "+Le(i-1)+" re"),a.push("W"),a.push("n"),a.push("0 g"),a.push("BT"),a.push("/"+n+" "+Le(s.fontSize)+" Tf "+r),a.push(s.text),a.push("ET"),a.push("Q"),t.stream=a.join("\n"),t},OffPushDown:function(e){var t=Be(e);t.scope=e.scope;var n=[];return n.push("0.749023 g"),n.push("0 0 "+Le(gt.internal.getWidth(e))+" "+Le(gt.internal.getHeight(e))+" re"),n.push("f"),t.stream=n.join("\n"),t}},RadioButton:{Circle:{createAppearanceStream:function(e){var t={D:{Off:gt.RadioButton.Circle.OffPushDown},N:{}};return t.N[e]=gt.RadioButton.Circle.YesNormal,t.D[e]=gt.RadioButton.Circle.YesPushDown,t},getCA:function(){return"l"},YesNormal:function(e){var t=Be(e);t.scope=e.scope;var n=[],r=gt.internal.getWidth(e)<=gt.internal.getHeight(e)?gt.internal.getWidth(e)/4:gt.internal.getHeight(e)/4;r=Number((.9*r).toFixed(5));var a=gt.internal.Bezier_C,i=Number((r*a).toFixed(5));return n.push("q"),n.push("1 0 0 1 "+Pe(gt.internal.getWidth(e)/2)+" "+Pe(gt.internal.getHeight(e)/2)+" cm"),n.push(r+" 0 m"),n.push(r+" "+i+" "+i+" "+r+" 0 "+r+" c"),n.push("-"+i+" "+r+" -"+r+" "+i+" -"+r+" 0 c"),n.push("-"+r+" -"+i+" -"+i+" -"+r+" 0 -"+r+" c"),n.push(i+" -"+r+" "+r+" -"+i+" "+r+" 0 c"),n.push("f"),n.push("Q"),t.stream=n.join("\n"),t},YesPushDown:function(e){var t=Be(e);t.scope=e.scope;var n=[],r=gt.internal.getWidth(e)<=gt.internal.getHeight(e)?gt.internal.getWidth(e)/4:gt.internal.getHeight(e)/4;r=Number((.9*r).toFixed(5));var a=Number((2*r).toFixed(5)),i=Number((a*gt.internal.Bezier_C).toFixed(5)),o=Number((r*gt.internal.Bezier_C).toFixed(5));return n.push("0.749023 g"),n.push("q"),n.push("1 0 0 1 "+Pe(gt.internal.getWidth(e)/2)+" "+Pe(gt.internal.getHeight(e)/2)+" cm"),n.push(a+" 0 m"),n.push(a+" "+i+" "+i+" "+a+" 0 "+a+" c"),n.push("-"+i+" "+a+" -"+a+" "+i+" -"+a+" 0 c"),n.push("-"+a+" -"+i+" -"+i+" -"+a+" 0 -"+a+" c"),n.push(i+" -"+a+" "+a+" -"+i+" "+a+" 0 c"),n.push("f"),n.push("Q"),n.push("0 g"),n.push("q"),n.push("1 0 0 1 "+Pe(gt.internal.getWidth(e)/2)+" "+Pe(gt.internal.getHeight(e)/2)+" cm"),n.push(r+" 0 m"),n.push(r+" "+o+" "+o+" "+r+" 0 "+r+" c"),n.push("-"+o+" "+r+" -"+r+" "+o+" -"+r+" 0 c"),n.push("-"+r+" -"+o+" -"+o+" -"+r+" 0 -"+r+" c"),n.push(o+" -"+r+" "+r+" -"+o+" "+r+" 0 c"),n.push("f"),n.push("Q"),t.stream=n.join("\n"),t},OffPushDown:function(e){var t=Be(e);t.scope=e.scope;var n=[],r=gt.internal.getWidth(e)<=gt.internal.getHeight(e)?gt.internal.getWidth(e)/4:gt.internal.getHeight(e)/4;r=Number((.9*r).toFixed(5));var a=Number((2*r).toFixed(5)),i=Number((a*gt.internal.Bezier_C).toFixed(5));return n.push("0.749023 g"),n.push("q"),n.push("1 0 0 1 "+Pe(gt.internal.getWidth(e)/2)+" "+Pe(gt.internal.getHeight(e)/2)+" cm"),n.push(a+" 0 m"),n.push(a+" "+i+" "+i+" "+a+" 0 "+a+" c"),n.push("-"+i+" "+a+" -"+a+" "+i+" -"+a+" 0 c"),n.push("-"+a+" -"+i+" -"+i+" -"+a+" 0 -"+a+" c"),n.push(i+" -"+a+" "+a+" -"+i+" "+a+" 0 c"),n.push("f"),n.push("Q"),t.stream=n.join("\n"),t}},Cross:{createAppearanceStream:function(e){var t={D:{Off:gt.RadioButton.Cross.OffPushDown},N:{}};return t.N[e]=gt.RadioButton.Cross.YesNormal,t.D[e]=gt.RadioButton.Cross.YesPushDown,t},getCA:function(){return"8"},YesNormal:function(e){var t=Be(e);t.scope=e.scope;var n=[],r=gt.internal.calculateCross(e);return n.push("q"),n.push("1 1 "+Le(gt.internal.getWidth(e)-2)+" "+Le(gt.internal.getHeight(e)-2)+" re"),n.push("W"),n.push("n"),n.push(Le(r.x1.x)+" "+Le(r.x1.y)+" m"),n.push(Le(r.x2.x)+" "+Le(r.x2.y)+" l"),n.push(Le(r.x4.x)+" "+Le(r.x4.y)+" m"),n.push(Le(r.x3.x)+" "+Le(r.x3.y)+" l"),n.push("s"),n.push("Q"),t.stream=n.join("\n"),t},YesPushDown:function(e){var t=Be(e);t.scope=e.scope;var n=gt.internal.calculateCross(e),r=[];return r.push("0.749023 g"),r.push("0 0 "+Le(gt.internal.getWidth(e))+" "+Le(gt.internal.getHeight(e))+" re"),r.push("f"),r.push("q"),r.push("1 1 "+Le(gt.internal.getWidth(e)-2)+" "+Le(gt.internal.getHeight(e)-2)+" re"),r.push("W"),r.push("n"),r.push(Le(n.x1.x)+" "+Le(n.x1.y)+" m"),r.push(Le(n.x2.x)+" "+Le(n.x2.y)+" l"),r.push(Le(n.x4.x)+" "+Le(n.x4.y)+" m"),r.push(Le(n.x3.x)+" "+Le(n.x3.y)+" l"),r.push("s"),r.push("Q"),t.stream=r.join("\n"),t},OffPushDown:function(e){var t=Be(e);t.scope=e.scope;var n=[];return n.push("0.749023 g"),n.push("0 0 "+Le(gt.internal.getWidth(e))+" "+Le(gt.internal.getHeight(e))+" re"),n.push("f"),t.stream=n.join("\n"),t}}},createDefaultAppearanceStream:function(e){var t=e.scope.internal.getFont(e.fontName,e.fontStyle).id,n=e.scope.__private__.encodeColorString(e.color);return"/"+t+" "+e.fontSize+" Tf "+n}};gt.internal={Bezier_C:.551915024494,calculateCross:function(e){var t=gt.internal.getWidth(e),n=gt.internal.getHeight(e),r=Math.min(t,n);return{x1:{x:(t-r)/2,y:(n-r)/2+r},x2:{x:(t-r)/2+r,y:(n-r)/2},x3:{x:(t-r)/2,y:(n-r)/2},x4:{x:(t-r)/2+r,y:(n-r)/2+r}}}},gt.internal.getWidth=function(e){var t=0;return"object"===(0,r.A)(e)&&(t=je(e.Rect[2])),t},gt.internal.getHeight=function(e){var t=0;return"object"===(0,r.A)(e)&&(t=je(e.Rect[3])),t};var vt=Re.addField=function(e){if(Qe(this,e),!(e instanceof at))throw new Error("Invalid argument passed to jsPDF.addField.");var t;return(t=e).scope.internal.acroformPlugin.printedOut&&(t.scope.internal.acroformPlugin.printedOut=!1,t.scope.internal.acroformPlugin.acroFormDictionaryRoot=null),t.scope.internal.acroformPlugin.acroFormDictionaryRoot.Fields.push(t),e.page=e.scope.internal.getCurrentPageInfo().pageNumber,this};Re.AcroFormChoiceField=it,Re.AcroFormListBox=ot,Re.AcroFormComboBox=st,Re.AcroFormEditBox=ct,Re.AcroFormButton=lt,Re.AcroFormPushButton=ut,Re.AcroFormRadioButton=ht,Re.AcroFormCheckBox=ft,Re.AcroFormTextField=pt,Re.AcroFormPasswordField=mt,Re.AcroFormAppearance=gt,Re.AcroForm={ChoiceField:it,ListBox:ot,ComboBox:st,EditBox:ct,Button:lt,PushButton:ut,RadioButton:ht,CheckBox:ft,TextField:pt,PasswordField:mt,Appearance:gt},Ae.AcroForm={ChoiceField:it,ListBox:ot,ComboBox:st,EditBox:ct,Button:lt,PushButton:ut,RadioButton:ht,CheckBox:ft,TextField:pt,PasswordField:mt,Appearance:gt};var bt=Ae.AcroForm;function yt(e){return e.reduce(function(e,t,n){return e[t]=n,e},{})}!function(e){e.__addimage__={};var t="UNKNOWN",n={PNG:[[137,80,78,71]],TIFF:[[77,77,0,42],[73,73,42,0]],JPEG:[[255,216,255,224,void 0,void 0,74,70,73,70,0],[255,216,255,225,void 0,void 0,69,120,105,102,0,0],[255,216,255,219],[255,216,255,238]],JPEG2000:[[0,0,0,12,106,80,32,32]],GIF87a:[[71,73,70,56,55,97]],GIF89a:[[71,73,70,56,57,97]],WEBP:[[82,73,70,70,void 0,void 0,void 0,void 0,87,69,66,80]],BMP:[[66,77],[66,65],[67,73],[67,80],[73,67],[80,84]]},a=e.__addimage__.getImageFileTypeByImageData=function(e,r){var a,i,o,s,c,l=t;if("RGBA"===(r=r||t)||void 0!==e.data&&e.data instanceof Uint8ClampedArray&&"height"in e&&"width"in e)return"RGBA";if(S(e))for(c in n)for(o=n[c],a=0;a<o.length;a+=1){for(s=!0,i=0;i<o[a].length;i+=1)if(void 0!==o[a][i]&&o[a][i]!==e[i]){s=!1;break}if(!0===s){l=c;break}}else for(c in n)for(o=n[c],a=0;a<o.length;a+=1){for(s=!0,i=0;i<o[a].length;i+=1)if(void 0!==o[a][i]&&o[a][i]!==e.charCodeAt(i)){s=!1;break}if(!0===s){l=c;break}}return l===t&&r!==t&&(l=r),l},i=function e(t){for(var n=this.internal.write,r=this.internal.putStream,a=(0,this.internal.getFilters)();-1!==a.indexOf("FlateEncode");)a.splice(a.indexOf("FlateEncode"),1);t.objectId=this.internal.newObject();var i=[];if(i.push({key:"Type",value:"/XObject"}),i.push({key:"Subtype",value:"/Image"}),i.push({key:"Width",value:t.width}),i.push({key:"Height",value:t.height}),t.colorSpace===v.INDEXED?i.push({key:"ColorSpace",value:"[/Indexed /DeviceRGB "+(t.palette.length/3-1)+" "+("sMask"in t&&void 0!==t.sMask?t.objectId+2:t.objectId+1)+" 0 R]"}):(i.push({key:"ColorSpace",value:"/"+t.colorSpace}),t.colorSpace===v.DEVICE_CMYK&&i.push({key:"Decode",value:"[1 0 1 0 1 0 1 0]"})),i.push({key:"BitsPerComponent",value:t.bitsPerComponent}),"decodeParameters"in t&&void 0!==t.decodeParameters&&i.push({key:"DecodeParms",value:"<<"+t.decodeParameters+">>"}),"transparency"in t&&Array.isArray(t.transparency)){for(var o="",s=0,c=t.transparency.length;s<c;s++)o+=t.transparency[s]+" "+t.transparency[s]+" ";i.push({key:"Mask",value:"["+o+"]"})}void 0!==t.sMask&&i.push({key:"SMask",value:t.objectId+1+" 0 R"});var l=void 0!==t.filter?["/"+t.filter]:void 0;if(r({data:t.data,additionalKeyValues:i,alreadyAppliedFilters:l,objectId:t.objectId}),n("endobj"),"sMask"in t&&void 0!==t.sMask){var u="/Predictor "+t.predictor+" /Colors 1 /BitsPerComponent "+t.bitsPerComponent+" /Columns "+t.width,h={width:t.width,height:t.height,colorSpace:"DeviceGray",bitsPerComponent:t.bitsPerComponent,decodeParameters:u,data:t.sMask};"filter"in t&&(h.filter=t.filter),e.call(this,h)}if(t.colorSpace===v.INDEXED){var d=this.internal.newObject();r({data:C(new Uint8Array(t.palette)),objectId:d}),n("endobj")}},o=function(){var e=this.internal.collections.addImage_images;for(var t in e)i.call(this,e[t])},s=function(){var e,t=this.internal.collections.addImage_images,n=this.internal.write;for(var r in t)n("/I"+(e=t[r]).index,e.objectId,"0","R")},c=function(){this.internal.collections.addImage_images||(this.internal.collections.addImage_images={},this.internal.events.subscribe("putResources",o),this.internal.events.subscribe("putXobjectDict",s))},l=function(){var e=this.internal.collections.addImage_images;return c.call(this),e},u=function(){return Object.keys(this.internal.collections.addImage_images).length},h=function(t){return"function"==typeof e["process"+t.toUpperCase()]},d=function(e){return"object"===(0,r.A)(e)&&1===e.nodeType},f=function(t,n){if("IMG"===t.nodeName&&t.hasAttribute("src")){var r=""+t.getAttribute("src");if(0===r.indexOf("data:image/"))return re(unescape(r).split("base64,").pop());var a=e.loadFile(r,!0);if(void 0!==a)return a}if("CANVAS"===t.nodeName){if(0===t.width||0===t.height)throw new Error("Given canvas must have data. Canvas width: "+t.width+", height: "+t.height);var i;switch(n){case"PNG":i="image/png";break;case"WEBP":i="image/webp";break;default:i="image/jpeg"}return re(t.toDataURL(i,1).split("base64,").pop())}},p=function(e){var t=this.internal.collections.addImage_images;if(t)for(var n in t)if(e===t[n].alias)return t[n]},m=function(e,t,n){return e||t||(e=-96,t=-96),e<0&&(e=-1*n.width*72/e/this.internal.scaleFactor),t<0&&(t=-1*n.height*72/t/this.internal.scaleFactor),0===e&&(e=t*n.width/n.height),0===t&&(t=e*n.height/n.width),[e,t]},g=function(e,t,n,r,a,i){var o=m.call(this,n,r,a),s=this.internal.getCoordinateString,c=this.internal.getVerticalCoordinateString,u=l.call(this);if(n=o[0],r=o[1],u[a.index]=a,i){i*=Math.PI/180;var h=Math.cos(i),d=Math.sin(i),f=function(e){return e.toFixed(4)},p=[f(h),f(d),f(-1*d),f(h),0,0,"cm"]}this.internal.write("q"),i?(this.internal.write([1,"0","0",1,s(e),c(t+r),"cm"].join(" ")),this.internal.write(p.join(" ")),this.internal.write([s(n),"0","0",s(r),"0","0","cm"].join(" "))):this.internal.write([s(n),"0","0",s(r),s(e),c(t+r),"cm"].join(" ")),this.isAdvancedAPI()&&this.internal.write([1,0,0,-1,0,0,"cm"].join(" ")),this.internal.write("/I"+a.index+" Do"),this.internal.write("Q")},v=e.color_spaces={DEVICE_RGB:"DeviceRGB",DEVICE_GRAY:"DeviceGray",DEVICE_CMYK:"DeviceCMYK",CAL_GREY:"CalGray",CAL_RGB:"CalRGB",LAB:"Lab",ICC_BASED:"ICCBased",INDEXED:"Indexed",PATTERN:"Pattern",SEPARATION:"Separation",DEVICE_N:"DeviceN"};e.decode={DCT_DECODE:"DCTDecode",FLATE_DECODE:"FlateDecode",LZW_DECODE:"LZWDecode",JPX_DECODE:"JPXDecode",JBIG2_DECODE:"JBIG2Decode",ASCII85_DECODE:"ASCII85Decode",ASCII_HEX_DECODE:"ASCIIHexDecode",RUN_LENGTH_DECODE:"RunLengthDecode",CCITT_FAX_DECODE:"CCITTFaxDecode"};var b=e.image_compression={NONE:"NONE",FAST:"FAST",MEDIUM:"MEDIUM",SLOW:"SLOW"},y=e.__addimage__.sHashCode=function(e){var t,n,r=0;if("string"==typeof e)for(n=e.length,t=0;t<n;t++)r=(r<<5)-r+e.charCodeAt(t),r|=0;else if(S(e))for(n=e.byteLength/2,t=0;t<n;t++)r=(r<<5)-r+e[t],r|=0;return r},x=e.__addimage__.validateStringAsBase64=function(e){(e=e||"").toString().trim();var t=!0;return 0===e.length&&(t=!1),e.length%4!=0&&(t=!1),!1===/^[A-Za-z0-9+/]+$/.test(e.substr(0,e.length-2))&&(t=!1),!1===/^[A-Za-z0-9/][A-Za-z0-9+/]|[A-Za-z0-9+/]=|==$/.test(e.substr(-2))&&(t=!1),t},w=e.__addimage__.extractImageFromDataUrl=function(e){var t=(e=e||"").split("base64,"),n=null;if(2===t.length){var r=/^data:(\w*\/\w*);*(charset=(?!charset=)[\w=-]*)*;*$/.exec(t[0]);Array.isArray(r)&&(n={mimeType:r[1],charset:r[2],data:t[1]})}return n},k=e.__addimage__.supportsArrayBuffer=function(){return"undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array};e.__addimage__.isArrayBuffer=function(e){return k()&&e instanceof ArrayBuffer};var S=e.__addimage__.isArrayBufferView=function(e){return k()&&"undefined"!=typeof Uint32Array&&(e instanceof Int8Array||e instanceof Uint8Array||"undefined"!=typeof Uint8ClampedArray&&e instanceof Uint8ClampedArray||e instanceof Int16Array||e instanceof Uint16Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array||e instanceof Float64Array)},N=e.__addimage__.binaryStringToUint8Array=function(e){for(var t=e.length,n=new Uint8Array(t),r=0;r<t;r++)n[r]=e.charCodeAt(r);return n},C=e.__addimage__.arrayBufferToBinaryString=function(e){for(var t="",n=S(e)?e:new Uint8Array(e),r=0;r<n.length;r+=8192)t+=String.fromCharCode.apply(null,n.subarray(r,r+8192));return t};e.addImage=function(){var e,n,a,i,o,s,l,u,h;if("number"==typeof arguments[1]?(n=t,a=arguments[1],i=arguments[2],o=arguments[3],s=arguments[4],l=arguments[5],u=arguments[6],h=arguments[7]):(n=arguments[1],a=arguments[2],i=arguments[3],o=arguments[4],s=arguments[5],l=arguments[6],u=arguments[7],h=arguments[8]),"object"===(0,r.A)(e=arguments[0])&&!d(e)&&"imageData"in e){var f=e;e=f.imageData,n=f.format||n||t,a=f.x||a||0,i=f.y||i||0,o=f.w||f.width||o,s=f.h||f.height||s,l=f.alias||l,u=f.compression||u,h=f.rotation||f.angle||h}var p=this.internal.getFilters();if(void 0===u&&-1!==p.indexOf("FlateEncode")&&(u="SLOW"),isNaN(a)||isNaN(i))throw new Error("Invalid coordinates passed to jsPDF.addImage");c.call(this);var m=E.call(this,e,n,l,u);return g.call(this,a,i,o,s,m,h),this};var E=function(n,r,i,o){var s,c,l;if("string"==typeof n&&a(n)===t){n=unescape(n);var m=I(n,!1);(""!==m||void 0!==(m=e.loadFile(n,!0)))&&(n=m)}if(d(n)&&(n=f(n,r)),r=a(n,r),!h(r))throw new Error("addImage does not support files of type '"+r+"', please ensure that a plugin for '"+r+"' support is added.");if((null==(l=i)||0===l.length)&&(i=function(e){return"string"==typeof e||S(e)?y(e):S(e.data)?y(e.data):null}(n)),(s=p.call(this,i))||(k()&&(n instanceof Uint8Array||"RGBA"===r||(c=n,n=N(n))),s=this["process"+r.toUpperCase()](n,u.call(this),i,function(t){return t&&"string"==typeof t&&(t=t.toUpperCase()),t in e.image_compression?t:b.NONE}(o),c)),!s)throw new Error("An unknown error occurred whilst processing the image.");return s},I=e.__addimage__.convertBase64ToBinaryString=function(e,t){var n;t="boolean"!=typeof t||t;var r,a="";if("string"==typeof e){r=null!==(n=w(e))?n.data:e;try{a=re(r)}catch(e){if(t)throw x(r)?new Error("atob-Error in jsPDF.convertBase64ToBinaryString "+e.message):new Error("Supplied Data is not a valid base64-String jsPDF.convertBase64ToBinaryString ")}}return a};e.getImageProperties=function(n){var r,i,o="";if(d(n)&&(n=f(n)),"string"==typeof n&&a(n)===t&&(""===(o=I(n,!1))&&(o=e.loadFile(n)||""),n=o),i=a(n),!h(i))throw new Error("addImage does not support files of type '"+i+"', please ensure that a plugin for '"+i+"' support is added.");if(!k()||n instanceof Uint8Array||(n=N(n)),!(r=this["process"+i.toUpperCase()](n)))throw new Error("An unknown error occurred whilst processing the image");return r.fileType=i,r}}(Ae.API),function(e){var t=function(e){if(void 0!==e&&""!=e)return!0};Ae.API.events.push(["addPage",function(e){this.internal.getPageInfo(e.pageNumber).pageContext.annotations=[]}]),e.events.push(["putPage",function(e){for(var n,r,a,i=this.internal.getCoordinateString,o=this.internal.getVerticalCoordinateString,s=this.internal.getPageInfoByObjId(e.objId),c=e.pageContext.annotations,l=!1,u=0;u<c.length&&!l;u++)switch((n=c[u]).type){case"link":(t(n.options.url)||t(n.options.pageNumber))&&(l=!0);break;case"reference":case"text":case"freetext":l=!0}if(0!=l){this.internal.write("/Annots [");for(var h=0;h<c.length;h++){n=c[h];var d=this.internal.pdfEscape,f=this.internal.getEncryptor(e.objId);switch(n.type){case"reference":this.internal.write(" "+n.object.objId+" 0 R ");break;case"text":var p=this.internal.newAdditionalObject(),m=this.internal.newAdditionalObject(),g=this.internal.getEncryptor(p.objId),v=n.title||"Note";a="<</Type /Annot /Subtype /Text "+(r="/Rect ["+i(n.bounds.x)+" "+o(n.bounds.y+n.bounds.h)+" "+i(n.bounds.x+n.bounds.w)+" "+o(n.bounds.y)+"] ")+"/Contents ("+d(g(n.contents))+")",a+=" /Popup "+m.objId+" 0 R",a+=" /P "+s.objId+" 0 R",a+=" /T ("+d(g(v))+") >>",p.content=a;var b=p.objId+" 0 R";a="<</Type /Annot /Subtype /Popup "+(r="/Rect ["+i(n.bounds.x+30)+" "+o(n.bounds.y+n.bounds.h)+" "+i(n.bounds.x+n.bounds.w+30)+" "+o(n.bounds.y)+"] ")+" /Parent "+b,n.open&&(a+=" /Open true"),a+=" >>",m.content=a,this.internal.write(p.objId,"0 R",m.objId,"0 R");break;case"freetext":r="/Rect ["+i(n.bounds.x)+" "+o(n.bounds.y)+" "+i(n.bounds.x+n.bounds.w)+" "+o(n.bounds.y+n.bounds.h)+"] ";var y=n.color||"#000000";a="<</Type /Annot /Subtype /FreeText "+r+"/Contents ("+d(f(n.contents))+")",a+=" /DS(font: Helvetica,sans-serif 12.0pt; text-align:left; color:#"+y+")",a+=" /Border [0 0 0]",a+=" >>",this.internal.write(a);break;case"link":if(n.options.name){var x=this.annotations._nameMap[n.options.name];n.options.pageNumber=x.page,n.options.top=x.y}else n.options.top||(n.options.top=0);if(r="/Rect ["+n.finalBounds.x+" "+n.finalBounds.y+" "+n.finalBounds.w+" "+n.finalBounds.h+"] ",a="",n.options.url)a="<</Type /Annot /Subtype /Link "+r+"/Border [0 0 0] /A <</S /URI /URI ("+d(f(n.options.url))+") >>";else if(n.options.pageNumber)switch(a="<</Type /Annot /Subtype /Link "+r+"/Border [0 0 0] /Dest ["+this.internal.getPageInfo(n.options.pageNumber).objId+" 0 R",n.options.magFactor=n.options.magFactor||"XYZ",n.options.magFactor){case"Fit":a+=" /Fit]";break;case"FitH":a+=" /FitH "+n.options.top+"]";break;case"FitV":n.options.left=n.options.left||0,a+=" /FitV "+n.options.left+"]";break;default:var w=o(n.options.top);n.options.left=n.options.left||0,void 0===n.options.zoom&&(n.options.zoom=0),a+=" /XYZ "+n.options.left+" "+w+" "+n.options.zoom+"]"}""!=a&&(a+=" >>",this.internal.write(a))}}this.internal.write("]")}}]),e.createAnnotation=function(e){var t=this.internal.getCurrentPageInfo();switch(e.type){case"link":this.link(e.bounds.x,e.bounds.y,e.bounds.w,e.bounds.h,e);break;case"text":case"freetext":t.pageContext.annotations.push(e)}},e.link=function(e,t,n,r,a){var i=this.internal.getCurrentPageInfo(),o=this.internal.getCoordinateString,s=this.internal.getVerticalCoordinateString;i.pageContext.annotations.push({finalBounds:{x:o(e),y:s(t),w:o(e+n),h:s(t+r)},options:a,type:"link"})},e.textWithLink=function(e,t,n,r){var a,i,o=this.getTextWidth(e),s=this.internal.getLineHeight()/this.internal.scaleFactor;if(void 0!==r.maxWidth){i=r.maxWidth;var c=this.splitTextToSize(e,i).length;a=Math.ceil(s*c)}else i=o,a=s;return this.text(e,t,n,r),n+=.2*s,"center"===r.align&&(t-=o/2),"right"===r.align&&(t-=o),this.link(t,n-s,i,a,r),o},e.getTextWidth=function(e){var t=this.internal.getFontSize();return this.getStringUnitWidth(e)*t/this.internal.scaleFactor}}(Ae.API),function(e){var t={1569:[65152],1570:[65153,65154],1571:[65155,65156],1572:[65157,65158],1573:[65159,65160],1574:[65161,65162,65163,65164],1575:[65165,65166],1576:[65167,65168,65169,65170],1577:[65171,65172],1578:[65173,65174,65175,65176],1579:[65177,65178,65179,65180],1580:[65181,65182,65183,65184],1581:[65185,65186,65187,65188],1582:[65189,65190,65191,65192],1583:[65193,65194],1584:[65195,65196],1585:[65197,65198],1586:[65199,65200],1587:[65201,65202,65203,65204],1588:[65205,65206,65207,65208],1589:[65209,65210,65211,65212],1590:[65213,65214,65215,65216],1591:[65217,65218,65219,65220],1592:[65221,65222,65223,65224],1593:[65225,65226,65227,65228],1594:[65229,65230,65231,65232],1601:[65233,65234,65235,65236],1602:[65237,65238,65239,65240],1603:[65241,65242,65243,65244],1604:[65245,65246,65247,65248],1605:[65249,65250,65251,65252],1606:[65253,65254,65255,65256],1607:[65257,65258,65259,65260],1608:[65261,65262],1609:[65263,65264,64488,64489],1610:[65265,65266,65267,65268],1649:[64336,64337],1655:[64477],1657:[64358,64359,64360,64361],1658:[64350,64351,64352,64353],1659:[64338,64339,64340,64341],1662:[64342,64343,64344,64345],1663:[64354,64355,64356,64357],1664:[64346,64347,64348,64349],1667:[64374,64375,64376,64377],1668:[64370,64371,64372,64373],1670:[64378,64379,64380,64381],1671:[64382,64383,64384,64385],1672:[64392,64393],1676:[64388,64389],1677:[64386,64387],1678:[64390,64391],1681:[64396,64397],1688:[64394,64395],1700:[64362,64363,64364,64365],1702:[64366,64367,64368,64369],1705:[64398,64399,64400,64401],1709:[64467,64468,64469,64470],1711:[64402,64403,64404,64405],1713:[64410,64411,64412,64413],1715:[64406,64407,64408,64409],1722:[64414,64415],1723:[64416,64417,64418,64419],1726:[64426,64427,64428,64429],1728:[64420,64421],1729:[64422,64423,64424,64425],1733:[64480,64481],1734:[64473,64474],1735:[64471,64472],1736:[64475,64476],1737:[64482,64483],1739:[64478,64479],1740:[64508,64509,64510,64511],1744:[64484,64485,64486,64487],1746:[64430,64431],1747:[64432,64433]},n={65247:{65154:65269,65156:65271,65160:65273,65166:65275},65248:{65154:65270,65156:65272,65160:65274,65166:65276},65165:{65247:{65248:{65258:65010}}},1617:{1612:64606,1613:64607,1614:64608,1615:64609,1616:64610}},r={1612:64606,1613:64607,1614:64608,1615:64609,1616:64610},a=[1570,1571,1573,1575];e.__arabicParser__={};var i=e.__arabicParser__.isInArabicSubstitutionA=function(e){return void 0!==t[e.charCodeAt(0)]},o=e.__arabicParser__.isArabicLetter=function(e){return"string"==typeof e&&/^[\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]+$/.test(e)},s=e.__arabicParser__.isArabicEndLetter=function(e){return o(e)&&i(e)&&t[e.charCodeAt(0)].length<=2},c=e.__arabicParser__.isArabicAlfLetter=function(e){return o(e)&&a.indexOf(e.charCodeAt(0))>=0};e.__arabicParser__.arabicLetterHasIsolatedForm=function(e){return o(e)&&i(e)&&t[e.charCodeAt(0)].length>=1};var l=e.__arabicParser__.arabicLetterHasFinalForm=function(e){return o(e)&&i(e)&&t[e.charCodeAt(0)].length>=2};e.__arabicParser__.arabicLetterHasInitialForm=function(e){return o(e)&&i(e)&&t[e.charCodeAt(0)].length>=3};var u=e.__arabicParser__.arabicLetterHasMedialForm=function(e){return o(e)&&i(e)&&4==t[e.charCodeAt(0)].length},h=e.__arabicParser__.resolveLigatures=function(e){var t=0,r=n,a="",i=0;for(t=0;t<e.length;t+=1)void 0!==r[e.charCodeAt(t)]?(i++,"number"==typeof(r=r[e.charCodeAt(t)])&&(a+=String.fromCharCode(r),r=n,i=0),t===e.length-1&&(r=n,a+=e.charAt(t-(i-1)),t-=i-1,i=0)):(r=n,a+=e.charAt(t-i),t-=i,i=0);return a};e.__arabicParser__.isArabicDiacritic=function(e){return void 0!==e&&void 0!==r[e.charCodeAt(0)]};var d=e.__arabicParser__.getCorrectForm=function(e,t,n){return o(e)?!1===i(e)?-1:!l(e)||!o(t)&&!o(n)||!o(n)&&s(t)||s(e)&&!o(t)||s(e)&&c(t)||s(e)&&s(t)?0:u(e)&&o(t)&&!s(t)&&o(n)&&l(n)?3:s(e)||!o(n)?1:2:-1},f=function(e){var n=0,r=0,a=0,i="",s="",c="",l=(e=e||"").split("\\s+"),u=[];for(n=0;n<l.length;n+=1){for(u.push(""),r=0;r<l[n].length;r+=1)i=l[n][r],s=l[n][r-1],c=l[n][r+1],o(i)?(a=d(i,s,c),u[n]+=-1!==a?String.fromCharCode(t[i.charCodeAt(0)][a]):i):u[n]+=i;u[n]=h(u[n])}return u.join(" ")},p=e.__arabicParser__.processArabic=e.processArabic=function(){var e,t="string"==typeof arguments[0]?arguments[0]:arguments[0].text,n=[];if(Array.isArray(t)){var r=0;for(n=[],r=0;r<t.length;r+=1)Array.isArray(t[r])?n.push([f(t[r][0]),t[r][1],t[r][2]]):n.push([f(t[r])]);e=n}else e=f(t);return"string"==typeof arguments[0]?e:(arguments[0].text=e,arguments[0])};e.events.push(["preProcessText",p])}(Ae.API),Ae.API.autoPrint=function(e){var t;if("javascript"===((e=e||{}).variant=e.variant||"non-conform",e.variant))this.addJS("print({});");else this.internal.events.subscribe("postPutResources",function(){t=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /Named"),this.internal.out("/Type /Action"),this.internal.out("/N /Print"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){this.internal.out("/OpenAction "+t+" 0 R")});return this},function(e){var t=function(){var e=void 0;Object.defineProperty(this,"pdf",{get:function(){return e},set:function(t){e=t}});var t=150;Object.defineProperty(this,"width",{get:function(){return t},set:function(e){t=isNaN(e)||!1===Number.isInteger(e)||e<0?150:e,this.getContext("2d").pageWrapXEnabled&&(this.getContext("2d").pageWrapX=t+1)}});var n=300;Object.defineProperty(this,"height",{get:function(){return n},set:function(e){n=isNaN(e)||!1===Number.isInteger(e)||e<0?300:e,this.getContext("2d").pageWrapYEnabled&&(this.getContext("2d").pageWrapY=n+1)}});var r=[];Object.defineProperty(this,"childNodes",{get:function(){return r},set:function(e){r=e}});var a={};Object.defineProperty(this,"style",{get:function(){return a},set:function(e){a=e}}),Object.defineProperty(this,"parentNode",{})};t.prototype.getContext=function(e,t){var n;if("2d"!==(e=e||"2d"))return null;for(n in t)this.pdf.context2d.hasOwnProperty(n)&&(this.pdf.context2d[n]=t[n]);return this.pdf.context2d._canvas=this,this.pdf.context2d},t.prototype.toDataURL=function(){throw new Error("toDataURL is not implemented.")},e.events.push(["initialized",function(){this.canvas=new t,this.canvas.pdf=this}])}(Ae.API),function(e){var t={left:0,top:0,bottom:0,right:0},n=!1,a=function(){void 0===this.internal.__cell__&&(this.internal.__cell__={},this.internal.__cell__.padding=3,this.internal.__cell__.headerFunction=void 0,this.internal.__cell__.margins=Object.assign({},t),this.internal.__cell__.margins.width=this.getPageWidth(),i.call(this))},i=function(){this.internal.__cell__.lastCell=new o,this.internal.__cell__.pages=1},o=function(){var e=arguments[0];Object.defineProperty(this,"x",{enumerable:!0,get:function(){return e},set:function(t){e=t}});var t=arguments[1];Object.defineProperty(this,"y",{enumerable:!0,get:function(){return t},set:function(e){t=e}});var n=arguments[2];Object.defineProperty(this,"width",{enumerable:!0,get:function(){return n},set:function(e){n=e}});var r=arguments[3];Object.defineProperty(this,"height",{enumerable:!0,get:function(){return r},set:function(e){r=e}});var a=arguments[4];Object.defineProperty(this,"text",{enumerable:!0,get:function(){return a},set:function(e){a=e}});var i=arguments[5];Object.defineProperty(this,"lineNumber",{enumerable:!0,get:function(){return i},set:function(e){i=e}});var o=arguments[6];return Object.defineProperty(this,"align",{enumerable:!0,get:function(){return o},set:function(e){o=e}}),this};o.prototype.clone=function(){return new o(this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align)},o.prototype.toArray=function(){return[this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align]},e.setHeaderFunction=function(e){return a.call(this),this.internal.__cell__.headerFunction="function"==typeof e?e:void 0,this},e.getTextDimensions=function(e,t){a.call(this);var n=(t=t||{}).fontSize||this.getFontSize(),r=t.font||this.getFont(),i=t.scaleFactor||this.internal.scaleFactor,o=0,s=0,c=0,l=this;if(!Array.isArray(e)&&"string"!=typeof e){if("number"!=typeof e)throw new Error("getTextDimensions expects text-parameter to be of type String or type Number or an Array of Strings.");e=String(e)}var u=t.maxWidth;u>0?"string"==typeof e?e=this.splitTextToSize(e,u):"[object Array]"===Object.prototype.toString.call(e)&&(e=e.reduce(function(e,t){return e.concat(l.splitTextToSize(t,u))},[])):e=Array.isArray(e)?e:[e];for(var h=0;h<e.length;h++)o<(c=this.getStringUnitWidth(e[h],{font:r})*n)&&(o=c);return 0!==o&&(s=e.length),{w:o/=i,h:Math.max((s*n*this.getLineHeightFactor()-n*(this.getLineHeightFactor()-1))/i,0)}},e.cellAddPage=function(){a.call(this),this.addPage();var e=this.internal.__cell__.margins||t;return this.internal.__cell__.lastCell=new o(e.left,e.top,void 0,void 0),this.internal.__cell__.pages+=1,this};var s=e.cell=function(){var e;e=arguments[0]instanceof o?arguments[0]:new o(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]),a.call(this);var r=this.internal.__cell__.lastCell,i=this.internal.__cell__.padding,s=this.internal.__cell__.margins||t,c=this.internal.__cell__.tableHeaderRow,l=this.internal.__cell__.printHeaders;return void 0!==r.lineNumber&&(r.lineNumber===e.lineNumber?(e.x=(r.x||0)+(r.width||0),e.y=r.y||0):r.y+r.height+e.height+s.bottom>this.getPageHeight()?(this.cellAddPage(),e.y=s.top,l&&c&&(this.printHeaderRow(e.lineNumber,!0),e.y+=c[0].height)):e.y=r.y+r.height||e.y),void 0!==e.text[0]&&(this.rect(e.x,e.y,e.width,e.height,!0===n?"FD":void 0),"right"===e.align?this.text(e.text,e.x+e.width-i,e.y+i,{align:"right",baseline:"top"}):"center"===e.align?this.text(e.text,e.x+e.width/2,e.y+i,{align:"center",baseline:"top",maxWidth:e.width-i-i}):this.text(e.text,e.x+i,e.y+i,{align:"left",baseline:"top",maxWidth:e.width-i-i})),this.internal.__cell__.lastCell=e,this};e.table=function(e,n,l,u,h){if(a.call(this),!l)throw new Error("No data for PDF table.");var d,f,p,m,g=[],v=[],b=[],y={},x={},w=[],k=[],S=(h=h||{}).autoSize||!1,N=!1!==h.printHeaders,C=h.css&&void 0!==h.css["font-size"]?16*h.css["font-size"]:h.fontSize||12,E=h.margins||Object.assign({width:this.getPageWidth()},t),I="number"==typeof h.padding?h.padding:3,T=h.headerBackgroundColor||"#c8c8c8",_=h.headerTextColor||"#000";if(i.call(this),this.internal.__cell__.printHeaders=N,this.internal.__cell__.margins=E,this.internal.__cell__.table_font_size=C,this.internal.__cell__.padding=I,this.internal.__cell__.headerBackgroundColor=T,this.internal.__cell__.headerTextColor=_,this.setFontSize(C),null==u)v=g=Object.keys(l[0]),b=g.map(function(){return"left"});else if(Array.isArray(u)&&"object"===(0,r.A)(u[0]))for(g=u.map(function(e){return e.name}),v=u.map(function(e){return e.prompt||e.name||""}),b=u.map(function(e){return e.align||"left"}),d=0;d<u.length;d+=1)x[u[d].name]=u[d].width*(19.049976/25.4);else Array.isArray(u)&&"string"==typeof u[0]&&(v=g=u,b=g.map(function(){return"left"}));if(S||Array.isArray(u)&&"string"==typeof u[0])for(d=0;d<g.length;d+=1){for(y[m=g[d]]=l.map(function(e){return e[m]}),this.setFont(void 0,"bold"),w.push(this.getTextDimensions(v[d],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w),f=y[m],this.setFont(void 0,"normal"),p=0;p<f.length;p+=1)w.push(this.getTextDimensions(f[p],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w);x[m]=Math.max.apply(null,w)+I+I,w=[]}if(N){var A={};for(d=0;d<g.length;d+=1)A[g[d]]={},A[g[d]].text=v[d],A[g[d]].align=b[d];var R=c.call(this,A,x);k=g.map(function(t){return new o(e,n,x[t],R,A[t].text,void 0,A[t].align)}),this.setTableHeaderRow(k),this.printHeaderRow(1,!1)}var F=u.reduce(function(e,t){return e[t.name]=t.align,e},{});for(d=0;d<l.length;d+=1){"rowStart"in h&&h.rowStart instanceof Function&&h.rowStart({row:d,data:l[d]},this);var D=c.call(this,l[d],x);for(p=0;p<g.length;p+=1){var O=l[d][g[p]];"cellStart"in h&&h.cellStart instanceof Function&&h.cellStart({row:d,col:p,data:O},this),s.call(this,new o(e,n,x[g[p]],D,O,d+2,F[g[p]]))}}return this.internal.__cell__.table_x=e,this.internal.__cell__.table_y=n,this};var c=function(e,t){var n=this.internal.__cell__.padding,r=this.internal.__cell__.table_font_size,a=this.internal.scaleFactor;return Object.keys(e).map(function(r){var a=e[r];return this.splitTextToSize(a.hasOwnProperty("text")?a.text:a,t[r]-n-n)},this).map(function(e){return this.getLineHeightFactor()*e.length*r/a+n+n},this).reduce(function(e,t){return Math.max(e,t)},0)};e.setTableHeaderRow=function(e){a.call(this),this.internal.__cell__.tableHeaderRow=e},e.printHeaderRow=function(e,t){if(a.call(this),!this.internal.__cell__.tableHeaderRow)throw new Error("Property tableHeaderRow does not exist.");var r;if(n=!0,"function"==typeof this.internal.__cell__.headerFunction){var i=this.internal.__cell__.headerFunction(this,this.internal.__cell__.pages);this.internal.__cell__.lastCell=new o(i[0],i[1],i[2],i[3],void 0,-1)}this.setFont(void 0,"bold");for(var c=[],l=0;l<this.internal.__cell__.tableHeaderRow.length;l+=1){r=this.internal.__cell__.tableHeaderRow[l].clone(),t&&(r.y=this.internal.__cell__.margins.top||0,c.push(r)),r.lineNumber=e;var u=this.getTextColor();this.setTextColor(this.internal.__cell__.headerTextColor),this.setFillColor(this.internal.__cell__.headerBackgroundColor),s.call(this,r),this.setTextColor(u)}c.length>0&&this.setTableHeaderRow(c),this.setFont(void 0,"normal"),n=!1}}(Ae.API);var xt={italic:["italic","oblique","normal"],oblique:["oblique","italic","normal"],normal:["normal","oblique","italic"]},wt=["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded"],kt=yt(wt),St=[100,200,300,400,500,600,700,800,900],Nt=yt(St);function Ct(e){var t=e.family.replace(/"|'/g,"").toLowerCase(),n=function(e){return xt[e=e||"normal"]?e:"normal"}(e.style),r=function(e){return e?"number"==typeof e?e>=100&&e<=900&&e%100==0?e:400:/^\d00$/.test(e)?parseInt(e):"bold"===e?700:400:400}(e.weight),a=function(e){return"number"==typeof kt[e=e||"normal"]?e:"normal"}(e.stretch);return{family:t,style:n,weight:r,stretch:a,src:e.src||[],ref:e.ref||{name:t,style:[a,n,r].join(" ")}}}function Et(e,t,n,r){var a;for(a=n;a>=0&&a<t.length;a+=r)if(e[t[a]])return e[t[a]];for(a=n;a>=0&&a<t.length;a-=r)if(e[t[a]])return e[t[a]]}var It={"sans-serif":"helvetica",fixed:"courier",monospace:"courier",terminal:"courier",cursive:"times",fantasy:"times",serif:"times"},Tt={caption:"times",icon:"times",menu:"times","message-box":"times","small-caption":"times","status-bar":"times"};function _t(e){return[e.stretch,e.style,e.weight,e.family].join(" ")}function At(e){return e.trimLeft()}function Rt(e,t){for(var n=0;n<e.length;){if(e.charAt(n)===t)return[e.substring(0,n),e.substring(n+1)];n+=1}return null}function Ft(e){var t=e.match(/^(-[a-z_]|[a-z_])[a-z0-9_-]*/i);return null===t?null:[t[0],e.substring(t[0].length)]}var Dt,Ot,Lt,Pt,Mt=["times"];!function(e){var t,n,a,i,o,s,c,l,u,h=function(e){return e=e||{},this.isStrokeTransparent=e.isStrokeTransparent||!1,this.strokeOpacity=e.strokeOpacity||1,this.strokeStyle=e.strokeStyle||"#000000",this.fillStyle=e.fillStyle||"#000000",this.isFillTransparent=e.isFillTransparent||!1,this.fillOpacity=e.fillOpacity||1,this.font=e.font||"10px sans-serif",this.textBaseline=e.textBaseline||"alphabetic",this.textAlign=e.textAlign||"left",this.lineWidth=e.lineWidth||1,this.lineJoin=e.lineJoin||"miter",this.lineCap=e.lineCap||"butt",this.path=e.path||[],this.transform=void 0!==e.transform?e.transform.clone():new l,this.globalCompositeOperation=e.globalCompositeOperation||"normal",this.globalAlpha=e.globalAlpha||1,this.clip_path=e.clip_path||[],this.currentPoint=e.currentPoint||new s,this.miterLimit=e.miterLimit||10,this.lastPoint=e.lastPoint||new s,this.lineDashOffset=e.lineDashOffset||0,this.lineDash=e.lineDash||[],this.margin=e.margin||[0,0,0,0],this.prevPageLastElemOffset=e.prevPageLastElemOffset||0,this.ignoreClearRect="boolean"!=typeof e.ignoreClearRect||e.ignoreClearRect,this};e.events.push(["initialized",function(){this.context2d=new d(this),t=this.internal.f2,n=this.internal.getCoordinateString,a=this.internal.getVerticalCoordinateString,i=this.internal.getHorizontalCoordinate,o=this.internal.getVerticalCoordinate,s=this.internal.Point,c=this.internal.Rectangle,l=this.internal.Matrix,u=new h}]);var d=function(e){Object.defineProperty(this,"canvas",{get:function(){return{parentNode:!1,style:!1}}});var t=e;Object.defineProperty(this,"pdf",{get:function(){return t}});var n=!1;Object.defineProperty(this,"pageWrapXEnabled",{get:function(){return n},set:function(e){n=Boolean(e)}});var r=!1;Object.defineProperty(this,"pageWrapYEnabled",{get:function(){return r},set:function(e){r=Boolean(e)}});var a=0;Object.defineProperty(this,"posX",{get:function(){return a},set:function(e){isNaN(e)||(a=e)}});var i=0;Object.defineProperty(this,"posY",{get:function(){return i},set:function(e){isNaN(e)||(i=e)}}),Object.defineProperty(this,"margin",{get:function(){return u.margin},set:function(e){var t;"number"==typeof e?t=[e,e,e,e]:((t=new Array(4))[0]=e[0],t[1]=e.length>=2?e[1]:t[0],t[2]=e.length>=3?e[2]:t[0],t[3]=e.length>=4?e[3]:t[1]),u.margin=t}});var o=!1;Object.defineProperty(this,"autoPaging",{get:function(){return o},set:function(e){o=e}});var s=0;Object.defineProperty(this,"lastBreak",{get:function(){return s},set:function(e){s=e}});var c=[];Object.defineProperty(this,"pageBreaks",{get:function(){return c},set:function(e){c=e}}),Object.defineProperty(this,"ctx",{get:function(){return u},set:function(e){e instanceof h&&(u=e)}}),Object.defineProperty(this,"path",{get:function(){return u.path},set:function(e){u.path=e}});var l=[];Object.defineProperty(this,"ctxStack",{get:function(){return l},set:function(e){l=e}}),Object.defineProperty(this,"fillStyle",{get:function(){return this.ctx.fillStyle},set:function(e){var t;t=f(e),this.ctx.fillStyle=t.style,this.ctx.isFillTransparent=0===t.a,this.ctx.fillOpacity=t.a,this.pdf.setFillColor(t.r,t.g,t.b,{a:t.a}),this.pdf.setTextColor(t.r,t.g,t.b,{a:t.a})}}),Object.defineProperty(this,"strokeStyle",{get:function(){return this.ctx.strokeStyle},set:function(e){var t=f(e);this.ctx.strokeStyle=t.style,this.ctx.isStrokeTransparent=0===t.a,this.ctx.strokeOpacity=t.a,0===t.a?this.pdf.setDrawColor(255,255,255):(t.a,this.pdf.setDrawColor(t.r,t.g,t.b))}}),Object.defineProperty(this,"lineCap",{get:function(){return this.ctx.lineCap},set:function(e){-1!==["butt","round","square"].indexOf(e)&&(this.ctx.lineCap=e,this.pdf.setLineCap(e))}}),Object.defineProperty(this,"lineWidth",{get:function(){return this.ctx.lineWidth},set:function(e){isNaN(e)||(this.ctx.lineWidth=e,this.pdf.setLineWidth(e))}}),Object.defineProperty(this,"lineJoin",{get:function(){return this.ctx.lineJoin},set:function(e){-1!==["bevel","round","miter"].indexOf(e)&&(this.ctx.lineJoin=e,this.pdf.setLineJoin(e))}}),Object.defineProperty(this,"miterLimit",{get:function(){return this.ctx.miterLimit},set:function(e){isNaN(e)||(this.ctx.miterLimit=e,this.pdf.setMiterLimit(e))}}),Object.defineProperty(this,"textBaseline",{get:function(){return this.ctx.textBaseline},set:function(e){this.ctx.textBaseline=e}}),Object.defineProperty(this,"textAlign",{get:function(){return this.ctx.textAlign},set:function(e){-1!==["right","end","center","left","start"].indexOf(e)&&(this.ctx.textAlign=e)}});var d=null;function p(e,t){if(null===d){var n=function(e){var t=[];return Object.keys(e).forEach(function(n){e[n].forEach(function(e){var r=null;switch(e){case"bold":r={family:n,weight:"bold"};break;case"italic":r={family:n,style:"italic"};break;case"bolditalic":r={family:n,weight:"bold",style:"italic"};break;case"":case"normal":r={family:n}}null!==r&&(r.ref={name:n,style:e},t.push(r))})}),t}(e.getFontList());d=function(e){for(var t={},n=0;n<e.length;++n){var r=Ct(e[n]),a=r.family,i=r.stretch,o=r.style,s=r.weight;t[a]=t[a]||{},t[a][i]=t[a][i]||{},t[a][i][o]=t[a][i][o]||{},t[a][i][o][s]=r}return t}(n.concat(t))}return d}var m=null;Object.defineProperty(this,"fontFaces",{get:function(){return m},set:function(e){d=null,m=e}}),Object.defineProperty(this,"font",{get:function(){return this.ctx.font},set:function(e){var t;if(this.ctx.font=e,null!==(t=/^\s*(?=(?:(?:[-a-z]+\s*){0,2}(italic|oblique))?)(?=(?:(?:[-a-z]+\s*){0,2}(small-caps))?)(?=(?:(?:[-a-z]+\s*){0,2}(bold(?:er)?|lighter|[1-9]00))?)(?:(?:normal|\1|\2|\3)\s*){0,3}((?:xx?-)?(?:small|large)|medium|smaller|larger|[.\d]+(?:\%|in|[cem]m|ex|p[ctx]))(?:\s*\/\s*(normal|[.\d]+(?:\%|in|[cem]m|ex|p[ctx])))?\s*([-_,\"\'\sa-z]+?)\s*$/i.exec(e))){var n=t[1],r=(t[2],t[3]),a=t[4],i=(t[5],t[6]),o=/^([.\d]+)((?:%|in|[cem]m|ex|p[ctx]))$/i.exec(a)[2];a="px"===o?Math.floor(parseFloat(a)*this.pdf.internal.scaleFactor):"em"===o?Math.floor(parseFloat(a)*this.pdf.getFontSize()):Math.floor(parseFloat(a)*this.pdf.internal.scaleFactor),this.pdf.setFontSize(a);var s=function(e){var t,n,r=[],a=e.trim();if(""===a)return Mt;if(a in Tt)return[Tt[a]];for(;""!==a;){switch(n=null,t=(a=At(a)).charAt(0)){case'"':case"'":n=Rt(a.substring(1),t);break;default:n=Ft(a)}if(null===n)return Mt;if(r.push(n[0]),""!==(a=At(n[1]))&&","!==a.charAt(0))return Mt;a=a.replace(/^,/,"")}return r}(i);if(this.fontFaces){var c=function(e,t,n){for(var r=(n=n||{}).defaultFontFamily||"times",a=Object.assign({},It,n.genericFontFamilies||{}),i=null,o=null,s=0;s<t.length;++s)if(a[(i=Ct(t[s])).family]&&(i.family=a[i.family]),e.hasOwnProperty(i.family)){o=e[i.family];break}if(!(o=o||e[r]))throw new Error("Could not find a font-family for the rule '"+_t(i)+"' and default family '"+r+"'.");if(o=function(e,t){if(t[e])return t[e];var n=kt[e],r=n<=kt.normal?-1:1,a=Et(t,wt,n,r);if(!a)throw new Error("Could not find a matching font-stretch value for "+e);return a}(i.stretch,o),o=function(e,t){if(t[e])return t[e];for(var n=xt[e],r=0;r<n.length;++r)if(t[n[r]])return t[n[r]];throw new Error("Could not find a matching font-style for "+e)}(i.style,o),!(o=function(e,t){if(t[e])return t[e];if(400===e&&t[500])return t[500];if(500===e&&t[400])return t[400];var n=Nt[e],r=Et(t,St,n,e<400?-1:1);if(!r)throw new Error("Could not find a matching font-weight for value "+e);return r}(i.weight,o)))throw new Error("Failed to resolve a font for the rule '"+_t(i)+"'.");return o}(p(this.pdf,this.fontFaces),s.map(function(e){return{family:e,stretch:"normal",weight:r,style:n}}));this.pdf.setFont(c.ref.name,c.ref.style)}else{var l="";("bold"===r||parseInt(r,10)>=700||"bold"===n)&&(l="bold"),"italic"===n&&(l+="italic"),0===l.length&&(l="normal");for(var u="",h={arial:"Helvetica",Arial:"Helvetica",verdana:"Helvetica",Verdana:"Helvetica",helvetica:"Helvetica",Helvetica:"Helvetica","sans-serif":"Helvetica",fixed:"Courier",monospace:"Courier",terminal:"Courier",cursive:"Times",fantasy:"Times",serif:"Times"},d=0;d<s.length;d++){if(void 0!==this.pdf.internal.getFont(s[d],l,{noFallback:!0,disableWarning:!0})){u=s[d];break}if("bolditalic"===l&&void 0!==this.pdf.internal.getFont(s[d],"bold",{noFallback:!0,disableWarning:!0}))u=s[d],l="bold";else if(void 0!==this.pdf.internal.getFont(s[d],"normal",{noFallback:!0,disableWarning:!0})){u=s[d],l="normal";break}}if(""===u)for(var f=0;f<s.length;f++)if(h[s[f]]){u=h[s[f]];break}u=""===u?"Times":u,this.pdf.setFont(u,l)}}}}),Object.defineProperty(this,"globalCompositeOperation",{get:function(){return this.ctx.globalCompositeOperation},set:function(e){this.ctx.globalCompositeOperation=e}}),Object.defineProperty(this,"globalAlpha",{get:function(){return this.ctx.globalAlpha},set:function(e){this.ctx.globalAlpha=e}}),Object.defineProperty(this,"lineDashOffset",{get:function(){return this.ctx.lineDashOffset},set:function(e){this.ctx.lineDashOffset=e,j.call(this)}}),Object.defineProperty(this,"lineDash",{get:function(){return this.ctx.lineDash},set:function(e){this.ctx.lineDash=e,j.call(this)}}),Object.defineProperty(this,"ignoreClearRect",{get:function(){return this.ctx.ignoreClearRect},set:function(e){this.ctx.ignoreClearRect=Boolean(e)}})};d.prototype.setLineDash=function(e){this.lineDash=e},d.prototype.getLineDash=function(){return this.lineDash.length%2?this.lineDash.concat(this.lineDash):this.lineDash.slice()},d.prototype.fill=function(){w.call(this,"fill",!1)},d.prototype.stroke=function(){w.call(this,"stroke",!1)},d.prototype.beginPath=function(){this.path=[{type:"begin"}]},d.prototype.moveTo=function(e,t){if(isNaN(e)||isNaN(t))throw Z.error("jsPDF.context2d.moveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.moveTo");var n=this.ctx.transform.applyToPoint(new s(e,t));this.path.push({type:"mt",x:n.x,y:n.y}),this.ctx.lastPoint=new s(e,t)},d.prototype.closePath=function(){var e=new s(0,0),t=0;for(t=this.path.length-1;-1!==t;t--)if("begin"===this.path[t].type&&"object"===(0,r.A)(this.path[t+1])&&"number"==typeof this.path[t+1].x){e=new s(this.path[t+1].x,this.path[t+1].y);break}this.path.push({type:"close"}),this.ctx.lastPoint=new s(e.x,e.y)},d.prototype.lineTo=function(e,t){if(isNaN(e)||isNaN(t))throw Z.error("jsPDF.context2d.lineTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.lineTo");var n=this.ctx.transform.applyToPoint(new s(e,t));this.path.push({type:"lt",x:n.x,y:n.y}),this.ctx.lastPoint=new s(n.x,n.y)},d.prototype.clip=function(){this.ctx.clip_path=JSON.parse(JSON.stringify(this.path)),w.call(this,null,!0)},d.prototype.quadraticCurveTo=function(e,t,n,r){if(isNaN(n)||isNaN(r)||isNaN(e)||isNaN(t))throw Z.error("jsPDF.context2d.quadraticCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.quadraticCurveTo");var a=this.ctx.transform.applyToPoint(new s(n,r)),i=this.ctx.transform.applyToPoint(new s(e,t));this.path.push({type:"qct",x1:i.x,y1:i.y,x:a.x,y:a.y}),this.ctx.lastPoint=new s(a.x,a.y)},d.prototype.bezierCurveTo=function(e,t,n,r,a,i){if(isNaN(a)||isNaN(i)||isNaN(e)||isNaN(t)||isNaN(n)||isNaN(r))throw Z.error("jsPDF.context2d.bezierCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.bezierCurveTo");var o=this.ctx.transform.applyToPoint(new s(a,i)),c=this.ctx.transform.applyToPoint(new s(e,t)),l=this.ctx.transform.applyToPoint(new s(n,r));this.path.push({type:"bct",x1:c.x,y1:c.y,x2:l.x,y2:l.y,x:o.x,y:o.y}),this.ctx.lastPoint=new s(o.x,o.y)},d.prototype.arc=function(e,t,n,r,a,i){if(isNaN(e)||isNaN(t)||isNaN(n)||isNaN(r)||isNaN(a))throw Z.error("jsPDF.context2d.arc: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.arc");if(i=Boolean(i),!this.ctx.transform.isIdentity){var o=this.ctx.transform.applyToPoint(new s(e,t));e=o.x,t=o.y;var c=this.ctx.transform.applyToPoint(new s(0,n)),l=this.ctx.transform.applyToPoint(new s(0,0));n=Math.sqrt(Math.pow(c.x-l.x,2)+Math.pow(c.y-l.y,2))}Math.abs(a-r)>=2*Math.PI&&(r=0,a=2*Math.PI),this.path.push({type:"arc",x:e,y:t,radius:n,startAngle:r,endAngle:a,counterclockwise:i})},d.prototype.arcTo=function(e,t,n,r,a){throw new Error("arcTo not implemented.")},d.prototype.rect=function(e,t,n,r){if(isNaN(e)||isNaN(t)||isNaN(n)||isNaN(r))throw Z.error("jsPDF.context2d.rect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rect");this.moveTo(e,t),this.lineTo(e+n,t),this.lineTo(e+n,t+r),this.lineTo(e,t+r),this.lineTo(e,t),this.lineTo(e+n,t),this.lineTo(e,t)},d.prototype.fillRect=function(e,t,n,r){if(isNaN(e)||isNaN(t)||isNaN(n)||isNaN(r))throw Z.error("jsPDF.context2d.fillRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillRect");if(!p.call(this)){var a={};"butt"!==this.lineCap&&(a.lineCap=this.lineCap,this.lineCap="butt"),"miter"!==this.lineJoin&&(a.lineJoin=this.lineJoin,this.lineJoin="miter"),this.beginPath(),this.rect(e,t,n,r),this.fill(),a.hasOwnProperty("lineCap")&&(this.lineCap=a.lineCap),a.hasOwnProperty("lineJoin")&&(this.lineJoin=a.lineJoin)}},d.prototype.strokeRect=function(e,t,n,r){if(isNaN(e)||isNaN(t)||isNaN(n)||isNaN(r))throw Z.error("jsPDF.context2d.strokeRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeRect");m.call(this)||(this.beginPath(),this.rect(e,t,n,r),this.stroke())},d.prototype.clearRect=function(e,t,n,r){if(isNaN(e)||isNaN(t)||isNaN(n)||isNaN(r))throw Z.error("jsPDF.context2d.clearRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.clearRect");this.ignoreClearRect||(this.fillStyle="#ffffff",this.fillRect(e,t,n,r))},d.prototype.save=function(e){e="boolean"!=typeof e||e;for(var t=this.pdf.internal.getCurrentPageInfo().pageNumber,n=0;n<this.pdf.internal.getNumberOfPages();n++)this.pdf.setPage(n+1),this.pdf.internal.out("q");if(this.pdf.setPage(t),e){this.ctx.fontSize=this.pdf.internal.getFontSize();var r=new h(this.ctx);this.ctxStack.push(this.ctx),this.ctx=r}},d.prototype.restore=function(e){e="boolean"!=typeof e||e;for(var t=this.pdf.internal.getCurrentPageInfo().pageNumber,n=0;n<this.pdf.internal.getNumberOfPages();n++)this.pdf.setPage(n+1),this.pdf.internal.out("Q");this.pdf.setPage(t),e&&0!==this.ctxStack.length&&(this.ctx=this.ctxStack.pop(),this.fillStyle=this.ctx.fillStyle,this.strokeStyle=this.ctx.strokeStyle,this.font=this.ctx.font,this.lineCap=this.ctx.lineCap,this.lineWidth=this.ctx.lineWidth,this.lineJoin=this.ctx.lineJoin,this.lineDash=this.ctx.lineDash,this.lineDashOffset=this.ctx.lineDashOffset)},d.prototype.toDataURL=function(){throw new Error("toDataUrl not implemented.")};var f=function(e){var t,n,r,a;if(!0===e.isCanvasGradient&&(e=e.getColor()),!e)return{r:0,g:0,b:0,a:0,style:e};if(/transparent|rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*0+\s*\)/.test(e))t=0,n=0,r=0,a=0;else{var i=/rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/.exec(e);if(null!==i)t=parseInt(i[1]),n=parseInt(i[2]),r=parseInt(i[3]),a=1;else if(null!==(i=/rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*([\d.]+)\s*\)/.exec(e)))t=parseInt(i[1]),n=parseInt(i[2]),r=parseInt(i[3]),a=parseFloat(i[4]);else{if(a=1,"string"==typeof e&&"#"!==e.charAt(0)){var o=new oe(e);e=o.ok?o.toHex():"#000000"}4===e.length?(t=e.substring(1,2),t+=t,n=e.substring(2,3),n+=n,r=e.substring(3,4),r+=r):(t=e.substring(1,3),n=e.substring(3,5),r=e.substring(5,7)),t=parseInt(t,16),n=parseInt(n,16),r=parseInt(r,16)}}return{r:t,g:n,b:r,a:a,style:e}},p=function(){return this.ctx.isFillTransparent||0==this.globalAlpha},m=function(){return Boolean(this.ctx.isStrokeTransparent||0==this.globalAlpha)};d.prototype.fillText=function(e,t,n,r){if(isNaN(t)||isNaN(n)||"string"!=typeof e)throw Z.error("jsPDF.context2d.fillText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillText");if(r=isNaN(r)?void 0:r,!p.call(this)){var a=L(this.ctx.transform.rotation),i=this.ctx.transform.scaleX;_.call(this,{text:e,x:t,y:n,scale:i,angle:a,align:this.textAlign,maxWidth:r})}},d.prototype.strokeText=function(e,t,n,r){if(isNaN(t)||isNaN(n)||"string"!=typeof e)throw Z.error("jsPDF.context2d.strokeText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeText");if(!m.call(this)){r=isNaN(r)?void 0:r;var a=L(this.ctx.transform.rotation),i=this.ctx.transform.scaleX;_.call(this,{text:e,x:t,y:n,scale:i,renderingMode:"stroke",angle:a,align:this.textAlign,maxWidth:r})}},d.prototype.measureText=function(e){if("string"!=typeof e)throw Z.error("jsPDF.context2d.measureText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.measureText");var t=this.pdf,n=this.pdf.internal.scaleFactor,r=t.internal.getFontSize(),a=t.getStringUnitWidth(e)*r/t.internal.scaleFactor;return new function(e){var t=(e=e||{}).width||0;return Object.defineProperty(this,"width",{get:function(){return t}}),this}({width:a*=Math.round(96*n/72*1e4)/1e4})},d.prototype.scale=function(e,t){if(isNaN(e)||isNaN(t))throw Z.error("jsPDF.context2d.scale: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.scale");var n=new l(e,0,0,t,0,0);this.ctx.transform=this.ctx.transform.multiply(n)},d.prototype.rotate=function(e){if(isNaN(e))throw Z.error("jsPDF.context2d.rotate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rotate");var t=new l(Math.cos(e),Math.sin(e),-Math.sin(e),Math.cos(e),0,0);this.ctx.transform=this.ctx.transform.multiply(t)},d.prototype.translate=function(e,t){if(isNaN(e)||isNaN(t))throw Z.error("jsPDF.context2d.translate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.translate");var n=new l(1,0,0,1,e,t);this.ctx.transform=this.ctx.transform.multiply(n)},d.prototype.transform=function(e,t,n,r,a,i){if(isNaN(e)||isNaN(t)||isNaN(n)||isNaN(r)||isNaN(a)||isNaN(i))throw Z.error("jsPDF.context2d.transform: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.transform");var o=new l(e,t,n,r,a,i);this.ctx.transform=this.ctx.transform.multiply(o)},d.prototype.setTransform=function(e,t,n,r,a,i){e=isNaN(e)?1:e,t=isNaN(t)?0:t,n=isNaN(n)?0:n,r=isNaN(r)?1:r,a=isNaN(a)?0:a,i=isNaN(i)?0:i,this.ctx.transform=new l(e,t,n,r,a,i)};var g=function(){return this.margin[0]>0||this.margin[1]>0||this.margin[2]>0||this.margin[3]>0};d.prototype.drawImage=function(e,t,n,r,a,i,o,s,u){var h=this.pdf.getImageProperties(e),d=1,f=1,p=1,m=1;void 0!==r&&void 0!==s&&(p=s/r,m=u/a,d=h.width/r*s/r,f=h.height/a*u/a),void 0===i&&(i=t,o=n,t=0,n=0),void 0!==r&&void 0===s&&(s=r,u=a),void 0===r&&void 0===s&&(s=h.width,u=h.height);for(var b,w=this.ctx.transform.decompose(),S=L(w.rotate.shx),N=new l,C=(N=(N=(N=N.multiply(w.translate)).multiply(w.skew)).multiply(w.scale)).applyToRectangle(new c(i-t*p,o-n*m,r*d,a*f)),E=v.call(this,C),I=[],T=0;T<E.length;T+=1)-1===I.indexOf(E[T])&&I.push(E[T]);if(x(I),this.autoPaging)for(var _=I[0],A=I[I.length-1],R=_;R<A+1;R++){this.pdf.setPage(R);var F=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],D=1===R?this.posY+this.margin[0]:this.margin[0],O=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],P=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],M=1===R?0:O+(R-2)*P;if(0!==this.ctx.clip_path.length){var j=this.path;b=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=y(b,this.posX+this.margin[3],-M+D+this.ctx.prevPageLastElemOffset),k.call(this,"fill",!0),this.path=j}var B=JSON.parse(JSON.stringify(C));B=y([B],this.posX+this.margin[3],-M+D+this.ctx.prevPageLastElemOffset)[0];var z=(R>_||R<A)&&g.call(this);z&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],F,P,null).clip().discardPath()),this.pdf.addImage(e,"JPEG",B.x,B.y,B.w,B.h,null,null,S),z&&this.pdf.restoreGraphicsState()}else this.pdf.addImage(e,"JPEG",C.x,C.y,C.w,C.h,null,null,S)};var v=function(e,t,n){var r=[];t=t||this.pdf.internal.pageSize.width,n=n||this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2];var a=this.posY+this.ctx.prevPageLastElemOffset;switch(e.type){default:case"mt":case"lt":r.push(Math.floor((e.y+a)/n)+1);break;case"arc":r.push(Math.floor((e.y+a-e.radius)/n)+1),r.push(Math.floor((e.y+a+e.radius)/n)+1);break;case"qct":var i=P(this.ctx.lastPoint.x,this.ctx.lastPoint.y,e.x1,e.y1,e.x,e.y);r.push(Math.floor((i.y+a)/n)+1),r.push(Math.floor((i.y+i.h+a)/n)+1);break;case"bct":var o=M(this.ctx.lastPoint.x,this.ctx.lastPoint.y,e.x1,e.y1,e.x2,e.y2,e.x,e.y);r.push(Math.floor((o.y+a)/n)+1),r.push(Math.floor((o.y+o.h+a)/n)+1);break;case"rect":r.push(Math.floor((e.y+a)/n)+1),r.push(Math.floor((e.y+e.h+a)/n)+1)}for(var s=0;s<r.length;s+=1)for(;this.pdf.internal.getNumberOfPages()<r[s];)b.call(this);return r},b=function(){var e=this.fillStyle,t=this.strokeStyle,n=this.font,r=this.lineCap,a=this.lineWidth,i=this.lineJoin;this.pdf.addPage(),this.fillStyle=e,this.strokeStyle=t,this.font=n,this.lineCap=r,this.lineWidth=a,this.lineJoin=i},y=function(e,t,n){for(var r=0;r<e.length;r++)switch(e[r].type){case"bct":e[r].x2+=t,e[r].y2+=n;case"qct":e[r].x1+=t,e[r].y1+=n;default:e[r].x+=t,e[r].y+=n}return e},x=function(e){return e.sort(function(e,t){return e-t})},w=function(e,t){for(var n,r,a=this.fillStyle,i=this.strokeStyle,o=this.lineCap,s=this.lineWidth,c=Math.abs(s*this.ctx.transform.scaleX),l=this.lineJoin,u=JSON.parse(JSON.stringify(this.path)),h=JSON.parse(JSON.stringify(this.path)),d=[],f=0;f<h.length;f++)if(void 0!==h[f].x)for(var p=v.call(this,h[f]),m=0;m<p.length;m+=1)-1===d.indexOf(p[m])&&d.push(p[m]);for(var w=0;w<d.length;w++)for(;this.pdf.internal.getNumberOfPages()<d[w];)b.call(this);if(x(d),this.autoPaging)for(var S=d[0],N=d[d.length-1],C=S;C<N+1;C++){this.pdf.setPage(C),this.fillStyle=a,this.strokeStyle=i,this.lineCap=o,this.lineWidth=c,this.lineJoin=l;var E=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],I=1===C?this.posY+this.margin[0]:this.margin[0],T=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],_=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],A=1===C?0:T+(C-2)*_;if(0!==this.ctx.clip_path.length){var R=this.path;n=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=y(n,this.posX+this.margin[3],-A+I+this.ctx.prevPageLastElemOffset),k.call(this,e,!0),this.path=R}if(r=JSON.parse(JSON.stringify(u)),this.path=y(r,this.posX+this.margin[3],-A+I+this.ctx.prevPageLastElemOffset),!1===t||0===C){var F=(C>S||C<N)&&g.call(this);F&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],E,_,null).clip().discardPath()),k.call(this,e,t),F&&this.pdf.restoreGraphicsState()}this.lineWidth=s}else this.lineWidth=c,k.call(this,e,t),this.lineWidth=s;this.path=u},k=function(e,t){if(("stroke"!==e||t||!m.call(this))&&("stroke"===e||t||!p.call(this))){for(var n,r,a=[],i=this.path,o=0;o<i.length;o++){var s=i[o];switch(s.type){case"begin":a.push({begin:!0});break;case"close":a.push({close:!0});break;case"mt":a.push({start:s,deltas:[],abs:[]});break;case"lt":var c=a.length;if(i[o-1]&&!isNaN(i[o-1].x)&&(n=[s.x-i[o-1].x,s.y-i[o-1].y],c>0))for(;c>=0;c--)if(!0!==a[c-1].close&&!0!==a[c-1].begin){a[c-1].deltas.push(n),a[c-1].abs.push(s);break}break;case"bct":n=[s.x1-i[o-1].x,s.y1-i[o-1].y,s.x2-i[o-1].x,s.y2-i[o-1].y,s.x-i[o-1].x,s.y-i[o-1].y],a[a.length-1].deltas.push(n);break;case"qct":var l=i[o-1].x+2/3*(s.x1-i[o-1].x),u=i[o-1].y+2/3*(s.y1-i[o-1].y),h=s.x+2/3*(s.x1-s.x),d=s.y+2/3*(s.y1-s.y),f=s.x,g=s.y;n=[l-i[o-1].x,u-i[o-1].y,h-i[o-1].x,d-i[o-1].y,f-i[o-1].x,g-i[o-1].y],a[a.length-1].deltas.push(n);break;case"arc":a.push({deltas:[],abs:[],arc:!0}),Array.isArray(a[a.length-1].abs)&&a[a.length-1].abs.push(s)}}r=t?null:"stroke"===e?"stroke":"fill";for(var v=!1,b=0;b<a.length;b++)if(a[b].arc)for(var y=a[b].abs,x=0;x<y.length;x++){var w=y[x];"arc"===w.type?C.call(this,w.x,w.y,w.radius,w.startAngle,w.endAngle,w.counterclockwise,void 0,t,!v):A.call(this,w.x,w.y),v=!0}else if(!0===a[b].close)this.pdf.internal.out("h"),v=!1;else if(!0!==a[b].begin){var k=a[b].start.x,S=a[b].start.y;R.call(this,a[b].deltas,k,S),v=!0}r&&E.call(this,r),t&&I.call(this)}},S=function(e){var t=this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor,n=t*(this.pdf.internal.getLineHeightFactor()-1);switch(this.ctx.textBaseline){case"bottom":return e-n;case"top":return e+t-n;case"hanging":return e+t-2*n;case"middle":return e+t/2-n;default:return e}},N=function(e){return e+this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor*(this.pdf.internal.getLineHeightFactor()-1)};d.prototype.createLinearGradient=function(){var e=function(){};return e.colorStops=[],e.addColorStop=function(e,t){this.colorStops.push([e,t])},e.getColor=function(){return 0===this.colorStops.length?"#000000":this.colorStops[0][1]},e.isCanvasGradient=!0,e},d.prototype.createPattern=function(){return this.createLinearGradient()},d.prototype.createRadialGradient=function(){return this.createLinearGradient()};var C=function(e,t,n,r,a,i,o,s,c){for(var l=D.call(this,n,r,a,i),u=0;u<l.length;u++){var h=l[u];0===u&&(c?T.call(this,h.x1+e,h.y1+t):A.call(this,h.x1+e,h.y1+t)),F.call(this,e,t,h.x2,h.y2,h.x3,h.y3,h.x4,h.y4)}s?I.call(this):E.call(this,o)},E=function(e){switch(e){case"stroke":this.pdf.internal.out("S");break;case"fill":this.pdf.internal.out("f")}},I=function(){this.pdf.clip(),this.pdf.discardPath()},T=function(e,t){this.pdf.internal.out(n(e)+" "+a(t)+" m")},_=function(e){var t;switch(e.align){case"right":case"end":t="right";break;case"center":t="center";break;default:t="left"}var n=this.pdf.getTextDimensions(e.text),r=S.call(this,e.y),a=N.call(this,r)-n.h,i=this.ctx.transform.applyToPoint(new s(e.x,r)),o=this.ctx.transform.decompose(),u=new l;u=(u=(u=u.multiply(o.translate)).multiply(o.skew)).multiply(o.scale);for(var h,d,f,p=this.ctx.transform.applyToRectangle(new c(e.x,r,n.w,n.h)),m=u.applyToRectangle(new c(e.x,a,n.w,n.h)),b=v.call(this,m),w=[],C=0;C<b.length;C+=1)-1===w.indexOf(b[C])&&w.push(b[C]);if(x(w),this.autoPaging)for(var E=w[0],I=w[w.length-1],T=E;T<I+1;T++){this.pdf.setPage(T);var _=1===T?this.posY+this.margin[0]:this.margin[0],A=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],R=this.pdf.internal.pageSize.height-this.margin[2],F=R-this.margin[0],D=this.pdf.internal.pageSize.width-this.margin[1],O=D-this.margin[3],L=1===T?0:A+(T-2)*F;if(0!==this.ctx.clip_path.length){var P=this.path;h=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=y(h,this.posX+this.margin[3],-1*L+_),k.call(this,"fill",!0),this.path=P}var M=y([JSON.parse(JSON.stringify(m))],this.posX+this.margin[3],-L+_+this.ctx.prevPageLastElemOffset)[0];e.scale>=.01&&(d=this.pdf.internal.getFontSize(),this.pdf.setFontSize(d*e.scale),f=this.lineWidth,this.lineWidth=f*e.scale);var j="text"!==this.autoPaging;if(j||M.y+M.h<=R){if(j||M.y>=_&&M.x<=D){var B=j?e.text:this.pdf.splitTextToSize(e.text,e.maxWidth||D-M.x)[0],z=y([JSON.parse(JSON.stringify(p))],this.posX+this.margin[3],-L+_+this.ctx.prevPageLastElemOffset)[0],U=j&&(T>E||T<I)&&g.call(this);U&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],O,F,null).clip().discardPath()),this.pdf.text(B,z.x,z.y,{angle:e.angle,align:t,renderingMode:e.renderingMode}),U&&this.pdf.restoreGraphicsState()}}else M.y<R&&(this.ctx.prevPageLastElemOffset+=R-M.y);e.scale>=.01&&(this.pdf.setFontSize(d),this.lineWidth=f)}else e.scale>=.01&&(d=this.pdf.internal.getFontSize(),this.pdf.setFontSize(d*e.scale),f=this.lineWidth,this.lineWidth=f*e.scale),this.pdf.text(e.text,i.x+this.posX,i.y+this.posY,{angle:e.angle,align:t,renderingMode:e.renderingMode,maxWidth:e.maxWidth}),e.scale>=.01&&(this.pdf.setFontSize(d),this.lineWidth=f)},A=function(e,t,r,i){r=r||0,i=i||0,this.pdf.internal.out(n(e+r)+" "+a(t+i)+" l")},R=function(e,t,n){return this.pdf.lines(e,t,n,null,null)},F=function(e,n,r,a,s,c,l,u){this.pdf.internal.out([t(i(r+e)),t(o(a+n)),t(i(s+e)),t(o(c+n)),t(i(l+e)),t(o(u+n)),"c"].join(" "))},D=function(e,t,n,r){for(var a=2*Math.PI,i=Math.PI/2;t>n;)t-=a;var o=Math.abs(n-t);o<a&&r&&(o=a-o);for(var s=[],c=r?-1:1,l=t;o>1e-5;){var u=l+c*Math.min(o,i);s.push(O.call(this,e,l,u)),o-=Math.abs(u-l),l=u}return s},O=function(e,t,n){var r=(n-t)/2,a=e*Math.cos(r),i=e*Math.sin(r),o=a,s=-i,c=o*o+s*s,l=c+o*a+s*i,u=4/3*(Math.sqrt(2*c*l)-l)/(o*i-s*a),h=o-u*s,d=s+u*o,f=h,p=-d,m=r+t,g=Math.cos(m),v=Math.sin(m);return{x1:e*Math.cos(t),y1:e*Math.sin(t),x2:h*g-d*v,y2:h*v+d*g,x3:f*g-p*v,y3:f*v+p*g,x4:e*Math.cos(n),y4:e*Math.sin(n)}},L=function(e){return 180*e/Math.PI},P=function(e,t,n,r,a,i){var o=e+.5*(n-e),s=t+.5*(r-t),l=a+.5*(n-a),u=i+.5*(r-i),h=Math.min(e,a,o,l),d=Math.max(e,a,o,l),f=Math.min(t,i,s,u),p=Math.max(t,i,s,u);return new c(h,f,d-h,p-f)},M=function(e,t,n,r,a,i,o,s){var l,u,h,d,f,p,m,g,v,b,y,x,w,k,S=n-e,N=r-t,C=a-n,E=i-r,I=o-a,T=s-i;for(u=0;u<41;u++)v=(m=(h=e+(l=u/40)*S)+l*((f=n+l*C)-h))+l*(f+l*(a+l*I-f)-m),b=(g=(d=t+l*N)+l*((p=r+l*E)-d))+l*(p+l*(i+l*T-p)-g),0==u?(y=v,x=b,w=v,k=b):(y=Math.min(y,v),x=Math.min(x,b),w=Math.max(w,v),k=Math.max(k,b));return new c(Math.round(y),Math.round(x),Math.round(w-y),Math.round(k-x))},j=function(){if(this.prevLineDash||this.ctx.lineDash.length||this.ctx.lineDashOffset){var e,t,n=(e=this.ctx.lineDash,t=this.ctx.lineDashOffset,JSON.stringify({lineDash:e,lineDashOffset:t}));this.prevLineDash!==n&&(this.pdf.setLineDash(this.ctx.lineDash,this.ctx.lineDashOffset),this.prevLineDash=n)}}}(Ae.API),function(e){var t=function(e){var t,n,r,a,i,o,s,c,l,u;for(/[^\x00-\xFF]/.test(e),n=[],r=0,a=(e+=t="\0\0\0\0".slice(e.length%4||4)).length;a>r;r+=4)0!==(i=(e.charCodeAt(r)<<24)+(e.charCodeAt(r+1)<<16)+(e.charCodeAt(r+2)<<8)+e.charCodeAt(r+3))?(o=(i=((i=((i=((i=(i-(u=i%85))/85)-(l=i%85))/85)-(c=i%85))/85)-(s=i%85))/85)%85,n.push(o+33,s+33,c+33,l+33,u+33)):n.push(122);return function(e,t){for(var n=t;n>0;n--)e.pop()}(n,t.length),String.fromCharCode.apply(String,n)+"~>"},n=function(e){var t,n,r,a,i,o=String,s="length",c=255,l="charCodeAt",u="slice",h="replace";for(e[u](-2),e=e[u](0,-2)[h](/\s/g,"")[h]("z","!!!!!"),r=[],a=0,i=(e+=t="uuuuu"[u](e[s]%5||5))[s];i>a;a+=5)n=52200625*(e[l](a)-33)+614125*(e[l](a+1)-33)+7225*(e[l](a+2)-33)+85*(e[l](a+3)-33)+(e[l](a+4)-33),r.push(c&n>>24,c&n>>16,c&n>>8,c&n);return function(e,t){for(var n=t;n>0;n--)e.pop()}(r,t[s]),o.fromCharCode.apply(o,r)},r=function(e){var t=new RegExp(/^([0-9A-Fa-f]{2})+$/);if(-1!==(e=e.replace(/\s/g,"")).indexOf(">")&&(e=e.substr(0,e.indexOf(">"))),e.length%2&&(e+="0"),!1===t.test(e))return"";for(var n="",r=0;r<e.length;r+=2)n+=String.fromCharCode("0x"+(e[r]+e[r+1]));return n},a=function(e){for(var t=new Uint8Array(e.length),n=e.length;n--;)t[n]=e.charCodeAt(n);return(t=Y(t)).reduce(function(e,t){return e+String.fromCharCode(t)},"")};e.processDataByFilters=function(e,i){var o=0,s=e||"",c=[];for("string"==typeof(i=i||[])&&(i=[i]),o=0;o<i.length;o+=1)switch(i[o]){case"ASCII85Decode":case"/ASCII85Decode":s=n(s),c.push("/ASCII85Encode");break;case"ASCII85Encode":case"/ASCII85Encode":s=t(s),c.push("/ASCII85Decode");break;case"ASCIIHexDecode":case"/ASCIIHexDecode":s=r(s),c.push("/ASCIIHexEncode");break;case"ASCIIHexEncode":case"/ASCIIHexEncode":s=s.split("").map(function(e){return("0"+e.charCodeAt().toString(16)).slice(-2)}).join("")+">",c.push("/ASCIIHexDecode");break;case"FlateEncode":case"/FlateEncode":s=a(s),c.push("/FlateDecode");break;default:throw new Error('The filter: "'+i[o]+'" is not implemented')}return{data:s,reverseChain:c.reverse().join(" ")}}}(Ae.API),(Pt=Ae.API).loadFile=function(e,t,n){return function(e,t,n){t=!1!==t,n="function"==typeof n?n:function(){};var r=void 0;try{r=function(e,t,n){var r=new XMLHttpRequest,a=0,i=function(e){var t=e.length,n=[],r=String.fromCharCode;for(a=0;a<t;a+=1)n.push(r(255&e.charCodeAt(a)));return n.join("")};if(r.open("GET",e,!t),r.overrideMimeType("text/plain; charset=x-user-defined"),!1===t&&(r.onload=function(){200===r.status?n(i(this.responseText)):n(void 0)}),r.send(null),t&&200===r.status)return i(r.responseText)}(e,t,n)}catch(e){}return r}(e,t,n)},Pt.loadImageFile=Pt.loadFile,function(e){function t(){return(J.html2canvas?Promise.resolve(J.html2canvas):n.e(52).then(n.t.bind(n,1052,23))).catch(function(e){return Promise.reject(new Error("Could not load html2canvas: "+e))}).then(function(e){return e.default?e.default:e})}function a(){return(J.DOMPurify?Promise.resolve(J.DOMPurify):n.e(760).then(n.t.bind(n,760,23))).catch(function(e){return Promise.reject(new Error("Could not load dompurify: "+e))}).then(function(e){return e.default?e.default:e})}var i=function(e){var t=(0,r.A)(e);return"undefined"===t?"undefined":"string"===t||e instanceof String?"string":"number"===t||e instanceof Number?"number":"function"===t||e instanceof Function?"function":e&&e.constructor===Array?"array":e&&1===e.nodeType?"element":"object"===t?"object":"unknown"},o=function(e,t){var n=document.createElement(e);for(var r in t.className&&(n.className=t.className),t.innerHTML&&t.dompurify&&(n.innerHTML=t.dompurify.sanitize(t.innerHTML)),t.style)n.style[r]=t.style[r];return n},s=function e(t){var n=Object.assign(e.convert(Promise.resolve()),JSON.parse(JSON.stringify(e.template))),r=e.convert(Promise.resolve(),n);return(r=r.setProgress(1,e,1,[e])).set(t)};(s.prototype=Object.create(Promise.prototype)).constructor=s,s.convert=function(e,t){return e.__proto__=t||s.prototype,e},s.template={prop:{src:null,container:null,overlay:null,canvas:null,img:null,pdf:null,pageSize:null,callback:function(){}},progress:{val:0,state:null,n:0,stack:[]},opt:{filename:"file.pdf",margin:[0,0,0,0],enableLinks:!0,x:0,y:0,html2canvas:{},jsPDF:{},backgroundColor:"transparent"}},s.prototype.from=function(e,t){return this.then(function(){switch(t=t||function(e){switch(i(e)){case"string":return"string";case"element":return"canvas"===e.nodeName.toLowerCase()?"canvas":"element";default:return"unknown"}}(e)){case"string":return this.then(a).then(function(t){return this.set({src:o("div",{innerHTML:e,dompurify:t})})});case"element":return this.set({src:e});case"canvas":return this.set({canvas:e});case"img":return this.set({img:e});default:return this.error("Unknown source type.")}})},s.prototype.to=function(e){switch(e){case"container":return this.toContainer();case"canvas":return this.toCanvas();case"img":return this.toImg();case"pdf":return this.toPdf();default:return this.error("Invalid target.")}},s.prototype.toContainer=function(){return this.thenList([function(){return this.prop.src||this.error("Cannot duplicate - no source HTML.")},function(){return this.prop.pageSize||this.setPageSize()}]).then(function(){var e={position:"relative",display:"inline-block",width:("number"!=typeof this.opt.width||isNaN(this.opt.width)||"number"!=typeof this.opt.windowWidth||isNaN(this.opt.windowWidth)?Math.max(this.prop.src.clientWidth,this.prop.src.scrollWidth,this.prop.src.offsetWidth):this.opt.windowWidth)+"px",left:0,right:0,top:0,margin:"auto",backgroundColor:this.opt.backgroundColor},t=function e(t,n){for(var r=3===t.nodeType?document.createTextNode(t.nodeValue):t.cloneNode(!1),a=t.firstChild;a;a=a.nextSibling)!0!==n&&1===a.nodeType&&"SCRIPT"===a.nodeName||r.appendChild(e(a,n));return 1===t.nodeType&&("CANVAS"===t.nodeName?(r.width=t.width,r.height=t.height,r.getContext("2d").drawImage(t,0,0)):"TEXTAREA"!==t.nodeName&&"SELECT"!==t.nodeName||(r.value=t.value),r.addEventListener("load",function(){r.scrollTop=t.scrollTop,r.scrollLeft=t.scrollLeft},!0)),r}(this.prop.src,this.opt.html2canvas.javascriptEnabled);"BODY"===t.tagName&&(e.height=Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight)+"px"),this.prop.overlay=o("div",{className:"html2pdf__overlay",style:{position:"fixed",overflow:"hidden",zIndex:1e3,left:"-100000px",right:0,bottom:0,top:0}}),this.prop.container=o("div",{className:"html2pdf__container",style:e}),this.prop.container.appendChild(t),this.prop.container.firstChild.appendChild(o("div",{style:{clear:"both",border:"0 none transparent",margin:0,padding:0,height:0}})),this.prop.container.style.float="none",this.prop.overlay.appendChild(this.prop.container),document.body.appendChild(this.prop.overlay),this.prop.container.firstChild.style.position="relative",this.prop.container.height=Math.max(this.prop.container.firstChild.clientHeight,this.prop.container.firstChild.scrollHeight,this.prop.container.firstChild.offsetHeight)+"px"})},s.prototype.toCanvas=function(){var e=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(e).then(t).then(function(e){var t=Object.assign({},this.opt.html2canvas);return delete t.onrendered,e(this.prop.container,t)}).then(function(e){(this.opt.html2canvas.onrendered||function(){})(e),this.prop.canvas=e,document.body.removeChild(this.prop.overlay)})},s.prototype.toContext2d=function(){var e=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(e).then(t).then(function(e){var t=this.opt.jsPDF,n=this.opt.fontFaces,r="number"!=typeof this.opt.width||isNaN(this.opt.width)||"number"!=typeof this.opt.windowWidth||isNaN(this.opt.windowWidth)?1:this.opt.width/this.opt.windowWidth,a=Object.assign({async:!0,allowTaint:!0,scale:r,scrollX:this.opt.scrollX||0,scrollY:this.opt.scrollY||0,backgroundColor:"#ffffff",imageTimeout:15e3,logging:!0,proxy:null,removeContainer:!0,foreignObjectRendering:!1,useCORS:!1},this.opt.html2canvas);if(delete a.onrendered,t.context2d.autoPaging=void 0===this.opt.autoPaging||this.opt.autoPaging,t.context2d.posX=this.opt.x,t.context2d.posY=this.opt.y,t.context2d.margin=this.opt.margin,t.context2d.fontFaces=n,n)for(var i=0;i<n.length;++i){var o=n[i],s=o.src.find(function(e){return"truetype"===e.format});s&&t.addFont(s.url,o.ref.name,o.ref.style)}return a.windowHeight=a.windowHeight||0,a.windowHeight=0==a.windowHeight?Math.max(this.prop.container.clientHeight,this.prop.container.scrollHeight,this.prop.container.offsetHeight):a.windowHeight,t.context2d.save(!0),e(this.prop.container,a)}).then(function(e){this.opt.jsPDF.context2d.restore(!0),(this.opt.html2canvas.onrendered||function(){})(e),this.prop.canvas=e,document.body.removeChild(this.prop.overlay)})},s.prototype.toImg=function(){return this.thenList([function(){return this.prop.canvas||this.toCanvas()}]).then(function(){var e=this.prop.canvas.toDataURL("image/"+this.opt.image.type,this.opt.image.quality);this.prop.img=document.createElement("img"),this.prop.img.src=e})},s.prototype.toPdf=function(){return this.thenList([function(){return this.toContext2d()}]).then(function(){this.prop.pdf=this.prop.pdf||this.opt.jsPDF})},s.prototype.output=function(e,t,n){return"img"===(n=n||"pdf").toLowerCase()||"image"===n.toLowerCase()?this.outputImg(e,t):this.outputPdf(e,t)},s.prototype.outputPdf=function(e,t){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){return this.prop.pdf.output(e,t)})},s.prototype.outputImg=function(e){return this.thenList([function(){return this.prop.img||this.toImg()}]).then(function(){switch(e){case void 0:case"img":return this.prop.img;case"datauristring":case"dataurlstring":return this.prop.img.src;case"datauri":case"dataurl":return document.location.href=this.prop.img.src;default:throw'Image output type "'+e+'" is not supported.'}})},s.prototype.save=function(e){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).set(e?{filename:e}:null).then(function(){this.prop.pdf.save(this.opt.filename)})},s.prototype.doCallback=function(){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){this.prop.callback(this.prop.pdf)})},s.prototype.set=function(e){if("object"!==i(e))return this;var t=Object.keys(e||{}).map(function(t){if(t in s.template.prop)return function(){this.prop[t]=e[t]};switch(t){case"margin":return this.setMargin.bind(this,e.margin);case"jsPDF":return function(){return this.opt.jsPDF=e.jsPDF,this.setPageSize()};case"pageSize":return this.setPageSize.bind(this,e.pageSize);default:return function(){this.opt[t]=e[t]}}},this);return this.then(function(){return this.thenList(t)})},s.prototype.get=function(e,t){return this.then(function(){var n=e in s.template.prop?this.prop[e]:this.opt[e];return t?t(n):n})},s.prototype.setMargin=function(e){return this.then(function(){switch(i(e)){case"number":e=[e,e,e,e];case"array":if(2===e.length&&(e=[e[0],e[1],e[0],e[1]]),4===e.length)break;default:return this.error("Invalid margin array.")}this.opt.margin=e}).then(this.setPageSize)},s.prototype.setPageSize=function(e){function t(e,t){return Math.floor(e*t/72*96)}return this.then(function(){(e=e||Ae.getPageSize(this.opt.jsPDF)).hasOwnProperty("inner")||(e.inner={width:e.width-this.opt.margin[1]-this.opt.margin[3],height:e.height-this.opt.margin[0]-this.opt.margin[2]},e.inner.px={width:t(e.inner.width,e.k),height:t(e.inner.height,e.k)},e.inner.ratio=e.inner.height/e.inner.width),this.prop.pageSize=e})},s.prototype.setProgress=function(e,t,n,r){return null!=e&&(this.progress.val=e),null!=t&&(this.progress.state=t),null!=n&&(this.progress.n=n),null!=r&&(this.progress.stack=r),this.progress.ratio=this.progress.val/this.progress.state,this},s.prototype.updateProgress=function(e,t,n,r){return this.setProgress(e?this.progress.val+e:null,t||null,n?this.progress.n+n:null,r?this.progress.stack.concat(r):null)},s.prototype.then=function(e,t){var n=this;return this.thenCore(e,t,function(e,t){return n.updateProgress(null,null,1,[e]),Promise.prototype.then.call(this,function(t){return n.updateProgress(null,e),t}).then(e,t).then(function(e){return n.updateProgress(1),e})})},s.prototype.thenCore=function(e,t,n){n=n||Promise.prototype.then,e&&(e=e.bind(this)),t&&(t=t.bind(this));var r=-1!==Promise.toString().indexOf("[native code]")&&"Promise"===Promise.name?this:s.convert(Object.assign({},this),Promise.prototype),a=n.call(r,e,t);return s.convert(a,this.__proto__)},s.prototype.thenExternal=function(e,t){return Promise.prototype.then.call(this,e,t)},s.prototype.thenList=function(e){var t=this;return e.forEach(function(e){t=t.thenCore(e)}),t},s.prototype.catch=function(e){e&&(e=e.bind(this));var t=Promise.prototype.catch.call(this,e);return s.convert(t,this)},s.prototype.catchExternal=function(e){return Promise.prototype.catch.call(this,e)},s.prototype.error=function(e){return this.then(function(){throw new Error(e)})},s.prototype.using=s.prototype.set,s.prototype.saveAs=s.prototype.save,s.prototype.export=s.prototype.output,s.prototype.run=s.prototype.then,Ae.getPageSize=function(e,t,n){if("object"===(0,r.A)(e)){var a=e;e=a.orientation,t=a.unit||t,n=a.format||n}t=t||"mm",n=n||"a4",e=(""+(e||"P")).toLowerCase();var i,o=(""+n).toLowerCase(),s={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};switch(t){case"pt":i=1;break;case"mm":i=72/25.4;break;case"cm":i=72/2.54;break;case"in":i=72;break;case"px":i=.75;break;case"pc":case"em":i=12;break;case"ex":i=6;break;default:throw"Invalid unit: "+t}var c,l=0,u=0;if(s.hasOwnProperty(o))l=s[o][1]/i,u=s[o][0]/i;else try{l=n[1],u=n[0]}catch(Pt){throw new Error("Invalid format: "+n)}if("p"===e||"portrait"===e)e="p",u>l&&(c=u,u=l,l=c);else{if("l"!==e&&"landscape"!==e)throw"Invalid orientation: "+e;e="l",l>u&&(c=u,u=l,l=c)}return{width:u,height:l,unit:t,k:i,orientation:e}},e.html=function(e,t){(t=t||{}).callback=t.callback||function(){},t.html2canvas=t.html2canvas||{},t.html2canvas.canvas=t.html2canvas.canvas||this.canvas,t.jsPDF=t.jsPDF||this,t.fontFaces=t.fontFaces?t.fontFaces.map(Ct):null;var n=new s(t);return t.worker?n:n.from(e).doCallback()}}(Ae.API),Ae.API.addJS=function(e){return Lt=e,this.internal.events.subscribe("postPutResources",function(){Dt=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/Names [(EmbeddedJS) "+(Dt+1)+" 0 R]"),this.internal.out(">>"),this.internal.out("endobj"),Ot=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /JavaScript"),this.internal.out("/JS ("+Lt+")"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){void 0!==Dt&&void 0!==Ot&&this.internal.out("/Names <</JavaScript "+Dt+" 0 R>>")}),this},function(e){var t;e.events.push(["postPutResources",function(){var e=this,n=/^(\d+) 0 obj$/;if(this.outline.root.children.length>0)for(var r=e.outline.render().split(/\r\n/),a=0;a<r.length;a++){var i=r[a],o=n.exec(i);if(null!=o){var s=o[1];e.internal.newObjectDeferredBegin(s,!1)}e.internal.write(i)}if(this.outline.createNamedDestinations){var c=this.internal.pages.length,l=[];for(a=0;a<c;a++){var u=e.internal.newObject();l.push(u);var h=e.internal.getPageInfo(a+1);e.internal.write("<< /D["+h.objId+" 0 R /XYZ null null null]>> endobj")}var d=e.internal.newObject();for(e.internal.write("<< /Names [ "),a=0;a<l.length;a++)e.internal.write("(page_"+(a+1)+")"+l[a]+" 0 R");e.internal.write(" ] >>","endobj"),t=e.internal.newObject(),e.internal.write("<< /Dests "+d+" 0 R"),e.internal.write(">>","endobj")}}]),e.events.push(["putCatalog",function(){this.outline.root.children.length>0&&(this.internal.write("/Outlines",this.outline.makeRef(this.outline.root)),this.outline.createNamedDestinations&&this.internal.write("/Names "+t+" 0 R"))}]),e.events.push(["initialized",function(){var e=this;e.outline={createNamedDestinations:!1,root:{children:[]}},e.outline.add=function(e,t,n){var r={title:t,options:n,children:[]};return null==e&&(e=this.root),e.children.push(r),r},e.outline.render=function(){return this.ctx={},this.ctx.val="",this.ctx.pdf=e,this.genIds_r(this.root),this.renderRoot(this.root),this.renderItems(this.root),this.ctx.val},e.outline.genIds_r=function(t){t.id=e.internal.newObjectDeferred();for(var n=0;n<t.children.length;n++)this.genIds_r(t.children[n])},e.outline.renderRoot=function(e){this.objStart(e),this.line("/Type /Outlines"),e.children.length>0&&(this.line("/First "+this.makeRef(e.children[0])),this.line("/Last "+this.makeRef(e.children[e.children.length-1]))),this.line("/Count "+this.count_r({count:0},e)),this.objEnd()},e.outline.renderItems=function(t){for(var n=this.ctx.pdf.internal.getVerticalCoordinateString,r=0;r<t.children.length;r++){var a=t.children[r];this.objStart(a),this.line("/Title "+this.makeString(a.title)),this.line("/Parent "+this.makeRef(t)),r>0&&this.line("/Prev "+this.makeRef(t.children[r-1])),r<t.children.length-1&&this.line("/Next "+this.makeRef(t.children[r+1])),a.children.length>0&&(this.line("/First "+this.makeRef(a.children[0])),this.line("/Last "+this.makeRef(a.children[a.children.length-1])));var i=this.count=this.count_r({count:0},a);if(i>0&&this.line("/Count "+i),a.options&&a.options.pageNumber){var o=e.internal.getPageInfo(a.options.pageNumber);this.line("/Dest ["+o.objId+" 0 R /XYZ 0 "+n(0)+" 0]")}this.objEnd()}for(var s=0;s<t.children.length;s++)this.renderItems(t.children[s])},e.outline.line=function(e){this.ctx.val+=e+"\r\n"},e.outline.makeRef=function(e){return e.id+" 0 R"},e.outline.makeString=function(t){return"("+e.internal.pdfEscape(t)+")"},e.outline.objStart=function(e){this.ctx.val+="\r\n"+e.id+" 0 obj\r\n<<\r\n"},e.outline.objEnd=function(){this.ctx.val+=">> \r\nendobj\r\n"},e.outline.count_r=function(e,t){for(var n=0;n<t.children.length;n++)e.count++,this.count_r(e,t.children[n]);return e.count}}])}(Ae.API),function(e){var t=[192,193,194,195,196,197,198,199];e.processJPEG=function(e,n,r,a,i,o){var s,c=this.decode.DCT_DECODE,l=null;if("string"==typeof e||this.__addimage__.isArrayBuffer(e)||this.__addimage__.isArrayBufferView(e)){switch(e=i||e,e=this.__addimage__.isArrayBuffer(e)?new Uint8Array(e):e,(s=function(e){for(var n,r=256*e.charCodeAt(4)+e.charCodeAt(5),a=e.length,i={width:0,height:0,numcomponents:1},o=4;o<a;o+=2){if(o+=r,-1!==t.indexOf(e.charCodeAt(o+1))){n=256*e.charCodeAt(o+5)+e.charCodeAt(o+6),i={width:256*e.charCodeAt(o+7)+e.charCodeAt(o+8),height:n,numcomponents:e.charCodeAt(o+9)};break}r=256*e.charCodeAt(o+2)+e.charCodeAt(o+3)}return i}(e=this.__addimage__.isArrayBufferView(e)?this.__addimage__.arrayBufferToBinaryString(e):e)).numcomponents){case 1:o=this.color_spaces.DEVICE_GRAY;break;case 4:o=this.color_spaces.DEVICE_CMYK;break;case 3:o=this.color_spaces.DEVICE_RGB}l={data:e,width:s.width,height:s.height,colorSpace:o,bitsPerComponent:8,filter:c,index:n,alias:r}}return l}}(Ae.API);var jt,Bt,zt,Ut,Wt,Vt=function(){var e,t,n;function r(e){var t,n,r,a,i,o,s,c,l,u,h,d,f,p;for(this.data=e,this.pos=8,this.palette=[],this.imgData=[],this.transparency={},this.animation=null,this.text={},o=null;;){switch(t=this.readUInt32(),l=function(){var e,t;for(t=[],e=0;e<4;++e)t.push(String.fromCharCode(this.data[this.pos++]));return t}.call(this).join("")){case"IHDR":this.width=this.readUInt32(),this.height=this.readUInt32(),this.bits=this.data[this.pos++],this.colorType=this.data[this.pos++],this.compressionMethod=this.data[this.pos++],this.filterMethod=this.data[this.pos++],this.interlaceMethod=this.data[this.pos++];break;case"acTL":this.animation={numFrames:this.readUInt32(),numPlays:this.readUInt32()||1/0,frames:[]};break;case"PLTE":this.palette=this.read(t);break;case"fcTL":o&&this.animation.frames.push(o),this.pos+=4,o={width:this.readUInt32(),height:this.readUInt32(),xOffset:this.readUInt32(),yOffset:this.readUInt32()},i=this.readUInt16(),a=this.readUInt16()||100,o.delay=1e3*i/a,o.disposeOp=this.data[this.pos++],o.blendOp=this.data[this.pos++],o.data=[];break;case"IDAT":case"fdAT":for("fdAT"===l&&(this.pos+=4,t-=4),e=(null!=o?o.data:void 0)||this.imgData,d=0;0<=t?d<t:d>t;0<=t?++d:--d)e.push(this.data[this.pos++]);break;case"tRNS":switch(this.transparency={},this.colorType){case 3:if(r=this.palette.length/3,this.transparency.indexed=this.read(t),this.transparency.indexed.length>r)throw new Error("More transparent colors than palette size");if((u=r-this.transparency.indexed.length)>0)for(f=0;0<=u?f<u:f>u;0<=u?++f:--f)this.transparency.indexed.push(255);break;case 0:this.transparency.grayscale=this.read(t)[0];break;case 2:this.transparency.rgb=this.read(t)}break;case"tEXt":s=(h=this.read(t)).indexOf(0),c=String.fromCharCode.apply(String,h.slice(0,s)),this.text[c]=String.fromCharCode.apply(String,h.slice(s+1));break;case"IEND":return o&&this.animation.frames.push(o),this.colors=function(){switch(this.colorType){case 0:case 3:case 4:return 1;case 2:case 6:return 3}}.call(this),this.hasAlphaChannel=4===(p=this.colorType)||6===p,n=this.colors+(this.hasAlphaChannel?1:0),this.pixelBitlength=this.bits*n,this.colorSpace=function(){switch(this.colors){case 1:return"DeviceGray";case 3:return"DeviceRGB"}}.call(this),void(this.imgData=new Uint8Array(this.imgData));default:this.pos+=t}if(this.pos+=4,this.pos>this.data.length)throw new Error("Incomplete or corrupt PNG file")}}r.prototype.read=function(e){var t,n;for(n=[],t=0;0<=e?t<e:t>e;0<=e?++t:--t)n.push(this.data[this.pos++]);return n},r.prototype.readUInt32=function(){return this.data[this.pos++]<<24|this.data[this.pos++]<<16|this.data[this.pos++]<<8|this.data[this.pos++]},r.prototype.readUInt16=function(){return this.data[this.pos++]<<8|this.data[this.pos++]},r.prototype.decodePixels=function(e){var t=this.pixelBitlength/8,n=new Uint8Array(this.width*this.height*t),r=0,a=this;if(null==e&&(e=this.imgData),0===e.length)return new Uint8Array(0);function i(i,o,s,c){var l,u,h,d,f,p,m,g,v,b,y,x,w,k,S,N,C,E,I,T,_,A=Math.ceil((a.width-i)/s),R=Math.ceil((a.height-o)/c),F=a.width==A&&a.height==R;for(k=t*A,x=F?n:new Uint8Array(k*R),p=e.length,w=0,u=0;w<R&&r<p;){switch(e[r++]){case 0:for(d=C=0;C<k;d=C+=1)x[u++]=e[r++];break;case 1:for(d=E=0;E<k;d=E+=1)l=e[r++],f=d<t?0:x[u-t],x[u++]=(l+f)%256;break;case 2:for(d=I=0;I<k;d=I+=1)l=e[r++],h=(d-d%t)/t,S=w&&x[(w-1)*k+h*t+d%t],x[u++]=(S+l)%256;break;case 3:for(d=T=0;T<k;d=T+=1)l=e[r++],h=(d-d%t)/t,f=d<t?0:x[u-t],S=w&&x[(w-1)*k+h*t+d%t],x[u++]=(l+Math.floor((f+S)/2))%256;break;case 4:for(d=_=0;_<k;d=_+=1)l=e[r++],h=(d-d%t)/t,f=d<t?0:x[u-t],0===w?S=N=0:(S=x[(w-1)*k+h*t+d%t],N=h&&x[(w-1)*k+(h-1)*t+d%t]),m=f+S-N,g=Math.abs(m-f),b=Math.abs(m-S),y=Math.abs(m-N),v=g<=b&&g<=y?f:b<=y?S:N,x[u++]=(l+v)%256;break;default:throw new Error("Invalid filter algorithm: "+e[r-1])}if(!F){var D=((o+w*c)*a.width+i)*t,O=w*k;for(d=0;d<A;d+=1){for(var L=0;L<t;L+=1)n[D++]=x[O++];D+=(s-1)*t}}w++}}return e=$(e),1==a.interlaceMethod?(i(0,0,8,8),i(4,0,8,8),i(0,4,4,8),i(2,0,4,4),i(0,2,2,4),i(1,0,2,2),i(0,1,1,2)):i(0,0,1,1),n},r.prototype.decodePalette=function(){var e,t,n,r,a,i,o,s,c;for(n=this.palette,i=this.transparency.indexed||[],a=new Uint8Array((i.length||0)+n.length),r=0,e=0,t=o=0,s=n.length;o<s;t=o+=3)a[r++]=n[t],a[r++]=n[t+1],a[r++]=n[t+2],a[r++]=null!=(c=i[e++])?c:255;return a},r.prototype.copyToImageData=function(e,t){var n,r,a,i,o,s,c,l,u,h,d;if(r=this.colors,u=null,n=this.hasAlphaChannel,this.palette.length&&(u=null!=(d=this._decodedPalette)?d:this._decodedPalette=this.decodePalette(),r=4,n=!0),l=(a=e.data||e).length,o=u||t,i=s=0,1===r)for(;i<l;)c=u?4*t[i/4]:s,h=o[c++],a[i++]=h,a[i++]=h,a[i++]=h,a[i++]=n?o[c++]:255,s=c;else for(;i<l;)c=u?4*t[i/4]:s,a[i++]=o[c++],a[i++]=o[c++],a[i++]=o[c++],a[i++]=n?o[c++]:255,s=c},r.prototype.decode=function(){var e;return e=new Uint8Array(this.width*this.height*4),this.copyToImageData(e,this.decodePixels()),e};var a=function(){if("[object Window]"===Object.prototype.toString.call(J)){try{t=J.document.createElement("canvas"),n=t.getContext("2d")}catch(e){return!1}return!0}return!1};return a(),e=function(e){var r;if(!0===a())return n.width=e.width,n.height=e.height,n.clearRect(0,0,e.width,e.height),n.putImageData(e,0,0),(r=new Image).src=t.toDataURL(),r;throw new Error("This method requires a Browser with Canvas-capability.")},r.prototype.decodeFrames=function(t){var n,r,a,i,o,s,c,l;if(this.animation){for(l=[],r=o=0,s=(c=this.animation.frames).length;o<s;r=++o)n=c[r],a=t.createImageData(n.width,n.height),i=this.decodePixels(new Uint8Array(n.data)),this.copyToImageData(a,i),n.imageData=a,l.push(n.image=e(a));return l}},r.prototype.renderFrame=function(e,t){var n,r,a;return n=(r=this.animation.frames)[t],a=r[t-1],0===t&&e.clearRect(0,0,this.width,this.height),1===(null!=a?a.disposeOp:void 0)?e.clearRect(a.xOffset,a.yOffset,a.width,a.height):2===(null!=a?a.disposeOp:void 0)&&e.putImageData(a.imageData,a.xOffset,a.yOffset),0===n.blendOp&&e.clearRect(n.xOffset,n.yOffset,n.width,n.height),e.drawImage(n.image,n.xOffset,n.yOffset)},r.prototype.animate=function(e){var t,n,r,a,i,o,s=this;return n=0,o=this.animation,a=o.numFrames,r=o.frames,i=o.numPlays,(t=function(){var o,c;if(o=n++%a,c=r[o],s.renderFrame(e,o),a>1&&n/a<i)return s.animation._timeout=setTimeout(t,c.delay)})()},r.prototype.stopAnimation=function(){var e;return clearTimeout(null!=(e=this.animation)?e._timeout:void 0)},r.prototype.render=function(e){var t,n;return e._png&&e._png.stopAnimation(),e._png=this,e.width=this.width,e.height=this.height,t=e.getContext("2d"),this.animation?(this.decodeFrames(t),this.animate(t)):(n=t.createImageData(this.width,this.height),this.copyToImageData(n,this.decodePixels()),t.putImageData(n,0,0))},r}();function Ht(e){var t=0;if(71!==e[t++]||73!==e[t++]||70!==e[t++]||56!==e[t++]||56!=(e[t++]+1&253)||97!==e[t++])throw new Error("Invalid GIF 87a/89a header.");var n=e[t++]|e[t++]<<8,r=e[t++]|e[t++]<<8,a=e[t++],i=a>>7,o=1<<1+(7&a);e[t++],e[t++];var s=null,c=null;i&&(s=t,c=o,t+=3*o);var l=!0,u=[],h=0,d=null,f=0,p=null;for(this.width=n,this.height=r;l&&t<e.length;)switch(e[t++]){case 33:switch(e[t++]){case 255:if(11!==e[t]||78==e[t+1]&&69==e[t+2]&&84==e[t+3]&&83==e[t+4]&&67==e[t+5]&&65==e[t+6]&&80==e[t+7]&&69==e[t+8]&&50==e[t+9]&&46==e[t+10]&&48==e[t+11]&&3==e[t+12]&&1==e[t+13]&&0==e[t+16])t+=14,p=e[t++]|e[t++]<<8,t++;else for(t+=12;;){if(!((I=e[t++])>=0))throw Error("Invalid block size");if(0===I)break;t+=I}break;case 249:if(4!==e[t++]||0!==e[t+4])throw new Error("Invalid graphics extension block.");var m=e[t++];h=e[t++]|e[t++]<<8,d=e[t++],0==(1&m)&&(d=null),f=m>>2&7,t++;break;case 254:for(;;){if(!((I=e[t++])>=0))throw Error("Invalid block size");if(0===I)break;t+=I}break;default:throw new Error("Unknown graphic control label: 0x"+e[t-1].toString(16))}break;case 44:var g=e[t++]|e[t++]<<8,v=e[t++]|e[t++]<<8,b=e[t++]|e[t++]<<8,y=e[t++]|e[t++]<<8,x=e[t++],w=x>>6&1,k=1<<1+(7&x),S=s,N=c,C=!1;x>>7&&(C=!0,S=t,N=k,t+=3*k);var E=t;for(t++;;){var I;if(!((I=e[t++])>=0))throw Error("Invalid block size");if(0===I)break;t+=I}u.push({x:g,y:v,width:b,height:y,has_local_palette:C,palette_offset:S,palette_size:N,data_offset:E,data_length:t-E,transparent_index:d,interlaced:!!w,delay:h,disposal:f});break;case 59:l=!1;break;default:throw new Error("Unknown gif block: 0x"+e[t-1].toString(16))}this.numFrames=function(){return u.length},this.loopCount=function(){return p},this.frameInfo=function(e){if(e<0||e>=u.length)throw new Error("Frame index out of range.");return u[e]},this.decodeAndBlitFrameBGRA=function(t,r){var a=this.frameInfo(t),i=a.width*a.height,o=new Uint8Array(i);Gt(e,a.data_offset,o,i);var s=a.palette_offset,c=a.transparent_index;null===c&&(c=256);var l=a.width,u=n-l,h=l,d=4*(a.y*n+a.x),f=4*((a.y+a.height)*n+a.x),p=d,m=4*u;!0===a.interlaced&&(m+=4*n*7);for(var g=8,v=0,b=o.length;v<b;++v){var y=o[v];if(0===h&&(h=l,(p+=m)>=f&&(m=4*u+4*n*(g-1),p=d+(l+u)*(g<<1),g>>=1)),y===c)p+=4;else{var x=e[s+3*y],w=e[s+3*y+1],k=e[s+3*y+2];r[p++]=k,r[p++]=w,r[p++]=x,r[p++]=255}--h}},this.decodeAndBlitFrameRGBA=function(t,r){var a=this.frameInfo(t),i=a.width*a.height,o=new Uint8Array(i);Gt(e,a.data_offset,o,i);var s=a.palette_offset,c=a.transparent_index;null===c&&(c=256);var l=a.width,u=n-l,h=l,d=4*(a.y*n+a.x),f=4*((a.y+a.height)*n+a.x),p=d,m=4*u;!0===a.interlaced&&(m+=4*n*7);for(var g=8,v=0,b=o.length;v<b;++v){var y=o[v];if(0===h&&(h=l,(p+=m)>=f&&(m=4*u+4*n*(g-1),p=d+(l+u)*(g<<1),g>>=1)),y===c)p+=4;else{var x=e[s+3*y],w=e[s+3*y+1],k=e[s+3*y+2];r[p++]=x,r[p++]=w,r[p++]=k,r[p++]=255}--h}}}function Gt(e,t,n,r){for(var a=e[t++],i=1<<a,o=i+1,s=o+1,c=a+1,l=(1<<c)-1,u=0,h=0,d=0,f=e[t++],p=new Int32Array(4096),m=null;;){for(;u<16&&0!==f;)h|=e[t++]<<u,u+=8,1===f?f=e[t++]:--f;if(u<c)break;var g=h&l;if(h>>=c,u-=c,g!==i){if(g===o)break;for(var v=g<s?g:m,b=0,y=v;y>i;)y=p[y]>>8,++b;var x=y;if(d+b+(v!==g?1:0)>r)return void Z.log("Warning, gif stream longer than expected.");n[d++]=x;var w=d+=b;for(v!==g&&(n[d++]=x),y=v;b--;)y=p[y],n[--w]=255&y,y>>=8;null!==m&&s<4096&&(p[s++]=m<<8|x,s>=l+1&&c<12&&(++c,l=l<<1|1)),m=g}else s=o+1,l=(1<<(c=a+1))-1,m=null}return d!==r&&Z.log("Warning, gif stream shorter than expected."),n}function qt(e){var t,n,r,a,i,o=Math.floor,s=new Array(64),c=new Array(64),l=new Array(64),u=new Array(64),h=new Array(65535),d=new Array(65535),f=new Array(64),p=new Array(64),m=[],g=0,v=7,b=new Array(64),y=new Array(64),x=new Array(64),w=new Array(256),k=new Array(2048),S=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],N=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],C=[0,1,2,3,4,5,6,7,8,9,10,11],E=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],I=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],T=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],_=[0,1,2,3,4,5,6,7,8,9,10,11],A=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],R=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function F(e,t){for(var n=0,r=0,a=new Array,i=1;i<=16;i++){for(var o=1;o<=e[i];o++)a[t[r]]=[],a[t[r]][0]=n,a[t[r]][1]=i,r++,n++;n*=2}return a}function D(e){for(var t=e[0],n=e[1]-1;n>=0;)t&1<<n&&(g|=1<<v),n--,--v<0&&(255==g?(O(255),O(0)):O(g),v=7,g=0)}function O(e){m.push(e)}function L(e){O(e>>8&255),O(255&e)}function P(e,t,n,r,a){for(var i,o=a[0],s=a[240],c=function(e,t){var n,r,a,i,o,s,c,l,u,h,d=0;for(u=0;u<8;++u){n=e[d],r=e[d+1],a=e[d+2],i=e[d+3],o=e[d+4],s=e[d+5],c=e[d+6];var p=n+(l=e[d+7]),m=n-l,g=r+c,v=r-c,b=a+s,y=a-s,x=i+o,w=i-o,k=p+x,S=p-x,N=g+b,C=g-b;e[d]=k+N,e[d+4]=k-N;var E=.707106781*(C+S);e[d+2]=S+E,e[d+6]=S-E;var I=.382683433*((k=w+y)-(C=v+m)),T=.5411961*k+I,_=1.306562965*C+I,A=.707106781*(N=y+v),R=m+A,F=m-A;e[d+5]=F+T,e[d+3]=F-T,e[d+1]=R+_,e[d+7]=R-_,d+=8}for(d=0,u=0;u<8;++u){n=e[d],r=e[d+8],a=e[d+16],i=e[d+24],o=e[d+32],s=e[d+40],c=e[d+48];var D=n+(l=e[d+56]),O=n-l,L=r+c,P=r-c,M=a+s,j=a-s,B=i+o,z=i-o,U=D+B,W=D-B,V=L+M,H=L-M;e[d]=U+V,e[d+32]=U-V;var G=.707106781*(H+W);e[d+16]=W+G,e[d+48]=W-G;var q=.382683433*((U=z+j)-(H=P+O)),K=.5411961*U+q,X=1.306562965*H+q,Y=.707106781*(V=j+P),$=O+Y,J=O-Y;e[d+40]=J+K,e[d+24]=J-K,e[d+8]=$+X,e[d+56]=$-X,d++}for(u=0;u<64;++u)h=e[u]*t[u],f[u]=h>0?h+.5|0:h-.5|0;return f}(e,t),l=0;l<64;++l)p[S[l]]=c[l];var u=p[0]-n;n=p[0],0==u?D(r[0]):(D(r[d[i=32767+u]]),D(h[i]));for(var m=63;m>0&&0==p[m];)m--;if(0==m)return D(o),n;for(var g,v=1;v<=m;){for(var b=v;0==p[v]&&v<=m;)++v;var y=v-b;if(y>=16){g=y>>4;for(var x=1;x<=g;++x)D(s);y&=15}i=32767+p[v],D(a[(y<<4)+d[i]]),D(h[i]),v++}return 63!=m&&D(o),n}function M(e){e=Math.min(Math.max(e,1),100),i!=e&&(function(e){for(var t=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],n=0;n<64;n++){var r=o((t[n]*e+50)/100);r=Math.min(Math.max(r,1),255),s[S[n]]=r}for(var a=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],i=0;i<64;i++){var h=o((a[i]*e+50)/100);h=Math.min(Math.max(h,1),255),c[S[i]]=h}for(var d=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],f=0,p=0;p<8;p++)for(var m=0;m<8;m++)l[f]=1/(s[S[f]]*d[p]*d[m]*8),u[f]=1/(c[S[f]]*d[p]*d[m]*8),f++}(e<50?Math.floor(5e3/e):Math.floor(200-2*e)),i=e)}this.encode=function(e,i){i&&M(i),m=new Array,g=0,v=7,L(65496),L(65504),L(16),O(74),O(70),O(73),O(70),O(0),O(1),O(1),O(0),L(1),L(1),O(0),O(0),function(){L(65499),L(132),O(0);for(var e=0;e<64;e++)O(s[e]);O(1);for(var t=0;t<64;t++)O(c[t])}(),function(e,t){L(65472),L(17),O(8),L(t),L(e),O(3),O(1),O(17),O(0),O(2),O(17),O(1),O(3),O(17),O(1)}(e.width,e.height),function(){L(65476),L(418),O(0);for(var e=0;e<16;e++)O(N[e+1]);for(var t=0;t<=11;t++)O(C[t]);O(16);for(var n=0;n<16;n++)O(E[n+1]);for(var r=0;r<=161;r++)O(I[r]);O(1);for(var a=0;a<16;a++)O(T[a+1]);for(var i=0;i<=11;i++)O(_[i]);O(17);for(var o=0;o<16;o++)O(A[o+1]);for(var s=0;s<=161;s++)O(R[s])}(),L(65498),L(12),O(3),O(1),O(0),O(2),O(17),O(3),O(17),O(0),O(63),O(0);var o=0,h=0,d=0;g=0,v=7,this.encode.displayName="_encode_";for(var f,p,w,S,F,j,B,z,U,W=e.data,V=e.width,H=e.height,G=4*V,q=0;q<H;){for(f=0;f<G;){for(F=G*q+f,B=-1,z=0,U=0;U<64;U++)j=F+(z=U>>3)*G+(B=4*(7&U)),q+z>=H&&(j-=G*(q+1+z-H)),f+B>=G&&(j-=f+B-G+4),p=W[j++],w=W[j++],S=W[j++],b[U]=(k[p]+k[w+256|0]+k[S+512|0]>>16)-128,y[U]=(k[p+768|0]+k[w+1024|0]+k[S+1280|0]>>16)-128,x[U]=(k[p+1280|0]+k[w+1536|0]+k[S+1792|0]>>16)-128;o=P(b,l,o,t,r),h=P(y,u,h,n,a),d=P(x,u,d,n,a),f+=32}q+=8}if(v>=0){var K=[];K[1]=v+1,K[0]=(1<<v+1)-1,D(K)}return L(65497),new Uint8Array(m)},e=e||50,function(){for(var e=String.fromCharCode,t=0;t<256;t++)w[t]=e(t)}(),t=F(N,C),n=F(T,_),r=F(E,I),a=F(A,R),function(){for(var e=1,t=2,n=1;n<=15;n++){for(var r=e;r<t;r++)d[32767+r]=n,h[32767+r]=[],h[32767+r][1]=n,h[32767+r][0]=r;for(var a=-(t-1);a<=-e;a++)d[32767+a]=n,h[32767+a]=[],h[32767+a][1]=n,h[32767+a][0]=t-1+a;e<<=1,t<<=1}}(),function(){for(var e=0;e<256;e++)k[e]=19595*e,k[e+256|0]=38470*e,k[e+512|0]=7471*e+32768,k[e+768|0]=-11059*e,k[e+1024|0]=-21709*e,k[e+1280|0]=32768*e+8421375,k[e+1536|0]=-27439*e,k[e+1792|0]=-5329*e}(),M(e)}function Kt(e,t){if(this.pos=0,this.buffer=e,this.datav=new DataView(e.buffer),this.is_with_alpha=!!t,this.bottom_up=!0,this.flag=String.fromCharCode(this.buffer[0])+String.fromCharCode(this.buffer[1]),this.pos+=2,-1===["BM","BA","CI","CP","IC","PT"].indexOf(this.flag))throw new Error("Invalid BMP File");this.parseHeader(),this.parseBGR()}function Xt(e){function t(e){if(!e)throw Error("assert :P")}function n(e,t,n){for(var r=0;4>r;r++)if(e[t+r]!=n.charCodeAt(r))return!0;return!1}function r(e,t,n,r,a){for(var i=0;i<a;i++)e[t+i]=n[r+i]}function a(e,t,n,r){for(var a=0;a<r;a++)e[t+a]=n}function i(e){return new Int32Array(e)}function o(e,t){for(var n=[],r=0;r<e;r++)n.push(new t);return n}function s(e,t){var n=[];return function e(n,r,a){for(var i=a[r],o=0;o<i&&(n.push(a.length>r+1?[]:new t),!(a.length<r+1));o++)e(n[o],r+1,a)}(n,0,e),n}var c=function(){var e=this;function c(e,t){for(var n=1<<t-1>>>0;e&n;)n>>>=1;return n?(e&n-1)+n:e}function l(e,n,r,a,i){t(!(a%r));do{e[n+(a-=r)]=i}while(0<a)}function u(e,n,r,a,o){if(t(2328>=o),512>=o)var s=i(512);else if(null==(s=i(o)))return 0;return function(e,n,r,a,o,s){var u,d,f=n,p=1<<r,m=i(16),g=i(16);for(t(0!=o),t(null!=a),t(null!=e),t(0<r),d=0;d<o;++d){if(15<a[d])return 0;++m[a[d]]}if(m[0]==o)return 0;for(g[1]=0,u=1;15>u;++u){if(m[u]>1<<u)return 0;g[u+1]=g[u]+m[u]}for(d=0;d<o;++d)u=a[d],0<a[d]&&(s[g[u]++]=d);if(1==g[15])return(a=new h).g=0,a.value=s[0],l(e,f,1,p,a),p;var v,b=-1,y=p-1,x=0,w=1,k=1,S=1<<r;for(d=0,u=1,o=2;u<=r;++u,o<<=1){if(w+=k<<=1,0>(k-=m[u]))return 0;for(;0<m[u];--m[u])(a=new h).g=u,a.value=s[d++],l(e,f+x,o,S,a),x=c(x,u)}for(u=r+1,o=2;15>=u;++u,o<<=1){if(w+=k<<=1,0>(k-=m[u]))return 0;for(;0<m[u];--m[u]){if(a=new h,(x&y)!=b){for(f+=S,v=1<<(b=u)-r;15>b&&!(0>=(v-=m[b]));)++b,v<<=1;p+=S=1<<(v=b-r),e[n+(b=x&y)].g=v+r,e[n+b].value=f-n-b}a.g=u-r,a.value=s[d++],l(e,f+(x>>r),o,S,a),x=c(x,u)}}return w!=2*g[15]-1?0:p}(e,n,r,a,o,s)}function h(){this.value=this.g=0}function d(){this.value=this.g=0}function f(){this.G=o(5,h),this.H=i(5),this.jc=this.Qb=this.qb=this.nd=0,this.pd=o(Bn,d)}function p(e,n,r,a){t(null!=e),t(null!=n),t(2147483648>a),e.Ca=254,e.I=0,e.b=-8,e.Ka=0,e.oa=n,e.pa=r,e.Jd=n,e.Yc=r+a,e.Zc=4<=a?r+a-4+1:r,E(e)}function m(e,t){for(var n=0;0<t--;)n|=T(e,128)<<t;return n}function g(e,t){var n=m(e,t);return I(e)?-n:n}function v(e,n,r,a){var i,o=0;for(t(null!=e),t(null!=n),t(4294967288>a),e.Sb=a,e.Ra=0,e.u=0,e.h=0,4<a&&(a=4),i=0;i<a;++i)o+=n[r+i]<<8*i;e.Ra=o,e.bb=a,e.oa=n,e.pa=r}function b(e){for(;8<=e.u&&e.bb<e.Sb;)e.Ra>>>=8,e.Ra+=e.oa[e.pa+e.bb]<<Wn-8>>>0,++e.bb,e.u-=8;S(e)&&(e.h=1,e.u=0)}function y(e,n){if(t(0<=n),!e.h&&n<=Un){var r=k(e)&zn[n];return e.u+=n,b(e),r}return e.h=1,e.u=0}function x(){this.b=this.Ca=this.I=0,this.oa=[],this.pa=0,this.Jd=[],this.Yc=0,this.Zc=[],this.Ka=0}function w(){this.Ra=0,this.oa=[],this.h=this.u=this.bb=this.Sb=this.pa=0}function k(e){return e.Ra>>>(e.u&Wn-1)>>>0}function S(e){return t(e.bb<=e.Sb),e.h||e.bb==e.Sb&&e.u>Wn}function N(e,t){e.u=t,e.h=S(e)}function C(e){e.u>=Vn&&(t(e.u>=Vn),b(e))}function E(e){t(null!=e&&null!=e.oa),e.pa<e.Zc?(e.I=(e.oa[e.pa++]|e.I<<8)>>>0,e.b+=8):(t(null!=e&&null!=e.oa),e.pa<e.Yc?(e.b+=8,e.I=e.oa[e.pa++]|e.I<<8):e.Ka?e.b=0:(e.I<<=8,e.b+=8,e.Ka=1))}function I(e){return m(e,1)}function T(e,t){var n=e.Ca;0>e.b&&E(e);var r=e.b,a=n*t>>>8,i=(e.I>>>r>a)+0;for(i?(n-=a,e.I-=a+1<<r>>>0):n=a+1,r=n,a=0;256<=r;)a+=8,r>>=8;return r=7^a+Hn[r],e.b-=r,e.Ca=(n<<r)-1,i}function _(e,t,n){e[t+0]=n>>24&255,e[t+1]=n>>16&255,e[t+2]=n>>8&255,e[t+3]=255&n}function A(e,t){return e[t+0]|e[t+1]<<8}function R(e,t){return A(e,t)|e[t+2]<<16}function F(e,t){return A(e,t)|A(e,t+2)<<16}function D(e,n){var r=1<<n;return t(null!=e),t(0<n),e.X=i(r),null==e.X?0:(e.Mb=32-n,e.Xa=n,1)}function O(e,n){t(null!=e),t(null!=n),t(e.Xa==n.Xa),r(n.X,0,e.X,0,1<<n.Xa)}function L(){this.X=[],this.Xa=this.Mb=0}function P(e,n,r,a){t(null!=r),t(null!=a);var i=r[0],o=a[0];return 0==i&&(i=(e*o+n/2)/n),0==o&&(o=(n*i+e/2)/e),0>=i||0>=o?0:(r[0]=i,a[0]=o,1)}function M(e,t){return e+(1<<t)-1>>>t}function j(e,t){return((4278255360&e)+(4278255360&t)>>>0&4278255360)+((16711935&e)+(16711935&t)>>>0&16711935)>>>0}function B(t,n){e[n]=function(n,r,a,i,o,s,c){var l;for(l=0;l<o;++l){var u=e[t](s[c+l-1],a,i+l);s[c+l]=j(n[r+l],u)}}}function z(){this.ud=this.hd=this.jd=0}function U(e,t){return((4278124286&(e^t))>>>1)+(e&t)>>>0}function W(e){return 0<=e&&256>e?e:0>e?0:255<e?255:void 0}function V(e,t){return W(e+(e-t+.5>>1))}function H(e,t,n){return Math.abs(t-n)-Math.abs(e-n)}function G(e,t,n,r,a,i,o){for(r=i[o-1],n=0;n<a;++n)i[o+n]=r=j(e[t+n],r)}function q(e,t,n,r,a){var i;for(i=0;i<n;++i){var o=e[t+i],s=o>>8&255,c=16711935&(c=(c=16711935&o)+((s<<16)+s));r[a+i]=(4278255360&o)+c>>>0}}function K(e,t){t.jd=255&e,t.hd=e>>8&255,t.ud=e>>16&255}function X(e,t,n,r,a,i){var o;for(o=0;o<r;++o){var s=t[n+o],c=s>>>8,l=s,u=255&(u=(u=s>>>16)+((e.jd<<24>>24)*(c<<24>>24)>>>5));l=255&(l=(l+=(e.hd<<24>>24)*(c<<24>>24)>>>5)+((e.ud<<24>>24)*(u<<24>>24)>>>5)),a[i+o]=(4278255360&s)+(u<<16)+l}}function Y(t,n,r,a,i){e[n]=function(e,t,n,r,o,s,c,l,u){for(r=c;r<l;++r)for(c=0;c<u;++c)o[s++]=i(n[a(e[t++])])},e[t]=function(t,n,o,s,c,l,u){var h=8>>t.b,d=t.Ea,f=t.K[0],p=t.w;if(8>h)for(t=(1<<t.b)-1,p=(1<<h)-1;n<o;++n){var m,g=0;for(m=0;m<d;++m)m&t||(g=a(s[c++])),l[u++]=i(f[g&p]),g>>=h}else e["VP8LMapColor"+r](s,c,f,p,l,u,n,o,d)}}function $(e,t,n,r,a){for(n=t+n;t<n;){var i=e[t++];r[a++]=i>>16&255,r[a++]=i>>8&255,r[a++]=255&i}}function J(e,t,n,r,a){for(n=t+n;t<n;){var i=e[t++];r[a++]=i>>16&255,r[a++]=i>>8&255,r[a++]=255&i,r[a++]=i>>24&255}}function Q(e,t,n,r,a){for(n=t+n;t<n;){var i=(o=e[t++])>>16&240|o>>12&15,o=240&o|o>>28&15;r[a++]=i,r[a++]=o}}function Z(e,t,n,r,a){for(n=t+n;t<n;){var i=(o=e[t++])>>16&248|o>>13&7,o=o>>5&224|o>>3&31;r[a++]=i,r[a++]=o}}function ee(e,t,n,r,a){for(n=t+n;t<n;){var i=e[t++];r[a++]=255&i,r[a++]=i>>8&255,r[a++]=i>>16&255}}function te(e,t,n,a,i,o){if(0==o)for(n=t+n;t<n;)_(a,((o=e[t++])[0]>>24|o[1]>>8&65280|o[2]<<8&16711680|o[3]<<24)>>>0),i+=32;else r(a,i,e,t,n)}function ne(t,n){e[n][0]=e[t+"0"],e[n][1]=e[t+"1"],e[n][2]=e[t+"2"],e[n][3]=e[t+"3"],e[n][4]=e[t+"4"],e[n][5]=e[t+"5"],e[n][6]=e[t+"6"],e[n][7]=e[t+"7"],e[n][8]=e[t+"8"],e[n][9]=e[t+"9"],e[n][10]=e[t+"10"],e[n][11]=e[t+"11"],e[n][12]=e[t+"12"],e[n][13]=e[t+"13"],e[n][14]=e[t+"0"],e[n][15]=e[t+"0"]}function re(e){return e==Vr||e==Hr||e==Gr||e==qr}function ae(){this.eb=[],this.size=this.A=this.fb=0}function ie(){this.y=[],this.f=[],this.ea=[],this.F=[],this.Tc=this.Ed=this.Cd=this.Fd=this.lb=this.Db=this.Ab=this.fa=this.J=this.W=this.N=this.O=0}function oe(){this.Rd=this.height=this.width=this.S=0,this.f={},this.f.RGBA=new ae,this.f.kb=new ie,this.sd=null}function se(){this.width=[0],this.height=[0],this.Pd=[0],this.Qd=[0],this.format=[0]}function ce(){this.Id=this.fd=this.Md=this.hb=this.ib=this.da=this.bd=this.cd=this.j=this.v=this.Da=this.Sd=this.ob=0}function le(e){return alert("todo:WebPSamplerProcessPlane"),e.T}function ue(e,t){var n=e.T,a=t.ba.f.RGBA,i=a.eb,o=a.fb+e.ka*a.A,s=va[t.ba.S],c=e.y,l=e.O,u=e.f,h=e.N,d=e.ea,f=e.W,p=t.cc,m=t.dc,g=t.Mc,v=t.Nc,b=e.ka,y=e.ka+e.T,x=e.U,w=x+1>>1;for(0==b?s(c,l,null,null,u,h,d,f,u,h,d,f,i,o,null,null,x):(s(t.ec,t.fc,c,l,p,m,g,v,u,h,d,f,i,o-a.A,i,o,x),++n);b+2<y;b+=2)p=u,m=h,g=d,v=f,h+=e.Rc,f+=e.Rc,o+=2*a.A,s(c,(l+=2*e.fa)-e.fa,c,l,p,m,g,v,u,h,d,f,i,o-a.A,i,o,x);return l+=e.fa,e.j+y<e.o?(r(t.ec,t.fc,c,l,x),r(t.cc,t.dc,u,h,w),r(t.Mc,t.Nc,d,f,w),n--):1&y||s(c,l,null,null,u,h,d,f,u,h,d,f,i,o+a.A,null,null,x),n}function he(e,n,r){var a=e.F,i=[e.J];if(null!=a){var o=e.U,s=n.ba.S,c=s==zr||s==Gr;n=n.ba.f.RGBA;var l=[0],u=e.ka;l[0]=e.T,e.Kb&&(0==u?--l[0]:(--u,i[0]-=e.width),e.j+e.ka+e.T==e.o&&(l[0]=e.o-e.j-u));var h=n.eb;u=n.fb+u*n.A,e=Cr(a,i[0],e.width,o,l,h,u+(c?0:3),n.A),t(r==l),e&&re(s)&&Sr(h,u,c,o,l,n.A)}return 0}function de(e){var t=e.ma,n=t.ba.S,r=11>n,a=n==Mr||n==Br||n==zr||n==Ur||12==n||re(n);if(t.memory=null,t.Ib=null,t.Jb=null,t.Nd=null,!Pn(t.Oa,e,a?11:12))return 0;if(a&&re(n)&&yn(),e.da)alert("todo:use_scaling");else{if(r){if(t.Ib=le,e.Kb){if(n=e.U+1>>1,t.memory=i(e.U+2*n),null==t.memory)return 0;t.ec=t.memory,t.fc=0,t.cc=t.ec,t.dc=t.fc+e.U,t.Mc=t.cc,t.Nc=t.dc+n,t.Ib=ue,yn()}}else alert("todo:EmitYUV");a&&(t.Jb=he,r&&vn())}if(r&&!Ra){for(e=0;256>e;++e)Fa[e]=89858*(e-128)+Ea>>Ca,La[e]=-22014*(e-128)+Ea,Oa[e]=-45773*(e-128),Da[e]=113618*(e-128)+Ea>>Ca;for(e=Ia;e<Ta;++e)t=76283*(e-16)+Ea>>Ca,Pa[e-Ia]=Ge(t,255),Ma[e-Ia]=Ge(t+8>>4,15);Ra=1}return 1}function fe(e){var n=e.ma,r=e.U,a=e.T;return t(!(1&e.ka)),0>=r||0>=a?0:(r=n.Ib(e,n),null!=n.Jb&&n.Jb(e,n,r),n.Dc+=r,1)}function pe(e){e.ma.memory=null}function me(e,t,n,r){return 47!=y(e,8)?0:(t[0]=y(e,14)+1,n[0]=y(e,14)+1,r[0]=y(e,1),0!=y(e,3)?0:!e.h)}function ge(e,t){if(4>e)return e+1;var n=e-2>>1;return(2+(1&e)<<n)+y(t,n)+1}function ve(e,t){return 120<t?t-120:1<=(n=((n=Qr[t-1])>>4)*e+(8-(15&n)))?n:1;var n}function be(e,t,n){var r=k(n),a=e[t+=255&r].g-8;return 0<a&&(N(n,n.u+8),r=k(n),t+=e[t].value,t+=r&(1<<a)-1),N(n,n.u+e[t].g),e[t].value}function ye(e,n,r){return r.g+=e.g,r.value+=e.value<<n>>>0,t(8>=r.g),e.g}function xe(e,n,r){var a=e.xc;return t((n=0==a?0:e.vc[e.md*(r>>a)+(n>>a)])<e.Wb),e.Ya[n]}function we(e,n,a,i){var o=e.ab,s=e.c*n,c=e.C;n=c+n;var l=a,u=i;for(i=e.Ta,a=e.Ua;0<o--;){var h=e.gc[o],d=c,f=n,p=l,m=u,g=(u=i,l=a,h.Ea);switch(t(d<f),t(f<=h.nc),h.hc){case 2:Kn(p,m,(f-d)*g,u,l);break;case 0:var v=d,b=f,y=u,x=l,w=(E=h).Ea;0==v&&(Gn(p,m,null,null,1,y,x),G(p,m+1,0,0,w-1,y,x+1),m+=w,x+=w,++v);for(var k=1<<E.b,S=k-1,N=M(w,E.b),C=E.K,E=E.w+(v>>E.b)*N;v<b;){var I=C,T=E,_=1;for(qn(p,m,y,x-w,1,y,x);_<w;){var A=(_&~S)+k;A>w&&(A=w),(0,Qn[I[T++]>>8&15])(p,m+ +_,y,x+_-w,A-_,y,x+_),_=A}m+=w,x+=w,++v&S||(E+=N)}f!=h.nc&&r(u,l-g,u,l+(f-d-1)*g,g);break;case 1:for(g=p,b=m,w=(p=h.Ea)-(x=p&~(y=(m=1<<h.b)-1)),v=M(p,h.b),k=h.K,h=h.w+(d>>h.b)*v;d<f;){for(S=k,N=h,C=new z,E=b+x,I=b+p;b<E;)K(S[N++],C),Zn(C,g,b,m,u,l),b+=m,l+=m;b<I&&(K(S[N++],C),Zn(C,g,b,w,u,l),b+=w,l+=w),++d&y||(h+=v)}break;case 3:if(p==u&&m==l&&0<h.b){for(b=u,p=g=l+(f-d)*g-(x=(f-d)*M(h.Ea,h.b)),m=u,y=l,v=[],x=(w=x)-1;0<=x;--x)v[x]=m[y+x];for(x=w-1;0<=x;--x)b[p+x]=v[x];Xn(h,d,f,u,g,u,l)}else Xn(h,d,f,p,m,u,l)}l=i,u=a}u!=a&&r(i,a,l,u,s)}function ke(e,n){var r=e.V,a=e.Ba+e.c*e.C,i=n-e.C;if(t(n<=e.l.o),t(16>=i),0<i){var o=e.l,s=e.Ta,c=e.Ua,l=o.width;if(we(e,i,r,a),i=c=[c],t((r=e.C)<(a=n)),t(o.v<o.va),a>o.o&&(a=o.o),r<o.j){var u=o.j-r;r=o.j,i[0]+=u*l}if(r>=a?r=0:(i[0]+=4*o.v,o.ka=r-o.j,o.U=o.va-o.v,o.T=a-r,r=1),r){if(c=c[0],11>(r=e.ca).S){var h=r.f.RGBA,d=(a=r.S,i=o.U,o=o.T,u=h.eb,h.A),f=o;for(h=h.fb+e.Ma*h.A;0<f--;){var p=s,m=c,g=i,v=u,b=h;switch(a){case Pr:er(p,m,g,v,b);break;case Mr:tr(p,m,g,v,b);break;case Vr:tr(p,m,g,v,b),Sr(v,b,0,g,1,0);break;case jr:ar(p,m,g,v,b);break;case Br:te(p,m,g,v,b,1);break;case Hr:te(p,m,g,v,b,1),Sr(v,b,0,g,1,0);break;case zr:te(p,m,g,v,b,0);break;case Gr:te(p,m,g,v,b,0),Sr(v,b,1,g,1,0);break;case Ur:nr(p,m,g,v,b);break;case qr:nr(p,m,g,v,b),Nr(v,b,g,1,0);break;case Wr:rr(p,m,g,v,b);break;default:t(0)}c+=l,h+=d}e.Ma+=o}else alert("todo:EmitRescaledRowsYUVA");t(e.Ma<=r.height)}}e.C=n,t(e.C<=e.i)}function Se(e){var t;if(0<e.ua)return 0;for(t=0;t<e.Wb;++t){var n=e.Ya[t].G,r=e.Ya[t].H;if(0<n[1][r[1]+0].g||0<n[2][r[2]+0].g||0<n[3][r[3]+0].g)return 0}return 1}function Ne(e,n,r,a,i,o){if(0!=e.Z){var s=e.qd,c=e.rd;for(t(null!=ga[e.Z]);n<r;++n)ga[e.Z](s,c,a,i,a,i,o),s=a,c=i,i+=o;e.qd=s,e.rd=c}}function Ce(e,n){var r=e.l.ma,a=0==r.Z||1==r.Z?e.l.j:e.C;if(a=e.C<a?a:e.C,t(n<=e.l.o),n>a){var i=e.l.width,o=r.ca,s=r.tb+i*a,c=e.V,l=e.Ba+e.c*a,u=e.gc;t(1==e.ab),t(3==u[0].hc),$n(u[0],a,n,c,l,o,s),Ne(r,a,n,o,s,i)}e.C=e.Ma=n}function Ee(e,n,r,a,i,o,s){var c=e.$/a,l=e.$%a,u=e.m,h=e.s,d=r+e.$,f=d;i=r+a*i;var p=r+a*o,m=280+h.ua,g=e.Pb?c:16777216,v=0<h.ua?h.Wa:null,b=h.wc,y=d<p?xe(h,l,c):null;t(e.C<o),t(p<=i);var x=!1;e:for(;;){for(;x||d<p;){var w=0;if(c>=g){var E=d-r;t((g=e).Pb),g.wd=g.m,g.xd=E,0<g.s.ua&&O(g.s.Wa,g.s.vb),g=c+ea}if(l&b||(y=xe(h,l,c)),t(null!=y),y.Qb&&(n[d]=y.qb,x=!0),!x)if(C(u),y.jc){w=u,E=n;var I=d,T=y.pd[k(w)&Bn-1];t(y.jc),256>T.g?(N(w,w.u+T.g),E[I]=T.value,w=0):(N(w,w.u+T.g-256),t(256<=T.value),w=T.value),0==w&&(x=!0)}else w=be(y.G[0],y.H[0],u);if(u.h)break;if(x||256>w){if(!x)if(y.nd)n[d]=(y.qb|w<<8)>>>0;else{if(C(u),x=be(y.G[1],y.H[1],u),C(u),E=be(y.G[2],y.H[2],u),I=be(y.G[3],y.H[3],u),u.h)break;n[d]=(I<<24|x<<16|w<<8|E)>>>0}if(x=!1,++d,++l>=a&&(l=0,++c,null!=s&&c<=o&&!(c%16)&&s(e,c),null!=v))for(;f<d;)w=n[f++],v.X[(506832829*w&4294967295)>>>v.Mb]=w}else if(280>w){if(w=ge(w-256,u),E=be(y.G[4],y.H[4],u),C(u),E=ve(a,E=ge(E,u)),u.h)break;if(d-r<E||i-d<w)break e;for(I=0;I<w;++I)n[d+I]=n[d+I-E];for(d+=w,l+=w;l>=a;)l-=a,++c,null!=s&&c<=o&&!(c%16)&&s(e,c);if(t(d<=i),l&b&&(y=xe(h,l,c)),null!=v)for(;f<d;)w=n[f++],v.X[(506832829*w&4294967295)>>>v.Mb]=w}else{if(!(w<m))break e;for(x=w-280,t(null!=v);f<d;)w=n[f++],v.X[(506832829*w&4294967295)>>>v.Mb]=w;w=d,t(!(x>>>(E=v).Xa)),n[w]=E.X[x],x=!0}x||t(u.h==S(u))}if(e.Pb&&u.h&&d<i)t(e.m.h),e.a=5,e.m=e.wd,e.$=e.xd,0<e.s.ua&&O(e.s.vb,e.s.Wa);else{if(u.h)break e;null!=s&&s(e,c>o?o:c),e.a=0,e.$=d-r}return 1}return e.a=3,0}function Ie(e){t(null!=e),e.vc=null,e.yc=null,e.Ya=null;var n=e.Wa;null!=n&&(n.X=null),e.vb=null,t(null!=e)}function Te(){var t=new sn;return null==t?null:(t.a=0,t.xb=ma,ne("Predictor","VP8LPredictors"),ne("Predictor","VP8LPredictors_C"),ne("PredictorAdd","VP8LPredictorsAdd"),ne("PredictorAdd","VP8LPredictorsAdd_C"),Kn=q,Zn=X,er=$,tr=J,nr=Q,rr=Z,ar=ee,e.VP8LMapColor32b=Yn,e.VP8LMapColor8b=Jn,t)}function _e(e,n,r,s,c){var l=1,d=[e],p=[n],m=s.m,g=s.s,v=null,b=0;e:for(;;){if(r)for(;l&&y(m,1);){var x=d,w=p,S=s,E=1,I=S.m,T=S.gc[S.ab],_=y(I,2);if(S.Oc&1<<_)l=0;else{switch(S.Oc|=1<<_,T.hc=_,T.Ea=x[0],T.nc=w[0],T.K=[null],++S.ab,t(4>=S.ab),_){case 0:case 1:T.b=y(I,3)+2,E=_e(M(T.Ea,T.b),M(T.nc,T.b),0,S,T.K),T.K=T.K[0];break;case 3:var A,R=y(I,8)+1,F=16<R?0:4<R?1:2<R?2:3;if(x[0]=M(T.Ea,F),T.b=F,A=E=_e(R,1,0,S,T.K)){var O,L=R,P=T,B=1<<(8>>P.b),z=i(B);if(null==z)A=0;else{var U=P.K[0],W=P.w;for(z[0]=P.K[0][0],O=1;O<1*L;++O)z[O]=j(U[W+O],z[O-1]);for(;O<4*B;++O)z[O]=0;P.K[0]=null,P.K[0]=z,A=1}}E=A;break;case 2:break;default:t(0)}l=E}}if(d=d[0],p=p[0],l&&y(m,1)&&!(l=1<=(b=y(m,4))&&11>=b)){s.a=3;break e}var V;if(V=l)t:{var H,G,q,K=s,X=d,Y=p,$=b,J=r,Q=K.m,Z=K.s,ee=[null],te=1,ne=0,re=Zr[$];n:for(;;){if(J&&y(Q,1)){var ae=y(Q,3)+2,ie=M(X,ae),oe=M(Y,ae),se=ie*oe;if(!_e(ie,oe,0,K,ee))break n;for(ee=ee[0],Z.xc=ae,H=0;H<se;++H){var ce=ee[H]>>8&65535;ee[H]=ce,ce>=te&&(te=ce+1)}}if(Q.h)break n;for(G=0;5>G;++G){var le=Yr[G];!G&&0<$&&(le+=1<<$),ne<le&&(ne=le)}var ue=o(te*re,h),he=te,de=o(he,f);if(null==de)var fe=null;else t(65536>=he),fe=de;var pe=i(ne);if(null==fe||null==pe||null==ue){K.a=1;break n}var me=ue;for(H=q=0;H<te;++H){var ge=fe[H],ve=ge.G,be=ge.H,xe=0,we=1,ke=0;for(G=0;5>G;++G){le=Yr[G],ve[G]=me,be[G]=q,!G&&0<$&&(le+=1<<$);r:{var Se,Ne=le,Ce=K,Te=pe,Ae=me,Re=q,Fe=0,De=Ce.m,Oe=y(De,1);if(a(Te,0,0,Ne),Oe){var Le=y(De,1)+1,Pe=y(De,1),Me=y(De,0==Pe?1:8);Te[Me]=1,2==Le&&(Te[Me=y(De,8)]=1);var je=1}else{var Be=i(19),ze=y(De,4)+4;if(19<ze){Ce.a=3;var Ue=0;break r}for(Se=0;Se<ze;++Se)Be[Jr[Se]]=y(De,3);var We=void 0,Ve=void 0,He=Ce,Ge=Be,qe=Ne,Ke=Te,Xe=0,Ye=He.m,$e=8,Je=o(128,h);a:for(;u(Je,0,7,Ge,19);){if(y(Ye,1)){var Qe=2+2*y(Ye,3);if((We=2+y(Ye,Qe))>qe)break a}else We=qe;for(Ve=0;Ve<qe&&We--;){C(Ye);var Ze=Je[0+(127&k(Ye))];N(Ye,Ye.u+Ze.g);var et=Ze.value;if(16>et)Ke[Ve++]=et,0!=et&&($e=et);else{var tt=16==et,nt=et-16,rt=Xr[nt],at=y(Ye,Kr[nt])+rt;if(Ve+at>qe)break a;for(var it=tt?$e:0;0<at--;)Ke[Ve++]=it}}Xe=1;break a}Xe||(He.a=3),je=Xe}(je=je&&!De.h)&&(Fe=u(Ae,Re,8,Te,Ne)),je&&0!=Fe?Ue=Fe:(Ce.a=3,Ue=0)}if(0==Ue)break n;if(we&&1==$r[G]&&(we=0==me[q].g),xe+=me[q].g,q+=Ue,3>=G){var ot,st=pe[0];for(ot=1;ot<le;++ot)pe[ot]>st&&(st=pe[ot]);ke+=st}}if(ge.nd=we,ge.Qb=0,we&&(ge.qb=(ve[3][be[3]+0].value<<24|ve[1][be[1]+0].value<<16|ve[2][be[2]+0].value)>>>0,0==xe&&256>ve[0][be[0]+0].value&&(ge.Qb=1,ge.qb+=ve[0][be[0]+0].value<<8)),ge.jc=!ge.Qb&&6>ke,ge.jc){var ct,lt=ge;for(ct=0;ct<Bn;++ct){var ut=ct,ht=lt.pd[ut],dt=lt.G[0][lt.H[0]+ut];256<=dt.value?(ht.g=dt.g+256,ht.value=dt.value):(ht.g=0,ht.value=0,ut>>=ye(dt,8,ht),ut>>=ye(lt.G[1][lt.H[1]+ut],16,ht),ut>>=ye(lt.G[2][lt.H[2]+ut],0,ht),ye(lt.G[3][lt.H[3]+ut],24,ht))}}}Z.vc=ee,Z.Wb=te,Z.Ya=fe,Z.yc=ue,V=1;break t}V=0}if(!(l=V)){s.a=3;break e}if(0<b){if(g.ua=1<<b,!D(g.Wa,b)){s.a=1,l=0;break e}}else g.ua=0;var ft=s,pt=d,mt=p,gt=ft.s,vt=gt.xc;if(ft.c=pt,ft.i=mt,gt.md=M(pt,vt),gt.wc=0==vt?-1:(1<<vt)-1,r){s.xb=pa;break e}if(null==(v=i(d*p))){s.a=1,l=0;break e}l=(l=Ee(s,v,0,d,p,p,null))&&!m.h;break e}return l?(null!=c?c[0]=v:(t(null==v),t(r)),s.$=0,r||Ie(g)):Ie(g),l}function Ae(e,n){var r=e.c*e.i,a=r+n+16*n;return t(e.c<=n),e.V=i(a),null==e.V?(e.Ta=null,e.Ua=0,e.a=1,0):(e.Ta=e.V,e.Ua=e.Ba+r+n,1)}function Re(e,n){var r=e.C,a=n-r,i=e.V,o=e.Ba+e.c*r;for(t(n<=e.l.o);0<a;){var s=16<a?16:a,c=e.l.ma,l=e.l.width,u=l*s,h=c.ca,d=c.tb+l*r,f=e.Ta,p=e.Ua;we(e,s,i,o),Er(f,p,h,d,u),Ne(c,r,r+s,h,d,l),a-=s,i+=s*e.c,r+=s}t(r==n),e.C=e.Ma=n}function Fe(){this.ub=this.yd=this.td=this.Rb=0}function De(){this.Kd=this.Ld=this.Ud=this.Td=this.i=this.c=0}function Oe(){this.Fb=this.Bb=this.Cb=0,this.Zb=i(4),this.Lb=i(4)}function Le(){this.Yb=function(){var e=[];return function e(t,n,r){for(var a=r[n],i=0;i<a&&(t.push(r.length>n+1?[]:0),!(r.length<n+1));i++)e(t[i],n+1,r)}(e,0,[3,11]),e}()}function Pe(){this.jb=i(3),this.Wc=s([4,8],Le),this.Xc=s([4,17],Le)}function Me(){this.Pc=this.wb=this.Tb=this.zd=0,this.vd=new i(4),this.od=new i(4)}function je(){this.ld=this.La=this.dd=this.tc=0}function Be(){this.Na=this.la=0}function ze(){this.Sc=[0,0],this.Eb=[0,0],this.Qc=[0,0],this.ia=this.lc=0}function Ue(){this.ad=i(384),this.Za=0,this.Ob=i(16),this.$b=this.Ad=this.ia=this.Gc=this.Hc=this.Dd=0}function We(){this.uc=this.M=this.Nb=0,this.wa=Array(new je),this.Y=0,this.ya=Array(new Ue),this.aa=0,this.l=new qe}function Ve(){this.y=i(16),this.f=i(8),this.ea=i(8)}function He(){this.cb=this.a=0,this.sc="",this.m=new x,this.Od=new Fe,this.Kc=new De,this.ed=new Me,this.Qa=new Oe,this.Ic=this.$c=this.Aa=0,this.D=new We,this.Xb=this.Va=this.Hb=this.zb=this.yb=this.Ub=this.za=0,this.Jc=o(8,x),this.ia=0,this.pb=o(4,ze),this.Pa=new Pe,this.Bd=this.kc=0,this.Ac=[],this.Bc=0,this.zc=[0,0,0,0],this.Gd=Array(new Ve),this.Hd=0,this.rb=Array(new Be),this.sb=0,this.wa=Array(new je),this.Y=0,this.oc=[],this.pc=0,this.sa=[],this.ta=0,this.qa=[],this.ra=0,this.Ha=[],this.B=this.R=this.Ia=0,this.Ec=[],this.M=this.ja=this.Vb=this.Fc=0,this.ya=Array(new Ue),this.L=this.aa=0,this.gd=s([4,2],je),this.ga=null,this.Fa=[],this.Cc=this.qc=this.P=0,this.Gb=[],this.Uc=0,this.mb=[],this.nb=0,this.rc=[],this.Ga=this.Vc=0}function Ge(e,t){return 0>e?0:e>t?t:e}function qe(){this.T=this.U=this.ka=this.height=this.width=0,this.y=[],this.f=[],this.ea=[],this.Rc=this.fa=this.W=this.N=this.O=0,this.ma="void",this.put="VP8IoPutHook",this.ac="VP8IoSetupHook",this.bc="VP8IoTeardownHook",this.ha=this.Kb=0,this.data=[],this.hb=this.ib=this.da=this.o=this.j=this.va=this.v=this.Da=this.ob=this.w=0,this.F=[],this.J=0}function Ke(){var e=new He;return null!=e&&(e.a=0,e.sc="OK",e.cb=0,e.Xb=0,ra||(ra=Je)),e}function Xe(e,t,n){return 0==e.a&&(e.a=t,e.sc=n,e.cb=0),0}function Ye(e,t,n){return 3<=n&&157==e[t+0]&&1==e[t+1]&&42==e[t+2]}function $e(e,n){if(null==e)return 0;if(e.a=0,e.sc="OK",null==n)return Xe(e,2,"null VP8Io passed to VP8GetHeaders()");var r=n.data,i=n.w,o=n.ha;if(4>o)return Xe(e,7,"Truncated header.");var s=r[i+0]|r[i+1]<<8|r[i+2]<<16,c=e.Od;if(c.Rb=!(1&s),c.td=s>>1&7,c.yd=s>>4&1,c.ub=s>>5,3<c.td)return Xe(e,3,"Incorrect keyframe parameters.");if(!c.yd)return Xe(e,4,"Frame not displayable.");i+=3,o-=3;var l=e.Kc;if(c.Rb){if(7>o)return Xe(e,7,"cannot parse picture header");if(!Ye(r,i,o))return Xe(e,3,"Bad code word");l.c=16383&(r[i+4]<<8|r[i+3]),l.Td=r[i+4]>>6,l.i=16383&(r[i+6]<<8|r[i+5]),l.Ud=r[i+6]>>6,i+=7,o-=7,e.za=l.c+15>>4,e.Ub=l.i+15>>4,n.width=l.c,n.height=l.i,n.Da=0,n.j=0,n.v=0,n.va=n.width,n.o=n.height,n.da=0,n.ib=n.width,n.hb=n.height,n.U=n.width,n.T=n.height,a((s=e.Pa).jb,0,255,s.jb.length),t(null!=(s=e.Qa)),s.Cb=0,s.Bb=0,s.Fb=1,a(s.Zb,0,0,s.Zb.length),a(s.Lb,0,0,s.Lb)}if(c.ub>o)return Xe(e,7,"bad partition length");p(s=e.m,r,i,c.ub),i+=c.ub,o-=c.ub,c.Rb&&(l.Ld=I(s),l.Kd=I(s)),l=e.Qa;var u,h=e.Pa;if(t(null!=s),t(null!=l),l.Cb=I(s),l.Cb){if(l.Bb=I(s),I(s)){for(l.Fb=I(s),u=0;4>u;++u)l.Zb[u]=I(s)?g(s,7):0;for(u=0;4>u;++u)l.Lb[u]=I(s)?g(s,6):0}if(l.Bb)for(u=0;3>u;++u)h.jb[u]=I(s)?m(s,8):255}else l.Bb=0;if(s.Ka)return Xe(e,3,"cannot parse segment header");if((l=e.ed).zd=I(s),l.Tb=m(s,6),l.wb=m(s,3),l.Pc=I(s),l.Pc&&I(s)){for(h=0;4>h;++h)I(s)&&(l.vd[h]=g(s,6));for(h=0;4>h;++h)I(s)&&(l.od[h]=g(s,6))}if(e.L=0==l.Tb?0:l.zd?1:2,s.Ka)return Xe(e,3,"cannot parse filter header");var d=o;if(o=u=i,i=u+d,l=d,e.Xb=(1<<m(e.m,2))-1,d<3*(h=e.Xb))r=7;else{for(u+=3*h,l-=3*h,d=0;d<h;++d){var f=r[o+0]|r[o+1]<<8|r[o+2]<<16;f>l&&(f=l),p(e.Jc[+d],r,u,f),u+=f,l-=f,o+=3}p(e.Jc[+h],r,u,l),r=u<i?0:5}if(0!=r)return Xe(e,r,"cannot parse partitions");for(r=m(u=e.m,7),o=I(u)?g(u,4):0,i=I(u)?g(u,4):0,l=I(u)?g(u,4):0,h=I(u)?g(u,4):0,u=I(u)?g(u,4):0,d=e.Qa,f=0;4>f;++f){if(d.Cb){var v=d.Zb[f];d.Fb||(v+=r)}else{if(0<f){e.pb[f]=e.pb[0];continue}v=r}var b=e.pb[f];b.Sc[0]=ta[Ge(v+o,127)],b.Sc[1]=na[Ge(v+0,127)],b.Eb[0]=2*ta[Ge(v+i,127)],b.Eb[1]=101581*na[Ge(v+l,127)]>>16,8>b.Eb[1]&&(b.Eb[1]=8),b.Qc[0]=ta[Ge(v+h,117)],b.Qc[1]=na[Ge(v+u,127)],b.lc=v+u}if(!c.Rb)return Xe(e,4,"Not a key frame.");for(I(s),c=e.Pa,r=0;4>r;++r){for(o=0;8>o;++o)for(i=0;3>i;++i)for(l=0;11>l;++l)h=T(s,la[r][o][i][l])?m(s,8):sa[r][o][i][l],c.Wc[r][o].Yb[i][l]=h;for(o=0;17>o;++o)c.Xc[r][o]=c.Wc[r][ua[o]]}return e.kc=I(s),e.kc&&(e.Bd=m(s,8)),e.cb=1}function Je(e,t,n,r,a,i,o){var s=t[a].Yb[n];for(n=0;16>a;++a){if(!T(e,s[n+0]))return a;for(;!T(e,s[n+1]);)if(s=t[++a].Yb[0],n=0,16==a)return 16;var c=t[a+1].Yb;if(T(e,s[n+2])){var l=e,u=0;if(T(l,(d=s)[(h=n)+3]))if(T(l,d[h+6])){for(s=0,h=2*(u=T(l,d[h+8]))+(d=T(l,d[h+9+u])),u=0,d=aa[h];d[s];++s)u+=u+T(l,d[s]);u+=3+(8<<h)}else T(l,d[h+7])?(u=7+2*T(l,165),u+=T(l,145)):u=5+T(l,159);else u=T(l,d[h+4])?3+T(l,d[h+5]):2;s=c[2]}else u=1,s=c[1];c=o+ia[a],0>(l=e).b&&E(l);var h,d=l.b,f=(h=l.Ca>>1)-(l.I>>d)>>31;--l.b,l.Ca+=f,l.Ca|=1,l.I-=(h+1&f)<<d,i[c]=((u^f)-f)*r[(0<a)+0]}return 16}function Qe(e){var t=e.rb[e.sb-1];t.la=0,t.Na=0,a(e.zc,0,0,e.zc.length),e.ja=0}function Ze(e,n){if(null==e)return 0;if(null==n)return Xe(e,2,"NULL VP8Io parameter in VP8Decode().");if(!e.cb&&!$e(e,n))return 0;if(t(e.cb),null==n.ac||n.ac(n)){n.ob&&(e.L=0);var s=Ba[e.L];if(2==e.L?(e.yb=0,e.zb=0):(e.yb=n.v-s>>4,e.zb=n.j-s>>4,0>e.yb&&(e.yb=0),0>e.zb&&(e.zb=0)),e.Va=n.o+15+s>>4,e.Hb=n.va+15+s>>4,e.Hb>e.za&&(e.Hb=e.za),e.Va>e.Ub&&(e.Va=e.Ub),0<e.L){var c=e.ed;for(s=0;4>s;++s){var l;if(e.Qa.Cb){var u=e.Qa.Lb[s];e.Qa.Fb||(u+=c.Tb)}else u=c.Tb;for(l=0;1>=l;++l){var h=e.gd[s][l],d=u;if(c.Pc&&(d+=c.vd[0],l&&(d+=c.od[0])),0<(d=0>d?0:63<d?63:d)){var f=d;0<c.wb&&(f=4<c.wb?f>>2:f>>1)>9-c.wb&&(f=9-c.wb),1>f&&(f=1),h.dd=f,h.tc=2*d+f,h.ld=40<=d?2:15<=d?1:0}else h.tc=0;h.La=l}}}s=0}else Xe(e,6,"Frame setup failed"),s=e.a;if(s=0==s){if(s){e.$c=0,0<e.Aa||(e.Ic=Ua);e:{s=e.Ic,c=4*(f=e.za);var p=32*f,m=f+1,g=0<e.L?f*(0<e.Aa?2:1):0,v=(2==e.Aa?2:1)*f;if((h=c+832+(l=3*(16*s+Ba[e.L])/2*p)+(u=null!=e.Fa&&0<e.Fa.length?e.Kc.c*e.Kc.i:0))!=h)s=0;else{if(h>e.Vb){if(e.Vb=0,e.Ec=i(h),e.Fc=0,null==e.Ec){s=Xe(e,1,"no memory during frame initialization.");break e}e.Vb=h}h=e.Ec,d=e.Fc,e.Ac=h,e.Bc=d,d+=c,e.Gd=o(p,Ve),e.Hd=0,e.rb=o(m+1,Be),e.sb=1,e.wa=g?o(g,je):null,e.Y=0,e.D.Nb=0,e.D.wa=e.wa,e.D.Y=e.Y,0<e.Aa&&(e.D.Y+=f),t(!0),e.oc=h,e.pc=d,d+=832,e.ya=o(v,Ue),e.aa=0,e.D.ya=e.ya,e.D.aa=e.aa,2==e.Aa&&(e.D.aa+=f),e.R=16*f,e.B=8*f,f=(p=Ba[e.L])*e.R,p=p/2*e.B,e.sa=h,e.ta=d+f,e.qa=e.sa,e.ra=e.ta+16*s*e.R+p,e.Ha=e.qa,e.Ia=e.ra+8*s*e.B+p,e.$c=0,d+=l,e.mb=u?h:null,e.nb=u?d:null,t(d+u<=e.Fc+e.Vb),Qe(e),a(e.Ac,e.Bc,0,c),s=1}}if(s){if(n.ka=0,n.y=e.sa,n.O=e.ta,n.f=e.qa,n.N=e.ra,n.ea=e.Ha,n.Vd=e.Ia,n.fa=e.R,n.Rc=e.B,n.F=null,n.J=0,!Rr){for(s=-255;255>=s;++s)Ir[255+s]=0>s?-s:s;for(s=-1020;1020>=s;++s)Tr[1020+s]=-128>s?-128:127<s?127:s;for(s=-112;112>=s;++s)_r[112+s]=-16>s?-16:15<s?15:s;for(s=-255;510>=s;++s)Ar[255+s]=0>s?0:255<s?255:s;Rr=1}ir=lt,or=it,cr=ot,lr=st,ur=ct,sr=at,hr=Xt,dr=Yt,fr=Qt,pr=Zt,mr=$t,gr=Jt,vr=en,br=tn,yr=Wt,xr=Vt,wr=Ht,kr=Gt,da[0]=Nt,da[1]=ht,da[2]=kt,da[3]=St,da[4]=Ct,da[5]=It,da[6]=Et,da[7]=Tt,da[8]=At,da[9]=_t,ha[0]=vt,ha[1]=ft,ha[2]=pt,ha[3]=mt,ha[4]=bt,ha[5]=yt,ha[6]=xt,fa[0]=Ot,fa[1]=dt,fa[2]=Rt,fa[3]=Ft,fa[4]=Pt,fa[5]=Lt,fa[6]=Mt,s=1}else s=0}s&&(s=function(e,n){for(e.M=0;e.M<e.Va;++e.M){var o,s=e.Jc[e.M&e.Xb],c=e.m,l=e;for(o=0;o<l.za;++o){var u=c,h=l,d=h.Ac,f=h.Bc+4*o,p=h.zc,m=h.ya[h.aa+o];if(h.Qa.Bb?m.$b=T(u,h.Pa.jb[0])?2+T(u,h.Pa.jb[2]):T(u,h.Pa.jb[1]):m.$b=0,h.kc&&(m.Ad=T(u,h.Bd)),m.Za=!T(u,145)+0,m.Za){var g=m.Ob,v=0;for(h=0;4>h;++h){var b,y=p[0+h];for(b=0;4>b;++b){y=ca[d[f+b]][y];for(var x=oa[T(u,y[0])];0<x;)x=oa[2*x+T(u,y[x])];y=-x,d[f+b]=y}r(g,v,d,f,4),v+=4,p[0+h]=y}}else y=T(u,156)?T(u,128)?1:3:T(u,163)?2:0,m.Ob[0]=y,a(d,f,y,4),a(p,0,y,4);m.Dd=T(u,142)?T(u,114)?T(u,183)?1:3:2:0}if(l.m.Ka)return Xe(e,7,"Premature end-of-partition0 encountered.");for(;e.ja<e.za;++e.ja){if(l=s,u=(c=e).rb[c.sb-1],d=c.rb[c.sb+c.ja],o=c.ya[c.aa+c.ja],f=c.kc?o.Ad:0)u.la=d.la=0,o.Za||(u.Na=d.Na=0),o.Hc=0,o.Gc=0,o.ia=0;else{var w,k;if(u=d,d=l,f=c.Pa.Xc,p=c.ya[c.aa+c.ja],m=c.pb[p.$b],h=p.ad,g=0,v=c.rb[c.sb-1],y=b=0,a(h,g,0,384),p.Za)var S=0,N=f[3];else{x=i(16);var C=u.Na+v.Na;if(C=ra(d,f[1],C,m.Eb,0,x,0),u.Na=v.Na=(0<C)+0,1<C)ir(x,0,h,g);else{var E=x[0]+3>>3;for(x=0;256>x;x+=16)h[g+x]=E}S=1,N=f[0]}var I=15&u.la,_=15&v.la;for(x=0;4>x;++x){var A=1&_;for(E=k=0;4>E;++E)I=I>>1|(A=(C=ra(d,N,C=A+(1&I),m.Sc,S,h,g))>S)<<7,k=k<<2|(3<C?3:1<C?2:0!=h[g+0]),g+=16;I>>=4,_=_>>1|A<<7,b=(b<<8|k)>>>0}for(N=I,S=_>>4,w=0;4>w;w+=2){for(k=0,I=u.la>>4+w,_=v.la>>4+w,x=0;2>x;++x){for(A=1&_,E=0;2>E;++E)C=A+(1&I),I=I>>1|(A=0<(C=ra(d,f[2],C,m.Qc,0,h,g)))<<3,k=k<<2|(3<C?3:1<C?2:0!=h[g+0]),g+=16;I>>=2,_=_>>1|A<<5}y|=k<<4*w,N|=I<<4<<w,S|=(240&_)<<w}u.la=N,v.la=S,p.Hc=b,p.Gc=y,p.ia=43690&y?0:m.ia,f=!(b|y)}if(0<c.L&&(c.wa[c.Y+c.ja]=c.gd[o.$b][o.Za],c.wa[c.Y+c.ja].La|=!f),l.Ka)return Xe(e,7,"Premature end-of-file encountered.")}if(Qe(e),c=n,l=1,o=(s=e).D,u=0<s.L&&s.M>=s.zb&&s.M<=s.Va,0==s.Aa)e:{if(o.M=s.M,o.uc=u,On(s,o),l=1,o=(k=s.D).Nb,u=(y=Ba[s.L])*s.R,d=y/2*s.B,x=16*o*s.R,E=8*o*s.B,f=s.sa,p=s.ta-u+x,m=s.qa,h=s.ra-d+E,g=s.Ha,v=s.Ia-d+E,_=0==(I=k.M),b=I>=s.Va-1,2==s.Aa&&On(s,k),k.uc)for(A=(C=s).D.M,t(C.D.uc),k=C.yb;k<C.Hb;++k){S=k,N=A;var R=(F=(U=C).D).Nb;w=U.R;var F=F.wa[F.Y+S],D=U.sa,O=U.ta+16*R*w+16*S,L=F.dd,P=F.tc;if(0!=P)if(t(3<=P),1==U.L)0<S&&xr(D,O,w,P+4),F.La&&kr(D,O,w,P),0<N&&yr(D,O,w,P+4),F.La&&wr(D,O,w,P);else{var M=U.B,j=U.qa,B=U.ra+8*R*M+8*S,z=U.Ha,U=U.Ia+8*R*M+8*S;R=F.ld,0<S&&(dr(D,O,w,P+4,L,R),pr(j,B,z,U,M,P+4,L,R)),F.La&&(gr(D,O,w,P,L,R),br(j,B,z,U,M,P,L,R)),0<N&&(hr(D,O,w,P+4,L,R),fr(j,B,z,U,M,P+4,L,R)),F.La&&(mr(D,O,w,P,L,R),vr(j,B,z,U,M,P,L,R))}}if(s.ia&&alert("todo:DitherRow"),null!=c.put){if(k=16*I,I=16*(I+1),_?(c.y=s.sa,c.O=s.ta+x,c.f=s.qa,c.N=s.ra+E,c.ea=s.Ha,c.W=s.Ia+E):(k-=y,c.y=f,c.O=p,c.f=m,c.N=h,c.ea=g,c.W=v),b||(I-=y),I>c.o&&(I=c.o),c.F=null,c.J=null,null!=s.Fa&&0<s.Fa.length&&k<I&&(c.J=dn(s,c,k,I-k),c.F=s.mb,null==c.F&&0==c.F.length)){l=Xe(s,3,"Could not decode alpha data.");break e}k<c.j&&(y=c.j-k,k=c.j,t(!(1&y)),c.O+=s.R*y,c.N+=s.B*(y>>1),c.W+=s.B*(y>>1),null!=c.F&&(c.J+=c.width*y)),k<I&&(c.O+=c.v,c.N+=c.v>>1,c.W+=c.v>>1,null!=c.F&&(c.J+=c.v),c.ka=k-c.j,c.U=c.va-c.v,c.T=I-k,l=c.put(c))}o+1!=s.Ic||b||(r(s.sa,s.ta-u,f,p+16*s.R,u),r(s.qa,s.ra-d,m,h+8*s.B,d),r(s.Ha,s.Ia-d,g,v+8*s.B,d))}if(!l)return Xe(e,6,"Output aborted.")}return 1}(e,n)),null!=n.bc&&n.bc(n),s&=1}return s?(e.cb=0,s):0}function et(e,t,n,r,a){a=e[t+n+32*r]+(a>>3),e[t+n+32*r]=-256&a?0>a?0:255:a}function tt(e,t,n,r,a,i){et(e,t,0,n,r+a),et(e,t,1,n,r+i),et(e,t,2,n,r-i),et(e,t,3,n,r-a)}function nt(e){return(20091*e>>16)+e}function rt(e,t,n,r){var a,o=0,s=i(16);for(a=0;4>a;++a){var c=e[t+0]+e[t+8],l=e[t+0]-e[t+8],u=(35468*e[t+4]>>16)-nt(e[t+12]),h=nt(e[t+4])+(35468*e[t+12]>>16);s[o+0]=c+h,s[o+1]=l+u,s[o+2]=l-u,s[o+3]=c-h,o+=4,t++}for(a=o=0;4>a;++a)c=(e=s[o+0]+4)+s[o+8],l=e-s[o+8],u=(35468*s[o+4]>>16)-nt(s[o+12]),et(n,r,0,0,c+(h=nt(s[o+4])+(35468*s[o+12]>>16))),et(n,r,1,0,l+u),et(n,r,2,0,l-u),et(n,r,3,0,c-h),o++,r+=32}function at(e,t,n,r){var a=e[t+0]+4,i=35468*e[t+4]>>16,o=nt(e[t+4]),s=35468*e[t+1]>>16;tt(n,r,0,a+o,e=nt(e[t+1]),s),tt(n,r,1,a+i,e,s),tt(n,r,2,a-i,e,s),tt(n,r,3,a-o,e,s)}function it(e,t,n,r,a){rt(e,t,n,r),a&&rt(e,t+16,n,r+4)}function ot(e,t,n,r){or(e,t+0,n,r,1),or(e,t+32,n,r+128,1)}function st(e,t,n,r){var a;for(e=e[t+0]+4,a=0;4>a;++a)for(t=0;4>t;++t)et(n,r,t,a,e)}function ct(e,t,n,r){e[t+0]&&lr(e,t+0,n,r),e[t+16]&&lr(e,t+16,n,r+4),e[t+32]&&lr(e,t+32,n,r+128),e[t+48]&&lr(e,t+48,n,r+128+4)}function lt(e,t,n,r){var a,o=i(16);for(a=0;4>a;++a){var s=e[t+0+a]+e[t+12+a],c=e[t+4+a]+e[t+8+a],l=e[t+4+a]-e[t+8+a],u=e[t+0+a]-e[t+12+a];o[0+a]=s+c,o[8+a]=s-c,o[4+a]=u+l,o[12+a]=u-l}for(a=0;4>a;++a)s=(e=o[0+4*a]+3)+o[3+4*a],c=o[1+4*a]+o[2+4*a],l=o[1+4*a]-o[2+4*a],u=e-o[3+4*a],n[r+0]=s+c>>3,n[r+16]=u+l>>3,n[r+32]=s-c>>3,n[r+48]=u-l>>3,r+=64}function ut(e,t,n){var r,a=t-32,i=Or,o=255-e[a-1];for(r=0;r<n;++r){var s,c=i,l=o+e[t-1];for(s=0;s<n;++s)e[t+s]=c[l+e[a+s]];t+=32}}function ht(e,t){ut(e,t,4)}function dt(e,t){ut(e,t,8)}function ft(e,t){ut(e,t,16)}function pt(e,t){var n;for(n=0;16>n;++n)r(e,t+32*n,e,t-32,16)}function mt(e,t){var n;for(n=16;0<n;--n)a(e,t,e[t-1],16),t+=32}function gt(e,t,n){var r;for(r=0;16>r;++r)a(t,n+32*r,e,16)}function vt(e,t){var n,r=16;for(n=0;16>n;++n)r+=e[t-1+32*n]+e[t+n-32];gt(r>>5,e,t)}function bt(e,t){var n,r=8;for(n=0;16>n;++n)r+=e[t-1+32*n];gt(r>>4,e,t)}function yt(e,t){var n,r=8;for(n=0;16>n;++n)r+=e[t+n-32];gt(r>>4,e,t)}function xt(e,t){gt(128,e,t)}function wt(e,t,n){return e+2*t+n+2>>2}function kt(e,t){var n,a=t-32;for(a=new Uint8Array([wt(e[a-1],e[a+0],e[a+1]),wt(e[a+0],e[a+1],e[a+2]),wt(e[a+1],e[a+2],e[a+3]),wt(e[a+2],e[a+3],e[a+4])]),n=0;4>n;++n)r(e,t+32*n,a,0,a.length)}function St(e,t){var n=e[t-1],r=e[t-1+32],a=e[t-1+64],i=e[t-1+96];_(e,t+0,16843009*wt(e[t-1-32],n,r)),_(e,t+32,16843009*wt(n,r,a)),_(e,t+64,16843009*wt(r,a,i)),_(e,t+96,16843009*wt(a,i,i))}function Nt(e,t){var n,r=4;for(n=0;4>n;++n)r+=e[t+n-32]+e[t-1+32*n];for(r>>=3,n=0;4>n;++n)a(e,t+32*n,r,4)}function Ct(e,t){var n=e[t-1+0],r=e[t-1+32],a=e[t-1+64],i=e[t-1-32],o=e[t+0-32],s=e[t+1-32],c=e[t+2-32],l=e[t+3-32];e[t+0+96]=wt(r,a,e[t-1+96]),e[t+1+96]=e[t+0+64]=wt(n,r,a),e[t+2+96]=e[t+1+64]=e[t+0+32]=wt(i,n,r),e[t+3+96]=e[t+2+64]=e[t+1+32]=e[t+0+0]=wt(o,i,n),e[t+3+64]=e[t+2+32]=e[t+1+0]=wt(s,o,i),e[t+3+32]=e[t+2+0]=wt(c,s,o),e[t+3+0]=wt(l,c,s)}function Et(e,t){var n=e[t+1-32],r=e[t+2-32],a=e[t+3-32],i=e[t+4-32],o=e[t+5-32],s=e[t+6-32],c=e[t+7-32];e[t+0+0]=wt(e[t+0-32],n,r),e[t+1+0]=e[t+0+32]=wt(n,r,a),e[t+2+0]=e[t+1+32]=e[t+0+64]=wt(r,a,i),e[t+3+0]=e[t+2+32]=e[t+1+64]=e[t+0+96]=wt(a,i,o),e[t+3+32]=e[t+2+64]=e[t+1+96]=wt(i,o,s),e[t+3+64]=e[t+2+96]=wt(o,s,c),e[t+3+96]=wt(s,c,c)}function It(e,t){var n=e[t-1+0],r=e[t-1+32],a=e[t-1+64],i=e[t-1-32],o=e[t+0-32],s=e[t+1-32],c=e[t+2-32],l=e[t+3-32];e[t+0+0]=e[t+1+64]=i+o+1>>1,e[t+1+0]=e[t+2+64]=o+s+1>>1,e[t+2+0]=e[t+3+64]=s+c+1>>1,e[t+3+0]=c+l+1>>1,e[t+0+96]=wt(a,r,n),e[t+0+64]=wt(r,n,i),e[t+0+32]=e[t+1+96]=wt(n,i,o),e[t+1+32]=e[t+2+96]=wt(i,o,s),e[t+2+32]=e[t+3+96]=wt(o,s,c),e[t+3+32]=wt(s,c,l)}function Tt(e,t){var n=e[t+0-32],r=e[t+1-32],a=e[t+2-32],i=e[t+3-32],o=e[t+4-32],s=e[t+5-32],c=e[t+6-32],l=e[t+7-32];e[t+0+0]=n+r+1>>1,e[t+1+0]=e[t+0+64]=r+a+1>>1,e[t+2+0]=e[t+1+64]=a+i+1>>1,e[t+3+0]=e[t+2+64]=i+o+1>>1,e[t+0+32]=wt(n,r,a),e[t+1+32]=e[t+0+96]=wt(r,a,i),e[t+2+32]=e[t+1+96]=wt(a,i,o),e[t+3+32]=e[t+2+96]=wt(i,o,s),e[t+3+64]=wt(o,s,c),e[t+3+96]=wt(s,c,l)}function _t(e,t){var n=e[t-1+0],r=e[t-1+32],a=e[t-1+64],i=e[t-1+96];e[t+0+0]=n+r+1>>1,e[t+2+0]=e[t+0+32]=r+a+1>>1,e[t+2+32]=e[t+0+64]=a+i+1>>1,e[t+1+0]=wt(n,r,a),e[t+3+0]=e[t+1+32]=wt(r,a,i),e[t+3+32]=e[t+1+64]=wt(a,i,i),e[t+3+64]=e[t+2+64]=e[t+0+96]=e[t+1+96]=e[t+2+96]=e[t+3+96]=i}function At(e,t){var n=e[t-1+0],r=e[t-1+32],a=e[t-1+64],i=e[t-1+96],o=e[t-1-32],s=e[t+0-32],c=e[t+1-32],l=e[t+2-32];e[t+0+0]=e[t+2+32]=n+o+1>>1,e[t+0+32]=e[t+2+64]=r+n+1>>1,e[t+0+64]=e[t+2+96]=a+r+1>>1,e[t+0+96]=i+a+1>>1,e[t+3+0]=wt(s,c,l),e[t+2+0]=wt(o,s,c),e[t+1+0]=e[t+3+32]=wt(n,o,s),e[t+1+32]=e[t+3+64]=wt(r,n,o),e[t+1+64]=e[t+3+96]=wt(a,r,n),e[t+1+96]=wt(i,a,r)}function Rt(e,t){var n;for(n=0;8>n;++n)r(e,t+32*n,e,t-32,8)}function Ft(e,t){var n;for(n=0;8>n;++n)a(e,t,e[t-1],8),t+=32}function Dt(e,t,n){var r;for(r=0;8>r;++r)a(t,n+32*r,e,8)}function Ot(e,t){var n,r=8;for(n=0;8>n;++n)r+=e[t+n-32]+e[t-1+32*n];Dt(r>>4,e,t)}function Lt(e,t){var n,r=4;for(n=0;8>n;++n)r+=e[t+n-32];Dt(r>>3,e,t)}function Pt(e,t){var n,r=4;for(n=0;8>n;++n)r+=e[t-1+32*n];Dt(r>>3,e,t)}function Mt(e,t){Dt(128,e,t)}function jt(e,t,n){var r=e[t-n],a=e[t+0],i=3*(a-r)+Fr[1020+e[t-2*n]-e[t+n]],o=Dr[112+(i+4>>3)];e[t-n]=Or[255+r+Dr[112+(i+3>>3)]],e[t+0]=Or[255+a-o]}function Bt(e,t,n,r){var a=e[t+0],i=e[t+n];return Lr[255+e[t-2*n]-e[t-n]]>r||Lr[255+i-a]>r}function zt(e,t,n,r){return 4*Lr[255+e[t-n]-e[t+0]]+Lr[255+e[t-2*n]-e[t+n]]<=r}function Ut(e,t,n,r,a){var i=e[t-3*n],o=e[t-2*n],s=e[t-n],c=e[t+0],l=e[t+n],u=e[t+2*n],h=e[t+3*n];return 4*Lr[255+s-c]+Lr[255+o-l]>r?0:Lr[255+e[t-4*n]-i]<=a&&Lr[255+i-o]<=a&&Lr[255+o-s]<=a&&Lr[255+h-u]<=a&&Lr[255+u-l]<=a&&Lr[255+l-c]<=a}function Wt(e,t,n,r){var a=2*r+1;for(r=0;16>r;++r)zt(e,t+r,n,a)&&jt(e,t+r,n)}function Vt(e,t,n,r){var a=2*r+1;for(r=0;16>r;++r)zt(e,t+r*n,1,a)&&jt(e,t+r*n,1)}function Ht(e,t,n,r){var a;for(a=3;0<a;--a)Wt(e,t+=4*n,n,r)}function Gt(e,t,n,r){var a;for(a=3;0<a;--a)Vt(e,t+=4,n,r)}function qt(e,t,n,r,a,i,o,s){for(i=2*i+1;0<a--;){if(Ut(e,t,n,i,o))if(Bt(e,t,n,s))jt(e,t,n);else{var c=e,l=t,u=n,h=c[l-2*u],d=c[l-u],f=c[l+0],p=c[l+u],m=c[l+2*u],g=27*(b=Fr[1020+3*(f-d)+Fr[1020+h-p]])+63>>7,v=18*b+63>>7,b=9*b+63>>7;c[l-3*u]=Or[255+c[l-3*u]+b],c[l-2*u]=Or[255+h+v],c[l-u]=Or[255+d+g],c[l+0]=Or[255+f-g],c[l+u]=Or[255+p-v],c[l+2*u]=Or[255+m-b]}t+=r}}function Kt(e,t,n,r,a,i,o,s){for(i=2*i+1;0<a--;){if(Ut(e,t,n,i,o))if(Bt(e,t,n,s))jt(e,t,n);else{var c=e,l=t,u=n,h=c[l-u],d=c[l+0],f=c[l+u],p=Dr[112+(4+(m=3*(d-h))>>3)],m=Dr[112+(m+3>>3)],g=p+1>>1;c[l-2*u]=Or[255+c[l-2*u]+g],c[l-u]=Or[255+h+m],c[l+0]=Or[255+d-p],c[l+u]=Or[255+f-g]}t+=r}}function Xt(e,t,n,r,a,i){qt(e,t,n,1,16,r,a,i)}function Yt(e,t,n,r,a,i){qt(e,t,1,n,16,r,a,i)}function $t(e,t,n,r,a,i){var o;for(o=3;0<o;--o)Kt(e,t+=4*n,n,1,16,r,a,i)}function Jt(e,t,n,r,a,i){var o;for(o=3;0<o;--o)Kt(e,t+=4,1,n,16,r,a,i)}function Qt(e,t,n,r,a,i,o,s){qt(e,t,a,1,8,i,o,s),qt(n,r,a,1,8,i,o,s)}function Zt(e,t,n,r,a,i,o,s){qt(e,t,1,a,8,i,o,s),qt(n,r,1,a,8,i,o,s)}function en(e,t,n,r,a,i,o,s){Kt(e,t+4*a,a,1,8,i,o,s),Kt(n,r+4*a,a,1,8,i,o,s)}function tn(e,t,n,r,a,i,o,s){Kt(e,t+4,1,a,8,i,o,s),Kt(n,r+4,1,a,8,i,o,s)}function nn(){this.ba=new oe,this.ec=[],this.cc=[],this.Mc=[],this.Dc=this.Nc=this.dc=this.fc=0,this.Oa=new ce,this.memory=0,this.Ib="OutputFunc",this.Jb="OutputAlphaFunc",this.Nd="OutputRowFunc"}function rn(){this.data=[],this.offset=this.kd=this.ha=this.w=0,this.na=[],this.xa=this.gb=this.Ja=this.Sa=this.P=0}function an(){this.nc=this.Ea=this.b=this.hc=0,this.K=[],this.w=0}function on(){this.ua=0,this.Wa=new L,this.vb=new L,this.md=this.xc=this.wc=0,this.vc=[],this.Wb=0,this.Ya=new f,this.yc=new h}function sn(){this.xb=this.a=0,this.l=new qe,this.ca=new oe,this.V=[],this.Ba=0,this.Ta=[],this.Ua=0,this.m=new w,this.Pb=0,this.wd=new w,this.Ma=this.$=this.C=this.i=this.c=this.xd=0,this.s=new on,this.ab=0,this.gc=o(4,an),this.Oc=0}function cn(){this.Lc=this.Z=this.$a=this.i=this.c=0,this.l=new qe,this.ic=0,this.ca=[],this.tb=0,this.qd=null,this.rd=0}function ln(e,t,n,r,a,i,o){for(e=null==e?0:e[t+0],t=0;t<o;++t)a[i+t]=e+n[r+t]&255,e=a[i+t]}function un(e,t,n,r,a,i,o){var s;if(null==e)ln(null,null,n,r,a,i,o);else for(s=0;s<o;++s)a[i+s]=e[t+s]+n[r+s]&255}function hn(e,t,n,r,a,i,o){if(null==e)ln(null,null,n,r,a,i,o);else{var s,c=e[t+0],l=c,u=c;for(s=0;s<o;++s)l=u+(c=e[t+s])-l,u=n[r+s]+(-256&l?0>l?0:255:l)&255,l=c,a[i+s]=u}}function dn(e,n,a,o){var s=n.width,c=n.o;if(t(null!=e&&null!=n),0>a||0>=o||a+o>c)return null;if(!e.Cc){if(null==e.ga){var l;if(e.ga=new cn,(l=null==e.ga)||(l=n.width*n.o,t(0==e.Gb.length),e.Gb=i(l),e.Uc=0,null==e.Gb?l=0:(e.mb=e.Gb,e.nb=e.Uc,e.rc=null,l=1),l=!l),!l){l=e.ga;var u=e.Fa,h=e.P,d=e.qc,f=e.mb,p=e.nb,m=h+1,g=d-1,b=l.l;if(t(null!=u&&null!=f&&null!=n),ga[0]=null,ga[1]=ln,ga[2]=un,ga[3]=hn,l.ca=f,l.tb=p,l.c=n.width,l.i=n.height,t(0<l.c&&0<l.i),1>=d)n=0;else if(l.$a=3&u[h+0],l.Z=u[h+0]>>2&3,l.Lc=u[h+0]>>4&3,h=u[h+0]>>6&3,0>l.$a||1<l.$a||4<=l.Z||1<l.Lc||h)n=0;else if(b.put=fe,b.ac=de,b.bc=pe,b.ma=l,b.width=n.width,b.height=n.height,b.Da=n.Da,b.v=n.v,b.va=n.va,b.j=n.j,b.o=n.o,l.$a)e:{t(1==l.$a),n=Te();t:for(;;){if(null==n){n=0;break e}if(t(null!=l),l.mc=n,n.c=l.c,n.i=l.i,n.l=l.l,n.l.ma=l,n.l.width=l.c,n.l.height=l.i,n.a=0,v(n.m,u,m,g),!_e(l.c,l.i,1,n,null))break t;if(1==n.ab&&3==n.gc[0].hc&&Se(n.s)?(l.ic=1,u=n.c*n.i,n.Ta=null,n.Ua=0,n.V=i(u),n.Ba=0,null==n.V?(n.a=1,n=0):n=1):(l.ic=0,n=Ae(n,l.c)),!n)break t;n=1;break e}l.mc=null,n=0}else n=g>=l.c*l.i;l=!n}if(l)return null;1!=e.ga.Lc?e.Ga=0:o=c-a}t(null!=e.ga),t(a+o<=c);e:{if(n=(u=e.ga).c,c=u.l.o,0==u.$a){if(m=e.rc,g=e.Vc,b=e.Fa,h=e.P+1+a*n,d=e.mb,f=e.nb+a*n,t(h<=e.P+e.qc),0!=u.Z)for(t(null!=ga[u.Z]),l=0;l<o;++l)ga[u.Z](m,g,b,h,d,f,n),m=d,g=f,f+=n,h+=n;else for(l=0;l<o;++l)r(d,f,b,h,n),m=d,g=f,f+=n,h+=n;e.rc=m,e.Vc=g}else{if(t(null!=u.mc),n=a+o,t(null!=(l=u.mc)),t(n<=l.i),l.C>=n)n=1;else if(u.ic||vn(),u.ic){u=l.V,m=l.Ba,g=l.c;var y=l.i,x=(b=1,h=l.$/g,d=l.$%g,f=l.m,p=l.s,l.$),w=g*y,k=g*n,N=p.wc,E=x<k?xe(p,d,h):null;t(x<=w),t(n<=y),t(Se(p));t:for(;;){for(;!f.h&&x<k;){if(d&N||(E=xe(p,d,h)),t(null!=E),C(f),256>(y=be(E.G[0],E.H[0],f)))u[m+x]=y,++x,++d>=g&&(d=0,++h<=n&&!(h%16)&&Ce(l,h));else{if(!(280>y)){b=0;break t}y=ge(y-256,f);var I,T=be(E.G[4],E.H[4],f);if(C(f),!(x>=(T=ve(g,T=ge(T,f)))&&w-x>=y)){b=0;break t}for(I=0;I<y;++I)u[m+x+I]=u[m+x+I-T];for(x+=y,d+=y;d>=g;)d-=g,++h<=n&&!(h%16)&&Ce(l,h);x<k&&d&N&&(E=xe(p,d,h))}t(f.h==S(f))}Ce(l,h>n?n:h);break t}!b||f.h&&x<w?(b=0,l.a=f.h?5:3):l.$=x,n=b}else n=Ee(l,l.V,l.Ba,l.c,l.i,n,Re);if(!n){o=0;break e}}a+o>=c&&(e.Cc=1),o=1}if(!o)return null;if(e.Cc&&(null!=(o=e.ga)&&(o.mc=null),e.ga=null,0<e.Ga))return alert("todo:WebPDequantizeLevels"),null}return e.nb+a*s}function fn(e,t,n,r,a,i){for(;0<a--;){var o,s=e,c=t+(n?1:0),l=e,u=t+(n?0:3);for(o=0;o<r;++o){var h=l[u+4*o];255!=h&&(h*=32897,s[c+4*o+0]=s[c+4*o+0]*h>>23,s[c+4*o+1]=s[c+4*o+1]*h>>23,s[c+4*o+2]=s[c+4*o+2]*h>>23)}t+=i}}function pn(e,t,n,r,a){for(;0<r--;){var i;for(i=0;i<n;++i){var o=e[t+2*i+0],s=15&(l=e[t+2*i+1]),c=4369*s,l=(240&l|l>>4)*c>>16;e[t+2*i+0]=(240&o|o>>4)*c>>16&240|(15&o|o<<4)*c>>16>>4&15,e[t+2*i+1]=240&l|s}t+=a}}function mn(e,t,n,r,a,i,o,s){var c,l,u=255;for(l=0;l<a;++l){for(c=0;c<r;++c){var h=e[t+c];i[o+4*c]=h,u&=h}t+=n,o+=s}return 255!=u}function gn(e,t,n,r,a){var i;for(i=0;i<a;++i)n[r+i]=e[t+i]>>8}function vn(){Sr=fn,Nr=pn,Cr=mn,Er=gn}function bn(n,r,a){e[n]=function(e,n,i,o,s,c,l,u,h,d,f,p,m,g,v,b,y){var x,w=y-1>>1,k=s[c+0]|l[u+0]<<16,S=h[d+0]|f[p+0]<<16;t(null!=e);var N=3*k+S+131074>>2;for(r(e[n+0],255&N,N>>16,m,g),null!=i&&(N=3*S+k+131074>>2,r(i[o+0],255&N,N>>16,v,b)),x=1;x<=w;++x){var C=s[c+x]|l[u+x]<<16,E=h[d+x]|f[p+x]<<16,I=k+C+S+E+524296,T=I+2*(C+S)>>3;N=T+k>>1,k=(I=I+2*(k+E)>>3)+C>>1,r(e[n+2*x-1],255&N,N>>16,m,g+(2*x-1)*a),r(e[n+2*x-0],255&k,k>>16,m,g+(2*x-0)*a),null!=i&&(N=I+S>>1,k=T+E>>1,r(i[o+2*x-1],255&N,N>>16,v,b+(2*x-1)*a),r(i[o+2*x+0],255&k,k>>16,v,b+(2*x+0)*a)),k=C,S=E}1&y||(N=3*k+S+131074>>2,r(e[n+y-1],255&N,N>>16,m,g+(y-1)*a),null!=i&&(N=3*S+k+131074>>2,r(i[o+y-1],255&N,N>>16,v,b+(y-1)*a)))}}function yn(){va[Pr]=ba,va[Mr]=xa,va[jr]=ya,va[Br]=wa,va[zr]=ka,va[Ur]=Sa,va[Wr]=Na,va[Vr]=xa,va[Hr]=wa,va[Gr]=ka,va[qr]=Sa}function xn(e){return e&~Aa?0>e?0:255:e>>_a}function wn(e,t){return xn((19077*e>>8)+(26149*t>>8)-14234)}function kn(e,t,n){return xn((19077*e>>8)-(6419*t>>8)-(13320*n>>8)+8708)}function Sn(e,t){return xn((19077*e>>8)+(33050*t>>8)-17685)}function Nn(e,t,n,r,a){r[a+0]=wn(e,n),r[a+1]=kn(e,t,n),r[a+2]=Sn(e,t)}function Cn(e,t,n,r,a){r[a+0]=Sn(e,t),r[a+1]=kn(e,t,n),r[a+2]=wn(e,n)}function En(e,t,n,r,a){var i=kn(e,t,n);t=i<<3&224|Sn(e,t)>>3,r[a+0]=248&wn(e,n)|i>>5,r[a+1]=t}function In(e,t,n,r,a){var i=240&Sn(e,t)|15;r[a+0]=240&wn(e,n)|kn(e,t,n)>>4,r[a+1]=i}function Tn(e,t,n,r,a){r[a+0]=255,Nn(e,t,n,r,a+1)}function _n(e,t,n,r,a){Cn(e,t,n,r,a),r[a+3]=255}function An(e,t,n,r,a){Nn(e,t,n,r,a),r[a+3]=255}function Ge(e,t){return 0>e?0:e>t?t:e}function Rn(t,n,r){e[t]=function(e,t,a,i,o,s,c,l,u){for(var h=l+(-2&u)*r;l!=h;)n(e[t+0],a[i+0],o[s+0],c,l),n(e[t+1],a[i+0],o[s+0],c,l+r),t+=2,++i,++s,l+=2*r;1&u&&n(e[t+0],a[i+0],o[s+0],c,l)}}function Fn(e,t,n){return 0==n?0==e?0==t?6:5:0==t?4:0:n}function Dn(e,t,n,r,a){switch(e>>>30){case 3:or(t,n,r,a,0);break;case 2:sr(t,n,r,a);break;case 1:lr(t,n,r,a)}}function On(e,t){var n,i,o=t.M,s=t.Nb,c=e.oc,l=e.pc+40,u=e.oc,h=e.pc+584,d=e.oc,f=e.pc+600;for(n=0;16>n;++n)c[l+32*n-1]=129;for(n=0;8>n;++n)u[h+32*n-1]=129,d[f+32*n-1]=129;for(0<o?c[l-1-32]=u[h-1-32]=d[f-1-32]=129:(a(c,l-32-1,127,21),a(u,h-32-1,127,9),a(d,f-32-1,127,9)),i=0;i<e.za;++i){var p=t.ya[t.aa+i];if(0<i){for(n=-1;16>n;++n)r(c,l+32*n-4,c,l+32*n+12,4);for(n=-1;8>n;++n)r(u,h+32*n-4,u,h+32*n+4,4),r(d,f+32*n-4,d,f+32*n+4,4)}var m=e.Gd,g=e.Hd+i,v=p.ad,b=p.Hc;if(0<o&&(r(c,l-32,m[g].y,0,16),r(u,h-32,m[g].f,0,8),r(d,f-32,m[g].ea,0,8)),p.Za){var y=c,x=l-32+16;for(0<o&&(i>=e.za-1?a(y,x,m[g].y[15],4):r(y,x,m[g+1].y,0,4)),n=0;4>n;n++)y[x+128+n]=y[x+256+n]=y[x+384+n]=y[x+0+n];for(n=0;16>n;++n,b<<=2)y=c,x=l+ja[n],da[p.Ob[n]](y,x),Dn(b,v,16*+n,y,x)}else if(y=Fn(i,o,p.Ob[0]),ha[y](c,l),0!=b)for(n=0;16>n;++n,b<<=2)Dn(b,v,16*+n,c,l+ja[n]);for(n=p.Gc,y=Fn(i,o,p.Dd),fa[y](u,h),fa[y](d,f),b=v,y=u,x=h,255&(p=n|0)&&(170&p?cr(b,256,y,x):ur(b,256,y,x)),p=d,b=f,255&(n>>=8)&&(170&n?cr(v,320,p,b):ur(v,320,p,b)),o<e.Ub-1&&(r(m[g].y,0,c,l+480,16),r(m[g].f,0,u,h+224,8),r(m[g].ea,0,d,f+224,8)),n=8*s*e.B,m=e.sa,g=e.ta+16*i+16*s*e.R,v=e.qa,p=e.ra+8*i+n,b=e.Ha,y=e.Ia+8*i+n,n=0;16>n;++n)r(m,g+n*e.R,c,l+32*n,16);for(n=0;8>n;++n)r(v,p+n*e.B,u,h+32*n,8),r(b,y+n*e.B,d,f+32*n,8)}}function Ln(e,r,a,i,o,s,c,l,u){var h=[0],d=[0],f=0,p=null!=u?u.kd:0,m=null!=u?u:new rn;if(null==e||12>a)return 7;m.data=e,m.w=r,m.ha=a,r=[r],a=[a],m.gb=[m.gb];e:{var g=r,b=a,y=m.gb;if(t(null!=e),t(null!=b),t(null!=y),y[0]=0,12<=b[0]&&!n(e,g[0],"RIFF")){if(n(e,g[0]+8,"WEBP")){y=3;break e}var x=F(e,g[0]+4);if(12>x||4294967286<x){y=3;break e}if(p&&x>b[0]-8){y=7;break e}y[0]=x,g[0]+=12,b[0]-=12}y=0}if(0!=y)return y;for(x=0<m.gb[0],a=a[0];;){e:{var k=e;b=r,y=a;var S=h,N=d,C=g=[0];if((T=f=[f])[0]=0,8>y[0])y=7;else{if(!n(k,b[0],"VP8X")){if(10!=F(k,b[0]+4)){y=3;break e}if(18>y[0]){y=7;break e}var E=F(k,b[0]+8),I=1+R(k,b[0]+12);if(2147483648<=I*(k=1+R(k,b[0]+15))){y=3;break e}null!=C&&(C[0]=E),null!=S&&(S[0]=I),null!=N&&(N[0]=k),b[0]+=18,y[0]-=18,T[0]=1}y=0}}if(f=f[0],g=g[0],0!=y)return y;if(b=!!(2&g),!x&&f)return 3;if(null!=s&&(s[0]=!!(16&g)),null!=c&&(c[0]=b),null!=l&&(l[0]=0),c=h[0],g=d[0],f&&b&&null==u){y=0;break}if(4>a){y=7;break}if(x&&f||!x&&!f&&!n(e,r[0],"ALPH")){a=[a],m.na=[m.na],m.P=[m.P],m.Sa=[m.Sa];e:{E=e,y=r,x=a;var T=m.gb;S=m.na,N=m.P,C=m.Sa,I=22,t(null!=E),t(null!=x),k=y[0];var _=x[0];for(t(null!=S),t(null!=C),S[0]=null,N[0]=null,C[0]=0;;){if(y[0]=k,x[0]=_,8>_){y=7;break e}var A=F(E,k+4);if(4294967286<A){y=3;break e}var D=8+A+1&-2;if(I+=D,0<T&&I>T){y=3;break e}if(!n(E,k,"VP8 ")||!n(E,k,"VP8L")){y=0;break e}if(_[0]<D){y=7;break e}n(E,k,"ALPH")||(S[0]=E,N[0]=k+8,C[0]=A),k+=D,_-=D}}if(a=a[0],m.na=m.na[0],m.P=m.P[0],m.Sa=m.Sa[0],0!=y)break}a=[a],m.Ja=[m.Ja],m.xa=[m.xa];e:if(T=e,y=r,x=a,S=m.gb[0],N=m.Ja,C=m.xa,E=y[0],k=!n(T,E,"VP8 "),I=!n(T,E,"VP8L"),t(null!=T),t(null!=x),t(null!=N),t(null!=C),8>x[0])y=7;else{if(k||I){if(T=F(T,E+4),12<=S&&T>S-12){y=3;break e}if(p&&T>x[0]-8){y=7;break e}N[0]=T,y[0]+=8,x[0]-=8,C[0]=I}else C[0]=5<=x[0]&&47==T[E+0]&&!(T[E+4]>>5),N[0]=x[0];y=0}if(a=a[0],m.Ja=m.Ja[0],m.xa=m.xa[0],r=r[0],0!=y)break;if(4294967286<m.Ja)return 3;if(null==l||b||(l[0]=m.xa?2:1),c=[c],g=[g],m.xa){if(5>a){y=7;break}l=c,p=g,b=s,null==e||5>a?e=0:5<=a&&47==e[r+0]&&!(e[r+4]>>5)?(x=[0],T=[0],S=[0],v(N=new w,e,r,a),me(N,x,T,S)?(null!=l&&(l[0]=x[0]),null!=p&&(p[0]=T[0]),null!=b&&(b[0]=S[0]),e=1):e=0):e=0}else{if(10>a){y=7;break}l=g,null==e||10>a||!Ye(e,r+3,a-3)?e=0:(p=e[r+0]|e[r+1]<<8|e[r+2]<<16,b=16383&(e[r+7]<<8|e[r+6]),e=16383&(e[r+9]<<8|e[r+8]),1&p||3<(p>>1&7)||!(p>>4&1)||p>>5>=m.Ja||!b||!e?e=0:(c&&(c[0]=b),l&&(l[0]=e),e=1))}if(!e)return 3;if(c=c[0],g=g[0],f&&(h[0]!=c||d[0]!=g))return 3;null!=u&&(u[0]=m,u.offset=r-u.w,t(4294967286>r-u.w),t(u.offset==u.ha-a));break}return 0==y||7==y&&f&&null==u?(null!=s&&(s[0]|=null!=m.na&&0<m.na.length),null!=i&&(i[0]=c),null!=o&&(o[0]=g),0):y}function Pn(e,t,n){var r=t.width,a=t.height,i=0,o=0,s=r,c=a;if(t.Da=null!=e&&0<e.Da,t.Da&&(s=e.cd,c=e.bd,i=e.v,o=e.j,11>n||(i&=-2,o&=-2),0>i||0>o||0>=s||0>=c||i+s>r||o+c>a))return 0;if(t.v=i,t.j=o,t.va=i+s,t.o=o+c,t.U=s,t.T=c,t.da=null!=e&&0<e.da,t.da){if(!P(s,c,n=[e.ib],i=[e.hb]))return 0;t.ib=n[0],t.hb=i[0]}return t.ob=null!=e&&e.ob,t.Kb=null==e||!e.Sd,t.da&&(t.ob=t.ib<3*r/4&&t.hb<3*a/4,t.Kb=0),1}function Mn(e){if(null==e)return 2;if(11>e.S){var t=e.f.RGBA;t.fb+=(e.height-1)*t.A,t.A=-t.A}else t=e.f.kb,e=e.height,t.O+=(e-1)*t.fa,t.fa=-t.fa,t.N+=(e-1>>1)*t.Ab,t.Ab=-t.Ab,t.W+=(e-1>>1)*t.Db,t.Db=-t.Db,null!=t.F&&(t.J+=(e-1)*t.lb,t.lb=-t.lb);return 0}function jn(e,t,n,r){if(null==r||0>=e||0>=t)return 2;if(null!=n){if(n.Da){var a=n.cd,o=n.bd,s=-2&n.v,c=-2&n.j;if(0>s||0>c||0>=a||0>=o||s+a>e||c+o>t)return 2;e=a,t=o}if(n.da){if(!P(e,t,a=[n.ib],o=[n.hb]))return 2;e=a[0],t=o[0]}}r.width=e,r.height=t;e:{var l=r.width,u=r.height;if(e=r.S,0>=l||0>=u||!(e>=Pr&&13>e))e=2;else{if(0>=r.Rd&&null==r.sd){s=o=a=t=0;var h=(c=l*Wa[e])*u;if(11>e||(o=(u+1)/2*(t=(l+1)/2),12==e&&(s=(a=l)*u)),null==(u=i(h+2*o+s))){e=1;break e}r.sd=u,11>e?((l=r.f.RGBA).eb=u,l.fb=0,l.A=c,l.size=h):((l=r.f.kb).y=u,l.O=0,l.fa=c,l.Fd=h,l.f=u,l.N=0+h,l.Ab=t,l.Cd=o,l.ea=u,l.W=0+h+o,l.Db=t,l.Ed=o,12==e&&(l.F=u,l.J=0+h+2*o),l.Tc=s,l.lb=a)}if(t=1,a=r.S,o=r.width,s=r.height,a>=Pr&&13>a)if(11>a)e=r.f.RGBA,t&=(c=Math.abs(e.A))*(s-1)+o<=e.size,t&=c>=o*Wa[a],t&=null!=e.eb;else{e=r.f.kb,c=(o+1)/2,h=(s+1)/2,l=Math.abs(e.fa),u=Math.abs(e.Ab);var d=Math.abs(e.Db),f=Math.abs(e.lb),p=f*(s-1)+o;t&=l*(s-1)+o<=e.Fd,t&=u*(h-1)+c<=e.Cd,t=(t&=d*(h-1)+c<=e.Ed)&l>=o&u>=c&d>=c,t&=null!=e.y,t&=null!=e.f,t&=null!=e.ea,12==a&&(t&=f>=o,t&=p<=e.Tc,t&=null!=e.F)}else t=0;e=t?0:2}}return 0!=e||null!=n&&n.fd&&(e=Mn(r)),e}var Bn=64,zn=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535,131071,262143,524287,1048575,2097151,4194303,8388607,16777215],Un=24,Wn=32,Vn=8,Hn=[0,0,1,1,2,2,2,2,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7];B("Predictor0","PredictorAdd0"),e.Predictor0=function(){return 4278190080},e.Predictor1=function(e){return e},e.Predictor2=function(e,t,n){return t[n+0]},e.Predictor3=function(e,t,n){return t[n+1]},e.Predictor4=function(e,t,n){return t[n-1]},e.Predictor5=function(e,t,n){return U(U(e,t[n+1]),t[n+0])},e.Predictor6=function(e,t,n){return U(e,t[n-1])},e.Predictor7=function(e,t,n){return U(e,t[n+0])},e.Predictor8=function(e,t,n){return U(t[n-1],t[n+0])},e.Predictor9=function(e,t,n){return U(t[n+0],t[n+1])},e.Predictor10=function(e,t,n){return U(U(e,t[n-1]),U(t[n+0],t[n+1]))},e.Predictor11=function(e,t,n){var r=t[n+0];return 0>=H(r>>24&255,e>>24&255,(t=t[n-1])>>24&255)+H(r>>16&255,e>>16&255,t>>16&255)+H(r>>8&255,e>>8&255,t>>8&255)+H(255&r,255&e,255&t)?r:e},e.Predictor12=function(e,t,n){var r=t[n+0];return(W((e>>24&255)+(r>>24&255)-((t=t[n-1])>>24&255))<<24|W((e>>16&255)+(r>>16&255)-(t>>16&255))<<16|W((e>>8&255)+(r>>8&255)-(t>>8&255))<<8|W((255&e)+(255&r)-(255&t)))>>>0},e.Predictor13=function(e,t,n){var r=t[n-1];return(V((e=U(e,t[n+0]))>>24&255,r>>24&255)<<24|V(e>>16&255,r>>16&255)<<16|V(e>>8&255,r>>8&255)<<8|V(255&e,255&r))>>>0};var Gn=e.PredictorAdd0;e.PredictorAdd1=G,B("Predictor2","PredictorAdd2"),B("Predictor3","PredictorAdd3"),B("Predictor4","PredictorAdd4"),B("Predictor5","PredictorAdd5"),B("Predictor6","PredictorAdd6"),B("Predictor7","PredictorAdd7"),B("Predictor8","PredictorAdd8"),B("Predictor9","PredictorAdd9"),B("Predictor10","PredictorAdd10"),B("Predictor11","PredictorAdd11"),B("Predictor12","PredictorAdd12"),B("Predictor13","PredictorAdd13");var qn=e.PredictorAdd2;Y("ColorIndexInverseTransform","MapARGB","32b",function(e){return e>>8&255},function(e){return e}),Y("VP8LColorIndexInverseTransformAlpha","MapAlpha","8b",function(e){return e},function(e){return e>>8&255});var Kn,Xn=e.ColorIndexInverseTransform,Yn=e.MapARGB,$n=e.VP8LColorIndexInverseTransformAlpha,Jn=e.MapAlpha,Qn=e.VP8LPredictorsAdd=[];Qn.length=16,(e.VP8LPredictors=[]).length=16,(e.VP8LPredictorsAdd_C=[]).length=16,(e.VP8LPredictors_C=[]).length=16;var Zn,er,tr,nr,rr,ar,ir,or,sr,cr,lr,ur,hr,dr,fr,pr,mr,gr,vr,br,yr,xr,wr,kr,Sr,Nr,Cr,Er,Ir=i(511),Tr=i(2041),_r=i(225),Ar=i(767),Rr=0,Fr=Tr,Dr=_r,Or=Ar,Lr=Ir,Pr=0,Mr=1,jr=2,Br=3,zr=4,Ur=5,Wr=6,Vr=7,Hr=8,Gr=9,qr=10,Kr=[2,3,7],Xr=[3,3,11],Yr=[280,256,256,256,40],$r=[0,1,1,1,0],Jr=[17,18,0,1,2,3,4,5,16,6,7,8,9,10,11,12,13,14,15],Qr=[24,7,23,25,40,6,39,41,22,26,38,42,56,5,55,57,21,27,54,58,37,43,72,4,71,73,20,28,53,59,70,74,36,44,88,69,75,52,60,3,87,89,19,29,86,90,35,45,68,76,85,91,51,61,104,2,103,105,18,30,102,106,34,46,84,92,67,77,101,107,50,62,120,1,119,121,83,93,17,31,100,108,66,78,118,122,33,47,117,123,49,63,99,109,82,94,0,116,124,65,79,16,32,98,110,48,115,125,81,95,64,114,126,97,111,80,113,127,96,112],Zr=[2954,2956,2958,2962,2970,2986,3018,3082,3212,3468,3980,5004],ea=8,ta=[4,5,6,7,8,9,10,10,11,12,13,14,15,16,17,17,18,19,20,20,21,21,22,22,23,23,24,25,25,26,27,28,29,30,31,32,33,34,35,36,37,37,38,39,40,41,42,43,44,45,46,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,76,77,78,79,80,81,82,83,84,85,86,87,88,89,91,93,95,96,98,100,101,102,104,106,108,110,112,114,116,118,122,124,126,128,130,132,134,136,138,140,143,145,148,151,154,157],na=[4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,60,62,64,66,68,70,72,74,76,78,80,82,84,86,88,90,92,94,96,98,100,102,104,106,108,110,112,114,116,119,122,125,128,131,134,137,140,143,146,149,152,155,158,161,164,167,170,173,177,181,185,189,193,197,201,205,209,213,217,221,225,229,234,239,245,249,254,259,264,269,274,279,284],ra=null,aa=[[173,148,140,0],[176,155,140,135,0],[180,157,141,134,130,0],[254,254,243,230,196,177,153,140,133,130,129,0]],ia=[0,1,4,8,5,2,3,6,9,12,13,10,7,11,14,15],oa=[-0,1,-1,2,-2,3,4,6,-3,5,-4,-5,-6,7,-7,8,-8,-9],sa=[[[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]],[[253,136,254,255,228,219,128,128,128,128,128],[189,129,242,255,227,213,255,219,128,128,128],[106,126,227,252,214,209,255,255,128,128,128]],[[1,98,248,255,236,226,255,255,128,128,128],[181,133,238,254,221,234,255,154,128,128,128],[78,134,202,247,198,180,255,219,128,128,128]],[[1,185,249,255,243,255,128,128,128,128,128],[184,150,247,255,236,224,128,128,128,128,128],[77,110,216,255,236,230,128,128,128,128,128]],[[1,101,251,255,241,255,128,128,128,128,128],[170,139,241,252,236,209,255,255,128,128,128],[37,116,196,243,228,255,255,255,128,128,128]],[[1,204,254,255,245,255,128,128,128,128,128],[207,160,250,255,238,128,128,128,128,128,128],[102,103,231,255,211,171,128,128,128,128,128]],[[1,152,252,255,240,255,128,128,128,128,128],[177,135,243,255,234,225,128,128,128,128,128],[80,129,211,255,194,224,128,128,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[246,1,255,128,128,128,128,128,128,128,128],[255,128,128,128,128,128,128,128,128,128,128]]],[[[198,35,237,223,193,187,162,160,145,155,62],[131,45,198,221,172,176,220,157,252,221,1],[68,47,146,208,149,167,221,162,255,223,128]],[[1,149,241,255,221,224,255,255,128,128,128],[184,141,234,253,222,220,255,199,128,128,128],[81,99,181,242,176,190,249,202,255,255,128]],[[1,129,232,253,214,197,242,196,255,255,128],[99,121,210,250,201,198,255,202,128,128,128],[23,91,163,242,170,187,247,210,255,255,128]],[[1,200,246,255,234,255,128,128,128,128,128],[109,178,241,255,231,245,255,255,128,128,128],[44,130,201,253,205,192,255,255,128,128,128]],[[1,132,239,251,219,209,255,165,128,128,128],[94,136,225,251,218,190,255,255,128,128,128],[22,100,174,245,186,161,255,199,128,128,128]],[[1,182,249,255,232,235,128,128,128,128,128],[124,143,241,255,227,234,128,128,128,128,128],[35,77,181,251,193,211,255,205,128,128,128]],[[1,157,247,255,236,231,255,255,128,128,128],[121,141,235,255,225,227,255,255,128,128,128],[45,99,188,251,195,217,255,224,128,128,128]],[[1,1,251,255,213,255,128,128,128,128,128],[203,1,248,255,255,128,128,128,128,128,128],[137,1,177,255,224,255,128,128,128,128,128]]],[[[253,9,248,251,207,208,255,192,128,128,128],[175,13,224,243,193,185,249,198,255,255,128],[73,17,171,221,161,179,236,167,255,234,128]],[[1,95,247,253,212,183,255,255,128,128,128],[239,90,244,250,211,209,255,255,128,128,128],[155,77,195,248,188,195,255,255,128,128,128]],[[1,24,239,251,218,219,255,205,128,128,128],[201,51,219,255,196,186,128,128,128,128,128],[69,46,190,239,201,218,255,228,128,128,128]],[[1,191,251,255,255,128,128,128,128,128,128],[223,165,249,255,213,255,128,128,128,128,128],[141,124,248,255,255,128,128,128,128,128,128]],[[1,16,248,255,255,128,128,128,128,128,128],[190,36,230,255,236,255,128,128,128,128,128],[149,1,255,128,128,128,128,128,128,128,128]],[[1,226,255,128,128,128,128,128,128,128,128],[247,192,255,128,128,128,128,128,128,128,128],[240,128,255,128,128,128,128,128,128,128,128]],[[1,134,252,255,255,128,128,128,128,128,128],[213,62,250,255,255,128,128,128,128,128,128],[55,93,255,128,128,128,128,128,128,128,128]],[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]]],[[[202,24,213,235,186,191,220,160,240,175,255],[126,38,182,232,169,184,228,174,255,187,128],[61,46,138,219,151,178,240,170,255,216,128]],[[1,112,230,250,199,191,247,159,255,255,128],[166,109,228,252,211,215,255,174,128,128,128],[39,77,162,232,172,180,245,178,255,255,128]],[[1,52,220,246,198,199,249,220,255,255,128],[124,74,191,243,183,193,250,221,255,255,128],[24,71,130,219,154,170,243,182,255,255,128]],[[1,182,225,249,219,240,255,224,128,128,128],[149,150,226,252,216,205,255,171,128,128,128],[28,108,170,242,183,194,254,223,255,255,128]],[[1,81,230,252,204,203,255,192,128,128,128],[123,102,209,247,188,196,255,233,128,128,128],[20,95,153,243,164,173,255,203,128,128,128]],[[1,222,248,255,216,213,128,128,128,128,128],[168,175,246,252,235,205,255,255,128,128,128],[47,116,215,255,211,212,255,255,128,128,128]],[[1,121,236,253,212,214,255,255,128,128,128],[141,84,213,252,201,202,255,219,128,128,128],[42,80,160,240,162,185,255,205,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[244,1,255,128,128,128,128,128,128,128,128],[238,1,255,128,128,128,128,128,128,128,128]]]],ca=[[[231,120,48,89,115,113,120,152,112],[152,179,64,126,170,118,46,70,95],[175,69,143,80,85,82,72,155,103],[56,58,10,171,218,189,17,13,152],[114,26,17,163,44,195,21,10,173],[121,24,80,195,26,62,44,64,85],[144,71,10,38,171,213,144,34,26],[170,46,55,19,136,160,33,206,71],[63,20,8,114,114,208,12,9,226],[81,40,11,96,182,84,29,16,36]],[[134,183,89,137,98,101,106,165,148],[72,187,100,130,157,111,32,75,80],[66,102,167,99,74,62,40,234,128],[41,53,9,178,241,141,26,8,107],[74,43,26,146,73,166,49,23,157],[65,38,105,160,51,52,31,115,128],[104,79,12,27,217,255,87,17,7],[87,68,71,44,114,51,15,186,23],[47,41,14,110,182,183,21,17,194],[66,45,25,102,197,189,23,18,22]],[[88,88,147,150,42,46,45,196,205],[43,97,183,117,85,38,35,179,61],[39,53,200,87,26,21,43,232,171],[56,34,51,104,114,102,29,93,77],[39,28,85,171,58,165,90,98,64],[34,22,116,206,23,34,43,166,73],[107,54,32,26,51,1,81,43,31],[68,25,106,22,64,171,36,225,114],[34,19,21,102,132,188,16,76,124],[62,18,78,95,85,57,50,48,51]],[[193,101,35,159,215,111,89,46,111],[60,148,31,172,219,228,21,18,111],[112,113,77,85,179,255,38,120,114],[40,42,1,196,245,209,10,25,109],[88,43,29,140,166,213,37,43,154],[61,63,30,155,67,45,68,1,209],[100,80,8,43,154,1,51,26,71],[142,78,78,16,255,128,34,197,171],[41,40,5,102,211,183,4,1,221],[51,50,17,168,209,192,23,25,82]],[[138,31,36,171,27,166,38,44,229],[67,87,58,169,82,115,26,59,179],[63,59,90,180,59,166,93,73,154],[40,40,21,116,143,209,34,39,175],[47,15,16,183,34,223,49,45,183],[46,17,33,183,6,98,15,32,183],[57,46,22,24,128,1,54,17,37],[65,32,73,115,28,128,23,128,205],[40,3,9,115,51,192,18,6,223],[87,37,9,115,59,77,64,21,47]],[[104,55,44,218,9,54,53,130,226],[64,90,70,205,40,41,23,26,57],[54,57,112,184,5,41,38,166,213],[30,34,26,133,152,116,10,32,134],[39,19,53,221,26,114,32,73,255],[31,9,65,234,2,15,1,118,73],[75,32,12,51,192,255,160,43,51],[88,31,35,67,102,85,55,186,85],[56,21,23,111,59,205,45,37,192],[55,38,70,124,73,102,1,34,98]],[[125,98,42,88,104,85,117,175,82],[95,84,53,89,128,100,113,101,45],[75,79,123,47,51,128,81,171,1],[57,17,5,71,102,57,53,41,49],[38,33,13,121,57,73,26,1,85],[41,10,67,138,77,110,90,47,114],[115,21,2,10,102,255,166,23,6],[101,29,16,10,85,128,101,196,26],[57,18,10,102,102,213,34,20,43],[117,20,15,36,163,128,68,1,26]],[[102,61,71,37,34,53,31,243,192],[69,60,71,38,73,119,28,222,37],[68,45,128,34,1,47,11,245,171],[62,17,19,70,146,85,55,62,70],[37,43,37,154,100,163,85,160,1],[63,9,92,136,28,64,32,201,85],[75,15,9,9,64,255,184,119,16],[86,6,28,5,64,255,25,248,1],[56,8,17,132,137,255,55,116,128],[58,15,20,82,135,57,26,121,40]],[[164,50,31,137,154,133,25,35,218],[51,103,44,131,131,123,31,6,158],[86,40,64,135,148,224,45,183,128],[22,26,17,131,240,154,14,1,209],[45,16,21,91,64,222,7,1,197],[56,21,39,155,60,138,23,102,213],[83,12,13,54,192,255,68,47,28],[85,26,85,85,128,128,32,146,171],[18,11,7,63,144,171,4,4,246],[35,27,10,146,174,171,12,26,128]],[[190,80,35,99,180,80,126,54,45],[85,126,47,87,176,51,41,20,32],[101,75,128,139,118,146,116,128,85],[56,41,15,176,236,85,37,9,62],[71,30,17,119,118,255,17,18,138],[101,38,60,138,55,70,43,26,142],[146,36,19,30,171,255,97,27,20],[138,45,61,62,219,1,81,188,64],[32,41,20,117,151,142,20,21,163],[112,19,12,61,195,128,48,4,24]]],la=[[[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[176,246,255,255,255,255,255,255,255,255,255],[223,241,252,255,255,255,255,255,255,255,255],[249,253,253,255,255,255,255,255,255,255,255]],[[255,244,252,255,255,255,255,255,255,255,255],[234,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255]],[[255,246,254,255,255,255,255,255,255,255,255],[239,253,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[251,255,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[251,254,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,254,253,255,254,255,255,255,255,255,255],[250,255,254,255,254,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[217,255,255,255,255,255,255,255,255,255,255],[225,252,241,253,255,255,254,255,255,255,255],[234,250,241,250,253,255,253,254,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[223,254,254,255,255,255,255,255,255,255,255],[238,253,254,254,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[249,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,255,255,255,255,255,255,255,255,255],[247,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[252,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[186,251,250,255,255,255,255,255,255,255,255],[234,251,244,254,255,255,255,255,255,255,255],[251,251,243,253,254,255,254,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[236,253,254,255,255,255,255,255,255,255,255],[251,253,253,254,254,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[254,254,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[254,254,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[248,255,255,255,255,255,255,255,255,255,255],[250,254,252,254,255,255,255,255,255,255,255],[248,254,249,253,255,255,255,255,255,255,255]],[[255,253,253,255,255,255,255,255,255,255,255],[246,253,253,255,255,255,255,255,255,255,255],[252,254,251,254,254,255,255,255,255,255,255]],[[255,254,252,255,255,255,255,255,255,255,255],[248,254,253,255,255,255,255,255,255,255,255],[253,255,254,254,255,255,255,255,255,255,255]],[[255,251,254,255,255,255,255,255,255,255,255],[245,251,254,255,255,255,255,255,255,255,255],[253,253,254,255,255,255,255,255,255,255,255]],[[255,251,253,255,255,255,255,255,255,255,255],[252,253,254,255,255,255,255,255,255,255,255],[255,254,255,255,255,255,255,255,255,255,255]],[[255,252,255,255,255,255,255,255,255,255,255],[249,255,254,255,255,255,255,255,255,255,255],[255,255,254,255,255,255,255,255,255,255,255]],[[255,255,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]]],ua=[0,1,2,3,6,4,5,6,6,6,6,6,6,6,6,7,0],ha=[],da=[],fa=[],pa=1,ma=2,ga=[],va=[];bn("UpsampleRgbLinePair",Nn,3),bn("UpsampleBgrLinePair",Cn,3),bn("UpsampleRgbaLinePair",An,4),bn("UpsampleBgraLinePair",_n,4),bn("UpsampleArgbLinePair",Tn,4),bn("UpsampleRgba4444LinePair",In,2),bn("UpsampleRgb565LinePair",En,2);var ba=e.UpsampleRgbLinePair,ya=e.UpsampleBgrLinePair,xa=e.UpsampleRgbaLinePair,wa=e.UpsampleBgraLinePair,ka=e.UpsampleArgbLinePair,Sa=e.UpsampleRgba4444LinePair,Na=e.UpsampleRgb565LinePair,Ca=16,Ea=1<<Ca-1,Ia=-227,Ta=482,_a=6,Aa=(256<<_a)-1,Ra=0,Fa=i(256),Da=i(256),Oa=i(256),La=i(256),Pa=i(Ta-Ia),Ma=i(Ta-Ia);Rn("YuvToRgbRow",Nn,3),Rn("YuvToBgrRow",Cn,3),Rn("YuvToRgbaRow",An,4),Rn("YuvToBgraRow",_n,4),Rn("YuvToArgbRow",Tn,4),Rn("YuvToRgba4444Row",In,2),Rn("YuvToRgb565Row",En,2);var ja=[0,4,8,12,128,132,136,140,256,260,264,268,384,388,392,396],Ba=[0,2,8],za=[8,7,6,4,4,2,2,2,1,1,1,1],Ua=1;this.WebPDecodeRGBA=function(e,n,r,a,i){var o=Mr,s=new nn,c=new oe;s.ba=c,c.S=o,c.width=[c.width],c.height=[c.height];var l=c.width,u=c.height,h=new se;if(null==h||null==e)var d=2;else t(null!=h),d=Ln(e,n,r,h.width,h.height,h.Pd,h.Qd,h.format,null);if(0!=d?l=0:(null!=l&&(l[0]=h.width[0]),null!=u&&(u[0]=h.height[0]),l=1),l){c.width=c.width[0],c.height=c.height[0],null!=a&&(a[0]=c.width),null!=i&&(i[0]=c.height);e:{if(a=new qe,(i=new rn).data=e,i.w=n,i.ha=r,i.kd=1,n=[0],t(null!=i),(0==(e=Ln(i.data,i.w,i.ha,null,null,null,n,null,i))||7==e)&&n[0]&&(e=4),0==(n=e)){if(t(null!=s),a.data=i.data,a.w=i.w+i.offset,a.ha=i.ha-i.offset,a.put=fe,a.ac=de,a.bc=pe,a.ma=s,i.xa){if(null==(e=Te())){s=1;break e}if(function(e,n){var r=[0],a=[0],i=[0];t:for(;;){if(null==e)return 0;if(null==n)return e.a=2,0;if(e.l=n,e.a=0,v(e.m,n.data,n.w,n.ha),!me(e.m,r,a,i)){e.a=3;break t}if(e.xb=ma,n.width=r[0],n.height=a[0],!_e(r[0],a[0],1,e,null))break t;return 1}return t(0!=e.a),0}(e,a)){if(a=0==(n=jn(a.width,a.height,s.Oa,s.ba))){t:{a=e;n:for(;;){if(null==a){a=0;break t}if(t(null!=a.s.yc),t(null!=a.s.Ya),t(0<a.s.Wb),t(null!=(r=a.l)),t(null!=(i=r.ma)),0!=a.xb){if(a.ca=i.ba,a.tb=i.tb,t(null!=a.ca),!Pn(i.Oa,r,Br)){a.a=2;break n}if(!Ae(a,r.width))break n;if(r.da)break n;if((r.da||re(a.ca.S))&&vn(),11>a.ca.S||(alert("todo:WebPInitConvertARGBToYUV"),null!=a.ca.f.kb.F&&vn()),a.Pb&&0<a.s.ua&&null==a.s.vb.X&&!D(a.s.vb,a.s.Wa.Xa)){a.a=1;break n}a.xb=0}if(!Ee(a,a.V,a.Ba,a.c,a.i,r.o,ke))break n;i.Dc=a.Ma,a=1;break t}t(0!=a.a),a=0}a=!a}a&&(n=e.a)}else n=e.a}else{if(null==(e=new Ke)){s=1;break e}if(e.Fa=i.na,e.P=i.P,e.qc=i.Sa,$e(e,a)){if(0==(n=jn(a.width,a.height,s.Oa,s.ba))){if(e.Aa=0,r=s.Oa,t(null!=(i=e)),null!=r){if(0<(l=0>(l=r.Md)?0:100<l?255:255*l/100)){for(u=h=0;4>u;++u)12>(d=i.pb[u]).lc&&(d.ia=l*za[0>d.lc?0:d.lc]>>3),h|=d.ia;h&&(alert("todo:VP8InitRandom"),i.ia=1)}i.Ga=r.Id,100<i.Ga?i.Ga=100:0>i.Ga&&(i.Ga=0)}Ze(e,a)||(n=e.a)}}else n=e.a}0==n&&null!=s.Oa&&s.Oa.fd&&(n=Mn(s.ba))}s=n}o=0!=s?null:11>o?c.f.RGBA.eb:c.f.kb.y}else o=null;return o};var Wa=[3,4,3,4,4,2,2,4,4,4,2,1,1]};function l(e,t){for(var n="",r=0;r<4;r++)n+=String.fromCharCode(e[t++]);return n}function u(e,t){return(e[t+0]|e[t+1]<<8|e[t+2]<<16)>>>0}function h(e,t){return(e[t+0]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}new c;var d=[0],f=[0],p=[],m=new c,g=e,v=function(e,t){var n={},r=0,a=!1,i=0,o=0;if(n.frames=[],!function(e,t){for(var n=0;n<4;n++)if(e[t+n]!="RIFF".charCodeAt(n))return!0;return!1}(e,t)){var s,c;for(h(e,t+=4),t+=8;t<e.length;){var d=l(e,t),f=h(e,t+=4);t+=4;var p=f+(1&f);switch(d){case"VP8 ":case"VP8L":void 0===n.frames[r]&&(n.frames[r]={}),(v=n.frames[r]).src_off=a?o:t-8,v.src_size=i+f+8,r++,a&&(a=!1,i=0,o=0);break;case"VP8X":(v=n.header={}).feature_flags=e[t];var m=t+4;v.canvas_width=1+u(e,m),m+=3,v.canvas_height=1+u(e,m),m+=3;break;case"ALPH":a=!0,i=p+8,o=t-8;break;case"ANIM":(v=n.header).bgcolor=h(e,t),m=t+4,v.loop_count=(s=e)[(c=m)+0]|s[c+1]<<8,m+=2;break;case"ANMF":var g,v;(v=n.frames[r]={}).offset_x=2*u(e,t),t+=3,v.offset_y=2*u(e,t),t+=3,v.width=1+u(e,t),t+=3,v.height=1+u(e,t),t+=3,v.duration=u(e,t),t+=3,g=e[t++],v.dispose=1&g,v.blend=g>>1&1}"ANMF"!=d&&(t+=p)}return n}}(g,0);v.response=g,v.rgbaoutput=!0,v.dataurl=!1;var b=v.header?v.header:null,y=v.frames?v.frames:null;if(b){b.loop_counter=b.loop_count,d=[b.canvas_height],f=[b.canvas_width];for(var x=0;x<y.length&&0!=y[x].blend;x++);}var w=y[0],k=m.WebPDecodeRGBA(g,w.src_off,w.src_size,f,d);w.rgba=k,w.imgwidth=f[0],w.imgheight=d[0];for(var S=0;S<f[0]*d[0]*4;S++)p[S]=k[S];return this.width=f,this.height=d,this.data=p,this}!function(e){var t=function(t,r,c,l){var u=4,h=i;switch(l){case e.image_compression.FAST:u=1,h=a;break;case e.image_compression.MEDIUM:u=6,h=o;break;case e.image_compression.SLOW:u=9,h=s}var d=Y(t=n(t,r,c,h),{level:u});return e.__addimage__.arrayBufferToBinaryString(d)},n=function(e,t,n,r){for(var a,i,o,s=e.length/t,c=new Uint8Array(e.length+s),h=l(),d=0;d<s;d+=1){if(o=d*t,a=e.subarray(o,o+t),r)c.set(r(a,n,i),o+d);else{for(var f,p=h.length,m=[];f<p;f+=1)m[f]=h[f](a,n,i);var g=u(m.concat());c.set(m[g],o+d)}i=a}return c},r=function(e){var t=Array.apply([],e);return t.unshift(0),t},a=function(e,t){var n,r=[],a=e.length;r[0]=1;for(var i=0;i<a;i+=1)n=e[i-t]||0,r[i+1]=e[i]-n+256&255;return r},i=function(e,t,n){var r,a=[],i=e.length;a[0]=2;for(var o=0;o<i;o+=1)r=n&&n[o]||0,a[o+1]=e[o]-r+256&255;return a},o=function(e,t,n){var r,a,i=[],o=e.length;i[0]=3;for(var s=0;s<o;s+=1)r=e[s-t]||0,a=n&&n[s]||0,i[s+1]=e[s]+256-(r+a>>>1)&255;return i},s=function(e,t,n){var r,a,i,o,s=[],l=e.length;s[0]=4;for(var u=0;u<l;u+=1)r=e[u-t]||0,a=n&&n[u]||0,i=n&&n[u-t]||0,o=c(r,a,i),s[u+1]=e[u]-o+256&255;return s},c=function(e,t,n){if(e===t&&t===n)return e;var r=Math.abs(t-n),a=Math.abs(e-n),i=Math.abs(e+t-n-n);return r<=a&&r<=i?e:a<=i?t:n},l=function(){return[r,a,i,o,s]},u=function(e){var t=e.map(function(e){return e.reduce(function(e,t){return e+Math.abs(t)},0)});return t.indexOf(Math.min.apply(null,t))};e.processPNG=function(n,r,a,i){var o,s,c,l,u,h,d,f,p,m,g,v,b,y,x,w=this.decode.FLATE_DECODE,k="";if(this.__addimage__.isArrayBuffer(n)&&(n=new Uint8Array(n)),this.__addimage__.isArrayBufferView(n)){if(n=(c=new Vt(n)).imgData,s=c.bits,o=c.colorSpace,u=c.colors,-1!==[4,6].indexOf(c.colorType)){if(8===c.bits){p=(f=32==c.pixelBitlength?new Uint32Array(c.decodePixels().buffer):16==c.pixelBitlength?new Uint16Array(c.decodePixels().buffer):new Uint8Array(c.decodePixels().buffer)).length,g=new Uint8Array(p*c.colors),m=new Uint8Array(p);var S,N=c.pixelBitlength-c.bits;for(y=0,x=0;y<p;y++){for(b=f[y],S=0;S<N;)g[x++]=b>>>S&255,S+=c.bits;m[y]=b>>>S&255}}if(16===c.bits){p=(f=new Uint32Array(c.decodePixels().buffer)).length,g=new Uint8Array(p*(32/c.pixelBitlength)*c.colors),m=new Uint8Array(p*(32/c.pixelBitlength)),v=c.colors>1,y=0,x=0;for(var C=0;y<p;)b=f[y++],g[x++]=b>>>0&255,v&&(g[x++]=b>>>16&255,b=f[y++],g[x++]=b>>>0&255),m[C++]=b>>>16&255;s=8}i!==e.image_compression.NONE?(n=t(g,c.width*c.colors,c.colors,i),d=t(m,c.width,1,i)):(n=g,d=m,w=void 0)}if(3===c.colorType&&(o=this.color_spaces.INDEXED,h=c.palette,c.transparency.indexed)){var E=c.transparency.indexed,I=0;for(y=0,p=E.length;y<p;++y)I+=E[y];if((I/=255)===p-1&&-1!==E.indexOf(0))l=[E.indexOf(0)];else if(I!==p){for(f=c.decodePixels(),m=new Uint8Array(f.length),y=0,p=f.length;y<p;y++)m[y]=E[f[y]];d=t(m,c.width,1)}}var T=function(t){var n;switch(t){case e.image_compression.FAST:n=11;break;case e.image_compression.MEDIUM:n=13;break;case e.image_compression.SLOW:n=14;break;default:n=12}return n}(i);return w===this.decode.FLATE_DECODE&&(k="/Predictor "+T+" "),k+="/Colors "+u+" /BitsPerComponent "+s+" /Columns "+c.width,(this.__addimage__.isArrayBuffer(n)||this.__addimage__.isArrayBufferView(n))&&(n=this.__addimage__.arrayBufferToBinaryString(n)),(d&&this.__addimage__.isArrayBuffer(d)||this.__addimage__.isArrayBufferView(d))&&(d=this.__addimage__.arrayBufferToBinaryString(d)),{alias:a,data:n,index:r,filter:w,decodeParameters:k,transparency:l,palette:h,sMask:d,predictor:T,width:c.width,height:c.height,bitsPerComponent:s,colorSpace:o}}}}(Ae.API),function(e){e.processGIF89A=function(t,n,r,a){var i=new Ht(t),o=i.width,s=i.height,c=[];i.decodeAndBlitFrameRGBA(0,c);var l={data:c,width:o,height:s},u=new qt(100).encode(l,100);return e.processJPEG.call(this,u,n,r,a)},e.processGIF87A=e.processGIF89A}(Ae.API),Kt.prototype.parseHeader=function(){if(this.fileSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.reserved=this.datav.getUint32(this.pos,!0),this.pos+=4,this.offset=this.datav.getUint32(this.pos,!0),this.pos+=4,this.headerSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.width=this.datav.getUint32(this.pos,!0),this.pos+=4,this.height=this.datav.getInt32(this.pos,!0),this.pos+=4,this.planes=this.datav.getUint16(this.pos,!0),this.pos+=2,this.bitPP=this.datav.getUint16(this.pos,!0),this.pos+=2,this.compress=this.datav.getUint32(this.pos,!0),this.pos+=4,this.rawSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.hr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.vr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.colors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.importantColors=this.datav.getUint32(this.pos,!0),this.pos+=4,16===this.bitPP&&this.is_with_alpha&&(this.bitPP=15),this.bitPP<15){var e=0===this.colors?1<<this.bitPP:this.colors;this.palette=new Array(e);for(var t=0;t<e;t++){var n=this.datav.getUint8(this.pos++,!0),r=this.datav.getUint8(this.pos++,!0),a=this.datav.getUint8(this.pos++,!0),i=this.datav.getUint8(this.pos++,!0);this.palette[t]={red:a,green:r,blue:n,quad:i}}}this.height<0&&(this.height*=-1,this.bottom_up=!1)},Kt.prototype.parseBGR=function(){this.pos=this.offset;try{var e="bit"+this.bitPP,t=this.width*this.height*4;this.data=new Uint8Array(t),this[e]()}catch(e){Z.log("bit decode error:"+e)}},Kt.prototype.bit1=function(){var e,t=Math.ceil(this.width/8),n=t%4;for(e=this.height-1;e>=0;e--){for(var r=this.bottom_up?e:this.height-1-e,a=0;a<t;a++)for(var i=this.datav.getUint8(this.pos++,!0),o=r*this.width*4+8*a*4,s=0;s<8&&8*a+s<this.width;s++){var c=this.palette[i>>7-s&1];this.data[o+4*s]=c.blue,this.data[o+4*s+1]=c.green,this.data[o+4*s+2]=c.red,this.data[o+4*s+3]=255}0!==n&&(this.pos+=4-n)}},Kt.prototype.bit4=function(){for(var e=Math.ceil(this.width/2),t=e%4,n=this.height-1;n>=0;n--){for(var r=this.bottom_up?n:this.height-1-n,a=0;a<e;a++){var i=this.datav.getUint8(this.pos++,!0),o=r*this.width*4+2*a*4,s=i>>4,c=15&i,l=this.palette[s];if(this.data[o]=l.blue,this.data[o+1]=l.green,this.data[o+2]=l.red,this.data[o+3]=255,2*a+1>=this.width)break;l=this.palette[c],this.data[o+4]=l.blue,this.data[o+4+1]=l.green,this.data[o+4+2]=l.red,this.data[o+4+3]=255}0!==t&&(this.pos+=4-t)}},Kt.prototype.bit8=function(){for(var e=this.width%4,t=this.height-1;t>=0;t--){for(var n=this.bottom_up?t:this.height-1-t,r=0;r<this.width;r++){var a=this.datav.getUint8(this.pos++,!0),i=n*this.width*4+4*r;if(a<this.palette.length){var o=this.palette[a];this.data[i]=o.red,this.data[i+1]=o.green,this.data[i+2]=o.blue,this.data[i+3]=255}else this.data[i]=255,this.data[i+1]=255,this.data[i+2]=255,this.data[i+3]=255}0!==e&&(this.pos+=4-e)}},Kt.prototype.bit15=function(){for(var e=this.width%3,t=parseInt("11111",2),n=this.height-1;n>=0;n--){for(var r=this.bottom_up?n:this.height-1-n,a=0;a<this.width;a++){var i=this.datav.getUint16(this.pos,!0);this.pos+=2;var o=(i&t)/t*255|0,s=(i>>5&t)/t*255|0,c=(i>>10&t)/t*255|0,l=i>>15?255:0,u=r*this.width*4+4*a;this.data[u]=c,this.data[u+1]=s,this.data[u+2]=o,this.data[u+3]=l}this.pos+=e}},Kt.prototype.bit16=function(){for(var e=this.width%3,t=parseInt("11111",2),n=parseInt("111111",2),r=this.height-1;r>=0;r--){for(var a=this.bottom_up?r:this.height-1-r,i=0;i<this.width;i++){var o=this.datav.getUint16(this.pos,!0);this.pos+=2;var s=(o&t)/t*255|0,c=(o>>5&n)/n*255|0,l=(o>>11)/t*255|0,u=a*this.width*4+4*i;this.data[u]=l,this.data[u+1]=c,this.data[u+2]=s,this.data[u+3]=255}this.pos+=e}},Kt.prototype.bit24=function(){for(var e=this.height-1;e>=0;e--){for(var t=this.bottom_up?e:this.height-1-e,n=0;n<this.width;n++){var r=this.datav.getUint8(this.pos++,!0),a=this.datav.getUint8(this.pos++,!0),i=this.datav.getUint8(this.pos++,!0),o=t*this.width*4+4*n;this.data[o]=i,this.data[o+1]=a,this.data[o+2]=r,this.data[o+3]=255}this.pos+=this.width%4}},Kt.prototype.bit32=function(){for(var e=this.height-1;e>=0;e--)for(var t=this.bottom_up?e:this.height-1-e,n=0;n<this.width;n++){var r=this.datav.getUint8(this.pos++,!0),a=this.datav.getUint8(this.pos++,!0),i=this.datav.getUint8(this.pos++,!0),o=this.datav.getUint8(this.pos++,!0),s=t*this.width*4+4*n;this.data[s]=i,this.data[s+1]=a,this.data[s+2]=r,this.data[s+3]=o}},Kt.prototype.getData=function(){return this.data},function(e){e.processBMP=function(t,n,r,a){var i=new Kt(t,!1),o=i.width,s=i.height,c={data:i.getData(),width:o,height:s},l=new qt(100).encode(c,100);return e.processJPEG.call(this,l,n,r,a)}}(Ae.API),Xt.prototype.getData=function(){return this.data},function(e){e.processWEBP=function(t,n,r,a){var i=new Xt(t,!1),o=i.width,s=i.height,c={data:i.getData(),width:o,height:s},l=new qt(100).encode(c,100);return e.processJPEG.call(this,l,n,r,a)}}(Ae.API),Ae.API.processRGBA=function(e,t,n){for(var r=e.data,a=r.length,i=new Uint8Array(a/4*3),o=new Uint8Array(a/4),s=0,c=0,l=0;l<a;l+=4){var u=r[l],h=r[l+1],d=r[l+2],f=r[l+3];i[s++]=u,i[s++]=h,i[s++]=d,o[c++]=f}var p=this.__addimage__.arrayBufferToBinaryString(i);return{alpha:this.__addimage__.arrayBufferToBinaryString(o),data:p,index:t,alias:n,colorSpace:"DeviceRGB",bitsPerComponent:8,width:e.width,height:e.height}},Ae.API.setLanguage=function(e){return void 0===this.internal.languageSettings&&(this.internal.languageSettings={},this.internal.languageSettings.isSubscribed=!1),void 0!=={af:"Afrikaans",sq:"Albanian",ar:"Arabic (Standard)","ar-DZ":"Arabic (Algeria)","ar-BH":"Arabic (Bahrain)","ar-EG":"Arabic (Egypt)","ar-IQ":"Arabic (Iraq)","ar-JO":"Arabic (Jordan)","ar-KW":"Arabic (Kuwait)","ar-LB":"Arabic (Lebanon)","ar-LY":"Arabic (Libya)","ar-MA":"Arabic (Morocco)","ar-OM":"Arabic (Oman)","ar-QA":"Arabic (Qatar)","ar-SA":"Arabic (Saudi Arabia)","ar-SY":"Arabic (Syria)","ar-TN":"Arabic (Tunisia)","ar-AE":"Arabic (U.A.E.)","ar-YE":"Arabic (Yemen)",an:"Aragonese",hy:"Armenian",as:"Assamese",ast:"Asturian",az:"Azerbaijani",eu:"Basque",be:"Belarusian",bn:"Bengali",bs:"Bosnian",br:"Breton",bg:"Bulgarian",my:"Burmese",ca:"Catalan",ch:"Chamorro",ce:"Chechen",zh:"Chinese","zh-HK":"Chinese (Hong Kong)","zh-CN":"Chinese (PRC)","zh-SG":"Chinese (Singapore)","zh-TW":"Chinese (Taiwan)",cv:"Chuvash",co:"Corsican",cr:"Cree",hr:"Croatian",cs:"Czech",da:"Danish",nl:"Dutch (Standard)","nl-BE":"Dutch (Belgian)",en:"English","en-AU":"English (Australia)","en-BZ":"English (Belize)","en-CA":"English (Canada)","en-IE":"English (Ireland)","en-JM":"English (Jamaica)","en-NZ":"English (New Zealand)","en-PH":"English (Philippines)","en-ZA":"English (South Africa)","en-TT":"English (Trinidad & Tobago)","en-GB":"English (United Kingdom)","en-US":"English (United States)","en-ZW":"English (Zimbabwe)",eo:"Esperanto",et:"Estonian",fo:"Faeroese",fj:"Fijian",fi:"Finnish",fr:"French (Standard)","fr-BE":"French (Belgium)","fr-CA":"French (Canada)","fr-FR":"French (France)","fr-LU":"French (Luxembourg)","fr-MC":"French (Monaco)","fr-CH":"French (Switzerland)",fy:"Frisian",fur:"Friulian",gd:"Gaelic (Scots)","gd-IE":"Gaelic (Irish)",gl:"Galacian",ka:"Georgian",de:"German (Standard)","de-AT":"German (Austria)","de-DE":"German (Germany)","de-LI":"German (Liechtenstein)","de-LU":"German (Luxembourg)","de-CH":"German (Switzerland)",el:"Greek",gu:"Gujurati",ht:"Haitian",he:"Hebrew",hi:"Hindi",hu:"Hungarian",is:"Icelandic",id:"Indonesian",iu:"Inuktitut",ga:"Irish",it:"Italian (Standard)","it-CH":"Italian (Switzerland)",ja:"Japanese",kn:"Kannada",ks:"Kashmiri",kk:"Kazakh",km:"Khmer",ky:"Kirghiz",tlh:"Klingon",ko:"Korean","ko-KP":"Korean (North Korea)","ko-KR":"Korean (South Korea)",la:"Latin",lv:"Latvian",lt:"Lithuanian",lb:"Luxembourgish",mk:"North Macedonia",ms:"Malay",ml:"Malayalam",mt:"Maltese",mi:"Maori",mr:"Marathi",mo:"Moldavian",nv:"Navajo",ng:"Ndonga",ne:"Nepali",no:"Norwegian",nb:"Norwegian (Bokmal)",nn:"Norwegian (Nynorsk)",oc:"Occitan",or:"Oriya",om:"Oromo",fa:"Persian","fa-IR":"Persian/Iran",pl:"Polish",pt:"Portuguese","pt-BR":"Portuguese (Brazil)",pa:"Punjabi","pa-IN":"Punjabi (India)","pa-PK":"Punjabi (Pakistan)",qu:"Quechua",rm:"Rhaeto-Romanic",ro:"Romanian","ro-MO":"Romanian (Moldavia)",ru:"Russian","ru-MO":"Russian (Moldavia)",sz:"Sami (Lappish)",sg:"Sango",sa:"Sanskrit",sc:"Sardinian",sd:"Sindhi",si:"Singhalese",sr:"Serbian",sk:"Slovak",sl:"Slovenian",so:"Somani",sb:"Sorbian",es:"Spanish","es-AR":"Spanish (Argentina)","es-BO":"Spanish (Bolivia)","es-CL":"Spanish (Chile)","es-CO":"Spanish (Colombia)","es-CR":"Spanish (Costa Rica)","es-DO":"Spanish (Dominican Republic)","es-EC":"Spanish (Ecuador)","es-SV":"Spanish (El Salvador)","es-GT":"Spanish (Guatemala)","es-HN":"Spanish (Honduras)","es-MX":"Spanish (Mexico)","es-NI":"Spanish (Nicaragua)","es-PA":"Spanish (Panama)","es-PY":"Spanish (Paraguay)","es-PE":"Spanish (Peru)","es-PR":"Spanish (Puerto Rico)","es-ES":"Spanish (Spain)","es-UY":"Spanish (Uruguay)","es-VE":"Spanish (Venezuela)",sx:"Sutu",sw:"Swahili",sv:"Swedish","sv-FI":"Swedish (Finland)","sv-SV":"Swedish (Sweden)",ta:"Tamil",tt:"Tatar",te:"Teluga",th:"Thai",tig:"Tigre",ts:"Tsonga",tn:"Tswana",tr:"Turkish",tk:"Turkmen",uk:"Ukrainian",hsb:"Upper Sorbian",ur:"Urdu",ve:"Venda",vi:"Vietnamese",vo:"Volapuk",wa:"Walloon",cy:"Welsh",xh:"Xhosa",ji:"Yiddish",zu:"Zulu"}[e]&&(this.internal.languageSettings.languageCode=e,!1===this.internal.languageSettings.isSubscribed&&(this.internal.events.subscribe("putCatalog",function(){this.internal.write("/Lang ("+this.internal.languageSettings.languageCode+")")}),this.internal.languageSettings.isSubscribed=!0)),this},jt=Ae.API,Bt=jt.getCharWidthsArray=function(e,t){var n,a,i=(t=t||{}).font||this.internal.getFont(),o=t.fontSize||this.internal.getFontSize(),s=t.charSpace||this.internal.getCharSpace(),c=t.widths?t.widths:i.metadata.Unicode.widths,l=c.fof?c.fof:1,u=t.kerning?t.kerning:i.metadata.Unicode.kerning,h=u.fof?u.fof:1,d=!1!==t.doKerning,f=0,p=e.length,m=0,g=c[0]||l,v=[];for(n=0;n<p;n++)a=e.charCodeAt(n),"function"==typeof i.metadata.widthOfString?v.push((i.metadata.widthOfGlyph(i.metadata.characterToGlyph(a))+s*(1e3/o)||0)/1e3):(f=d&&"object"===(0,r.A)(u[a])&&!isNaN(parseInt(u[a][m],10))?u[a][m]/h:0,v.push((c[a]||g)/l+f)),m=a;return v},zt=jt.getStringUnitWidth=function(e,t){var n=(t=t||{}).fontSize||this.internal.getFontSize(),r=t.font||this.internal.getFont(),a=t.charSpace||this.internal.getCharSpace();return jt.processArabic&&(e=jt.processArabic(e)),"function"==typeof r.metadata.widthOfString?r.metadata.widthOfString(e,n,a)/n:Bt.apply(this,arguments).reduce(function(e,t){return e+t},0)},Ut=function(e,t,n,r){for(var a=[],i=0,o=e.length,s=0;i!==o&&s+t[i]<n;)s+=t[i],i++;a.push(e.slice(0,i));var c=i;for(s=0;i!==o;)s+t[i]>r&&(a.push(e.slice(c,i)),s=0,c=i),s+=t[i],i++;return c!==i&&a.push(e.slice(c,i)),a},Wt=function(e,t,n){n||(n={});var r,a,i,o,s,c,l,u=[],h=[u],d=n.textIndent||0,f=0,p=0,m=e.split(" "),g=Bt.apply(this,[" ",n])[0];if(c=-1===n.lineIndent?m[0].length+2:n.lineIndent||0){var v=Array(c).join(" "),b=[];m.map(function(e){(e=e.split(/\s*\n/)).length>1?b=b.concat(e.map(function(e,t){return(t&&e.length?"\n":"")+e})):b.push(e[0])}),m=b,c=zt.apply(this,[v,n])}for(i=0,o=m.length;i<o;i++){var y=0;if(r=m[i],c&&"\n"==r[0]&&(r=r.substr(1),y=1),d+f+(p=(a=Bt.apply(this,[r,n])).reduce(function(e,t){return e+t},0))>t||y){if(p>t){for(s=Ut.apply(this,[r,a,t-(d+f),t]),u.push(s.shift()),u=[s.pop()];s.length;)h.push([s.shift()]);p=a.slice(r.length-(u[0]?u[0].length:0)).reduce(function(e,t){return e+t},0)}else u=[r];h.push(u),d=p+c,f=g}else u.push(r),d+=f+p,f=g}return l=c?function(e,t){return(t?v:"")+e.join(" ")}:function(e){return e.join(" ")},h.map(l)},jt.splitTextToSize=function(e,t,n){var r,a=(n=n||{}).fontSize||this.internal.getFontSize(),i=function(e){if(e.widths&&e.kerning)return{widths:e.widths,kerning:e.kerning};var t=this.internal.getFont(e.fontName,e.fontStyle);return t.metadata.Unicode?{widths:t.metadata.Unicode.widths||{0:1},kerning:t.metadata.Unicode.kerning||{}}:{font:t.metadata,fontSize:this.internal.getFontSize(),charSpace:this.internal.getCharSpace()}}.call(this,n);r=Array.isArray(e)?e:String(e).split(/\r?\n/);var o=1*this.internal.scaleFactor*t/a;i.textIndent=n.textIndent?1*n.textIndent*this.internal.scaleFactor/a:0,i.lineIndent=n.lineIndent;var s,c,l=[];for(s=0,c=r.length;s<c;s++)l=l.concat(Wt.apply(this,[r[s],o,i]));return l},function(e){e.__fontmetrics__=e.__fontmetrics__||{};for(var t="klmnopqrstuvwxyz",n={},a={},i=0;i<16;i++)n[t[i]]="0123456789abcdef"[i],a["0123456789abcdef"[i]]=t[i];var o=function(e){return"0x"+parseInt(e,10).toString(16)},s=e.__fontmetrics__.compress=function(e){var t,n,i,c,l=["{"];for(var u in e){if(t=e[u],isNaN(parseInt(u,10))?n="'"+u+"'":(u=parseInt(u,10),n=(n=o(u).slice(2)).slice(0,-1)+a[n.slice(-1)]),"number"==typeof t)t<0?(i=o(t).slice(3),c="-"):(i=o(t).slice(2),c=""),i=c+i.slice(0,-1)+a[i.slice(-1)];else{if("object"!==(0,r.A)(t))throw new Error("Don't know what to do with value type "+(0,r.A)(t)+".");i=s(t)}l.push(n+i)}return l.push("}"),l.join("")},c=e.__fontmetrics__.uncompress=function(e){if("string"!=typeof e)throw new Error("Invalid argument passed to uncompress.");for(var t,r,a,i,o={},s=1,c=o,l=[],u="",h="",d=e.length-1,f=1;f<d;f+=1)"'"==(i=e[f])?t?(a=t.join(""),t=void 0):t=[]:t?t.push(i):"{"==i?(l.push([c,a]),c={},a=void 0):"}"==i?((r=l.pop())[0][r[1]]=c,a=void 0,c=r[0]):"-"==i?s=-1:void 0===a?n.hasOwnProperty(i)?(u+=n[i],a=parseInt(u,16)*s,s=1,u=""):u+=i:n.hasOwnProperty(i)?(h+=n[i],c[a]=parseInt(h,16)*s,s=1,a=void 0,h=""):h+=i;return o},l={codePages:["WinAnsiEncoding"],WinAnsiEncoding:c("{19m8n201n9q201o9r201s9l201t9m201u8m201w9n201x9o201y8o202k8q202l8r202m9p202q8p20aw8k203k8t203t8v203u9v2cq8s212m9t15m8w15n9w2dw9s16k8u16l9u17s9z17x8y17y9y}")},u={Unicode:{Courier:l,"Courier-Bold":l,"Courier-BoldOblique":l,"Courier-Oblique":l,Helvetica:l,"Helvetica-Bold":l,"Helvetica-BoldOblique":l,"Helvetica-Oblique":l,"Times-Roman":l,"Times-Bold":l,"Times-BoldItalic":l,"Times-Italic":l}},h={Unicode:{"Courier-Oblique":c("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-BoldItalic":c("{'widths'{k3o2q4ycx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2r202m2n2n3m2o3m2p5n202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5n4l4m4m4m4n4m4o4s4p4m4q4m4r4s4s4y4t2r4u3m4v4m4w3x4x5t4y4s4z4s5k3x5l4s5m4m5n3r5o3x5p4s5q4m5r5t5s4m5t3x5u3x5v2l5w1w5x2l5y3t5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q2l6r3m6s3r6t1w6u1w6v3m6w1w6x4y6y3r6z3m7k3m7l3m7m2r7n2r7o1w7p3r7q2w7r4m7s3m7t2w7u2r7v2n7w1q7x2n7y3t202l3mcl4mal2ram3man3mao3map3mar3mas2lat4uau1uav3maw3way4uaz2lbk2sbl3t'fof'6obo2lbp3tbq3mbr1tbs2lbu1ybv3mbz3mck4m202k3mcm4mcn4mco4mcp4mcq5ycr4mcs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz2w203k6o212m6o2dw2l2cq2l3t3m3u2l17s3x19m3m}'kerning'{cl{4qu5kt5qt5rs17ss5ts}201s{201ss}201t{cks4lscmscnscoscpscls2wu2yu201ts}201x{2wu2yu}2k{201ts}2w{4qx5kx5ou5qx5rs17su5tu}2x{17su5tu5ou}2y{4qx5kx5ou5qx5rs17ss5ts}'fof'-6ofn{17sw5tw5ou5qw5rs}7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qs}3v{17su5tu5os5qs}7p{17su5tu}ck{4qu5kt5qt5rs17ss5ts}4l{4qu5kt5qt5rs17ss5ts}cm{4qu5kt5qt5rs17ss5ts}cn{4qu5kt5qt5rs17ss5ts}co{4qu5kt5qt5rs17ss5ts}cp{4qu5kt5qt5rs17ss5ts}6l{4qu5ou5qw5rt17su5tu}5q{ckuclucmucnucoucpu4lu}5r{ckuclucmucnucoucpu4lu}7q{cksclscmscnscoscps4ls}6p{4qu5ou5qw5rt17sw5tw}ek{4qu5ou5qw5rt17su5tu}el{4qu5ou5qw5rt17su5tu}em{4qu5ou5qw5rt17su5tu}en{4qu5ou5qw5rt17su5tu}eo{4qu5ou5qw5rt17su5tu}ep{4qu5ou5qw5rt17su5tu}es{17ss5ts5qs4qu}et{4qu5ou5qw5rt17sw5tw}eu{4qu5ou5qw5rt17ss5ts}ev{17ss5ts5qs4qu}6z{17sw5tw5ou5qw5rs}fm{17sw5tw5ou5qw5rs}7n{201ts}fo{17sw5tw5ou5qw5rs}fp{17sw5tw5ou5qw5rs}fq{17sw5tw5ou5qw5rs}7r{cksclscmscnscoscps4ls}fs{17sw5tw5ou5qw5rs}ft{17su5tu}fu{17su5tu}fv{17su5tu}fw{17su5tu}fz{cksclscmscnscoscps4ls}}}"),"Helvetica-Bold":c("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),Courier:c("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-BoldOblique":c("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Bold":c("{'widths'{k3q2q5ncx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2l202m2n2n3m2o3m2p6o202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5x4l4s4m4m4n4s4o4s4p4m4q3x4r4y4s4y4t2r4u3m4v4y4w4m4x5y4y4s4z4y5k3x5l4y5m4s5n3r5o4m5p4s5q4s5r6o5s4s5t4s5u4m5v2l5w1w5x2l5y3u5z3m6k2l6l3m6m3r6n2w6o3r6p2w6q2l6r3m6s3r6t1w6u2l6v3r6w1w6x5n6y3r6z3m7k3r7l3r7m2w7n2r7o2l7p3r7q3m7r4s7s3m7t3m7u2w7v2r7w1q7x2r7y3o202l3mcl4sal2lam3man3mao3map3mar3mas2lat4uau1yav3maw3tay4uaz2lbk2sbl3t'fof'6obo2lbp3rbr1tbs2lbu2lbv3mbz3mck4s202k3mcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3rek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3m3u2l17s4s19m3m}'kerning'{cl{4qt5ks5ot5qy5rw17sv5tv}201t{cks4lscmscnscoscpscls4wv}2k{201ts}2w{4qu5ku7mu5os5qx5ru17su5tu}2x{17su5tu5ou5qs}2y{4qv5kv7mu5ot5qz5ru17su5tu}'fof'-6o7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qu}3v{17su5tu5os5qu}fu{17su5tu5ou5qu}7p{17su5tu5ou5qu}ck{4qt5ks5ot5qy5rw17sv5tv}4l{4qt5ks5ot5qy5rw17sv5tv}cm{4qt5ks5ot5qy5rw17sv5tv}cn{4qt5ks5ot5qy5rw17sv5tv}co{4qt5ks5ot5qy5rw17sv5tv}cp{4qt5ks5ot5qy5rw17sv5tv}6l{17st5tt5ou5qu}17s{ckuclucmucnucoucpu4lu4wu}5o{ckuclucmucnucoucpu4lu4wu}5q{ckzclzcmzcnzcozcpz4lz4wu}5r{ckxclxcmxcnxcoxcpx4lx4wu}5t{ckuclucmucnucoucpu4lu4wu}7q{ckuclucmucnucoucpu4lu}6p{17sw5tw5ou5qu}ek{17st5tt5qu}el{17st5tt5ou5qu}em{17st5tt5qu}en{17st5tt5qu}eo{17st5tt5qu}ep{17st5tt5ou5qu}es{17ss5ts5qu}et{17sw5tw5ou5qu}eu{17sw5tw5ou5qu}ev{17ss5ts5qu}6z{17sw5tw5ou5qu5rs}fm{17sw5tw5ou5qu5rs}fn{17sw5tw5ou5qu5rs}fo{17sw5tw5ou5qu5rs}fp{17sw5tw5ou5qu5rs}fq{17sw5tw5ou5qu5rs}7r{cktcltcmtcntcotcpt4lt5os}fs{17sw5tw5ou5qu5rs}ft{17su5tu5ou5qu}7m{5os}fv{17su5tu5ou5qu}fw{17su5tu5ou5qu}fz{cksclscmscnscoscps4ls}}}"),Symbol:c("{'widths'{k3uaw4r19m3m2k1t2l2l202m2y2n3m2p5n202q6o3k3m2s2l2t2l2v3r2w1t3m3m2y1t2z1wbk2sbl3r'fof'6o3n3m3o3m3p3m3q3m3r3m3s3m3t3m3u1w3v1w3w3r3x3r3y3r3z2wbp3t3l3m5v2l5x2l5z3m2q4yfr3r7v3k7w1o7x3k}'kerning'{'fof'-6o}}"),Helvetica:c("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}"),"Helvetica-BoldOblique":c("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),ZapfDingbats:c("{'widths'{k4u2k1w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-Bold":c("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Italic":c("{'widths'{k3n2q4ycx2l201n3m201o5t201s2l201t2l201u2l201w3r201x3r201y3r2k1t2l2l202m2n2n3m2o3m2p5n202q5t2r1p2s2l2t2l2u3m2v4n2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w4n3x4n3y4n3z3m4k5w4l3x4m3x4n4m4o4s4p3x4q3x4r4s4s4s4t2l4u2w4v4m4w3r4x5n4y4m4z4s5k3x5l4s5m3x5n3m5o3r5p4s5q3x5r5n5s3x5t3r5u3r5v2r5w1w5x2r5y2u5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q1w6r3m6s3m6t1w6u1w6v2w6w1w6x4s6y3m6z3m7k3m7l3m7m2r7n2r7o1w7p3m7q2w7r4m7s2w7t2w7u2r7v2s7w1v7x2s7y3q202l3mcl3xal2ram3man3mao3map3mar3mas2lat4wau1vav3maw4nay4waz2lbk2sbl4n'fof'6obo2lbp3mbq3obr1tbs2lbu1zbv3mbz3mck3x202k3mcm3xcn3xco3xcp3xcq5tcr4mcs3xct3xcu3xcv3xcw2l2m2ucy2lcz2ldl4mdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr4nfs3mft3mfu3mfv3mfw3mfz2w203k6o212m6m2dw2l2cq2l3t3m3u2l17s3r19m3m}'kerning'{cl{5kt4qw}201s{201sw}201t{201tw2wy2yy6q-t}201x{2wy2yy}2k{201tw}2w{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}2x{17ss5ts5os}2y{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}'fof'-6o6t{17ss5ts5qs}7t{5os}3v{5qs}7p{17su5tu5qs}ck{5kt4qw}4l{5kt4qw}cm{5kt4qw}cn{5kt4qw}co{5kt4qw}cp{5kt4qw}6l{4qs5ks5ou5qw5ru17su5tu}17s{2ks}5q{ckvclvcmvcnvcovcpv4lv}5r{ckuclucmucnucoucpu4lu}5t{2ks}6p{4qs5ks5ou5qw5ru17su5tu}ek{4qs5ks5ou5qw5ru17su5tu}el{4qs5ks5ou5qw5ru17su5tu}em{4qs5ks5ou5qw5ru17su5tu}en{4qs5ks5ou5qw5ru17su5tu}eo{4qs5ks5ou5qw5ru17su5tu}ep{4qs5ks5ou5qw5ru17su5tu}es{5ks5qs4qs}et{4qs5ks5ou5qw5ru17su5tu}eu{4qs5ks5qw5ru17su5tu}ev{5ks5qs4qs}ex{17ss5ts5qs}6z{4qv5ks5ou5qw5ru17su5tu}fm{4qv5ks5ou5qw5ru17su5tu}fn{4qv5ks5ou5qw5ru17su5tu}fo{4qv5ks5ou5qw5ru17su5tu}fp{4qv5ks5ou5qw5ru17su5tu}fq{4qv5ks5ou5qw5ru17su5tu}7r{5os}fs{4qv5ks5ou5qw5ru17su5tu}ft{17su5tu5qs}fu{17su5tu5qs}fv{17su5tu5qs}fw{17su5tu5qs}}}"),"Times-Roman":c("{'widths'{k3n2q4ycx2l201n3m201o6o201s2l201t2l201u2l201w2w201x2w201y2w2k1t2l2l202m2n2n3m2o3m2p5n202q6o2r1m2s2l2t2l2u3m2v3s2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v1w3w3s3x3s3y3s3z2w4k5w4l4s4m4m4n4m4o4s4p3x4q3r4r4s4s4s4t2l4u2r4v4s4w3x4x5t4y4s4z4s5k3r5l4s5m4m5n3r5o3x5p4s5q4s5r5y5s4s5t4s5u3x5v2l5w1w5x2l5y2z5z3m6k2l6l2w6m3m6n2w6o3m6p2w6q2l6r3m6s3m6t1w6u1w6v3m6w1w6x4y6y3m6z3m7k3m7l3m7m2l7n2r7o1w7p3m7q3m7r4s7s3m7t3m7u2w7v3k7w1o7x3k7y3q202l3mcl4sal2lam3man3mao3map3mar3mas2lat4wau1vav3maw3say4waz2lbk2sbl3s'fof'6obo2lbp3mbq2xbr1tbs2lbu1zbv3mbz2wck4s202k3mcm4scn4sco4scp4scq5tcr4mcs3xct3xcu3xcv3xcw2l2m2tcy2lcz2ldl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek2wel2wem2wen2weo2wep2weq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr3sfs3mft3mfu3mfv3mfw3mfz3m203k6o212m6m2dw2l2cq2l3t3m3u1w17s4s19m3m}'kerning'{cl{4qs5ku17sw5ou5qy5rw201ss5tw201ws}201s{201ss}201t{ckw4lwcmwcnwcowcpwclw4wu201ts}2k{201ts}2w{4qs5kw5os5qx5ru17sx5tx}2x{17sw5tw5ou5qu}2y{4qs5kw5os5qx5ru17sx5tx}'fof'-6o7t{ckuclucmucnucoucpu4lu5os5rs}3u{17su5tu5qs}3v{17su5tu5qs}7p{17sw5tw5qs}ck{4qs5ku17sw5ou5qy5rw201ss5tw201ws}4l{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cm{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cn{4qs5ku17sw5ou5qy5rw201ss5tw201ws}co{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cp{4qs5ku17sw5ou5qy5rw201ss5tw201ws}6l{17su5tu5os5qw5rs}17s{2ktclvcmvcnvcovcpv4lv4wuckv}5o{ckwclwcmwcnwcowcpw4lw4wu}5q{ckyclycmycnycoycpy4ly4wu5ms}5r{cktcltcmtcntcotcpt4lt4ws}5t{2ktclvcmvcnvcovcpv4lv4wuckv}7q{cksclscmscnscoscps4ls}6p{17su5tu5qw5rs}ek{5qs5rs}el{17su5tu5os5qw5rs}em{17su5tu5os5qs5rs}en{17su5qs5rs}eo{5qs5rs}ep{17su5tu5os5qw5rs}es{5qs}et{17su5tu5qw5rs}eu{17su5tu5qs5rs}ev{5qs}6z{17sv5tv5os5qx5rs}fm{5os5qt5rs}fn{17sv5tv5os5qx5rs}fo{17sv5tv5os5qx5rs}fp{5os5qt5rs}fq{5os5qt5rs}7r{ckuclucmucnucoucpu4lu5os}fs{17sv5tv5os5qx5rs}ft{17ss5ts5qs}fu{17sw5tw5qs}fv{17sw5tw5qs}fw{17ss5ts5qs}fz{ckuclucmucnucoucpu4lu5os5rs}}}"),"Helvetica-Oblique":c("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}")}};e.events.push(["addFont",function(e){var t=e.font,n=h.Unicode[t.postScriptName];n&&(t.metadata.Unicode={},t.metadata.Unicode.widths=n.widths,t.metadata.Unicode.kerning=n.kerning);var r=u.Unicode[t.postScriptName];r&&(t.metadata.Unicode.encoding=r,t.encoding=r.codePages[0])}])}(Ae.API),function(e){var t=function(e){for(var t=e.length,n=new Uint8Array(t),r=0;r<t;r++)n[r]=e.charCodeAt(r);return n};e.API.events.push(["addFont",function(n){var r=void 0,a=n.font,i=n.instance;if(!a.isStandardFont){if(void 0===i)throw new Error("Font does not exist in vFS, import fonts or remove declaration doc.addFont('"+a.postScriptName+"').");if("string"!=typeof(r=!1===i.existsFileInVFS(a.postScriptName)?i.loadFile(a.postScriptName):i.getFileFromVFS(a.postScriptName)))throw new Error("Font is not stored as string-data in vFS, import fonts or remove declaration doc.addFont('"+a.postScriptName+"').");!function(n,r){r=/^\x00\x01\x00\x00/.test(r)?t(r):t(re(r)),n.metadata=e.API.TTFFont.open(r),n.metadata.Unicode=n.metadata.Unicode||{encoding:{},kerning:{},widths:[]},n.metadata.glyIdsUsed=[0]}(a,r)}}])}(Ae),function(){function e(){return(J.canvg?Promise.resolve(J.canvg):n.e(239).then(n.bind(n,2239))).catch(function(e){return Promise.reject(new Error("Could not load canvg: "+e))}).then(function(e){return e.default?e.default:e})}Ae.API.addSvgAsImage=function(t,n,r,a,i,o,s,c){if(isNaN(n)||isNaN(r))throw Z.error("jsPDF.addSvgAsImage: Invalid coordinates",arguments),new Error("Invalid coordinates passed to jsPDF.addSvgAsImage");if(isNaN(a)||isNaN(i))throw Z.error("jsPDF.addSvgAsImage: Invalid measurements",arguments),new Error("Invalid measurements (width and/or height) passed to jsPDF.addSvgAsImage");var l=document.createElement("canvas");l.width=a,l.height=i;var u=l.getContext("2d");u.fillStyle="#fff",u.fillRect(0,0,l.width,l.height);var h={ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0},d=this;return e().then(function(e){return e.fromString(u,t,h)},function(){return Promise.reject(new Error("Could not load canvg."))}).then(function(e){return e.render(h)}).then(function(){d.addImage(l.toDataURL("image/jpeg",1),n,r,a,i,s,c)})}}(),Ae.API.putTotalPages=function(e){var t,n=0;parseInt(this.internal.getFont().id.substr(1),10)<15?(t=new RegExp(e,"g"),n=this.internal.getNumberOfPages()):(t=new RegExp(this.pdfEscape16(e,this.internal.getFont()),"g"),n=this.pdfEscape16(this.internal.getNumberOfPages()+"",this.internal.getFont()));for(var r=1;r<=this.internal.getNumberOfPages();r++)for(var a=0;a<this.internal.pages[r].length;a++)this.internal.pages[r][a]=this.internal.pages[r][a].replace(t,n);return this},Ae.API.viewerPreferences=function(e,t){var n;e=e||{},t=t||!1;var a,i,o,s={HideToolbar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideMenubar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideWindowUI:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},FitWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},CenterWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},DisplayDocTitle:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.4},NonFullScreenPageMode:{defaultValue:"UseNone",value:"UseNone",type:"name",explicitSet:!1,valueSet:["UseNone","UseOutlines","UseThumbs","UseOC"],pdfVersion:1.3},Direction:{defaultValue:"L2R",value:"L2R",type:"name",explicitSet:!1,valueSet:["L2R","R2L"],pdfVersion:1.3},ViewArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},ViewClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintScaling:{defaultValue:"AppDefault",value:"AppDefault",type:"name",explicitSet:!1,valueSet:["AppDefault","None"],pdfVersion:1.6},Duplex:{defaultValue:"",value:"none",type:"name",explicitSet:!1,valueSet:["Simplex","DuplexFlipShortEdge","DuplexFlipLongEdge","none"],pdfVersion:1.7},PickTrayByPDFSize:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.7},PrintPageRange:{defaultValue:"",value:"",type:"array",explicitSet:!1,valueSet:null,pdfVersion:1.7},NumCopies:{defaultValue:1,value:1,type:"integer",explicitSet:!1,valueSet:null,pdfVersion:1.7}},c=Object.keys(s),l=[],u=0,h=0,d=0;function f(e,t){var n,r=!1;for(n=0;n<e.length;n+=1)e[n]===t&&(r=!0);return r}if(void 0===this.internal.viewerpreferences&&(this.internal.viewerpreferences={},this.internal.viewerpreferences.configuration=JSON.parse(JSON.stringify(s)),this.internal.viewerpreferences.isSubscribed=!1),n=this.internal.viewerpreferences.configuration,"reset"===e||!0===t){var p=c.length;for(d=0;d<p;d+=1)n[c[d]].value=n[c[d]].defaultValue,n[c[d]].explicitSet=!1}if("object"===(0,r.A)(e))for(i in e)if(o=e[i],f(c,i)&&void 0!==o){if("boolean"===n[i].type&&"boolean"==typeof o)n[i].value=o;else if("name"===n[i].type&&f(n[i].valueSet,o))n[i].value=o;else if("integer"===n[i].type&&Number.isInteger(o))n[i].value=o;else if("array"===n[i].type){for(u=0;u<o.length;u+=1)if(a=!0,1===o[u].length&&"number"==typeof o[u][0])l.push(String(o[u]-1));else if(o[u].length>1){for(h=0;h<o[u].length;h+=1)"number"!=typeof o[u][h]&&(a=!1);!0===a&&l.push([o[u][0]-1,o[u][1]-1].join(" "))}n[i].value="["+l.join(" ")+"]"}else n[i].value=n[i].defaultValue;n[i].explicitSet=!0}return!1===this.internal.viewerpreferences.isSubscribed&&(this.internal.events.subscribe("putCatalog",function(){var e,t=[];for(e in n)!0===n[e].explicitSet&&("name"===n[e].type?t.push("/"+e+" /"+n[e].value):t.push("/"+e+" "+n[e].value));0!==t.length&&this.internal.write("/ViewerPreferences\n<<\n"+t.join("\n")+"\n>>")}),this.internal.viewerpreferences.isSubscribed=!0),this.internal.viewerpreferences.configuration=n,this},function(e){var t=function(){var e='<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"><rdf:Description rdf:about="" xmlns:jspdf="'+this.internal.__metadata__.namespaceuri+'"><jspdf:metadata>',t=unescape(encodeURIComponent('<x:xmpmeta xmlns:x="adobe:ns:meta/">')),n=unescape(encodeURIComponent(e)),r=unescape(encodeURIComponent(this.internal.__metadata__.metadata)),a=unescape(encodeURIComponent("</jspdf:metadata></rdf:Description></rdf:RDF>")),i=unescape(encodeURIComponent("</x:xmpmeta>")),o=n.length+r.length+a.length+t.length+i.length;this.internal.__metadata__.metadata_object_number=this.internal.newObject(),this.internal.write("<< /Type /Metadata /Subtype /XML /Length "+o+" >>"),this.internal.write("stream"),this.internal.write(t+n+r+a+i),this.internal.write("endstream"),this.internal.write("endobj")},n=function(){this.internal.__metadata__.metadata_object_number&&this.internal.write("/Metadata "+this.internal.__metadata__.metadata_object_number+" 0 R")};e.addMetadata=function(e,r){return void 0===this.internal.__metadata__&&(this.internal.__metadata__={metadata:e,namespaceuri:r||"http://jspdf.default.namespaceuri/"},this.internal.events.subscribe("putCatalog",n),this.internal.events.subscribe("postPutResources",t)),this}}(Ae.API),function(e){var t=e.API,n=t.pdfEscape16=function(e,t){for(var n,r=t.metadata.Unicode.widths,a=["","0","00","000","0000"],i=[""],o=0,s=e.length;o<s;++o){if(n=t.metadata.characterToGlyph(e.charCodeAt(o)),t.metadata.glyIdsUsed.push(n),t.metadata.toUnicode[n]=e.charCodeAt(o),-1==r.indexOf(n)&&(r.push(n),r.push([parseInt(t.metadata.widthOfGlyph(n),10)])),"0"==n)return i.join("");n=n.toString(16),i.push(a[4-n.length],n)}return i.join("")},r=function(e){var t,n,r,a,i,o,s;for(i="/CIDInit /ProcSet findresource begin\n12 dict begin\nbegincmap\n/CIDSystemInfo <<\n  /Registry (Adobe)\n  /Ordering (UCS)\n  /Supplement 0\n>> def\n/CMapName /Adobe-Identity-UCS def\n/CMapType 2 def\n1 begincodespacerange\n<0000><ffff>\nendcodespacerange",r=[],o=0,s=(n=Object.keys(e).sort(function(e,t){return e-t})).length;o<s;o++)t=n[o],r.length>=100&&(i+="\n"+r.length+" beginbfchar\n"+r.join("\n")+"\nendbfchar",r=[]),void 0!==e[t]&&null!==e[t]&&"function"==typeof e[t].toString&&(a=("0000"+e[t].toString(16)).slice(-4),t=("0000"+(+t).toString(16)).slice(-4),r.push("<"+t+"><"+a+">"));return r.length&&(i+="\n"+r.length+" beginbfchar\n"+r.join("\n")+"\nendbfchar\n"),i+"endcmap\nCMapName currentdict /CMap defineresource pop\nend\nend"};t.events.push(["putFont",function(t){!function(t){var n=t.font,a=t.out,i=t.newObject,o=t.putStream;if(n.metadata instanceof e.API.TTFFont&&"Identity-H"===n.encoding){for(var s=n.metadata.Unicode.widths,c=n.metadata.subset.encode(n.metadata.glyIdsUsed,1),l="",u=0;u<c.length;u++)l+=String.fromCharCode(c[u]);var h=i();o({data:l,addLength1:!0,objectId:h}),a("endobj");var d=i();o({data:r(n.metadata.toUnicode),addLength1:!0,objectId:d}),a("endobj");var f=i();a("<<"),a("/Type /FontDescriptor"),a("/FontName /"+Ne(n.fontName)),a("/FontFile2 "+h+" 0 R"),a("/FontBBox "+e.API.PDFObject.convert(n.metadata.bbox)),a("/Flags "+n.metadata.flags),a("/StemV "+n.metadata.stemV),a("/ItalicAngle "+n.metadata.italicAngle),a("/Ascent "+n.metadata.ascender),a("/Descent "+n.metadata.decender),a("/CapHeight "+n.metadata.capHeight),a(">>"),a("endobj");var p=i();a("<<"),a("/Type /Font"),a("/BaseFont /"+Ne(n.fontName)),a("/FontDescriptor "+f+" 0 R"),a("/W "+e.API.PDFObject.convert(s)),a("/CIDToGIDMap /Identity"),a("/DW 1000"),a("/Subtype /CIDFontType2"),a("/CIDSystemInfo"),a("<<"),a("/Supplement 0"),a("/Registry (Adobe)"),a("/Ordering ("+n.encoding+")"),a(">>"),a(">>"),a("endobj"),n.objectNumber=i(),a("<<"),a("/Type /Font"),a("/Subtype /Type0"),a("/ToUnicode "+d+" 0 R"),a("/BaseFont /"+Ne(n.fontName)),a("/Encoding /"+n.encoding),a("/DescendantFonts ["+p+" 0 R]"),a(">>"),a("endobj"),n.isAlreadyPutted=!0}}(t)}]),t.events.push(["putFont",function(t){!function(t){var n=t.font,a=t.out,i=t.newObject,o=t.putStream;if(n.metadata instanceof e.API.TTFFont&&"WinAnsiEncoding"===n.encoding){for(var s=n.metadata.rawData,c="",l=0;l<s.length;l++)c+=String.fromCharCode(s[l]);var u=i();o({data:c,addLength1:!0,objectId:u}),a("endobj");var h=i();o({data:r(n.metadata.toUnicode),addLength1:!0,objectId:h}),a("endobj");var d=i();a("<<"),a("/Descent "+n.metadata.decender),a("/CapHeight "+n.metadata.capHeight),a("/StemV "+n.metadata.stemV),a("/Type /FontDescriptor"),a("/FontFile2 "+u+" 0 R"),a("/Flags 96"),a("/FontBBox "+e.API.PDFObject.convert(n.metadata.bbox)),a("/FontName /"+Ne(n.fontName)),a("/ItalicAngle "+n.metadata.italicAngle),a("/Ascent "+n.metadata.ascender),a(">>"),a("endobj"),n.objectNumber=i();for(var f=0;f<n.metadata.hmtx.widths.length;f++)n.metadata.hmtx.widths[f]=parseInt(n.metadata.hmtx.widths[f]*(1e3/n.metadata.head.unitsPerEm));a("<</Subtype/TrueType/Type/Font/ToUnicode "+h+" 0 R/BaseFont/"+Ne(n.fontName)+"/FontDescriptor "+d+" 0 R/Encoding/"+n.encoding+" /FirstChar 29 /LastChar 255 /Widths "+e.API.PDFObject.convert(n.metadata.hmtx.widths)+">>"),a("endobj"),n.isAlreadyPutted=!0}}(t)}]);var a=function(e){var t,r=e.text||"",a=e.x,i=e.y,o=e.options||{},s=e.mutex||{},c=s.pdfEscape,l=s.activeFontKey,u=s.fonts,h=l,d="",f=0,p="",m=u[h].encoding;if("Identity-H"!==u[h].encoding)return{text:r,x:a,y:i,options:o,mutex:s};for(p=r,h=l,Array.isArray(r)&&(p=r[0]),f=0;f<p.length;f+=1)u[h].metadata.hasOwnProperty("cmap")&&(t=u[h].metadata.cmap.unicode.codeMap[p[f].charCodeAt(0)]),t||p[f].charCodeAt(0)<256&&u[h].metadata.hasOwnProperty("Unicode")?d+=p[f]:d+="";var g="";return parseInt(h.slice(1))<14||"WinAnsiEncoding"===m?g=c(d,h).split("").map(function(e){return e.charCodeAt(0).toString(16)}).join(""):"Identity-H"===m&&(g=n(d,u[h])),s.isHex=!0,{text:g,x:a,y:i,options:o,mutex:s}};t.events.push(["postProcessText",function(e){var t=e.text||"",n=[],r={text:t,x:e.x,y:e.y,options:e.options,mutex:e.mutex};if(Array.isArray(t)){var i=0;for(i=0;i<t.length;i+=1)Array.isArray(t[i])&&3===t[i].length?n.push([a(Object.assign({},r,{text:t[i][0]})).text,t[i][1],t[i][2]]):n.push(a(Object.assign({},r,{text:t[i]})).text);e.text=n}else e.text=a(Object.assign({},r,{text:t})).text}])}(Ae),function(e){var t=function(){return void 0===this.internal.vFS&&(this.internal.vFS={}),!0};e.existsFileInVFS=function(e){return t.call(this),void 0!==this.internal.vFS[e]},e.addFileToVFS=function(e,n){return t.call(this),this.internal.vFS[e]=n,this},e.getFileFromVFS=function(e){return t.call(this),void 0!==this.internal.vFS[e]?this.internal.vFS[e]:null}}(Ae.API),function(e){e.__bidiEngine__=e.prototype.__bidiEngine__=function(e){var n,r,a,i,o,s,c,l=t,u=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]],h=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]],d={L:0,R:1,EN:2,AN:3,N:4,B:5,S:6},f={0:0,5:1,6:2,7:3,32:4,251:5,254:6,255:7},p=["(",")","(","<",">","<","[","]","[","{","}","{","\xab","\xbb","\xab","\u2039","\u203a","\u2039","\u2045","\u2046","\u2045","\u207d","\u207e","\u207d","\u208d","\u208e","\u208d","\u2264","\u2265","\u2264","\u2329","\u232a","\u2329","\ufe59","\ufe5a","\ufe59","\ufe5b","\ufe5c","\ufe5b","\ufe5d","\ufe5e","\ufe5d","\ufe64","\ufe65","\ufe64"],m=new RegExp(/^([1-4|9]|1[0-9]|2[0-9]|3[0168]|4[04589]|5[012]|7[78]|159|16[0-9]|17[0-2]|21[569]|22[03489]|250)$/),g=!1,v=0;this.__bidiEngine__={};var b=function(e){var t=e.charCodeAt(),n=t>>8,r=f[n];return void 0!==r?l[256*r+(255&t)]:252===n||253===n?"AL":m.test(n)?"L":8===n?"R":"N"},y=function(e){for(var t,n=0;n<e.length;n++){if("L"===(t=b(e.charAt(n))))return!1;if("R"===t)return!0}return!1},x=function(e,t,o,s){var c,l,u,h,d=t[s];switch(d){case"L":case"R":case"LRE":case"RLE":case"LRO":case"RLO":case"PDF":g=!1;break;case"N":case"AN":break;case"EN":g&&(d="AN");break;case"AL":g=!0,d="R";break;case"WS":case"BN":d="N";break;case"CS":s<1||s+1>=t.length||"EN"!==(c=o[s-1])&&"AN"!==c||"EN"!==(l=t[s+1])&&"AN"!==l?d="N":g&&(l="AN"),d=l===c?l:"N";break;case"ES":d="EN"===(c=s>0?o[s-1]:"B")&&s+1<t.length&&"EN"===t[s+1]?"EN":"N";break;case"ET":if(s>0&&"EN"===o[s-1]){d="EN";break}if(g){d="N";break}for(u=s+1,h=t.length;u<h&&"ET"===t[u];)u++;d=u<h&&"EN"===t[u]?"EN":"N";break;case"NSM":if(a&&!i){for(h=t.length,u=s+1;u<h&&"NSM"===t[u];)u++;if(u<h){var f=e[s],p=f>=1425&&f<=2303||64286===f;if(c=t[u],p&&("R"===c||"AL"===c)){d="R";break}}}d=s<1||"B"===(c=t[s-1])?"N":o[s-1];break;case"B":g=!1,n=!0,d=v;break;case"S":r=!0,d="N"}return d},w=function(e,t,n){var r=e.split("");return n&&k(r,n,{hiLevel:v}),r.reverse(),t&&t.reverse(),r.join("")},k=function(e,t,a){var i,o,s,c,l,f=-1,p=e.length,m=0,y=[],w=v?h:u,k=[];for(g=!1,n=!1,r=!1,o=0;o<p;o++)k[o]=b(e[o]);for(s=0;s<p;s++){if(l=m,y[s]=x(e,k,y,s),i=240&(m=w[l][d[y[s]]]),m&=15,t[s]=c=w[m][5],i>0)if(16===i){for(o=f;o<s;o++)t[o]=1;f=-1}else f=-1;if(w[m][6])-1===f&&(f=s);else if(f>-1){for(o=f;o<s;o++)t[o]=c;f=-1}"B"===k[s]&&(t[s]=0),a.hiLevel|=c}r&&function(e,t,n){for(var r=0;r<n;r++)if("S"===e[r]){t[r]=v;for(var a=r-1;a>=0&&"WS"===e[a];a--)t[a]=v}}(k,t,p)},S=function(e,t,r,a,i){if(!(i.hiLevel<e)){if(1===e&&1===v&&!n)return t.reverse(),void(r&&r.reverse());for(var o,s,c,l,u=t.length,h=0;h<u;){if(a[h]>=e){for(c=h+1;c<u&&a[c]>=e;)c++;for(l=h,s=c-1;l<s;l++,s--)o=t[l],t[l]=t[s],t[s]=o,r&&(o=r[l],r[l]=r[s],r[s]=o);h=c}h++}}},N=function(e,t,n){var r=e.split(""),a={hiLevel:v};return n||(n=[]),k(r,n,a),function(e,t,n){if(0!==n.hiLevel&&c)for(var r,a=0;a<e.length;a++)1===t[a]&&(r=p.indexOf(e[a]))>=0&&(e[a]=p[r+1])}(r,n,a),S(2,r,t,n,a),S(1,r,t,n,a),r.join("")};return this.__bidiEngine__.doBidiReorder=function(e,t,n){if(function(e,t){if(t)for(var n=0;n<e.length;n++)t[n]=n;void 0===i&&(i=y(e)),void 0===s&&(s=y(e))}(e,t),a||!o||s)if(a&&o&&i^s)v=i?1:0,e=w(e,t,n);else if(!a&&o&&s)v=i?1:0,e=N(e,t,n),e=w(e,t);else if(!a||i||o||s){if(a&&!o&&i^s)e=w(e,t),i?(v=0,e=N(e,t,n)):(v=1,e=N(e,t,n),e=w(e,t));else if(a&&i&&!o&&s)v=1,e=N(e,t,n),e=w(e,t);else if(!a&&!o&&i^s){var r=c;i?(v=1,e=N(e,t,n),v=0,c=!1,e=N(e,t,n),c=r):(v=0,e=N(e,t,n),e=w(e,t),v=1,c=!1,e=N(e,t,n),c=r,e=w(e,t))}}else v=0,e=N(e,t,n);else v=i?1:0,e=N(e,t,n);return e},this.__bidiEngine__.setOptions=function(e){e&&(a=e.isInputVisual,o=e.isOutputVisual,i=e.isInputRtl,s=e.isOutputRtl,c=e.isSymmetricSwapping)},this.__bidiEngine__.setOptions(e),this.__bidiEngine__};var t=["BN","BN","BN","BN","BN","BN","BN","BN","BN","S","B","S","WS","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","B","B","B","S","WS","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","BN","BN","BN","BN","BN","BN","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","CS","N","ET","ET","ET","ET","N","N","N","N","L","N","N","BN","N","N","ET","ET","EN","EN","N","L","N","N","N","EN","L","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","N","N","N","N","N","ET","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","NSM","R","NSM","NSM","R","NSM","NSM","R","NSM","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","N","N","N","N","N","R","R","R","R","R","N","N","N","N","N","N","N","N","N","N","N","AN","AN","AN","AN","AN","AN","N","N","AL","ET","ET","AL","CS","AL","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","AN","AN","AN","AN","AN","AN","AN","AN","AN","ET","AN","AN","AL","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","N","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","NSM","NSM","N","NSM","NSM","NSM","NSM","AL","AL","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","R","N","N","N","N","R","N","N","N","N","N","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","BN","BN","BN","L","R","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","B","LRE","RLE","PDF","LRO","RLO","CS","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","BN","BN","BN","BN","BN","N","LRI","RLI","FSI","PDI","BN","BN","BN","BN","BN","BN","EN","L","N","N","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","L","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","N","N","N","N","N","R","NSM","R","R","R","R","R","R","R","R","R","R","ES","R","R","R","R","R","R","R","R","R","R","R","R","R","N","R","R","R","R","R","N","R","N","R","R","N","R","R","N","R","R","R","R","R","R","R","R","R","R","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","CS","N","N","CS","N","N","N","N","N","N","N","N","N","ET","N","N","ES","ES","N","N","N","N","N","ET","ET","N","N","N","N","N","AL","AL","AL","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","BN","N","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","N","N","N","ET","ET","N","N","N","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N"],n=new e.__bidiEngine__({isInputVisual:!0});e.API.events.push(["postProcessText",function(e){var t=e.text,r=(e.x,e.y,e.options||{}),a=(e.mutex,r.lang,[]);if(r.isInputVisual="boolean"!=typeof r.isInputVisual||r.isInputVisual,n.setOptions(r),"[object Array]"===Object.prototype.toString.call(t)){var i=0;for(a=[],i=0;i<t.length;i+=1)"[object Array]"===Object.prototype.toString.call(t[i])?a.push([n.doBidiReorder(t[i][0]),t[i][1],t[i][2]]):a.push([n.doBidiReorder(t[i])]);e.text=a}else e.text=n.doBidiReorder(t);n.setOptions({isInputVisual:!0})}])}(Ae),Ae.API.TTFFont=function(){function e(e){var t;if(this.rawData=e,t=this.contents=new $t(e),this.contents.pos=4,"ttcf"===t.readString(4))throw new Error("TTCF not supported.");t.pos=0,this.parse(),this.subset=new gn(this),this.registerTTF()}return e.open=function(t){return new e(t)},e.prototype.parse=function(){return this.directory=new Jt(this.contents),this.head=new en(this),this.name=new cn(this),this.cmap=new nn(this),this.toUnicode={},this.hhea=new rn(this),this.maxp=new ln(this),this.hmtx=new un(this),this.post=new on(this),this.os2=new an(this),this.loca=new mn(this),this.glyf=new dn(this),this.ascender=this.os2.exists&&this.os2.ascender||this.hhea.ascender,this.decender=this.os2.exists&&this.os2.decender||this.hhea.decender,this.lineGap=this.os2.exists&&this.os2.lineGap||this.hhea.lineGap,this.bbox=[this.head.xMin,this.head.yMin,this.head.xMax,this.head.yMax]},e.prototype.registerTTF=function(){var e,t,n,r,a;if(this.scaleFactor=1e3/this.head.unitsPerEm,this.bbox=function(){var t,n,r,a;for(a=[],t=0,n=(r=this.bbox).length;t<n;t++)e=r[t],a.push(Math.round(e*this.scaleFactor));return a}.call(this),this.stemV=0,this.post.exists?(n=255&(r=this.post.italic_angle),0!=(32768&(t=r>>16))&&(t=-(1+(65535^t))),this.italicAngle=+(t+"."+n)):this.italicAngle=0,this.ascender=Math.round(this.ascender*this.scaleFactor),this.decender=Math.round(this.decender*this.scaleFactor),this.lineGap=Math.round(this.lineGap*this.scaleFactor),this.capHeight=this.os2.exists&&this.os2.capHeight||this.ascender,this.xHeight=this.os2.exists&&this.os2.xHeight||0,this.familyClass=(this.os2.exists&&this.os2.familyClass||0)>>8,this.isSerif=1===(a=this.familyClass)||2===a||3===a||4===a||5===a||7===a,this.isScript=10===this.familyClass,this.flags=0,this.post.isFixedPitch&&(this.flags|=1),this.isSerif&&(this.flags|=2),this.isScript&&(this.flags|=8),0!==this.italicAngle&&(this.flags|=64),this.flags|=32,!this.cmap.unicode)throw new Error("No unicode cmap for font")},e.prototype.characterToGlyph=function(e){var t;return(null!=(t=this.cmap.unicode)?t.codeMap[e]:void 0)||0},e.prototype.widthOfGlyph=function(e){var t;return t=1e3/this.head.unitsPerEm,this.hmtx.forGlyph(e).advance*t},e.prototype.widthOfString=function(e,t,n){var r,a,i,o;for(i=0,a=0,o=(e=""+e).length;0<=o?a<o:a>o;a=0<=o?++a:--a)r=e.charCodeAt(a),i+=this.widthOfGlyph(this.characterToGlyph(r))+n*(1e3/t)||0;return i*(t/1e3)},e.prototype.lineHeight=function(e,t){var n;return null==t&&(t=!1),n=t?this.lineGap:0,(this.ascender+n-this.decender)/1e3*e},e}();var Yt,$t=function(){function e(e){this.data=null!=e?e:[],this.pos=0,this.length=this.data.length}return e.prototype.readByte=function(){return this.data[this.pos++]},e.prototype.writeByte=function(e){return this.data[this.pos++]=e},e.prototype.readUInt32=function(){return 16777216*this.readByte()+(this.readByte()<<16)+(this.readByte()<<8)+this.readByte()},e.prototype.writeUInt32=function(e){return this.writeByte(e>>>24&255),this.writeByte(e>>16&255),this.writeByte(e>>8&255),this.writeByte(255&e)},e.prototype.readInt32=function(){var e;return(e=this.readUInt32())>=2147483648?e-4294967296:e},e.prototype.writeInt32=function(e){return e<0&&(e+=4294967296),this.writeUInt32(e)},e.prototype.readUInt16=function(){return this.readByte()<<8|this.readByte()},e.prototype.writeUInt16=function(e){return this.writeByte(e>>8&255),this.writeByte(255&e)},e.prototype.readInt16=function(){var e;return(e=this.readUInt16())>=32768?e-65536:e},e.prototype.writeInt16=function(e){return e<0&&(e+=65536),this.writeUInt16(e)},e.prototype.readString=function(e){var t,n;for(n=[],t=0;0<=e?t<e:t>e;t=0<=e?++t:--t)n[t]=String.fromCharCode(this.readByte());return n.join("")},e.prototype.writeString=function(e){var t,n,r;for(r=[],t=0,n=e.length;0<=n?t<n:t>n;t=0<=n?++t:--t)r.push(this.writeByte(e.charCodeAt(t)));return r},e.prototype.readShort=function(){return this.readInt16()},e.prototype.writeShort=function(e){return this.writeInt16(e)},e.prototype.readLongLong=function(){var e,t,n,r,a,i,o,s;return e=this.readByte(),t=this.readByte(),n=this.readByte(),r=this.readByte(),a=this.readByte(),i=this.readByte(),o=this.readByte(),s=this.readByte(),128&e?-1*(72057594037927940*(255^e)+281474976710656*(255^t)+1099511627776*(255^n)+4294967296*(255^r)+16777216*(255^a)+65536*(255^i)+256*(255^o)+(255^s)+1):72057594037927940*e+281474976710656*t+1099511627776*n+4294967296*r+16777216*a+65536*i+256*o+s},e.prototype.writeLongLong=function(e){var t,n;return t=Math.floor(e/4294967296),n=4294967295&e,this.writeByte(t>>24&255),this.writeByte(t>>16&255),this.writeByte(t>>8&255),this.writeByte(255&t),this.writeByte(n>>24&255),this.writeByte(n>>16&255),this.writeByte(n>>8&255),this.writeByte(255&n)},e.prototype.readInt=function(){return this.readInt32()},e.prototype.writeInt=function(e){return this.writeInt32(e)},e.prototype.read=function(e){var t,n;for(t=[],n=0;0<=e?n<e:n>e;n=0<=e?++n:--n)t.push(this.readByte());return t},e.prototype.write=function(e){var t,n,r,a;for(a=[],n=0,r=e.length;n<r;n++)t=e[n],a.push(this.writeByte(t));return a},e}(),Jt=function(){var e;function t(e){var t,n,r;for(this.scalarType=e.readInt(),this.tableCount=e.readShort(),this.searchRange=e.readShort(),this.entrySelector=e.readShort(),this.rangeShift=e.readShort(),this.tables={},n=0,r=this.tableCount;0<=r?n<r:n>r;n=0<=r?++n:--n)t={tag:e.readString(4),checksum:e.readInt(),offset:e.readInt(),length:e.readInt()},this.tables[t.tag]=t}return t.prototype.encode=function(t){var n,r,a,i,o,s,c,l,u,h,d,f,p;for(p in d=Object.keys(t).length,s=Math.log(2),u=16*Math.floor(Math.log(d)/s),i=Math.floor(u/s),l=16*d-u,(r=new $t).writeInt(this.scalarType),r.writeShort(d),r.writeShort(u),r.writeShort(i),r.writeShort(l),a=16*d,c=r.pos+a,o=null,f=[],t)for(h=t[p],r.writeString(p),r.writeInt(e(h)),r.writeInt(c),r.writeInt(h.length),f=f.concat(h),"head"===p&&(o=c),c+=h.length;c%4;)f.push(0),c++;return r.write(f),n=2981146554-e(r.data),r.pos=o+8,r.writeUInt32(n),r.data},e=function(e){var t,n,r,a;for(e=hn.call(e);e.length%4;)e.push(0);for(r=new $t(e),n=0,t=0,a=e.length;t<a;t=t+=4)n+=r.readUInt32();return 4294967295&n},t}(),Qt={}.hasOwnProperty,Zt=function(e,t){for(var n in t)Qt.call(t,n)&&(e[n]=t[n]);function r(){this.constructor=e}return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};Yt=function(){function e(e){var t;this.file=e,t=this.file.directory.tables[this.tag],this.exists=!!t,t&&(this.offset=t.offset,this.length=t.length,this.parse(this.file.contents))}return e.prototype.parse=function(){},e.prototype.encode=function(){},e.prototype.raw=function(){return this.exists?(this.file.contents.pos=this.offset,this.file.contents.read(this.length)):null},e}();var en=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return Zt(e,Yt),e.prototype.tag="head",e.prototype.parse=function(e){return e.pos=this.offset,this.version=e.readInt(),this.revision=e.readInt(),this.checkSumAdjustment=e.readInt(),this.magicNumber=e.readInt(),this.flags=e.readShort(),this.unitsPerEm=e.readShort(),this.created=e.readLongLong(),this.modified=e.readLongLong(),this.xMin=e.readShort(),this.yMin=e.readShort(),this.xMax=e.readShort(),this.yMax=e.readShort(),this.macStyle=e.readShort(),this.lowestRecPPEM=e.readShort(),this.fontDirectionHint=e.readShort(),this.indexToLocFormat=e.readShort(),this.glyphDataFormat=e.readShort()},e.prototype.encode=function(e){var t;return(t=new $t).writeInt(this.version),t.writeInt(this.revision),t.writeInt(this.checkSumAdjustment),t.writeInt(this.magicNumber),t.writeShort(this.flags),t.writeShort(this.unitsPerEm),t.writeLongLong(this.created),t.writeLongLong(this.modified),t.writeShort(this.xMin),t.writeShort(this.yMin),t.writeShort(this.xMax),t.writeShort(this.yMax),t.writeShort(this.macStyle),t.writeShort(this.lowestRecPPEM),t.writeShort(this.fontDirectionHint),t.writeShort(e),t.writeShort(this.glyphDataFormat),t.data},e}(),tn=function(){function e(e,t){var n,r,a,i,o,s,c,l,u,h,d,f,p,m,g,v,b;switch(this.platformID=e.readUInt16(),this.encodingID=e.readShort(),this.offset=t+e.readInt(),u=e.pos,e.pos=this.offset,this.format=e.readUInt16(),this.length=e.readUInt16(),this.language=e.readUInt16(),this.isUnicode=3===this.platformID&&1===this.encodingID&&4===this.format||0===this.platformID&&4===this.format,this.codeMap={},this.format){case 0:for(s=0;s<256;++s)this.codeMap[s]=e.readByte();break;case 4:for(d=e.readUInt16(),h=d/2,e.pos+=6,a=function(){var t,n;for(n=[],s=t=0;0<=h?t<h:t>h;s=0<=h?++t:--t)n.push(e.readUInt16());return n}(),e.pos+=2,p=function(){var t,n;for(n=[],s=t=0;0<=h?t<h:t>h;s=0<=h?++t:--t)n.push(e.readUInt16());return n}(),c=function(){var t,n;for(n=[],s=t=0;0<=h?t<h:t>h;s=0<=h?++t:--t)n.push(e.readUInt16());return n}(),l=function(){var t,n;for(n=[],s=t=0;0<=h?t<h:t>h;s=0<=h?++t:--t)n.push(e.readUInt16());return n}(),r=(this.length-e.pos+this.offset)/2,o=function(){var t,n;for(n=[],s=t=0;0<=r?t<r:t>r;s=0<=r?++t:--t)n.push(e.readUInt16());return n}(),s=g=0,b=a.length;g<b;s=++g)for(m=a[s],n=v=f=p[s];f<=m?v<=m:v>=m;n=f<=m?++v:--v)0===l[s]?i=n+c[s]:0!==(i=o[l[s]/2+(n-f)-(h-s)]||0)&&(i+=c[s]),this.codeMap[n]=65535&i}e.pos=u}return e.encode=function(e,t){var n,r,a,i,o,s,c,l,u,h,d,f,p,m,g,v,b,y,x,w,k,S,N,C,E,I,T,_,A,R,F,D,O,L,P,M,j,B,z,U,W,V,H,G,q,K;switch(_=new $t,i=Object.keys(e).sort(function(e,t){return e-t}),t){case"macroman":for(p=0,m=function(){var e=[];for(f=0;f<256;++f)e.push(0);return e}(),v={0:0},a={},A=0,O=i.length;A<O;A++)null==v[H=e[r=i[A]]]&&(v[H]=++p),a[r]={old:e[r],new:v[e[r]]},m[r]=v[e[r]];return _.writeUInt16(1),_.writeUInt16(0),_.writeUInt32(12),_.writeUInt16(0),_.writeUInt16(262),_.writeUInt16(0),_.write(m),{charMap:a,subtable:_.data,maxGlyphID:p+1};case"unicode":for(I=[],u=[],b=0,v={},n={},g=c=null,R=0,L=i.length;R<L;R++)null==v[x=e[r=i[R]]]&&(v[x]=++b),n[r]={old:x,new:v[x]},o=v[x]-r,null!=g&&o===c||(g&&u.push(g),I.push(r),c=o),g=r;for(g&&u.push(g),u.push(65535),I.push(65535),C=2*(N=I.length),S=2*Math.pow(Math.log(N)/Math.LN2,2),h=Math.log(S/2)/Math.LN2,k=2*N-S,s=[],w=[],d=[],f=F=0,P=I.length;F<P;f=++F){if(E=I[f],l=u[f],65535===E){s.push(0),w.push(0);break}if(E-(T=n[E].new)>=32768)for(s.push(0),w.push(2*(d.length+N-f)),r=D=E;E<=l?D<=l:D>=l;r=E<=l?++D:--D)d.push(n[r].new);else s.push(T-E),w.push(0)}for(_.writeUInt16(3),_.writeUInt16(1),_.writeUInt32(12),_.writeUInt16(4),_.writeUInt16(16+8*N+2*d.length),_.writeUInt16(0),_.writeUInt16(C),_.writeUInt16(S),_.writeUInt16(h),_.writeUInt16(k),W=0,M=u.length;W<M;W++)r=u[W],_.writeUInt16(r);for(_.writeUInt16(0),V=0,j=I.length;V<j;V++)r=I[V],_.writeUInt16(r);for(G=0,B=s.length;G<B;G++)o=s[G],_.writeUInt16(o);for(q=0,z=w.length;q<z;q++)y=w[q],_.writeUInt16(y);for(K=0,U=d.length;K<U;K++)p=d[K],_.writeUInt16(p);return{charMap:n,subtable:_.data,maxGlyphID:b+1}}},e}(),nn=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return Zt(e,Yt),e.prototype.tag="cmap",e.prototype.parse=function(e){var t,n,r;for(e.pos=this.offset,this.version=e.readUInt16(),r=e.readUInt16(),this.tables=[],this.unicode=null,n=0;0<=r?n<r:n>r;n=0<=r?++n:--n)t=new tn(e,this.offset),this.tables.push(t),t.isUnicode&&null==this.unicode&&(this.unicode=t);return!0},e.encode=function(e,t){var n,r;return null==t&&(t="macroman"),n=tn.encode(e,t),(r=new $t).writeUInt16(0),r.writeUInt16(1),n.table=r.data.concat(n.subtable),n},e}(),rn=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return Zt(e,Yt),e.prototype.tag="hhea",e.prototype.parse=function(e){return e.pos=this.offset,this.version=e.readInt(),this.ascender=e.readShort(),this.decender=e.readShort(),this.lineGap=e.readShort(),this.advanceWidthMax=e.readShort(),this.minLeftSideBearing=e.readShort(),this.minRightSideBearing=e.readShort(),this.xMaxExtent=e.readShort(),this.caretSlopeRise=e.readShort(),this.caretSlopeRun=e.readShort(),this.caretOffset=e.readShort(),e.pos+=8,this.metricDataFormat=e.readShort(),this.numberOfMetrics=e.readUInt16()},e}(),an=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return Zt(e,Yt),e.prototype.tag="OS/2",e.prototype.parse=function(e){if(e.pos=this.offset,this.version=e.readUInt16(),this.averageCharWidth=e.readShort(),this.weightClass=e.readUInt16(),this.widthClass=e.readUInt16(),this.type=e.readShort(),this.ySubscriptXSize=e.readShort(),this.ySubscriptYSize=e.readShort(),this.ySubscriptXOffset=e.readShort(),this.ySubscriptYOffset=e.readShort(),this.ySuperscriptXSize=e.readShort(),this.ySuperscriptYSize=e.readShort(),this.ySuperscriptXOffset=e.readShort(),this.ySuperscriptYOffset=e.readShort(),this.yStrikeoutSize=e.readShort(),this.yStrikeoutPosition=e.readShort(),this.familyClass=e.readShort(),this.panose=function(){var t,n;for(n=[],t=0;t<10;++t)n.push(e.readByte());return n}(),this.charRange=function(){var t,n;for(n=[],t=0;t<4;++t)n.push(e.readInt());return n}(),this.vendorID=e.readString(4),this.selection=e.readShort(),this.firstCharIndex=e.readShort(),this.lastCharIndex=e.readShort(),this.version>0&&(this.ascent=e.readShort(),this.descent=e.readShort(),this.lineGap=e.readShort(),this.winAscent=e.readShort(),this.winDescent=e.readShort(),this.codePageRange=function(){var t,n;for(n=[],t=0;t<2;t=++t)n.push(e.readInt());return n}(),this.version>1))return this.xHeight=e.readShort(),this.capHeight=e.readShort(),this.defaultChar=e.readShort(),this.breakChar=e.readShort(),this.maxContext=e.readShort()},e}(),on=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return Zt(e,Yt),e.prototype.tag="post",e.prototype.parse=function(e){var t,n,r;switch(e.pos=this.offset,this.format=e.readInt(),this.italicAngle=e.readInt(),this.underlinePosition=e.readShort(),this.underlineThickness=e.readShort(),this.isFixedPitch=e.readInt(),this.minMemType42=e.readInt(),this.maxMemType42=e.readInt(),this.minMemType1=e.readInt(),this.maxMemType1=e.readInt(),this.format){case 65536:case 196608:break;case 131072:var a;for(n=e.readUInt16(),this.glyphNameIndex=[],a=0;0<=n?a<n:a>n;a=0<=n?++a:--a)this.glyphNameIndex.push(e.readUInt16());for(this.names=[],r=[];e.pos<this.offset+this.length;)t=e.readByte(),r.push(this.names.push(e.readString(t)));return r;case 151552:return n=e.readUInt16(),this.offsets=e.read(n);case 262144:return this.map=function(){var t,n,r;for(r=[],a=t=0,n=this.file.maxp.numGlyphs;0<=n?t<n:t>n;a=0<=n?++t:--t)r.push(e.readUInt32());return r}.call(this)}},e}(),sn=function(e,t){this.raw=e,this.length=e.length,this.platformID=t.platformID,this.encodingID=t.encodingID,this.languageID=t.languageID},cn=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return Zt(e,Yt),e.prototype.tag="name",e.prototype.parse=function(e){var t,n,r,a,i,o,s,c,l,u,h;for(e.pos=this.offset,e.readShort(),t=e.readShort(),o=e.readShort(),n=[],a=0;0<=t?a<t:a>t;a=0<=t?++a:--a)n.push({platformID:e.readShort(),encodingID:e.readShort(),languageID:e.readShort(),nameID:e.readShort(),length:e.readShort(),offset:this.offset+o+e.readShort()});for(s={},a=l=0,u=n.length;l<u;a=++l)r=n[a],e.pos=r.offset,c=e.readString(r.length),i=new sn(c,r),null==s[h=r.nameID]&&(s[h]=[]),s[r.nameID].push(i);this.strings=s,this.copyright=s[0],this.fontFamily=s[1],this.fontSubfamily=s[2],this.uniqueSubfamily=s[3],this.fontName=s[4],this.version=s[5];try{this.postscriptName=s[6][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}catch(e){this.postscriptName=s[4][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}return this.trademark=s[7],this.manufacturer=s[8],this.designer=s[9],this.description=s[10],this.vendorUrl=s[11],this.designerUrl=s[12],this.license=s[13],this.licenseUrl=s[14],this.preferredFamily=s[15],this.preferredSubfamily=s[17],this.compatibleFull=s[18],this.sampleText=s[19]},e}(),ln=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return Zt(e,Yt),e.prototype.tag="maxp",e.prototype.parse=function(e){return e.pos=this.offset,this.version=e.readInt(),this.numGlyphs=e.readUInt16(),this.maxPoints=e.readUInt16(),this.maxContours=e.readUInt16(),this.maxCompositePoints=e.readUInt16(),this.maxComponentContours=e.readUInt16(),this.maxZones=e.readUInt16(),this.maxTwilightPoints=e.readUInt16(),this.maxStorage=e.readUInt16(),this.maxFunctionDefs=e.readUInt16(),this.maxInstructionDefs=e.readUInt16(),this.maxStackElements=e.readUInt16(),this.maxSizeOfInstructions=e.readUInt16(),this.maxComponentElements=e.readUInt16(),this.maxComponentDepth=e.readUInt16()},e}(),un=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return Zt(e,Yt),e.prototype.tag="hmtx",e.prototype.parse=function(e){var t,n,r,a,i,o,s;for(e.pos=this.offset,this.metrics=[],t=0,o=this.file.hhea.numberOfMetrics;0<=o?t<o:t>o;t=0<=o?++t:--t)this.metrics.push({advance:e.readUInt16(),lsb:e.readInt16()});for(r=this.file.maxp.numGlyphs-this.file.hhea.numberOfMetrics,this.leftSideBearings=function(){var n,a;for(a=[],t=n=0;0<=r?n<r:n>r;t=0<=r?++n:--n)a.push(e.readInt16());return a}(),this.widths=function(){var e,t,n,r;for(r=[],e=0,t=(n=this.metrics).length;e<t;e++)a=n[e],r.push(a.advance);return r}.call(this),n=this.widths[this.widths.length-1],s=[],t=i=0;0<=r?i<r:i>r;t=0<=r?++i:--i)s.push(this.widths.push(n));return s},e.prototype.forGlyph=function(e){return e in this.metrics?this.metrics[e]:{advance:this.metrics[this.metrics.length-1].advance,lsb:this.leftSideBearings[e-this.metrics.length]}},e}(),hn=[].slice,dn=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return Zt(e,Yt),e.prototype.tag="glyf",e.prototype.parse=function(){return this.cache={}},e.prototype.glyphFor=function(e){var t,n,r,a,i,o,s,c,l,u;return e in this.cache?this.cache[e]:(a=this.file.loca,t=this.file.contents,n=a.indexOf(e),0===(r=a.lengthOf(e))?this.cache[e]=null:(t.pos=this.offset+n,i=(o=new $t(t.read(r))).readShort(),c=o.readShort(),u=o.readShort(),s=o.readShort(),l=o.readShort(),this.cache[e]=-1===i?new pn(o,c,u,s,l):new fn(o,i,c,u,s,l),this.cache[e]))},e.prototype.encode=function(e,t,n){var r,a,i,o,s;for(i=[],a=[],o=0,s=t.length;o<s;o++)r=e[t[o]],a.push(i.length),r&&(i=i.concat(r.encode(n)));return a.push(i.length),{table:i,offsets:a}},e}(),fn=function(){function e(e,t,n,r,a,i){this.raw=e,this.numberOfContours=t,this.xMin=n,this.yMin=r,this.xMax=a,this.yMax=i,this.compound=!1}return e.prototype.encode=function(){return this.raw.data},e}(),pn=function(){function e(e,t,n,r,a){var i,o;for(this.raw=e,this.xMin=t,this.yMin=n,this.xMax=r,this.yMax=a,this.compound=!0,this.glyphIDs=[],this.glyphOffsets=[],i=this.raw;o=i.readShort(),this.glyphOffsets.push(i.pos),this.glyphIDs.push(i.readUInt16()),32&o;)i.pos+=1&o?4:2,128&o?i.pos+=8:64&o?i.pos+=4:8&o&&(i.pos+=2)}return e.prototype.encode=function(){var e,t,n;for(t=new $t(hn.call(this.raw.data)),e=0,n=this.glyphIDs.length;e<n;++e)t.pos=this.glyphOffsets[e];return t.data},e}(),mn=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return Zt(e,Yt),e.prototype.tag="loca",e.prototype.parse=function(e){var t,n;return e.pos=this.offset,t=this.file.head.indexToLocFormat,this.offsets=0===t?function(){var t,r;for(r=[],n=0,t=this.length;n<t;n+=2)r.push(2*e.readUInt16());return r}.call(this):function(){var t,r;for(r=[],n=0,t=this.length;n<t;n+=4)r.push(e.readUInt32());return r}.call(this)},e.prototype.indexOf=function(e){return this.offsets[e]},e.prototype.lengthOf=function(e){return this.offsets[e+1]-this.offsets[e]},e.prototype.encode=function(e,t){for(var n=new Uint32Array(this.offsets.length),r=0,a=0,i=0;i<n.length;++i)if(n[i]=r,a<t.length&&t[a]==i){++a,n[i]=r;var o=this.offsets[i],s=this.offsets[i+1]-o;s>0&&(r+=s)}for(var c=new Array(4*n.length),l=0;l<n.length;++l)c[4*l+3]=255&n[l],c[4*l+2]=(65280&n[l])>>8,c[4*l+1]=(16711680&n[l])>>16,c[4*l]=(4278190080&n[l])>>24;return c},e}(),gn=function(){function e(e){this.font=e,this.subset={},this.unicodes={},this.next=33}return e.prototype.generateCmap=function(){var e,t,n,r,a;for(t in r=this.font.cmap.tables[0].codeMap,e={},a=this.subset)n=a[t],e[t]=r[n];return e},e.prototype.glyphsFor=function(e){var t,n,r,a,i,o,s;for(r={},i=0,o=e.length;i<o;i++)r[a=e[i]]=this.font.glyf.glyphFor(a);for(a in t=[],r)(null!=(n=r[a])?n.compound:void 0)&&t.push.apply(t,n.glyphIDs);if(t.length>0)for(a in s=this.glyphsFor(t))n=s[a],r[a]=n;return r},e.prototype.encode=function(e,t){var n,r,a,i,o,s,c,l,u,h,d,f,p,m,g;for(r in n=nn.encode(this.generateCmap(),"unicode"),i=this.glyphsFor(e),d={0:0},g=n.charMap)d[(s=g[r]).old]=s.new;for(f in h=n.maxGlyphID,i)f in d||(d[f]=h++);return l=function(e){var t,n;for(t in n={},e)n[e[t]]=t;return n}(d),u=Object.keys(l).sort(function(e,t){return e-t}),p=function(){var e,t,n;for(n=[],e=0,t=u.length;e<t;e++)o=u[e],n.push(l[o]);return n}(),a=this.font.glyf.encode(i,p,d),c=this.font.loca.encode(a.offsets,p),m={cmap:this.font.cmap.raw(),glyf:a.table,loca:c,hmtx:this.font.hmtx.raw(),hhea:this.font.hhea.raw(),maxp:this.font.maxp.raw(),post:this.font.post.raw(),name:this.font.name.raw(),head:this.font.head.encode(t)},this.font.os2.exists&&(m["OS/2"]=this.font.os2.raw()),this.font.directory.encode(m)},e}();Ae.API.PDFObject=function(){var e;function t(){}return e=function(e,t){return(Array(t+1).join("0")+e).slice(-t)},t.convert=function(n){var r,a,i,o;if(Array.isArray(n))return"["+function(){var e,a,i;for(i=[],e=0,a=n.length;e<a;e++)r=n[e],i.push(t.convert(r));return i}().join(" ")+"]";if("string"==typeof n)return"/"+n;if(null!=n?n.isString:void 0)return"("+n+")";if(n instanceof Date)return"(D:"+e(n.getUTCFullYear(),4)+e(n.getUTCMonth(),2)+e(n.getUTCDate(),2)+e(n.getUTCHours(),2)+e(n.getUTCMinutes(),2)+e(n.getUTCSeconds(),2)+"Z)";if("[object Object]"==={}.toString.call(n)){for(a in i=["<<"],n)o=n[a],i.push("/"+a+" "+t.convert(o));return i.push(">>"),i.join("\n")}return""+n},t}();const vn=Ae},9950:(e,t,n)=>{"use strict";e.exports=n(2049)}},t={};function n(r){var a=t[r];if(void 0!==a)return a.exports;var i=t[r]={id:r,loaded:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.loaded=!0,i.exports}n.m=e,n.amdD=function(){throw new Error("define cannot be used indirect")},n.amdO={},n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},(()=>{var e,t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__;n.t=function(r,a){if(1&a&&(r=this(r)),8&a)return r;if("object"===typeof r&&r){if(4&a&&r.__esModule)return r;if(16&a&&"function"===typeof r.then)return r}var i=Object.create(null);n.r(i);var o={};e=e||[null,t({}),t([]),t(t)];for(var s=2&a&&r;("object"==typeof s||"function"==typeof s)&&!~e.indexOf(s);s=t(s))Object.getOwnPropertyNames(s).forEach(e=>o[e]=()=>r[e]);return o.default=()=>r,n.d(i,o),i}})(),n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.f={},n.e=e=>Promise.all(Object.keys(n.f).reduce((t,r)=>(n.f[r](e,t),t),[])),n.u=e=>"static/js/"+e+"."+{52:"c13f5807",239:"eeb37eec",760:"bafaf5b2"}[e]+".chunk.js",n.miniCssF=e=>{},n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={},t="mutants-academy-ashuras-tribe-client:";n.l=(r,a,i,o)=>{if(e[r])e[r].push(a);else{var s,c;if(void 0!==i)for(var l=document.getElementsByTagName("script"),u=0;u<l.length;u++){var h=l[u];if(h.getAttribute("src")==r||h.getAttribute("data-webpack")==t+i){s=h;break}}s||(c=!0,(s=document.createElement("script")).charset="utf-8",s.timeout=120,n.nc&&s.setAttribute("nonce",n.nc),s.setAttribute("data-webpack",t+i),s.src=r),e[r]=[a];var d=(t,n)=>{s.onerror=s.onload=null,clearTimeout(f);var a=e[r];if(delete e[r],s.parentNode&&s.parentNode.removeChild(s),a&&a.forEach(e=>e(n)),t)return t(n)},f=setTimeout(d.bind(null,void 0,{type:"timeout",target:s}),12e4);s.onerror=d.bind(null,s.onerror),s.onload=d.bind(null,s.onload),c&&document.head.appendChild(s)}}})(),n.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),n.p="/",(()=>{var e={792:0};n.f.j=(t,r)=>{var a=n.o(e,t)?e[t]:void 0;if(0!==a)if(a)r.push(a[2]);else{var i=new Promise((n,r)=>a=e[t]=[n,r]);r.push(a[2]=i);var o=n.p+n.u(t),s=new Error;n.l(o,r=>{if(n.o(e,t)&&(0!==(a=e[t])&&(e[t]=void 0),a)){var i=r&&("load"===r.type?"missing":r.type),o=r&&r.target&&r.target.src;s.message="Loading chunk "+t+" failed.\n("+i+": "+o+")",s.name="ChunkLoadError",s.type=i,s.request=o,a[1](s)}},"chunk-"+t,t)}};var t=(t,r)=>{var a,i,o=r[0],s=r[1],c=r[2],l=0;if(o.some(t=>0!==e[t])){for(a in s)n.o(s,a)&&(n.m[a]=s[a]);if(c)c(n)}for(t&&t(r);l<o.length;l++)i=o[l],n.o(e,i)&&e[i]&&e[i][0](),e[i]=0},r=self.webpackChunkmutants_academy_ashuras_tribe_client=self.webpackChunkmutants_academy_ashuras_tribe_client||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})(),(()=>{"use strict";var e={};n.r(e),n.d(e,{hasBrowserEnv:()=>tr,hasStandardBrowserEnv:()=>rr,hasStandardBrowserWebWorkerEnv:()=>ar,navigator:()=>nr,origin:()=>ir});var t={};n.r(t),n.d(t,{assertParamsValid:()=>bT,computeFlatOffset:()=>RT,computeOutShape:()=>xT,getNormalizedAxes:()=>NT,isSliceContinous:()=>AT,maskToAxes:()=>yT,parseSliceParams:()=>FT,sliceInfo:()=>DT,startForAxis:()=>TT,startIndicesWithElidedDims:()=>CT,stopForAxis:()=>_T,stopIndicesWithElidedDims:()=>ET,stridesForAxis:()=>IT,stridesWithElidedDims:()=>wT});var r={};n.r(r),n.d(r,{collectGatherOpShapeInfo:()=>JF,computeOutShape:()=>$F,segOpComputeOptimalWindowSize:()=>YF});var a={};n.r(a),n.d(a,{ERF_A1:()=>fF,ERF_A2:()=>pF,ERF_A3:()=>mF,ERF_A4:()=>gF,ERF_A5:()=>vF,ERF_P:()=>dF,PARALLELIZE_THRESHOLD:()=>QR,RowPartitionType:()=>KR,SELU_SCALE:()=>hF,SELU_SCALEALPHA:()=>uF,applyActivation:()=>$A,assertAndGetBroadcastShape:()=>tT,assertAxesAreInnerMostDims:()=>V_,assertParamsConsistent:()=>GR,assignToTypedArray:()=>SF,axesAreInnerMostDims:()=>B_,calculateShapes:()=>lF,checkEinsumDimSizes:()=>FF,checkPadOnDimRoundingMode:()=>QT,combineLocations:()=>z_,combineRaggedTensorToTensorShapes:()=>XR,complexWithEvenIndex:()=>xF,complexWithOddIndex:()=>wF,computeConv2DInfo:()=>UT,computeConv3DInfo:()=>WT,computeDefaultPad:()=>VT,computeDilation2DInfo:()=>jT,computeOptimalWindowSize:()=>ZR,computeOutAndReduceShapes:()=>U_,computeOutShape:()=>qR,computePool2DInfo:()=>BT,computePool3DInfo:()=>zT,convertConv2DDataFormat:()=>JT,decodeEinsumEquation:()=>AF,eitherStridesOrDilationsAreOne:()=>YT,expandShapeToKeepDim:()=>W_,exponent:()=>CF,exponents:()=>NF,fromStringArrayToUint8:()=>ZF,fromUint8ToStringArray:()=>QF,getAxesPermutation:()=>H_,getBroadcastDims:()=>ZI,getComplexWithIndex:()=>kF,getEinsumComputePath:()=>DF,getEinsumPermutation:()=>RF,getFusedBiasGradient:()=>YA,getFusedDyActivation:()=>XA,getImageCenter:()=>eF,getInnerMostAxes:()=>q_,getPermuted:()=>nF,getRaggedRank:()=>$R,getReductionAxes:()=>eT,getReshaped:()=>tF,getReshapedPermuted:()=>rF,getRowPartitionTypesHelper:()=>YR,getSliceBeginCoords:()=>aF,getSliceSize:()=>iF,getSparseFillEmptyRowsIndicesDenseShapeMismatch:()=>MF,getSparseFillEmptyRowsNegativeIndexErrorMessage:()=>jF,getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:()=>BF,getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:()=>WF,getSparseReshapeInputOutputMismatchErrorMessage:()=>HF,getSparseReshapeInputOutputMultipleErrorMessage:()=>VF,getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:()=>zF,getSparseReshapeNegativeOutputDimErrorMessage:()=>UF,getSparseSegmentReductionIndicesOutOfRangeErrorMessage:()=>XF,getSparseSegmentReductionNegativeSegmentIdsErrorMessage:()=>GF,getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:()=>qF,getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:()=>KF,getUndoAxesPermutation:()=>G_,isIdentityPermutation:()=>OF,log:()=>dC,mergeRealAndImagArrays:()=>bF,prepareAndValidate:()=>oF,prepareSplitSize:()=>PF,segment_util:()=>r,shouldFuse:()=>JA,slice_util:()=>t,splitRealAndImagArrays:()=>yF,stridesOrDilationsArePositive:()=>$T,tupleValuesAreOne:()=>XT,upcastType:()=>uE,validateDefaultValueShape:()=>JR,validateInput:()=>cF,validateUpdateShape:()=>sF,warn:()=>hC});var i={};n.r(i),n.d(i,{mx:()=>$W,XI:()=>WV,Nk:()=>VV,f6:()=>GV,ct:()=>GW,YG:()=>XV,hH:()=>eH,z3:()=>jH,sG:()=>YH,uM:()=>eG,vS:()=>vG,qB:()=>CG,GG:()=>IG,lg:()=>FG,rq:()=>_G,cu:()=>GG,WR:()=>WG,GE:()=>XG,px:()=>$G,jC:()=>hq,He:()=>pq,hE:()=>Nq,BF:()=>AH,Dk:()=>Oq,cl:()=>Wq,_B:()=>tK,ub:()=>oK,_f:()=>lK,Ku:()=>mK,qy:()=>vK,Zy:()=>_K,bu:()=>FK,zv:()=>PW,dH:()=>iV,HS:()=>jV,yH:()=>QK,l3:()=>eX,z9:()=>nX,x6:()=>sX,_m:()=>pX,eW:()=>yX,GK:()=>kX,SP:()=>CX,yr:()=>IX,dl:()=>oG,Dw:()=>DX,xT:()=>MX,_X:()=>dV,wz:()=>HX});var o={};n.r(o),n.d(o,{Decoder:()=>Uae,Encoder:()=>Bae,PacketType:()=>jae,protocol:()=>Mae});var s,c=n(9950),l=n.t(c,2),u=n(1352);function h(){return h=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},h.apply(this,arguments)}!function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"}(s||(s={}));const d="popstate";function f(e,t){if(!1===e||null===e||"undefined"===typeof e)throw new Error(t)}function p(e,t){if(!e){"undefined"!==typeof console&&console.warn(t);try{throw new Error(t)}catch(_a){}}}function m(e,t){return{usr:e.state,key:e.key,idx:t}}function g(e,t,n,r){return void 0===n&&(n=null),h({pathname:"string"===typeof e?e:e.pathname,search:"",hash:""},"string"===typeof t?b(t):t,{state:n,key:t&&t.key||r||Math.random().toString(36).substr(2,8)})}function v(e){let{pathname:t="/",search:n="",hash:r=""}=e;return n&&"?"!==n&&(t+="?"===n.charAt(0)?n:"?"+n),r&&"#"!==r&&(t+="#"===r.charAt(0)?r:"#"+r),t}function b(e){let t={};if(e){let n=e.indexOf("#");n>=0&&(t.hash=e.substr(n),e=e.substr(0,n));let r=e.indexOf("?");r>=0&&(t.search=e.substr(r),e=e.substr(0,r)),e&&(t.pathname=e)}return t}function y(e,t,n,r){void 0===r&&(r={});let{window:a=document.defaultView,v5Compat:i=!1}=r,o=a.history,c=s.Pop,l=null,u=p();function p(){return(o.state||{idx:null}).idx}function b(){c=s.Pop;let e=p(),t=null==e?null:e-u;u=e,l&&l({action:c,location:x.location,delta:t})}function y(e){let t="null"!==a.location.origin?a.location.origin:a.location.href,n="string"===typeof e?e:v(e);return n=n.replace(/ $/,"%20"),f(t,"No window.location.(origin|href) available to create URL for href: "+n),new URL(n,t)}null==u&&(u=0,o.replaceState(h({},o.state,{idx:u}),""));let x={get action(){return c},get location(){return e(a,o)},listen(e){if(l)throw new Error("A history only accepts one active listener");return a.addEventListener(d,b),l=e,()=>{a.removeEventListener(d,b),l=null}},createHref:e=>t(a,e),createURL:y,encodeLocation(e){let t=y(e);return{pathname:t.pathname,search:t.search,hash:t.hash}},push:function(e,t){c=s.Push;let r=g(x.location,e,t);n&&n(r,e),u=p()+1;let h=m(r,u),d=x.createHref(r);try{o.pushState(h,"",d)}catch(f){if(f instanceof DOMException&&"DataCloneError"===f.name)throw f;a.location.assign(d)}i&&l&&l({action:c,location:x.location,delta:1})},replace:function(e,t){c=s.Replace;let r=g(x.location,e,t);n&&n(r,e),u=p();let a=m(r,u),h=x.createHref(r);o.replaceState(a,"",h),i&&l&&l({action:c,location:x.location,delta:0})},go:e=>o.go(e)};return x}var x;!function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"}(x||(x={}));new Set(["lazy","caseSensitive","path","id","index","children"]);function w(e,t,n){return void 0===n&&(n="/"),k(e,t,n,!1)}function k(e,t,n,r){let a=P(("string"===typeof t?b(t):t).pathname||"/",n);if(null==a)return null;let i=S(e);!function(e){e.sort((e,t)=>e.score!==t.score?t.score-e.score:function(e,t){let n=e.length===t.length&&e.slice(0,-1).every((e,n)=>e===t[n]);return n?e[e.length-1]-t[t.length-1]:0}(e.routesMeta.map(e=>e.childrenIndex),t.routesMeta.map(e=>e.childrenIndex)))}(i);let o=null;for(let s=0;null==o&&s<i.length;++s){let e=L(a);o=D(i[s],e,r)}return o}function S(e,t,n,r){void 0===t&&(t=[]),void 0===n&&(n=[]),void 0===r&&(r="");let a=(e,a,i)=>{let o={relativePath:void 0===i?e.path||"":i,caseSensitive:!0===e.caseSensitive,childrenIndex:a,route:e};o.relativePath.startsWith("/")&&(f(o.relativePath.startsWith(r),'Absolute route path "'+o.relativePath+'" nested under path "'+r+'" is not valid. An absolute child route path must start with the combined path of all its parent routes.'),o.relativePath=o.relativePath.slice(r.length));let s=U([r,o.relativePath]),c=n.concat(o);e.children&&e.children.length>0&&(f(!0!==e.index,'Index routes must not have child routes. Please remove all child routes from route path "'+s+'".'),S(e.children,t,c,s)),(null!=e.path||e.index)&&t.push({path:s,score:F(s,e.index),routesMeta:c})};return e.forEach((e,t)=>{var n;if(""!==e.path&&null!=(n=e.path)&&n.includes("?"))for(let r of N(e.path))a(e,t,r);else a(e,t)}),t}function N(e){let t=e.split("/");if(0===t.length)return[];let[n,...r]=t,a=n.endsWith("?"),i=n.replace(/\?$/,"");if(0===r.length)return a?[i,""]:[i];let o=N(r.join("/")),s=[];return s.push(...o.map(e=>""===e?i:[i,e].join("/"))),a&&s.push(...o),s.map(t=>e.startsWith("/")&&""===t?"/":t)}const C=/^:[\w-]+$/,E=3,I=2,T=1,_=10,A=-2,R=e=>"*"===e;function F(e,t){let n=e.split("/"),r=n.length;return n.some(R)&&(r+=A),t&&(r+=I),n.filter(e=>!R(e)).reduce((e,t)=>e+(C.test(t)?E:""===t?T:_),r)}function D(e,t,n){void 0===n&&(n=!1);let{routesMeta:r}=e,a={},i="/",o=[];for(let s=0;s<r.length;++s){let e=r[s],c=s===r.length-1,l="/"===i?t:t.slice(i.length)||"/",u=O({path:e.relativePath,caseSensitive:e.caseSensitive,end:c},l),h=e.route;if(!u&&c&&n&&!r[r.length-1].route.index&&(u=O({path:e.relativePath,caseSensitive:e.caseSensitive,end:!1},l)),!u)return null;Object.assign(a,u.params),o.push({params:a,pathname:U([i,u.pathname]),pathnameBase:W(U([i,u.pathnameBase])),route:h}),"/"!==u.pathnameBase&&(i=U([i,u.pathnameBase]))}return o}function O(e,t){"string"===typeof e&&(e={path:e,caseSensitive:!1,end:!0});let[n,r]=function(e,t,n){void 0===t&&(t=!1);void 0===n&&(n=!0);p("*"===e||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were "'+e.replace(/\*$/,"/*")+'" because the `*` character must always follow a `/` in the pattern. To get rid of this warning, please change the route path to "'+e.replace(/\*$/,"/*")+'".');let r=[],a="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(e,t,n)=>(r.push({paramName:t,isOptional:null!=n}),n?"/?([^\\/]+)?":"/([^\\/]+)"));e.endsWith("*")?(r.push({paramName:"*"}),a+="*"===e||"/*"===e?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?a+="\\/*$":""!==e&&"/"!==e&&(a+="(?:(?=\\/|$))");let i=new RegExp(a,t?void 0:"i");return[i,r]}(e.path,e.caseSensitive,e.end),a=t.match(n);if(!a)return null;let i=a[0],o=i.replace(/(.)\/+$/,"$1"),s=a.slice(1),c=r.reduce((e,t,n)=>{let{paramName:r,isOptional:a}=t;if("*"===r){let e=s[n]||"";o=i.slice(0,i.length-e.length).replace(/(.)\/+$/,"$1")}const c=s[n];return e[r]=a&&!c?void 0:(c||"").replace(/%2F/g,"/"),e},{});return{params:c,pathname:i,pathnameBase:o,pattern:e}}function L(e){try{return e.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(t){return p(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent encoding ('+t+")."),e}}function P(e,t){if("/"===t)return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let n=t.endsWith("/")?t.length-1:t.length,r=e.charAt(n);return r&&"/"!==r?null:e.slice(n)||"/"}function M(e,t,n,r){return"Cannot include a '"+e+"' character in a manually specified `to."+t+"` field ["+JSON.stringify(r)+"].  Please separate it out to the `to."+n+'` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.'}function j(e){return e.filter((e,t)=>0===t||e.route.path&&e.route.path.length>0)}function B(e,t){let n=j(e);return t?n.map((e,t)=>t===n.length-1?e.pathname:e.pathnameBase):n.map(e=>e.pathnameBase)}function z(e,t,n,r){let a;void 0===r&&(r=!1),"string"===typeof e?a=b(e):(a=h({},e),f(!a.pathname||!a.pathname.includes("?"),M("?","pathname","search",a)),f(!a.pathname||!a.pathname.includes("#"),M("#","pathname","hash",a)),f(!a.search||!a.search.includes("#"),M("#","search","hash",a)));let i,o=""===e||""===a.pathname,s=o?"/":a.pathname;if(null==s)i=n;else{let e=t.length-1;if(!r&&s.startsWith("..")){let t=s.split("/");for(;".."===t[0];)t.shift(),e-=1;a.pathname=t.join("/")}i=e>=0?t[e]:"/"}let c=function(e,t){void 0===t&&(t="/");let{pathname:n,search:r="",hash:a=""}="string"===typeof e?b(e):e,i=n?n.startsWith("/")?n:function(e,t){let n=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(e=>{".."===e?n.length>1&&n.pop():"."!==e&&n.push(e)}),n.length>1?n.join("/"):"/"}(n,t):t;return{pathname:i,search:V(r),hash:H(a)}}(a,i),l=s&&"/"!==s&&s.endsWith("/"),u=(o||"."===s)&&n.endsWith("/");return c.pathname.endsWith("/")||!l&&!u||(c.pathname+="/"),c}const U=e=>e.join("/").replace(/\/\/+/g,"/"),W=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),V=e=>e&&"?"!==e?e.startsWith("?")?e:"?"+e:"",H=e=>e&&"#"!==e?e.startsWith("#")?e:"#"+e:"";Error;function G(e){return null!=e&&"number"===typeof e.status&&"string"===typeof e.statusText&&"boolean"===typeof e.internal&&"data"in e}const q=["post","put","patch","delete"],K=(new Set(q),["get",...q]);new Set(K),new Set([301,302,303,307,308]),new Set([307,308]);Symbol("deferred");function X(){return X=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},X.apply(this,arguments)}const Y=c.createContext(null);const J=c.createContext(null);const Q=c.createContext(null);const Z=c.createContext(null);const ee=c.createContext({outlet:null,matches:[],isDataRoute:!1});const te=c.createContext(null);function ne(){return null!=c.useContext(Z)}function re(){return ne()||f(!1),c.useContext(Z).location}function ae(e){c.useContext(Q).static||c.useLayoutEffect(e)}function ie(){let{isDataRoute:e}=c.useContext(ee);return e?function(){let{router:e}=ge(pe.UseNavigateStable),t=be(me.UseNavigateStable),n=c.useRef(!1);ae(()=>{n.current=!0});let r=c.useCallback(function(r,a){void 0===a&&(a={}),n.current&&("number"===typeof r?e.navigate(r):e.navigate(r,X({fromRouteId:t},a)))},[e,t]);return r}():function(){ne()||f(!1);let e=c.useContext(Y),{basename:t,future:n,navigator:r}=c.useContext(Q),{matches:a}=c.useContext(ee),{pathname:i}=re(),o=JSON.stringify(B(a,n.v7_relativeSplatPath)),s=c.useRef(!1);ae(()=>{s.current=!0});let l=c.useCallback(function(n,a){if(void 0===a&&(a={}),!s.current)return;if("number"===typeof n)return void r.go(n);let c=z(n,JSON.parse(o),i,"path"===a.relative);null==e&&"/"!==t&&(c.pathname="/"===c.pathname?t:U([t,c.pathname])),(a.replace?r.replace:r.push)(c,a.state,a)},[t,r,o,i,e]);return l}()}function oe(){let{matches:e}=c.useContext(ee),t=e[e.length-1];return t?t.params:{}}function se(e,t){let{relative:n}=void 0===t?{}:t,{future:r}=c.useContext(Q),{matches:a}=c.useContext(ee),{pathname:i}=re(),o=JSON.stringify(B(a,r.v7_relativeSplatPath));return c.useMemo(()=>z(e,JSON.parse(o),i,"path"===n),[e,o,i,n])}function ce(e,t,n,r){ne()||f(!1);let{navigator:a}=c.useContext(Q),{matches:i}=c.useContext(ee),o=i[i.length-1],l=o?o.params:{},u=(o&&o.pathname,o?o.pathnameBase:"/");o&&o.route;let h,d=re();if(t){var p;let e="string"===typeof t?b(t):t;"/"===u||(null==(p=e.pathname)?void 0:p.startsWith(u))||f(!1),h=e}else h=d;let m=h.pathname||"/",g=m;if("/"!==u){let e=u.replace(/^\//,"").split("/");g="/"+m.replace(/^\//,"").split("/").slice(e.length).join("/")}let v=w(e,{pathname:g});let y=fe(v&&v.map(e=>Object.assign({},e,{params:Object.assign({},l,e.params),pathname:U([u,a.encodeLocation?a.encodeLocation(e.pathname).pathname:e.pathname]),pathnameBase:"/"===e.pathnameBase?u:U([u,a.encodeLocation?a.encodeLocation(e.pathnameBase).pathname:e.pathnameBase])})),i,n,r);return t&&y?c.createElement(Z.Provider,{value:{location:X({pathname:"/",search:"",hash:"",state:null,key:"default"},h),navigationType:s.Pop}},y):y}function le(){let e=function(){var e;let t=c.useContext(te),n=ve(me.UseRouteError),r=be(me.UseRouteError);if(void 0!==t)return t;return null==(e=n.errors)?void 0:e[r]}(),t=G(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),n=e instanceof Error?e.stack:null,r="rgba(200,200,200, 0.5)",a={padding:"0.5rem",backgroundColor:r};return c.createElement(c.Fragment,null,c.createElement("h2",null,"Unexpected Application Error!"),c.createElement("h3",{style:{fontStyle:"italic"}},t),n?c.createElement("pre",{style:a},n):null,null)}const ue=c.createElement(le,null);class he extends c.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||"idle"!==t.revalidation&&"idle"===e.revalidation?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:void 0!==e.error?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){console.error("React Router caught the following error during render",e,t)}render(){return void 0!==this.state.error?c.createElement(ee.Provider,{value:this.props.routeContext},c.createElement(te.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function de(e){let{routeContext:t,match:n,children:r}=e,a=c.useContext(Y);return a&&a.static&&a.staticContext&&(n.route.errorElement||n.route.ErrorBoundary)&&(a.staticContext._deepestRenderedBoundaryId=n.route.id),c.createElement(ee.Provider,{value:t},r)}function fe(e,t,n,r){var a;if(void 0===t&&(t=[]),void 0===n&&(n=null),void 0===r&&(r=null),null==e){var i;if(!n)return null;if(n.errors)e=n.matches;else{if(!(null!=(i=r)&&i.v7_partialHydration&&0===t.length&&!n.initialized&&n.matches.length>0))return null;e=n.matches}}let o=e,s=null==(a=n)?void 0:a.errors;if(null!=s){let e=o.findIndex(e=>e.route.id&&void 0!==(null==s?void 0:s[e.route.id]));e>=0||f(!1),o=o.slice(0,Math.min(o.length,e+1))}let l=!1,u=-1;if(n&&r&&r.v7_partialHydration)for(let c=0;c<o.length;c++){let e=o[c];if((e.route.HydrateFallback||e.route.hydrateFallbackElement)&&(u=c),e.route.id){let{loaderData:t,errors:r}=n,a=e.route.loader&&void 0===t[e.route.id]&&(!r||void 0===r[e.route.id]);if(e.route.lazy||a){l=!0,o=u>=0?o.slice(0,u+1):[o[0]];break}}}return o.reduceRight((e,r,a)=>{let i,h=!1,d=null,f=null;var p;n&&(i=s&&r.route.id?s[r.route.id]:void 0,d=r.route.errorElement||ue,l&&(u<0&&0===a?(p="route-fallback",!1||ye[p]||(ye[p]=!0),h=!0,f=null):u===a&&(h=!0,f=r.route.hydrateFallbackElement||null)));let m=t.concat(o.slice(0,a+1)),g=()=>{let t;return t=i?d:h?f:r.route.Component?c.createElement(r.route.Component,null):r.route.element?r.route.element:e,c.createElement(de,{match:r,routeContext:{outlet:e,matches:m,isDataRoute:null!=n},children:t})};return n&&(r.route.ErrorBoundary||r.route.errorElement||0===a)?c.createElement(he,{location:n.location,revalidation:n.revalidation,component:d,error:i,children:g(),routeContext:{outlet:null,matches:m,isDataRoute:!0}}):g()},null)}var pe=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(pe||{}),me=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(me||{});function ge(e){let t=c.useContext(Y);return t||f(!1),t}function ve(e){let t=c.useContext(J);return t||f(!1),t}function be(e){let t=function(){let e=c.useContext(ee);return e||f(!1),e}(),n=t.matches[t.matches.length-1];return n.route.id||f(!1),n.route.id}const ye={};function xe(e,t){null==e||e.v7_startTransition,void 0===(null==e?void 0:e.v7_relativeSplatPath)&&(!t||t.v7_relativeSplatPath),t&&(t.v7_fetcherPersist,t.v7_normalizeFormMethod,t.v7_partialHydration,t.v7_skipActionErrorRevalidation)}l.startTransition;function we(e){let{to:t,replace:n,state:r,relative:a}=e;ne()||f(!1);let{future:i,static:o}=c.useContext(Q),{matches:s}=c.useContext(ee),{pathname:l}=re(),u=ie(),h=z(t,B(s,i.v7_relativeSplatPath),l,"path"===a),d=JSON.stringify(h);return c.useEffect(()=>u(JSON.parse(d),{replace:n,state:r,relative:a}),[u,d,a,n,r]),null}function ke(e){f(!1)}function Se(e){let{basename:t="/",children:n=null,location:r,navigationType:a=s.Pop,navigator:i,static:o=!1,future:l}=e;ne()&&f(!1);let u=t.replace(/^\/*/,"/"),h=c.useMemo(()=>({basename:u,navigator:i,static:o,future:X({v7_relativeSplatPath:!1},l)}),[u,l,i,o]);"string"===typeof r&&(r=b(r));let{pathname:d="/",search:p="",hash:m="",state:g=null,key:v="default"}=r,y=c.useMemo(()=>{let e=P(d,u);return null==e?null:{location:{pathname:e,search:p,hash:m,state:g,key:v},navigationType:a}},[u,d,p,m,g,v,a]);return null==y?null:c.createElement(Q.Provider,{value:h},c.createElement(Z.Provider,{children:n,value:y}))}function Ne(e){let{children:t,location:n}=e;return ce(Ce(t),n)}new Promise(()=>{});c.Component;function Ce(e,t){void 0===t&&(t=[]);let n=[];return c.Children.forEach(e,(e,r)=>{if(!c.isValidElement(e))return;let a=[...t,r];if(e.type===c.Fragment)return void n.push.apply(n,Ce(e.props.children,a));e.type!==ke&&f(!1),e.props.index&&e.props.children&&f(!1);let i={id:e.props.id||a.join("-"),caseSensitive:e.props.caseSensitive,element:e.props.element,Component:e.props.Component,index:e.props.index,path:e.props.path,loader:e.props.loader,action:e.props.action,errorElement:e.props.errorElement,ErrorBoundary:e.props.ErrorBoundary,hasErrorBoundary:null!=e.props.ErrorBoundary||null!=e.props.errorElement,shouldRevalidate:e.props.shouldRevalidate,handle:e.props.handle,lazy:e.props.lazy};e.props.children&&(i.children=Ce(e.props.children,a)),n.push(i)}),n}var Ee=n(7119),Ie=n.t(Ee,2);function Te(){return Te=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Te.apply(this,arguments)}function _e(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);const Ae=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],Re=["aria-current","caseSensitive","className","end","style","to","viewTransition","children"];try{window.__reactRouterVersion="6"}catch(_a){}const Fe=c.createContext({isTransitioning:!1});new Map;const De=l.startTransition;Ie.flushSync,l.useId;function Oe(e){let{basename:t,children:n,future:r,window:a}=e,i=c.useRef();var o;null==i.current&&(i.current=(void 0===(o={window:a,v5Compat:!0})&&(o={}),y(function(e,t){let{pathname:n,search:r,hash:a}=e.location;return g("",{pathname:n,search:r,hash:a},t.state&&t.state.usr||null,t.state&&t.state.key||"default")},function(e,t){return"string"===typeof t?t:v(t)},null,o)));let s=i.current,[l,u]=c.useState({action:s.action,location:s.location}),{v7_startTransition:h}=r||{},d=c.useCallback(e=>{h&&De?De(()=>u(e)):u(e)},[u,h]);return c.useLayoutEffect(()=>s.listen(d),[s,d]),c.useEffect(()=>xe(r),[r]),c.createElement(Se,{basename:t,children:n,location:l.location,navigationType:l.action,navigator:s,future:r})}const Le="undefined"!==typeof window&&"undefined"!==typeof window.document&&"undefined"!==typeof window.document.createElement,Pe=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Me=c.forwardRef(function(e,t){let n,{onClick:r,relative:a,reloadDocument:i,replace:o,state:s,target:l,to:u,preventScrollReset:h,viewTransition:d}=e,p=_e(e,Ae),{basename:m}=c.useContext(Q),g=!1;if("string"===typeof u&&Pe.test(u)&&(n=u,Le))try{let e=new URL(window.location.href),t=u.startsWith("//")?new URL(e.protocol+u):new URL(u),n=P(t.pathname,m);t.origin===e.origin&&null!=n?u=n+t.search+t.hash:g=!0}catch(_a){}let b=function(e,t){let{relative:n}=void 0===t?{}:t;ne()||f(!1);let{basename:r,navigator:a}=c.useContext(Q),{hash:i,pathname:o,search:s}=se(e,{relative:n}),l=o;return"/"!==r&&(l="/"===o?r:U([r,o])),a.createHref({pathname:l,search:s,hash:i})}(u,{relative:a}),y=function(e,t){let{target:n,replace:r,state:a,preventScrollReset:i,relative:o,viewTransition:s}=void 0===t?{}:t,l=ie(),u=re(),h=se(e,{relative:o});return c.useCallback(t=>{if(function(e,t){return 0===e.button&&(!t||"_self"===t)&&!function(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}(e)}(t,n)){t.preventDefault();let n=void 0!==r?r:v(u)===v(h);l(e,{replace:n,state:a,preventScrollReset:i,relative:o,viewTransition:s})}},[u,l,h,r,a,n,e,i,o,s])}(u,{replace:o,state:s,target:l,preventScrollReset:h,relative:a,viewTransition:d});return c.createElement("a",Te({},p,{href:n||b,onClick:g||i?r:function(e){r&&r(e),e.defaultPrevented||y(e)},ref:t,target:l}))});const je=c.forwardRef(function(e,t){let{"aria-current":n="page",caseSensitive:r=!1,className:a="",end:i=!1,style:o,to:s,viewTransition:l,children:u}=e,h=_e(e,Re),d=se(s,{relative:h.relative}),p=re(),m=c.useContext(J),{navigator:g,basename:v}=c.useContext(Q),b=null!=m&&function(e,t){void 0===t&&(t={});let n=c.useContext(Fe);null==n&&f(!1);let{basename:r}=Ue(Be.useViewTransitionState),a=se(e,{relative:t.relative});if(!n.isTransitioning)return!1;let i=P(n.currentLocation.pathname,r)||n.currentLocation.pathname,o=P(n.nextLocation.pathname,r)||n.nextLocation.pathname;return null!=O(a.pathname,o)||null!=O(a.pathname,i)}(d)&&!0===l,y=g.encodeLocation?g.encodeLocation(d).pathname:d.pathname,x=p.pathname,w=m&&m.navigation&&m.navigation.location?m.navigation.location.pathname:null;r||(x=x.toLowerCase(),w=w?w.toLowerCase():null,y=y.toLowerCase()),w&&v&&(w=P(w,v)||w);const k="/"!==y&&y.endsWith("/")?y.length-1:y.length;let S,N=x===y||!i&&x.startsWith(y)&&"/"===x.charAt(k),C=null!=w&&(w===y||!i&&w.startsWith(y)&&"/"===w.charAt(y.length)),E={isActive:N,isPending:C,isTransitioning:b},I=N?n:void 0;S="function"===typeof a?a(E):[a,N?"active":null,C?"pending":null,b?"transitioning":null].filter(Boolean).join(" ");let T="function"===typeof o?o(E):o;return c.createElement(Me,Te({},h,{"aria-current":I,className:S,ref:t,style:T,to:s,viewTransition:l}),"function"===typeof u?u(E):u)});var Be,ze;function Ue(e){let t=c.useContext(Y);return t||f(!1),t}(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(Be||(Be={})),function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"}(ze||(ze={}));var We={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},Ve=c.createContext&&c.createContext(We),He=["attr","size","title"];function Ge(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n={};for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){if(t.indexOf(r)>=0)continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}function qe(){return qe=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},qe.apply(this,arguments)}function Ke(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Xe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ke(Object(n),!0).forEach(function(t){Ye(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ke(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function Ye(e,t,n){return t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function $e(e){return e&&e.map((e,t)=>c.createElement(e.tag,Xe({key:t},e.attr),$e(e.child)))}function Je(e){return t=>c.createElement(Qe,qe({attr:Xe({},e.attr)},t),$e(e.child))}function Qe(e){var t=t=>{var n,{attr:r,size:a,title:i}=e,o=Ge(e,He),s=a||t.size||"1em";return t.className&&(n=t.className),e.className&&(n=(n?n+" ":"")+e.className),c.createElement("svg",qe({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},t.attr,r,o,{className:n,style:Xe(Xe({color:e.color||t.color},t.style),e.style),height:s,width:s,xmlns:"http://www.w3.org/2000/svg"}),i&&c.createElement("title",null,i),e.children)};return void 0!==Ve?c.createElement(Ve.Consumer,null,e=>t(e)):t(We)}function Ze(e){return Je({tag:"svg",attr:{viewBox:"0 0 320 512"},child:[{tag:"path",attr:{d:"M143 352.3L7 216.3c-9.4-9.4-9.4-24.6 0-33.9l22.6-22.6c9.4-9.4 24.6-9.4 33.9 0l96.4 96.4 96.4-96.4c9.4-9.4 24.6-9.4 33.9 0l22.6 22.6c9.4 9.4 9.4 24.6 0 33.9l-136 136c-9.2 9.4-24.4 9.4-33.8 0z"},child:[]}]})(e)}function et(e){return Je({tag:"svg",attr:{viewBox:"0 0 320 512"},child:[{tag:"path",attr:{d:"M177 159.7l136 136c9.4 9.4 9.4 24.6 0 33.9l-22.6 22.6c-9.4 9.4-24.6 9.4-33.9 0L160 255.9l-96.4 96.4c-9.4 9.4-24.6 9.4-33.9 0L7 329.7c-9.4-9.4-9.4-24.6 0-33.9l136-136c9.4-9.5 24.6-9.5 34-.1z"},child:[]}]})(e)}function tt(e){return Je({tag:"svg",attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M16 132h416c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H16C7.163 60 0 67.163 0 76v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"},child:[]}]})(e)}function nt(e){return Je({tag:"svg",attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M224 512c35.32 0 63.97-28.65 63.97-64H160.03c0 35.35 28.65 64 63.97 64zm215.39-149.71c-19.32-20.76-55.47-51.99-55.47-154.29 0-77.7-54.48-139.9-127.94-155.16V32c0-17.67-14.32-32-31.98-32s-31.98 14.33-31.98 32v20.84C118.56 68.1 64.08 130.3 64.08 208c0 102.3-36.15 133.53-55.47 154.29-6 6.45-8.66 14.16-8.61 21.71.11 16.4 12.98 32 32.1 32h383.8c19.12 0 32-15.6 32.1-32 .05-7.55-2.61-15.27-8.61-21.71z"},child:[]}]})(e)}function rt(e){return Je({tag:"svg",attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M0 464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V192H0v272zm320-196c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12h-40c-6.6 0-12-5.4-12-12v-40zm0 128c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12h-40c-6.6 0-12-5.4-12-12v-40zM192 268c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12h-40c-6.6 0-12-5.4-12-12v-40zm0 128c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12h-40c-6.6 0-12-5.4-12-12v-40zM64 268c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12H76c-6.6 0-12-5.4-12-12v-40zm0 128c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12H76c-6.6 0-12-5.4-12-12v-40zM400 64h-48V16c0-8.8-7.2-16-16-16h-32c-8.8 0-16 7.2-16 16v48H160V16c0-8.8-7.2-16-16-16h-32c-8.8 0-16 7.2-16 16v48H48C21.5 64 0 85.5 0 112v48h448v-48c0-26.5-21.5-48-48-48z"},child:[]}]})(e)}function at(e){return Je({tag:"svg",attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M436 160H12c-6.627 0-12-5.373-12-12v-36c0-26.51 21.49-48 48-48h48V12c0-6.627 5.373-12 12-12h40c6.627 0 12 5.373 12 12v52h128V12c0-6.627 5.373-12 12-12h40c6.627 0 12 5.373 12 12v52h48c26.51 0 48 21.49 48 48v36c0 6.627-5.373 12-12 12zM12 192h424c6.627 0 12 5.373 12 12v260c0 26.51-21.49 48-48 48H48c-26.51 0-48-21.49-48-48V204c0-6.627 5.373-12 12-12zm333.296 95.947l-28.169-28.398c-4.667-4.705-12.265-4.736-16.97-.068L194.12 364.665l-45.98-46.352c-4.667-4.705-12.266-4.736-16.971-.068l-28.397 28.17c-4.705 4.667-4.736 12.265-.068 16.97l82.601 83.269c4.667 4.705 12.265 4.736 16.97.068l142.953-141.805c4.705-4.667 4.736-12.265.068-16.97z"},child:[]}]})(e)}function it(e){return Je({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M512 144v288c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V144c0-26.5 21.5-48 48-48h88l12.3-32.9c7-18.7 24.9-31.1 44.9-31.1h125.5c20 0 37.9 12.4 44.9 31.1L376 96h88c26.5 0 48 21.5 48 48zM376 288c0-66.2-53.8-120-120-120s-120 53.8-120 120 53.8 120 120 120 120-53.8 120-120zm-32 0c0 48.5-39.5 88-88 88s-88-39.5-88-88 39.5-88 88-88 88 39.5 88 88z"},child:[]}]})(e)}function ot(e){return Je({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M496 384H64V80c0-8.84-7.16-16-16-16H16C7.16 64 0 71.16 0 80v336c0 17.67 14.33 32 32 32h464c8.84 0 16-7.16 16-16v-32c0-8.84-7.16-16-16-16zM464 96H345.94c-21.38 0-32.09 25.85-16.97 40.97l32.4 32.4L288 242.75l-73.37-73.37c-12.5-12.5-32.76-12.5-45.25 0l-68.69 68.69c-6.25 6.25-6.25 16.38 0 22.63l22.62 22.62c6.25 6.25 16.38 6.25 22.63 0L192 237.25l73.37 73.37c12.5 12.5 32.76 12.5 45.25 0l96-96 32.4 32.4c15.12 15.12 40.97 4.41 40.97-16.97V112c.01-8.84-7.15-16-15.99-16z"},child:[]}]})(e)}function st(e){return Je({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M504 256c0 136.967-111.033 248-248 248S8 392.967 8 256 119.033 8 256 8s248 111.033 248 248zM227.314 387.314l184-184c6.248-6.248 6.248-16.379 0-22.627l-22.627-22.627c-6.248-6.249-16.379-6.249-22.628 0L216 308.118l-70.059-70.059c-6.248-6.248-16.379-6.248-22.628 0l-22.627 22.627c-6.248 6.248-6.248 16.379 0 22.627l104 104c6.249 6.249 16.379 6.249 22.628.001z"},child:[]}]})(e)}function ct(e){return Je({tag:"svg",attr:{viewBox:"0 0 320 512"},child:[{tag:"path",attr:{d:"M34.52 239.03L228.87 44.69c9.37-9.37 24.57-9.37 33.94 0l22.67 22.67c9.36 9.36 9.37 24.52.04 33.9L131.49 256l154.02 154.75c9.34 9.38 9.32 24.54-.04 33.9l-22.67 22.67c-9.37 9.37-24.57 9.37-33.94 0L34.52 272.97c-9.37-9.37-9.37-24.57 0-33.94z"},child:[]}]})(e)}function lt(e){return Je({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256,8C119,8,8,119,8,256S119,504,256,504,504,393,504,256,393,8,256,8Zm92.49,313h0l-20,25a16,16,0,0,1-22.49,2.5h0l-67-49.72a40,40,0,0,1-15-31.23V112a16,16,0,0,1,16-16h32a16,16,0,0,1,16,16V256l58,42.5A16,16,0,0,1,348.49,321Z"},child:[]}]})(e)}function ut(e){return Je({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M487.4 315.7l-42.6-24.6c4.3-23.2 4.3-47 0-70.2l42.6-24.6c4.9-2.8 7.1-8.6 5.5-14-11.1-35.6-30-67.8-54.7-94.6-3.8-4.1-10-5.1-14.8-2.3L380.8 110c-17.9-15.4-38.5-27.3-60.8-35.1V25.8c0-5.6-3.9-10.5-9.4-11.7-36.7-8.2-74.3-7.8-109.2 0-5.5 1.2-9.4 6.1-9.4 11.7V75c-22.2 7.9-42.8 19.8-60.8 35.1L88.7 85.5c-4.9-2.8-11-1.9-14.8 2.3-24.7 26.7-43.6 58.9-54.7 94.6-1.7 5.4.6 11.2 5.5 14L67.3 221c-4.3 23.2-4.3 47 0 70.2l-42.6 24.6c-4.9 2.8-7.1 8.6-5.5 14 11.1 35.6 30 67.8 54.7 94.6 3.8 4.1 10 5.1 14.8 2.3l42.6-24.6c17.9 15.4 38.5 27.3 60.8 35.1v49.2c0 5.6 3.9 10.5 9.4 11.7 36.7 8.2 74.3 7.8 109.2 0 5.5-1.2 9.4-6.1 9.4-11.7v-49.2c22.2-7.9 42.8-19.8 60.8-35.1l42.6 24.6c4.9 2.8 11 1.9 14.8-2.3 24.7-26.7 43.6-58.9 54.7-94.6 1.5-5.5-.7-11.3-5.6-14.1zM256 336c-44.1 0-80-35.9-80-80s35.9-80 80-80 80 35.9 80 80-35.9 80-80 80z"},child:[]}]})(e)}function ht(e){return Je({tag:"svg",attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M436 192H312c-13.3 0-24-10.7-24-24V44c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v84h84c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12zm-276-24V44c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v84H12c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h124c13.3 0 24-10.7 24-24zm0 300V344c0-13.3-10.7-24-24-24H12c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h84v84c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm192 0v-84h84c6.6 0 12-5.4 12-12v-40c0-6.6-5.4-12-12-12H312c-13.3 0-24 10.7-24 24v124c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12z"},child:[]}]})(e)}function dt(e){return Je({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 8C119.033 8 8 119.033 8 256s111.033 248 248 248 248-111.033 248-248S392.967 8 256 8zm80 248c0 44.112-35.888 80-80 80s-80-35.888-80-80 35.888-80 80-80 80 35.888 80 80z"},child:[]}]})(e)}function ft(e){return Je({tag:"svg",attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M402.6 83.2l90.2 90.2c3.8 3.8 3.8 10 0 13.8L274.4 405.6l-92.8 10.3c-12.4 1.4-22.9-9.1-21.5-21.5l10.3-92.8L388.8 83.2c3.8-3.8 10-3.8 13.8 0zm162-22.9l-48.8-48.8c-15.2-15.2-39.9-15.2-55.2 0l-35.4 35.4c-3.8 3.8-3.8 10 0 13.8l90.2 90.2c3.8 3.8 10 3.8 13.8 0l35.4-35.4c15.2-15.3 15.2-40 0-55.2zM384 346.2V448H64V128h229.8c3.2 0 6.2-1.3 8.5-3.5l40-40c7.6-7.6 2.2-20.5-8.5-20.5H48C21.5 64 0 85.5 0 112v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V306.2c0-10.7-12.9-16-20.5-8.5l-40 40c-2.2 2.3-3.5 5.3-3.5 8.5z"},child:[]}]})(e)}function pt(e){return Je({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M502.3 190.8c3.9-3.1 9.7-.2 9.7 4.7V400c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V195.6c0-5 5.7-7.8 9.7-4.7 22.4 17.4 52.1 39.5 154.1 113.6 21.1 15.4 56.7 47.8 92.2 47.6 35.7.3 72-32.8 92.3-47.6 102-74.1 131.6-96.3 154-113.7zM256 320c23.2.4 56.6-29.2 73.4-41.4 132.7-96.3 142.8-104.7 173.4-128.7 5.8-4.5 9.2-11.5 9.2-18.9v-19c0-26.5-21.5-48-48-48H48C21.5 64 0 85.5 0 112v19c0 7.4 3.4 14.3 9.2 18.9 30.6 23.9 40.7 32.4 173.4 128.7 16.8 12.2 50.2 41.8 73.4 41.4z"},child:[]}]})(e)}function mt(e){return Je({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M504 256c0 136.997-111.043 248-248 248S8 392.997 8 256C8 119.083 119.043 8 256 8s248 111.083 248 248zm-248 50c-25.405 0-46 20.595-46 46s20.595 46 46 46 46-20.595 46-46-20.595-46-46-46zm-43.673-165.346l7.418 136c.347 6.364 5.609 11.346 11.982 11.346h48.546c6.373 0 11.635-4.982 11.982-11.346l7.418-136c.375-6.874-5.098-12.654-11.982-12.654h-63.383c-6.884 0-12.356 5.78-11.981 12.654z"},child:[]}]})(e)}function gt(e){return Je({tag:"svg",attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M569.517 440.013C587.975 472.007 564.806 512 527.94 512H48.054c-36.937 0-59.999-40.055-41.577-71.987L246.423 23.985c18.467-32.009 64.72-31.951 83.154 0l239.94 416.028zM288 354c-25.405 0-46 20.595-46 46s20.595 46 46 46 46-20.595 46-46-20.595-46-46-46zm-43.673-165.346l7.418 136c.347 6.364 5.609 11.346 11.982 11.346h48.546c6.373 0 11.635-4.982 11.982-11.346l7.418-136c.375-6.874-5.098-12.654-11.982-12.654h-63.383c-6.884 0-12.356 5.78-11.981 12.654z"},child:[]}]})(e)}function vt(e){return Je({tag:"svg",attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M0 180V56c0-13.3 10.7-24 24-24h124c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12H64v84c0 6.6-5.4 12-12 12H12c-6.6 0-12-5.4-12-12zM288 44v40c0 6.6 5.4 12 12 12h84v84c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12V56c0-13.3-10.7-24-24-24H300c-6.6 0-12 5.4-12 12zm148 276h-40c-6.6 0-12 5.4-12 12v84h-84c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h124c13.3 0 24-10.7 24-24V332c0-6.6-5.4-12-12-12zM160 468v-40c0-6.6-5.4-12-12-12H64v-84c0-6.6-5.4-12-12-12H12c-6.6 0-12 5.4-12 12v124c0 13.3 10.7 24 24 24h124c6.6 0 12-5.4 12-12z"},child:[]}]})(e)}function bt(e){return Je({tag:"svg",attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M572.52 241.4C518.29 135.59 410.93 64 288 64S57.68 135.64 3.48 241.41a32.35 32.35 0 0 0 0 29.19C57.71 376.41 165.07 448 288 448s230.32-71.64 284.52-177.41a32.35 32.35 0 0 0 0-29.19zM288 400a144 144 0 1 1 144-144 143.93 143.93 0 0 1-144 144zm0-240a95.31 95.31 0 0 0-25.31 3.79 47.85 47.85 0 0 1-66.9 66.9A95.78 95.78 0 1 0 288 160z"},child:[]}]})(e)}function yt(e){return Je({tag:"svg",attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M224 136V0H24C10.7 0 0 10.7 0 24v464c0 13.3 10.7 24 24 24h336c13.3 0 24-10.7 24-24V160H248c-13.2 0-24-10.8-24-24zm60.1 106.5L224 336l60.1 93.5c5.1 8-.6 18.5-10.1 18.5h-34.9c-4.4 0-8.5-2.4-10.6-6.3C208.9 405.5 192 373 192 373c-6.4 14.8-10 20-36.6 68.8-2.1 3.9-6.1 6.3-10.5 6.3H110c-9.5 0-15.2-10.5-10.1-18.5l60.3-93.5-60.3-93.5c-5.2-8 .6-18.5 10.1-18.5h34.8c4.4 0 8.5 2.4 10.6 6.3 26.1 48.8 20 33.6 36.6 68.5 0 0 6.1-11.7 36.6-68.5 2.1-3.9 6.2-6.3 10.6-6.3H274c9.5-.1 15.2 10.4 10.1 18.4zM384 121.9v6.1H256V0h6.1c6.4 0 12.5 2.5 17 7l97.9 98c4.5 4.5 7 10.6 7 16.9z"},child:[]}]})(e)}function xt(e){return Je({tag:"svg",attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M181.9 256.1c-5-16-4.9-46.9-2-46.9 8.4 0 7.6 36.9 2 46.9zm-1.7 47.2c-7.7 20.2-17.3 43.3-28.4 62.7 18.3-7 39-17.2 62.9-21.9-12.7-9.6-24.9-23.4-34.5-40.8zM86.1 428.1c0 .8 13.2-5.4 34.9-40.2-6.7 6.3-29.1 24.5-34.9 40.2zM248 160h136v328c0 13.3-10.7 24-24 24H24c-13.3 0-24-10.7-24-24V24C0 10.7 10.7 0 24 0h200v136c0 13.2 10.8 24 24 24zm-8 171.8c-20-12.2-33.3-29-42.7-53.8 4.5-18.5 11.6-46.6 6.2-64.2-4.7-29.4-42.4-26.5-47.8-6.8-5 18.3-.4 44.1 8.1 77-11.6 27.6-28.7 64.6-40.8 85.8-.1 0-.1.1-.2.1-27.1 13.9-73.6 44.5-54.5 68 5.6 6.9 16 10 21.5 10 17.9 0 35.7-18 61.1-61.8 25.8-8.5 54.1-19.1 79-23.2 21.7 11.8 47.1 19.5 64 19.5 29.2 0 31.2-32 19.7-43.4-13.9-13.6-54.3-9.7-73.6-7.2zM377 105L279 7c-4.5-4.5-10.6-7-17-7h-6v128h128v-6.1c0-6.3-2.5-12.4-7-16.9zm-74.1 255.3c4.1-2.7-2.5-11.9-42.8-9 37.1 15.8 42.8 9 42.8 9z"},child:[]}]})(e)}function wt(e){return Je({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M487.976 0H24.028C2.71 0-8.047 25.866 7.058 40.971L192 225.941V432c0 7.831 3.821 15.17 10.237 19.662l80 55.98C298.02 518.69 320 507.493 320 487.98V225.941l184.947-184.97C520.021 25.896 509.338 0 487.976 0z"},child:[]}]})(e)}function kt(e){return Je({tag:"svg",attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M280.37 148.26L96 300.11V464a16 16 0 0 0 16 16l112.06-.29a16 16 0 0 0 15.92-16V368a16 16 0 0 1 16-16h64a16 16 0 0 1 16 16v95.64a16 16 0 0 0 16 16.05L464 480a16 16 0 0 0 16-16V300L295.67 148.26a12.19 12.19 0 0 0-15.3 0zM571.6 251.47L488 182.56V44.05a12 12 0 0 0-12-12h-56a12 12 0 0 0-12 12v72.61L318.47 43a48 48 0 0 0-61 0L4.34 251.47a12 12 0 0 0-1.6 16.9l25.5 31A12 12 0 0 0 45.15 301l235.22-193.74a12.19 12.19 0 0 1 15.3 0L530.9 301a12 12 0 0 0 16.9-1.6l25.5-31a12 12 0 0 0-1.7-16.93z"},child:[]}]})(e)}function St(e){return Je({tag:"svg",attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M528 32H48C21.5 32 0 53.5 0 80v16h576V80c0-26.5-21.5-48-48-48zM0 432c0 26.5 21.5 48 48 48h480c26.5 0 48-21.5 48-48V128H0v304zm352-232c0-4.4 3.6-8 8-8h144c4.4 0 8 3.6 8 8v16c0 4.4-3.6 8-8 8H360c-4.4 0-8-3.6-8-8v-16zm0 64c0-4.4 3.6-8 8-8h144c4.4 0 8 3.6 8 8v16c0 4.4-3.6 8-8 8H360c-4.4 0-8-3.6-8-8v-16zm0 64c0-4.4 3.6-8 8-8h144c4.4 0 8 3.6 8 8v16c0 4.4-3.6 8-8 8H360c-4.4 0-8-3.6-8-8v-16zM176 192c35.3 0 64 28.7 64 64s-28.7 64-64 64-64-28.7-64-64 28.7-64 64-64zM67.1 396.2C75.5 370.5 99.6 352 128 352h8.2c12.3 5.1 25.7 8 39.8 8s27.6-2.9 39.8-8h8.2c28.4 0 52.5 18.5 60.9 44.2 3.2 9.9-5.2 19.8-15.6 19.8H82.7c-10.4 0-18.8-10-15.6-19.8z"},child:[]}]})(e)}function Nt(e){return Je({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 8C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm0 110c23.196 0 42 18.804 42 42s-18.804 42-42 42-42-18.804-42-42 18.804-42 42-42zm56 254c0 6.627-5.373 12-12 12h-88c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h12v-64h-12c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h64c6.627 0 12 5.373 12 12v100h12c6.627 0 12 5.373 12 12v24z"},child:[]}]})(e)}function Ct(e){return Je({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M464 480H48c-26.51 0-48-21.49-48-48V80c0-26.51 21.49-48 48-48h416c26.51 0 48 21.49 48 48v352c0 26.51-21.49 48-48 48zM128 120c-22.091 0-40 17.909-40 40s17.909 40 40 40 40-17.909 40-40-17.909-40-40-40zm0 96c-22.091 0-40 17.909-40 40s17.909 40 40 40 40-17.909 40-40-17.909-40-40-40zm0 96c-22.091 0-40 17.909-40 40s17.909 40 40 40 40-17.909 40-40-17.909-40-40-40zm288-136v-32c0-6.627-5.373-12-12-12H204c-6.627 0-12 5.373-12 12v32c0 6.627 5.373 12 12 12h200c6.627 0 12-5.373 12-12zm0 96v-32c0-6.627-5.373-12-12-12H204c-6.627 0-12 5.373-12 12v32c0 6.627 5.373 12 12 12h200c6.627 0 12-5.373 12-12zm0 96v-32c0-6.627-5.373-12-12-12H204c-6.627 0-12 5.373-12 12v32c0 6.627 5.373 12 12 12h200c6.627 0 12-5.373 12-12z"},child:[]}]})(e)}function Et(e){return Je({tag:"svg",attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M400 224h-24v-72C376 68.2 307.8 0 224 0S72 68.2 72 152v72H48c-26.5 0-48 21.5-48 48v192c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V272c0-26.5-21.5-48-48-48zm-104 0H152v-72c0-39.7 32.3-72 72-72s72 32.3 72 72v72z"},child:[]}]})(e)}function It(e){return Je({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M476 3.2L12.5 270.6c-18.1 10.4-15.8 35.6 2.2 43.2L121 358.4l287.3-253.2c5.5-4.9 13.3 2.6 8.6 8.3L176 407v80.5c0 23.6 28.5 32.9 42.5 15.8L282 426l124.6 52.2c14.2 6 30.4-2.9 33-18.2l72-432C515 7.8 493.3-6.8 476 3.2z"},child:[]}]})(e)}function Tt(e){return Je({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M8.309 189.836L184.313 37.851C199.719 24.546 224 35.347 224 56.015v80.053c160.629 1.839 288 34.032 288 186.258 0 61.441-39.581 122.309-83.333 154.132-13.653 9.931-33.111-2.533-28.077-18.631 45.344-145.012-21.507-183.51-176.59-185.742V360c0 20.7-24.3 31.453-39.687 18.164l-176.004-152c-11.071-9.562-11.086-26.753 0-36.328z"},child:[]}]})(e)}function _t(e){return Je({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"},child:[]}]})(e)}function At(e){return Je({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M416 448h-84c-6.6 0-12-5.4-12-12v-40c0-6.6 5.4-12 12-12h84c17.7 0 32-14.3 32-32V160c0-17.7-14.3-32-32-32h-84c-6.6 0-12-5.4-12-12V76c0-6.6 5.4-12 12-12h84c53 0 96 43 96 96v192c0 53-43 96-96 96zm-47-201L201 79c-15-15-41-4.5-41 17v96H24c-13.3 0-24 10.7-24 24v96c0 13.3 10.7 24 24 24h136v96c0 21.5 26 32 41 17l168-168c9.3-9.4 9.3-24.6 0-34z"},child:[]}]})(e)}function Rt(e){return Je({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M497 273L329 441c-15 15-41 4.5-41-17v-96H152c-13.3 0-24-10.7-24-24v-96c0-13.3 10.7-24 24-24h136V88c0-21.4 25.9-32 41-17l168 168c9.3 9.4 9.3 24.6 0 34zM192 436v-40c0-6.6-5.4-12-12-12H96c-17.7 0-32-14.3-32-32V160c0-17.7 14.3-32 32-32h84c6.6 0 12-5.4 12-12V76c0-6.6-5.4-12-12-12H96c-53 0-96 43-96 96v192c0 53 43 96 96 96h84c6.6 0 12-5.4 12-12z"},child:[]}]})(e)}function Ft(e){return Je({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M304 48c0 26.51-21.49 48-48 48s-48-21.49-48-48 21.49-48 48-48 48 21.49 48 48zm-48 368c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48zm208-208c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48zM96 256c0-26.51-21.49-48-48-48S0 229.49 0 256s21.49 48 48 48 48-21.49 48-48zm12.922 99.078c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48c0-26.509-21.491-48-48-48zm294.156 0c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48c0-26.509-21.49-48-48-48zM108.922 60.922c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.491-48-48-48z"},child:[]}]})(e)}function Dt(e){return Je({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M370.72 133.28C339.458 104.008 298.888 87.962 255.848 88c-77.458.068-144.328 53.178-162.791 126.85-1.344 5.363-6.122 9.15-11.651 9.15H24.103c-7.498 0-13.194-6.807-11.807-14.176C33.933 94.924 134.813 8 256 8c66.448 0 126.791 26.136 171.315 68.685L463.03 40.97C478.149 25.851 504 36.559 504 57.941V192c0 13.255-10.745 24-24 24H345.941c-21.382 0-32.09-25.851-16.971-40.971l41.75-41.749zM32 296h134.059c21.382 0 32.09 25.851 16.971 40.971l-41.75 41.75c31.262 29.273 71.835 45.319 114.876 45.28 77.418-.07 144.315-53.144 162.787-126.849 1.344-5.363 6.122-9.15 11.651-9.15h57.304c7.498 0 13.194 6.807 11.807 14.176C478.067 417.076 377.187 504 256 504c-66.448 0-126.791-26.136-171.315-68.685L48.97 471.03C33.851 486.149 8 475.441 8 454.059V320c0-13.255 10.745-24 24-24z"},child:[]}]})(e)}function Ot(e){return Je({tag:"svg",attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M288 32C128.94 32 0 160.94 0 320c0 52.8 14.25 102.26 39.06 144.8 5.61 9.62 16.3 15.2 27.44 15.2h443c11.14 0 21.83-5.58 27.44-15.2C561.75 422.26 576 372.8 576 320c0-159.06-128.94-288-288-288zm0 64c14.71 0 26.58 10.13 30.32 23.65-1.11 2.26-2.64 4.23-3.45 6.67l-9.22 27.67c-5.13 3.49-10.97 6.01-17.64 6.01-17.67 0-32-14.33-32-32S270.33 96 288 96zM96 384c-17.67 0-32-14.33-32-32s14.33-32 32-32 32 14.33 32 32-14.33 32-32 32zm48-160c-17.67 0-32-14.33-32-32s14.33-32 32-32 32 14.33 32 32-14.33 32-32 32zm246.77-72.41l-61.33 184C343.13 347.33 352 364.54 352 384c0 11.72-3.38 22.55-8.88 32H232.88c-5.5-9.45-8.88-20.28-8.88-32 0-33.94 26.5-61.43 59.9-63.59l61.34-184.01c4.17-12.56 17.73-19.45 30.36-15.17 12.57 4.19 19.35 17.79 15.17 30.36zm14.66 57.2l15.52-46.55c3.47-1.29 7.13-2.23 11.05-2.23 17.67 0 32 14.33 32 32s-14.33 32-32 32c-11.38-.01-20.89-6.28-26.57-15.22zM480 384c-17.67 0-32-14.33-32-32s14.33-32 32-32 32 14.33 32 32-14.33 32-32 32z"},child:[]}]})(e)}function Lt(e){return Je({tag:"svg",attr:{viewBox:"0 0 352 512"},child:[{tag:"path",attr:{d:"M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z"},child:[]}]})(e)}function Pt(e){return Je({tag:"svg",attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M432 32H312l-9.4-18.7A24 24 0 0 0 281.1 0H166.8a23.72 23.72 0 0 0-21.4 13.3L136 32H16A16 16 0 0 0 0 48v32a16 16 0 0 0 16 16h416a16 16 0 0 0 16-16V48a16 16 0 0 0-16-16zM53.2 467a48 48 0 0 0 47.9 45h245.8a48 48 0 0 0 47.9-45L416 128H32z"},child:[]}]})(e)}function Mt(e){return Je({tag:"svg",attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M224 256c70.7 0 128-57.3 128-128S294.7 0 224 0 96 57.3 96 128s57.3 128 128 128zm89.6 32h-16.7c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16h-16.7C60.2 288 0 348.2 0 422.4V464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48v-41.6c0-74.2-60.2-134.4-134.4-134.4zm323-128.4l-27.8-28.1c-4.6-4.7-12.1-4.7-16.8-.1l-104.8 104-45.5-45.8c-4.6-4.7-12.1-4.7-16.8-.1l-28.1 27.9c-4.7 4.6-4.7 12.1-.1 16.8l81.7 82.3c4.6 4.7 12.1 4.7 16.8.1l141.3-140.2c4.6-4.7 4.7-12.2.1-16.8z"},child:[]}]})(e)}function jt(e){return Je({tag:"svg",attr:{viewBox:"0 0 496 512"},child:[{tag:"path",attr:{d:"M248 8C111 8 0 119 0 256s111 248 248 248 248-111 248-248S385 8 248 8zm0 96c48.6 0 88 39.4 88 88s-39.4 88-88 88-88-39.4-88-88 39.4-88 88-88zm0 344c-58.7 0-111.3-26.6-146.5-68.2 18.8-35.4 55.6-59.8 98.5-59.8 2.4 0 4.8.4 7.1 1.1 13 4.2 26.6 6.9 40.9 6.9 14.3 0 28-2.7 40.9-6.9 2.3-.7 4.7-1.1 7.1-1.1 42.9 0 79.7 24.4 98.5 59.8C359.3 421.4 306.7 448 248 448z"},child:[]}]})(e)}function Bt(e){return Je({tag:"svg",attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M325.4 289.2L224 390.6 122.6 289.2C54 295.3 0 352.2 0 422.4V464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48v-41.6c0-70.2-54-127.1-122.6-133.2zM32 192c27.3 0 51.8-11.5 69.2-29.7 15.1 53.9 64 93.7 122.8 93.7 70.7 0 128-57.3 128-128S294.7 0 224 0c-50.4 0-93.6 29.4-114.5 71.8C92.1 47.8 64 32 32 32c0 33.4 17.1 62.8 43.1 80-26 17.2-43.1 46.6-43.1 80zm144-96h96c17.7 0 32 14.3 32 32H144c0-17.7 14.3-32 32-32z"},child:[]}]})(e)}function zt(e){return Je({tag:"svg",attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M624 208h-64v-64c0-8.8-7.2-16-16-16h-32c-8.8 0-16 7.2-16 16v64h-64c-8.8 0-16 7.2-16 16v32c0 8.8 7.2 16 16 16h64v64c0 8.8 7.2 16 16 16h32c8.8 0 16-7.2 16-16v-64h64c8.8 0 16-7.2 16-16v-32c0-8.8-7.2-16-16-16zm-400 48c70.7 0 128-57.3 128-128S294.7 0 224 0 96 57.3 96 128s57.3 128 128 128zm89.6 32h-16.7c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16h-16.7C60.2 288 0 348.2 0 422.4V464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48v-41.6c0-74.2-60.2-134.4-134.4-134.4z"},child:[]}]})(e)}function Ut(e){return Je({tag:"svg",attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M622.3 271.1l-115.2-45c-4.1-1.6-12.6-3.7-22.2 0l-115.2 45c-10.7 4.2-17.7 14-17.7 24.9 0 111.6 68.7 188.8 132.9 213.9 9.6 3.7 18 1.6 22.2 0C558.4 489.9 640 420.5 640 296c0-10.9-7-20.7-17.7-24.9zM496 462.4V273.3l95.5 37.3c-5.6 87.1-60.9 135.4-95.5 151.8zM224 256c70.7 0 128-57.3 128-128S294.7 0 224 0 96 57.3 96 128s57.3 128 128 128zm96 40c0-2.5.8-4.8 1.1-7.2-2.5-.1-4.9-.8-7.5-.8h-16.7c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16h-16.7C60.2 288 0 348.2 0 422.4V464c0 26.5 21.5 48 48 48h352c6.8 0 13.3-1.5 19.2-4-54-42.9-99.2-116.7-99.2-212z"},child:[]}]})(e)}function Wt(e){return Je({tag:"svg",attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M630.6 364.9l-90.3-90.2c-12-12-28.3-18.7-45.3-18.7h-79.3c-17.7 0-32 14.3-32 32v79.2c0 17 6.7 33.2 18.7 45.2l90.3 90.2c12.5 12.5 32.8 12.5 45.3 0l92.5-92.5c12.6-12.5 12.6-32.7.1-45.2zm-182.8-21c-13.3 0-24-10.7-24-24s10.7-24 24-24 24 10.7 24 24c0 13.2-10.7 24-24 24zm-223.8-88c70.7 0 128-57.3 128-128C352 57.3 294.7 0 224 0S96 57.3 96 128c0 70.6 57.3 127.9 128 127.9zm127.8 111.2V294c-12.2-3.6-24.9-6.2-38.2-6.2h-16.7c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16h-16.7C60.2 287.9 0 348.1 0 422.3v41.6c0 26.5 21.5 48 48 48h352c15.5 0 29.1-7.5 37.9-18.9l-58-58c-18.1-18.1-28.1-42.2-28.1-67.9z"},child:[]}]})(e)}function Vt(e){return Je({tag:"svg",attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M224 256c70.7 0 128-57.3 128-128S294.7 0 224 0 96 57.3 96 128s57.3 128 128 128zm89.6 32h-16.7c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16h-16.7C60.2 288 0 348.2 0 422.4V464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48v-41.6c0-74.2-60.2-134.4-134.4-134.4z"},child:[]}]})(e)}function Ht(e){return Je({tag:"svg",attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M96 224c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm448 0c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm32 32h-64c-17.6 0-33.5 7.1-45.1 18.6 40.3 22.1 68.9 62 75.1 109.4h66c17.7 0 32-14.3 32-32v-32c0-35.3-28.7-64-64-64zm-256 0c61.9 0 112-50.1 112-112S381.9 32 320 32 208 82.1 208 144s50.1 112 112 112zm76.8 32h-8.3c-20.8 10-43.9 16-68.5 16s-47.6-6-68.5-16h-8.3C179.6 288 128 339.6 128 403.2V432c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48v-28.8c0-63.6-51.6-115.2-115.2-115.2zm-223.7-13.4C161.5 263.1 145.6 256 128 256H64c-35.3 0-64 28.7-64 64v32c0 17.7 14.3 32 32 32h65.9c6.3-47.4 34.9-87.3 75.2-109.4z"},child:[]}]})(e)}var Gt=n(4980);function qt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Kt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?qt(Object(n),!0).forEach(function(t){(0,Gt.A)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):qt(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function Xt(e,t){return function(){return e.apply(t,arguments)}}const{toString:Yt}=Object.prototype,{getPrototypeOf:$t}=Object,{iterator:Jt,toStringTag:Qt}=Symbol,Zt=(e=>t=>{const n=Yt.call(t);return e[n]||(e[n]=n.slice(8,-1).toLowerCase())})(Object.create(null)),en=e=>(e=e.toLowerCase(),t=>Zt(t)===e),tn=e=>t=>typeof t===e,{isArray:nn}=Array,rn=tn("undefined");function an(e){return null!==e&&!rn(e)&&null!==e.constructor&&!rn(e.constructor)&&cn(e.constructor.isBuffer)&&e.constructor.isBuffer(e)}const on=en("ArrayBuffer");const sn=tn("string"),cn=tn("function"),ln=tn("number"),un=e=>null!==e&&"object"===typeof e,hn=e=>{if("object"!==Zt(e))return!1;const t=$t(e);return(null===t||t===Object.prototype||null===Object.getPrototypeOf(t))&&!(Qt in e)&&!(Jt in e)},dn=en("Date"),fn=en("File"),pn=en("Blob"),mn=en("FileList"),gn=en("URLSearchParams"),[vn,bn,yn,xn]=["ReadableStream","Request","Response","Headers"].map(en);function wn(e,t){let n,r,{allOwnKeys:a=!1}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(null!==e&&"undefined"!==typeof e)if("object"!==typeof e&&(e=[e]),nn(e))for(n=0,r=e.length;n<r;n++)t.call(null,e[n],n,e);else{if(an(e))return;const r=a?Object.getOwnPropertyNames(e):Object.keys(e),i=r.length;let o;for(n=0;n<i;n++)o=r[n],t.call(null,e[o],o,e)}}function kn(e,t){if(an(e))return null;t=t.toLowerCase();const n=Object.keys(e);let r,a=n.length;for(;a-- >0;)if(r=n[a],t===r.toLowerCase())return r;return null}const Sn="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:"undefined"!==typeof window?window:global,Nn=e=>!rn(e)&&e!==Sn;const Cn=(En="undefined"!==typeof Uint8Array&&$t(Uint8Array),e=>En&&e instanceof En);var En;const In=en("HTMLFormElement"),Tn=(e=>{let{hasOwnProperty:t}=e;return(e,n)=>t.call(e,n)})(Object.prototype),_n=en("RegExp"),An=(e,t)=>{const n=Object.getOwnPropertyDescriptors(e),r={};wn(n,(n,a)=>{let i;!1!==(i=t(n,a,e))&&(r[a]=i||n)}),Object.defineProperties(e,r)};const Rn=en("AsyncFunction"),Fn=(Dn="function"===typeof setImmediate,On=cn(Sn.postMessage),Dn?setImmediate:On?((e,t)=>(Sn.addEventListener("message",n=>{let{source:r,data:a}=n;r===Sn&&a===e&&t.length&&t.shift()()},!1),n=>{t.push(n),Sn.postMessage(e,"*")}))("axios@".concat(Math.random()),[]):e=>setTimeout(e));var Dn,On;const Ln="undefined"!==typeof queueMicrotask?queueMicrotask.bind(Sn):"undefined"!==typeof process&&process.nextTick||Fn,Pn={isArray:nn,isArrayBuffer:on,isBuffer:an,isFormData:e=>{let t;return e&&("function"===typeof FormData&&e instanceof FormData||cn(e.append)&&("formdata"===(t=Zt(e))||"object"===t&&cn(e.toString)&&"[object FormData]"===e.toString()))},isArrayBufferView:function(e){let t;return t="undefined"!==typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&on(e.buffer),t},isString:sn,isNumber:ln,isBoolean:e=>!0===e||!1===e,isObject:un,isPlainObject:hn,isEmptyObject:e=>{if(!un(e)||an(e))return!1;try{return 0===Object.keys(e).length&&Object.getPrototypeOf(e)===Object.prototype}catch(_a){return!1}},isReadableStream:vn,isRequest:bn,isResponse:yn,isHeaders:xn,isUndefined:rn,isDate:dn,isFile:fn,isBlob:pn,isRegExp:_n,isFunction:cn,isStream:e=>un(e)&&cn(e.pipe),isURLSearchParams:gn,isTypedArray:Cn,isFileList:mn,forEach:wn,merge:function e(){const{caseless:t,skipUndefined:n}=Nn(this)&&this||{},r={},a=(a,i)=>{const o=t&&kn(r,i)||i;hn(r[o])&&hn(a)?r[o]=e(r[o],a):hn(a)?r[o]=e({},a):nn(a)?r[o]=a.slice():n&&rn(a)||(r[o]=a)};for(let i=0,o=arguments.length;i<o;i++)arguments[i]&&wn(arguments[i],a);return r},extend:function(e,t,n){let{allOwnKeys:r}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return wn(t,(t,r)=>{n&&cn(t)?e[r]=Xt(t,n):e[r]=t},{allOwnKeys:r}),e},trim:e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(65279===e.charCodeAt(0)&&(e=e.slice(1)),e),inherits:(e,t,n,r)=>{e.prototype=Object.create(t.prototype,r),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),n&&Object.assign(e.prototype,n)},toFlatObject:(e,t,n,r)=>{let a,i,o;const s={};if(t=t||{},null==e)return t;do{for(a=Object.getOwnPropertyNames(e),i=a.length;i-- >0;)o=a[i],r&&!r(o,e,t)||s[o]||(t[o]=e[o],s[o]=!0);e=!1!==n&&$t(e)}while(e&&(!n||n(e,t))&&e!==Object.prototype);return t},kindOf:Zt,kindOfTest:en,endsWith:(e,t,n)=>{e=String(e),(void 0===n||n>e.length)&&(n=e.length),n-=t.length;const r=e.indexOf(t,n);return-1!==r&&r===n},toArray:e=>{if(!e)return null;if(nn(e))return e;let t=e.length;if(!ln(t))return null;const n=new Array(t);for(;t-- >0;)n[t]=e[t];return n},forEachEntry:(e,t)=>{const n=(e&&e[Jt]).call(e);let r;for(;(r=n.next())&&!r.done;){const n=r.value;t.call(e,n[0],n[1])}},matchAll:(e,t)=>{let n;const r=[];for(;null!==(n=e.exec(t));)r.push(n);return r},isHTMLForm:In,hasOwnProperty:Tn,hasOwnProp:Tn,reduceDescriptors:An,freezeMethods:e=>{An(e,(t,n)=>{if(cn(e)&&-1!==["arguments","caller","callee"].indexOf(n))return!1;const r=e[n];cn(r)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")}))})},toObjectSet:(e,t)=>{const n={},r=e=>{e.forEach(e=>{n[e]=!0})};return nn(e)?r(e):r(String(e).split(t)),n},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(e,t,n){return t.toUpperCase()+n}),noop:()=>{},toFiniteNumber:(e,t)=>null!=e&&Number.isFinite(e=+e)?e:t,findKey:kn,global:Sn,isContextDefined:Nn,isSpecCompliantForm:function(e){return!!(e&&cn(e.append)&&"FormData"===e[Qt]&&e[Jt])},toJSONObject:e=>{const t=new Array(10),n=(e,r)=>{if(un(e)){if(t.indexOf(e)>=0)return;if(an(e))return e;if(!("toJSON"in e)){t[r]=e;const a=nn(e)?[]:{};return wn(e,(e,t)=>{const i=n(e,r+1);!rn(i)&&(a[t]=i)}),t[r]=void 0,a}}return e};return n(e,0)},isAsyncFn:Rn,isThenable:e=>e&&(un(e)||cn(e))&&cn(e.then)&&cn(e.catch),setImmediate:Fn,asap:Ln,isIterable:e=>null!=e&&cn(e[Jt])};function Mn(e,t,n,r,a){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack,this.message=e,this.name="AxiosError",t&&(this.code=t),n&&(this.config=n),r&&(this.request=r),a&&(this.response=a,this.status=a.status?a.status:null)}Pn.inherits(Mn,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Pn.toJSONObject(this.config),code:this.code,status:this.status}}});const jn=Mn.prototype,Bn={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{Bn[e]={value:e}}),Object.defineProperties(Mn,Bn),Object.defineProperty(jn,"isAxiosError",{value:!0}),Mn.from=(e,t,n,r,a,i)=>{const o=Object.create(jn);Pn.toFlatObject(e,o,function(e){return e!==Error.prototype},e=>"isAxiosError"!==e);const s=e&&e.message?e.message:"Error",c=null==t&&e?e.code:t;return Mn.call(o,s,c,n,r,a),e&&null==o.cause&&Object.defineProperty(o,"cause",{value:e,configurable:!0}),o.name=e&&e.name||"Error",i&&Object.assign(o,i),o};const zn=Mn;function Un(e){return Pn.isPlainObject(e)||Pn.isArray(e)}function Wn(e){return Pn.endsWith(e,"[]")?e.slice(0,-2):e}function Vn(e,t,n){return e?e.concat(t).map(function(e,t){return e=Wn(e),!n&&t?"["+e+"]":e}).join(n?".":""):t}const Hn=Pn.toFlatObject(Pn,{},null,function(e){return/^is[A-Z]/.test(e)});const Gn=function(e,t,n){if(!Pn.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;const r=(n=Pn.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(e,t){return!Pn.isUndefined(t[e])})).metaTokens,a=n.visitor||l,i=n.dots,o=n.indexes,s=(n.Blob||"undefined"!==typeof Blob&&Blob)&&Pn.isSpecCompliantForm(t);if(!Pn.isFunction(a))throw new TypeError("visitor must be a function");function c(e){if(null===e)return"";if(Pn.isDate(e))return e.toISOString();if(Pn.isBoolean(e))return e.toString();if(!s&&Pn.isBlob(e))throw new zn("Blob is not supported. Use a Buffer instead.");return Pn.isArrayBuffer(e)||Pn.isTypedArray(e)?s&&"function"===typeof Blob?new Blob([e]):Buffer.from(e):e}function l(e,n,a){let s=e;if(e&&!a&&"object"===typeof e)if(Pn.endsWith(n,"{}"))n=r?n:n.slice(0,-2),e=JSON.stringify(e);else if(Pn.isArray(e)&&function(e){return Pn.isArray(e)&&!e.some(Un)}(e)||(Pn.isFileList(e)||Pn.endsWith(n,"[]"))&&(s=Pn.toArray(e)))return n=Wn(n),s.forEach(function(e,r){!Pn.isUndefined(e)&&null!==e&&t.append(!0===o?Vn([n],r,i):null===o?n:n+"[]",c(e))}),!1;return!!Un(e)||(t.append(Vn(a,n,i),c(e)),!1)}const u=[],h=Object.assign(Hn,{defaultVisitor:l,convertValue:c,isVisitable:Un});if(!Pn.isObject(e))throw new TypeError("data must be an object");return function e(n,r){if(!Pn.isUndefined(n)){if(-1!==u.indexOf(n))throw Error("Circular reference detected in "+r.join("."));u.push(n),Pn.forEach(n,function(n,i){!0===(!(Pn.isUndefined(n)||null===n)&&a.call(t,n,Pn.isString(i)?i.trim():i,r,h))&&e(n,r?r.concat(i):[i])}),u.pop()}}(e),t};function qn(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(e){return t[e]})}function Kn(e,t){this._pairs=[],e&&Gn(e,this,t)}const Xn=Kn.prototype;Xn.append=function(e,t){this._pairs.push([e,t])},Xn.toString=function(e){const t=e?function(t){return e.call(this,t,qn)}:qn;return this._pairs.map(function(e){return t(e[0])+"="+t(e[1])},"").join("&")};const Yn=Kn;function $n(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function Jn(e,t,n){if(!t)return e;const r=n&&n.encode||$n;Pn.isFunction(n)&&(n={serialize:n});const a=n&&n.serialize;let i;if(i=a?a(t,n):Pn.isURLSearchParams(t)?t.toString():new Yn(t,n).toString(r),i){const t=e.indexOf("#");-1!==t&&(e=e.slice(0,t)),e+=(-1===e.indexOf("?")?"?":"&")+i}return e}const Qn=class{constructor(){this.handlers=[]}use(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){Pn.forEach(this.handlers,function(t){null!==t&&e(t)})}},Zn={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},er={isBrowser:!0,classes:{URLSearchParams:"undefined"!==typeof URLSearchParams?URLSearchParams:Yn,FormData:"undefined"!==typeof FormData?FormData:null,Blob:"undefined"!==typeof Blob?Blob:null},protocols:["http","https","file","blob","url","data"]},tr="undefined"!==typeof window&&"undefined"!==typeof document,nr="object"===typeof navigator&&navigator||void 0,rr=tr&&(!nr||["ReactNative","NativeScript","NS"].indexOf(nr.product)<0),ar="undefined"!==typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&"function"===typeof self.importScripts,ir=tr&&window.location.href||"http://localhost",or=Kt(Kt({},e),er);const sr=function(e){function t(e,n,r,a){let i=e[a++];if("__proto__"===i)return!0;const o=Number.isFinite(+i),s=a>=e.length;if(i=!i&&Pn.isArray(r)?r.length:i,s)return Pn.hasOwnProp(r,i)?r[i]=[r[i],n]:r[i]=n,!o;r[i]&&Pn.isObject(r[i])||(r[i]=[]);return t(e,n,r[i],a)&&Pn.isArray(r[i])&&(r[i]=function(e){const t={},n=Object.keys(e);let r;const a=n.length;let i;for(r=0;r<a;r++)i=n[r],t[i]=e[i];return t}(r[i])),!o}if(Pn.isFormData(e)&&Pn.isFunction(e.entries)){const n={};return Pn.forEachEntry(e,(e,r)=>{t(function(e){return Pn.matchAll(/\w+|\[(\w*)]/g,e).map(e=>"[]"===e[0]?"":e[1]||e[0])}(e),r,n,0)}),n}return null};const cr={transitional:Zn,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const n=t.getContentType()||"",r=n.indexOf("application/json")>-1,a=Pn.isObject(e);a&&Pn.isHTMLForm(e)&&(e=new FormData(e));if(Pn.isFormData(e))return r?JSON.stringify(sr(e)):e;if(Pn.isArrayBuffer(e)||Pn.isBuffer(e)||Pn.isStream(e)||Pn.isFile(e)||Pn.isBlob(e)||Pn.isReadableStream(e))return e;if(Pn.isArrayBufferView(e))return e.buffer;if(Pn.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let i;if(a){if(n.indexOf("application/x-www-form-urlencoded")>-1)return function(e,t){return Gn(e,new or.classes.URLSearchParams,Kt({visitor:function(e,t,n,r){return or.isNode&&Pn.isBuffer(e)?(this.append(t,e.toString("base64")),!1):r.defaultVisitor.apply(this,arguments)}},t))}(e,this.formSerializer).toString();if((i=Pn.isFileList(e))||n.indexOf("multipart/form-data")>-1){const t=this.env&&this.env.FormData;return Gn(i?{"files[]":e}:e,t&&new t,this.formSerializer)}}return a||r?(t.setContentType("application/json",!1),function(e,t,n){if(Pn.isString(e))try{return(t||JSON.parse)(e),Pn.trim(e)}catch(_a){if("SyntaxError"!==_a.name)throw _a}return(n||JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){const t=this.transitional||cr.transitional,n=t&&t.forcedJSONParsing,r="json"===this.responseType;if(Pn.isResponse(e)||Pn.isReadableStream(e))return e;if(e&&Pn.isString(e)&&(n&&!this.responseType||r)){const n=!(t&&t.silentJSONParsing)&&r;try{return JSON.parse(e,this.parseReviver)}catch(_a){if(n){if("SyntaxError"===_a.name)throw zn.from(_a,zn.ERR_BAD_RESPONSE,this,null,this.response);throw _a}}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:or.classes.FormData,Blob:or.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Pn.forEach(["delete","get","head","post","put","patch"],e=>{cr.headers[e]={}});const lr=cr,ur=Pn.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),hr=Symbol("internals");function dr(e){return e&&String(e).trim().toLowerCase()}function fr(e){return!1===e||null==e?e:Pn.isArray(e)?e.map(fr):String(e)}function pr(e,t,n,r,a){return Pn.isFunction(r)?r.call(this,t,n):(a&&(t=n),Pn.isString(t)?Pn.isString(r)?-1!==t.indexOf(r):Pn.isRegExp(r)?r.test(t):void 0:void 0)}class mr{constructor(e){e&&this.set(e)}set(e,t,n){const r=this;function a(e,t,n){const a=dr(t);if(!a)throw new Error("header name must be a non-empty string");const i=Pn.findKey(r,a);(!i||void 0===r[i]||!0===n||void 0===n&&!1!==r[i])&&(r[i||t]=fr(e))}const i=(e,t)=>Pn.forEach(e,(e,n)=>a(e,n,t));if(Pn.isPlainObject(e)||e instanceof this.constructor)i(e,t);else if(Pn.isString(e)&&(e=e.trim())&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim()))i((e=>{const t={};let n,r,a;return e&&e.split("\n").forEach(function(e){a=e.indexOf(":"),n=e.substring(0,a).trim().toLowerCase(),r=e.substring(a+1).trim(),!n||t[n]&&ur[n]||("set-cookie"===n?t[n]?t[n].push(r):t[n]=[r]:t[n]=t[n]?t[n]+", "+r:r)}),t})(e),t);else if(Pn.isObject(e)&&Pn.isIterable(e)){let n,r,a={};for(const t of e){if(!Pn.isArray(t))throw TypeError("Object iterator must return a key-value pair");a[r=t[0]]=(n=a[r])?Pn.isArray(n)?[...n,t[1]]:[n,t[1]]:t[1]}i(a,t)}else null!=e&&a(t,e,n);return this}get(e,t){if(e=dr(e)){const n=Pn.findKey(this,e);if(n){const e=this[n];if(!t)return e;if(!0===t)return function(e){const t=Object.create(null),n=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let r;for(;r=n.exec(e);)t[r[1]]=r[2];return t}(e);if(Pn.isFunction(t))return t.call(this,e,n);if(Pn.isRegExp(t))return t.exec(e);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=dr(e)){const n=Pn.findKey(this,e);return!(!n||void 0===this[n]||t&&!pr(0,this[n],n,t))}return!1}delete(e,t){const n=this;let r=!1;function a(e){if(e=dr(e)){const a=Pn.findKey(n,e);!a||t&&!pr(0,n[a],a,t)||(delete n[a],r=!0)}}return Pn.isArray(e)?e.forEach(a):a(e),r}clear(e){const t=Object.keys(this);let n=t.length,r=!1;for(;n--;){const a=t[n];e&&!pr(0,this[a],a,e,!0)||(delete this[a],r=!0)}return r}normalize(e){const t=this,n={};return Pn.forEach(this,(r,a)=>{const i=Pn.findKey(n,a);if(i)return t[i]=fr(r),void delete t[a];const o=e?function(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,n)=>t.toUpperCase()+n)}(a):String(a).trim();o!==a&&delete t[a],t[o]=fr(r),n[o]=!0}),this}concat(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.constructor.concat(this,...t)}toJSON(e){const t=Object.create(null);return Pn.forEach(this,(n,r)=>{null!=n&&!1!==n&&(t[r]=e&&Pn.isArray(n)?n.join(", "):n)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(e=>{let[t,n]=e;return t+": "+n}).join("\n")}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e){const t=new this(e);for(var n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];return r.forEach(e=>t.set(e)),t}static accessor(e){const t=(this[hr]=this[hr]={accessors:{}}).accessors,n=this.prototype;function r(e){const r=dr(e);t[r]||(!function(e,t){const n=Pn.toCamelCase(" "+t);["get","set","has"].forEach(r=>{Object.defineProperty(e,r+n,{value:function(e,n,a){return this[r].call(this,t,e,n,a)},configurable:!0})})}(n,e),t[r]=!0)}return Pn.isArray(e)?e.forEach(r):r(e),this}}mr.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),Pn.reduceDescriptors(mr.prototype,(e,t)=>{let{value:n}=e,r=t[0].toUpperCase()+t.slice(1);return{get:()=>n,set(e){this[r]=e}}}),Pn.freezeMethods(mr);const gr=mr;function vr(e,t){const n=this||lr,r=t||n,a=gr.from(r.headers);let i=r.data;return Pn.forEach(e,function(e){i=e.call(n,i,a.normalize(),t?t.status:void 0)}),a.normalize(),i}function br(e){return!(!e||!e.__CANCEL__)}function yr(e,t,n){zn.call(this,null==e?"canceled":e,zn.ERR_CANCELED,t,n),this.name="CanceledError"}Pn.inherits(yr,zn,{__CANCEL__:!0});const xr=yr;function wr(e,t,n){const r=n.config.validateStatus;n.status&&r&&!r(n.status)?t(new zn("Request failed with status code "+n.status,[zn.ERR_BAD_REQUEST,zn.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n)):e(n)}const kr=function(e,t){e=e||10;const n=new Array(e),r=new Array(e);let a,i=0,o=0;return t=void 0!==t?t:1e3,function(s){const c=Date.now(),l=r[o];a||(a=c),n[i]=s,r[i]=c;let u=o,h=0;for(;u!==i;)h+=n[u++],u%=e;if(i=(i+1)%e,i===o&&(o=(o+1)%e),c-a<t)return;const d=l&&c-l;return d?Math.round(1e3*h/d):void 0}};const Sr=function(e,t){let n,r,a=0,i=1e3/t;const o=function(t){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Date.now();a=i,n=null,r&&(clearTimeout(r),r=null),e(...t)};return[function(){const e=Date.now(),t=e-a;for(var s=arguments.length,c=new Array(s),l=0;l<s;l++)c[l]=arguments[l];t>=i?o(c,e):(n=c,r||(r=setTimeout(()=>{r=null,o(n)},i-t)))},()=>n&&o(n)]},Nr=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,r=0;const a=kr(50,250);return Sr(n=>{const i=n.loaded,o=n.lengthComputable?n.total:void 0,s=i-r,c=a(s);r=i;e({loaded:i,total:o,progress:o?i/o:void 0,bytes:s,rate:c||void 0,estimated:c&&o&&i<=o?(o-i)/c:void 0,event:n,lengthComputable:null!=o,[t?"download":"upload"]:!0})},n)},Cr=(e,t)=>{const n=null!=e;return[r=>t[0]({lengthComputable:n,total:e,loaded:r}),t[1]]},Er=e=>function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Pn.asap(()=>e(...n))},Ir=or.hasStandardBrowserEnv?((e,t)=>n=>(n=new URL(n,or.origin),e.protocol===n.protocol&&e.host===n.host&&(t||e.port===n.port)))(new URL(or.origin),or.navigator&&/(msie|trident)/i.test(or.navigator.userAgent)):()=>!0,Tr=or.hasStandardBrowserEnv?{write(e,t,n,r,a,i){const o=[e+"="+encodeURIComponent(t)];Pn.isNumber(n)&&o.push("expires="+new Date(n).toGMTString()),Pn.isString(r)&&o.push("path="+r),Pn.isString(a)&&o.push("domain="+a),!0===i&&o.push("secure"),document.cookie=o.join("; ")},read(e){const t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function _r(e,t,n){let r=!function(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}(t);return e&&(r||0==n)?function(e,t){return t?e.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):e}(e,t):t}const Ar=e=>e instanceof gr?Kt({},e):e;function Rr(e,t){t=t||{};const n={};function r(e,t,n,r){return Pn.isPlainObject(e)&&Pn.isPlainObject(t)?Pn.merge.call({caseless:r},e,t):Pn.isPlainObject(t)?Pn.merge({},t):Pn.isArray(t)?t.slice():t}function a(e,t,n,a){return Pn.isUndefined(t)?Pn.isUndefined(e)?void 0:r(void 0,e,0,a):r(e,t,0,a)}function i(e,t){if(!Pn.isUndefined(t))return r(void 0,t)}function o(e,t){return Pn.isUndefined(t)?Pn.isUndefined(e)?void 0:r(void 0,e):r(void 0,t)}function s(n,a,i){return i in t?r(n,a):i in e?r(void 0,n):void 0}const c={url:i,method:i,data:i,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,withXSRFToken:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:s,headers:(e,t,n)=>a(Ar(e),Ar(t),0,!0)};return Pn.forEach(Object.keys(Kt(Kt({},e),t)),function(r){const i=c[r]||a,o=i(e[r],t[r],r);Pn.isUndefined(o)&&i!==s||(n[r]=o)}),n}const Fr=e=>{const t=Rr({},e);let{data:n,withXSRFToken:r,xsrfHeaderName:a,xsrfCookieName:i,headers:o,auth:s}=t;if(t.headers=o=gr.from(o),t.url=Jn(_r(t.baseURL,t.url,t.allowAbsoluteUrls),e.params,e.paramsSerializer),s&&o.set("Authorization","Basic "+btoa((s.username||"")+":"+(s.password?unescape(encodeURIComponent(s.password)):""))),Pn.isFormData(n))if(or.hasStandardBrowserEnv||or.hasStandardBrowserWebWorkerEnv)o.setContentType(void 0);else if(Pn.isFunction(n.getHeaders)){const e=n.getHeaders(),t=["content-type","content-length"];Object.entries(e).forEach(e=>{let[n,r]=e;t.includes(n.toLowerCase())&&o.set(n,r)})}if(or.hasStandardBrowserEnv&&(r&&Pn.isFunction(r)&&(r=r(t)),r||!1!==r&&Ir(t.url))){const e=a&&i&&Tr.read(i);e&&o.set(a,e)}return t},Dr="undefined"!==typeof XMLHttpRequest&&function(e){return new Promise(function(t,n){const r=Fr(e);let a=r.data;const i=gr.from(r.headers).normalize();let o,s,c,l,u,{responseType:h,onUploadProgress:d,onDownloadProgress:f}=r;function p(){l&&l(),u&&u(),r.cancelToken&&r.cancelToken.unsubscribe(o),r.signal&&r.signal.removeEventListener("abort",o)}let m=new XMLHttpRequest;function g(){if(!m)return;const r=gr.from("getAllResponseHeaders"in m&&m.getAllResponseHeaders());wr(function(e){t(e),p()},function(e){n(e),p()},{data:h&&"text"!==h&&"json"!==h?m.response:m.responseText,status:m.status,statusText:m.statusText,headers:r,config:e,request:m}),m=null}m.open(r.method.toUpperCase(),r.url,!0),m.timeout=r.timeout,"onloadend"in m?m.onloadend=g:m.onreadystatechange=function(){m&&4===m.readyState&&(0!==m.status||m.responseURL&&0===m.responseURL.indexOf("file:"))&&setTimeout(g)},m.onabort=function(){m&&(n(new zn("Request aborted",zn.ECONNABORTED,e,m)),m=null)},m.onerror=function(t){const r=t&&t.message?t.message:"Network Error",a=new zn(r,zn.ERR_NETWORK,e,m);a.event=t||null,n(a),m=null},m.ontimeout=function(){let t=r.timeout?"timeout of "+r.timeout+"ms exceeded":"timeout exceeded";const a=r.transitional||Zn;r.timeoutErrorMessage&&(t=r.timeoutErrorMessage),n(new zn(t,a.clarifyTimeoutError?zn.ETIMEDOUT:zn.ECONNABORTED,e,m)),m=null},void 0===a&&i.setContentType(null),"setRequestHeader"in m&&Pn.forEach(i.toJSON(),function(e,t){m.setRequestHeader(t,e)}),Pn.isUndefined(r.withCredentials)||(m.withCredentials=!!r.withCredentials),h&&"json"!==h&&(m.responseType=r.responseType),f&&([c,u]=Nr(f,!0),m.addEventListener("progress",c)),d&&m.upload&&([s,l]=Nr(d),m.upload.addEventListener("progress",s),m.upload.addEventListener("loadend",l)),(r.cancelToken||r.signal)&&(o=t=>{m&&(n(!t||t.type?new xr(null,e,m):t),m.abort(),m=null)},r.cancelToken&&r.cancelToken.subscribe(o),r.signal&&(r.signal.aborted?o():r.signal.addEventListener("abort",o)));const v=function(e){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}(r.url);v&&-1===or.protocols.indexOf(v)?n(new zn("Unsupported protocol "+v+":",zn.ERR_BAD_REQUEST,e)):m.send(a||null)})},Or=(e,t)=>{const{length:n}=e=e?e.filter(Boolean):[];if(t||n){let n,r=new AbortController;const a=function(e){if(!n){n=!0,o();const t=e instanceof Error?e:this.reason;r.abort(t instanceof zn?t:new xr(t instanceof Error?t.message:t))}};let i=t&&setTimeout(()=>{i=null,a(new zn("timeout ".concat(t," of ms exceeded"),zn.ETIMEDOUT))},t);const o=()=>{e&&(i&&clearTimeout(i),i=null,e.forEach(e=>{e.unsubscribe?e.unsubscribe(a):e.removeEventListener("abort",a)}),e=null)};e.forEach(e=>e.addEventListener("abort",a));const{signal:s}=r;return s.unsubscribe=()=>Pn.asap(o),s}};function Lr(e,t){this.v=e,this.k=t}function Pr(e){return function(){return new Mr(e.apply(this,arguments))}}function Mr(e){var t,n;function r(t,n){try{var i=e[t](n),o=i.value,s=o instanceof Lr;Promise.resolve(s?o.v:o).then(function(n){if(s){var c="return"===t?"return":"next";if(!o.k||n.done)return r(c,n);n=e[c](n).value}a(i.done?"return":"normal",n)},function(e){r("throw",e)})}catch(e){a("throw",e)}}function a(e,a){switch(e){case"return":t.resolve({value:a,done:!0});break;case"throw":t.reject(a);break;default:t.resolve({value:a,done:!1})}(t=t.next)?r(t.key,t.arg):n=null}this._invoke=function(e,a){return new Promise(function(i,o){var s={key:e,arg:a,resolve:i,reject:o,next:null};n?n=n.next=s:(t=n=s,r(e,a))})},"function"!=typeof e.return&&(this.return=void 0)}function jr(e){return new Lr(e,0)}function Br(e){var t={},n=!1;function r(t,r){return n=!0,r=new Promise(function(n){n(e[t](r))}),{done:!1,value:new Lr(r,1)}}return t["undefined"!=typeof Symbol&&Symbol.iterator||"@@iterator"]=function(){return this},t.next=function(e){return n?(n=!1,e):r("next",e)},"function"==typeof e.throw&&(t.throw=function(e){if(n)throw n=!1,e;return r("throw",e)}),"function"==typeof e.return&&(t.return=function(e){return n?(n=!1,e):r("return",e)}),t}function zr(e){var t,n,r,a=2;for("undefined"!=typeof Symbol&&(n=Symbol.asyncIterator,r=Symbol.iterator);a--;){if(n&&null!=(t=e[n]))return t.call(e);if(r&&null!=(t=e[r]))return new Ur(t.call(e));n="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}function Ur(e){function t(e){if(Object(e)!==e)return Promise.reject(new TypeError(e+" is not an object."));var t=e.done;return Promise.resolve(e.value).then(function(e){return{value:e,done:t}})}return Ur=function(e){this.s=e,this.n=e.next},Ur.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var n=this.s.return;return void 0===n?Promise.resolve({value:e,done:!0}):t(n.apply(this.s,arguments))},throw:function(e){var n=this.s.return;return void 0===n?Promise.reject(e):t(n.apply(this.s,arguments))}},new Ur(e)}Mr.prototype["function"==typeof Symbol&&Symbol.asyncIterator||"@@asyncIterator"]=function(){return this},Mr.prototype.next=function(e){return this._invoke("next",e)},Mr.prototype.throw=function(e){return this._invoke("throw",e)},Mr.prototype.return=function(e){return this._invoke("return",e)};const Wr=function*(e,t){let n=e.byteLength;if(!t||n<t)return void(yield e);let r,a=0;for(;a<n;)r=a+t,yield e.slice(a,r),a=r},Vr=function(){var e=Pr(function*(e,t){var n,r=!1,a=!1;try{for(var i,o=zr(Hr(e));r=!(i=yield jr(o.next())).done;r=!1){const e=i.value;yield*Br(zr(Wr(e,t)))}}catch(s){a=!0,n=s}finally{try{r&&null!=o.return&&(yield jr(o.return()))}finally{if(a)throw n}}});return function(t,n){return e.apply(this,arguments)}}(),Hr=function(){var e=Pr(function*(e){if(e[Symbol.asyncIterator])return void(yield*Br(zr(e)));const t=e.getReader();try{for(;;){const{done:e,value:n}=yield jr(t.read());if(e)break;yield n}}finally{yield jr(t.cancel())}});return function(t){return e.apply(this,arguments)}}(),Gr=(e,t,n,r)=>{const a=Vr(e,t);let i,o=0,s=e=>{i||(i=!0,r&&r(e))};return new ReadableStream({async pull(e){try{const{done:t,value:r}=await a.next();if(t)return s(),void e.close();let i=r.byteLength;if(n){let e=o+=i;n(e)}e.enqueue(new Uint8Array(r))}catch(t){throw s(t),t}},cancel:e=>(s(e),a.return())},{highWaterMark:2})},{isFunction:qr}=Pn,Kr=(e=>{let{Request:t,Response:n}=e;return{Request:t,Response:n}})(Pn.global),{ReadableStream:Xr,TextEncoder:Yr}=Pn.global,$r=function(e){try{for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return!!e(...n)}catch(_a){return!1}},Jr=e=>{e=Pn.merge.call({skipUndefined:!0},Kr,e);const{fetch:t,Request:n,Response:r}=e,a=t?qr(t):"function"===typeof fetch,i=qr(n),o=qr(r);if(!a)return!1;const s=a&&qr(Xr),c=a&&("function"===typeof Yr?(l=new Yr,e=>l.encode(e)):async e=>new Uint8Array(await new n(e).arrayBuffer()));var l;const u=i&&s&&$r(()=>{let e=!1;const t=new n(or.origin,{body:new Xr,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!t}),h=o&&s&&$r(()=>Pn.isReadableStream(new r("").body)),d={stream:h&&(e=>e.body)};a&&["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!d[e]&&(d[e]=(t,n)=>{let r=t&&t[e];if(r)return r.call(t);throw new zn("Response type '".concat(e,"' is not supported"),zn.ERR_NOT_SUPPORT,n)})});const f=async(e,t)=>{const r=Pn.toFiniteNumber(e.getContentLength());return null==r?(async e=>{if(null==e)return 0;if(Pn.isBlob(e))return e.size;if(Pn.isSpecCompliantForm(e)){const t=new n(or.origin,{method:"POST",body:e});return(await t.arrayBuffer()).byteLength}return Pn.isArrayBufferView(e)||Pn.isArrayBuffer(e)?e.byteLength:(Pn.isURLSearchParams(e)&&(e+=""),Pn.isString(e)?(await c(e)).byteLength:void 0)})(t):r};return async e=>{let{url:a,method:o,data:s,signal:c,cancelToken:l,timeout:p,onDownloadProgress:m,onUploadProgress:g,responseType:v,headers:b,withCredentials:y="same-origin",fetchOptions:x}=Fr(e),w=t||fetch;v=v?(v+"").toLowerCase():"text";let k=Or([c,l&&l.toAbortSignal()],p),S=null;const N=k&&k.unsubscribe&&(()=>{k.unsubscribe()});let C;try{if(g&&u&&"get"!==o&&"head"!==o&&0!==(C=await f(b,s))){let e,t=new n(a,{method:"POST",body:s,duplex:"half"});if(Pn.isFormData(s)&&(e=t.headers.get("content-type"))&&b.setContentType(e),t.body){const[e,n]=Cr(C,Nr(Er(g)));s=Gr(t.body,65536,e,n)}}Pn.isString(y)||(y=y?"include":"omit");const t=i&&"credentials"in n.prototype,c=Kt(Kt({},x),{},{signal:k,method:o.toUpperCase(),headers:b.normalize().toJSON(),body:s,duplex:"half",credentials:t?y:void 0});S=i&&new n(a,c);let l=await(i?w(S,x):w(a,c));const p=h&&("stream"===v||"response"===v);if(h&&(m||p&&N)){const e={};["status","statusText","headers"].forEach(t=>{e[t]=l[t]});const t=Pn.toFiniteNumber(l.headers.get("content-length")),[n,a]=m&&Cr(t,Nr(Er(m),!0))||[];l=new r(Gr(l.body,65536,n,()=>{a&&a(),N&&N()}),e)}v=v||"text";let E=await d[Pn.findKey(d,v)||"text"](l,e);return!p&&N&&N(),await new Promise((t,n)=>{wr(t,n,{data:E,headers:gr.from(l.headers),status:l.status,statusText:l.statusText,config:e,request:S})})}catch(E){if(N&&N(),E&&"TypeError"===E.name&&/Load failed|fetch/i.test(E.message))throw Object.assign(new zn("Network Error",zn.ERR_NETWORK,e,S),{cause:E.cause||E});throw zn.from(E,E&&E.code,e,S)}}},Qr=new Map,Zr=e=>{let t=e?e.env:{};const{fetch:n,Request:r,Response:a}=t,i=[r,a,n];let o,s,c=i.length,l=Qr;for(;c--;)o=i[c],s=l.get(o),void 0===s&&l.set(o,s=c?new Map:Jr(t)),l=s;return s},ea=(Zr(),{http:null,xhr:Dr,fetch:{get:Zr}});Pn.forEach(ea,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch(_a){}Object.defineProperty(e,"adapterName",{value:t})}});const ta=e=>"- ".concat(e),na=e=>Pn.isFunction(e)||null===e||!1===e,ra=(e,t)=>{e=Pn.isArray(e)?e:[e];const{length:n}=e;let r,a;const i={};for(let o=0;o<n;o++){let n;if(r=e[o],a=r,!na(r)&&(a=ea[(n=String(r)).toLowerCase()],void 0===a))throw new zn("Unknown adapter '".concat(n,"'"));if(a&&(Pn.isFunction(a)||(a=a.get(t))))break;i[n||"#"+o]=a}if(!a){const e=Object.entries(i).map(e=>{let[t,n]=e;return"adapter ".concat(t," ")+(!1===n?"is not supported by the environment":"is not available in the build")});let t=n?e.length>1?"since :\n"+e.map(ta).join("\n"):" "+ta(e[0]):"as no adapter specified";throw new zn("There is no suitable adapter to dispatch the request "+t,"ERR_NOT_SUPPORT")}return a};function aa(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new xr(null,e)}function ia(e){aa(e),e.headers=gr.from(e.headers),e.data=vr.call(e,e.transformRequest),-1!==["post","put","patch"].indexOf(e.method)&&e.headers.setContentType("application/x-www-form-urlencoded",!1);return ra(e.adapter||lr.adapter,e)(e).then(function(t){return aa(e),t.data=vr.call(e,e.transformResponse,t),t.headers=gr.from(t.headers),t},function(t){return br(t)||(aa(e),t&&t.response&&(t.response.data=vr.call(e,e.transformResponse,t.response),t.response.headers=gr.from(t.response.headers))),Promise.reject(t)})}const oa="1.12.2",sa={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{sa[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}});const ca={};sa.transitional=function(e,t,n){function r(e,t){return"[Axios v"+oa+"] Transitional option '"+e+"'"+t+(n?". "+n:"")}return(n,a,i)=>{if(!1===e)throw new zn(r(a," has been removed"+(t?" in "+t:"")),zn.ERR_DEPRECATED);return t&&!ca[a]&&(ca[a]=!0,console.warn(r(a," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(n,a,i)}},sa.spelling=function(e){return(t,n)=>(console.warn("".concat(n," is likely a misspelling of ").concat(e)),!0)};const la={assertOptions:function(e,t,n){if("object"!==typeof e)throw new zn("options must be an object",zn.ERR_BAD_OPTION_VALUE);const r=Object.keys(e);let a=r.length;for(;a-- >0;){const i=r[a],o=t[i];if(o){const t=e[i],n=void 0===t||o(t,i,e);if(!0!==n)throw new zn("option "+i+" must be "+n,zn.ERR_BAD_OPTION_VALUE);continue}if(!0!==n)throw new zn("Unknown option "+i,zn.ERR_BAD_OPTION)}},validators:sa},ua=la.validators;class ha{constructor(e){this.defaults=e||{},this.interceptors={request:new Qn,response:new Qn}}async request(e,t){try{return await this._request(e,t)}catch(n){if(n instanceof Error){let e={};Error.captureStackTrace?Error.captureStackTrace(e):e=new Error;const t=e.stack?e.stack.replace(/^.+\n/,""):"";try{n.stack?t&&!String(n.stack).endsWith(t.replace(/^.+\n.+\n/,""))&&(n.stack+="\n"+t):n.stack=t}catch(_a){}}throw n}}_request(e,t){"string"===typeof e?(t=t||{}).url=e:t=e||{},t=Rr(this.defaults,t);const{transitional:n,paramsSerializer:r,headers:a}=t;void 0!==n&&la.assertOptions(n,{silentJSONParsing:ua.transitional(ua.boolean),forcedJSONParsing:ua.transitional(ua.boolean),clarifyTimeoutError:ua.transitional(ua.boolean)},!1),null!=r&&(Pn.isFunction(r)?t.paramsSerializer={serialize:r}:la.assertOptions(r,{encode:ua.function,serialize:ua.function},!0)),void 0!==t.allowAbsoluteUrls||(void 0!==this.defaults.allowAbsoluteUrls?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),la.assertOptions(t,{baseUrl:ua.spelling("baseURL"),withXsrfToken:ua.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let i=a&&Pn.merge(a.common,a[t.method]);a&&Pn.forEach(["delete","get","head","post","put","patch","common"],e=>{delete a[e]}),t.headers=gr.concat(i,a);const o=[];let s=!0;this.interceptors.request.forEach(function(e){"function"===typeof e.runWhen&&!1===e.runWhen(t)||(s=s&&e.synchronous,o.unshift(e.fulfilled,e.rejected))});const c=[];let l;this.interceptors.response.forEach(function(e){c.push(e.fulfilled,e.rejected)});let u,h=0;if(!s){const e=[ia.bind(this),void 0];for(e.unshift(...o),e.push(...c),u=e.length,l=Promise.resolve(t);h<u;)l=l.then(e[h++],e[h++]);return l}u=o.length;let d=t;for(;h<u;){const e=o[h++],t=o[h++];try{d=e(d)}catch(f){t.call(this,f);break}}try{l=ia.call(this,d)}catch(f){return Promise.reject(f)}for(h=0,u=c.length;h<u;)l=l.then(c[h++],c[h++]);return l}getUri(e){return Jn(_r((e=Rr(this.defaults,e)).baseURL,e.url,e.allowAbsoluteUrls),e.params,e.paramsSerializer)}}Pn.forEach(["delete","get","head","options"],function(e){ha.prototype[e]=function(t,n){return this.request(Rr(n||{},{method:e,url:t,data:(n||{}).data}))}}),Pn.forEach(["post","put","patch"],function(e){function t(t){return function(n,r,a){return this.request(Rr(a||{},{method:e,headers:t?{"Content-Type":"multipart/form-data"}:{},url:n,data:r}))}}ha.prototype[e]=t(),ha.prototype[e+"Form"]=t(!0)});const da=ha;class fa{constructor(e){if("function"!==typeof e)throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(e){t=e});const n=this;this.promise.then(e=>{if(!n._listeners)return;let t=n._listeners.length;for(;t-- >0;)n._listeners[t](e);n._listeners=null}),this.promise.then=e=>{let t;const r=new Promise(e=>{n.subscribe(e),t=e}).then(e);return r.cancel=function(){n.unsubscribe(t)},r},e(function(e,r,a){n.reason||(n.reason=new xr(e,r,a),t(n.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}toAbortSignal(){const e=new AbortController,t=t=>{e.abort(t)};return this.subscribe(t),e.signal.unsubscribe=()=>this.unsubscribe(t),e.signal}static source(){let e;const t=new fa(function(t){e=t});return{token:t,cancel:e}}}const pa=fa;const ma={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(ma).forEach(e=>{let[t,n]=e;ma[n]=t});const ga=ma;const va=function e(t){const n=new da(t),r=Xt(da.prototype.request,n);return Pn.extend(r,da.prototype,n,{allOwnKeys:!0}),Pn.extend(r,n,null,{allOwnKeys:!0}),r.create=function(n){return e(Rr(t,n))},r}(lr);va.Axios=da,va.CanceledError=xr,va.CancelToken=pa,va.isCancel=br,va.VERSION=oa,va.toFormData=Gn,va.AxiosError=zn,va.Cancel=va.CanceledError,va.all=function(e){return Promise.all(e)},va.spread=function(e){return function(t){return e.apply(null,t)}},va.isAxiosError=function(e){return Pn.isObject(e)&&!0===e.isAxiosError},va.mergeConfig=Rr,va.AxiosHeaders=gr,va.formToJSON=e=>sr(Pn.isHTMLForm(e)?new FormData(e):e),va.getAdapter=ra,va.HttpStatusCode=ga,va.default=va;const ba=va.create({baseURL:"http://localhost:5000/api"});ba.interceptors.request.use(e=>{const t=localStorage.getItem("token");return t&&(e.headers["x-auth-token"]=t),e},e=>Promise.reject(e)),ba.interceptors.response.use(e=>e,e=>{var t;return 401===(null===(t=e.response)||void 0===t?void 0:t.status)&&(localStorage.removeItem("token"),window.location.href="/"),Promise.reject(e)});const ya=ba;var xa=n(4414);const wa=e=>{let{fighter:t,onLogin:n,onClose:r,loading:a,error:i,setError:o}=e;const[s,l]=(0,c.useState)("");(0,c.useEffect)(()=>{var e;null===(e=document.getElementById("fighter-password-modal"))||void 0===e||e.focus(),o(null)},[o]);return(0,xa.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4",children:(0,xa.jsxs)("div",{className:"bg-gray-800 text-white rounded-xl shadow-2xl p-8 w-full max-w-sm relative animate-fade-in-up",children:[(0,xa.jsx)("button",{onClick:r,className:"absolute top-4 right-4 text-gray-400 hover:text-white transition-colors","aria-label":"Close",children:(0,xa.jsx)(Lt,{size:20})}),(0,xa.jsxs)("div",{className:"text-center mb-6",children:[(0,xa.jsx)("img",{src:"/logo.png",alt:"Profile",className:"w-24 h-24 mx-auto mb-4 rounded-full object-cover border-2 border-gray-600"}),(0,xa.jsx)("h2",{className:"text-xl font-semibold",children:"Password for"}),(0,xa.jsx)("p",{className:"text-2xl font-bold text-blue-400",children:t.name})]}),(0,xa.jsxs)("form",{onSubmit:e=>{e.preventDefault(),n(s)},children:[(0,xa.jsxs)("div",{className:"mb-4",children:[(0,xa.jsx)("label",{htmlFor:"fighter-password-modal",className:"sr-only",children:"Password"}),(0,xa.jsx)("input",{id:"fighter-password-modal",type:"password",value:s,onChange:e=>l(e.target.value),placeholder:"Enter your password",className:"w-full bg-gray-900 text-white px-4 py-3 border border-gray-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-center",required:!0})]}),i&&(0,xa.jsx)("p",{className:"text-red-500 text-sm text-center mb-4",children:i}),(0,xa.jsx)("button",{type:"submit",className:"w-full bg-blue-600 font-semibold py-3 rounded-lg hover:bg-blue-700 transition duration-300 disabled:bg-gray-600",disabled:a,children:a?"Signing in...":"Sign in"})]})]})})},ka=e=>{let{setUser:t}=e;const[n,r]=(0,c.useState)(null),[a,i]=(0,c.useState)({email:"",password:""}),[o,s]=(0,c.useState)({password:""}),[l,u]=(0,c.useState)([]),[h,d]=(0,c.useState)(null),[f,p]=(0,c.useState)(null),[m,g]=(0,c.useState)(!1),v=ie(),[b,y]=(0,c.useState)(!1);(0,c.useEffect)(()=>{if("fighter"===n){(async()=>{g(!0);try{const e=await ya.get("/fighters/list");u(e.data)}catch(e){p("Failed to fetch fighter list.")}finally{g(!1)}})()}},[n]);return(0,xa.jsxs)("div",{className:"min-h-screen w-full flex flex-col items-center justify-center bg-white text-gray-900 p-4",children:[(0,xa.jsxs)("div",{className:"w-full max-w-sm md:max-w-2xl lg:max-w-4xl",children:[(0,xa.jsxs)("div",{className:"flex flex-col items-center text-center mb-6",children:[(0,xa.jsx)("img",{src:"/logo.png",alt:"Logo",className:"w-24 h-24 mb-4 rounded-full object-cover border-2 border-gray-700"}),(0,xa.jsx)("h1",{className:"text-2xl font-bold tracking-wider",children:"Welcome to Ashura's Tribe"}),(0,xa.jsx)("p",{className:"text-gray-400 mt-2",children:"Please select your role to sign in"})]}),f&&(0,xa.jsx)("div",{className:"bg-red-500/20 border border-red-500/30 text-red-300 p-3 mb-4 rounded-lg text-center text-sm",role:"alert",children:(0,xa.jsx)("p",{children:f})}),!n&&(0,xa.jsxs)("div",{className:"space-y-4 flex flex-col items-center",children:[(0,xa.jsx)("button",{onClick:()=>r("admin"),className:"w-64 bg-red-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-red-700 transition duration-300",children:"Admin Login"}),(0,xa.jsx)("button",{onClick:()=>r("fighter"),className:"w-64 bg-gray-900 text-white font-bold py-3 px-8 rounded-lg hover:bg-gray-300 transition duration-300",children:"Fighter Login"})]}),"admin"===n&&(0,xa.jsx)("div",{className:"flex justify-center",children:(0,xa.jsxs)("form",{onSubmit:async e=>{e.preventDefault(),p(null),g(!0);try{const e=await ya.post("/auth/login",Kt(Kt({},a),{},{role:"admin"}));localStorage.setItem("token",e.data.token),t(e.data.user),v("/admin")}catch(n){p("Invalid admin credentials.")}finally{g(!1)}},className:"space-y-4 w-80",children:[(0,xa.jsxs)("div",{children:[(0,xa.jsx)("label",{className:"block text-sm font-medium text-gray-400 mb-2",htmlFor:"admin-email",children:"Email"}),(0,xa.jsx)("input",{id:"admin-email",type:"email",value:a.email,onChange:e=>i(Kt(Kt({},a),{},{email:e.target.value})),placeholder:"email@example.com",className:"w-full bg-gray-800 text-white px-4 py-3 border border-gray-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500",required:!0})]}),(0,xa.jsxs)("div",{children:[(0,xa.jsx)("label",{className:"block text-sm font-medium text-gray-400 mb-2",htmlFor:"admin-password",children:"Password"}),(0,xa.jsx)("input",{id:"admin-password",type:"password",value:a.password,onChange:e=>i(Kt(Kt({},a),{},{password:e.target.value})),placeholder:"\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022",className:"w-full bg-gray-800 text-white px-4 py-3 border border-gray-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500",required:!0})]}),(0,xa.jsx)("button",{type:"submit",className:"w-full bg-red-600 font-semibold py-3 rounded-lg hover:bg-red-700 transition duration-300 disabled:bg-gray-600 text-white",disabled:m,children:m?"Signing in...":"Sign in as Admin"})]})}),"fighter"===n&&(0,xa.jsxs)("div",{className:"w-full",children:[(0,xa.jsx)("h3",{className:"text-xl font-semibold text-center text-gray-300 mb-4",children:"Select Your Profile"}),m?(0,xa.jsx)("p",{className:"text-center text-gray-400",children:"Loading fighters..."}):(0,xa.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:l.map(e=>(0,xa.jsxs)("div",{onClick:()=>(e=>{d(e),s({password:""}),p(null),y(!0)})(e),className:"bg-gray-800 rounded-lg p-3 text-center cursor-pointer border-2 border-transparent hover:border-blue-500 hover:bg-gray-700 transition-all duration-200 transform hover:scale-105",children:[(0,xa.jsx)("img",{src:"/logo.png",alt:e.name,className:"w-16 h-16 mx-auto mb-2 rounded-full object-cover border-2 border-gray-600"}),(0,xa.jsx)("h4",{className:"font-semibold text-white truncate",children:e.name}),(0,xa.jsx)("p",{className:"text-xs text-gray-400",children:e.rfid})]},e._id))})]}),n&&(0,xa.jsx)("div",{className:"text-center mt-6",children:(0,xa.jsx)("button",{onClick:()=>{r(null),p(null),d(null)},className:"text-gray-400 hover:text-white text-sm hover:underline",children:"Back to role selection"})})]}),b&&h&&(0,xa.jsx)(wa,{fighter:h,onLogin:async e=>{if(h){p(null),g(!0);try{const{data:n}=await ya.post("/auth/login",{email:h.email,password:e});localStorage.setItem("token",n.token),t(n.user),y(!1),v(n.user.profile_completed?"/fighter":"/fighter/complete-profile")}catch(a){var n,r;p((null===(n=a.response)||void 0===n||null===(r=n.data)||void 0===r?void 0:r.msg)||"Invalid password.")}finally{g(!1)}}},onClose:()=>y(!1),loading:m,error:f,setError:p})]})},Sa=()=>{const[e,t]=(0,c.useState)([]),[n,r]=(0,c.useState)(!0),[a,i]=(0,c.useState)(""),[o,s]=(0,c.useState)("");(0,c.useEffect)(()=>{(async()=>{try{const e=await ya.get("/fighters/roster");t(e.data)}catch(e){i("Failed to fetch fighters."),console.error(e)}finally{r(!1)}})()},[]);const l=e.filter(e=>e.name.toLowerCase().includes(o.toLowerCase())||e.email.toLowerCase().includes(o.toLowerCase())||e.fighterBatchNo.toLowerCase().includes(o.toLowerCase()));return n?(0,xa.jsx)("p",{children:"Loading fighters..."}):a?(0,xa.jsx)("p",{className:"text-red-500",children:a}):(0,xa.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-md",children:[(0,xa.jsx)("h2",{className:"text-2xl font-bold mb-4",children:"Fighter Roster"}),(0,xa.jsx)("input",{type:"text",placeholder:"Search fighters...",className:"mb-4 p-2 border rounded w-full",onChange:e=>s(e.target.value)}),(0,xa.jsx)("div",{className:"overflow-x-auto",children:(0,xa.jsxs)("table",{className:"min-w-full bg-white",children:[(0,xa.jsx)("thead",{children:(0,xa.jsxs)("tr",{children:[(0,xa.jsx)("th",{className:"py-2 px-4 border-b",children:"Fighter Name"}),(0,xa.jsx)("th",{className:"py-2 px-4 border-b",children:"Batch Number"}),(0,xa.jsx)("th",{className:"py-2 px-4 border-b",children:"RFID"}),(0,xa.jsx)("th",{className:"py-2 px-4 border-b",children:"Email"}),(0,xa.jsx)("th",{className:"py-2 px-4 border-b",children:"Actions"})]})}),(0,xa.jsx)("tbody",{children:l.map(n=>(0,xa.jsxs)("tr",{children:[(0,xa.jsx)("td",{className:"py-2 px-4 border-b text-center",children:n.name}),(0,xa.jsx)("td",{className:"py-2 px-4 border-b text-center",children:n.fighterBatchNo}),(0,xa.jsx)("td",{className:"py-2 px-4 border-b text-center",children:n.rfid}),(0,xa.jsx)("td",{className:"py-2 px-4 border-b text-center",children:n.email}),(0,xa.jsx)("td",{className:"py-2 px-4 border-b text-center",children:(0,xa.jsxs)("div",{className:"flex justify-center items-center space-x-2",children:[(0,xa.jsx)(Me,{to:"/admin/fighter/".concat(n._id),className:"text-blue-500 hover:text-blue-700",children:(0,xa.jsx)(bt,{})}),(0,xa.jsx)(Me,{to:"/admin/edit-fighter/".concat(n._id),className:"text-green-500 hover:text-green-700",children:(0,xa.jsx)(ft,{})}),(0,xa.jsx)("button",{onClick:()=>(async n=>{if(window.confirm("Are you sure you want to delete this fighter?"))try{await ya.delete("/fighters/".concat(n)),t(e.filter(e=>e._id!==n))}catch(r){i("Failed to delete fighter."),console.error(r)}})(n._id),className:"text-red-500 hover:text-red-700",children:(0,xa.jsx)(Pt,{})})]})})]},n._id))})]})})]})},Na=()=>{const[e,t]=(0,c.useState)([]),[n,r]=(0,c.useState)(!0);(0,c.useEffect)(()=>{(async()=>{try{const e=await ya.get("/fighters/roster");t(e.data)}catch(e){console.error("Error fetching fighters:",e)}finally{r(!1)}})()},[]);return n?(0,xa.jsx)("div",{className:"flex justify-center items-center h-full",children:(0,xa.jsxs)("div",{className:"text-center text-gray-500",children:[(0,xa.jsx)("div",{className:"loader ease-linear rounded-full border-8 border-t-8 border-gray-200 h-32 w-32 mb-4"}),(0,xa.jsx)("h2",{className:"text-xl font-semibold",children:"Loading Fighters..."}),(0,xa.jsx)("p",{children:"Please wait a moment."})]})}):(0,xa.jsxs)("div",{className:"bg-white p-6 md:p-8 rounded-xl shadow-lg",children:[(0,xa.jsxs)("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4",children:[(0,xa.jsxs)("div",{children:[(0,xa.jsx)("h2",{className:"text-3xl font-bold text-gray-800",children:"Fighters Dashboard"}),(0,xa.jsx)("p",{className:"text-gray-500 mt-1",children:"Manage and view all registered fighters."})]}),(0,xa.jsx)("div",{className:"flex flex-col sm:flex-row gap-2 w-full sm:w-auto",children:(0,xa.jsx)(Me,{to:"/admin/add-fighter",className:"bg-red-600 text-white px-5 py-2.5 rounded-lg font-semibold hover:bg-red-700 transition duration-300 text-center shadow-md hover:shadow-lg",children:"+ Add Fighter"})})]}),(0,xa.jsx)(Sa,{fighters:e,handleDelete:async n=>{if(window.confirm("Are you sure you want to delete this fighter?"))try{await ya.delete("/fighters/".concat(n)),t(e.filter(e=>e._id!==n)),alert("Fighter deleted successfully!")}catch(r){console.error("Error deleting fighter:",r),alert("Error deleting fighter.")}}})]})},Ca=()=>{const[e,t]=(0,c.useState)(null),[n,r]=(0,c.useState)(!0);if((0,c.useEffect)(()=>{(async()=>{try{const e=await ya.get("/fighters/dashboard-stats");t(e.data)}catch(e){console.error("Error fetching dashboard stats:",e)}finally{r(!1)}})()},[]),n)return(0,xa.jsx)("div",{className:"p-8 text-center text-gray-500",children:"Loading dashboard..."});const a=e=>{let{title:t,value:n,subtitle:r,icon:a,color:i="blue"}=e;return(0,xa.jsx)("div",{className:"bg-white rounded-lg shadow-md p-6 border-l-4 border-".concat(i,"-500"),children:(0,xa.jsxs)("div",{className:"flex items-center justify-between",children:[(0,xa.jsxs)("div",{children:[(0,xa.jsx)("p",{className:"text-gray-600 text-sm font-medium",children:t}),(0,xa.jsx)("p",{className:"text-2xl font-bold text-".concat(i,"-600"),children:n}),r&&(0,xa.jsx)("p",{className:"text-gray-500 text-xs mt-1",children:r})]}),(0,xa.jsx)("div",{className:"text-".concat(i,"-500 text-3xl"),children:a})]})})};return(0,xa.jsxs)("div",{className:"p-4 md:p-8",children:[(0,xa.jsxs)("div",{className:"mb-8",children:[(0,xa.jsx)("h1",{className:"text-3xl font-bold text-gray-800 mb-2",children:"Dashboard Overview"}),(0,xa.jsx)("p",{className:"text-gray-600",children:"Complete analytics and insights for your gym"})]}),e&&(0,xa.jsxs)("div",{className:"space-y-8",children:[(0,xa.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[(0,xa.jsx)(a,{title:"Total Fighters",value:e.totalFighters,icon:"\ud83d\udc65",color:"blue"}),(0,xa.jsx)(a,{title:"Profile Completed",value:e.profileCompleted,subtitle:"".concat(e.profilePending," pending"),icon:"\u2705",color:"green"}),(0,xa.jsx)(a,{title:"Recent Joinings",value:e.recentJoinings,subtitle:"Last 30 days",icon:"\ud83d\udcc8",color:"purple"}),(0,xa.jsx)(a,{title:"Assessed Fighters",value:e.topFighters.length,subtitle:"With grade scores",icon:"\ud83c\udfc6",color:"yellow"})]}),(0,xa.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[(0,xa.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6",children:[(0,xa.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"\ud83c\udfc6 Top Performing Fighters"}),e.topFighters.length>0?(0,xa.jsx)("div",{className:"space-y-3",children:e.topFighters.map((e,t)=>{var n;return(0,xa.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-md",children:[(0,xa.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,xa.jsx)("span",{className:"w-8 h-8 rounded-full flex items-center justify-center text-white font-bold ".concat(0===t?"bg-yellow-500":1===t?"bg-gray-400":2===t?"bg-yellow-600":"bg-blue-500"),children:t+1}),(0,xa.jsxs)("div",{children:[(0,xa.jsx)("p",{className:"font-medium text-gray-800",children:e.name}),(0,xa.jsxs)("p",{className:"text-sm text-gray-500",children:["Batch: ",e.fighterBatchNo]})]})]}),(0,xa.jsxs)("div",{className:"text-right",children:[(0,xa.jsx)("p",{className:"font-bold text-lg text-green-600",children:null===(n=e.assessment)||void 0===n?void 0:n.specialGradeScore}),(0,xa.jsx)("p",{className:"text-xs text-gray-500",children:"Grade Score"})]})]},e._id)})}):(0,xa.jsx)("p",{className:"text-gray-500 text-center py-4",children:"No fighters assessed yet"})]}),(0,xa.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6",children:[(0,xa.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"\ud83d\udcca Demographics"}),(0,xa.jsxs)("div",{className:"mb-6",children:[(0,xa.jsx)("h4",{className:"font-medium text-gray-700 mb-2",children:"Gender Distribution"}),(0,xa.jsxs)("div",{className:"space-y-2",children:[(0,xa.jsxs)("div",{className:"flex items-center justify-between",children:[(0,xa.jsx)("span",{className:"text-sm text-gray-600",children:"Male"}),(0,xa.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,xa.jsx)("div",{className:"w-24 bg-gray-200 rounded-full h-2",children:(0,xa.jsx)("div",{className:"bg-blue-500 h-2 rounded-full",style:{width:"".concat(e.totalFighters>0?e.genderDistribution.male/e.totalFighters*100:0,"%")}})}),(0,xa.jsx)("span",{className:"text-sm font-medium",children:e.genderDistribution.male})]})]}),(0,xa.jsxs)("div",{className:"flex items-center justify-between",children:[(0,xa.jsx)("span",{className:"text-sm text-gray-600",children:"Female"}),(0,xa.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,xa.jsx)("div",{className:"w-24 bg-gray-200 rounded-full h-2",children:(0,xa.jsx)("div",{className:"bg-pink-500 h-2 rounded-full",style:{width:"".concat(e.totalFighters>0?e.genderDistribution.female/e.totalFighters*100:0,"%")}})}),(0,xa.jsx)("span",{className:"text-sm font-medium",children:e.genderDistribution.female})]})]})]})]}),(0,xa.jsxs)("div",{children:[(0,xa.jsx)("h4",{className:"font-medium text-gray-700 mb-2",children:"Age Groups"}),(0,xa.jsx)("div",{className:"space-y-2",children:e.ageGroups.map(e=>(0,xa.jsxs)("div",{className:"flex items-center justify-between",children:[(0,xa.jsx)("span",{className:"text-sm text-gray-600",children:e._id}),(0,xa.jsx)("span",{className:"text-sm font-medium bg-gray-100 px-2 py-1 rounded",children:e.count})]},e._id))})]})]})]}),(0,xa.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6",children:[(0,xa.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"\ud83d\udca1 Key Insights"}),(0,xa.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,xa.jsxs)("div",{className:"bg-blue-50 p-4 rounded-lg",children:[(0,xa.jsx)("h4",{className:"font-medium text-blue-800 mb-2",children:"Growth Rate"}),(0,xa.jsxs)("p",{className:"text-sm text-blue-600",children:[e.recentJoinings," new fighters joined in the last 30 days"]})]}),(0,xa.jsxs)("div",{className:"bg-green-50 p-4 rounded-lg",children:[(0,xa.jsx)("h4",{className:"font-medium text-green-800 mb-2",children:"Completion Rate"}),(0,xa.jsxs)("p",{className:"text-sm text-green-600",children:[e.totalFighters>0?"".concat(Math.round(e.profileCompleted/e.totalFighters*100),"%"):"0%"," of fighters have completed profiles"]})]}),(0,xa.jsxs)("div",{className:"bg-purple-50 p-4 rounded-lg",children:[(0,xa.jsx)("h4",{className:"font-medium text-purple-800 mb-2",children:"Assessment Rate"}),(0,xa.jsxs)("p",{className:"text-sm text-purple-600",children:[e.totalFighters>0?"".concat(Math.round(e.topFighters.length/e.totalFighters*100),"%"):"0%"," of fighters have been assessed"]})]})]})]})]})]})};var Ea=n(1766),Ia=n.n(Ea),Ta=function(e,t){return(Ta=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function _a(e,t){function n(){this.constructor=e}Ta(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function Aa(e,t,n,r){return new(n||(n=Promise))(function(a,i){function o(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){e.done?a(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})}function Ra(e,t){var n,r,a,i,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(a=(a=o.trys).length>0&&a[a.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],r=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}var Fa=function(){function e(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}return e.prototype.setPlatform=function(e,t){null!=this.platform&&console.warn("Platform "+this.platformName+" has already been set. Overwriting the platform with "+t+"."),this.platformName=e,this.platform=t},e.prototype.registerFlag=function(e,t,n){if(this.flagRegistry[e]={evaluationFn:t,setHook:n},null!=this.urlFlags[e]){var r=this.urlFlags[e];console.warn("Setting feature override from URL "+e+": "+r+"."),this.set(e,r)}},e.prototype.get=function(e){return e in this.flags||(this.flags[e]=this.evaluateFlag(e)),this.flags[e]},e.prototype.getNumber=function(e){return this.get(e)},e.prototype.getBool=function(e){return this.get(e)},e.prototype.getFlags=function(){return this.flags},Object.defineProperty(e.prototype,"features",{get:function(){return this.flags},enumerable:!0,configurable:!0}),e.prototype.set=function(e,t){if(null==this.flagRegistry[e])throw new Error("Cannot set flag "+e+" as it has not been registered.");this.flags[e]=t,null!=this.flagRegistry[e].setHook&&this.flagRegistry[e].setHook(t)},e.prototype.evaluateFlag=function(e){if(null==this.flagRegistry[e])throw new Error("Cannot evaluate flag '"+e+"': no evaluation function found.");return this.flagRegistry[e].evaluationFn()},e.prototype.setFlags=function(e){this.flags=Object.assign({},e)},e.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},e.prototype.populateURLFlags=function(){var e=this;if(void 0!==this.global&&void 0!==this.global.location&&void 0!==this.global.location.search){var t,n,r=(t=this.global.location.search,n={},t.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];return function(e,t,n){e[decodeURIComponent(t)]=decodeURIComponent(n||"")}(n,t[0],t[1]),t.join("=")}),n);"tfjsflags"in r&&r.tfjsflags.split(",").forEach(function(t){var n=t.split(":"),r=n[0],a=n[1];e.urlFlags[r]=function(e,t){if("true"===(t=t.toLowerCase())||"false"===t)return"true"===t;if(""+ +t===t)return+t;throw new Error("Could not parse value flag value "+t+" for flag "+e+".")}(r,a)})}},e}();function Da(){return Oa}var Oa=null,La=new Map,Pa=new Map;function Ma(e,t){var n=Ua(e,t);return La.get(n)}function ja(e){for(var t=La.entries(),n=[];;){var r=t.next(),a=r.done,i=r.value;if(a)break;var o=i[0],s=i[1];o.split("_")[0]===e&&n.push(s)}return n}function Ba(e){var t=e.kernelName,n=e.backendName,r=Ua(t,n);if(La.has(r))throw new Error("The kernel '"+t+"' for backend '"+n+"' is already registered");La.set(r,e)}function za(e){var t=e.kernelName;Pa.has(t)&&console.warn("Overriding the gradient for '"+t+"'"),Pa.set(t,e)}function Ua(e,t){return t+"_"+e}function Wa(e){for(var t=e.length,n=0,r=0;t>0;)r=Math.random()*t|0,n=e[--t],e[t]=e[r],e[r]=n}function Va(e,t,n){return Math.max(e,Math.min(t,n))}function Ha(e){return e%2==0?e:e+1}function Ga(e){for(var t=0,n=0;n<e.length;n++)t+=e[n];return t}function qa(e,t){if(!e)throw new Error("string"==typeof t?t:t())}function Ka(e,t,n){void 0===n&&(n=""),qa(Ja(e,t),function(){return n+" Shapes "+e+" and "+t+" must match"})}function Xa(e){qa(null!=e,function(){return"The input to the tensor constructor must be a non-null value."})}function Ya(e,t,n){if(void 0===t&&(t=[]),void 0===n&&(n=!1),null==t&&(t=[]),Array.isArray(e)||hi(e)&&!n)for(var r=0;r<e.length;++r)Ya(e[r],t,n);else t.push(e);return t}function $a(e){if(0===e.length)return 1;for(var t=e[0],n=1;n<e.length;n++)t*=e[n];return t}function Ja(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function Qa(e){return e%1==0}function Za(e){if(null!=Math.tanh)return Math.tanh(e);if(e===1/0)return 1;if(e===-1/0)return-1;var t=Math.exp(2*e);return(t-1)/(t+1)}function ei(e){var t=Math.ceil(Math.sqrt(e));return[t,Math.ceil(e/t)]}function ti(e,t){return t<=e.length?e:e+" ".repeat(t-e.length)}function ni(e,t,n){return void 0===t&&(t=function(e){return 0}),new Promise(function(r,a){var i=0,o=function(){if(e())r();else{i++;var s=t(i);null!=n&&i>=n?a():setTimeout(o,s)}};o()})}function ri(e,t){for(var n=1,r=-1,a=0;a<e.length;++a)if(e[a]>=0)n*=e[a];else if(-1===e[a]){if(-1!==r)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+r+" and dim "+a);r=a}else if(e[a]<0)throw Error("Shapes can not be < 0. Found "+e[a]+" at dim "+a);if(-1===r){if(t>0&&t!==n)throw Error("Size("+t+") must match the product of shape "+e);return e}if(0===n)throw Error("Cannot infer the missing size in ["+e+"] when there are 0 elements");if(t%n!=0)throw Error("The implicit shape can't be a fractional number. Got "+t+" / "+n);var i=e.slice();return i[r]=t/n,i}function ai(e,t){var n=t.length;return qa((e=null==e?t.map(function(e,t){return t}):[].concat(e)).every(function(e){return e>=-n&&e<n}),function(){return"All values in axis param must be in range [-"+n+", "+n+") but got axis "+e}),qa(e.every(function(e){return Qa(e)}),function(){return"All values in axis param must be integers but got axis "+e}),e.map(function(e){return e<0?n+e:e})}function ii(e,t){for(var n=[],r=[],a=null!=t&&Array.isArray(t)&&0===t.length,i=null==t||a?null:ai(t,e).sort(),o=0,s=0;s<e.length;++s){if(null!=i){if(i[o]===s&&1!==e[s])throw new Error("Can't squeeze axis "+s+" since its dim '"+e[s]+"' is not 1");(null==i[o]||i[o]>s)&&1===e[s]&&(n.push(e[s]),r.push(s)),i[o]<=s&&o++}1!==e[s]&&(n.push(e[s]),r.push(s))}return{newShape:n,keptDims:r}}function oi(e,t){var n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else{if("bool"!==e)throw new Error("Unknown data type "+e);n=new Uint8Array(t)}return n}function si(e,t){var n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else if("bool"===e)n=new Uint8Array(t);else{if("string"!==e)throw new Error("Unknown data type "+e);n=new Array(t)}return n}function ci(e,t){for(var n=0;n<e.length;n++){var r=e[n];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type "+t+" being uploaded contains "+r+".")}}function li(e){return"bool"===e||"complex64"===e||"float32"===e||"int32"===e||"string"===e}function ui(e,t){return"complex64"!==t&&("float32"!==t||"complex64"===e)&&("int32"!==t||"float32"===e||"complex64"===e)&&("bool"!==t||"bool"!==e)}function hi(e){return e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array}function di(e){if("float32"===e||"int32"===e)return 4;if("complex64"===e)return 8;if("bool"===e)return 1;throw new Error("Unknown dtype "+e)}function fi(e){if(null==e)return 0;var t=0;return e.forEach(function(e){return t+=e.length}),t}function pi(e){return"string"==typeof e||e instanceof String}function mi(e){return"boolean"==typeof e}function gi(e){return"number"==typeof e}function vi(e){return Array.isArray(e)?vi(e[0]):e instanceof Float32Array?"float32":e instanceof Int32Array||e instanceof Uint8Array?"int32":gi(e)?"float32":pi(e)?"string":mi(e)?"bool":"float32"}function bi(e){return!!(e&&e.constructor&&e.call&&e.apply)}function yi(e,t){for(var n=t;n<e;++n)if(e%n==0)return n;return e}function xi(e){var t=e.length;if(t<2)return[];var n=new Array(t-1);n[t-2]=e[t-1];for(var r=t-3;r>=0;--r)n[r]=n[r+1]*e[r+1];return n}function wi(e,t,n){if("string"===t)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(e)&&(e=Ya(e)),n&&ci(e,t),function(e,t){return e instanceof Float32Array&&"float32"===t||e instanceof Int32Array&&"int32"===t||e instanceof Uint8Array&&"bool"===t}(e,t))return e;if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t){for(var r=new Uint8Array(e.length),a=0;a<r.length;++a)0!==Math.round(e[a])&&(r[a]=1);return r}throw new Error("Unknown data type "+t)}function ki(e,t){if(0===e.length)return t[0];var n=e.reduce(function(e,t){return e*t});if(0===n)return[];if(n!==t.length)throw new Error("["+e+"] does not match the input size.");return function e(t,n,r){var a=new Array;if(1===n.length)for(var i=n[0],o=0;o<i;o++)a[o]=r[t+o];else{i=n[0];var s=n.slice(1),c=s.reduce(function(e,t){return e*t});for(o=0;o<i;o++)a[o]=e(t+o*c,s,r)}return a}(0,e,t)}function Si(e,t){for(var n=Ni(e,t),r=0;r<n.length;r++)n[r]=1;return n}function Ni(e,t){if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t)return new Uint8Array(e);throw new Error("Unknown data type "+t)}function Ci(){return Da().platform.now()}function Ei(e){e.forEach(function(t){qa(Number.isInteger(t)&&t>=0,function(){return"Tensor must have a shape comprised of positive integers but got shape ["+e+"]."})})}function Ii(e,t){return void 0===t&&(t="utf-8"),t=t||"utf-8",Da().platform.encode(e,t)}function Ti(e,t){return void 0===t&&(t="utf-8"),t=t||"utf-8",Da().platform.decode(e,t)}function _i(e,t,n){if(0===t)return 0;if(1===t)return e[0];for(var r=e[e.length-1],a=0;a<e.length-1;++a)r+=n[a]*e[a];return r}function Ai(e,t,n){if(0===t)return[];if(1===t)return[e];for(var r=new Array(t),a=0;a<r.length-1;++a)r[a]=Math.floor(e/n[a]),e-=r[a]*n[a];return r[r.length-1]=e,r}Object.freeze({shuffle:Wa,clamp:Va,nearestLargerEven:Ha,sum:Ga,randUniform:function(e,t){var n=Math.random();return t*n+(1-n)*e},distSquared:function(e,t){for(var n=0,r=0;r<e.length;r++){var a=Number(e[r])-Number(t[r]);n+=a*a}return n},assert:qa,assertShapesMatch:Ka,assertNonNull:Xa,flatten:Ya,sizeFromShape:$a,isScalarShape:function(e){return 0===e.length},arraysEqual:Ja,isInt:Qa,tanh:Za,sizeToSquarishShape:ei,createShuffledIndices:function(e){for(var t=new Uint32Array(e),n=0;n<e;++n)t[n]=n;return Wa(t),t},rightPad:ti,repeatedTry:ni,inferFromImplicitShape:ri,parseAxisParam:ai,squeezeShape:ii,getTypedArrayFromDType:oi,getArrayFromDType:si,checkConversionForErrors:ci,isValidDtype:li,hasEncodingLoss:ui,isTypedArray:hi,bytesPerElement:di,bytesFromStringArray:fi,isString:pi,isBoolean:mi,isNumber:gi,inferDtype:vi,isFunction:bi,nearestDivisor:yi,computeStrides:xi,toTypedArray:wi,toNestedArray:ki,makeOnesTypedArray:Si,makeZerosTypedArray:Ni,now:Ci,assertNonNegativeIntegerDimensions:Ei,fetch:function(e,t){return Da().platform.fetch(e,t)},encodeString:Ii,decodeString:Ti,locToIndex:_i,indexToLoc:Ai});var Ri=function(){function e(e,t){this.backendTimer=e,this.logger=t,null==t&&(this.logger=new Fi)}return e.prototype.profileKernel=function(e,t,n){var r,a=this,i=this.backendTimer.time(function(){r=n()});return r.forEach(function(n){n.data().then(function(r){!function(e,t,n){if("float32"!==t)return!1;for(var r=0;r<e.length;r++){var a=e[r];if(isNaN(a)||!isFinite(a))return console.warn("Found "+a+" in the result of '"+n+"'"),!0}}(r,n.dtype,e),i.then(function(i){var o="";null!=i.getExtraProfileInfo&&(o=i.getExtraProfileInfo()),a.logger.logKernelProfile(e,n,r,i.kernelMs,t,o)})})}),r},e}(),Fi=function(){function e(){}return e.prototype.logKernelProfile=function(e,t,n,r,a,i){var o="number"==typeof r?ti(r+"ms",9):r.error,s=ti(e,25),c=t.rank,l=t.size,u=ti(t.shape.toString(),14),h="";for(var d in a){var f=a[d].shape||t.shape,p=f.length;h+=d+": "+p+"D "+(p>0?f:"")+" "}console.log("%c"+s+"\t%c"+o+"\t%c"+c+"D "+u+"\t%c"+l+"\t%c"+h+"\t%c"+i,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},e}();function Di(e,t,n){return ti(Array.isArray(e)?parseFloat(e[0].toFixed(7))+" + "+parseFloat(e[1].toFixed(7))+"j":pi(e)?"'"+e+"'":"bool"===n?Oi(e):parseFloat(e.toFixed(7)).toString(),t)}function Oi(e){return 0===e?"false":"true"}function Li(e){for(var t=[],n=0;n<e.length;n+=2)t.push([e[n],e[n+1]]);return t}var Pi=function(){function e(e,t,n){var r=this;if(this.dtype=t,this.shape=e.slice(),this.size=$a(e),null!=n){var a=n.length;qa(a===this.size,function(){return"Length of values '"+a+"' does not match the size inferred by the shape '"+r.size+"'."})}if("complex64"===t)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||si(t,this.size),this.strides=xi(e)}return e.prototype.set=function(e){for(var t=this,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];0===n.length&&(n=[0]),qa(n.length===this.rank,function(){return"The number of provided coordinates ("+n.length+") must match the rank ("+t.rank+")"});var a=this.locToIndex(n);this.values[a]=e},e.prototype.get=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];0===e.length&&(e=[0]);for(var n=0,r=0,a=e;r<a.length;r++){var i=a[r];if(i<0||i>=this.shape[n]){var o="Requested out of range element at "+e+".   Buffer shape="+this.shape;throw new Error(o)}n++}for(var s=e[e.length-1],c=0;c<e.length-1;++c)s+=this.strides[c]*e[c];return this.values[s]},e.prototype.locToIndex=function(e){if(0===this.rank)return 0;if(1===this.rank)return e[0];for(var t=e[e.length-1],n=0;n<e.length-1;++n)t+=this.strides[n]*e[n];return t},e.prototype.indexToLoc=function(e){if(0===this.rank)return[];if(1===this.rank)return[e];for(var t=new Array(this.shape.length),n=0;n<t.length-1;++n)t[n]=Math.floor(e/this.strides[n]),e-=t[n]*this.strides[n];return t[t.length-1]=e,t},Object.defineProperty(e.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),e.prototype.toTensor=function(){return Mi().makeTensor(this.values,this.shape,this.dtype)},e}(),Mi=null,ji=null,Bi=null,zi=function(){function e(e,t,n,r){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=$a(e),this.strides=xi(e),this.dataId=n,this.id=r,this.rankType=this.rank<5?this.rank.toString():"higher"}return e.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},e.prototype.asScalar=function(){return this.throwIfDisposed(),qa(1===this.size,function(){return"The array must have only 1 element."}),this.reshape([])},e.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},e.prototype.as2D=function(e,t){return this.throwIfDisposed(),this.reshape([e,t])},e.prototype.as3D=function(e,t,n){return this.throwIfDisposed(),this.reshape([e,t,n])},e.prototype.as4D=function(e,t,n,r){return this.throwIfDisposed(),this.reshape([e,t,n,r])},e.prototype.as5D=function(e,t,n,r,a){return this.throwIfDisposed(),this.reshape([e,t,n,r,a])},e.prototype.asType=function(e){return this.throwIfDisposed(),ji.cast(this,e)},Object.defineProperty(e.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),e.prototype.buffer=function(){return Aa(this,void 0,void 0,function(){var e;return Ra(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,ji.buffer(this.shape,this.dtype,e)]}})})},e.prototype.bufferSync=function(){return ji.buffer(this.shape,this.dtype,this.dataSync())},e.prototype.array=function(){return Aa(this,void 0,void 0,function(){var e;return Ra(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,ki(this.shape,e)]}})})},e.prototype.arraySync=function(){return ki(this.shape,this.dataSync())},e.prototype.data=function(){return Aa(this,void 0,void 0,function(){var e,t;return Ra(this,function(n){switch(n.label){case 0:return this.throwIfDisposed(),e=Mi().read(this.dataId),"string"!==this.dtype?[3,2]:[4,e];case 1:t=n.sent();try{return[2,t.map(function(e){return Ti(e)})]}catch(e){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}case 2:return[2,e]}})})},e.prototype.dataSync=function(){this.throwIfDisposed();var e=Mi().readSync(this.dataId);if("string"===this.dtype)try{return e.map(function(e){return Ti(e)})}catch(e){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e},e.prototype.bytes=function(){return Aa(this,void 0,void 0,function(){var e;return Ra(this,function(t){switch(t.label){case 0:return this.throwIfDisposed(),[4,Mi().read(this.dataId)];case 1:return e=t.sent(),"string"===this.dtype?[2,e]:[2,new Uint8Array(e.buffer)]}})})},e.prototype.dispose=function(){this.isDisposed||(Mi().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(e.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),e.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},e.prototype.toFloat=function(){return this.asType("float32")},e.prototype.toInt=function(){return this.asType("int32")},e.prototype.toBool=function(){return this.asType("bool")},e.prototype.print=function(e){return void 0===e&&(e=!1),ji.print(this,e)},e.prototype.reshape=function(e){return this.throwIfDisposed(),ji.reshape(this,e)},e.prototype.reshapeAs=function(e){return this.throwIfDisposed(),this.reshape(e.shape)},e.prototype.expandDims=function(e){return void 0===e&&(e=0),ji.expandDims(this,e)},e.prototype.cumsum=function(e,t,n){return void 0===e&&(e=0),void 0===t&&(t=!1),void 0===n&&(n=!1),ji.cumsum(this,e,t,n)},e.prototype.squeeze=function(e){return this.throwIfDisposed(),ji.squeeze(this,e)},e.prototype.clone=function(){return this.throwIfDisposed(),ji.clone(this)},e.prototype.oneHot=function(e,t,n){return this.throwIfDisposed(),ji.oneHot(this,e,t,n)},e.prototype.toString=function(e){return void 0===e&&(e=!1),function(e,t,n,r){var a=xi(t),i=function(e,t,n,r){var a=$a(t),i=r[r.length-1],o=new Array(i).fill(0),s=t.length,c="complex64"===n?Li(e):e;if(s>1)for(var l=0;l<a/i;l++)for(var u=l*i,h=0;h<i;h++)o[h]=Math.max(o[h],Di(c[u+h],0,n).length);return o}(e,t,n,a),o=t.length,s=function e(t,n,r,a,i,o){void 0===o&&(o=!0);var s="complex64"===r?2:1,c=n[0],l=n.length;if(0===l)return"complex64"===r?[Di(Li(t)[0],0,r)]:"bool"===r?[Oi(t[0])]:[t[0].toString()];if(1===l){if(c>20){var u=3*s,h=Array.from(t.slice(0,u)),d=Array.from(t.slice((c-3)*s,c*s));return"complex64"===r&&(h=Li(h),d=Li(d)),["["+h.map(function(e,t){return Di(e,i[t],r)}).join(", ")+", ..., "+d.map(function(e,t){return Di(e,i[c-3+t],r)}).join(", ")+"]"]}return["["+("complex64"===r?Li(t):Array.from(t)).map(function(e,t){return Di(e,i[t],r)}).join(", ")+"]"]}var f=n.slice(1),p=a.slice(1),m=a[0]*s,g=[];if(c>20){for(var v=0;v<3;v++){var b=(y=v*m)+m;g.push.apply(g,e(t.slice(y,b),f,r,p,i,!1))}for(g.push("..."),v=c-3;v<c;v++)b=(y=v*m)+m,g.push.apply(g,e(t.slice(y,b),f,r,p,i,v===c-1))}else for(v=0;v<c;v++){var y;b=(y=v*m)+m,g.push.apply(g,e(t.slice(y,b),f,r,p,i,v===c-1))}var x=2===l?",":"";for(g[0]="["+g[0]+x,v=1;v<g.length-1;v++)g[v]=" "+g[v]+x;var w=",\n";for(v=2;v<l;v++)w+="\n";return g[g.length-1]=" "+g[g.length-1]+"]"+(o?"":w),g}(e,t,n,a,i),c=["Tensor"];return r&&(c.push("  dtype: "+n),c.push("  rank: "+o),c.push("  shape: ["+t+"]"),c.push("  values:")),c.push(s.map(function(e){return"    "+e}).join("\n")),c.join("\n")}(this.dataSync(),this.shape,this.dtype,e)},e.prototype.tile=function(e){return this.throwIfDisposed(),ji.tile(this,e)},e.prototype.gather=function(e,t){return void 0===t&&(t=0),this.throwIfDisposed(),ji.gather(this,e,t)},e.prototype.matMul=function(e,t,n){return void 0===t&&(t=!1),void 0===n&&(n=!1),this.throwIfDisposed(),ji.matMul(this,e,t,n)},e.prototype.dot=function(e){return this.throwIfDisposed(),ji.dot(this,e)},e.prototype.norm=function(e,t,n){return void 0===e&&(e="euclidean"),void 0===t&&(t=null),void 0===n&&(n=!1),this.throwIfDisposed(),ji.norm(this,e,t,n)},e.prototype.slice=function(e,t){return this.throwIfDisposed(),ji.slice(this,e,t)},e.prototype.reverse=function(e){return this.throwIfDisposed(),ji.reverse(this,e)},e.prototype.concat=function(t,n){return void 0===n&&(n=0),this.throwIfDisposed(),t instanceof e&&(t=[t]),ji.concat([this].concat(t),n)},e.prototype.split=function(e,t){return void 0===t&&(t=0),this.throwIfDisposed(),ji.split(this,e,t)},e.prototype.stack=function(e,t){return void 0===t&&(t=0),ji.stack([this,e],t)},e.prototype.unstack=function(e){return void 0===e&&(e=0),ji.unstack(this,e)},e.prototype.pad=function(e,t){return void 0===t&&(t=0),ji.pad(this,e,t)},e.prototype.batchNormalization=function(e,t,n,r,a){return void 0===n&&(n=.001),Bi("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(e,t,a,r,n)},e.prototype.batchNorm=function(e,t,n,r,a){return void 0===a&&(a=.001),this.throwIfDisposed(),ji.batchNorm(this,e,t,n,r,a)},e.prototype.all=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),ji.all(this,e,t)},e.prototype.any=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),ji.any(this,e,t)},e.prototype.logSumExp=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),ji.logSumExp(this,e,t)},e.prototype.sum=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),ji.sum(this,e,t)},e.prototype.prod=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),ji.prod(this,e,t)},e.prototype.mean=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),ji.mean(this,e,t)},e.prototype.min=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),ji.min(this,e,t)},e.prototype.max=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),ji.max(this,e,t)},e.prototype.argMin=function(e){return void 0===e&&(e=null),this.throwIfDisposed(),ji.argMin(this,e)},e.prototype.argMax=function(e){return void 0===e&&(e=null),this.throwIfDisposed(),ji.argMax(this,e)},e.prototype.cast=function(e){return this.throwIfDisposed(),ji.cast(this,e)},e.prototype.add=function(e){return this.throwIfDisposed(),ji.add(this,e)},e.prototype.addStrict=function(e){return this.throwIfDisposed(),ji.addStrict(this,e)},e.prototype.atan2=function(e){return this.throwIfDisposed(),ji.atan2(this,e)},e.prototype.sub=function(e){return this.throwIfDisposed(),ji.sub(this,e)},e.prototype.subStrict=function(e){return this.throwIfDisposed(),ji.subStrict(this,e)},e.prototype.pow=function(e){return this.throwIfDisposed(),ji.pow(this,e)},e.prototype.powStrict=function(e){return this.throwIfDisposed(),ji.powStrict(this,e)},e.prototype.mul=function(e){return this.throwIfDisposed(),ji.mul(this,e)},e.prototype.mulStrict=function(e){return this.throwIfDisposed(),ji.mulStrict(this,e)},e.prototype.div=function(e){return this.throwIfDisposed(),ji.div(this,e)},e.prototype.divNoNan=function(e){return this.throwIfDisposed(),ji.divNoNan(this,e)},e.prototype.floorDiv=function(e){return this.throwIfDisposed(),ji.floorDiv(this,e)},e.prototype.divStrict=function(e){return this.throwIfDisposed(),ji.divStrict(this,e)},e.prototype.minimum=function(e){return this.throwIfDisposed(),ji.minimum(this,e)},e.prototype.minimumStrict=function(e){return this.throwIfDisposed(),ji.minimumStrict(this,e)},e.prototype.maximum=function(e){return this.throwIfDisposed(),ji.maximum(this,e)},e.prototype.maximumStrict=function(e){return this.throwIfDisposed(),ji.maximumStrict(this,e)},e.prototype.mod=function(e){return this.throwIfDisposed(),ji.mod(this,e)},e.prototype.modStrict=function(e){return this.throwIfDisposed(),ji.modStrict(this,e)},e.prototype.squaredDifferenceStrict=function(e){return this.throwIfDisposed(),ji.squaredDifferenceStrict(this,e)},e.prototype.transpose=function(e){return this.throwIfDisposed(),ji.transpose(this,e)},e.prototype.notEqual=function(e){return this.throwIfDisposed(),ji.notEqual(this,e)},e.prototype.notEqualStrict=function(e){return this.throwIfDisposed(),ji.notEqualStrict(this,e)},e.prototype.less=function(e){return this.throwIfDisposed(),ji.less(this,e)},e.prototype.lessStrict=function(e){return this.throwIfDisposed(),ji.lessStrict(this,e)},e.prototype.equal=function(e){return this.throwIfDisposed(),ji.equal(this,e)},e.prototype.equalStrict=function(e){return this.throwIfDisposed(),ji.equalStrict(this,e)},e.prototype.lessEqual=function(e){return this.throwIfDisposed(),ji.lessEqual(this,e)},e.prototype.lessEqualStrict=function(e){return this.throwIfDisposed(),ji.lessEqualStrict(this,e)},e.prototype.greater=function(e){return this.throwIfDisposed(),ji.greater(this,e)},e.prototype.greaterStrict=function(e){return this.throwIfDisposed(),ji.greaterStrict(this,e)},e.prototype.greaterEqual=function(e){return this.throwIfDisposed(),ji.greaterEqual(this,e)},e.prototype.greaterEqualStrict=function(e){return this.throwIfDisposed(),ji.greaterEqualStrict(this,e)},e.prototype.logicalAnd=function(e){return this.throwIfDisposed(),ji.logicalAnd(this,e)},e.prototype.logicalOr=function(e){return this.throwIfDisposed(),ji.logicalOr(this,e)},e.prototype.logicalNot=function(){return this.throwIfDisposed(),ji.logicalNot(this)},e.prototype.logicalXor=function(e){return this.throwIfDisposed(),ji.logicalXor(this,e)},e.prototype.where=function(e,t){return this.throwIfDisposed(),ji.where(e,this,t)},e.prototype.neg=function(){return this.throwIfDisposed(),ji.neg(this)},e.prototype.ceil=function(){return this.throwIfDisposed(),ji.ceil(this)},e.prototype.floor=function(){return this.throwIfDisposed(),ji.floor(this)},e.prototype.sign=function(){return this.throwIfDisposed(),ji.sign(this)},e.prototype.isNaN=function(){return this.throwIfDisposed(),ji.isNaN(this)},e.prototype.isInf=function(){return this.throwIfDisposed(),ji.isInf(this)},e.prototype.isFinite=function(){return this.throwIfDisposed(),ji.isFinite(this)},e.prototype.exp=function(){return this.throwIfDisposed(),ji.exp(this)},e.prototype.expm1=function(){return this.throwIfDisposed(),ji.expm1(this)},e.prototype.log=function(){return this.throwIfDisposed(),ji.log(this)},e.prototype.log1p=function(){return this.throwIfDisposed(),ji.log1p(this)},e.prototype.sqrt=function(){return this.throwIfDisposed(),ji.sqrt(this)},e.prototype.rsqrt=function(){return this.throwIfDisposed(),ji.rsqrt(this)},e.prototype.square=function(){return this.throwIfDisposed(),ji.square(this)},e.prototype.reciprocal=function(){return this.throwIfDisposed(),ji.reciprocal(this)},e.prototype.abs=function(){return this.throwIfDisposed(),ji.abs(this)},e.prototype.clipByValue=function(e,t){return this.throwIfDisposed(),ji.clipByValue(this,e,t)},e.prototype.relu=function(){return this.throwIfDisposed(),ji.relu(this)},e.prototype.relu6=function(){return this.throwIfDisposed(),ji.relu6(this)},e.prototype.elu=function(){return this.throwIfDisposed(),ji.elu(this)},e.prototype.selu=function(){return this.throwIfDisposed(),ji.selu(this)},e.prototype.leakyRelu=function(e){return void 0===e&&(e=.2),this.throwIfDisposed(),ji.leakyRelu(this,e)},e.prototype.prelu=function(e){return this.throwIfDisposed(),ji.prelu(this,e)},e.prototype.sigmoid=function(){return this.throwIfDisposed(),ji.sigmoid(this)},e.prototype.logSigmoid=function(){return this.throwIfDisposed(),ji.logSigmoid(this)},e.prototype.softplus=function(){return this.throwIfDisposed(),ji.softplus(this)},e.prototype.zerosLike=function(){return this.throwIfDisposed(),ji.zerosLike(this)},e.prototype.onesLike=function(){return this.throwIfDisposed(),ji.onesLike(this)},e.prototype.sin=function(){return this.throwIfDisposed(),ji.sin(this)},e.prototype.cos=function(){return this.throwIfDisposed(),ji.cos(this)},e.prototype.tan=function(){return this.throwIfDisposed(),ji.tan(this)},e.prototype.asin=function(){return this.throwIfDisposed(),ji.asin(this)},e.prototype.acos=function(){return this.throwIfDisposed(),ji.acos(this)},e.prototype.atan=function(){return this.throwIfDisposed(),ji.atan(this)},e.prototype.sinh=function(){return this.throwIfDisposed(),ji.sinh(this)},e.prototype.cosh=function(){return this.throwIfDisposed(),ji.cosh(this)},e.prototype.tanh=function(){return this.throwIfDisposed(),ji.tanh(this)},e.prototype.asinh=function(){return this.throwIfDisposed(),ji.asinh(this)},e.prototype.acosh=function(){return this.throwIfDisposed(),ji.acosh(this)},e.prototype.atanh=function(){return this.throwIfDisposed(),ji.atanh(this)},e.prototype.erf=function(){return this.throwIfDisposed(),ji.erf(this)},e.prototype.round=function(){return this.throwIfDisposed(),ji.round(this)},e.prototype.step=function(e){return void 0===e&&(e=0),this.throwIfDisposed(),ji.step(this,e)},e.prototype.softmax=function(e){return void 0===e&&(e=-1),this.throwIfDisposed(),ji.softmax(this,e)},e.prototype.logSoftmax=function(e){return void 0===e&&(e=-1),this.throwIfDisposed(),ji.logSoftmax(this,e)},e.prototype.resizeBilinear=function(e,t){return void 0===t&&(t=!1),this.throwIfDisposed(),ji.image.resizeBilinear(this,e,t)},e.prototype.resizeNearestNeighbor=function(e,t){return void 0===t&&(t=!1),this.throwIfDisposed(),ji.image.resizeNearestNeighbor(this,e,t)},e.prototype.conv1d=function(e,t,n,r,a,i){return void 0===r&&(r="NWC"),void 0===a&&(a=1),this.throwIfDisposed(),ji.conv1d(this,e,t,n,r,a,i)},e.prototype.conv2d=function(e,t,n,r,a,i){return void 0===r&&(r="NHWC"),void 0===a&&(a=[1,1]),this.throwIfDisposed(),ji.conv2d(this,e,t,n,r,a,i)},e.prototype.conv2dTranspose=function(e,t,n,r,a){return this.throwIfDisposed(),ji.conv2dTranspose(this,e,t,n,r,a)},e.prototype.depthwiseConv2D=function(e,t,n,r,a,i){return void 0===r&&(r="NHWC"),void 0===a&&(a=[1,1]),this.throwIfDisposed(),ji.depthwiseConv2d(this,e,t,n,r,a,i)},e.prototype.separableConv2d=function(e,t,n,r,a,i){return void 0===a&&(a=[1,1]),void 0===i&&(i="NHWC"),this.throwIfDisposed(),ji.separableConv2d(this,e,t,n,r,a,i)},e.prototype.avgPool=function(e,t,n,r){return this.throwIfDisposed(),ji.avgPool(this,e,t,n,r)},e.prototype.maxPool=function(e,t,n,r){return this.throwIfDisposed(),ji.maxPool(this,e,t,n,r)},e.prototype.localResponseNormalization=function(e,t,n,r){return void 0===e&&(e=5),void 0===t&&(t=1),void 0===n&&(n=1),void 0===r&&(r=.5),ji.localResponseNormalization(this,e,t,n,r)},e.prototype.pool=function(e,t,n,r,a){return this.throwIfDisposed(),ji.pool(this,e,t,n,r,a)},e.prototype.variable=function(e,t,n){return void 0===e&&(e=!0),this.throwIfDisposed(),Mi().makeVariable(this,e,t,n)},e.prototype.unsortedSegmentSum=function(e,t){return this.throwIfDisposed(),ji.unsortedSegmentSum(this,e,t)},e.prototype.batchToSpaceND=function(e,t){return this.throwIfDisposed(),ji.batchToSpaceND(this,e,t)},e.prototype.spaceToBatchND=function(e,t){return this.throwIfDisposed(),ji.spaceToBatchND(this,e,t)},e.prototype.topk=function(e,t){return void 0===e&&(e=1),void 0===t&&(t=!0),this.throwIfDisposed(),ji.topk(this,e,t)},e.prototype.stridedSlice=function(e,t,n,r,a,i,o,s){return void 0===r&&(r=0),void 0===a&&(a=0),void 0===i&&(i=0),void 0===o&&(o=0),void 0===s&&(s=0),this.throwIfDisposed(),ji.stridedSlice(this,e,t,n,r,a,i,o,s)},e.prototype.depthToSpace=function(e,t){return this.throwIfDisposed(),ji.depthToSpace(this,e,t)},e.prototype.fft=function(){return this.throwIfDisposed(),ji.spectral.fft(this)},e.prototype.ifft=function(){return this.throwIfDisposed(),ji.spectral.ifft(this)},e.prototype.rfft=function(){return this.throwIfDisposed(),ji.spectral.rfft(this)},e.prototype.irfft=function(){return this.throwIfDisposed(),ji.spectral.irfft(this)},e}();Object.defineProperty(zi,Symbol.hasInstance,{value:function(e){return!!e&&null!=e.dataId&&null!=e.shape&&null!=e.dtype}});var Ui,Wi,Vi,Hi,Gi,qi=function(e){function t(t,n,r,a){var i=e.call(this,t.shape,t.dtype,t.dataId,a)||this;return i.trainable=n,i.name=r,i}return _a(t,e),t.prototype.assign=function(e){if(e.dtype!==this.dtype)throw new Error("dtype of the new value ("+e.dtype+") and previous value ("+this.dtype+") must match");if(!Ja(e.shape,this.shape))throw new Error("shape of the new value ("+e.shape+") and previous value ("+this.shape+") must match");Mi().disposeTensor(this),this.dataId=e.dataId,Mi().incRef(this,null)},t.prototype.dispose=function(){Mi().disposeVariable(this),this.isDisposedInternal=!0},t}(zi);Object.defineProperty(qi,Symbol.hasInstance,{value:function(e){return e instanceof zi&&null!=e.assign&&e.assign instanceof Function}}),function(e){e.R0="R0",e.R1="R1",e.R2="R2",e.R3="R3",e.R4="R4",e.R5="R5",e.R6="R6"}(Ui||(Ui={})),function(e){e.float32="float32",e.int32="int32",e.bool="int32",e.complex64="complex64"}(Wi||(Wi={})),function(e){e.float32="float32",e.int32="int32",e.bool="bool",e.complex64="complex64"}(Vi||(Vi={})),function(e){e.float32="float32",e.int32="float32",e.bool="float32",e.complex64="complex64"}(Hi||(Hi={})),function(e){e.float32="complex64",e.int32="complex64",e.bool="complex64",e.complex64="complex64"}(Gi||(Gi={}));var Ki={float32:Hi,int32:Wi,bool:Vi,complex64:Gi};function Xi(e,t){if("string"===e||"string"===t){if("string"===e&&"string"===t)return"string";throw new Error("Can not upcast "+e+" with "+t)}return Ki[e][t]}function Yi(e){return Xi(e,"int32")}function $i(e,t){if(e.dtype===t.dtype)return[e,t];var n=Xi(e.dtype,t.dtype);return[e.cast(n),t.cast(n)]}function Ji(e,t){qa(e.dtype===t.dtype,function(){return"The dtypes of the first("+e.dtype+") and second("+t.dtype+") input must match"})}function Qi(e){var t=[];return function e(t,n,r){if(null!=t)if(t instanceof zi)n.push(t);else if(a=t,Array.isArray(a)||"object"==typeof a){var a,i=t;for(var o in i){var s=i[o];r.has(s)||(r.add(s),e(s,n,r))}}}(e,t,new Set),t}Object.freeze({makeTypesMatch:$i,assertTypesMatch:Ji,isTensorInList:function(e,t){return t.some(function(t){return t.id===e.id})},getTensorsInContainer:Qi});var Zi,eo=function(){function e(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return e.prototype.dispose=function(){for(var e in this.registeredVariables)this.registeredVariables[e].dispose()},e}(),to=function(){function e(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new eo}return e.prototype.ready=function(){return Aa(this,void 0,void 0,function(){var e,t,n;return Ra(this,function(r){switch(r.label){case 0:if(null!=this.pendingBackendInit)return[2,this.pendingBackendInit.then(function(){})];if(null!=this.backendInstance)return[2];e=this.getSortedBackends(),t=0,r.label=1;case 1:return t<e.length?(n=e[t],[4,this.initializeBackend(n).success]):[3,5];case 2:return r.sent()?[4,this.setBackend(n)]:[3,4];case 3:return r.sent(),[2];case 4:return t++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}})})},Object.defineProperty(e.prototype,"backend",{get:function(){if(null!=this.pendingBackendInit)throw new Error("Backend '"+this.backendName+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");if(null==this.backendInstance){var e=this.initializeBackendsAndReturnBest(),t=e.name;if(e.asyncInit)throw new Error("The highest priority backend '"+t+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(t)}return this.backendInstance},enumerable:!0,configurable:!0}),e.prototype.backendNames=function(){return Object.keys(this.registryFactory)},e.prototype.findBackend=function(e){if(!(e in this.registry)){if(!(e in this.registryFactory))return null;if(this.initializeBackend(e).asyncInit)return null}return this.registry[e]},e.prototype.findBackendFactory=function(e){return e in this.registryFactory?this.registryFactory[e].factory:null},e.prototype.registerBackend=function(e,t,n){return void 0===n&&(n=1),e in this.registryFactory?(console.warn(e+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[e]={factory:t,priority:n},!0)},e.prototype.setBackend=function(e){return Aa(this,void 0,void 0,function(){var t,n,r;return Ra(this,function(a){switch(a.label){case 0:if(null==this.registryFactory[e])throw new Error("Backend name '"+e+"' not found in registry");return this.backendName=e,null!=this.registry[e]?[3,4]:(this.backendInstance=null,t=this.initializeBackend(e),n=t.success,t.asyncInit?[4,n]:[3,2]);case 1:return r=a.sent(),[3,3];case 2:r=n,a.label=3;case 3:if(!r)return[2,!1];a.label=4;case 4:return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new Ri(this.backendInstance),[2,!0]}})})},e.prototype.setupRegisteredKernels=function(){var e=this;ja(this.backendName).forEach(function(t){null!=t.setupFunc&&t.setupFunc(e.backendInstance)})},e.prototype.disposeRegisteredKernels=function(e){var t=this;ja(e).forEach(function(n){null!=n.disposeFunc&&n.disposeFunc(t.registry[e])})},e.prototype.initializeBackend=function(e){var t=this,n=this.registryFactory[e];if(null==n)throw new Error("Cannot initialize backend "+e+", no registration found.");try{var r=n.factory();if(Promise.resolve(r)===r){var a=++this.pendingBackendInitId,i=r.then(function(n){return!(a<t.pendingBackendInitId)&&(t.registry[e]=n,t.pendingBackendInit=null,!0)}).catch(function(n){return!(a<t.pendingBackendInitId)&&(t.pendingBackendInit=null,console.warn("Initialization of backend "+e+" failed"),console.warn(n.stack||n.message),!1)});return this.pendingBackendInit=i,{success:i,asyncInit:!0}}return this.registry[e]=r,{success:!0,asyncInit:!1}}catch(t){return console.warn("Initialization of backend "+e+" failed"),console.warn(t.stack||t.message),{success:!1,asyncInit:!1}}},e.prototype.removeBackend=function(e){if(!(e in this.registryFactory))throw new Error(e+" backend not found in registry");this.backendName===e&&null!=this.pendingBackendInit&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},e.prototype.getSortedBackends=function(){var e=this;if(0===Object.keys(this.registryFactory).length)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(function(t,n){return e.registryFactory[n].priority-e.registryFactory[t].priority})},e.prototype.initializeBackendsAndReturnBest=function(){for(var e=this.getSortedBackends(),t=0;t<e.length;t++){var n=e[t],r=this.initializeBackend(n),a=r.success,i=r.asyncInit;if(i||a)return{name:n,asyncInit:i}}throw new Error("Could not initialize any backends, all backend initializations failed.")},e.prototype.moveData=function(e,t){var n=this.state.tensorInfo.get(t),r=n.backend,a=this.readSync(t);r.disposeData(t),n.backend=e,e.move(t,a,n.shape,n.dtype),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},e.prototype.tidy=function(e,t){var n,r=this,a=null;if(null==t){if("function"!=typeof e)throw new Error("Please provide a function to tidy()");t=e}else{if("string"!=typeof e&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!=typeof t)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");a=e}return this.scopedRun(function(){return r.startScope(a)},function(){return r.endScope(n)},function(){return(n=t())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),n})},e.prototype.scopedRun=function(e,t,n){e();try{var r=n();return t(),r}catch(e){throw t(),e}},e.prototype.nextTensorId=function(){return e.nextTensorId++},e.prototype.nextVariableId=function(){return e.nextVariableId++},e.prototype.clone=function(e){var t=this.makeTensorFromDataId(e.dataId,e.shape,e.dtype),n={x:e};return this.addTapeNode(this.state.activeScope.name,n,[t],function(e){return{x:function(){return e.toFloat()}}},[]),t},e.prototype.runKernel=function(e,t,n,r,a){return this.runKernelFunc(null,t,null,e,n,r,a)},e.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},e.prototype.checkKernelForMemLeak=function(e,t,n){var r=this.backend.numDataIds(),a=0;n.forEach(function(e){a+="complex64"===e.dtype?3:1});var i=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],o=r-t-a-i;if(o>0)throw new Error("Backend '"+this.backendName+"' has an internal memory leak ("+o+" data ids) after running '"+e+"'")},e.prototype.runKernelFunc=function(e,t,n,r,a,i,o){var s,c=this;void 0===i&&(i=[]),void 0===o&&(o=[]);var l=[],u=this.isTapeOn();null==r&&(r=null!=this.state.activeScope?this.state.activeScope.name:"");var h,d=function(e){u&&(l=e.map(function(e){return c.keep(c.clone(e))}))},f=this.state.numBytes,p=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var m,g=Ma(r,this.backendName);return h=null!=g?function(){var e=c.backend.numDataIds();m=g.kernelFunc({inputs:t,attrs:a,backend:c.backend});var n=Array.isArray(m)?m:[m];c.shouldCheckForMemLeaks()&&c.checkKernelForMemLeak(r,e,n);var s=n.map(function(e){var t=e.dataId,n=e.shape,r=e.dtype;return c.makeTensorFromDataId(t,n,r)}),l=s.filter(function(e,t){return o[t]});return d((i||[]).slice().concat(l)),s}:function(){var t=c.backend.numDataIds();m=c.tidy(function(){return e(c.backend,d)});var n=Array.isArray(m)?m:[m];return c.shouldCheckForMemLeaks()&&c.checkKernelForMemLeak(r,t,n),n},this.scopedRun(function(){return c.state.kernelDepth++},function(){return c.state.kernelDepth--},function(){s=c.ENV.getBool("DEBUG")?c.profiler.profileKernel(r,t,function(){return h()}):h()}),u&&this.addTapeNode(r,t,s,n,l),this.state.profiling&&this.state.activeProfile.kernels.push({name:r,bytesAdded:this.state.numBytes-f,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-p,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(t).map(function(e){return t[e].shape}),outputShapes:s.map(function(e){return e.shape})}),Array.isArray(m)?s:s[0]},e.prototype.makeTensor=function(e,t,n,r){if(null==e)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",r=r||this.backend;var a=e;"string"===n&&pi(e[0])&&(a=e.map(function(e){return Ii(e)}));var i=r.write(a,t,n),o=new zi(t,n,i,this.nextTensorId());if(this.incRef(o,r),"string"===n){var s=this.state.tensorInfo.get(i),c=fi(a);this.state.numBytes+=c-s.bytes,s.bytes=c}return o},e.prototype.makeTensorFromDataId=function(e,t,n,r){var a=new zi(t,n=n||"float32",e,this.nextTensorId());return this.incRef(a,r),a},e.prototype.makeVariable=function(e,t,n,r){void 0===t&&(t=!0),n=n||this.nextVariableId().toString(),null!=r&&r!==e.dtype&&(e=e.asType(r));var a=new qi(e,t,n,this.nextTensorId());if(null!=this.state.registeredVariables[a.name])throw new Error("Variable with name "+a.name+" was already registered");return this.state.registeredVariables[a.name]=a,this.incRef(a,this.backend),a},e.prototype.incRef=function(e,t){var n=this.state.tensorInfo.has(e.dataId)?this.state.tensorInfo.get(e.dataId).refCount:0;if(this.state.numTensors++,"string"===e.dtype&&this.state.numStringTensors++,0===n){this.state.numDataBuffers++;var r=0;"complex64"!==e.dtype&&"string"!==e.dtype&&(r=e.size*di(e.dtype)),this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:r,refCount:0}),this.state.numBytes+=r}this.state.tensorInfo.get(e.dataId).refCount++,e instanceof qi||this.track(e)},e.prototype.disposeTensor=function(e){if(this.state.tensorInfo.has(e.dataId)){this.state.numTensors--,"string"===e.dtype&&this.state.numStringTensors--;var t=this.state.tensorInfo.get(e.dataId);t.refCount<=1?("complex64"!==e.dtype&&(this.state.numBytes-=t.bytes),this.state.numDataBuffers--,t.backend.disposeData(e.dataId),this.state.tensorInfo.delete(e.dataId)):this.state.tensorInfo.get(e.dataId).refCount--}},e.prototype.disposeVariables=function(){for(var e in this.state.registeredVariables){var t=this.state.registeredVariables[e];this.disposeVariable(t)}},e.prototype.disposeVariable=function(e){this.disposeTensor(e),null!=this.state.registeredVariables[e.name]&&delete this.state.registeredVariables[e.name]},e.prototype.memory=function(){var e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,null==e.reasons&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e},e.prototype.profile=function(e){return Aa(this,void 0,void 0,function(){var t,n;return Ra(this,function(r){return this.state.profiling=!0,t=this.state.numBytes,n=this.state.numTensors,this.state.activeProfile.kernels=[],this.state.activeProfile.result=e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,this.state.activeProfile.kernels.map(function(e){return e.totalBytesSnapshot})),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-n,[2,this.state.activeProfile]})})},e.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&0===this.state.kernelDepth},e.prototype.addTapeNode=function(e,t,n,r,a){var i=this,o={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:n,saved:a},s=function(e){return Pa.get(e)}(e);null!=s&&(r=s.gradFunc),null!=r&&(o.gradient=function(e){return e=e.map(function(e,t){if(null==e){var r=n[t],a=Ni(r.size,r.dtype);return i.makeTensor(a,r.shape,r.dtype)}return e}),r(e.length>1?e:e[0],a)}),this.state.activeTape.push(o)},e.prototype.keep=function(e){return e.kept=!0,e},e.prototype.startTape=function(){0===this.state.gradientDepth&&(this.state.activeTape=[]),this.state.gradientDepth++},e.prototype.endTape=function(){this.state.gradientDepth--},e.prototype.startScope=function(e){var t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t},e.prototype.endScope=function(e){for(var t=this,n=Qi(e),r=new Set(n.map(function(e){return e.id})),a=0;a<this.state.activeScope.track.length;a++){var i=this.state.activeScope.track[a];i.kept||r.has(i.id)||i.dispose()}var o=this.state.scopeStack.pop();this.state.activeScope=0===this.state.scopeStack.length?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach(function(e){e.kept||e.scopeId!==o.id||t.track(e)})},e.prototype.gradients=function(e,t,n,r){var a=this;if(void 0===r&&(r=!1),qa(t.length>0,function(){return"gradients() received an empty list of xs."}),null!=n&&"float32"!==n.dtype)throw new Error("dy must have 'float32' dtype, but has '"+n.dtype+"'");var i=this.scopedRun(function(){return a.startTape()},function(){return a.endTape()},function(){return a.tidy("forward",e)});qa(i instanceof zi,function(){return"The result y returned by f() must be a tensor."});var o=function(e,t,n){for(var r={},a={},i=0;i<t.length;i++)r[t[i].id]=!0;for(i=0;i<e.length;i++){var o=(p=e[i]).inputs;for(var s in o){for(var c=o[s],l=!1,u=0;u<t.length;u++)if(r[c.id]){p.outputs.forEach(function(e){return r[e.id]=!0}),l=!0,a[p.id]=!0;break}if(l)break}}var h={};h[n.id]=!0;var d={};for(i=e.length-1;i>=0;i--)for(o=(p=e[i]).inputs,u=0;u<p.outputs.length;u++)if(h[p.outputs[u].id]){for(var s in o)h[o[s].id]=!0,d[p.id]=!0;break}var f=[];for(i=0;i<e.length;i++){var p;if(a[(p=e[i]).id]&&d[p.id]){var m={};for(var s in p.inputs){var g=p.inputs[s];r[g.id]&&(m[s]=g)}var v=Object.assign({},p);v.inputs=m,v.outputs=p.outputs,f.push(v)}}return f}(this.state.activeTape,t,i);if(!r&&0===o.length&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",function(){var e,r,s={};s[i.id]=null==n?(r=Si($a(e=i.shape),"float32"),no.makeTensor(r,e,"float32")):n,function(e,t,n){for(var r=function(r){var a=t[r],i=[];if(a.outputs.forEach(function(t){var n=e[t.id];null!=n?i.push(n):i.push(null)}),null==a.gradient)throw new Error("Cannot compute gradient: gradient function not found for "+a.kernelName+".");var o=a.gradient(i),s=function(t){if(!(t in o))throw new Error("Cannot backprop through input "+t+". Available gradients found: "+Object.keys(o)+".");var r=n(function(){return o[t]()});if("float32"!==r.dtype)throw new Error("Error in gradient for op "+a.kernelName+". The gradient of input "+t+" must have 'float32' dtype, but has '"+r.dtype+"'");var i=a.inputs[t];if(!Ja(r.shape,i.shape))throw new Error("Error in gradient for op "+a.kernelName+". The gradient of input '"+t+"' has shape '"+r.shape+"', which does not match the shape of the input '"+i.shape+"'");if(null==e[i.id])e[i.id]=r;else{var s=e[i.id];e[i.id]=s.add(r),s.dispose()}};for(var c in a.inputs)s(c)},a=t.length-1;a>=0;a--)r(a)}(s,o,function(e){return a.tidy(e)});var c=t.map(function(e){return s[e.id]});return 0===a.state.gradientDepth&&(a.state.activeTape.forEach(function(e){for(var t=0,n=e.saved;t<n.length;t++)n[t].dispose()}),a.state.activeTape=null),{value:i,grads:c}})},e.prototype.customGrad=function(e){var t=this;return qa(bi(e),function(){return"The f passed in customGrad(f) must be a function."}),function(){for(var n,r=[],a=0;a<arguments.length;a++)r[a]=arguments[a];qa(r.every(function(e){return e instanceof zi}),function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"});var i={};return r.forEach(function(e,t){i[t]=e}),t.runKernelFunc(function(t,a){return qa((n=e.apply(void 0,r.concat([a]))).value instanceof zi,function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"}),qa(bi(n.gradFunc),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."}),n.value},i,function(e,t){var a=n.gradFunc(e,t),i=Array.isArray(a)?a:[a];qa(i.length===r.length,function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."}),qa(i.every(function(e){return e instanceof zi}),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."});var o={};return i.forEach(function(e,t){o[t]=function(){return e}}),o})}},e.prototype.readSync=function(e){return this.state.tensorInfo.get(e).backend.readSync(e)},e.prototype.read=function(e){return this.state.tensorInfo.get(e).backend.read(e)},e.prototype.time=function(e){return Aa(this,void 0,void 0,function(){var t,n;return Ra(this,function(r){switch(r.label){case 0:return t=Ci(),[4,this.backend.time(e)];case 1:return(n=r.sent()).wallMs=Ci()-t,[2,n]}})})},e.prototype.track=function(e){return null!=this.state.activeScope&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e},Object.defineProperty(e.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!0,configurable:!0}),e.prototype.reset=function(){for(var e in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new eo,this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},e.nextTensorId=0,e.nextVariableId=0,e}(),no=function(){var e=function(){if(null==Zi){var e=void 0;if("undefined"!=typeof window)e=window;else if("undefined"!=typeof n.g)e=n.g;else if("undefined"!=typeof process)e=process;else{if("undefined"==typeof self)throw new Error("Could not find a global object");e=self}Zi=e}return Zi}();if(null==e._tfengine){var t=new Fa(e);e._tfengine=new to(t)}return function(e){Oa=e}(e._tfengine.ENV),Mi=function(){return e._tfengine},e._tfengine}();function ro(){return"undefined"!=typeof window&&null!=window.document||"undefined"!=typeof WorkerGlobalScope}var ao=Da();ao.registerFlag("DEBUG",function(){return!1},function(e){e&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")}),ao.registerFlag("IS_BROWSER",function(){return ro()}),ao.registerFlag("IS_NODE",function(){return"undefined"!=typeof process&&void 0!==process.versions&&void 0!==process.versions.node}),ao.registerFlag("IS_CHROME",function(){return"undefined"!=typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}),ao.registerFlag("PROD",function(){return!1}),ao.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",function(){return ao.getBool("DEBUG")}),ao.registerFlag("DEPRECATION_WARNINGS_ENABLED",function(){return!0}),ao.registerFlag("IS_TEST",function(){return!1});var io,oo,so,co={},lo={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function uo(e,t){co[e]=t}function ho(e){e in co||(co[e]=function(e){if(1!==e&&2!==e)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var t=function(e){if("undefined"!=typeof OffscreenCanvas&&2===e)return new OffscreenCanvas(300,150);if("undefined"!=typeof document)return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(e);return t.addEventListener("webglcontextlost",function(t){t.preventDefault(),delete co[e]},!1),1===e?t.getContext("webgl",lo)||t.getContext("experimental-webgl",lo):t.getContext("webgl2",lo)}(e));var t=co[e];return t.isContextLost()?(delete co[e],ho(e)):(t.disable(t.DEPTH_TEST),t.disable(t.STENCIL_TEST),t.disable(t.BLEND),t.disable(t.DITHER),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SAMPLE_COVERAGE),t.enable(t.SCISSOR_TEST),t.enable(t.CULL_FACE),t.cullFace(t.BACK),co[e])}function fo(e,t){return[t,e]}function po(e){var t=$a(e);return ei(Math.ceil(t/4))}function mo(e,t){return[Math.max(1,Math.ceil(t/2)),Math.max(1,Math.ceil(e/2))]}function go(e,t){var n,r,a,i,o,s,c,l,u,h=e;return 2===Da().getNumber("WEBGL_VERSION")?(n=h.R32F,r=h.R16F,a=h.RGBA16F,i=h.RGBA32F,o=h.RED,s=4,c=1,l=h.HALF_FLOAT,u=h.FLOAT):(n=e.RGBA,r=e.RGBA,a=e.RGBA,i=h.RGBA,o=e.RGBA,s=4,c=4,l=null!=t?t.HALF_FLOAT_OES:null,u=e.FLOAT),{internalFormatFloat:n,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:a,internalFormatPackedFloat:i,textureFormatFloat:o,downloadTextureFormat:e.RGBA,downloadUnpackNumChannels:s,defaultNumChannels:c,textureTypeHalfFloat:l,textureTypeFloat:u}}function vo(e,t,n){var r=n();return t&&function(e){var t=e.getError();if(t!==e.NO_ERROR)throw new Error("WebGL Error: "+yo(e,t))}(e),r}!function(e){e[e.DENSE=0]="DENSE",e[e.SHARED_BATCH=1]="SHARED_BATCH"}(io||(io={})),function(e){e[e.RENDER=0]="RENDER",e[e.UPLOAD=1]="UPLOAD",e[e.PIXELS=2]="PIXELS",e[e.DOWNLOAD=3]="DOWNLOAD"}(oo||(oo={})),function(e){e[e.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",e[e.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",e[e.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",e[e.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",e[e.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(so||(so={}));function bo(e){return!!(Da().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||0===e||5.96e-8<Math.abs(e)&&Math.abs(e)<65504)}function yo(e,t){switch(t){case e.NO_ERROR:return"NO_ERROR";case e.INVALID_ENUM:return"INVALID_ENUM";case e.INVALID_VALUE:return"INVALID_VALUE";case e.INVALID_OPERATION:return"INVALID_OPERATION";case e.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case e.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case e.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+t}}function xo(e,t,n){return Vo(e,t,function(){return e.getExtension(n)},'Extension "'+n+'" not supported on this browser.')}function wo(e,t,n){var r=Vo(e,t,function(){return e.createShader(e.VERTEX_SHADER)},"Unable to create vertex WebGLShader.");if(vo(e,t,function(){return e.shaderSource(r,n)}),vo(e,t,function(){return e.compileShader(r)}),!1===e.getShaderParameter(r,e.COMPILE_STATUS))throw console.log(e.getShaderInfoLog(r)),new Error("Failed to compile vertex shader.");return r}function ko(e,t,n){var r=Vo(e,t,function(){return e.createShader(e.FRAGMENT_SHADER)},"Unable to create fragment WebGLShader.");if(vo(e,t,function(){return e.shaderSource(r,n)}),vo(e,t,function(){return e.compileShader(r)}),!1===e.getShaderParameter(r,e.COMPILE_STATUS))throw function(e,t){var n=Co.exec(t);if(null==n)return console.log("Couldn't parse line number in error: "+t),void console.log(e);for(var r=+n[1],a=e.split("\n"),i=a.length.toString().length+2,o=a.map(function(e,t){return ti((t+1).toString(),i)+e}),s=0,c=0;c<o.length;c++)s=Math.max(o[c].length,s);var l=o.slice(0,r-1),u=o.slice(r-1,r),h=o.slice(r);console.log(l.join("\n")),console.log(t.split("\n")[0]),console.log("%c "+ti(u[0],s),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(h.join("\n"))}(n,e.getShaderInfoLog(r)),new Error("Failed to compile fragment shader.");return r}var So,No,Co=/ERROR: [0-9]+:([0-9]+):/g;function Eo(e,t){return Vo(e,t,function(){return e.createProgram()},"Unable to create WebGLProgram.")}function Io(e,t,n){if(vo(e,t,function(){return e.linkProgram(n)}),!1===e.getProgramParameter(n,e.LINK_STATUS))throw console.log(e.getProgramInfoLog(n)),new Error("Failed to link vertex and fragment shaders.")}function To(e,t,n){if(vo(e,t,function(){return e.validateProgram(n)}),!1===e.getProgramParameter(n,e.VALIDATE_STATUS))throw console.log(e.getProgramInfoLog(n)),new Error("Shader program validation failed.")}function _o(e,t,n){var r=Vo(e,t,function(){return e.createBuffer()},"Unable to create WebGLBuffer");return vo(e,t,function(){return e.bindBuffer(e.ARRAY_BUFFER,r)}),vo(e,t,function(){return e.bufferData(e.ARRAY_BUFFER,n,e.STATIC_DRAW)}),r}function Ao(e,t,n){var r=Vo(e,t,function(){return e.createBuffer()},"Unable to create WebGLBuffer");return vo(e,t,function(){return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,r)}),vo(e,t,function(){return e.bufferData(e.ELEMENT_ARRAY_BUFFER,n,e.STATIC_DRAW)}),r}function Ro(e,t){return Vo(e,t,function(){return e.createTexture()},"Unable to create WebGLTexture.")}function Fo(e,t){var n=Da().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e<=0||t<=0){var r="["+e+"x"+t+"]";throw new Error("Requested texture size "+r+" is invalid.")}if(e>n||t>n)throw r="["+e+"x"+t+"]",new Error("Requested texture size "+r+" greater than WebGL maximum on this browser / GPU ["+n+"x"+n+"].")}function Do(e,t){return Vo(e,t,function(){return e.createFramebuffer()},"Unable to create WebGLFramebuffer.")}function Oo(e,t,n,r,a,i,o,s){var c=e.getAttribLocation(n,r);return-1!==c&&(vo(e,t,function(){return e.bindBuffer(e.ARRAY_BUFFER,a)}),vo(e,t,function(){return e.vertexAttribPointer(c,i,e.FLOAT,!1,o,s)}),vo(e,t,function(){return e.enableVertexAttribArray(c)}),!0)}function Lo(e,t,n,r){Ho(e,r),vo(e,t,function(){return e.activeTexture(e.TEXTURE0+r)}),vo(e,t,function(){return e.bindTexture(e.TEXTURE_2D,n)})}function Po(e,t,n,r){return Vo(e,t,function(){return e.getUniformLocation(n,r)},'uniform "'+r+'" not present in program.')}function Mo(e,t,n){return e.getUniformLocation(t,n)}function jo(e,t,n,r,a,i){vo(e,t,function(){return Lo(e,t,r,i)}),vo(e,t,function(){return e.uniform1i(a,i)})}function Bo(e,t,n,r){vo(e,t,function(){return e.bindFramebuffer(e.FRAMEBUFFER,r)}),vo(e,t,function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0)})}function zo(e,t,n){vo(e,t,function(){return e.bindFramebuffer(e.FRAMEBUFFER,n)}),vo(e,t,function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,null,0)})}function Uo(e){var t=e.checkFramebufferStatus(e.FRAMEBUFFER);if(t!==e.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+Wo(e,t))}function Wo(e,t){switch(t){case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case e.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+t}}function Vo(e,t,n,r){var a=vo(e,t,function(){return n()});if(null==a)throw new Error(r);return a}function Ho(e,t){var n=e.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=t+e.TEXTURE0;if(r<e.TEXTURE0||r>n)throw new Error("textureUnit must be in [gl.TEXTURE0, gl.TEXTURE"+n+"].")}function Go(e,t){return void 0===t&&(t=2),$a(e.slice(0,e.length-t))}function qo(e){if(0===e.length)throw Error("Cannot get rows and columns of an empty shape array.");return[e.length>1?e[e.length-2]:1,e[e.length-1]]}function Ko(e){var t=[1,1,1];return 0===e.length||1===e.length&&1===e[0]||(t=[Go(e)].concat(qo(e))),t}function Xo(e,t){var n;void 0===t&&(t=!1);var r=Da().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(t&&(r*=2,1===(e=e.map(function(t,n){return n>=e.length-2?Ha(e[n]):e[n]})).length&&(e=[2,e[0]])),2!==e.length){var a=ii(e);e=a.newShape}var i=$a(e);if(e.length<=1&&i<=r)return[1,i];if(2===e.length&&e[0]<=r&&e[1]<=r)return e;if(3===e.length&&e[0]*e[1]<=r&&e[2]<=r)return[e[0]*e[1],e[2]];if(3===e.length&&e[0]<=r&&e[1]*e[2]<=r)return[e[0],e[1]*e[2]];if(4===e.length&&e[0]*e[1]*e[2]<=r&&e[3]<=r)return[e[0]*e[1]*e[2],e[3]];if(4===e.length&&e[0]<=r&&e[1]*e[2]*e[3]<=r)return[e[0],e[1]*e[2]*e[3]];if(t){var o=Go(e),s=2,c=2;return e.length&&(s=(n=qo(e))[0],c=n[1]),ei(i=o*(s/2)*(c/2)).map(function(e){return 2*e})}return ei(i)}function Yo(e){return e%2==0}function $o(e,t){if(Ja(e=e.slice(-2),t=t.slice(-2)))return!0;if(!e.length||!t.length)return!0;if(0===e[0]||0===e[1]||0===t[0]||0===t[1])return!0;if(e.length!==t.length){var n=e.slice(-1)[0],r=t.slice(-1)[0];if(n===r)return!0;if(Yo(n)&&Yo(r)&&(1===e[0]||1===t[0]))return!0}return e[1]===t[1]&&Yo(e[0])&&Yo(t[0])}function Jo(e){if(null==So){var t=ho(e);So=t.getParameter(t.MAX_TEXTURE_SIZE)}return So}function Qo(e){if(null==No){var t=ho(e);No=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,No)}function Zo(e){if(0===e)return 0;var t=ho(e);return es(t,"EXT_disjoint_timer_query_webgl2")&&2===e?2:es(t,"EXT_disjoint_timer_query")?1:0}function es(e,t){return null!=e.getExtension(t)}function ts(e){try{if(null!=ho(e))return!0}catch(e){return!1}return!1}function ns(e){if(0===e)return!1;var t=ho(e);if(1===e){if(!es(t,"OES_texture_float"))return!1}else if(!es(t,"EXT_color_buffer_float"))return!1;return as(t)}function rs(e){if(0===e)return!1;var t=ho(e);if(1!==e){if(es(t,"EXT_color_buffer_float"))return as(t);if(es(t,"EXT_color_buffer_half_float")){var n=t.getExtension("EXT_color_buffer_half_float");return function(e,t){var n=go(e,t),r=e.createTexture();e.bindTexture(e.TEXTURE_2D,r),e.texImage2D(e.TEXTURE_2D,0,n.internalFormatHalfFloat,1,1,0,n.textureFormatFloat,n.textureTypeHalfFloat,null);var a=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,a),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,r,0);var i=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(r),e.deleteFramebuffer(a),i}(t,n)}return!1}return!!es(t,"OES_texture_float")&&!!es(t,"WEBGL_color_buffer_float")&&as(t)}function as(e){var t=go(e),n=e.createTexture();e.bindTexture(e.TEXTURE_2D,n),e.texImage2D(e.TEXTURE_2D,0,t.internalFormatFloat,1,1,0,t.textureFormatFloat,t.textureTypeFloat,null);var r=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,r),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0);var a=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(n),e.deleteFramebuffer(r),a}function is(e){return 2===e&&null!=ho(e).fenceSync}var os=Object.freeze({callAndCheck:vo,canBeRepresented:bo,getWebGLErrorMessage:yo,getExtensionOrThrow:xo,createVertexShader:wo,createFragmentShader:ko,createProgram:Eo,linkProgram:Io,validateProgram:To,createStaticVertexBuffer:_o,createStaticIndexBuffer:Ao,getNumChannels:function(){return 2===Da().getNumber("WEBGL_VERSION")?1:4},createTexture:Ro,validateTextureSize:Fo,createFramebuffer:Do,bindVertexBufferToProgramAttribute:Oo,bindTextureUnit:Lo,unbindTextureUnit:function(e,t,n){Ho(e,n),vo(e,t,function(){return e.activeTexture(e.TEXTURE0+n)}),vo(e,t,function(){return e.bindTexture(e.TEXTURE_2D,null)})},getProgramUniformLocationOrThrow:Po,getProgramUniformLocation:Mo,bindTextureToProgramUniformSampler:jo,bindCanvasToFramebuffer:function(e,t){vo(e,t,function(){return e.bindFramebuffer(e.FRAMEBUFFER,null)}),vo(e,t,function(){return e.viewport(0,0,e.canvas.width,e.canvas.height)}),vo(e,t,function(){return e.scissor(0,0,e.canvas.width,e.canvas.height)})},bindColorTextureToFramebuffer:Bo,unbindColorTextureFromFramebuffer:zo,validateFramebuffer:Uo,getFramebufferErrorMessage:Wo,getBatchDim:Go,getRowsCols:qo,getShapeAs3D:Ko,getTextureShapeFromLogicalShape:Xo,isReshapeFree:$o,getWebGLMaxTextureSize:Jo,resetMaxTextureSize:function(){So=null},resetMaxTexturesInShader:function(){No=null},getMaxTexturesInShader:Qo,getWebGLDisjointQueryTimerVersion:Zo,hasExtension:es,isWebGLVersionEnabled:ts,isCapableOfRenderingToFloatTexture:ns,isDownloadFloatTextureEnabled:rs,isWebGLFenceEnabled:is}),ss=Da();function cs(e){Da().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(e+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function ls(e,t){return no.tidy(e,t)}function us(e){Qi(e).forEach(function(e){return e.dispose()})}function hs(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];Da().getBool("IS_TEST")||console.warn.apply(console,e)}function ds(e,t){var n=e;if(hi(e))return"string"===t?[]:[e.length];if(!Array.isArray(e))return[];for(var r=[];Array.isArray(n)||hi(n)&&"string"!==t;)r.push(n.length),n=n[0];return Array.isArray(e)&&Da().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&function e(t,n,r){if(r=r||[],Array.isArray(t)||hi(t)){qa(n.length>0,function(){return"Element arr["+r.join("][")+"] should be a primitive, but is an array of "+t.length+" elements"}),qa(t.length===n[0],function(){return"Element arr["+r.join("][")+"] should have "+n[0]+" elements, but has "+t.length+" elements"});for(var a=n.slice(1),i=0;i<t.length;++i)e(t[i],a,r.concat(i))}else qa(0===n.length,function(){return"Element arr["+r.join("][")+"] is a primitive, but should be an array/TypedArray of "+n[0]+" elements"})}(e,r,[]),r}function fs(e,t,n,r){if(null!=e&&("numeric"!==e&&e!==t||"numeric"===e&&"string"===t))throw new Error("Argument '"+n+"' passed to '"+r+"' must be "+e+" tensor, but got "+t+" tensor")}function ps(e,t,n,r){if(void 0===r&&(r="numeric"),e instanceof zi)return fs(r,e.dtype,t,n),e;var a=vi(e);if("string"!==a&&["bool","int32","float32"].indexOf(r)>=0&&(a=r),fs(r,a,t,n),null==e||!hi(e)&&!Array.isArray(e)&&"number"!=typeof e&&"boolean"!=typeof e&&"string"!=typeof e){var i=null==e?"null":e.constructor.name;throw new Error("Argument '"+t+"' passed to '"+n+"' must be a Tensor or TensorLike, but got '"+i+"'")}var o=ds(e,a);hi(e)||Array.isArray(e)||(e=[e]);var s="string"!==a?wi(e,a,Da().getBool("DEBUG")):Ya(e,[],!0);return no.makeTensor(s,o,a)}function ms(e,t,n,r){if(void 0===r&&(r="numeric"),!Array.isArray(e))throw new Error("Argument "+t+" passed to "+n+" must be a `Tensor[]` or `TensorLike[]`");return e.map(function(e,r){return ps(e,t+"["+r+"]",n)},r)}function gs(e,t){for(var n=0;n<e.length;++n)if(e[e.length-n-1]!==t-1-n)return!1;return!0}function vs(e,t,n){for(var r=e.length+t.length,a=[],i=0,o=0,s=0;s<r;s++)-1===n.indexOf(s)?a.push(e[i++]):a.push(t[o++]);return a}function bs(e,t){for(var n=[],r=e.length,a=0;a<r;a++)-1===t.indexOf(a)&&n.push(e[a]);return[n,t.map(function(t){return e[t]})]}function ys(e,t){return vs(e,t.map(function(e){return 1}),t)}function xs(e,t,n){qa(gs(t,n),function(){return e+" supports only inner-most axes for now. Got axes "+t+" and rank-"+n+" input."})}function ws(e,t){if(gs(e,t))return null;for(var n=[],r=0;r<t;++r)-1===e.indexOf(r)&&n.push(r);return e.forEach(function(e){return n.push(e)}),n}function ks(e){return e.map(function(e,t){return[t,e]}).sort(function(e,t){return e[1]-t[1]}).map(function(e){return e[0]})}function Ss(e,t){for(var n=[],r=t-e;r<t;++r)n.push(r);return n}function Ns(e,t){var n=e[0].length;e.forEach(function(e,t){qa(e.length===n,function(){return"Error in concat"+n+"D: rank of tensors["+t+"] must be the same as the rank of the rest ("+n+")"})}),qa(t>=0&&t<n,function(){return"Error in concat"+n+"D: axis must be between 0 and "+(n-1)+"."});var r=e[0];e.forEach(function(e,a){for(var i=0;i<n;i++)qa(i===t||e[i]===r[i],function(){return"Error in concat"+n+"D: Shape of tensors["+a+"] ("+e+") does not match the shape of the rest ("+r+") along the non-concatenated axis "+a+"."})})}function Cs(e,t){for(var n=e[0].slice(),r=1;r<e.length;r++)n[t]+=e[r][t];return n}function Es(e){var t=Object.keys(e);if(1!==t.length)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+t.length+" keys.");var n=t[0],r=e[n];n.endsWith("_")&&(n=n.substring(0,n.length-1));var a=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];no.startScope(n);try{var a=r.apply(void 0,e);return a instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),no.endScope(a),a}catch(e){throw no.endScope(null),e}};return Object.defineProperty(a,"name",{value:n,configurable:!0}),a}ss.registerFlag("HAS_WEBGL",function(){return ss.getNumber("WEBGL_VERSION")>0}),ss.registerFlag("WEBGL_VERSION",function(){return ts(2)?2:ts(1)?1:0}),ss.registerFlag("WEBGL_BUFFER_SUPPORTED",function(){return 2===ss.get("WEBGL_VERSION")}),ss.registerFlag("WEBGL_CPU_FORWARD",function(){return!0}),ss.registerFlag("WEBGL_FORCE_F16_TEXTURES",function(){return!1}),ss.registerFlag("WEBGL_PACK",function(){return ss.getBool("HAS_WEBGL")}),ss.registerFlag("WEBGL_PACK_NORMALIZATION",function(){return ss.getBool("WEBGL_PACK")}),ss.registerFlag("WEBGL_PACK_CLIP",function(){return ss.getBool("WEBGL_PACK")}),ss.registerFlag("WEBGL_PACK_DEPTHWISECONV",function(){return!1}),ss.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",function(){return ss.getBool("WEBGL_PACK")}),ss.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",function(){return ss.getBool("WEBGL_PACK")}),ss.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",function(){return ss.getBool("WEBGL_PACK")}),ss.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",function(){return ss.getBool("WEBGL_PACK")}),ss.registerFlag("WEBGL_PACK_REDUCE",function(){return ss.getBool("WEBGL_PACK")}),ss.registerFlag("WEBGL_LAZILY_UNPACK",function(){return ss.getBool("WEBGL_PACK")}),ss.registerFlag("WEBGL_CONV_IM2COL",function(){return ss.getBool("WEBGL_PACK")}),ss.registerFlag("WEBGL_MAX_TEXTURE_SIZE",function(){return Jo(ss.getNumber("WEBGL_VERSION"))}),ss.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",function(){return Qo(ss.getNumber("WEBGL_VERSION"))}),ss.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",function(){var e=ss.getNumber("WEBGL_VERSION");return 0===e?0:Zo(e)}),ss.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",function(){return ss.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&(e=navigator.userAgent||navigator.vendor||window.opera,!(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))));var e}),ss.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",function(){return ns(ss.getNumber("WEBGL_VERSION"))}),ss.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",function(){return!ss.getBool("WEBGL_FORCE_F16_TEXTURES")&&ss.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")}),ss.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",function(){return rs(ss.getNumber("WEBGL_VERSION"))}),ss.registerFlag("WEBGL_FENCE_API_ENABLED",function(){return is(ss.getNumber("WEBGL_VERSION"))}),ss.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",function(){return ss.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0}),Bi=cs;var Is=Es({complex_:function(e,t){var n=ps(e,"real","complex"),r=ps(t,"imag","complex");return Ka(n.shape,r.shape,"real and imag shapes, "+n.shape+" and "+r.shape+", must match in call to tf.complex()."),no.runKernelFunc(function(e){return e.complex(n,r)},{$real:n,$imag:r})}}),Ts=Es({real_:function(e){var t=ps(e,"input","real");return no.runKernelFunc(function(e){return e.real(t)},{$input:t})}}),_s=Es({imag_:function(e){var t=ps(e,"input","imag");return no.runKernelFunc(function(e){return e.imag(t)},{$input:t})}});function As(e,t,n){return Rs(e,t,ds(e,n),n)}function Rs(e,t,n,r){if(null==r&&(r=vi(e)),"complex64"===r)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!hi(e)&&!Array.isArray(e)&&"number"!=typeof e&&"boolean"!=typeof e&&"string"!=typeof e)throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(null!=t){Ei(t);var a=$a(t),i=$a(n);qa(a===i,function(){return"Based on the provided shape, ["+t+"], the tensor should have "+a+" values but has "+i});for(var o=0;o<n.length;++o){var s=n[o],c=o!==n.length-1||s!==$a(t.slice(o));qa(n[o]===t[o]||!c,function(){return"Error creating a new Tensor. Inferred shape ("+n+") does not match the provided shape ("+t+"). "})}}return hi(e)||Array.isArray(e)||(e=[e]),t=t||n,e="string"!==r?wi(e,r,Da().getBool("DEBUG")):Ya(e,[],!0),no.makeTensor(e,t,r)}function Fs(e,t){if((hi(e)&&"string"!==t||Array.isArray(e))&&"complex64"!==t)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if("string"===t&&hi(e)&&!(e instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return Rs(e,[],[],t)}function Ds(e,t){Xa(e);var n=ds(e,t);if(1!==n.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");return Rs(e,null,n,t)}function Os(e,t,n){if(Xa(e),null!=t&&2!==t.length)throw new Error("tensor2d() requires shape to have two numbers");var r=ds(e,n);if(2!==r.length&&1!==r.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return Rs(e,t,r,n)}function Ls(e,t,n){if(Xa(e),null!=t&&3!==t.length)throw new Error("tensor3d() requires shape to have three numbers");var r=ds(e,n);if(3!==r.length&&1!==r.length)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return Rs(e,t,r,n)}function Ps(e,t,n){if(Xa(e),null!=t&&4!==t.length)throw new Error("tensor4d() requires shape to have four numbers");var r=ds(e,n);if(4!==r.length&&1!==r.length)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return Rs(e,t,r,n)}function Ms(e,t){if(void 0===t&&(t="float32"),"complex64"===t){var n=Ms(e,"float32"),r=js(e,"float32");return Is(n,r)}var a=Si($a(e),t);return no.makeTensor(a,e,t)}function js(e,t){if(void 0===t&&(t="float32"),"complex64"===t){var n=js(e,"float32"),r=js(e,"float32");return Is(n,r)}var a=Ni($a(e),t);return no.makeTensor(a,e,t)}function Bs(e,t,n){return no.runKernelFunc(function(r){return r.fill(e,t,n)},{})}function zs(e,t,n,r){if(void 0===n&&(n=1),void 0===r&&(r="float32"),0===n)throw new Error("Cannot have a step of zero");if(e===t||e<t&&n<0||t<e&&n>1)return js([0],r);var a=Ni(Math.abs(Math.ceil((t-e)/n)),r);t<e&&1===n&&(n=-1),a[0]=e;for(var i=1;i<a.length;i++)a[i]=a[i-1]+n;return Ds(a,r)}var Us=Es({onesLike_:function(e){var t=ps(e,"x","onesLike");if("complex64"===t.dtype){var n=Us(Ts(t)),r=Ws(_s(t));return Is(n,r)}return no.runKernelFunc(function(e){return e.onesLike(t)},{$x:t},function(e,t){return{$x:function(){return Ws(e)}}})}}),Ws=Es({zerosLike_:function(e){var t=ps(e,"x","zerosLike");return no.runKernelFunc(function(e){return e.zerosLike(t)},{$x:t},function(e,t){return{$x:function(){return Ws(e)}}})}}),Vs=Es({concat_:function(e,t){void 0===t&&(t=0),qa(e.length>=1,function(){return"Pass at least one tensor to concat"});var n=ms(e,"tensors","concat");"complex64"===n[0].dtype&&n.forEach(function(e){if("complex64"!==e.dtype)throw new Error("Cannot concatenate complex64 tensors with a tensor\n          with dtype "+e.dtype+". ")}),t=ai(t,n[0].shape)[0];var r=Cs(n.map(function(e){return e.shape}),t);if(0===$a(r))return As([],r);if(1===(n=n.filter(function(e){return e.size>0})).length)return n[0];var a=n.map(function(e){return e.shape});Ns(a,t);var i=n,o={axis:t};return no.runKernelFunc(function(e){return e.concat(n,t)},i,function(e){var n=a.map(function(e){return e[t]});return Xs(e,n,t).map(function(e){return function(){return e}})},"Concat",o)}}),Hs=Es({concat1d_:function(e){return Vs(e,0)}}),Gs=Es({concat2d_:function(e,t){return Vs(e,t)}}),qs=Es({concat3d_:function(e,t){return Vs(e,t)}}),Ks=Es({concat4d_:function(e,t){return Vs(e,t)}}),Xs=Es({split_:function(e,t,n){void 0===n&&(n=0);var r,a=ps(e,"x","split");return n=ai(n,a.shape)[0],"number"==typeof t?(qa(a.shape[n]%t==0,function(){return"Number of splits must evenly divide the axis."}),r=new Array(t).fill(a.shape[n]/t)):(qa(a.shape[n]===t.reduce(function(e,t){return e+t}),function(){return"The sum of sizes must match the size of the axis dimension."}),r=t),no.runKernelFunc(function(e){return e.split(a,r,n)},{$x:a},function(e){return{$x:function(){return Vs(e,n)}}})}});function Ys(e,t){return e(t={exports:{}},t.exports),t.exports}"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof n.g?n.g:"undefined"!=typeof self&&self;var $s=Ys(function(e){!function(e,t){function n(e){var t,n=this,r=(t=4022871197,function(e){e=e.toString();for(var n=0;n<e.length;n++){var r=.02519603282416938*(t+=e.charCodeAt(n));r-=t=r>>>0,t=(r*=t)>>>0,t+=4294967296*(r-=t)}return 2.3283064365386963e-10*(t>>>0)});n.next=function(){var e=2091639*n.s0+2.3283064365386963e-10*n.c;return n.s0=n.s1,n.s1=n.s2,n.s2=e-(n.c=0|e)},n.c=1,n.s0=r(" "),n.s1=r(" "),n.s2=r(" "),n.s0-=r(e),n.s0<0&&(n.s0+=1),n.s1-=r(e),n.s1<0&&(n.s1+=1),n.s2-=r(e),n.s2<0&&(n.s2+=1),r=null}function r(e,t){return t.c=e.c,t.s0=e.s0,t.s1=e.s1,t.s2=e.s2,t}function a(e,t){var a=new n(e),i=t&&t.state,o=a.next;return o.int32=function(){return 4294967296*a.next()|0},o.double=function(){return o()+11102230246251565e-32*(2097152*o()|0)},o.quick=o,i&&("object"==typeof i&&r(i,a),o.state=function(){return r(a,{})}),o}t&&t.exports?t.exports=a:this.alea=a}(0,e)}),Js=Ys(function(e){!function(e,t){function n(e){var t=this,n="";t.x=0,t.y=0,t.z=0,t.w=0,t.next=function(){var e=t.x^t.x<<11;return t.x=t.y,t.y=t.z,t.z=t.w,t.w^=t.w>>>19^e^e>>>8},e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),t.next()}function r(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t}function a(e,t){var a=new n(e),i=t&&t.state,o=function(){return(a.next()>>>0)/4294967296};return o.double=function(){do{var e=((a.next()>>>11)+(a.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},o.int32=a.next,o.quick=o,i&&("object"==typeof i&&r(i,a),o.state=function(){return r(a,{})}),o}t&&t.exports?t.exports=a:this.xor128=a}(0,e)}),Qs=Ys(function(e){!function(e,t){function n(e){var t=this,n="";t.next=function(){var e=t.x^t.x>>>2;return t.x=t.y,t.y=t.z,t.z=t.w,t.w=t.v,(t.d=t.d+362437|0)+(t.v=t.v^t.v<<4^e^e<<1)|0},t.x=0,t.y=0,t.z=0,t.w=0,t.v=0,e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),r==n.length&&(t.d=t.x<<10^t.x>>>4),t.next()}function r(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t.v=e.v,t.d=e.d,t}function a(e,t){var a=new n(e),i=t&&t.state,o=function(){return(a.next()>>>0)/4294967296};return o.double=function(){do{var e=((a.next()>>>11)+(a.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},o.int32=a.next,o.quick=o,i&&("object"==typeof i&&r(i,a),o.state=function(){return r(a,{})}),o}t&&t.exports?t.exports=a:this.xorwow=a}(0,e)}),Zs=Ys(function(e){!function(e,t){function n(e){var t=this;t.next=function(){var e,n,r=t.x,a=t.i;return e=r[a],n=(e^=e>>>7)^e<<24,n^=(e=r[a+1&7])^e>>>10,n^=(e=r[a+3&7])^e>>>3,n^=(e=r[a+4&7])^e<<7,e=r[a+7&7],n^=(e^=e<<13)^e<<9,r[a]=n,t.i=a+1&7,n},function(e,t){var n,r=[];if(t===(0|t))r[0]=t;else for(t=""+t,n=0;n<t.length;++n)r[7&n]=r[7&n]<<15^t.charCodeAt(n)+r[n+1&7]<<13;for(;r.length<8;)r.push(0);for(n=0;n<8&&0===r[n];++n);for(8==n?r[7]=-1:r[n],e.x=r,e.i=0,n=256;n>0;--n)e.next()}(t,e)}function r(e,t){return t.x=e.x.slice(),t.i=e.i,t}function a(e,t){null==e&&(e=+new Date);var a=new n(e),i=t&&t.state,o=function(){return(a.next()>>>0)/4294967296};return o.double=function(){do{var e=((a.next()>>>11)+(a.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},o.int32=a.next,o.quick=o,i&&(i.x&&r(i,a),o.state=function(){return r(a,{})}),o}t&&t.exports?t.exports=a:this.xorshift7=a}(0,e)}),ec=Ys(function(e){!function(e,t){function n(e){var t=this;t.next=function(){var e,n,r=t.w,a=t.X,i=t.i;return t.w=r=r+1640531527|0,n=a[i+34&127],e=a[i=i+1&127],n^=n<<13,e^=e<<17,n^=n>>>15,e^=e>>>12,n=a[i]=n^e,t.i=i,n+(r^r>>>16)|0},function(e,t){var n,r,a,i,o,s=[],c=128;for(t===(0|t)?(r=t,t=null):(t+="\0",r=0,c=Math.max(c,t.length)),a=0,i=-32;i<c;++i)t&&(r^=t.charCodeAt((i+32)%t.length)),0===i&&(o=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,i>=0&&(o=o+1640531527|0,a=0==(n=s[127&i]^=r+o)?a+1:0);for(a>=128&&(s[127&(t&&t.length||0)]=-1),a=127,i=512;i>0;--i)r=s[a+34&127],n=s[a=a+1&127],r^=r<<13,n^=n<<17,r^=r>>>15,n^=n>>>12,s[a]=r^n;e.w=o,e.X=s,e.i=a}(t,e)}function r(e,t){return t.i=e.i,t.w=e.w,t.X=e.X.slice(),t}function a(e,t){null==e&&(e=+new Date);var a=new n(e),i=t&&t.state,o=function(){return(a.next()>>>0)/4294967296};return o.double=function(){do{var e=((a.next()>>>11)+(a.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},o.int32=a.next,o.quick=o,i&&(i.X&&r(i,a),o.state=function(){return r(a,{})}),o}t&&t.exports?t.exports=a:this.xor4096=a}(0,e)}),tc=Ys(function(e){!function(e,t){function n(e){var t=this,n="";t.next=function(){var e=t.b,n=t.c,r=t.d,a=t.a;return e=e<<25^e>>>7^n,n=n-r|0,r=r<<24^r>>>8^a,a=a-e|0,t.b=e=e<<20^e>>>12^n,t.c=n=n-r|0,t.d=r<<16^n>>>16^a,t.a=a-e|0},t.a=0,t.b=0,t.c=-1640531527,t.d=1367130551,e===Math.floor(e)?(t.a=e/4294967296|0,t.b=0|e):n+=e;for(var r=0;r<n.length+20;r++)t.b^=0|n.charCodeAt(r),t.next()}function r(e,t){return t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t}function a(e,t){var a=new n(e),i=t&&t.state,o=function(){return(a.next()>>>0)/4294967296};return o.double=function(){do{var e=((a.next()>>>11)+(a.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},o.int32=a.next,o.quick=o,i&&("object"==typeof i&&r(i,a),o.state=function(){return r(a,{})}),o}t&&t.exports?t.exports=a:this.tychei=a}(0,e)}),nc=Ys(function(e){!function(t,r){var a,i=this,o=256,s="random",c=r.pow(o,6),l=r.pow(2,52),u=2*l,h=255;function d(e,n,h){var d=[],v=m(function e(t,n){var r,a=[],i=typeof t;if(n&&"object"==i)for(r in t)try{a.push(e(t[r],n-1))}catch(e){}return a.length?a:"string"==i?t:t+"\0"}((n=1==n?{entropy:!0}:n||{}).entropy?[e,g(t)]:null==e?function(){try{var e;return a&&(e=a.randomBytes)?e=e(o):(e=new Uint8Array(o),(i.crypto||i.msCrypto).getRandomValues(e)),g(e)}catch(e){var n=i.navigator,r=n&&n.plugins;return[+new Date,i,r,i.screen,g(t)]}}():e,3),d),b=new f(d),y=function(){for(var e=b.g(6),t=c,n=0;e<l;)e=(e+n)*o,t*=o,n=b.g(1);for(;e>=u;)e/=2,t/=2,n>>>=1;return(e+n)/t};return y.int32=function(){return 0|b.g(4)},y.quick=function(){return b.g(4)/4294967296},y.double=y,m(g(b.S),t),(n.pass||h||function(e,t,n,a){return a&&(a.S&&p(a,b),e.state=function(){return p(b,{})}),n?(r[s]=e,t):e})(y,v,"global"in n?n.global:this==r,n.state)}function f(e){var t,n=e.length,r=this,a=0,i=r.i=r.j=0,s=r.S=[];for(n||(e=[n++]);a<o;)s[a]=a++;for(a=0;a<o;a++)s[a]=s[i=h&i+e[a%n]+(t=s[a])],s[i]=t;(r.g=function(e){for(var t,n=0,a=r.i,i=r.j,s=r.S;e--;)t=s[a=h&a+1],n=n*o+s[h&(s[a]=s[i=h&i+t])+(s[i]=t)];return r.i=a,r.j=i,n})(o)}function p(e,t){return t.i=e.i,t.j=e.j,t.S=e.S.slice(),t}function m(e,t){for(var n,r=e+"",a=0;a<r.length;)t[h&a]=h&(n^=19*t[h&a])+r.charCodeAt(a++);return g(t)}function g(e){return String.fromCharCode.apply(0,e)}if(r["seed"+s]=d,m(r.random(),t),e.exports){e.exports=d;try{a=n(385)}catch(e){}}}([],Math)});nc.alea=$s,nc.xor128=Js,nc.xorwow=Qs,nc.xorshift7=Zs,nc.xor4096=ec,nc.tychei=tc;var rc=nc.alea,ac=function(){function e(e,t,n,r,a){this.mean=e,this.stdDev=t,this.dtype=n,this.nextVal=NaN,this.truncated=r,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var i=a||Math.random();this.random=rc(i.toString())}return e.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var e=this.nextVal;return this.nextVal=NaN,e}for(var t,n,r=!1;!r;){var a=void 0,i=void 0,o=void 0;do{o=(a=2*this.random()-1)*a+(i=2*this.random()-1)*i}while(o>=1||0===o);var s=Math.sqrt(-2*Math.log(o)/o);t=this.mean+this.stdDev*a*s,n=this.mean+this.stdDev*i*s,this.truncated&&!this.isValidTruncated(t)||(r=!0)}return this.truncated&&!this.isValidTruncated(n)||(this.nextVal=this.convertValue(n)),this.convertValue(t)},e.prototype.convertValue=function(e){return null==this.dtype||"float32"===this.dtype?e:Math.round(e)},e.prototype.isValidTruncated=function(e){return e<=this.upper&&e>=this.lower},e}(),ic=function(){function e(e,t,n,r){this.alpha=e,this.beta=1/t,this.dtype=n;var a=r||Math.random();this.randu=rc(a.toString()),this.randn=new ac(0,1,n,!1,this.randu()),this.d=e<1?e+2/3:e-1/3,this.c=1/Math.sqrt(9*this.d)}return e.prototype.nextValue=function(){for(var e,t,n,r,a,i;;){do{r=this.randn.nextValue(),i=1+this.c*r}while(i<=0);if(i*=i*i,t=1-.331*(e=r*r)*e,n=.5*e+this.d*(1-i+Math.log(i)),(a=this.randu())<t||Math.log(a)<n)break}return i=1/this.beta*this.d*i,this.alpha<1&&(i*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(i)},e.prototype.convertValue=function(e){return"float32"===this.dtype?e:Math.round(e)},e}(),oc=function(){function e(e,t,n,r){var a=this;if(void 0===e&&(e=0),void 0===t&&(t=1),this.canReturnFloat=function(){return null==a.dtype||"float32"===a.dtype},this.min=e,this.range=t-e,this.dtype=n,null==r&&(r=Math.random()),"number"==typeof r&&(r=r.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between "+e+" - "+t+" <= 1 and dtype is not float");this.random=rc(r)}return e.prototype.convertValue=function(e){return this.canReturnFloat()?e:Math.round(e)},e.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},e}();function sc(e,t,n){return void 0===t&&(t="float32"),t=t||"float32",Ei(e),new Pi(e,t,n)}var cc=Es({batchToSpaceND_:function(e,t,n){var r=ps(e,"x","batchToSpaceND"),a=t.reduce(function(e,t){return e*t});return qa(r.rank>=1+t.length,function(){return"input rank is "+r.rank+" but should be > than blockShape.length "+t.length}),qa(n.length===t.length,function(){return"crops.length is "+n.length+" but should be equal to blockShape.length  "+t.length}),qa(r.shape[0]%a==0,function(){return"input tensor batch is "+r.shape[0]+" but is not divisible by the product of the elements of blockShape "+t.join(" * ")+" === "+a}),no.runKernelFunc(function(e){return e.batchToSpaceND(r,t,n)},{$x:r},function(e){return{$x:function(){return e.spaceToBatchND(t,n)}}})}}),lc=Es({broadcastTo_:function(e,t){var n=ps(e,"broadcastTo","x"),r=n.shape;if(t.some(function(e){return!(e>0)||e%1!=0}))throw new Error("broadcastTo(): Invalid broadcast shape ["+t+"].");if(t.length<n.rank)throw new Error("broadcastTo(): shape.length="+t.length+" < input.rank="+n.rank+".");if(t.length>n.rank){for(var a=n.shape.slice();a.length<t.length;)a.unshift(1);n=n.reshape(a)}for(var i=Array.from(t),o=t.length-1;o>=0;o--)if(n.shape[o]===t[o])i[o]=1;else if(1!==n.shape[o])throw new Error("broadcastTo(): ["+r+"] cannot be broadcast to ["+t+"].");var s=i.map(function(e,t){return e>1?t:-1}).filter(function(e){return e>=0});return 0===s.length?n.clone():no.runKernelFunc(function(e){return e.tile(n,i)},{input:n},function(e){return{input:function(){return e.sum(s,!0)}}})}}),uc=Es({cast_:function(e,t){var n=ps(e,"x","cast");if(!li(t))throw new Error("Failed to cast to unknown dtype "+t);if("string"===t&&"string"!==n.dtype||"string"!==t&&"string"===n.dtype)throw new Error("Only strings can be casted to strings");var r={dtype:t};return no.runKernelFunc(function(e){return e.cast(n,t)},{x:n},function(e){return{x:function(){return e.clone()}}},"Cast",r)}}),hc=Es({clone_:function(e){var t=ps(e,"x","clone",null);return no.runKernelFunc(function(){return no.makeTensorFromDataId(t.dataId,t.shape,t.dtype)},{$x:t},function(e){return{$x:function(){return e.toFloat()}}})}}),dc=Es({cumsum_:function(e,t,n,r){void 0===t&&(t=0),void 0===n&&(n=!1),void 0===r&&(r=!1);var a=ps(e,"x","cumsum"),i=ws([t|=0],a.rank),o=a;null!=i&&(o=a.transpose(i));var s=Ss(1,a.rank)[0],c=no.runKernelFunc(function(e){return e.cumsum(o,s,n,r)},{permutedX:o},function(e){return{permutedX:function(){return e.cumsum(t,n,!r)}}});return null!=i&&(c=c.transpose(i)),c}}),fc=Es({depthToSpace_:function(e,t,n){void 0===n&&(n="NHWC");var r=ps(e,"x","depthToSpace"),a="NHWC"===n?r.shape[1]:r.shape[2],i="NHWC"===n?r.shape[2]:r.shape[3],o="NHWC"===n?r.shape[3]:r.shape[1];return qa(a*t>=0,function(){return"Negative dimension size caused by overflow when multiplying\n      "+a+" and "+t+"  for depthToSpace with input shape\n      "+r.shape}),qa(i*t>=0,function(){return"Negative dimension size caused by overflow when multiplying\n      "+i+" and "+t+" for depthToSpace with input shape\n          "+r.shape}),qa(o%(t*t)==0,function(){return"Dimension size must be evenly divisible by "+t*t+" but is "+o+" for depthToSpace with input shape "+r.shape}),no.runKernelFunc(function(e){return e.depthToSpace(r,t,n)},{$x:r})}}),pc=Es({expandDims_:function(e,t){void 0===t&&(t=0);var n=ps(e,"x","expandDims",null);qa(t<=n.rank,function(){return"Axis must be <= rank of the tensor"});var r=n.shape.slice();return t<0&&(qa(-(n.rank+1)<=t,function(){return"Axis must be in the interval ["+-(n.rank+1)+", "+n.rank+"]"}),t=n.rank+t+1),r.splice(t,0,1),Ic(n,r)}}),mc=Es({eye_:function(e,t,n,r){void 0===r&&(r="float32"),null==t&&(t=e);for(var a=sc([e,t],r),i=e<=t?e:t,o=0;o<i;++o)a.set(1,o,o);var s=a.toTensor().as2D(e,t);if(null==n)return s;if(1===n.length)return Rc(pc(s,0),[n[0],1,1]);if(2===n.length)return Rc(pc(pc(s,0),0),[n[0],n[1],1,1]);if(3===n.length)return Rc(pc(pc(pc(s,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+n.length+"D.")}}),gc=Es({multinomial_:function(e,t,n,r){void 0===r&&(r=!1);var a=ps(e,"logits","multinomial"),i=a.size,o=a.rank;if(i<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+i+".");if(o>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+o);n=n||Math.random();var s=1===o?a.as2D(1,-1):a,c=no.runKernelFunc(function(e){return e.multinomial(s,r,t,n)},{logits2D:s});return 1===o?c.as1D():c}}),vc=Es({oneHot_:function(e,t,n,r){if(void 0===n&&(n=1),void 0===r&&(r=0),t<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+t);var a=ps(e,"indices","oneHot","int32"),i=a.shape.concat([t]);return a=a.flatten(),no.runKernelFunc(function(e){return e.oneHot(a,t,n,r)},{$indices:a},function(e){return{$indices:function(){return js(a.shape,"float32")}}}).reshape(i)}}),bc=Es({pad_:function(e,t,n){void 0===n&&(n=0);var r=ps(e,"x","pad");if(0===r.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var a={paddings:t,constantValue:n};return no.runKernelFunc(function(e){return e.pad(r,t,n)},{x:r},function(e){var n=t.map(function(e){return e[0]});return{x:function(){return e.slice(n,r.shape)}}},"PadV2",a)}}),yc=Es({pad1d_:function(e,t,n){return void 0===n&&(n=0),qa(2===t.length,function(){return"Invalid number of paddings. Must be length of 2."}),bc(e,[t],n)}}),xc=Es({pad2d_:function(e,t,n){return void 0===n&&(n=0),qa(2===t.length&&2===t[0].length&&2===t[1].length,function(){return"Invalid number of paddings. Must be length of 2 each."}),bc(e,t,n)}}),wc=Es({pad3d_:function(e,t,n){return void 0===n&&(n=0),qa(3===t.length&&2===t[0].length&&2===t[1].length&&2===t[2].length,function(){return"Invalid number of paddings. Must be length of 2 each."}),bc(e,t,n)}}),kc=Es({pad4d_:function(e,t,n){return void 0===n&&(n=0),qa(4===t.length&&2===t[0].length&&2===t[1].length&&2===t[2].length&&2===t[3].length,function(){return"Invalid number of paddings. Must be length of 2 each."}),bc(e,t,n)}}),Sc=Es({rand_:function(e,t,n){var r=$a(e),a=null;if(null==n||"float32"===n)a=new Float32Array(r);else if("int32"===n)a=new Int32Array(r);else{if("bool"!==n)throw new Error("Unknown data type "+n);a=new Uint8Array(r)}for(var i=0;i<r;i++)a[i]=t();return no.makeTensor(a,e,n)}}),Nc=Es({randomNormal_:function(e,t,n,r,a){if(void 0===t&&(t=0),void 0===n&&(n=1),null!=r&&"bool"===r)throw new Error("Unsupported data type "+r);for(var i=new ac(t,n,r,!1,a),o=sc(e,r),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}}),Cc=Es({randomGamma_:function(e,t,n,r,a){if(void 0===n&&(n=1),void 0===r&&(r="float32"),null==n&&(n=1),null==r&&(r="float32"),"float32"!==r&&"int32"!==r)throw new Error("Unsupported data type "+r);for(var i=new ic(t,n,r,a),o=sc(e,r),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}}),Ec=Es({randomUniform_:function(e,t,n,r,a){void 0===t&&(t=0),void 0===n&&(n=1),void 0===r&&(r="float32");for(var i=sc(e,r),o=new oc(t,n,null,a),s=0;s<i.values.length;s++)i.values[s]=o.nextValue();return i.toTensor()}}),Ic=Es({reshape_:function(e,t){var n=ps(e,"x","reshape",null);t=ri(t,n.size),qa(n.size===$a(t),function(){return"new shape and old shape must have the same number of elements."});var r={shape:t};return no.runKernelFunc(function(e){return e.reshape(n,t)},{x:n},function(e){return{x:function(){return e.reshape(n.shape)}}},"Reshape",r)}}),Tc=Es({spaceToBatchND_:function(e,t,n){var r=ps(e,"x","spaceToBatchND");return qa(r.rank>=1+t.length,function(){return"input rank "+r.rank+" should be > than [blockShape] "+t.length}),qa(n.length===t.length,function(){return"paddings.shape[0] "+n.length+" must be equal to [blockShape] "+t.length}),qa(r.shape.reduce(function(e,r,a){return a>0&&a<=t.length?e&&(r+n[a-1][0]+n[a-1][1])%t[a-1]==0:e},!0),function(){return"input spatial dimensions "+r.shape.slice(1)+" with paddings "+n.toString()+" must be divisible by blockShapes "+t.toString()}),no.runKernelFunc(function(e){return e.spaceToBatchND(r,t,n)},{$x:r},function(e){return{$x:function(){return e.batchToSpaceND(t,n)}}})}}),_c=Es({squeeze_:function(e,t){var n=ps(e,"x","squeeze");return Ic(n,ii(n.shape,t).newShape)}}),Ac=Es({stack_:function(e,t){void 0===t&&(t=0);var n=ms(e,"tensors","stack");if(qa(n.length>=1,function(){return"Pass at least one tensor to tf.stack"}),1===n.length)return n[0].expandDims(t);var r=n[0].rank,a=n[0].shape,i=n[0].dtype;qa(t<=r,function(){return"Axis must be <= rank of the tensor"}),n.forEach(function(e){Ka(a,e.shape,"All tensors passed to stack must have matching shapes")}),n.forEach(function(e){qa(i===e.dtype,function(){return"All tensors passed to stack must have matching dtypes"})});var o=n.map(function(e){return e.expandDims(t)});return Vs(o,t)}}),Rc=Es({tile_:function(e,t){var n=ps(e,"x","tile",null);qa(n.rank===t.length,function(){return"Error in transpose: rank of input "+n.rank+" must match length of reps "+t+"."});var r=[n],a={reps:t};return no.runKernelFunc(function(e,r){var a=e.tile(n,t);return r([n]),a},{x:n},function(e,n){var r=n[0];return{x:function(){var n=Ws(r);if(1===r.rank)for(var a=0;a<t[0];++a)n=n.add(e.slice([a*r.shape[0]],[r.shape[0]]));else if(2===r.rank)for(a=0;a<t[0];++a)for(var i=0;i<t[1];++i)n=n.add(e.slice([a*r.shape[0],i*r.shape[1]],[r.shape[0],r.shape[1]]));else if(3===r.rank)for(a=0;a<t[0];++a)for(i=0;i<t[1];++i)for(var o=0;o<t[2];++o)n=n.add(e.slice([a*r.shape[0],i*r.shape[1],o*r.shape[2]],[r.shape[0],r.shape[1],r.shape[2]]));else{if(4!==r.rank)throw new Error("Gradient for tile operation is not implemented for rank-"+r.rank+" tensors yet.");for(a=0;a<t[0];++a)for(i=0;i<t[1];++i)for(o=0;o<t[2];++o)for(var s=0;s<t[3];++s)n=n.add(e.slice([a*r.shape[0],i*r.shape[1],o*r.shape[2],s*r.shape[3]],[r.shape[0],r.shape[1],r.shape[2],r.shape[3]]))}return n}}},"Tile",a,r)}}),Fc=Es({truncatedNormal_:function(e,t,n,r,a){if(void 0===t&&(t=0),void 0===n&&(n=1),null!=r&&"bool"===r)throw new Error("Unsupported data type "+r);for(var i=new ac(t,n,r,!0,a),o=sc(e,r),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}}),Dc=Es({unstack_:function(e,t){void 0===t&&(t=0),t=t||0;var n=ps(e,"x","unstack");qa(t>=-n.shape.length&&t<n.shape.length,function(){return"Axis = "+t+" is not in [-"+n.shape.length+", "+n.shape.length+")"}),t<0&&(t+=n.shape.length);var r={axis:t};return no.runKernelFunc(function(e){return e.unstack(n,t)},{x:n},function(e){return{x:function(){return Ac(e,t)}}},"Unpack",r)}});function Oc(e,t,n,r){void 0===r&&(r=!0);var a=[];if(r)(a=a.concat(t.slice(0))).push(e[0]/n),a=a.concat(e.slice(1));else{a=a.concat(e[0]);for(var i=t.length,o=0;o<i;++o)a=a.concat([e[o+1]/t[o],t[o]]);a=a.concat(e.slice(i+1))}return a}function Lc(e,t,n){void 0===n&&(n=!0);var r=[];if(n){r.push(t);for(var a=t+1;a<e;++a)a<=2*t?(r.push(a),r.push(a-(t+1))):r.push(a)}else{var i=[],o=[];for(a=1;a<e;++a)a>=2*t+1||a%2==1?o.push(a):i.push(a);r.push.apply(r,i),r.push(0),r.push.apply(r,o)}return r}function Pc(e,t,n,r){void 0===r&&(r=!0);var a=[];r?a.push(e[0]/n):a.push(e[0]*n);for(var i=1;i<e.length;++i)i<=t.length?r?a.push(t[i-1]*e[i]):a.push(e[i]/t[i-1]):a.push(e[i]);return a}function Mc(e,t){for(var n=[0],r=0;r<t;++r)n.push(e[r][0]);return n}function jc(e,t,n){for(var r=e.slice(0,1),a=0;a<n;++a)r.push(e[a+1]-t[a][0]-t[a][1]);return r}function Bc(e,t){if(e.rank<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was "+e.rank+".");if(t.rank<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was "+t.rank+".");if("int32"!==t.dtype)throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was "+t.dtype+".");if(t.shape[t.rank-1]>e.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+t.shape[t.rank-1]+" vs. "+e.rank);if(0===e.size)throw new Error("Requested more than 0 entries, but input is empty. Input shape: "+e.shape+".");for(var n=t.shape,r=n[n.length-1],a=1,i=0;i<n.length-1;++i)a*=n[i];var o=e.shape,s=n.slice();s.pop();var c=1;for(i=r;i<e.rank;++i)c*=o[i],s.push(o[i]);var l=xi(e.shape).map(function(e){return e/c}).concat([1]).slice(0,r);return[s,a,c,l]}Object.freeze({prepareAndValidate:Bc});function zc(e){return e<=30?e:yi(e,Math.floor(Math.sqrt(e)))}function Uc(e,t,n){var r=t.rank>1?t.shape[t.rank-1]:1,a=t.rank>1?t.rank-1:1,i="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+n.shape+", indices.shape: "+t.shape+", shape: "+e+", sliceDim: "+r+", and batchDim: "+a+".";if(n.rank<a)throw new Error(i+" update.rank < "+a+". ");if(e.length<r+(n.rank-a))throw new Error(i+" Output shape length < "+(r+(n.rank-a)));if(n.rank!==a+e.length-r)throw new Error(i+" update.rank != "+(a+e.length-r));for(var o=0;o<a;++o)if(n.shape[o]!==t.shape[o])throw new Error(i+" updates.shape["+o+"] ("+n.shape[o]+") != indices.shape["+o+"] ("+t.shape[o]+").");for(o=0;o<n.rank-a;++o)if(n.shape[o+a]!==e[o+r])throw new Error(i+" updates.shape["+(o+a)+"] ("+n.shape[o+a]+") != shape["+(o+a)+"] ("+e[o+a]+")")}function Wc(e,t,n){if(t.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was "+t.rank+".");if(e.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was "+e.rank+".");if("int32"!==t.dtype)throw new Error("The dtype of 'indices' should be int32, but got dtype: "+t.dtype);if(n.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+n);if(0===n.length){if(0===t.size)throw new Error("Indices specified for empty output. indices shape: "+t.shape);if(0===e.size)throw new Error("Updates specified for empty output. updates shape: "+e.shape)}Uc(n,t,e)}function Vc(e,t,n){for(var r=t.shape.length,a=r>1?t.shape[r-1]:1,i=n.length,o=1,s=a;s<i;++s)o*=n[s];var c=a<1?1:a;return{sliceRank:a,numUpdates:$a(t.shape)/c,sliceSize:o,strides:xi(n.slice(0,a)).concat([1]),outputSize:$a(n)}}Object.freeze({validateUpdateShape:Uc,validateInput:Wc,calculateShapes:Vc});function Hc(e,t,n){qa(e.rank===t.length,function(){return"Error in slice"+e.rank+"D: Length of begin "+t+" must match the rank of the array ("+e.rank+")."}),qa(e.rank===n.length,function(){return"Error in slice"+e.rank+"D: Length of size "+n+" must match the rank of the array ("+e.rank+")."});for(var r=function(r){qa(t[r]+n[r]<=e.shape[r],function(){return"Error in slice"+e.rank+"D: begin["+r+"] + size["+r+"] ("+(t[r]+n[r])+") would overflow input.shape["+r+"] ("+e.shape[r]+")"})},a=0;a<e.rank;++a)r(a)}function Gc(e){for(var t=[],n=0;e>0;)1&e&&t.push(n),e/=2,n++;return t}function qc(e,t,n){for(var r=[],a=0;a<e.length;a++)r[a]=Math.ceil((t[a]-e[a])/n[a]);return r}function Kc(e,t,n,r,a){var i=t[a],o=n[a]||1;(e&1<<a||null==i)&&(i=o>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var s=r[a];return i<0&&(i+=s),Va(0,i,s-1)}function Xc(e,t,n,r,a){var i=t[a],o=n[a]||1;(e&1<<a||null==i)&&(i=o>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var s=r[a];return i<0&&(i+=s),o>0?Va(0,i,s):Va(-1,i,s-1)}function Yc(e,t,n){for(var r=n.length,a=0;a<n.length;a++)if(n[a]>1){r=a;break}for(a=r+1;a<n.length;a++)if(t[a]>0||n[a]!==e[a])return!1;return!0}function $c(e,t){for(var n=e.length>0?e[e.length-1]:1,r=0;r<e.length-1;r++)n+=e[r]*t[r];return n}Object.freeze({assertParamsValid:Hc,maskToAxes:Gc,computeOutShape:qc,startForAxis:Kc,stopForAxis:Xc,isSliceContinous:Yc,computeFlatOffset:$c});function Jc(e){return no.customGrad(e)}var Qc=Es({softmax_:function(e,t){void 0===t&&(t=-1);var n=ps(e,"logits","softmax","float32");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+n.rank+" and dim was "+t);return no.runKernelFunc(function(e,r){var a=e.softmax(n,t);return r([a]),a},{logits:n},function(e,n){var r=n[0],a=e.mul(r);return{logits:function(){return a.sub(a.sum([t],!0).mul(r))}}},"Softmax",{dim:t},[],[!0])}}),Zc=Es({logSoftmax_:function(e,t){void 0===t&&(t=-1);var n=ps(e,"logits","logSoftmax");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank "+n.rank+" and axis was "+t);return Jc(function(e,n){var r=e.max(t,!0),a=e.sub(r),i=a.toFloat().sub(a.exp().sum(t,!0).log());return n([i]),{value:i,gradFunc:function(e,n){var r=n[0].exp();return e.sub(e.sum(t,!0).mul(r))}}})(n)}}),el=function(){function e(e,t){this.backend=e,this.dataMover=t,this.data=new WeakMap,this.dataIdsCount=0}return e.prototype.get=function(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)},e.prototype.set=function(e,t){this.dataIdsCount++,this.data.set(e,t)},e.prototype.has=function(e){return this.data.has(e)},e.prototype.delete=function(e){return this.dataIdsCount--,this.data.delete(e)},e.prototype.numDataIds=function(){return this.dataIdsCount},e}(),tl=function(){function e(){}return e.prototype.time=function(e){return nl("time")},e.prototype.read=function(e){return nl("read")},e.prototype.readSync=function(e){return nl("readSync")},e.prototype.numDataIds=function(){return nl("numDataIds")},e.prototype.disposeData=function(e){return nl("disposeData")},e.prototype.write=function(e,t,n){return nl("write")},e.prototype.move=function(e,t,n,r){return nl("move")},e.prototype.memory=function(){return nl("memory")},e.prototype.floatPrecision=function(){return nl("floatPrecision")},e.prototype.epsilon=function(){return 32===this.floatPrecision()?1e-7:1e-4},e.prototype.batchMatMul=function(e,t,n,r){return nl("batchMatMul")},e.prototype.fusedBatchMatMul=function(e){return e.a,e.b,e.transposeA,e.transposeB,e.bias,e.activation,e.preluActivationWeights,nl("fusedBatchMatMul")},e.prototype.slice=function(e,t,n){return nl("slice")},e.prototype.stridedSlice=function(e,t,n,r){return nl("stridedSlice")},e.prototype.unstack=function(e,t){return nl("unstack")},e.prototype.reverse=function(e,t){return nl("reverse")},e.prototype.concat=function(e,t){return nl("concat")},e.prototype.neg=function(e){return nl("neg")},e.prototype.add=function(e,t){return nl("add")},e.prototype.addN=function(e){return nl("addN")},e.prototype.subtract=function(e,t){return nl("subtract")},e.prototype.multiply=function(e,t){return nl("multiply")},e.prototype.realDivide=function(e,t){return nl("realDivide")},e.prototype.floorDiv=function(e,t){return nl("floorDiv")},e.prototype.sum=function(e,t){return nl("sum")},e.prototype.prod=function(e,t){return nl("prod")},e.prototype.unsortedSegmentSum=function(e,t,n){return nl("unsortedSegmentSum")},e.prototype.argMin=function(e,t){return nl("argMin")},e.prototype.argMax=function(e,t){return nl("argMax")},e.prototype.equal=function(e,t){return nl("equal")},e.prototype.notEqual=function(e,t){return nl("notEqual")},e.prototype.less=function(e,t){return nl("less")},e.prototype.lessEqual=function(e,t){return nl("lessEqual")},e.prototype.greater=function(e,t){return nl("greater")},e.prototype.greaterEqual=function(e,t){return nl("greaterEqual")},e.prototype.logicalNot=function(e){return nl("logicalNot")},e.prototype.logicalAnd=function(e,t){return nl("logicalAnd")},e.prototype.logicalOr=function(e,t){return nl("logicalOr")},e.prototype.where=function(e){return nl("where")},e.prototype.select=function(e,t,n){return nl("select")},e.prototype.topk=function(e,t,n){return nl("topk")},e.prototype.min=function(e,t){return nl("min")},e.prototype.minimum=function(e,t){return nl("minimum")},e.prototype.mod=function(e,t){return nl("mod")},e.prototype.max=function(e,t){return nl("max")},e.prototype.maximum=function(e,t){return nl("maximum")},e.prototype.all=function(e,t){return nl("all")},e.prototype.any=function(e,t){return nl("any")},e.prototype.squaredDifference=function(e,t){return nl("squaredDifference")},e.prototype.ceil=function(e){return nl("ceil")},e.prototype.floor=function(e){return nl("floor")},e.prototype.round=function(e){return nl("round")},e.prototype.sign=function(e){return nl("sign")},e.prototype.isNaN=function(e){return nl("isNaN")},e.prototype.isInf=function(e){return nl("isInf")},e.prototype.isFinite=function(e){return nl("isFinite")},e.prototype.pow=function(e,t){return nl("pow")},e.prototype.exp=function(e){return nl("exp")},e.prototype.expm1=function(e){return nl("expm1")},e.prototype.softmax=function(e,t){return nl("softmax")},e.prototype.log=function(e){return nl("log")},e.prototype.log1p=function(e){return nl("log1p")},e.prototype.sqrt=function(e){return nl("sqrt")},e.prototype.rsqrt=function(e){return nl("rsqrt")},e.prototype.square=function(e){return nl("square")},e.prototype.reciprocal=function(e){return nl("reciprocal")},e.prototype.relu=function(e){return nl("relu")},e.prototype.relu6=function(e){return nl("relu6")},e.prototype.prelu=function(e,t){return nl("prelu")},e.prototype.elu=function(e){return nl("elu")},e.prototype.eluDer=function(e,t){return nl("eluDer")},e.prototype.selu=function(e){return nl("selu")},e.prototype.int=function(e){return nl("int")},e.prototype.clip=function(e,t,n){return nl("clip")},e.prototype.abs=function(e){return nl("abs")},e.prototype.complexAbs=function(e){return nl("complexAbs")},e.prototype.sigmoid=function(e){return nl("sigmoid")},e.prototype.softplus=function(e){return nl("softplus")},e.prototype.sin=function(e){return nl("sin")},e.prototype.cos=function(e){return nl("cos")},e.prototype.tan=function(e){return nl("tan")},e.prototype.asin=function(e){return nl("asin")},e.prototype.acos=function(e){return nl("acos")},e.prototype.atan=function(e){return nl("atan")},e.prototype.atan2=function(e,t){return nl("atan2")},e.prototype.sinh=function(e){return nl("sinh")},e.prototype.cosh=function(e){return nl("cosh")},e.prototype.tanh=function(e){return nl("tanh")},e.prototype.asinh=function(e){return nl("asinh")},e.prototype.acosh=function(e){return nl("acosh")},e.prototype.atanh=function(e){return nl("atanh")},e.prototype.erf=function(e){return nl("erf")},e.prototype.step=function(e,t){return nl("step")},e.prototype.fusedConv2d=function(e){return e.input,e.filter,e.convInfo,e.bias,e.activation,e.preluActivationWeights,nl("fusedConv2d")},e.prototype.conv2d=function(e,t,n){return nl("conv2d")},e.prototype.conv2dDerInput=function(e,t,n){return nl("conv2dDerInput")},e.prototype.conv2dDerFilter=function(e,t,n){return nl("conv2dDerFilter")},e.prototype.fusedDepthwiseConv2D=function(e){return e.input,e.filter,e.convInfo,e.bias,e.activation,e.preluActivationWeights,nl("fusedDepthwiseConv2D")},e.prototype.depthwiseConv2D=function(e,t,n){return nl("depthwiseConv2D")},e.prototype.depthwiseConv2DDerInput=function(e,t,n){return nl("depthwiseConv2DDerInput")},e.prototype.depthwiseConv2DDerFilter=function(e,t,n){return nl("depthwiseConv2DDerFilter")},e.prototype.conv3d=function(e,t,n){return nl("conv3d")},e.prototype.conv3dDerInput=function(e,t,n){return nl("conv3dDerInput")},e.prototype.conv3dDerFilter=function(e,t,n){return nl("conv3dDerFilter")},e.prototype.maxPool=function(e,t){return nl("maxPool")},e.prototype.maxPoolBackprop=function(e,t,n,r){return nl("maxPoolBackprop")},e.prototype.avgPool=function(e,t){return nl("avgPool")},e.prototype.avgPoolBackprop=function(e,t,n){return nl("avgPoolBackprop")},e.prototype.avgPool3d=function(e,t){return nl("avgPool3d")},e.prototype.avgPool3dBackprop=function(e,t,n){return nl("avgPool3dBackprop")},e.prototype.maxPool3d=function(e,t){return nl("maxPool3d")},e.prototype.maxPool3dBackprop=function(e,t,n,r){return nl("maxPool3dBackprop")},e.prototype.reshape=function(e,t){return nl("reshape")},e.prototype.cast=function(e,t){return nl("cast")},e.prototype.tile=function(e,t){return nl("tile")},e.prototype.pad=function(e,t,n){return nl("pad")},e.prototype.transpose=function(e,t){return nl("transpose")},e.prototype.gather=function(e,t,n){return nl("gather")},e.prototype.gatherND=function(e,t){return nl("gatherND")},e.prototype.scatterND=function(e,t,n){return nl("scatterND")},e.prototype.batchToSpaceND=function(e,t,n){return nl("batchToSpaceND")},e.prototype.spaceToBatchND=function(e,t,n){return nl("spaceToBatchND")},e.prototype.resizeBilinear=function(e,t,n,r){return nl("resizeBilinear")},e.prototype.resizeBilinearBackprop=function(e,t,n){return nl("resizeBilinearBackprop")},e.prototype.resizeNearestNeighbor=function(e,t,n,r){return nl("resizeNearestNeighbor")},e.prototype.resizeNearestNeighborBackprop=function(e,t,n){return nl("resizeNearestNeighborBackprop")},e.prototype.batchNormalization=function(e,t,n,r,a,i){return nl("batchNormalization")},e.prototype.localResponseNormalization4D=function(e,t,n,r,a){return nl("localResponseNormalization4D")},e.prototype.LRNGrad=function(e,t,n,r,a,i,o){return nl("LRNGrad")},e.prototype.multinomial=function(e,t,n,r){return nl("multinomial")},e.prototype.oneHot=function(e,t,n,r){return nl("oneHot")},e.prototype.cumsum=function(e,t,n,r){return nl("cumsum")},e.prototype.nonMaxSuppression=function(e,t,n,r,a){return nl("nonMaxSuppression")},e.prototype.fft=function(e){return nl("fft")},e.prototype.ifft=function(e){return nl("ifft")},e.prototype.complex=function(e,t){return nl("complex")},e.prototype.real=function(e){return nl("real")},e.prototype.imag=function(e){return nl("imag")},e.prototype.cropAndResize=function(e,t,n,r,a,i){return nl("cropAndResize")},e.prototype.depthToSpace=function(e,t,n){return nl("depthToSpace")},e.prototype.split=function(e,t,n){return nl("split")},e.prototype.sparseToDense=function(e,t,n,r){return nl("sparseToDense")},e.prototype.diag=function(e){return nl("diag")},e.prototype.fill=function(e,t,n){return nl("fill")},e.prototype.onesLike=function(e){return nl("onesLike")},e.prototype.zerosLike=function(e){return nl("zerosLike")},e.prototype.linspace=function(e,t,n){return nl("linspace")},e.prototype.dispose=function(){return nl("dispose")},e}();function nl(e){throw new Error("'"+e+"' not yet implemented or not found in the registry. Did you forget to import the kernel?")}function rl(e,t){for(var n=e.length,r=[],a=0;a<n;a++){var i=n-1-a,o=e[i]||1;(t[t.length-1-a]||1)>1&&1===o&&r.unshift(i)}return r}function al(e,t){for(var n=[],r=0;r<t.length;r++){var a=e[e.length-r-1],i=t.length-r-1,o=t[i];(null==a||1===a&&o>1)&&n.unshift(i)}return n}function il(e,t){for(var n=[],r=Math.max(e.length,t.length),a=0;a<r;a++){var i=e[e.length-a-1];null==i&&(i=1);var o=t[t.length-a-1];if(null==o&&(o=1),1===i)n.unshift(o);else if(1===o)n.unshift(i);else{if(i!==o)throw Error("Operands could not be broadcast together with shapes "+e+" and "+t+".");n.unshift(i)}}return n}function ol(e,t,n,r,a,i,o){void 0===o&&(o="channelsLast");var s,c=hl(t),l=c[0],u=c[1];if("channelsLast"===o)s=[l,u,e[3],e[3]];else{if("channelsFirst"!==o)throw new Error("Unknown dataFormat "+o);s=[l,u,e[1],e[1]]}return cl(e,s,n,r,a,i,!1,o)}function sl(e,t,n,r,a,i,o){void 0===o&&(o="NDHWC");var s,c,l=dl(t),u=l[0],h=l[1],d=l[2];if("NDHWC"===o)c="channelsLast",s=[u,h,d,e[4],e[4]];else{if("NCDHW"!==o)throw new Error("Unknown dataFormat "+o);c="channelsFirst",s=[u,h,d,e[1],e[1]]}return ll(e,s,n,r,a,!1,c,i)}function cl(e,t,n,r,a,i,o,s){void 0===o&&(o=!1),void 0===s&&(s="channelsLast");var c=[-1,-1,-1,-1],l=c[0],u=c[1],h=c[2],d=c[3];if("channelsLast"===s)l=e[0],u=e[1],h=e[2],d=e[3];else{if("channelsFirst"!==s)throw new Error("Unknown dataFormat "+s);l=e[0],d=e[1],u=e[2],h=e[3]}var f,p=t[0],m=t[1],g=t[3],v=hl(n),b=v[0],y=v[1],x=hl(r),w=x[0],k=x[1],S=fl(p,w),N=fl(m,k),C=function(e,t,n,r,a,i,o,s){var c,l,u;if("number"==typeof e){c={top:e,bottom:e,left:e,right:e,type:0===e?"VALID":"NUMBER"};var h=function(e,t,n,r,a){null==r&&(r=ul(e,t,n));var i=e[1],o=pl((e[0]-t+2*r)/n+1,a);qa(Qa(o),function(){return"The output # of rows ("+o+") must be an integer. Change the stride and/or zero pad parameters"});var s=pl((i-t+2*r)/n+1,a);return qa(Qa(s),function(){return"The output # of columns ("+s+") must be an integer. Change the stride and/or zero pad parameters"}),[o,s]}([t,n],i,r,e,s);l=h[0],u=h[1]}else if("same"===e){l=Math.ceil(t/r),u=Math.ceil(n/a);var d=Math.max(0,(l-1)*r+i-t),f=Math.max(0,(u-1)*a+o-n),p=Math.floor(d/2),m=d-p,g=Math.floor(f/2);c={top:p,bottom:m,left:g,right:f-g,type:"SAME"}}else{if("valid"!==e)throw Error("Unknown padding parameter: "+e);c={top:0,bottom:0,left:0,right:0,type:"VALID"},l=Math.ceil((t-i+1)/r),u=Math.ceil((n-o+1)/a)}return{padInfo:c,outHeight:l,outWidth:u}}(a,u,h,b,y,S,N,i),E=C.padInfo,I=C.outHeight,T=C.outWidth,_=o?g*d:g;return"channelsFirst"===s?f=[l,_,I,T]:"channelsLast"===s&&(f=[l,I,T,_]),{batchSize:l,dataFormat:s,inHeight:u,inWidth:h,inChannels:d,outHeight:I,outWidth:T,outChannels:_,padInfo:E,strideHeight:b,strideWidth:y,filterHeight:p,filterWidth:m,effectiveFilterHeight:S,effectiveFilterWidth:N,dilationHeight:w,dilationWidth:k,inShape:e,outShape:f,filterShape:t}}function ll(e,t,n,r,a,i,o,s){void 0===i&&(i=!1),void 0===o&&(o="channelsLast");var c=[-1,-1,-1,-1,-1],l=c[0],u=c[1],h=c[2],d=c[3],f=c[4];if("channelsLast"===o)l=e[0],u=e[1],h=e[2],d=e[3],f=e[4];else{if("channelsFirst"!==o)throw new Error("Unknown dataFormat "+o);l=e[0],f=e[1],u=e[2],h=e[3],d=e[4]}var p,m=t[0],g=t[1],v=t[2],b=t[4],y=dl(n),x=y[0],w=y[1],k=y[2],S=dl(r),N=S[0],C=S[1],E=S[2],I=fl(m,N),T=fl(g,C),_=fl(v,E),A=function(e,t,n,r,a,i,o,s,c,l,u){var h,d,f,p;if("number"==typeof e){h={top:e,bottom:e,left:e,right:e,front:e,back:e,type:0===e?"VALID":"NUMBER"};var m=function(e,t,n,r,a,i){null==a&&(a=ul(e,t,r));var o=e[1],s=e[2],c=pl((e[0]-t+2*a)/r+1,i);qa(Qa(c),function(){return"The output # of depths ("+c+") must be an integer. Change the stride and/or zero pad parameters"});var l=pl((o-t+2*a)/r+1,i);qa(Qa(l),function(){return"The output # of rows ("+l+") must be an integer. Change the stride and/or zero pad parameters"});var u=pl((s-t+2*a)/r+1,i);return qa(Qa(u),function(){return"The output # of columns ("+u+") must be an integer. Change the stride and/or zero pad parameters"}),[c,l,u,1]}([t,n,r,1],s,0,a,e,u);d=m[0],f=m[1],p=m[2]}else if("same"===e){var g=((d=Math.ceil(t/a))-1)*a+s-t,v=((f=Math.ceil(n/i))-1)*i+c-n,b=((p=Math.ceil(r/o))-1)*o+l-r,y=Math.floor(g/2),x=g-y,w=Math.floor(v/2),k=v-w,S=Math.floor(b/2);h={top:w,bottom:k,left:S,right:b-S,front:y,back:x,type:"SAME"}}else{if("valid"!==e)throw Error("Unknown padding parameter: "+e);h={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},d=Math.ceil((t-s+1)/a),f=Math.ceil((n-c+1)/i),p=Math.ceil((r-l+1)/o)}return{padInfo:h,outDepth:d,outHeight:f,outWidth:p}}(a,u,h,d,x,w,k,I,T,_,s),R=A.padInfo,F=A.outDepth,D=A.outHeight,O=A.outWidth,L=i?b*f:b;return"channelsFirst"===o?p=[l,L,F,D,O]:"channelsLast"===o&&(p=[l,F,D,O,L]),{batchSize:l,dataFormat:o,inDepth:u,inHeight:h,inWidth:d,inChannels:f,outDepth:F,outHeight:D,outWidth:O,outChannels:L,padInfo:R,strideDepth:x,strideHeight:w,strideWidth:k,filterDepth:m,filterHeight:g,filterWidth:v,effectiveFilterDepth:I,effectiveFilterHeight:T,effectiveFilterWidth:_,dilationDepth:N,dilationHeight:C,dilationWidth:E,inShape:e,outShape:p,filterShape:t}}function ul(e,t,n,r){void 0===r&&(r=1);var a=fl(t,r);return Math.floor((e[0]*(n-1)-n+a)/2)}function hl(e){return"number"==typeof e?[e,e,e]:2===e.length?[e[0],e[1],1]:e}function dl(e){return"number"==typeof e?[e,e,e]:e}function fl(e,t){return t<=1?e:e+(e-1)*(t-1)}function pl(e,t){if(!t)return e;switch(t){case"round":return Math.round(e);case"ceil":return Math.ceil(e);case"floor":return Math.floor(e);default:throw new Error("Unknown roundingMode "+t)}}function ml(e){var t=hl(e),n=t[0],r=t[1],a=t[2];return 1===n&&1===r&&1===a}function gl(e,t){return ml(e)||ml(t)}function vl(e){if("NHWC"===e)return"channelsLast";if("NCHW"===e)return"channelsFirst";throw new Error("Unknown dataFormat "+e)}function bl(e,t,n){if("complex64"===t){if("complex64"===e.dtype)return e.clone();var r=js(e.shape),a=e.toFloat(),i=n.complex(a,r);return r.dispose(),a.dispose(),i}if(!ui(e.dtype,t))return no.makeTensorFromDataId(e.dataId,e.shape,t);if("complex64"===e.dtype){var o=n.real(e);return i=o.cast(t),o.dispose(),i}if("int32"===t)return n.int(e);if("bool"===t){var s=Fs(0,e.dtype);return i=n.notEqual(e,s),s.dispose(),i}throw new Error("Error in Cast: failed to cast "+e.dtype+" to "+t)}function yl(e,t){return no.makeTensorFromDataId(e.dataId,t,e.dtype)}function xl(e,t,n){var r=(t-e)/(n-1),a=Ni(n,"float32");a[0]=e;for(var i=1;i<a.length;i++)a[i]=a[i-1]+r;return Ds(a,"float32")}Object.freeze({castTensor:bl,reshapeTensor:yl,linspaceImpl:xl,upcastType:Xi,axesAreInnerMostDims:gs,combineLocations:vs,computeOutAndReduceShapes:bs,expandShapeToKeepDim:ys,assertAxesAreInnerMostDims:xs,getAxesPermutation:ws,getUndoAxesPermutation:ks,getInnerMostAxes:Ss,getBroadcastDims:rl,getReductionAxes:al,assertAndGetBroadcastShape:il,assertParamsConsistent:Ns,computeOutShape:Cs,computePool2DInfo:ol,computePool3DInfo:sl,computeConv2DInfo:cl,computeConv3DInfo:ll,computeDefaultPad:ul,tupleValuesAreOne:ml,eitherStridesOrDilationsAreOne:gl,convertConv2DDataFormat:vl,PARALLELIZE_THRESHOLD:30,computeOptimalWindowSize:zc});function wl(e,t){if(e.length!==t.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+e.length+", imag: "+t.length+".");for(var n=new Float32Array(2*e.length),r=0;r<n.length;r+=2)n[r]=e[r/2],n[r+1]=t[r/2];return n}function kl(e,t){return{real:e[2*t],imag:e[2*t+1]}}function Sl(e,t,n,r){e[2*r]=t,e[2*r+1]=n}function Nl(e,t,n){var r=(n?2:-2)*Math.PI*(e/t);return{real:Math.cos(r),imag:Math.sin(r)}}function Cl(e,t,n){var r=function(e,t,n){return function(e,t,n){for(var r=0,a=e.length,i=0,o=!1;r<a;){var s=n(t,e[i=r+(a-r>>>1)]);s>0?r=i+1:(a=i,o=!s)}return o?r:-r-1}(e,t,n||El)}(e,t,n),a=r<0?-(r+1):r;e.splice(a,0,t)}function El(e,t){return e>t?1:e<t?-1:0}function Il(e,t,n,r,a){return _l(e,t,n,r,a,0).selectedIndices}function Tl(e,t,n,r,a,i){var o=_l(e,t,n,r,a,i,!0);return o.numValidOutputs.dispose(),{selectedIndices:o.selectedIndices,selectedScores:o.selectedScores}}function _l(e,t,n,r,a,i,o,s){void 0===o&&(o=!1),void 0===s&&(s=!1);for(var c=Array.from(t).map(function(e,t){return{score:e,boxIndex:t,suppressBeginIndex:0}}).filter(function(e){return e.score>a}).sort(Fl),l=i>0?-.5/i:0,u=[],h=[];u.length<n&&c.length>0;){var d=c.pop(),f=d.score,p=d.boxIndex,m=d.suppressBeginIndex;if(f<a)break;for(var g=!1,v=u.length-1;v>=m;--v){var b=Al(e,p,u[v]);if(b>=r){g=!0;break}if(d.score=d.score*Rl(r,l,b),d.score<=a)break}d.suppressBeginIndex=u.length,g||(d.score===f?(u.push(p),h.push(d.score)):d.score>a&&Cl(c,d,Fl))}var y=u.length;return s&&(u.fill(0,y),h.fill(0,y)),{selectedIndices:Ds(u,"int32"),selectedScores:Ds(h,"float32"),numValidOutputs:Fs(y,"int32")}}function Al(e,t,n){var r=e.subarray(4*t,4*t+4),a=e.subarray(4*n,4*n+4),i=Math.min(r[0],r[2]),o=Math.min(r[1],r[3]),s=Math.max(r[0],r[2]),c=Math.max(r[1],r[3]),l=Math.min(a[0],a[2]),u=Math.min(a[1],a[3]),h=Math.max(a[0],a[2]),d=Math.max(a[1],a[3]),f=(s-i)*(c-o),p=(h-l)*(d-u);if(f<=0||p<=0)return 0;var m=Math.max(i,l),g=Math.max(o,u),v=Math.min(s,h),b=Math.min(c,d),y=Math.max(v-m,0)*Math.max(b-g,0);return y/(f+p-y)}function Rl(e,t,n){var r=Math.exp(t*n*n);return n<=e?r:0}function Fl(e,t){return e.score-t.score||e.score===t.score&&t.boxIndex-e.boxIndex}function Dl(e,t,n){var r=new Array(e.rank).fill(0),a=e.shape.slice();return t.map(function(t){a[n]=t;var i=e.slice(r,a);return r[n]+=t,i})}function Ol(e,t){for(var n=new Array(e.rank),r=0;r<n.length;r++)n[r]=e.shape[r]*t[r];var a=sc(n,e.dtype);for(r=0;r<a.values.length;++r){for(var i=a.indexToLoc(r),o=new Array(e.rank),s=0;s<o.length;s++)o[s]=i[s]%e.shape[s];var c=e.locToIndex(o);a.values[r]=e.values[c]}return a.toTensor()}function Ll(e,t,n,r,a){for(var i=t[t.length-1],o=[e.length/i,i],s=o[0],c=o[1],l=oi(n,s*r),u=oi("int32",s*r),h=0;h<s;h++){for(var d=h*c,f=e.subarray(d,d+c),p=[],m=0;m<f.length;m++)p.push({value:f[m],index:m});p.sort(function(e,t){return t.value-e.value});var g=h*r,v=l.subarray(g,g+r),b=u.subarray(g,g+r);for(m=0;m<r;m++)v[m]=p[m].value,b[m]=p[m].index}var y=t.slice();return y[y.length-1]=r,[As(l,y,n),As(u,y,"int32")]}function Pl(e,t){for(var n=[],r=0;r<t.length;r++)t[r]&&n.push(r);var a=sc(e,"int32"),i=sc([n.length,e.length],"int32");for(r=0;r<n.length;r++){var o=a.indexToLoc(n[r]),s=r*e.length;i.values.set(o,s)}return i.toTensor()}var Ml=function(e,t){this.outputShape=[],this.outputShape=e,this.variableNames=t.map(function(e,t){return"T"+t});var n=[];this.variableNames.forEach(function(e){n.push("float v"+e+" = get"+e+"AtOutCoords();")});var r=this.variableNames.map(function(e){return"v"+e}).join(" + ");this.userCode="\n      void main() {\n        "+n.join("\n        ")+"\n\n        float result = "+r+";\n        setOutput(result);\n      }\n    "},jl=function(e,t){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.variableNames=t.map(function(e,t){return"T"+t});var n=[];this.variableNames.forEach(function(e){n.push("vec4 v"+e+" = get"+e+"AtOutCoords();")});var r=this.variableNames.map(function(e){return"v"+e}).join(" + ");this.userCode="\n      void main() {\n        "+n.join("\n        ")+"\n\n        vec4 result = "+r+";\n        setOutput(result);\n      }\n    "},Bl=function(e,t,n){this.variableNames=["A"];var r=e.windowSize,a=e.batchSize,i=e.inSize,o=Math.ceil(i/r);n||this.variableNames.push("bestIndicesA"),this.outputShape=[a,o];var s="max"===t?">":"<",c=n?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+r+";\n\n        int bestIndex = inOffset;\n        float bestValue = getA(batch, bestIndex);\n\n        for (int i = 0; i < "+r+"; i++) {\n          int inIdx = "+c+";\n          float candidate = getA(batch, inIdx);\n          if (candidate "+s+" bestValue) {\n            bestValue = candidate;\n            bestIndex = inIdx;\n          }\n        }\n        setOutput(float(bestIndex));\n      }\n    "};function zl(e,t){return["x","y","z","w","u","v"].slice(0,t).map(function(t){return e+"."+t})}function Ul(e,t){return 1===t?[e]:zl(e,t)}function Wl(){var e,t,n,r,a,i,o,s,c,l;return 2===Da().getNumber("WEBGL_VERSION")?(e="#version 300 es",t="in",n="out",r="in",a="texture",i="outputColor",o="out vec4 outputColor;",s="\n      bool isnan_custom(float val) {\n        return (val > 0.0 || val < 0.0) ? false : val != 0.0;\n      }\n\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan_custom(val.x),\n          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));\n      }\n\n      #define isnan(value) isnan_custom(value)\n    ",c="",l="\n      #define round(value) newRound(value)\n      int newRound(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 newRound(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "):(e="",t="attribute",n="varying",r="varying",a="texture2D",i="gl_FragColor",o="",s="\n      #define isnan(value) isnan_custom(value)\n      bool isnan_custom(float val) {\n        return (val > 0. || val < 1. || val == 0.) ? false : true;\n      }\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));\n      }\n    ",c="\n      uniform float INFINITY;\n\n      bool isinf(float val) {\n        return abs(val) == INFINITY;\n      }\n      bvec4 isinf(vec4 val) {\n        return equal(abs(val), vec4(INFINITY));\n      }\n    ",l="\n      int round(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 round(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "),{version:e,attribute:t,varyingVs:n,varyingFs:r,texture2D:a,output:i,defineOutput:o,defineSpecialNaN:s,defineSpecialInf:c,defineRound:l}}function Vl(e,t,n){void 0===n&&(n="index");var r=xi(t);return r.map(function(t,a){return"int "+e[a]+" = "+n+" / "+t+"; "+(a===r.length-1?"int "+e[a+1]+" = "+n+" - "+e[a]+" * "+t:"index -= "+e[a]+" * "+t)+";"}).join("")}function Hl(e){var t=xi(e).map(function(e){return e.toString()});return"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * "+t[0]+" + coords.y * "+t[1]+" + coords.z;\n  }\n"}var Gl="\n  const float FLOAT_MAX = 1.70141184e38;\n  const float FLOAT_MIN = 1.17549435e-38;\n\n  lowp vec4 encode_float(highp float v) {\n    if (isnan(v)) {\n      return vec4(255, 255, 255, 255);\n    }\n\n    highp float av = abs(v);\n\n    if(av < FLOAT_MIN) {\n      return vec4(0.0, 0.0, 0.0, 0.0);\n    } else if(v > FLOAT_MAX) {\n      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;\n    } else if(v < -FLOAT_MAX) {\n      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;\n    }\n\n    highp vec4 c = vec4(0,0,0,0);\n\n    highp float e = floor(log2(av));\n    highp float m = exp2(fract(log2(av))) - 1.0;\n\n    c[2] = floor(128.0 * m);\n    m -= c[2] / 128.0;\n    c[1] = floor(32768.0 * m);\n    m -= c[1] / 32768.0;\n    c[0] = floor(8388608.0 * m);\n\n    highp float ebias = e + 127.0;\n    c[3] = floor(ebias / 2.0);\n    ebias -= c[3] * 2.0;\n    c[2] += floor(ebias) * 128.0;\n\n    c[3] += 128.0 * step(0.0, -v);\n\n    return c / 255.0;\n  }\n";function ql(e,t,n,r){var a=[];e.forEach(function(e){var t=$a(e.shapeInfo.logicalShape);e.shapeInfo.isUniform?a.push("uniform float "+e.name+(t>1?"["+t+"]":"")+";"):(a.push("uniform sampler2D "+e.name+";"),a.push("uniform int offset"+e.name+";"))});var i,o,s=a.join("\n"),c=e.map(function(e){return function(e,t,n){void 0===n&&(n=!1);var r="";r+=n?Xl(e):Kl(e);var a=e.shapeInfo.logicalShape,i=t.logicalShape;return a.length<=i.length&&(r+=n?function(e,t){var n,r=e.name,a=r.charAt(0).toUpperCase()+r.slice(1),i="get"+a+"AtOutCoords",o=e.shapeInfo.logicalShape.length,s=t.logicalShape.length,c=rl(e.shapeInfo.logicalShape,t.logicalShape),l=tu(s),u=s-o,h=["x","y","z","w","u","v"];n=0===o?"":s<2&&c.length>=1?"coords = 0;":c.map(function(e){return"coords."+h[e+u]+" = 0;"}).join("\n");var d;d=s<2&&o>0?"coords":e.shapeInfo.logicalShape.map(function(e,t){return"coords."+h[t+u]}).join(", ");var f="return outputValue;",p=1===$a(e.shapeInfo.logicalShape),m=1===$a(t.logicalShape);if(1!==o||p||m){if(p&&!m)f=1===s?"\n        return vec4(outputValue.x, outputValue.x, 0., 0.);\n      ":"\n        return vec4(outputValue.x);\n      ";else if(c.length){var g=o-2,v=o-1;c.indexOf(g)>-1&&c.indexOf(v)>-1?f="return vec4(outputValue.x);":c.indexOf(g)>-1?f="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":c.indexOf(v)>-1&&(f="return vec4(outputValue.xx, outputValue.zz);")}}else f="\n      return vec4(outputValue.xy, outputValue.xy);\n    ";return"\n    vec4 "+i+"() {\n      "+l+" coords = getOutputCoords();\n      "+n+"\n      vec4 outputValue = get"+a+"("+d+");\n      "+f+"\n    }\n  "}(e,t):function(e,t){var n=e.name,r=n.charAt(0).toUpperCase()+n.slice(1),a="get"+r+"AtOutCoords",i=t.texShape,o=e.shapeInfo.texShape,s=e.shapeInfo.logicalShape.length,c=t.logicalShape.length;if(!e.shapeInfo.isUniform&&s===c&&null==e.shapeInfo.flatOffset&&Ja(o,i))return"\n      float "+a+"() {\n        return sampleTexture("+n+", resultUV);\n      }\n    ";var l,u=tu(c),h=rl(e.shapeInfo.logicalShape,t.logicalShape),d=c-s,f=["x","y","z","w","u","v"];l=0===s?"":c<2&&h.length>=1?"coords = 0;":h.map(function(e){return"coords."+f[e+d]+" = 0;"}).join("\n");var p;return p=c<2&&s>0?"coords":e.shapeInfo.logicalShape.map(function(e,t){return"coords."+f[t+d]}).join(", "),"\n    float "+a+"() {\n      "+u+" coords = getOutputCoords();\n      "+l+"\n      return get"+r+"("+p+");\n    }\n  "}(e,t)),r}(e,t,r)}).join("\n"),l=t.texShape,u=Wl(),h=function(e){return"\n    float sampleTexture(sampler2D textureSampler, vec2 uv) {\n      return "+e.texture2D+"(textureSampler, uv).r;\n    }\n  "}(u),d=function(e){return e.version+"\n    precision highp float;\n    precision highp int;\n    precision highp sampler2D;\n    "+e.varyingFs+" vec2 resultUV;\n    "+e.defineOutput+"\n    const vec2 halfCR = vec2(0.5, 0.5);\n\n    struct ivec5\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n    };\n\n    struct ivec6\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n      int v;\n    };\n\n    uniform float NAN;\n    "+e.defineSpecialNaN+"\n    "+e.defineSpecialInf+"\n    "+e.defineRound+"\n\n    int imod(int x, int y) {\n      return x - y * (x / y);\n    }\n\n    int idiv(int a, int b, float sign) {\n      int res = a / b;\n      int mod = imod(a, b);\n      if (sign < 0. && mod != 0) {\n        res -= 1;\n      }\n      return res;\n    }\n\n    //Based on the work of Dave Hoskins\n    //https://www.shadertoy.com/view/4djSRW\n    #define HASHSCALE1 443.8975\n    float random(float seed){\n      vec2 p = resultUV * seed;\n      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);\n      p3 += dot(p3, p3.yzx + 19.19);\n      return fract((p3.x + p3.y) * p3.z);\n    }\n\n    "+Yl+"\n    "+$l+"\n    "+Jl+"\n  "}(u);return t.isPacked?(i=function(e,t){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(e,t){var n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];return 1===n[0]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * "+n[1]+".0);\n      }\n    ":1===n[1]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * "+n[0]+".0);\n      }\n    ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n      return 2 * (resTexRC.x * "+n[1]+" + resTexRC.y);\n    }\n  "}(0,t);case 2:return function(e,t){var n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];if(Ja(e,t))return"\n      ivec2 getOutputCoords() {\n        return 2 * ivec2(resultUV.yx * vec2("+n[0]+", "+n[1]+"));\n      }\n    ";var r=Math.ceil(e[1]/2);return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n\n      int index = resTexRC.x * "+n[1]+" + resTexRC.y;\n      int r = 2 * (index / "+r+");\n      int c = imod(index, "+r+") * 2;\n\n      return ivec2(r, c);\n    }\n  "}(e,t);case 3:return n=e,r=t,a=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)],o=(i=Math.ceil(n[2]/2))*Math.ceil(n[1]/2),"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+a[0]+", "+a[1]+"));\n      int index = resTexRC.x * "+a[1]+" + resTexRC.y;\n\n      int b = index / "+o+";\n      index -= b * "+o+";\n\n      int r = 2 * (index / "+i+");\n      int c = imod(index, "+i+") * 2;\n\n      return ivec3(b, r, c);\n    }\n  ";default:return function(e,t){for(var n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],r=Math.ceil(e[e.length-1]/2),a=r*Math.ceil(e[e.length-2]/2),i=a,o="",s="b, r, c",c=2;c<e.length-1;c++)o="\n      int b"+c+" = index / "+(i*=e[e.length-c-1])+";\n      index -= b"+c+" * "+i+";\n    "+o,s="b"+c+", "+s;return"\n    ivec"+e.length+" getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n      int index = resTexRC.x * "+n[1]+" + resTexRC.y;\n\n      "+o+"\n\n      int b = index / "+a+";\n      index -= b * "+a+";\n\n      int r = 2 * (index / "+r+");\n      int c = imod(index, "+r+") * 2;\n\n      return ivec"+e.length+"("+s+");\n    }\n  "}(e,t)}var n,r,a,i,o}(t.logicalShape,l),o=function(e){return"\n    void setOutput(vec4 val) {\n      "+e.output+" = val;\n    }\n  "}(u)):(i=function(e,t){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(e,t){return 1===t[0]?"\n      int getOutputCoords() {\n        return int(resultUV.x * "+t[1]+".0);\n      }\n    ":1===t[1]?"\n      int getOutputCoords() {\n        return int(resultUV.y * "+t[0]+".0);\n      }\n    ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+t[0]+", "+t[1]+"));\n      return resTexRC.x * "+t[1]+" + resTexRC.y;\n    }\n  "}(0,t);case 2:return function(e,t){return Ja(e,t)?"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2("+t[0]+", "+t[1]+"));\n      }\n    ":1===e[1]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+t[0]+", "+t[1]+"));\n        int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    ":1===e[0]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+t[0]+", "+t[1]+"));\n        int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n        return ivec2(0, index);\n      }\n    ":"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+t[0]+", "+t[1]+"));\n      int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n      int r = index / "+e[1]+";\n      int c = index - r * "+e[1]+";\n      return ivec2(r, c);\n    }\n  "}(e,t);case 3:return n=t,r=Vl(["r","c","d"],e),"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n      int index = resTexRC.x * "+n[1]+" + resTexRC.y;\n      "+r+"\n      return ivec3(r, c, d);\n    }\n  ";case 4:return function(e,t){var n=Vl(["r","c","d","d2"],e);return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+t[0]+", "+t[1]+"));\n      int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n      "+n+"\n      return ivec4(r, c, d, d2);\n    }\n  "}(e,t);case 5:return function(e,t){var n=Vl(["r","c","d","d2","d3"],e);return"\n    ivec5 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx * vec2("+t[0]+",\n                             "+t[1]+"));\n\n      int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n\n      "+n+"\n\n      ivec5 outShape = ivec5(r, c, d, d2, d3);\n      return outShape;\n    }\n  "}(e,t);case 6:return function(e,t){var n=Vl(["r","c","d","d2","d3","d4"],e);return"\n    ivec6 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+t[0]+", "+t[1]+"));\n      int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n\n      "+n+"\n\n      ivec6 result = ivec6(r, c, d, d2, d3, d4);\n      return result;\n    }\n  "}(e,t);default:throw new Error(e.length+"-D output sampling is not yet supported")}var n,r}(t.logicalShape,l),o=function(e){return"\n    void setOutput(float val) {\n      "+e.output+" = vec4(val, 0, 0, 0);\n    }\n  "}(u)),r&&(d+=Ql),[d,h,o,s,i,c,n].join("\n")}function Kl(e){var t=e.shapeInfo.logicalShape;switch(t.length){case 0:return function(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1);if(e.shapeInfo.isUniform)return"float "+n+"() {return "+t+";}";var r=e.shapeInfo.texShape,a=r[0],i=r[1];if(1===a&&1===i)return"\n      float "+n+"() {\n        return sampleTexture("+t+", halfCR);\n      }\n    ";var o=e.shapeInfo.texShape;return"\n    float "+n+"() {\n      vec2 uv = uvFromFlat("+o[0]+", "+o[1]+", "+Zl(t)+");\n      return sampleTexture("+t+", uv);\n    }\n  "}(e);case 1:return function(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1);if(e.shapeInfo.isUniform)return"\n      float "+n+"(int index) {\n        "+eu(e)+"\n      }\n    ";var r=e.shapeInfo.texShape,a=r[0],i=r[1];if(1===i&&1===a)return"\n      float "+n+"(int index) {\n        return sampleTexture("+t+", halfCR);\n      }\n    ";var o=Zl(t);return 1===i?"\n      float "+n+"(int index) {\n        vec2 uv = vec2(0.5, (float(index + "+o+") + 0.5) / "+a+".0);\n        return sampleTexture("+t+", uv);\n      }\n    ":1===a?"\n      float "+n+"(int index) {\n        vec2 uv = vec2((float(index + "+o+") + 0.5) / "+i+".0, 0.5);\n        return sampleTexture("+t+", uv);\n      }\n    ":"\n    float "+n+"(int index) {\n      vec2 uv = uvFromFlat("+a+", "+i+", index + "+o+");\n      return sampleTexture("+t+", uv);\n    }\n  "}(e);case 2:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=e.shapeInfo.texShape;if(null!=a&&Ja(t,a)){var i=a[0];return"\n    float "+r+"(int row, int col) {\n      vec2 uv = (vec2(col, row) + halfCR) / vec2("+a[1]+".0, "+i+".0);\n      return sampleTexture("+n+", uv);\n    }\n  "}var o=ii(t),s=o.newShape,c=o.keptDims,l=s;if(l.length<t.length)return"\n      "+Kl(nu(e,l))+"\n      float "+r+"(int row, int col) {\n        return "+r+"("+ru(["row","col"],c)+");\n      }\n    ";if(e.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col) {\n        int index = round(dot(vec2(row, col), vec2("+t[1]+", 1)));\n        "+eu(e)+"\n      }\n    ";var u=a[0],h=a[1],d=Zl(n);return 1===h?"\n    float "+r+"(int row, int col) {\n      float index = dot(vec3(row, col, "+d+"), vec3("+t[1]+", 1, 1));\n      vec2 uv = vec2(0.5, (index + 0.5) / "+u+".0);\n      return sampleTexture("+n+", uv);\n    }\n  ":1===u?"\n    float "+r+"(int row, int col) {\n      float index = dot(vec3(row, col, "+d+"), vec3("+t[1]+", 1, 1));\n      vec2 uv = vec2((index + 0.5) / "+h+".0, 0.5);\n      return sampleTexture("+n+", uv);\n    }\n  ":"\n  float "+r+"(int row, int col) {\n    // Explicitly use integer operations as dot() only works on floats.\n    int index = row * "+t[1]+" + col + "+d+";\n    vec2 uv = uvFromFlat("+u+", "+h+", index);\n    return sampleTexture("+n+", uv);\n  }\n"}(e);case 3:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=t[1]*t[2],i=t[2],o=ii(t),s=o.newShape,c=o.keptDims,l=s;if(l.length<t.length)return"\n        "+Kl(nu(e,l))+"\n        float "+r+"(int row, int col, int depth) {\n          return "+r+"("+ru(["row","col","depth"],c)+");\n        }\n      ";if(e.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col, int depth) {\n        int index = round(dot(vec3(row, col, depth),\n                          vec3("+a+", "+i+", 1)));\n        "+eu(e)+"\n      }\n    ";var u=e.shapeInfo.texShape,h=u[0],d=u[1],f=e.shapeInfo.flatOffset;return d===a&&null==f?"\n        float "+r+"(int row, int col, int depth) {\n          float texR = float(row);\n          float texC = dot(vec2(col, depth), vec2("+i+", 1));\n          vec2 uv = (vec2(texC, texR) + halfCR) /\n                     vec2("+d+".0, "+h+".0);\n          return sampleTexture("+n+", uv);\n        }\n      ":d===i&&null==f?"\n    float "+r+"(int row, int col, int depth) {\n      float texR = dot(vec2(row, col), vec2("+t[1]+", 1));\n      float texC = float(depth);\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+d+".0, "+h+".0);\n      return sampleTexture("+n+", uv);\n    }\n  ":"\n      float "+r+"(int row, int col, int depth) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * "+a+" + col * "+i+" + depth + "+Zl(n)+";\n        vec2 uv = uvFromFlat("+h+", "+d+", index);\n        return sampleTexture("+n+", uv);\n      }\n  "}(e);case 4:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=t[3],i=t[2]*a,o=t[1]*i,s=ii(t),c=s.newShape,l=s.keptDims;if(c.length<t.length)return"\n      "+Kl(nu(e,c))+"\n      float "+r+"(int row, int col, int depth, int depth2) {\n        return "+r+"("+ru(["row","col","depth","depth2"],l)+");\n      }\n    ";if(e.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col, int depth, int depth2) {\n        int index = round(dot(vec4(row, col, depth, depth2),\n                          vec4("+o+", "+i+", "+a+", 1)));\n        "+eu(e)+"\n      }\n    ";var u=e.shapeInfo.flatOffset,h=e.shapeInfo.texShape,d=h[0],f=h[1];return f===o&&null==u?"\n      float "+r+"(int row, int col, int depth, int depth2) {\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3("+i+", "+a+", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+f+".0, "+d+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":f===a&&null==u?"\n      float "+r+"(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3("+t[1]*t[2]+", "+t[2]+", 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+f+".0, "+d+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":"\n    float "+r+"(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+o+" + col * "+i+" +\n          depth * "+a+" + depth2;\n      vec2 uv = uvFromFlat("+d+", "+f+", index + "+Zl(n)+");\n      return sampleTexture("+n+", uv);\n    }\n  "}(e);case 5:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=t[4],i=t[3]*a,o=t[2]*i,s=t[1]*o,c=ii(t),l=c.newShape,u=c.keptDims;if(l.length<t.length)return"\n      "+Kl(nu(e,l))+"\n      float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n        return "+r+"("+ru(["row","col","depth","depth2","depth3"],u)+");\n      }\n    ";if(e.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n        float index = dot(\n          vec4(row, col, depth, depth2),\n          vec4("+s+", "+o+", "+i+", "+a+")) +\n          depth3;\n        "+eu(e)+"\n      }\n    ";var h=e.shapeInfo.flatOffset,d=e.shapeInfo.texShape,f=d[0],p=d[1];return p===s&&null==h?"\n      float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n                         vec4("+o+", "+i+", "+a+", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+p+".0, "+f+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":p===a&&null==h?"\n      float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n        float texR = dot(\n          vec4(row, col, depth, depth2),\n          vec4("+t[1]*t[2]*t[3]+",\n               "+t[2]*t[3]+", "+t[3]+", 1));\n        int texC = depth3;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+p+".0, "+f+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":"\n    float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+s+" + col * "+o+" + depth * "+i+" +\n          depth2 * "+a+" + depth3 + "+Zl(n)+";\n      vec2 uv = uvFromFlat("+f+", "+p+", index);\n      return sampleTexture("+n+", uv);\n    }\n  "}(e);case 6:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=ii(t),i=a.newShape,o=a.keptDims;if(i.length<t.length)return"\n      "+Kl(nu(e,i))+"\n      float "+r+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        return "+r+"("+ru(["row","col","depth","depth2","depth3","depth4"],o)+");\n      }\n    ";var s=t[5],c=t[4]*s,l=t[3]*c,u=t[2]*l,h=t[1]*u;if(e.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n        int index = round(dot(\n          vec4(row, col, depth, depth2),\n          vec4("+h+", "+u+", "+l+", "+c+")) +\n          dot(\n            vec2(depth3, depth4),\n            vec2("+s+", 1)));\n        "+eu(e)+"\n      }\n    ";var d=e.shapeInfo.flatOffset,f=e.shapeInfo.texShape,p=f[0],m=f[1];return m===h&&null==d?"\n      float "+r+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n          vec4("+u+", "+l+", "+c+", "+s+")) +\n               float(depth4);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+m+".0, "+p+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":m===s&&null==d?"\n      float "+r+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        float texR = dot(vec4(row, col, depth, depth2),\n          vec4("+t[1]*t[2]*t[3]*t[4]+",\n               "+t[2]*t[3]*t[4]+",\n               "+t[3]*t[4]+",\n               "+t[4]+")) + float(depth3);\n        int texC = depth4;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+m+".0, "+p+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":"\n    float "+r+"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+h+" + col * "+u+" + depth * "+l+" +\n          depth2 * "+c+" + depth3 * "+s+" + depth4 + "+Zl(n)+";\n      vec2 uv = uvFromFlat("+p+", "+m+", index);\n      return sampleTexture("+n+", uv);\n    }\n  "}(e);default:throw new Error(t.length+"-D input sampling is not yet supported")}}function Xl(e){var t;switch(e.shapeInfo.logicalShape.length){case 0:return"\n    vec4 "+("get"+(t=e.name).charAt(0).toUpperCase()+t.slice(1))+"() {\n      return "+Wl().texture2D+"("+t+", halfCR);\n    }\n  ";case 1:return function(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),r=e.shapeInfo.texShape,a=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)],i=Wl();return"\n    vec4 "+n+"(int index) {\n      vec2 uv = packedUVfrom1D(\n        "+a[0]+", "+a[1]+", index);\n      return "+i.texture2D+"("+t+", uv);\n    }\n  "}(e);case 2:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=e.shapeInfo.texShape,i=a[0],o=a[1],s=Wl();if(null!=a&&Ja(t,a))return"\n      vec4 "+r+"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2("+o+".0, "+i+".0);\n\n        return "+s.texture2D+"("+n+", uv);\n      }\n    ";var c=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)];return"\n    vec4 "+r+"(int row, int col) {\n      vec2 uv = packedUVfrom2D("+Math.ceil(t[1]/2)+", "+c[0]+", "+c[1]+", row, col);\n      return "+s.texture2D+"("+n+", uv);\n    }\n  "}(e);case 3:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=e.shapeInfo.texShape,i=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)];if(1===t[0])return"\n        "+Xl(nu(e,t.slice(1)))+"\n        vec4 "+r+"(int b, int row, int col) {\n          return "+r+"("+ru(["b","row","col"],[1,2])+");\n        }\n      ";var o=i[0],s=i[1],c=Math.ceil(t[2]/2);return"\n    vec4 "+r+"(int b, int row, int col) {\n      vec2 uv = packedUVfrom3D(\n        "+o+", "+s+", "+c*Math.ceil(t[1]/2)+", "+c+", b, row, col);\n      return "+Wl().texture2D+"("+n+", uv);\n    }\n  "}(e);default:return function(e){for(var t=e.shapeInfo.logicalShape,n=t.length,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=e.shapeInfo.texShape,o=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)],s=o[0],c=o[1],l=Math.ceil(t[n-1]/2),u=l*Math.ceil(t[n-2]/2),h="int b, int row, int col",d="b * "+u+" + (row / 2) * "+l+" + (col / 2)",f=2;f<n-1;f++)h="int b"+f+", "+h,d="b"+f+" * "+(u*=t[n-f-1])+" + "+d;return"\n    vec4 "+a+"("+h+") {\n      int index = "+d+";\n      int texR = index / "+c+";\n      int texC = index - texR * "+c+";\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+c+", "+s+");\n      return "+Wl().texture2D+"("+r+", uv);\n    }\n  "}(e)}}var Yl="\nvec2 uvFromFlat(int texNumR, int texNumC, int index) {\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\nvec2 packedUVfrom1D(int texNumR, int texNumC, int index) {\n  int texelIndex = index / 2;\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",$l="\nvec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,\n  int texNumC, int row, int col) {\n  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",Jl="\nvec2 packedUVfrom3D(int texNumR, int texNumC,\n    int texelsInBatch, int texelsInLogicalRow, int b,\n    int row, int col) {\n  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",Ql="\n  float getChannel(vec4 frag, vec2 innerDims) {\n    vec2 modCoord = mod(innerDims, 2.);\n    return modCoord.x == 0. ?\n      (modCoord.y == 0. ? frag.r : frag.g) :\n      (modCoord.y == 0. ? frag.b : frag.a);\n  }\n  float getChannel(vec4 frag, int dim) {\n    float modCoord = mod(float(dim), 2.);\n    return modCoord == 0. ? frag.r : frag.g;\n  }\n";function Zl(e){return"offset"+e}function eu(e){var t=e.name,n=$a(e.shapeInfo.logicalShape);return n<2?"return "+t+";":"\n    for (int i = 0; i < "+n+"; i++) {\n      if (i == index) {\n        return "+t+"[i];\n      }\n    }\n  "}function tu(e){if(e<=1)return"int";if(2===e)return"ivec2";if(3===e)return"ivec3";if(4===e)return"ivec4";if(5===e)return"ivec5";if(6===e)return"ivec6";throw Error("GPU for rank "+e+" is not yet supported")}function nu(e,t){var n=JSON.parse(JSON.stringify(e));return n.shapeInfo.logicalShape=t,n}function ru(e,t){return t.map(function(t){return e[t]}).join(", ")}var au=function(e,t,n,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,qa(e.length>2,function(){return"Packed arg"+(n.charAt(0).toUpperCase()+n.slice(1))+" supports only inputs with rank above 2."});var a=e[e.length-1],i=Math.ceil(a/t);this.outputShape=e.slice(0,-1),i>1&&this.outputShape.push(i),r||this.variableNames.push("bestIndicesA");var o,s,c=this.outputShape,l=c.length,u=tu(l),h=Ul("coords",l);if(1===i){var d=tu(s=l+1);o="\n        "+d+" sourceLocR = "+d+"("+h.join()+", 0);\n        ++"+h[l-1]+";\n        "+d+" sourceLocG = "+d+"("+h.join()+", 0);\n        ++"+h[l-2]+";\n        "+d+" sourceLocA = "+d+"("+h.join()+", 0);\n        --"+h[l-1]+";\n        "+d+" sourceLocB = "+d+"("+h.join()+", 0);\n        --"+h[l-2]+";"}else s=l,o="\n        "+u+" sourceLocR = coords;\n        ++"+h[l-1]+";\n        "+u+" sourceLocG = coords;\n        ++"+h[l-2]+";\n        "+u+" sourceLocA = coords;\n        --"+h[l-1]+";\n        "+u+" sourceLocB = coords;\n        --"+h[l-2]+";";var f=["x","y","z","w","u","v"].slice(0,s),p="."+f[s-1],m=f.map(function(e){return"int "+e}),g=Ul("sourceLocR",s-1).concat("inIdx.r"),v=Ul("sourceLocG",s-1).concat("inIdx.g"),b=Ul("sourceLocB",s-1).concat("inIdx.b"),y=Ul("sourceLocA",s-1).concat("inIdx.a"),x="max"===n?"greaterThan":"lessThan",w=r?"":"\n          inIdx = round(vec4(getBestIndicesAChannel("+g.join()+"),\n                             getBestIndicesAChannel("+v.join()+"),\n                             getBestIndicesAChannel("+b.join()+"),\n                             getBestIndicesAChannel("+y.join()+")));",k="vec4(\n            getAChannel("+g.join()+"),\n            hasNextCol ? getAChannel("+v.join()+") : 0.,\n            hasNextRow ? getAChannel("+b.join()+") : 0.,\n            hasNextRow && hasNextCol ? getAChannel("+y.join()+") : 0.)",S=r?"":"\n      float getBestIndicesAChannel("+m.join()+") {\n        return getChannel(getBestIndicesA("+f.join()+"),\n                                          vec2("+f.slice(-2).join()+"));\n      }";this.userCode="\n      float getAChannel("+m.join()+") {\n        return getChannel(getA("+f.join()+"),\n                               vec2("+f.slice(-2).join()+"));\n      }\n      "+S+"\n      void main() {\n        "+u+" coords = getOutputCoords();\n        bool hasNextCol = "+h[l-1]+" < "+(c[l-1]-1)+";\n        bool hasNextRow = "+h[l-2]+" < "+(c[l-2]-1)+";\n        "+o+"\n        ivec4 srcIdx = ivec4(sourceLocR"+p+", sourceLocG"+p+",\n          sourceLocB"+p+", sourceLocA"+p+") * "+t+";\n        ivec4 inIdx = srcIdx;\n        vec4 bestIndex = vec4(inIdx);\n        vec4 bestValue = "+k+";\n\n        for (int i = 0; i < "+t+"; i++) {\n          inIdx = srcIdx;\n          "+w+"\n          vec4 candidate = "+k+";\n          bvec4 nan = isnan(candidate);\n          bvec4 replace = bvec4(\n            vec4("+x+"(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));\n\n          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,\n                           replace.y  ? candidate.y : bestValue.y,\n                           replace.z  ? candidate.z : bestValue.z,\n                           replace.w  ? candidate.w : bestValue.w);\n          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));\n          srcIdx++;\n        }\n        setOutput(bestIndex);\n      }\n    "},iu=function(e){this.variableNames=["dy"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,a=e.strideWidth,i=e.dilationHeight,o=e.dilationWidth,s=e.effectiveFilterHeight,c=e.effectiveFilterWidth,l=s-1-e.padInfo.top,u=c-1-e.padInfo.left,h=1/(t*n);this.userCode="\n      const ivec2 pads = ivec2("+l+", "+u+");\n      const float avgMultiplier = float("+h+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+s+";\n            wR += "+i+") {\n          float dyR = float(dyRCorner + wR) / "+r+".0;\n\n          if (dyR < 0.0 || dyR >= "+e.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+c+";\n            wC+= "+o+") {\n            float dyC = float(dyCCorner + wC) / "+a+".0;\n\n            if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n\n            dotProd += dyValue * avgMultiplier;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},ou=function(e){this.variableNames=["dy"],this.outputShape=e.inShape;var t=e.filterDepth,n=e.filterHeight,r=e.filterWidth,a=e.strideDepth,i=e.strideHeight,o=e.strideWidth,s=e.dilationDepth,c=e.dilationHeight,l=e.dilationWidth,u=e.effectiveFilterDepth,h=e.effectiveFilterHeight,d=e.effectiveFilterWidth,f=u-1-e.padInfo.front,p=h-1-e.padInfo.top,m=d-1-e.padInfo.left,g=1/(t*n*r);this.userCode="\n      const ivec3 pads = ivec3("+f+", "+p+", "+m+");\n      const float avgMultiplier = float("+g+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < "+u+";\n            wD += "+s+") {\n          float dyD = float(dyDCorner + wD) / "+a+".0;\n\n          if (dyD < 0.0 || dyD >= "+e.outDepth+".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < "+h+";\n              wR += "+c+") {\n            float dyR = float(dyRCorner + wR) / "+i+".0;\n\n            if (dyR < 0.0 || dyR >= "+e.outHeight+".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < "+d+";\n                wC += "+l+") {\n              float dyC = float(dyCCorner + wC) / "+o+".0;\n\n              if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n\n              dotProd += dyValue * avgMultiplier;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},su=function(e,t,n,r,a,i){this.outputShape=[],this.variableNames=["x","mean","variance"],il(e,t),il(e,n);var o="0.0";null!=r&&(il(e,r),this.variableNames.push("offset"),o="getOffsetAtOutCoords()");var s="1.0";null!=a&&(il(e,a),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=e,this.userCode="\n      void main() {\n        float x = getXAtOutCoords();\n        float mean = getMeanAtOutCoords();\n        float variance = getVarianceAtOutCoords();\n        float offset = "+o+";\n        float scale = "+s+";\n        float inv = scale * inversesqrt(variance + float("+i+"));\n        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));\n      }\n    "},cu=function(e,t,n,r,a,i){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],il(e,t),il(e,n);var o="vec4(0.0)";null!=r&&(il(e,r),this.variableNames.push("offset"),o="getOffsetAtOutCoords()");var s="vec4(1.0)";null!=a&&(il(e,a),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=e,this.userCode="\n      void main() {\n        vec4 offset = "+o+";\n        vec4 scale = "+s+";\n\n        vec4 x = getXAtOutCoords();\n        vec4 mean = getMeanAtOutCoords();\n        vec4 variance = getVarianceAtOutCoords();\n\n        vec4 inv = scale * inversesqrt(variance + vec4("+i+"));\n\n        setOutput((x - mean) * inv + offset);\n      }\n    "},lu=function(e,t,n){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=il(t,n),this.userCode="\n      float binaryOpComplex(\n          float areal, float aimag, float breal, float bimag) {\n        "+e+"\n      }\n\n      void main() {\n        float areal = getARealAtOutCoords();\n        float aimag = getAImagAtOutCoords();\n        float breal = getBRealAtOutCoords();\n        float bimag = getBImagAtOutCoords();\n        setOutput(binaryOpComplex(areal, aimag, breal, bimag));\n      }\n    "},uu="return a + b;",hu="return a - b;",du="return a * b;",fu="return (a < 0.) ? b * a : a;",pu=function(e,t,n){this.variableNames=["A","B"],this.outputShape=il(t,n),this.userCode="\n      float binaryOperation(float a, float b) {\n        "+e+"\n      }\n\n      void main() {\n        float a = getAAtOutCoords();\n        float b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    "},mu="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n",gu=function(e,t,n,r){void 0===r&&(r=!1),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=il(t,n);var a=this.outputShape.length,i="";if(r)if(0===a||1===$a(this.outputShape))i="\n          result.y = 0.;\n          result.z = 0.;\n          result.w = 0.;\n        ";else if(i="\n          "+tu(a)+" coords = getOutputCoords();\n        ",1===a)i+="\n            result.y = (coords + 1) >= "+this.outputShape[0]+" ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          ";else{var o=Ul("coords",a);i+="\n            bool nextRowOutOfBounds =\n              ("+o[a-2]+" + 1) >= "+this.outputShape[a-2]+";\n            bool nextColOutOfBounds =\n              ("+o[a-1]+" + 1) >= "+this.outputShape[a-1]+";\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          "}this.userCode="\n      vec4 binaryOperation(vec4 a, vec4 b) {\n        "+e+"\n      }\n\n      void main() {\n        vec4 a = getAAtOutCoords();\n        vec4 b = getBAtOutCoords();\n\n        vec4 result = binaryOperation(a, b);\n        "+i+"\n\n        setOutput(result);\n      }\n    "},vu=function(){function e(e){this.variableNames=["A"],this.outputShape=e,this.userCode="\n      uniform float minVal;\n      uniform float maxVal;\n\n      void main() {\n        float value = getAAtOutCoords();\n        if (isnan(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, minVal, maxVal));\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e,t){var n=this;return function(r,a){null==n.minLoc&&(n.minLoc=r.getUniformLocationNoThrow(a,"minVal"),n.maxLoc=r.getUniformLocationNoThrow(a,"maxVal")),r.gl.uniform1f(n.minLoc,e),r.gl.uniform1f(n.maxLoc,t)}},e}(),bu=function(){function e(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.userCode="\n      uniform float minVal;\n      uniform float maxVal;\n\n      void main() {\n        vec4 value = getAAtOutCoords();\n\n        if (any(isnan(value))) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e,t){var n=this;return function(r,a){null==n.minLoc&&(n.minLoc=r.getUniformLocationNoThrow(a,"minVal"),n.maxLoc=r.getUniformLocationNoThrow(a,"maxVal")),r.gl.uniform1f(n.minLoc,e),r.gl.uniform1f(n.maxLoc,t)}},e}(),yu=function(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode="\n      void main() {\n        float re = abs(getRealAtOutCoords());\n        float im = abs(getImagAtOutCoords());\n        float mx = max(re, im);\n\n        // sadly the length function in glsl is not underflow-safe\n        // (at least not on Intel GPUs). So the safe solution is\n        // to ensure underflow-safety in all cases.\n        setOutput(\n          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))\n        );\n      }\n    "},xu=function(e){this.outputShape=[],this.outputShape=Cs(e,1),this.variableNames=e.map(function(e,t){return"T"+t});var t=new Array(e.length-1);t[0]=e[0][1];for(var n=1;n<t.length;n++)t[n]=t[n-1]+e[n][1];var r=["if (yC < "+t[0]+") setOutput(getT0(yR, yC));"];for(n=1;n<t.length;n++){var a=t[n-1];r.push("else if (yC < "+t[n]+") setOutput(getT"+n+"(yR, yC-"+a+"));")}var i=t.length,o=t[t.length-1];r.push("else setOutput(getT"+i+"(yR, yC-"+o+"));"),this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int yR = coords.x;\n        int yC = coords.y;\n\n        "+r.join("\n        ")+"\n      }\n    "},wu=function(e,t){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=Cs(e,t);var n=this.outputShape,r=n.length,a=tu(r),i=Ul("coords",r),o=["x","y","z","w","u","v"].slice(0,r);this.variableNames=e.map(function(e,t){return"T"+t});var s=new Array(e.length-1);s[0]=e[0][t];for(var c=1;c<s.length;c++)s[c]=s[c-1]+e[c][t];var l=o[t],u=o.slice(-2),h=o.join(),d="if ("+l+" < "+s[0]+") {\n        return getChannel(\n            getT0("+h+"), vec2("+u.join()+"));\n        }";for(c=1;c<s.length;c++){var f=s[c-1];d+="\n        if ("+l+" < "+s[c]+"  && "+l+" >= "+s[c-1]+") {\n          return getChannel(\n            getT"+c+"("+ku(o,l,f)+"),\n            vec2("+ku(u,l,f)+"));\n        }"}var p=s.length,m=s[s.length-1];d+="\n        return getChannel(\n          getT"+p+"("+ku(o,l,m)+"),\n          vec2("+ku(u,l,m)+"));",this.userCode="\n      float getValue("+o.map(function(e){return"int "+e})+") {\n        "+d+"\n      }\n\n      void main() {\n        "+a+" coords = getOutputCoords();\n        vec4 result = vec4(getValue("+i+"), 0., 0., 0.);\n\n        "+i[r-1]+" = "+i[r-1]+" + 1;\n        if ("+i[r-1]+" < "+n[r-1]+") {\n          result.g = getValue("+i+");\n        }\n\n        "+i[r-2]+" = "+i[r-2]+" + 1;\n        if ("+i[r-2]+" < "+n[r-2]+") {\n          result.a = getValue("+i+");\n        }\n\n        "+i[r-1]+" = "+i[r-1]+" - 1;\n        if ("+i[r-2]+" < "+n[r-2]+" &&\n            "+i[r-1]+" < "+n[r-1]+") {\n          result.b = getValue("+i+");\n        }\n        setOutput(result);\n      }\n    "};function ku(e,t,n){var r=e.indexOf(t);return e.map(function(e,t){return t===r?e+" - "+n:e}).join()}var Su=function(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideHeight,n=e.strideWidth,r=e.padInfo.top,a=e.padInfo.left,i="channelsLast"===e.dataFormat;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int d2 = coords.w;\n\n        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int b = 0; b < "+e.batchSize+"; b++) {\n          for (int yR = 0; yR < "+e.outHeight+"; yR++) {\n            int xR = wR + yR * "+t+" - "+r+";\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+e.outWidth+"; yC++) {\n              int xC = wC + yC * "+n+" - "+a+";\n\n              if (xC < 0 || xC >= "+e.inWidth+") {\n                continue;\n              }\n\n              if ("+i+") {\n                float dyValue = getDy(b, yR, yC, d2);\n                float xValue = getX(b, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              } else {\n                float dyValue = getDy(b, d2, yR, yC);\n                float xValue = getX(b, d1, xR, xC);\n                dotProd += (xValue * dyValue);\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Nu=function(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,a=e.strideWidth,i="channelsLast"===e.dataFormat,o=t-1-e.padInfo.top,s=n-1-e.padInfo.left,c=i?1:2,l=i?2:3,u=i?3:1;this.userCode="\n      const ivec2 pads = ivec2("+o+", "+s+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords["+u+"];\n\n        ivec2 dyCorner = ivec2(coords["+c+"], coords["+l+"]) - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+t+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+r+".0;\n\n          if (dyR < 0.0 || dyR >= "+e.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+t+" - 1 - wR;\n\n          for (int wC = 0; wC < "+n+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+a+".0;\n\n            if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+n+" - 1 - wC;\n\n            for (int d2 = 0; d2 < "+e.outChannels+"; d2++) {\n\n              if ("+i+") {\n                float xValue = getDy(batch, idyR, idyC, d2);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              } else {\n                float xValue = getDy(batch, d2, idyR, idyC);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Cu=function(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideDepth,n=e.strideHeight,r=e.strideWidth,a=e.padInfo.front,i=e.padInfo.top,o=e.padInfo.left;this.userCode="\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int wF = coords.x;\n        int wR = coords.y;\n        int wC = coords.z;\n        int d1 = coords.w;\n        int d2 = coords.u;\n\n        float dotProd = 0.0;\n\n        for (int b = 0; b < "+e.batchSize+"; b++) {\n          for (int yF = 0; yF < "+e.outDepth+"; yF++) {\n            int xF = wF + yF * "+t+" - "+a+";\n\n            if (xF < 0 || xF >= "+e.inDepth+") {\n              continue;\n            }\n\n            for (int yR = 0; yR < "+e.outHeight+"; yR++) {\n              int xR = wR + yR * "+n+" - "+i+";\n\n              if (xR < 0 || xR >= "+e.inHeight+") {\n                continue;\n              }\n\n              for (int yC = 0; yC < "+e.outWidth+"; yC++) {\n                int xC = wC + yC * "+r+" - "+o+";\n\n                if (xC < 0 || xC >= "+e.inWidth+") {\n                  continue;\n                }\n\n                float dyValue = getDy(b, yF, yR, yC, d2);\n                float xValue = getX(b, xF, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Eu=function(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterDepth,n=e.filterHeight,r=e.filterWidth,a=e.strideDepth,i=e.strideHeight,o=e.strideWidth,s=t-1-e.padInfo.front,c=n-1-e.padInfo.top,l=r-1-e.padInfo.left;this.userCode="\n      const ivec3 pads = ivec3("+s+", "+c+", "+l+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.u;\n\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyFCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        float dotProd = 0.0;\n        for (int wF = 0; wF < "+t+"; wF++) {\n          float dyF = float(dyFCorner + wF) / "+a+".0;\n\n          if (dyF < 0.0 || dyF >= "+e.outDepth+".0 || fract(dyF) > 0.0) {\n            continue;\n          }\n          int idyF = int(dyF);\n\n          int wFPerm = "+t+" - 1 - wF;\n\n          for (int wR = 0; wR < "+n+"; wR++) {\n            float dyR = float(dyRCorner + wR) / "+i+".0;\n\n            if (dyR < 0.0 || dyR >= "+e.outHeight+".0 ||\n              fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            int wRPerm = "+n+" - 1 - wR;\n\n            for (int wC = 0; wC < "+r+"; wC++) {\n              float dyC = float(dyCCorner + wC) / "+o+".0;\n\n              if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              int wCPerm = "+r+" - 1 - wC;\n\n              for (int d2 = 0; d2 < "+e.outChannels+"; d2++) {\n                float xValue = getDy(batch, idyF, idyR, idyC, d2);\n                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Iu=function(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideHeight,n=e.strideWidth,r=e.padInfo.top,a=e.padInfo.left,i=e.outChannels/e.inChannels;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int dm = coords.w;\n        int d2 = d1 * "+i+" + dm;\n\n        float dotProd = 0.0;\n\n        // TO DO: Vec4 over the batch size\n        for (int b = 0; b < "+e.batchSize+"; b++) {\n          for (int yR = 0; yR < "+e.outHeight+"; yR++) {\n            int xR = wR + yR * "+t+" - "+r+";\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+e.outWidth+"; yC++) {\n              int xC = wC + yC * "+n+" - "+a+";\n\n              if (xC < 0 || xC >= "+e.inWidth+") {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Tu=function(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,a=e.strideWidth,i=t-1-e.padInfo.top,o=n-1-e.padInfo.left,s=e.outChannels/e.inChannels;this.userCode="\n      const ivec2 pads = ivec2("+i+", "+o+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        float dotProd = 0.0;\n\n        for (int wR = 0; wR < "+t+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+r+".0;\n\n          if (dyR < 0.0 || dyR >= "+e.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+t+" - 1 - wR;\n\n          for (int wC = 0; wC < "+n+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+a+".0;\n\n            if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+n+" - 1 - wC;\n\n            // TO DO: Vec4 over the channelMul\n            for (int dm = 0; dm < "+s+"; dm++) {\n              int d2 = d1 * "+s+" + dm;\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, dm);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},_u=function(e,t,n,r){void 0===t&&(t=!1),void 0===n&&(n=null),void 0===r&&(r=!1),this.variableNames=["x","W"],this.outputShape=e.outShape;var a=e.padInfo.top,i=e.padInfo.left,o=e.strideHeight,s=e.strideWidth,c=e.dilationHeight,l=e.dilationWidth,u=e.filterHeight,h=e.filterWidth,d=4*Math.floor(e.inChannels/4),f=e.inChannels%4,p="channelsLast"===e.dataFormat,m=p?1:2,g=p?2:3,v=p?3:1,b="",y="";n&&(b=r?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          "+n+"\n        }":"\n          float activation(float x) {\n            "+n+"\n          }\n        ",y="result = activation(result);");var x=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+b+"\n\n      const ivec2 strides = ivec2("+o+", "+s+");\n      const ivec2 pads = ivec2("+a+", "+i+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d2 = coords["+v+"];\n\n        ivec2 xRCCorner =\n            ivec2(coords["+m+"], coords["+g+"]) * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+u+"; wR++) {\n          int xR = xRCorner + wR * "+c+";\n\n          if (xR < 0 || xR >= "+e.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+h+"; wC++) {\n            int xC = xCCorner + wC * "+l+";\n\n            if (xC < 0 || xC >= "+e.inWidth+") {\n              continue;\n            }\n\n            for (int d1 = 0; d1 < "+d+"; d1 += 4) {\n              vec4 wValues = vec4(\n                getW(wR, wC, d1, d2),\n                getW(wR, wC, d1 + 1, d2),\n                getW(wR, wC, d1 + 2, d2),\n                getW(wR, wC, d1 + 3, d2)\n              );\n\n              if ("+p+") {\n                vec4 xValues = vec4(\n                  getX(batch, xR, xC, d1),\n                  getX(batch, xR, xC, d1 + 1),\n                  getX(batch, xR, xC, d1 + 2),\n                  getX(batch, xR, xC, d1 + 3)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec4 xValues = vec4(\n                  getX(batch, d1, xR, xC),\n                  getX(batch, d1 + 1, xR, xC),\n                  getX(batch, d1 + 2, xR, xC),\n                  getX(batch, d1 + 3, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n\n            if ("+(1===f)+") {\n\n              if ("+p+") {\n                dotProd +=\n                    getX(batch, xR, xC, "+d+") *\n                    getW(wR, wC, "+d+", d2);\n              } else {\n                dotProd +=\n                    getX(batch, "+d+", xR, xC) *\n                    getW(wR, wC, "+d+", d2);\n              }\n\n            } else if ("+(2===f)+") {\n              vec2 wValues = vec2(\n                getW(wR, wC, "+d+", d2),\n                getW(wR, wC, "+d+" + 1, d2)\n              );\n\n              if ("+p+") {\n                vec2 xValues = vec2(\n                  getX(batch, xR, xC, "+d+"),\n                  getX(batch, xR, xC, "+d+" + 1)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec2 xValues = vec2(\n                  getX(batch, "+d+", xR, xC),\n                  getX(batch, "+d+" + 1, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            } else if ("+(3===f)+") {\n              vec3 wValues = vec3(\n                getW(wR, wC, "+d+", d2),\n                getW(wR, wC, "+d+" + 1, d2),\n                getW(wR, wC, "+d+" + 2, d2)\n              );\n\n              if ("+p+") {\n                vec3 xValues = vec3(\n                  getX(batch, xR, xC, "+d+"),\n                  getX(batch, xR, xC, "+d+" + 1),\n                  getX(batch, xR, xC, "+d+" + 2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec3 xValues = vec3(\n                  getX(batch, "+d+", xR, xC),\n                  getX(batch, "+d+" + 1, xR, xC),\n                  getX(batch, "+d+" + 2, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            }\n          }\n        }\n\n        float result = dotProd;\n        "+x+"\n        "+y+"\n        setOutput(result);\n      }\n    "},Au=function(e){this.variableNames=["x","W"],this.outputShape=e.outShape;var t=e.padInfo.front,n=e.padInfo.top,r=e.padInfo.left,a=e.strideDepth,i=e.strideHeight,o=e.strideWidth,s=e.dilationDepth,c=e.dilationHeight,l=e.dilationWidth,u=e.filterDepth,h=e.filterHeight,d=e.filterWidth,f=4*Math.floor(e.inChannels/4),p=e.inChannels%4;this.userCode="\n      const ivec3 strides = ivec3("+a+", "+i+", "+o+");\n      const ivec3 pads = ivec3("+t+", "+n+", "+r+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d2 = coords.u;\n\n        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xFCorner = xFRCCorner.x;\n        int xRCorner = xFRCCorner.y;\n        int xCCorner = xFRCCorner.z;\n\n        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get\n        // y(yF, yR, yC, d2). ? = to be determined. : = across all\n        // values in that axis.\n        float dotProd = 0.0;\n        for (int wF = 0; wF < "+u+"; wF++) {\n          int xF = xFCorner + wF * "+s+";\n\n          if (xF < 0 || xF >= "+e.inDepth+") {\n            continue;\n          }\n\n          for (int wR = 0; wR < "+h+"; wR++) {\n            int xR = xRCorner + wR * "+c+";\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+d+"; wC++) {\n              int xC = xCCorner + wC * "+l+";\n\n              if (xC < 0 || xC >= "+e.inWidth+") {\n                continue;\n              }\n\n              for (int d1 = 0; d1 < "+f+"; d1 += 4) {\n                vec4 xValues = vec4(\n                  getX(batch, xF, xR, xC, d1),\n                  getX(batch, xF, xR, xC, d1 + 1),\n                  getX(batch, xF, xR, xC, d1 + 2),\n                  getX(batch, xF, xR, xC, d1 + 3)\n                );\n                vec4 wValues = vec4(\n                  getW(wF, wR, wC, d1, d2),\n                  getW(wF, wR, wC, d1 + 1, d2),\n                  getW(wF, wR, wC, d1 + 2, d2),\n                  getW(wF, wR, wC, d1 + 3, d2)\n                );\n\n                dotProd += dot(xValues, wValues);\n              }\n\n              if ("+(1===p)+") {\n                dotProd +=\n                  getX(batch, xF, xR, xC, "+f+") *\n                  getW(wF, wR, wC, "+f+", d2);\n              } else if ("+(2===p)+") {\n                vec2 xValues = vec2(\n                  getX(batch, xF, xR, xC, "+f+"),\n                  getX(batch, xF, xR, xC, "+f+" + 1)\n                );\n                vec2 wValues = vec2(\n                  getW(wF, wR, wC, "+f+", d2),\n                  getW(wF, wR, wC, "+f+" + 1, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else if ("+(3===p)+") {\n                vec3 xValues = vec3(\n                  getX(batch, xF, xR, xC, "+f+"),\n                  getX(batch, xF, xR, xC, "+f+" + 1),\n                  getX(batch, xF, xR, xC, "+f+" + 2)\n                );\n                vec3 wValues = vec3(\n                  getW(wF, wR, wC, "+f+", d2),\n                  getW(wF, wR, wC, "+f+" + 1, d2),\n                  getW(wF, wR, wC, "+f+" + 2, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Ru=function(e,t,n,r){void 0===t&&(t=!1),void 0===n&&(n=null),void 0===r&&(r=!1),this.variableNames=["x","W"],this.outputShape=e.outShape;var a=e.inHeight,i=e.inWidth,o=e.padInfo.top,s=e.padInfo.left,c=e.strideHeight,l=e.strideWidth,u=e.dilationHeight,h=e.dilationWidth,d=e.filterHeight,f=e.filterWidth,p=e.outChannels/e.inChannels,m="",g="";n&&(m=r?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          "+n+"\n        }":"\n          float activation(float x) {\n            "+n+"\n          }\n        ",g="result = activation(result);");var v=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+m+"\n\n      const ivec2 strides = ivec2("+c+", "+l+");\n      const ivec2 pads = ivec2("+o+", "+s+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / "+p+";\n        int q = d2 - d1 * "+p+";\n\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.\n        for (int wR = 0; wR < "+d+"; wR++) {\n          int xR = xRCorner + wR * "+u+";\n\n          if (xR < 0 || xR >= "+a+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+f+"; wC++) {\n            int xC = xCCorner + wC * "+h+";\n\n            if (xC < 0 || xC >= "+i+") {\n              continue;\n            }\n\n            float xVal = getX(batch, xR, xC, d1);\n            float wVal = getW(wR, wC, d1, q);\n            dotProd += xVal * wVal;\n          }\n        }\n\n        float result = dotProd;\n        "+v+"\n        "+g+"\n        setOutput(result);\n      }\n    "},Fu=function(e,t,n,r){void 0===t&&(t=!1),void 0===n&&(n=null),void 0===r&&(r=!1),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e.outShape;for(var a=e.inHeight,i=e.inWidth,o=e.padInfo.top,s=e.padInfo.left,c=e.strideHeight,l=e.strideWidth,u=e.dilationHeight,h=e.dilationWidth,d=e.filterHeight,f=e.filterWidth,p=f,m="int xR; int xC; int xCOffset;",g=0;g<d;g++)for(var v=0;v<f;v++)m+="\n          vec4 xTexelR"+g+"C"+2*v+" = vec4(0.);\n          vec4 wR"+g+"C"+v+" = vec4(0.);\n          vec4 xR"+g+"C"+v+" = vec4(0.);";for(g=0;g<d;g++)for(var b=0;b<p;b++){if(m+="\n          xR = xRCorner + "+g*u+";\n          xC = xCCorner + "+(v=2*b)*h+";\n        ",1===l){if(v<f&&(m+=s%2==1?"\n                xCOffset = xC + 1;\n                if(xR >= 0 && xR < "+a+" && xCOffset >= 0 && xCOffset < "+i+") {\n                  xTexelR"+g+"C"+v+" = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if(xCOffset + 1 >= "+i+") {\n                    xTexelR"+g+"C"+v+".zw = vec2(0.);\n                  }\n                } else {\n                  xTexelR"+g+"C"+v+" = vec4(0.);\n                }\n\n                xCOffset = xC + 1 - 2;\n                if(xR >= 0 && xR < "+a+" && xCOffset >= 0 && xCOffset < "+i+") {\n                  vec4 previous = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if(xCOffset + 1 >= "+i+") {\n                    previous.zw = vec2(0.);\n                  }\n\n                  xR"+g+"C"+v+" = vec4(previous.zw, xTexelR"+g+"C"+v+".xy);\n                } else {\n                  xR"+g+"C"+v+" = vec4(0, 0, xTexelR"+g+"C"+v+".xy);\n                }\n              ":"\n                if(xR >= 0 && xR < "+a+" && xC >= 0 && xC < "+i+") {\n                  xTexelR"+g+"C"+v+" = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR"+g+"C"+v+" = vec4(0.);\n                }\n\n                xR"+g+"C"+v+" = xTexelR"+g+"C"+v+";\n              ",v+1<f)){var y=s%2==0?Ha(h):h;h%2==0&&s%2==1||h%2!=0&&s%2!=1?(m+="\n                  xCOffset = xC + "+s%2+" + "+y+";\n\n                  if(xR >= 0 && xR < "+a+" &&\n                    xCOffset >= 0 && xCOffset < "+i+") {\n                    xTexelR"+g+"C"+(v+2)+" = getX(batch, xR, xCOffset, d1);\n                  }\n                ",h>1&&(m+="\n                    xCOffset -= 2;\n                    if(xR >= 0 && xR < "+a+" &&\n                      xCOffset >= 0 && xCOffset < "+i+") {\n                      xTexelR"+g+"C"+v+" = getX(batch, xR, xCOffset, d1);\n                    } else {\n                      xTexelR"+g+"C"+v+" = vec4(0.);\n                    }\n                  "),m+="\n                  xR"+g+"C"+(v+1)+" = vec4(\n                    xTexelR"+g+"C"+v+".zw, xTexelR"+g+"C"+(v+2)+".xy);\n                "):m+="\n                  xCOffset = xC + "+y+";\n\n                  if(xR >= 0 && xR < "+a+" &&\n                    xCOffset >= 0 && xCOffset < "+i+") {\n                    xTexelR"+g+"C"+(v+2)+" = getX(batch, xR, xCOffset, d1);\n                  }\n\n                  xR"+g+"C"+(v+1)+" = xTexelR"+g+"C"+(v+2)+";\n                "}}else v<f&&(m+="\n              if(xR >= 0 && xR < "+a+") {\n            ",s%2==1?(m+="\n                xCOffset = xC + 1 - "+l+";\n                if(xCOffset >= 0 && xCOffset < "+i+") {\n                  xTexelR"+g+"C"+v+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+g+"C"+v+" = vec4(0.);\n                }\n\n                if(xC + 1 >= 0 && xC + 1 < "+i+") {\n                  xTexelR"+g+"C"+(v+2)+" = getX(batch, xR, xC + 1, d1);\n                } else {\n                  xTexelR"+g+"C"+(v+2)+" = vec4(0.);\n                }\n\n                xR"+g+"C"+v+" = vec4(\n                  xTexelR"+g+"C"+v+".zw, xTexelR"+g+"C"+(v+2)+".zw);\n              ",v+1<f&&(m+="\n                  vec4 final = vec4(0.);\n                  xCOffset = xC + 1 + "+l+";\n                  if(xCOffset >= 0 && xCOffset < "+i+") {\n                    final = getX(batch, xR, xCOffset, d1);\n                  }\n                  xR"+g+"C"+(v+1)+" = vec4(xTexelR"+g+"C"+(v+2)+".xy, final.xy);\n                ")):(m+="\n                if(xC >= 0 && xC < "+i+") {\n                  xTexelR"+g+"C"+v+" = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR"+g+"C"+v+" = vec4(0.);\n                }\n\n                xCOffset = xC + "+l+";\n                if(xCOffset >= 0 && xCOffset < "+i+") {\n                  xTexelR"+g+"C"+(v+2)+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+g+"C"+(v+2)+" = vec4(0.);\n                }\n\n                xR"+g+"C"+v+" = vec4(\n                  xTexelR"+g+"C"+v+".xy, xTexelR"+g+"C"+(v+2)+".xy);\n              ",v+1<f&&(m+="\n                  xR"+g+"C"+(v+1)+" = vec4(\n                    xTexelR"+g+"C"+v+".zw, xTexelR"+g+"C"+(v+2)+".zw);\n                ")),m+="}");v<f&&(m+="\n            vec4 wTexelR"+g+"C"+v+" = getW("+g+", "+v+", d1, q);\n            wR"+g+"C"+v+" = vec4(wTexelR"+g+"C"+v+".xz, wTexelR"+g+"C"+v+".xz);\n          ",v+1<f&&(m+="\n              vec4 wTexelR"+g+"C"+(v+1)+" = getW("+g+", "+(v+1)+", d1, q);\n              wR"+g+"C"+(v+1)+" =\n                vec4(wTexelR"+g+"C"+(v+1)+".xz, wTexelR"+g+"C"+(v+1)+".xz);"))}for(g=0;g<d;g++)for(v=0;v<f;v++)m+="dotProd += xR"+g+"C"+v+" * wR"+g+"C"+v+";";var x="",w="";n&&(x=r?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          "+n+"\n        }":"vec4 activation(vec4 x) {\n          "+n+"\n        }",w="result = activation(result);");var k=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+x+"\n\n      const ivec2 strides = ivec2("+c+", "+l+");\n      const ivec2 pads = ivec2("+o+", "+s+");\n\n      void main() {\n\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2;\n        int q = 0;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        vec4 dotProd = vec4(0.);\n\n        "+m+"\n\n        vec4 result = dotProd;\n        "+k+"\n        "+w+"\n        setOutput(result);\n      }\n    "},Du=function(e,t,n,r,a){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var i=e[0],o=e[1],s=e[2],c=e[3],l=t[0],u=n[0],h=n[1];this.outputShape=[l,u,h,c];var d="bilinear"===r?1:0,f=[o-1+".0",s-1+".0"],p=f[0],m=f[1],g=u>1?[""+(o-1)/(u-1),"(y2-y1) * height_ratio","y1*"+p+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+p],v=g[0],b=g[1],y=g[2],x=h>1?[""+(s-1)/(h-1),"(x2-x1) * width_ratio","x1*"+m+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+m],w=x[0],k=x[1],S=x[2];this.userCode="\n      const float height_ratio = float("+v+");\n      const float width_ratio = float("+w+");\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int y = coords[1];\n        int x = coords[2];\n        int d = coords[3];\n\n        // get box vals\n        float y1 = getBoxes(b,0);\n        float x1 = getBoxes(b,1);\n        float y2 = getBoxes(b,2);\n        float x2 = getBoxes(b,3);\n\n        // get image in batch index\n        int bInd = round(getBoxInd(b));\n        if(bInd < 0 || bInd >= "+i+") {\n          return;\n        }\n\n        float height_scale = "+b+";\n        float width_scale = "+k+";\n\n        float in_y = "+y+";\n        if( in_y < 0.0 || in_y > "+p+" ) {\n          setOutput(float("+a+"));\n          return;\n        }\n        float in_x = "+S+";\n        if( in_x < 0.0 || in_x > "+m+" ) {\n          setOutput(float("+a+"));\n          return;\n        }\n\n        vec2 sourceFracIndexCR = vec2(in_x,in_y);\n        if("+d+" == 1) {\n          // Compute the four integer indices.\n          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);\n          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));\n\n          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);\n          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);\n          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);\n          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);\n\n          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);\n\n          float top = topLeft + (topRight - topLeft) * fracCR.x;\n          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;\n          float newValue = top + (bottom - top) * fracCR.y;\n          setOutput(newValue);\n        } else {\n          // Compute the coordinators of nearest neighbor point.\n          ivec2 sourceNearestCR = ivec2(floor(\n            sourceFracIndexCR + vec2(0.5,0.5)));\n          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);\n          setOutput(newValue);\n        }\n      }\n    "},Ou=function(e,t,n){this.variableNames=["x"],this.outputShape=e;var r=e.length,a=e[e.length-1],i=n?"<":">";this.userCode="\n      int getIndex(int i) {\n        "+(n?"return "+a+" -i - 1;":"return i;")+"\n      }\n\n      void main() {\n        "+tu(r)+" coords = getOutputCoords();\n        int end = "+Lu(r,"coords")+";\n        float val = 0.0;\n        for (int i = "+a+" - 1; i >= 0; i -= 1) {\n          int idx = getIndex(i);\n          if (idx "+i+" end) {\n            continue;\n          }\n          if (idx == end && "+t+") {\n            continue;\n          }\n          "+Lu(r,"coords")+" = idx;\n          val += getX("+function(e,t){if(1===e)return""+t;if(2===e)return t+".x, "+t+".y";if(3===e)return t+".x, "+t+".y, "+t+".z";if(4===e)return t+".x, "+t+".y, "+t+".z, "+t+".w";throw Error("Cumulative sum for rank "+e+" is not yet supported")}(r,"coords")+");\n        }\n        setOutput(val);\n      }\n    "};function Lu(e,t){if(1===e)return""+t;if(2===e)return t+".y";if(3===e)return t+".z";if(4===e)return t+".w";throw Error("Cumulative sum for rank "+e+" is not yet supported")}var Pu=function(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=io.DENSE;var t=po(e),n=Wl();this.outputShape=e,this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        "+Vl(["r","c","d"],e)+"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2("+t[0]+", "+t[1]+"));\n        int index = 4 * (resTexRC.x * "+t[1]+" + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getA(rc.x, rc.y, rc.z);\n        }\n\n        "+n.output+" = result;\n      }\n    "},Mu=function(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=io.DENSE;var t=po(e),n=Wl();this.outputShape=e,this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        "+Vl(["r","c","d"],e)+"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2("+t[0]+", "+t[1]+"));\n        int index = 4 * (resTexRC.x * "+t[1]+" + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));\n        }\n\n        "+n.output+" = result;\n      }\n    "},ju=function(){function e(e,t,n){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=t,this.dataFormat=n,this.userCode="\n    void main() {\n      ivec4 coords = getOutputCoords();\n      int b = coords[0];\n      int h = "+this.getHeightCoordString()+";\n      int w = "+this.getWidthCoordString()+";\n      int d = "+this.getDepthCoordString()+";\n\n      int in_h = h / "+t+";\n      int offset_h = imod(h, "+t+");\n      int in_w = w / "+t+";\n      int offset_w = imod(w, "+t+");\n      int offset_d = (offset_h * "+t+" + offset_w) *\n        "+this.getOutputDepthSize()+";\n      int in_d = d + offset_d;\n\n      float result = "+this.getInputSamplingString()+";\n      setOutput(result);\n    }\n  "}return e.prototype.getHeightCoordString=function(){return"NHWC"===this.dataFormat?"coords[1]":"coords[2]"},e.prototype.getWidthCoordString=function(){return"NHWC"===this.dataFormat?"coords[2]":"coords[3]"},e.prototype.getDepthCoordString=function(){return"NHWC"===this.dataFormat?"coords[3]":"coords[1]"},e.prototype.getOutputDepthSize=function(){return"NHWC"===this.dataFormat?this.outputShape[3]:this.outputShape[1]},e.prototype.getInputSamplingString=function(){return"NHWC"===this.dataFormat?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},e}(),Bu=function(e){this.variableNames=["X"],this.outputShape=[e,e],this.userCode="\n      void main() {\n          ivec2 coords = getOutputCoords();\n          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;\n          setOutput(val);\n      }\n    "},zu=function(e){this.variableNames=["A"],this.outTexUsage=oo.DOWNLOAD;var t=Wl();this.outputShape=e,this.userCode="\n      "+Gl+"\n\n      void main() {\n        float x = getAAtOutCoords();\n        "+t.output+" = encode_float(x);\n      }\n    "},Uu=function(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=oo.DOWNLOAD;var t=Wl();this.outputShape=e,this.userCode="\n      "+Gl+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));\n        "+t.output+" = encode_float(x);\n      }\n    "},Wu=function(e,t,n){void 0===n&&(n=!1),this.variableNames=["A"];var r=Wl(),a=t[0],i=t[1];this.outputShape=e;var o="result";n&&(o="floor(result * 255. + 0.5)"),this.userCode="\n      "+Hl(e)+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        int flatIndex = getFlatIndex(coords);\n        int offset = imod(flatIndex, 4);\n\n        flatIndex = idiv(flatIndex, 4, 1.);\n        \n        int r = flatIndex / "+i+";\n        int c = imod(flatIndex, "+i+");\n        vec2 uv = (vec2(c, r) + halfCR) / vec2("+i+".0, "+a+".0);\n        vec4 values = "+r.texture2D+"(A, uv);\n\n        float result;\n\n        if(offset == 0) {\n          result = values[0];\n        } else if(offset == 1) {\n          result = values[1];\n        } else if(offset == 2) {\n          result = values[2];\n        } else {\n          result = values[3];\n        }\n\n        "+r.output+" = vec4("+o+", 0., 0., 0.);\n      }\n    "},Vu=function(e,t,n){void 0===n&&(n=!1),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var r=Wl(),a=t[0],i=t[1];this.outputShape=e;var o="",s="result";n&&(s="floor(result * 255. + 0.5)");for(var c=0;c<=1;c++)for(var l=0;l<=1;l++){var u=2*c+l;o+="\n          localCoords = coords;\n          if(localCoords[2] + "+l+" < "+e[2]+") {\n            localCoords[2] += "+l+";\n            if(localCoords[1] + "+c+" < "+e[1]+") {\n              localCoords[1] += "+c+";\n\n              flatIndex = getFlatIndex(localCoords);\n              offset = imod(flatIndex, 4);\n\n              flatIndex = idiv(flatIndex, 4, 1.);\n\n              r = flatIndex / "+i+";\n              c = imod(flatIndex, "+i+");\n              uv = (vec2(c, r) + halfCR) / vec2("+i+".0, "+a+".0);\n              values = "+r.texture2D+"(A, uv);\n\n              if(offset == 0) {\n                result["+u+"] = values[0];\n              } else if(offset == 1) {\n                result["+u+"] = values[1];\n              } else if(offset == 2) {\n                result["+u+"] = values[2];\n              } else {\n                result["+u+"] = values[3];\n              }\n            }\n          }\n        "}this.userCode="\n      "+Hl(e)+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        vec4 result = vec4(0.);\n        int flatIndex, r, c, offset;\n        ivec3 localCoords;\n        vec2 uv;\n        vec4 values;\n\n        "+o+"\n\n        "+r.output+" = "+s+";\n      }\n    "},Hu=function(e,t,n){this.variableNames=["real","imag"];var r=t[1];this.outputShape=t;var a=n?"2.0 * "+Math.PI:"-2.0 * "+Math.PI,i=n?r+".0":"1.0";this.userCode="\n      const float exponentMultiplier = "+a+";\n\n      float unaryOpComplex(float real, float expR, float imag, float expI) {\n        "+e+"\n      }\n\n      float mulMatDFT(int batch, int index) {\n        float indexRatio = float(index) / float("+r+");\n        float exponentMultiplierTimesIndexRatio =\n            exponentMultiplier * indexRatio;\n\n        float result = 0.0;\n\n        for (int i = 0; i < "+r+"; i++) {\n          // x = (-2|2 * PI / N) * index * i;\n          float x = exponentMultiplierTimesIndexRatio * float(i);\n          float expR = cos(x);\n          float expI = sin(x);\n          float real = getReal(batch, i);\n          float imag = getImag(batch, i);\n\n          result +=\n              unaryOpComplex(real, expR, imag, expI) / "+i+";\n        }\n\n        return result;\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        setOutput(mulMatDFT(coords[0], coords[1]));\n      }\n    "},Gu=function(){function e(e,t){this.outputShape=[],this.variableNames=["x"],this.outputShape=e,this.userCode="\n      uniform float value;\n      void main() {\n        // Input can be obtained from uniform value.\n        setOutput(value);\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e){var t=this;return function(n,r){null==t.valueLoc&&(t.valueLoc=n.getUniformLocationNoThrow(r,"value")),n.gl.uniform1f(t.valueLoc,e)}},e}(),qu=function(e,t,n){this.variableNames=["A","indices"];var r=e.slice();r[n]=t,this.outputShape=r,this.rank=r.length;var a=tu(this.rank),i=function(e,t){var n=e.length;if(n>4)throw Error("Gather for rank "+n+" is not yet supported");if(1===n)return"int(getIndices(resRC))";for(var r=["resRC.x","resRC.y","resRC.z","resRC.w"],a=[],i=0;i<e.length;i++)i===t?a.push("int(getIndices("+r[i]+"))"):a.push(""+r[i]);return a.join()}(e,n);this.userCode="\n      void main() {\n        "+a+" resRC = getOutputCoords();\n        setOutput(getA("+i+"));\n      }\n    "},Ku=function(e,t,n){this.sliceDim=e,this.strides=t,this.variableNames=["x","indices"],this.outputShape=n;var r=tu(t.length),a=tu(n.length),i=this.sliceDim>1?"strides[j]":"strides";this.userCode="\n        "+r+" strides = "+r+"("+this.strides+");\n         void main() {\n          "+a+" coords = getOutputCoords();\n          int flattenIndex = 0;\n          for (int j = 0; j < "+this.sliceDim+"; j++) {\n            int index = round(getIndices(coords[0], j));\n            flattenIndex += index * "+i+";\n          }\n          setOutput(getX(flattenIndex, coords[1]));\n        }\n      "};function Xu(e,t){var n=Wl();return wo(e,t,n.version+"\n    precision highp float;\n    "+n.attribute+" vec3 clipSpacePos;\n    "+n.attribute+" vec2 uv;\n    "+n.varyingVs+" vec2 resultUV;\n\n    void main() {\n      gl_Position = vec4(clipSpacePos, 1);\n      resultUV = uv;\n    }")}function Yu(e,t){return _o(e,t,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function $u(e,t){return Ao(e,t,new Uint16Array([0,1,2,2,1,3]))}function Ju(e,t,n,r,a,i,o){Fo(n,r);var s=Ro(e,t),c=e.TEXTURE_2D;return vo(e,t,function(){return e.bindTexture(c,s)}),vo(e,t,function(){return e.texParameteri(c,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE)}),vo(e,t,function(){return e.texParameteri(c,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)}),vo(e,t,function(){return e.texParameteri(c,e.TEXTURE_MIN_FILTER,e.NEAREST)}),vo(e,t,function(){return e.texParameteri(c,e.TEXTURE_MAG_FILTER,e.NEAREST)}),vo(e,t,function(){return e.texImage2D(c,0,a,n,r,0,i,o,null)}),vo(e,t,function(){return e.bindTexture(e.TEXTURE_2D,null)}),s}function Qu(e,t,n,r,a){var i=fo(n,r);return Ju(e,t,i[0],i[1],a.internalFormatFloat,a.textureFormatFloat,e.FLOAT)}function Zu(e,t,n,r,a){var i=fo(n,r);return Ju(e,t,i[0],i[1],a.internalFormatHalfFloat,a.textureFormatFloat,a.textureTypeHalfFloat)}function eh(e,t,n,r,a){var i=fo(n,r);return Ju(e,t,i[0],i[1],e.RGBA,e.RGBA,e.UNSIGNED_BYTE)}function th(e,t,n,r,a){var i=mo(n,r);return Ju(e,t,i[0],i[1],a.internalFormatPackedFloat,e.RGBA,e.FLOAT)}function nh(e,t,n,r,a){var i=mo(n,r);return Ju(e,t,i[0],i[1],a.internalFormatPackedHalfFloat,e.RGBA,a.textureTypeHalfFloat)}function rh(e,t,n,r){return vo(e,t,function(){return e.bindBuffer(e.ARRAY_BUFFER,r)}),Oo(e,t,n,"clipSpacePos",r,3,20,0)&&Oo(e,t,n,"uv",r,2,20,12)}function ah(e,t,n,r,a,i,o){var s,c,l;vo(e,t,function(){return e.bindTexture(e.TEXTURE_2D,n)}),i instanceof Uint8Array?(s=new Uint8Array(r*a*4),c=e.UNSIGNED_BYTE,l=e.RGBA):(s=new Float32Array(r*a*4),c=e.FLOAT,l=o.internalFormatPackedFloat),s.set(i),vo(e,t,function(){return e.texImage2D(e.TEXTURE_2D,0,l,r,a,0,e.RGBA,c,s)}),vo(e,t,function(){return e.bindTexture(e.TEXTURE_2D,null)})}function ih(e,t,n,r){vo(e,t,function(){return e.bindTexture(e.TEXTURE_2D,n)}),r.data instanceof Uint8Array?vo(e,t,function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,r.width,r.height,0,e.RGBA,e.UNSIGNED_BYTE,r.data)}):vo(e,t,function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,r)}),vo(e,t,function(){return e.bindTexture(e.TEXTURE_2D,null)})}function oh(e,t,n,r,a){var i=e.createBuffer();vo(e,t,function(){return e.bindBuffer(e.PIXEL_PACK_BUFFER,i)});var o=16*n*r;return vo(e,t,function(){return e.bufferData(e.PIXEL_PACK_BUFFER,o,e.STREAM_READ)}),vo(e,t,function(){return e.readPixels(0,0,r,n,e.RGBA,e.FLOAT,0)}),vo(e,t,function(){return e.bindBuffer(e.PIXEL_PACK_BUFFER,null)}),i}function sh(e,t,n){var r=e,a=new Float32Array(n);return r.bindBuffer(r.PIXEL_PACK_BUFFER,t),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,a),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),a}function ch(e,t,n,r,a){var i=fo(n,r),o=i[0],s=i[1],c=new Uint8Array(n*r*4);return vo(e,t,function(){return e.readPixels(0,0,o,s,a.downloadTextureFormat,e.UNSIGNED_BYTE,c)}),new Float32Array(c.buffer)}function lh(e,t,n,r,a,i,o,s){var c=e,l=new Float32Array(function(e,t){var n=mo(e,t);return n[0]*n[1]*4}(i,o));return c.bindBuffer(c.PIXEL_PACK_BUFFER,t),c.getBufferSubData(c.PIXEL_PACK_BUFFER,0,l),c.bindBuffer(c.PIXEL_PACK_BUFFER,null),l}function uh(e,t,n,r){var a=new Float32Array(n*r*4);return vo(e,t,function(){return e.readPixels(0,0,r,n,e.RGBA,e.FLOAT,a)}),a}var hh=Object.freeze({createVertexShader:Xu,createVertexBuffer:Yu,createIndexBuffer:$u,createFloat32MatrixTexture:Qu,createFloat16MatrixTexture:Zu,createUnsignedBytesMatrixTexture:eh,createPackedMatrixTexture:th,createFloat16PackedMatrixTexture:nh,bindVertexProgramAttributeStreams:rh,uploadDenseMatrixToTexture:ah,uploadPixelDataToTexture:ih,createBufferFromOutputTexture:oh,downloadFloat32MatrixFromBuffer:sh,downloadByteEncodedFloatMatrixFromOutputTexture:ch,downloadPackedMatrixFromBuffer:lh,downloadMatrixFromPackedOutputTexture:uh}),dh=function(){function e(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var t=Da().getNumber("WEBGL_VERSION");null!=e?(this.gl=e,uo(t,e)):this.gl=ho(t);var n="WEBGL_color_buffer_float";if(1===Da().getNumber("WEBGL_VERSION")){if(this.textureFloatExtension=xo(this.gl,this.debug,"OES_texture_float"),es(this.gl,"OES_texture_half_float"))this.textureHalfFloatExtension=xo(this.gl,this.debug,"OES_texture_half_float");else if(Da().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(n),es(this.gl,"EXT_color_buffer_half_float"))this.colorBufferHalfFloatExtension=xo(this.gl,this.debug,"EXT_color_buffer_half_float");else if(Da().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(n="EXT_color_buffer_float",es(this.gl,n))this.colorBufferFloatExtension=this.gl.getExtension(n);else{if(!es(this.gl,"EXT_color_buffer_half_float"))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float")}this.vertexBuffer=Yu(this.gl,this.debug),this.indexBuffer=$u(this.gl,this.debug),this.framebuffer=Do(this.gl,this.debug),this.textureConfig=go(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(e.prototype,"debug",{get:function(){return Da().getBool("DEBUG")},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){var e=this;if(!this.disposed){null!=this.program&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),null!=this.outputTexture&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var t=this.gl;vo(t,this.debug,function(){return t.finish()}),vo(t,this.debug,function(){return t.bindFramebuffer(t.FRAMEBUFFER,null)}),vo(t,this.debug,function(){return t.deleteFramebuffer(e.framebuffer)}),vo(t,this.debug,function(){return t.bindBuffer(t.ARRAY_BUFFER,null)}),vo(t,this.debug,function(){return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)}),vo(t,this.debug,function(){return t.deleteBuffer(e.indexBuffer)}),this.disposed=!0}},e.prototype.createFloat32MatrixTexture=function(e,t){return this.throwIfDisposed(),Qu(this.gl,this.debug,e,t,this.textureConfig)},e.prototype.createFloat16MatrixTexture=function(e,t){return this.throwIfDisposed(),Zu(this.gl,this.debug,e,t,this.textureConfig)},e.prototype.createUnsignedBytesMatrixTexture=function(e,t){return this.throwIfDisposed(),eh(this.gl,this.debug,e,t,this.textureConfig)},e.prototype.uploadPixelDataToTexture=function(e,t){this.throwIfDisposed(),ih(this.gl,this.debug,e,t)},e.prototype.uploadDenseMatrixToTexture=function(e,t,n,r){this.throwIfDisposed(),ah(this.gl,this.debug,e,t,n,r,this.textureConfig)},e.prototype.createFloat16PackedMatrixTexture=function(e,t){return this.throwIfDisposed(),nh(this.gl,this.debug,e,t,this.textureConfig)},e.prototype.createPackedMatrixTexture=function(e,t){return this.throwIfDisposed(),th(this.gl,this.debug,e,t,this.textureConfig)},e.prototype.deleteMatrixTexture=function(e){var t=this;this.throwIfDisposed(),this.outputTexture===e&&(zo(this.gl,this.debug,this.framebuffer),this.outputTexture=null),vo(this.gl,this.debug,function(){return t.gl.deleteTexture(e)})},e.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(e,t,n){var r=this;return this.downloadMatrixDriver(e,function(){return ch(r.gl,r.debug,t,n,r.textureConfig)})},e.prototype.downloadPackedMatrixFromBuffer=function(e,t,n,r,a,i){return lh(this.gl,e,0,0,0,a,i,this.textureConfig)},e.prototype.downloadFloat32MatrixFromBuffer=function(e,t){return sh(this.gl,e,t)},e.prototype.createBufferFromTexture=function(e,t,n){this.bindTextureToFrameBuffer(e);var r=oh(this.gl,this.debug,t,n,this.textureConfig);return this.unbindTextureToFrameBuffer(),r},e.prototype.createAndWaitForFence=function(){var e=this.createFence(this.gl);return this.pollFence(e)},e.prototype.createFence=function(e){var t,n,r=this;if(Da().getBool("WEBGL_FENCE_API_ENABLED")){var a=e,i=a.fenceSync(a.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),n=function(){var e=a.clientWaitSync(i,0,0);return e===a.ALREADY_SIGNALED||e===a.CONDITION_SATISFIED},t=i}else Da().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),n=function(){return r.isQueryAvailable(t,Da().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):n=function(){return!0};return{query:t,isFencePassed:n}},e.prototype.downloadMatrixFromPackedTexture=function(e,t,n){var r=this;return this.downloadMatrixDriver(e,function(){return uh(r.gl,r.debug,t,n)})},e.prototype.createProgram=function(e){this.throwIfDisposed();var t=this.gl,n=ko(t,this.debug,e),r=Xu(t,this.debug),a=Eo(t,this.debug);return vo(t,this.debug,function(){return t.attachShader(a,r)}),vo(t,this.debug,function(){return t.attachShader(a,n)}),Io(t,this.debug,a),this.debug&&To(t,this.debug,a),this.vertexAttrsAreBound||(this.setProgram(a),this.vertexAttrsAreBound=rh(t,this.debug,this.program,this.vertexBuffer)),a},e.prototype.deleteProgram=function(e){var t=this;this.throwIfDisposed(),e===this.program&&(this.program=null),null!=e&&vo(this.gl,this.debug,function(){return t.gl.deleteProgram(e)})},e.prototype.setProgram=function(e){var t=this;this.throwIfDisposed(),this.program=e,null!=this.program&&this.debug&&To(this.gl,this.debug,this.program),vo(this.gl,this.debug,function(){return t.gl.useProgram(e)})},e.prototype.getUniformLocation=function(e,t,n){return void 0===n&&(n=!0),this.throwIfDisposed(),n?Po(this.gl,this.debug,e,t):Mo(this.gl,e,t)},e.prototype.getAttributeLocation=function(e,t){var n=this;return this.throwIfDisposed(),vo(this.gl,this.debug,function(){return n.gl.getAttribLocation(e,t)})},e.prototype.getUniformLocationNoThrow=function(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)},e.prototype.setInputMatrixTexture=function(e,t,n){this.throwIfDisposed(),this.throwIfNoProgram(),jo(this.gl,this.debug,this.program,e,t,n)},e.prototype.setOutputMatrixTexture=function(e,t,n){this.setOutputMatrixTextureDriver(e,n,t)},e.prototype.setOutputPackedMatrixTexture=function(e,t,n){this.throwIfDisposed();var r=mo(t,n),a=r[0],i=r[1];this.setOutputMatrixTextureDriver(e,a,i)},e.prototype.setOutputMatrixWriteRegion=function(e,t,n,r){this.setOutputMatrixWriteRegionDriver(n,e,r,t)},e.prototype.setOutputPackedMatrixWriteRegion=function(e,t,n,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},e.prototype.debugValidate=function(){null!=this.program&&To(this.gl,this.debug,this.program),Uo(this.gl)},e.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var e=this.gl;this.debug&&this.debugValidate(),vo(e,this.debug,function(){return e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)})},e.prototype.blockUntilAllProgramsCompleted=function(){var e=this;this.throwIfDisposed(),vo(this.gl,this.debug,function(){return e.gl.finish()})},e.prototype.getQueryTimerExtension=function(){return null==this.disjointQueryTimerExtension&&(this.disjointQueryTimerExtension=xo(this.gl,this.debug,2===Da().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},e.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},e.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},e.prototype.beginQuery=function(){if(2===Da().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var e=this.gl,t=this.getQueryTimerExtensionWebGL2(),n=e.createQuery();return e.beginQuery(t.TIME_ELAPSED_EXT,n),n}var r=this.getQueryTimerExtensionWebGL1(),a=r.createQueryEXT();return r.beginQueryEXT(r.TIME_ELAPSED_EXT,a),a},e.prototype.endQuery=function(){if(2!==Da().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}else{var t=this.gl,n=this.getQueryTimerExtensionWebGL2();t.endQuery(n.TIME_ELAPSED_EXT)}},e.prototype.waitForQueryAndGetTime=function(e){return Aa(this,void 0,void 0,function(){var t=this;return Ra(this,function(n){switch(n.label){case 0:return[4,ni(function(){return t.disposed||t.isQueryAvailable(e,Da().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))})];case 1:return n.sent(),[2,this.getQueryTime(e,Da().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}})})},e.prototype.getQueryTime=function(e,t){if(0===t)return null;if(2===t){var n=this.gl;return n.getQueryParameter(e,n.QUERY_RESULT)/1e6}var r=this.getQueryTimerExtensionWebGL1();return r.getQueryObjectEXT(e,r.QUERY_RESULT_EXT)/1e6},e.prototype.isQueryAvailable=function(e,t){if(0===t)return!0;if(2===t){var n=this.gl,r=this.getQueryTimerExtensionWebGL2(),a=n.getQueryParameter(e,n.QUERY_RESULT_AVAILABLE);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),a&&!this.disjoint}return a=(r=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(e,r.QUERY_RESULT_AVAILABLE_EXT),null==this.disjoint&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),a&&!this.disjoint},e.prototype.pollFence=function(e){var t=this;return new Promise(function(n){t.addItemToPoll(function(){return e.isFencePassed()},function(){return n()})})},e.prototype.pollItems=function(){for(var e=function(e){for(var t=0;t<e.length&&e[t]();++t);return t-1}(this.itemsToPoll.map(function(e){return e.isDoneFn})),t=0;t<=e;++t)(0,this.itemsToPoll[t].resolveFn)();this.itemsToPoll=this.itemsToPoll.slice(e+1)},e.prototype.addItemToPoll=function(e,t){var n=this;this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1||ni(function(){return n.pollItems(),0===n.itemsToPoll.length})},e.prototype.bindTextureToFrameBuffer=function(e){this.throwIfDisposed(),Bo(this.gl,this.debug,e,this.framebuffer),this.debug&&Uo(this.gl)},e.prototype.unbindTextureToFrameBuffer=function(){null!=this.outputTexture?(Bo(this.gl,this.debug,this.outputTexture,this.framebuffer),this.debug&&Uo(this.gl)):zo(this.gl,this.debug,this.framebuffer)},e.prototype.downloadMatrixDriver=function(e,t){this.bindTextureToFrameBuffer(e);var n=t();return this.unbindTextureToFrameBuffer(),n},e.prototype.setOutputMatrixTextureDriver=function(e,t,n){this.throwIfDisposed();var r=this.gl;Bo(r,this.debug,e,this.framebuffer),this.debug&&Uo(r),this.outputTexture=e,vo(r,this.debug,function(){return r.viewport(0,0,t,n)}),vo(r,this.debug,function(){return r.scissor(0,0,t,n)})},e.prototype.setOutputMatrixWriteRegionDriver=function(e,t,n,r){var a=this;this.throwIfDisposed(),vo(this.gl,this.debug,function(){return a.gl.scissor(e,t,n,r)})},e.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},e.prototype.throwIfNoProgram=function(){if(null==this.program)throw new Error("No GPU program is currently set.")},e}();function fh(e,t){if(e.length!==t.length)throw Error("Binary was compiled with "+e.length+" inputs, but was executed with "+t.length+" inputs");e.forEach(function(e,n){var r=e.logicalShape,a=t[n],i=a.shape;if(!Ja(r,i))throw Error("Binary was compiled with different shapes than the current args. Shapes "+r+" and "+i+" must match");if(!e.isUniform||!a.isUniform){var o=e.texShape,s=a.isUniform?null:a.texData.texShape;if(!Ja(o,s))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+o+" and "+s+" must match")}})}var ph=function(e,t,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e;for(var r=n.filterWidth,a=n.inChannels,i=n.strideWidth,o=n.strideHeight,s=n.padInfo,c=n.outWidth,l=n.dilationWidth,u=n.dilationHeight,h=n.dataFormat,d=s.left,f=s.top,p=a*r,m=Wl(),g="channelsLast"===h,v=g?0:1,b=g?1:2,y="",x=0;x<=1;x++)for(var w=0;w<=1;w++)y+="\n          blockIndex = rc.y + "+w+";\n          pos = rc.x + "+x+";\n\n          if(blockIndex < "+e[1]+" && pos < "+e[0]+") {\n            offsetY = int(blockIndex / ("+c+")) * "+o+" - "+f+";\n            d0 = offsetY + "+u+" * (pos / "+p+");\n\n            if(d0 < "+t[v]+" && d0 >= 0) {\n\n              offsetX = int(mod(float(blockIndex), "+c+".) * "+i+". - "+d+".);\n              d1 = offsetX + "+l+" * (int(mod(float(pos), "+p+".) / "+a+".));\n\n              if(d1 < "+t[b]+" && d1 >= 0) {\n\n                ch = int(mod(float(pos), "+a+".));\n\n                if ("+g+") {\n                  innerDims = vec2(d1, ch);\n                  result["+(2*x+w)+"] = getChannel(\n                    getA(d0, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                } else {\n                  innerDims = vec2(d0, d1);\n                  result["+(2*x+w)+"] = getChannel(\n                    getA(ch, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                }\n              }\n            }\n          }\n        ";this.userCode="\n      void main() {\n        ivec2 rc = getOutputCoords();\n\n        vec4 result = vec4(0);\n\n        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;\n        vec2 innerDims;\n\n        "+y+"\n\n        "+m.output+" = result;\n      }\n    "},mh=function(e,t,n,r,a){this.variableNames=["x"],this.outputShape=[];var i,o=t,s=e[3]-1;this.outputShape=e;var c="float("+n+") + float("+r+") * sum";i=.5===a?"inversesqrt("+c+")":1===a?"1.0/("+c+")":"exp(log("+c+") * float(-"+a+"));",this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n        int d = coords[3];\n        float x = getX(b, r, c, d);\n        float sum = 0.0;\n        for (int j = -"+o+"; j <= "+o+"; j++) {\n          int idx = d + j;\n          if (idx >= 0 && idx <=  "+s+") {\n            float z = getX(b, r, c, idx);\n            sum += z * z;\n          }\n        }\n        float val = x * "+i+";\n        setOutput(val);\n      }\n    "},gh=function(e,t,n,r,a){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=t,this.bias=n,this.alpha=r,this.beta=a,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n\n        float result = 0.0;\n        for (int d = 0; d < "+this.depth+"; ++d) {\n          int depthBegin = int(max(0.0, float(d - "+t+")));\n          int depthEnd = int(min(float("+this.depth+"),\n              float(d + "+t+" + 1)));\n\n          const int MIN_DEPTH_BEGIN = 0;\n          const int MAX_DEPTH_END = "+this.depth+";\n\n          float norm = 0.0;\n          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd) {\n              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);\n            }\n            else {\n              break;\n            }\n          }\n\n          norm = float("+r+") * norm + float("+n+");\n\n          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd){\n              float dyi = -2.0 * float("+r+")\n                * float("+a+")\n                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)\n                / norm;\n              if (k == d) {\n                dyi += pow(norm, -1.0 * "+a+");\n              }\n              if (k == coords[3]) {\n                dyi *= getDy(b, r, c, d);\n                result += dyi;\n              }\n            }\n            else {\n              break;\n            }\n          }\n      }\n      setOutput(result);\n      }\n    "},vh=function(e,t,n,r,a){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var i,o=t,s=e[3]-1;this.outputShape=e;var c="float("+n+") + float("+r+") * sum";i=.5===a?"inversesqrt("+c+")":1===a?"1.0/("+c+")":"exp(log("+c+") * float(-"+a+"));",this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords.x;\n        int r = coords.y;\n        int c = coords.z;\n        int d = coords.w;\n\n        bool hasNextCol = d < "+this.outputShape[3]+";\n        bool hasNextRow = c < "+this.outputShape[2]+";\n\n        vec4 sum = vec4(0.);\n        vec4 xFragAtOutputCoords = getX(b, r, c, d);\n\n        vec4 xAtOutputCoords = vec4(\n          getChannel(xFragAtOutputCoords, vec2(c, d)),\n          hasNextCol ?\n            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,\n          hasNextRow ?\n            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0\n        );\n\n        int firstChannel = d - "+o+";\n        vec2 cache = vec2(0.);\n        if(firstChannel >= 0){\n          vec4 firstChannelFrag = getX(b, r, c, firstChannel);\n          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));\n            if(hasNextRow){\n              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));\n            }\n        }\n\n        ivec2 depth = ivec2(d, d + 1);\n        for (int j = - "+o+"; j <= "+o+"; j++) {\n          ivec2 idx = depth + j;\n          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));\n          bvec2 belowUpperBound = lessThanEqual(idx, ivec2("+s+"));\n\n          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;\n          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;\n\n          if(depthInRange || depthPlusOneInRange){\n            vec4 z = vec4(0.);\n            vec4 xFragAtCurrentDepth;\n            z.xz = cache.xy;\n            if(depthPlusOneInRange && hasNextCol){\n              xFragAtCurrentDepth = idx.y != d ?\n                getX(b, r, c, idx.y) : xFragAtOutputCoords;\n              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));\n              if(hasNextRow){\n                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));\n              }\n            }\n            cache.xy = z.yw;\n            sum += z * z;\n          }\n        }\n        vec4 result = xAtOutputCoords * "+i+";\n        setOutput(result);\n      }\n    "},bh=function(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;var t=e.strideHeight,n=e.strideWidth,r=e.dilationHeight,a=e.effectiveFilterHeight,i=e.effectiveFilterWidth,o=a-1-e.padInfo.top,s=i-1-e.padInfo.left,c=a*i-1;this.userCode="\n      const ivec2 pads = ivec2("+o+", "+s+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+a+";\n          wR += "+r+") {\n          float dyR = float(dyRCorner + wR) / "+t+".0;\n\n          if (dyR < 0.0 || dyR >= "+e.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+i+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+n+".0;\n\n            if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n            int maxPosValue = "+c+" - int(getMaxPos(b, idyR, idyC, d));\n\n            // Get the current value, check it against the value from the\n            // position matrix.\n            int curPosValue = wR * "+i+" + wC;\n            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n            dotProd += dyValue * mask;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},yh=function(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;var t=e.strideDepth,n=e.strideHeight,r=e.strideWidth,a=e.dilationDepth,i=e.dilationHeight,o=e.dilationWidth,s=e.effectiveFilterDepth,c=e.effectiveFilterHeight,l=e.effectiveFilterWidth,u=s-1-e.padInfo.front,h=c-1-e.padInfo.top,d=l-1-e.padInfo.left,f=s*c*l-1;this.userCode="\n      const ivec3 pads = ivec3("+u+", "+h+", "+d+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < "+s+";\n           wD += "+a+") {\n          float dyD = float(dyDCorner + wD) / "+t+".0;\n\n          if (dyD < 0.0 || dyD >= "+e.outDepth+".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < "+c+";\n              wR += "+i+") {\n            float dyR = float(dyRCorner + wR) / "+n+".0;\n\n            if (dyR < 0.0 || dyR >= "+e.outHeight+".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < "+l+";\n                wC += "+o+") {\n              float dyC = float(dyCCorner + wC) / "+r+".0;\n\n              if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n              int maxPosValue = "+f+" -\n                  int(getMaxPos(batch, idyD, idyR, idyC, ch));\n\n              // Get the current value, check it against the value from the\n              // position matrix.\n              int curPosValue =\n                  wD * "+c+" * "+l+" +\n                  wR * "+l+" + wC;\n              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n              dotProd += dyValue * mask;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},xh=function(e,t,n,r,a,i,o){void 0===n&&(n=!1),void 0===r&&(r=!1),void 0===a&&(a=!1),void 0===i&&(i=null),void 0===o&&(o=!1),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t;var s=n?e[1]:e[2],c=Math.ceil(s/2),l=n?"i * 2, rc.y":"rc.y, i * 2",u=r?"rc.z, i * 2":"i * 2, rc.z",h=n?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],d=r?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],f="",p="";i&&(f=o?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          "+i+"\n        }":"vec4 activation(vec4 x) {\n          "+i+"\n        }",p="result = activation(result);");var m=a?"result += getBiasAtOutCoords();":"";a&&this.variableNames.push("bias"),o&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+f+"\n\n      const float sharedDimension = "+c+".0;\n\n      vec4 dot2x2ARowBCol(ivec3 rc) {\n        vec4 result = vec4(0);\n        for (int i = 0; i < "+c+"; i++) {\n          vec4 a = getMatrixA(rc.x, "+l+");\n          vec4 b = getMatrixB(rc.x, "+u+");\n\n          // These swizzled products need to be separately added.\n          // See: https://github.com/tensorflow/tfjs/issues/1735\n          result += ("+h[0]+" * "+d[0]+");\n          result += ("+h[1]+" * "+d[1]+");\n        }\n        return result;\n      }\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n        vec4 result = dot2x2ARowBCol(rc);\n\n        "+m+"\n\n        "+p+"\n\n        setOutput(result);\n      }\n    "},wh=function(){function e(e,t,n){this.variableNames=["probs"],this.outputShape=[e,n],this.userCode="\n      uniform float seed;\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n\n        float r = random(seed);\n        float cdf = 0.0;\n\n        for (int i = 0; i < "+(t-1)+"; i++) {\n          cdf += getProbs(batch, i);\n\n          if (r < cdf) {\n            setOutput(float(i));\n            return;\n          }\n        }\n\n        // If no other event happened, last event happened.\n        setOutput(float("+(t-1)+"));\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e){var t=this;return function(n,r){null==t.seedLoc&&(t.seedLoc=n.getUniformLocation(r,"seed")),n.gl.uniform1f(t.seedLoc,e)}},e}(),kh=function(e,t,n,r){this.variableNames=["indices"],this.outputShape=[e,t],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int index = round(getIndices(coords.x));\n        setOutput(mix(float("+r+"), float("+n+"),\n                      float(index == coords.y)));\n      }\n    "},Sh=function(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=e;var t=e.length;if(0===t)this.userCode="\n        void main() {\n          setOutput(vec4(getA(), 0., 0., 0.));\n        }\n      ";else{var n=Ul("rc",t),r=tu(t),a=function(e,t,n){if(1===e)return"rc > "+t[0];for(var r="",a=e-2;a<e;a++)r+=n[a]+" >= "+t[a],a<e-1&&(r+="||");return r}(t,e,n),i=function(e,t,n,r){if(1===e)return"";var a=r.slice(-2);return"\n    int r = "+a[0]+";\n    int c = "+a[1]+";\n    int rp1 = r + 1;\n    int cp1 = c + 1;\n\n    bool cEdge = cp1 >= "+t+";\n    bool rEdge = rp1 >= "+n+";\n  "}(t,e[e.length-1],e[e.length-2],n),o=function(e,t){var n=e.length,r=function(e,t){for(var n=[],r=0;r<=1;r++)for(var a=0;a<=1;a++){for(var i=(0===r?"r":"rp1")+", "+(0===a?"c":"cp1"),o=2;o<e;o++)i=t[t.length-1-o]+","+i;n.push(i)}return n}(n,t);return 1===n?"getA(rc),\n            rc + 1 >= "+e[0]+" ? 0. : getA(rc + 1),\n            0, 0":"getA("+r[0]+"),\n          cEdge ? 0. : getA("+r[1]+"),\n          rEdge ? 0. : getA("+r[2]+"),\n          rEdge || cEdge ? 0. : getA("+r[3]+")"}(e,n);this.userCode="\n        void main() {\n          "+r+" rc = getOutputCoords();\n\n          if("+a+") {\n            setOutput(vec4(0));\n          } else {\n            "+i+"\n\n            setOutput(vec4("+o+"));\n          }\n        }\n      "}},Nh=function(e,t,n){this.variableNames=["x"],this.outputShape=t.map(function(t,n){return t[0]+e[n]+t[1]});var r=e.length,a=tu(r),i=t.map(function(e){return e[0]}).join(","),o=t.map(function(t,n){return t[0]+e[n]}).join(","),s=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);this.userCode=1!==r?"\n      "+a+" start = "+a+"("+i+");\n      "+a+" end = "+a+"("+o+");\n\n      void main() {\n        "+a+" outC = getOutputCoords();\n        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {\n          setOutput(float("+n+"));\n        } else {\n          "+a+" coords = outC - start;\n          setOutput(getX("+s+"));\n        }\n      }\n    ":"\n        int start = "+i+";\n        int end = "+o+";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start || outC >= end) {\n            setOutput(float("+n+"));\n          } else {\n            setOutput(getX(outC - start));\n          }\n        }\n      "},Ch=function(e,t,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.map(function(t,n){return t[0]+e[n]+t[1]});for(var r=e.length,a=tu(r),i=t.map(function(e){return e[0]}).join(","),o=t.map(function(t,n){return t[0]+e[n]}).join(","),s=Ul("rc",r),c=Ul("source",r),l=s[r-1]+" < "+this.outputShape[r-1],u=1===r?"source":"vec2("+c.slice(-2).join()+")",h=[a+" rc = outputLoc;",s[r-1]+" += 1;\n       if("+l+") {\n      ",1===r?"":"}\n       rc = outputLoc;\n       "+s[r-2]+" += 1;\n       if("+s[r-2]+" < "+this.outputShape[r-2]+") {",1===r?"":"  "+s[r-1]+" += 1;\n         if("+l+") {"],d=1===r?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",f="",p=0,m=1===r?2:4;p<m;p++)f+="\n        "+h[p]+"\n        if ("+d+") {\n          result["+p+"] = float("+n+");\n        } else {\n          "+a+" source = rc - start;\n          result["+p+"] = getChannel(getX("+c.join()+"), "+u+");\n        }\n      ";f+=1===r?"} ":"}}",this.userCode="\n      const "+a+" start = "+a+"("+i+");\n      const "+a+" end = "+a+"("+o+");\n\n      void main() {\n        "+a+" outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        "+f+"\n        setOutput(result);\n      }\n    "},Eh=function(e,t,n){if(this.variableNames=["x"],"avg"===t&&n)throw new Error("Cannot compute positions for average pool.");var r=e.filterWidth,a=e.strideHeight,i=e.strideWidth,o=e.dilationHeight,s=e.dilationWidth,c=e.effectiveFilterHeight,l=e.effectiveFilterWidth,u=e.padInfo.top,h=e.padInfo.left;this.outputShape=e.outShape;var d="avg"===t,f="0.0";if(d||(f="-1.0 / 1e-20"),n)this.userCode="\n        const ivec2 strides = ivec2("+a+", "+i+");\n        const ivec2 pads = ivec2("+u+", "+h+");\n\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int batch = coords[0];\n          int d = coords[3];\n\n          ivec2 xRCCorner = coords.yz * strides - pads;\n          int xRCorner = xRCCorner.x;\n          int xCCorner = xRCCorner.y;\n\n          // max/min x(?, ?, d) to get y(yR, yC, d).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n          float avgValue = 0.0;\n\n          for (int wR = 0; wR < "+c+";\n              wR += "+o+") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+l+";\n                wC += "+s+") {\n              int xC = xCCorner + wC;\n\n              if (xC < 0 || xC >= "+e.inWidth+") {\n                continue;\n              }\n\n              float value = getX(batch, xR, xC, d);\n\n              // If a min / max value has already been found, use it. If not,\n              // use the current value.\n              float currMinMaxValue = mix(\n                  value, minMaxValue, minMaxValueFound);\n              if (value >= currMinMaxValue) {\n                minMaxValue = value;\n                minMaxValueFound = 1.0;\n                minMaxPosition = wR * "+l+" + wC;\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ";else{var p=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===t&&(p="avgValue / count");var m=4*Math.floor(r/4),g=r%4,v="\n      if ("+d+") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    ";this.userCode="\n      const ivec2 strides = ivec2("+a+", "+i+");\n      const ivec2 pads = ivec2("+u+", "+h+");\n      const float initializationValue = "+f+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xR, int xC, int d) {\n        if (xC < 0 || xC >= "+e.inWidth+") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xR, xC, d);\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // max/min x(?, ?, d) to get y(yR, yC, d).\n        // ? = to be determined\n        vec4 minMaxValue = vec4("+f+");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wR = 0; wR < "+c+";\n            wR += "+o+") {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= "+e.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+m+"; wC += 4) {\n            int xC = xCCorner + wC * "+s+";\n\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+s+", d),\n              getValue(batch, xR, xC + 2 * "+s+", d),\n              getValue(batch, xR, xC + 3 * "+s+", d)\n            );\n\n            "+v+"\n          }\n\n          int xC = xCCorner + "+m+";\n          if ("+(1===g)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              initializationValue,\n              initializationValue,\n              initializationValue\n            );\n\n            "+v+"\n          } else if ("+(2===g)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+s+", d),\n              initializationValue,\n              initializationValue\n            );\n\n            "+v+"\n          } else if ("+(3===g)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+s+", d),\n              getValue(batch, xR, xC + 2 * "+s+", d),\n              initializationValue\n            );\n\n            "+v+"\n          }\n        }\n        setOutput("+p+");\n      }\n    "}},Ih=function(e,t,n){if(this.variableNames=["x"],"avg"===t&&n)throw new Error("Cannot compute positions for average pool.");var r=e.filterWidth,a=e.strideDepth,i=e.strideHeight,o=e.strideWidth,s=e.dilationDepth,c=e.dilationHeight,l=e.dilationWidth,u=e.effectiveFilterDepth,h=e.effectiveFilterHeight,d=e.effectiveFilterWidth,f=e.padInfo.front,p=e.padInfo.top,m=e.padInfo.left;this.outputShape=e.outShape;var g="avg"===t,v="0.0";if(g||(v="-1.0 / 1e-20"),n)this.userCode="\n        const ivec3 strides =\n            ivec3("+a+", "+i+", "+o+");\n        const ivec3 pads = ivec3("+f+", "+p+", "+m+");\n\n        void main() {\n          ivec5 coords = getOutputCoords();\n          int batch = coords.x;\n          int ch = coords.u;\n\n          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n          int xDCorner = xCorner.x;\n          int xRCorner = xCorner.y;\n          int xCCorner = xCorner.z;\n\n          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n\n          for (int wD = 0; wD < "+u+";\n              wD += "+s+") {\n            int xD = xDCorner + wD;\n\n            if (xD < 0 || xD >= "+e.inDepth+") {\n              continue;\n            }\n\n            for (int wR = 0; wR < "+h+";\n                wR += "+c+") {\n              int xR = xRCorner + wR;\n\n              if (xR < 0 || xR >= "+e.inHeight+") {\n                continue;\n              }\n\n              for (int wC = 0; wC < "+d+";\n                  wC += "+l+") {\n                int xC = xCCorner + wC;\n\n                if (xC < 0 || xC >= "+e.inWidth+") {\n                  continue;\n                }\n\n                float value = getX(batch, xD, xR, xC, ch);\n\n                // If a min / max value has already been found, use it. If not,\n                // use the current value.\n                float currMinMaxValue = mix(\n                    value, minMaxValue, minMaxValueFound);\n                if (value >= currMinMaxValue) {\n                  minMaxValue = value;\n                  minMaxValueFound = 1.0;\n                  minMaxPosition =\n                      wD * "+h+" * "+d+" +\n                      wR * "+d+" + wC;;\n                }\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ";else{var b=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===t&&(b="avgValue / count");var y=4*Math.floor(r/4),x=r%4,w="\n      if ("+g+") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    ";this.userCode="\n      const ivec3 strides =\n        ivec3("+a+", "+i+", "+o+");\n      const ivec3 pads = ivec3("+f+", "+p+", "+m+");\n      const float initializationValue = "+v+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xD, int xR, int xC, int ch) {\n        if (xC < 0 || xC >= "+e.inWidth+") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xD, xR, xC, ch);\n      }\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xDCorner = xCorner.x;\n        int xRCorner = xCorner.y;\n        int xCCorner = xCorner.z;\n\n        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).\n        // ? = to be determined\n        vec4 minMaxValue = vec4("+v+");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wD = 0; wD < "+u+";\n            wD += "+s+") {\n          int xD = xDCorner + wD;\n\n          if (xD < 0 || xD >= "+e.inDepth+") {\n            continue;\n          }\n\n          for (int wR = 0; wR < "+h+";\n            wR += "+c+") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+y+"; wC += 4) {\n              int xC = xCCorner + wC * "+l+";\n\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+l+", ch),\n                getValue(batch, xD, xR, xC + 2 * "+l+", ch),\n                getValue(batch, xD, xR, xC + 3 * "+l+", ch)\n              );\n\n              "+w+"\n            }\n\n            int xC = xCCorner + "+y+";\n            if ("+(1===x)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                initializationValue,\n                initializationValue,\n                initializationValue\n              );\n\n              "+w+"\n            } else if ("+(2===x)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+l+", ch),\n                initializationValue,\n                initializationValue\n              );\n\n              "+w+"\n            } else if ("+(3===x)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+l+", ch),\n                getValue(batch, xD, xR, xC + 2 * "+l+", ch),\n                initializationValue\n              );\n\n              "+w+"\n            }\n          }\n          setOutput("+b+");\n        }\n      }\n    "}},Th=function(e,t){this.variableNames=["x"];var n=e.windowSize,r=e.batchSize,a=e.inSize,i=Math.ceil(a/n);this.outputShape=[r,i];var o="0.0",s="";"prod"===t?o="1.0":"min"===t?(o="1.0 / 1e-20",s="min"):"max"===t&&(o="-1.0 / 1e-20",s="max");var c=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"sum"===t?c="sumValue":"prod"===t?c="prodValue":"all"===t?c="allValue":"any"===t&&(c="anyValue");var l=4*Math.floor(n/4),u=n%4,h="\n      if ("+("sum"===t)+") {\n        sumValue += dot(values, ones);\n      } else if ("+("prod"===t)+") {\n        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);\n        prodValue *= tmp[0] * tmp[1];\n      } else {\n        minMaxValue = "+s+"(values, minMaxValue);\n      }\n    ",d="vec4";"all"===t?(o="1.0",h="\n        bool reducedAllValue = all(values);\n        float floatedReducedAllValue = float(reducedAllValue);\n        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);\n      ",d="bvec4"):"any"===t&&(o="0.0",h="\n        bool reducedAnyValue = any(values);\n        float floatedReducedAnyValue = float(reducedAnyValue);\n        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);\n      ",d="bvec4");var f="";a%n>0&&(f="\n        if (inIdx < 0 || inIdx >= "+a+") {\n          return initializationValue;\n        }\n      "),this.userCode="\n      const float initializationValue = "+o+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        "+f+"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+n+";\n\n        vec4 minMaxValue = vec4("+o+");\n        float prodValue = 1.0;\n        float sumValue = 0.0;\n        float allValue = 1.0;\n        float anyValue = 0.0;\n\n        for (int i = 0; i < "+l+"; i += 4) {\n          int inIdx = inOffset + i;\n          "+d+" values = "+d+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          "+h+"\n        }\n\n        int inIdx = inOffset + "+l+";\n        if ("+(1===u)+") {\n          "+d+" values = "+d+"(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          "+h+"\n        } else if ("+(2===u)+") {\n          "+d+" values = "+d+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          "+h+"\n        } else if ("+(3===u)+") {\n          "+d+" values = "+d+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          "+h+"\n        }\n        setOutput("+c+");\n      }\n    "},_h=function(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e;for(var n="",r=0;r<4;r++){var a="thisRC = rc;";r%2==1&&(a+="thisRC.z += 1;"),r>1&&(a+="thisRC.y += 1;"),n+="\n        "+a+"\n        "+(r>0?"if(thisRC.y < rows && thisRC.z < cols){":"")+"\n          int flatIndex = getFlatIndex(thisRC);\n\n          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);\n          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));\n\n          result["+r+"] =\n            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);\n        "+(r>0?"}":"")+"\n      "}this.userCode="\n      \n    ivec3 inputCoordsFromReshapedOutCoords(int index) {\n      "+Vl(["r","c","d"],t)+"\n      return ivec3(r, c, d);\n    }\n  \n      "+Hl(e)+"\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0.);\n\n        ivec3 thisRC;\n        int rows = "+e[1]+";\n        int cols = "+e[2]+";\n\n        "+n+"\n\n        setOutput(result);\n      }\n    "},Ah=function(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t.shape;var r=t.shape,a=r[1],i=r[2],o=e.shape,s=o[1],c=o[2],l=[n&&s>1?a-1:a,n&&c>1?i-1:i],u=[n&&s>1?s-1:s,n&&c>1?c-1:c],h=l[0]/u[0],d=l[1]/u[1],f=1/h,p=1/d,m=2*Math.ceil(f)+2,g=2*Math.ceil(p)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float("+h+");\n        const float widthScale = float("+d+");\n\n        const float invHeightScale = float("+f+");\n        const float invWidthScale = float("+p+");\n\n        const int winHeight = int("+m+");\n        const int winWidth = int("+g+");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(startRLerp - float(winHeight / 2));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(startCLerp - float(winWidth / 2));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= "+s+") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= "+c+") {\n              continue;\n            }\n\n            float dxR = float(dyR) * heightScale;\n            int topDxRIndex = int(floor(dxR));\n            int bottomDxRIndex = int(min(ceil(dxR), "+(a-1)+".0));\n            float dxRLerp = dxR - float(topDxRIndex);\n            float inverseDxRLerp = 1.0 - dxRLerp;\n\n            float dxC = float(dyC) * widthScale;\n            int leftDxCIndex = int(floor(dxC));\n            int rightDxCIndex = int(min(ceil(dxC), "+(i-1)+".0));\n            float dxCLerp = dxC - float(leftDxCIndex);\n            float inverseDxCLerp = 1.0 - dxCLerp;\n\n            if (r == topDxRIndex && c == leftDxCIndex) {\n              // topLeft\n              accumulator +=\n                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;\n            }\n\n            if (r == topDxRIndex && c == rightDxCIndex) {\n              // topRight\n              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == leftDxCIndex) {\n              // bottomLeft\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == rightDxCIndex) {\n              // bottomRight\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    "},Rh=function(e,t,n,r){this.variableNames=["A"],this.outputShape=[];var a=e[0],i=e[1],o=e[2],s=e[3];this.outputShape=[a,t,n,s];var c=[r&&t>1?i-1:i,r&&n>1?o-1:o],l=[r&&t>1?t-1:t,r&&n>1?n-1:n];this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+c[0]/l[0]+",\n          "+c[1]/l[1]+");\n      const vec2 inputShapeRC = vec2("+i+".0, "+o+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);\n        ivec2 sourceCeilRC = ivec2(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);\n        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);\n        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);\n        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n        float top = topLeft + (topRight - topLeft) * fracRC.y;\n        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n        float newValue = top + (bottom - top) * fracRC.x;\n\n        setOutput(newValue);\n      }\n    "},Fh=function(e,t,n,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var a=e[0],i=e[1],o=e[2],s=e[3];this.outputShape=[a,t,n,s];var c=[r&&t>1?i-1:i,r&&n>1?o-1:o],l=[r&&t>1?t-1:t,r&&n>1?n-1:n];this.userCode="\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          "+c[0]/l[0]+",\n          "+c[1]/l[1]+",\n          "+c[1]/l[1]+");\n      const vec3 inputShapeRC = vec3("+i+".0, "+o+".0,\n                                     "+o+".0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = vec3(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec3 sourceFloorRC = ivec3(sourceFracIndexRC);\n        ivec3 sourceCeilRC = ivec3(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < "+(s-1)+";\n        bool hasNextRow = coords.z < "+(n-1)+";\n\n        // In parallel, construct four corners for all four components in\n        // packed 2x2 cell.\n        vec4 topLeft = vec4(\n          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 bottomLeft = vec4(\n          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 topRight = vec4(\n          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec4 bottomRight = vec4(\n          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);\n\n        vec4 top = mix(topLeft, topRight, fracRC.yyzz);\n        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);\n        vec4 newValue = mix(top, bottom, fracRC.x);\n\n        setOutput(newValue);\n      }\n    "},Dh=function(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t.shape;var r=t.shape,a=r[1],i=r[2],o=e.shape,s=o[1],c=o[2],l=[n&&s>1?a-1:a,n&&c>1?i-1:i],u=[n&&s>1?s-1:s,n&&c>1?c-1:c],h=l[0]/u[0],d=l[1]/u[1],f=1/h,p=1/d,m=2*Math.ceil(f)+2,g=2*Math.ceil(p)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float("+h+");\n        const float widthScale = float("+d+");\n\n        const float invHeightScale = float("+f+");\n        const float invWidthScale = float("+p+");\n\n        const int winHeight = int("+m+");\n        const int winWidth = int("+g+");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(floor(startRLerp - float(winHeight / 2)));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(floor(startCLerp - float(winWidth / 2)));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= "+s+") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= "+c+") {\n              continue;\n            }\n\n            float sourceFracRow =\n              float("+l[0]+") *\n                (float(dyR) / float("+u[0]+"));\n\n            float sourceFracCol =\n                float("+l[1]+") *\n                  (float(dyC) / float("+u[1]+"));\n\n            int sourceNearestRow = int(min(\n                float(int("+a+") - 1),\n                "+n+" ? float(round(sourceFracRow)) :\n                                  float(floor(sourceFracRow))));\n\n            int sourceNearestCol = int(min(\n                float(int("+i+") - 1),\n                "+n+" ? float(round(sourceFracCol)) :\n                                  float(floor(sourceFracCol))));\n\n            if (r == sourceNearestRow && c == sourceNearestCol) {\n              accumulator += getDy(b, dyR, dyC, d);\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    "},Oh=function(e,t,n,r){this.variableNames=["A"],this.outputShape=[];var a=e[0],i=e[1],o=e[2],s=e[3];this.outputShape=[a,t,n,s];var c=[r&&t>1?i-1:i,r&&n>1?o-1:o],l=[r&&t>1?t-1:t,r&&n>1?n-1:n],u=r?"0.5":"0.0";this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+c[0]/l[0]+",\n          "+c[1]/l[1]+");\n      const vec2 inputShapeRC = vec2("+i+".0, "+o+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec2 sourceNearestRC = ivec2(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + "+u+")));\n\n        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);\n\n        setOutput(newValue);\n      }\n    "},Lh=function(e,t){this.variableNames=["x"];var n=e.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-"+n+" tensor is not yet supported");if(this.outputShape=e,1!==n){var r=e.map(function(n,r){return function(n){return-1!==t.indexOf(n)&&1!==e[n]?e[n]+" - coords["+n+"] - 1":"coords["+n+"]"}(r)}).join(","),a=tu(n);this.userCode="\n      void main() {\n        "+a+" coords = getOutputCoords();\n        setOutput(getX("+r+"));\n      }\n    "}else this.userCode="\n        void main() {\n          int coord = getOutputCoords();\n          setOutput(getX("+e[0]+" - coord - 1));\n        }\n      "},Ph=function(e,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var n=e.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-"+n+" tensor is not yet supported");this.outputShape=e;var r=Ul("rc",n),a=r[n-1]+" + 1 < "+this.outputShape[n-1],i=r[n-2]+" + 1 < "+this.outputShape[n-2],o=tu(n);function s(n){var r=e.map(function(r,a){return function(n,r){return-1!==t.indexOf(n)&&1!==e[n]?e[n]+" - "+r[n]+" - 1":""+r[n]}(a,n)});return"getChannel(getX("+r.join(",")+"), vec2("+r.slice(-2).join(",")+"))"}this.userCode=1===n?"\n        void main(){\n          int rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = getChannel(getX("+e[0]+" - rc - 1),\n            "+e[0]+" - rc - 1);\n          if("+a+"){\n              result.g = getChannel(getX("+e[0]+" - (rc  + 1) - 1),\n                "+e[0]+" - (rc  + 1) - 1);\n          }\n          setOutput(result);\n        }\n      ":"\n        void main() {\n          "+o+" rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = "+function(e){return s(e)}(r.slice())+";\n          if("+a+"){\n            result.g = "+function(e){return e[n-1]="("+e[n-1]+" + 1)",s(e)}(r.slice())+";\n          }\n          if("+i+") {\n            result.b = "+function(e){return e[n-2]="("+e[n-2]+" + 1)",s(e)}(r.slice())+";\n            if("+a+") {\n              result.a = "+function(e){return e[n-1]="("+e[n-1]+" + 1)",e[n-2]="("+e[n-2]+" + 1)",s(e)}(r.slice())+";\n            }\n          }\n          setOutput(result);\n        }\n    "},Mh=function(e,t,n,r,a,i,o){void 0===o&&(o=!0),this.variableNames=["updates","indices","defaultValue"],this.outputShape=i;var s=tu(a.length),c=tu(i.length),l="";1===n?l="i":2===n&&(l="i, j");var u="getIndices("+l+")",h="";1===r?h="i":2===r&&(h="i, coords[1]");var d="getUpdates("+h+")",f=t>1?"strides[j]":"strides";this.userCode="\n        "+s+" strides = "+s+"("+a+");\n\n        void main() {\n          "+c+" coords = getOutputCoords();\n          float sum = 0.0;\n          bool found = false;\n          for (int i = 0; i < "+e+"; i++) {\n            int flattenedIndex = 0;\n            for (int j = 0; j < "+t+"; j++) {\n              int index = round("+u+");\n              flattenedIndex += index * "+f+";\n            }\n            if (flattenedIndex == coords[0]) {\n              sum += "+d+";\n              found = true;\n            }\n          }\n          setOutput(mix(getDefaultValue(), sum, float(found)));\n        }\n      "},jh=function(e,t){this.variableNames=["x","segmentIds"];var n=e.windowSize,r=e.batchSize,a=e.inSize,i=e.numSegments,o=i*Math.ceil(a/n);this.outputShape=[r,o];var s=4*Math.floor(n/4),c=n%4,l="\n        sumValue += dot(values, segFilter);\n    ",u="";a%n>0&&(u="\n        if (inIdx < 0 || inIdx >= "+a+") {\n          return initializationValue;\n        }\n      ");var h="";a%n>0&&(h="\n        if (inIdx < 0 || inIdx >= "+a+") {\n          return -1.0;\n        }\n      "),this.userCode="\n      const float initializationValue = 0.0;\n\n      float getValue(int batch, int inIdx) {\n        "+u+"\n        return getX(batch, inIdx);\n      }\n\n      float getSegmentIdAtIndex(int inIdx) {\n        "+h+"\n        return getSegmentIds(inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = int(floor(float(outIdx) / float(\n          "+i+")) * float("+n+"));\n        int currentSeg = int(mod(float(outIdx), float("+i+")));\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < "+s+"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0\n          );\n\n          "+l+"\n        }\n\n        int inIdx = inOffset + "+s+";\n        if ("+(1===c)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            0,\n            0,\n            0\n          );\n\n          "+l+"\n        } else if ("+(2===c)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n              0,\n              0\n          );\n\n          "+l+"\n        } else if ("+(3===c)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            0\n          );\n\n          "+l+"\n        }\n        setOutput(sumValue);\n      }\n    "},Bh=function(e,t,n){var r,a;if(this.variableNames=["c","a","b"],this.outputShape=t,n>4)throw Error("Where for rank "+n+" is not yet supported");if(1===n)a="resRC",r="resRC";else{for(var i=["resRC.x","resRC.y","resRC.z","resRC.w"],o=[],s=[],c=0;c<t.length;c++)s.push(""+i[c]),c<e&&o.push(""+i[c]);r=o.join(),a=s.join()}var l=tu(n);this.userCode="\n      void main() {\n        "+l+" resRC = getOutputCoords();\n        float cVal = getC("+r+");\n        if (cVal >= 1.0) {\n          setOutput(getA("+a+"));\n        } else {\n          setOutput(getB("+a+"));\n        }\n      }\n    "},zh=function(){function e(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;var t,n=tu(this.rank),r="uniform int start["+this.rank+"];",a=function(e){if(1===e)return"sourceLoc";if(e<=6)return Uh.slice(0,e).map(function(e){return"sourceLoc."+e}).join(",");throw Error("Slicing for rank "+e+" is not yet supported")}(this.rank);t="\n        "+n+" sourceLoc;\n        "+n+" coords = getOutputCoords();\n        "+e.map(function(e,t){return"sourceLoc."+Uh[t]+" = start["+t+"] + coords."+Uh[t]+";"}).join("\n")+"\n      ",this.userCode="\n      "+r+"\n      void main() {\n        "+t+"\n        setOutput(getSource("+a+"));\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e){var t=this;if(e.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+e.length+")");return function(n,r){null==t.startLoc&&(t.startLoc=n.getUniformLocationNoThrow(r,"start"),null==t.startLoc)||n.gl.uniform1iv(t.startLoc,e)}},e}(),Uh=["x","y","z","w","u","v"],Wh=function(){function e(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length;var t=tu(this.rank),n=Ul("coords",this.rank),r=Ul("sourceLoc",this.rank),a=1===this.rank?"sourceLoc":"vec2("+r.slice(-2).join()+")",i="getChannel(getSource("+r.join()+"), "+a+")",o="\n      result.x = "+i+";\n      if (++"+n[this.rank-1]+" < "+e[this.rank-1]+") {\n        ++"+r[this.rank-1]+";\n        result.y = "+i+";\n        --"+r[this.rank-1]+";\n      }\n    ",s=1===this.rank?"":"\n      --"+n[this.rank-1]+";\n      if (++"+n[this.rank-2]+" < "+e[this.rank-2]+") {\n        ++"+r[this.rank-2]+";\n        result.z = "+i+";\n        if (++"+n[this.rank-1]+" < "+e[this.rank-1]+") {\n          ++"+r[this.rank-1]+";\n          result.w = "+i+";\n        }\n      }\n    ",c=this.rank<=4?"sourceLoc = coords +\n            "+t+"("+e.map(function(e,t){return"start["+t+"]"}).join()+");":e.map(function(e,t){return r[t]+" = "+n[t]+" + start["+t+"];"}).join("\n");this.userCode="\n      uniform int start["+this.rank+"];\n      void main() {\n        "+t+" coords = getOutputCoords();\n        "+t+" sourceLoc;\n        "+c+"\n        vec4 result = vec4(0.);\n        "+o+"\n        "+s+"\n        setOutput(result);\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e){var t=this;if(e.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+e.length+")");return function(n,r){null==t.startLoc&&(t.startLoc=n.getUniformLocationNoThrow(r,"start"),null==t.startLoc)||n.gl.uniform1iv(t.startLoc,e)}},e}(),Vh=function(e,t,n){this.variableNames=["x"],this.outputShape=n;var r=n.length,a=tu(n.length),i=tu(n.length),o="";if(1===r)o="coords * strides + begin";else{var s=0;o=n.map(function(e,t){return s++,1===n.length?"coords * strides["+t+"] + begin["+t+"]":"coords["+(s-1)+"] * strides["+t+"] + begin["+t+"]"}).join(",")}this.userCode="\n      "+a+" begin = "+a+"("+e+");\n      "+a+" strides = "+a+"("+t+");\n\n      void main() {\n        "+i+" coords = getOutputCoords();\n        setOutput(getX("+o+"));\n      }\n    "},Hh=function(){function e(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return e.prototype.acquireTexture=function(e,t,n){var r,a=Gh(t,n),i=qh(e,a,n);if(i in this.freeTextures||(this.freeTextures[i]=[]),i in this.usedTextures||(this.usedTextures[i]=[]),this.freeTextures[i].length>0){this.numFreeTextures--,this.numUsedTextures++,this.log();var o=this.freeTextures[i].shift();return this.usedTextures[i].push(o),o}return this.numUsedTextures++,this.log(),a===so.PACKED_2X2_FLOAT32?r=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):a===so.PACKED_2X2_FLOAT16?r=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):a===so.UNPACKED_FLOAT32?r=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):a===so.UNPACKED_FLOAT16?r=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):a===so.PACKED_4X1_UNSIGNED_BYTE&&(r=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[i].push(r),r},e.prototype.releaseTexture=function(e,t,n,r){if(null!=this.freeTextures){var a=qh(t,Gh(n,r),r);a in this.freeTextures||(this.freeTextures[a]=[]),this.freeTextures[a].push(e),this.numFreeTextures++,this.numUsedTextures--;var i=this.usedTextures[a],o=i.indexOf(e);if(o<0)throw new Error("Cannot release a texture that was never provided by this texture manager");i.splice(o,1),this.log()}},e.prototype.log=function(){if(this.logEnabled){var e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+e+")")}},e.prototype.getNumUsedTextures=function(){return this.numUsedTextures},e.prototype.getNumFreeTextures=function(){return this.numFreeTextures},e.prototype.dispose=function(){var e=this;if(null!=this.freeTextures){for(var t in this.freeTextures)this.freeTextures[t].forEach(function(t){e.gpgpu.deleteMatrixTexture(t)});for(var t in this.usedTextures)this.usedTextures[t].forEach(function(t){e.gpgpu.deleteMatrixTexture(t)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},e}();function Gh(e,t){if(e===oo.UPLOAD)return so.PACKED_2X2_FLOAT32;if(e===oo.RENDER||null==e)return function(e){return Da().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?e?so.PACKED_2X2_FLOAT32:so.UNPACKED_FLOAT32:e?so.PACKED_2X2_FLOAT16:so.UNPACKED_FLOAT16}(t);if(e===oo.DOWNLOAD||e===oo.PIXELS)return so.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+e)}function qh(e,t,n){return e[0]+"_"+e[1]+"_"+t+"_"+n}var Kh=function(e,t){this.variableNames=["A"];for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e[r]*t[r];this.outputShape=n,this.rank=n.length;var a=tu(this.rank),i=function(e){var t=e.length;if(t>5)throw Error("Tile for rank "+t+" is not yet supported");if(1===t)return"imod(resRC, "+e[0]+")";for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],r=[],a=0;a<e.length;a++)r.push("imod("+n[a]+", "+e[a]+")");return r.join()}(e);this.userCode="\n      void main() {\n        "+a+" resRC = getOutputCoords();\n        setOutput(getA("+i+"));\n      }\n    "},Xh=function(e,t){this.variableNames=["A"];for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e[t[r]];this.outputShape=n,this.rank=n.length;var a=tu(this.rank),i=function(e){var t=e.length;if(t>6)throw Error("Transpose for rank "+t+" is not yet supported");for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=new Array(t),a=0;a<e.length;a++)r[e[a]]=n[a];return r.join()}(t);this.userCode="\n    void main() {\n      "+a+" resRC = getOutputCoords();\n      setOutput(getA("+i+"));\n    }\n    "},Yh=function(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e[t[r]];if(this.outputShape=n,this.rank=n.length,this.rank>6)throw Error("Packed transpose for rank "+this.rank+" is not yet supported.");var a=tu(this.rank),i=zl("rc",this.rank),o=new Array(this.rank);for(r=0;r<t.length;r++)o[t[r]]=i[r];var s="vec2("+o.slice(-2).join()+")",c="++"+i[this.rank-1]+" < "+n[this.rank-1],l="getChannel(getA("+o.join()+"), "+s+")";this.userCode="\n    void main() {\n      "+a+" rc = getOutputCoords();\n      vec4 result = vec4(0.);\n      result[0] = "+l+";\n      if("+c+") {\n        result[1] = "+l+";\n      }\n      --"+i[this.rank-1]+";\n      if(++"+i[this.rank-2]+" < "+n[this.rank-2]+") {\n        result[2] = "+l+";\n        if("+c+") {\n          result[3] = "+l+";\n        }\n      }\n      setOutput(result);\n    }\n    "},$h=1.7580993408473768,Jh=1.0507009873554805,Qh=function(e,t){this.variableNames=["A"],this.outputShape=e,this.userCode="\n      float unaryOperation(float x) {\n        "+t+"\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        float y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    "},Zh="if (isnan(x)) return x;",ed="return abs(x);",td=Zh+"\n  return (x < 0.0) ? 0.0 : x;\n",nd=Zh+"\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",rd="return (x >= 0.0) ? x : (exp(x) - 1.0);",ad="\n  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.\n  // see: https://arxiv.org/abs/1706.02515\n  float scaleAlpha = "+$h+";\n  float scale = "+Jh+";\n  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);\n",id="return -x;",od="return ceil(x);",sd="return floor(x);",cd="return exp(x);",ld="return exp(x) - 1.0;",ud=Zh+"\n  return sin(x);\n",hd=Zh+"\n  return cos(x);\n",dd=Zh+"\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return asin(x);\n",fd=Zh+"\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return acos(x);\n",pd=Zh+"\n  return atan(x);\n",md=Zh+"return log(x + sqrt(x * x + 1.0));",gd=Zh+"\n  if (x < 1.0) return NAN;\n  return log(x + sqrt(x * x - 1.0));",vd=Zh+"\n  if ((x < -1.0) || (x > 1.0)) return NAN;\n  return (log(1.0 + x) - log(1.0 - x)) / 2.0;",bd="return x;",yd="\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",xd="\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",wd="\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n",kd=function(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.userCode="\n      vec4 unaryOperation(vec4 x) {\n        "+t+"\n      }\n\n      void main() {\n        vec4 x = getAAtOutCoords();\n        vec4 y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    "},Sd=function(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=e;var t=e.length,n=Ul("rc",t),r=tu(t),a=function(e,t){if(1===e)return"rc";for(var n="",r=0;r<e;r++)n+=t[r],r<e-1&&(n+=",");return n}(t,n),i=n.slice(-2),o=t<=1?"rc":"vec2("+i.join(",")+")";this.userCode="\n      void main() {\n        "+r+" rc = getOutputCoords();\n        vec4 packedInput = getA("+a+");\n\n        setOutput(getChannel(packedInput, "+o+"));\n      }\n    "},Nd={};function Cd(e,t){if(void 0===t&&(t=!1),"linear"===e)return"return x;";if("relu"===e)return t?yd:td;if("elu"===e)return t?wd:rd;if("relu6"===e)return t?xd:nd;if("prelu"===e)return t?mu:fu;throw new Error("Activation "+e+" has not been implemented for the WebGL backend.")}var Ed=function(e){function t(t){var n,r=e.call(this)||this;if(r.pendingRead=new WeakMap,r.pendingDisposal=new WeakSet,r.dataRefCount=new WeakMap,r.numBytesInGPU=0,r.uploadWaitMs=0,r.downloadWaitMs=0,r.warnedAboutMemory=!1,r.pendingDeletes=0,r.disposed=!1,!Da().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(null==t){var a=ho(Da().getNumber("WEBGL_VERSION"));r.binaryCache=((n=Da().getNumber("WEBGL_VERSION"))in Nd||(Nd[n]={}),Nd[n]),r.gpgpu=new dh(a),r.canvas=a.canvas,r.gpgpuCreatedLocally=!0}else r.gpgpu=t,r.binaryCache={},r.gpgpuCreatedLocally=!1,r.canvas=t.gl.canvas;return r.textureManager=new Hh(r.gpgpu),r.numMBBeforeWarning=null==Da().global.screen?1024:Da().global.screen.height*Da().global.screen.width*window.devicePixelRatio*600/1024/1024,r.texData=new el(r,no),r}return _a(t,e),t.prototype.numDataIds=function(){return this.texData.numDataIds()+(this.cpuBackend?this.cpuBackend.numDataIds():0)-this.pendingDeletes},t.prototype.write=function(e,t,n){if(Da().getBool("DEBUG")&&this.checkNumericalProblems(e),"complex64"===n&&null!=e)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var r={};return this.texData.set(r,{shape:t,dtype:n,values:e,usage:oo.UPLOAD}),r},t.prototype.move=function(e,t,n,r){if(Da().getBool("DEBUG")&&this.checkNumericalProblems(t),"complex64"===r)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:n,dtype:r,values:t,usage:oo.UPLOAD})},t.prototype.readSync=function(e){var t=this.texData.get(e),n=t.values,r=t.dtype,a=t.complexTensors,i=t.slice,o=t.shape,s=t.isPacked;if(null!=i){var c;c=s?new kd(o,bd):new Qh(o,bd);var l=this.runWebGLProgram(c,[{dataId:e,shape:o,dtype:r}],r),u=this.readSync(l.dataId);return this.disposeData(l.dataId),u}if(null!=n)return this.convertAndCacheOnCPU(e);if("string"===r)return n;var h,d,f=null!=this.activeTimers;return f&&(h=Ci()),d="complex64"===r?wl(a.real.dataSync(),a.imag.dataSync()):this.getValuesFromTexture(e),f&&(this.downloadWaitMs+=Ci()-h),this.convertAndCacheOnCPU(e,d)},t.prototype.read=function(e){return Aa(this,void 0,void 0,function(){var t,n,r,a,i,o,s,c,l,u,h,d,f,p,m,g,v,b,y,x,w,k;return Ra(this,function(S){switch(S.label){case 0:if(this.pendingRead.has(e))return t=this.pendingRead.get(e),[2,new Promise(function(e){return t.push(e)})];if(n=this.texData.get(e),r=n.values,a=n.shape,i=n.slice,o=n.dtype,s=n.complexTensors,c=n.isPacked,null!=i)return void 0,l=c?new kd(a,bd):new Qh(a,bd),u=this.runWebGLProgram(l,[{dataId:e,shape:a,dtype:o}],o),h=this.read(u.dataId),this.disposeData(u.dataId),[2,h];if(null!=r)return[2,this.convertAndCacheOnCPU(e)];if(!Da().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&2===Da().getNumber("WEBGL_VERSION"))throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return d=null,"complex64"!==o&&Da().get("WEBGL_BUFFER_SUPPORTED")&&(f=this.decode(e),p=this.texData.get(f.dataId),d=(k=this.gpgpu).createBufferFromTexture.apply(k,[p.texture].concat(po(a)))),this.pendingRead.set(e,[]),"complex64"===o?[3,2]:[4,this.gpgpu.createAndWaitForFence()];case 1:S.sent(),S.label=2;case 2:return"complex64"!==o?[3,4]:[4,Promise.all([s.real.data(),s.imag.data()])];case 3:return g=S.sent(),v=g[0],b=g[1],m=wl(v,b),[3,5];case 4:null==d?m=this.getValuesFromTexture(e):(y=$a(a),m=this.gpgpu.downloadFloat32MatrixFromBuffer(d,y)),S.label=5;case 5:return null!=f&&this.disposeData(f.dataId),x=this.convertAndCacheOnCPU(e,m),w=this.pendingRead.get(e),this.pendingRead.delete(e),w.forEach(function(e){return e(x)}),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e),this.pendingDeletes--),[2,x]}})})},t.prototype.checkNumericalProblems=function(e){if(null!=e)for(var t=0;t<e.length;t++){var n=e[t];if(!bo(n)){if(Da().getBool("WEBGL_RENDER_FLOAT32_CAPABLE"))throw Error("The value "+n+" cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'");throw Error("The value "+n+" cannot be represented on this device.")}}},t.prototype.getValuesFromTexture=function(e){var t,n=this.texData.get(e),r=n.shape,a=n.dtype,i=n.isPacked,o=$a(r);if(Da().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var s=this.decode(e),c=this.texData.get(s.dataId),l=(t=this.gpgpu).downloadMatrixFromPackedTexture.apply(t,[c.texture].concat(po(r))).subarray(0,o);return this.disposeData(s.dataId),l}var u=Da().getBool("WEBGL_PACK")&&!0===i,h=u?Ko(r):r,d=u?new Uu(h):new zu(h),f=this.runWebGLProgram(d,[{shape:h,dtype:a,dataId:e}],"float32"),p=this.texData.get(f.dataId),m=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(p.texture,p.texShape[0],p.texShape[1]).subarray(0,o);return this.disposeData(f.dataId),m},t.prototype.time=function(e){return Aa(this,void 0,void 0,function(){var t,n,r,a,i,o,s;return Ra(this,function(c){switch(c.label){case 0:return t=this.activeTimers,n=[],r=!1,null==this.programTimersStack?(this.programTimersStack=n,r=!0):this.activeTimers.push(n),this.activeTimers=n,e(),a=Ya(this.activeTimers.map(function(e){return e.query})).filter(function(e){return null!=e}),i=Ya(this.activeTimers.map(function(e){return e.name})).filter(function(e){return null!=e}),this.activeTimers=t,r&&(this.programTimersStack=null),o={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null},Da().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[4,Promise.all(a)]:[3,2];case 1:return s=c.sent(),o.kernelMs=Ga(s),o.getExtraProfileInfo=function(){return s.map(function(e,t){return{name:i[t],ms:e}}).map(function(e){return e.name+": "+e.ms}).join(", ")},[3,3];case 2:o.kernelMs={error:"WebGL query timers are not supported in this environment."},c.label=3;case 3:return this.uploadWaitMs=0,this.downloadWaitMs=0,[2,o]}})})},t.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},t.prototype.startTimer=function(){return Da().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:Ci(),endMs:null}},t.prototype.endTimer=function(e){return Da().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=Ci(),e)},t.prototype.getQueryTime=function(e){return Aa(this,void 0,void 0,function(){var t;return Ra(this,function(n){return Da().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[2,this.gpgpu.waitForQueryAndGetTime(e)]:[2,(t=e).endMs-t.startMs]})})},t.prototype.disposeData=function(e){if(!this.pendingDisposal.has(e)){if(this.pendingRead.has(e))return this.pendingDisposal.add(e),void this.pendingDeletes++;if(this.texData.has(e)){this.releaseGPUData(e);var t=this.texData.get(e).complexTensors;null!=t&&(t.real.dispose(),t.imag.dispose()),this.texData.delete(e)}}},t.prototype.releaseGPUData=function(e){var t=this.texData.get(e),n=t.texture,r=t.dtype,a=t.texShape,i=t.usage,o=t.isPacked,s=t.slice,c=s&&s.origDataId||e,l=this.dataRefCount.get(c);l>1?this.dataRefCount.set(c,l-1):(this.dataRefCount.delete(c),null!=n&&(this.numBytesInGPU-=this.computeBytes(a,r),this.textureManager.releaseTexture(n,a,i,o)));var u=this.texData.get(e);u.texture=null,u.texShape=null,u.isPacked=!1,u.slice=null},t.prototype.getTexture=function(e){return this.uploadToGPU(e),this.texData.get(e).texture},t.prototype.getDataInfo=function(e){return this.texData.get(e)},t.prototype.getCPUBackend=function(){return Da().getBool("WEBGL_CPU_FORWARD")?(null==this.cpuBackend&&(this.cpuBackend=no.findBackend("cpu")),this.cpuBackend):null},t.prototype.shouldExecuteOnCPU=function(e,t){var n=this;return void 0===t&&(t=128),null!=this.getCPUBackend()&&e.every(function(e){return null==n.texData.get(e.dataId).texture&&e.size<t})},t.prototype.getGPGPUContext=function(){return this.gpgpu},t.prototype.complex=function(e,t){var n=this.makeOutput(e.shape,"complex64");return this.texData.get(n.dataId).complexTensors={real:no.keep(e.clone()),imag:no.keep(t.clone())},n},t.prototype.real=function(e){return this.texData.get(e.dataId).complexTensors.real.clone()},t.prototype.imag=function(e){return this.texData.get(e.dataId).complexTensors.imag.clone()},t.prototype.slice=function(e,t,n){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.slice(e,t,n);if(0===$a(n))return As([],n,e.dtype);var r=this.texData.get(e.dataId).isPacked,a=Yc(e.shape,t,n);if(r||!a){var i=Da().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Wh(n):new zh(n),o=i.getCustomSetupFunc(t);return this.compileAndRun(i,[e],null,o)}return this.uploadToGPU(e.dataId),this.shallowSlice(e,t,n)},t.prototype.shallowSlice=function(e,t,n){var r=this.texData.get(e.dataId),a=this.makeOutput(n,e.dtype),i=this.texData.get(a.dataId);Object.assign(i,r),i.shape=n,i.dtype=e.dtype;var o=$c(t,e.strides);r.slice&&(o+=r.slice.flatOffset),i.slice={flatOffset:o,origDataId:r.slice&&r.slice.origDataId||e.dataId};var s=this.dataRefCount.get(i.slice.origDataId)||1;return this.dataRefCount.set(i.slice.origDataId,s+1),a},t.prototype.stridedSlice=function(e,t,n,r){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.stridedSlice(e,t,n,r);var a=qc(t,n,r);if(a.some(function(e){return 0===e}))return As([],a);var i=new Vh(t,r,a);return this.compileAndRun(i,[e])},t.prototype.reverse=function(e,t){var n=Da().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Ph(e.shape,t):new Lh(e.shape,t);return this.compileAndRun(n,[e])},t.prototype.concat=function(e,t){if("complex64"===e[0].dtype){var n=e.map(function(e){return Ts(e)}),r=e.map(function(e){return _s(e)});return Is(this.concat(n,t),this.concat(r,t))}if(this.shouldExecuteOnCPU(e))return this.cpuBackend.concat(e,t);if(1===e.length)return e[0];if(e.length>Da().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){var a=Math.floor(e.length/2),i=this.concat(e.slice(0,a),t),o=this.concat(e.slice(a),t);return this.concat([i,o],t)}if(Da().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&e[0].rank>1){var s=new wu(e.map(function(e){return e.shape}),t);return this.compileAndRun(s,e)}var c=Cs(e.map(function(e){return e.shape}),t),l=e.map(function(e){return e.as2D(-1,$a(e.shape.slice(t)))}),u=new xu(l.map(function(e){return e.shape}));return this.compileAndRun(u,l).reshape(c)},t.prototype.neg=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.neg(e);if(Da().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,id,e.dtype);var t=new Qh(e.shape,id);return this.compileAndRun(t,[e])},t.prototype.batchMatMul=function(e,t,n,r){var a=n?e.shape[2]:e.shape[1],i=r?t.shape[1]:t.shape[2],o=n?e.shape[1]:e.shape[2],s=e.shape[0];if((1===a||1===i)&&o>1e3){n&&(e=e.transpose([0,2,1])),r&&(t=t.transpose([0,2,1]));var c=1===i?e:e.as3D(s,o,1),l=1===i?2:1,u=1===i?t.as3D(s,1,o):t;return this.multiply(c,u).sum(l,!0)}var h=Xi(e.dtype,t.dtype),d=new xh(e.shape,[s,a,i],n,r);return this.compileAndRun(d,[e,t],h)},t.prototype.fusedBatchMatMul=function(e){var t=e.a,n=e.b,r=e.transposeA,a=e.transposeB,i=e.bias,o=e.activation,s=e.preluActivationWeights,c=r?t.shape[2]:t.shape[1],l=a?n.shape[1]:n.shape[2],u=t.shape[0],h=Xi(t.dtype,n.dtype),d=null!=i,f=null!=s,p=o?Cd(o,!0):null,m=new xh(t.shape,[u,c,l],r,a,d,p,f),g=[t,n];return i&&g.push(i),s&&g.push(s),this.compileAndRun(m,g,h)},t.prototype.multiply=function(e,t){if("complex64"===e.dtype){var n=this.texData.get(e.dataId),r=this.texData.get(t.dataId),a=new lu("return areal * breal - aimag * bimag;",e.shape,t.shape),i=new lu("return areal * bimag + aimag * breal;",e.shape,t.shape),o=[this.makeComplexComponentTensorInfo(e,n.complexTensors.real),this.makeComplexComponentTensorInfo(e,n.complexTensors.imag),this.makeComplexComponentTensorInfo(t,r.complexTensors.real),this.makeComplexComponentTensorInfo(t,r.complexTensors.imag)],s=this.compileAndRun(a,o),c=this.compileAndRun(i,o),l=this.complex(s,c);return s.dispose(),c.dispose(),l}if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.multiply(e,t);if(Da().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,du,e.dtype);var u=new pu(du,e.shape,t.shape);return this.compileAndRun(u,[e,t],e.dtype)},t.prototype.batchNormalization=function(e,t,n,r,a,i){var o=[e,t,n],s=null;null!=i&&(s=i.shape,o.push(i));var c=null;if(null!=a&&(c=a.shape,o.push(a)),Da().getBool("WEBGL_PACK_NORMALIZATION")){var l=new cu(e.shape,t.shape,n.shape,s,c,r);return this.compileAndRun(l,o)}var u=new su(e.shape,t.shape,n.shape,s,c,r);return this.compileAndRun(u,o)},t.prototype.localResponseNormalization4D=function(e,t,n,r,a){var i=Da().getBool("WEBGL_PACK_NORMALIZATION")?new vh(e.shape,t,n,r,a):new mh(e.shape,t,n,r,a);return this.compileAndRun(i,[e])},t.prototype.LRNGrad=function(e,t,n,r,a,i,o){var s=new gh(t.shape,r,a,i,o);return this.compileAndRun(s,[t,n,e])},t.prototype.tile=function(e,t){if("string"===e.dtype){var n=this.readSync(e.dataId).map(function(e){return Ti(e)});return Ol(sc(e.shape,e.dtype,n),t)}var r=new Kh(e.shape,t);return this.compileAndRun(r,[e])},t.prototype.pad=function(e,t,n){var r=Da().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Ch(e.shape,t,n):new Nh(e.shape,t,n);return this.compileAndRun(r,[e])},t.prototype.transpose=function(e,t){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.transpose(e,t);var n=Da().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Yh(e.shape,t):new Xh(e.shape,t);return this.compileAndRun(n,[e])},t.prototype.gather=function(e,t,n){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.gather(e,t,n);var r=new qu(e.shape,t.size,n);return this.compileAndRun(r,[e,t])},t.prototype.batchToSpaceND=function(e,t,n){qa(e.rank<=4,function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"});var r=t.reduce(function(e,t){return e*t}),a=Oc(e.shape,t,r),i=Lc(a.length,t.length),o=Pc(e.shape,t,r),s=Mc(n,t.length),c=jc(o,n,t.length);return e.reshape(a).transpose(i).reshape(o).slice(s,c)},t.prototype.spaceToBatchND=function(e,t,n){qa(e.rank<=4,function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"});var r=t.reduce(function(e,t){return e*t}),a=[[0,0]];a.push.apply(a,n);for(var i=1+t.length;i<e.shape.length;++i)a.push([0,0]);var o=e.pad(a),s=Oc(o.shape,t,r,!1),c=Lc(s.length,t.length,!1),l=Pc(o.shape,t,r,!1);return o.reshape(s).transpose(c).reshape(l)},t.prototype.reduce=function(e,t,n){var r=e.shape[0],a=e.shape[1],i=zc(a),o=new Th({windowSize:i,inSize:a,batchSize:r},t),s=this.compileAndRun(o,[e],n);return 1===s.shape[1]?s:this.reduce(s,t,n)},t.prototype.argReduce=function(e,t,n){void 0===n&&(n=null);var r=e.shape[0],a=e.shape[1];null!=n&&(r=n.shape[0],a=n.shape[1]);var i=zc(a),o=new Bl({windowSize:i,inSize:a,batchSize:r},t,null==n),s=[e];null!=n&&s.push(n);var c=this.compileAndRun(o,s,"int32");return 1===c.shape[1]?c:this.argReduce(e,t,c)},t.prototype.argReducePacked=function(e,t,n){void 0===n&&(n=null);var r=null!=n?n.shape:e.shape,a=zc(r[r.length-1]),i=new au(r,a,t,null==n),o=null==n?[e]:[e,n],s=this.compileAndRun(i,o,"int32");return s.rank===e.rank?this.argReducePacked(e,t,s):s},t.prototype.sum=function(e,t){xs("sum",t,e.rank);var n=bs(e.shape,t),r=n[0],a=$a(n[1]),i=e.as2D(-1,a),o=Yi(e.dtype);return this.reduce(i,"sum",o).reshape(r)},t.prototype.prod=function(e,t){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.prod(e,t);var n=bs(e.shape,t),r=n[0],a=$a(n[1]),i=e.as2D(-1,a),o=Yi(e.dtype);return this.reduce(i,"prod",o).reshape(r)},t.prototype.unsortedSegmentSum=function(e,t,n){var r=0,a=ws([r],e.rank),i=e;null!=a&&(i=e.transpose(a),r=Ss(1,e.rank)[0]);var o=function(e,t,n){for(var r=[],a=e.length,i=0;i<a;i++)i!==t?r.push(e[i]):r.push(n);return r}(i.shape,r,n),s=$a([i.shape[r]]),c=i.as2D(-1,s),l=Yi(e.dtype),u=this.segOpCompute(c,"unsortedSegmentSum",t,l,n).reshape(o);return null!=a&&(u=u.transpose(ks(a))),u},t.prototype.segOpCompute=function(e,t,n,r,a){var i=e.shape[0],o=e.shape[1],s=function(e,t){var n,r=!1;for(e<=30?(n=e,r=!0):n=yi(e,Math.floor(Math.sqrt(e)));!r;)n>t||n===e?r=!0:n=yi(e,n+1);return n}(o,a),c=new jh({windowSize:s,inSize:o,batchSize:i,numSegments:a},t),l=this.compileAndRun(c,[e,n],r);return l.shape[1]===a?l:(n=zs(0,a).tile([o/s]),this.segOpCompute(l,t,n,r,a))},t.prototype.argMinMaxReduce=function(e,t,n){var r=[t];if(xs("arg"+n.charAt(0).toUpperCase()+n.slice(1),r,e.rank),!Da().getBool("WEBGL_PACK_REDUCE")||e.rank<=2){var a=bs(e.shape,r),i=a[0],o=$a(a[1]),s=e.as2D(-1,o);return this.argReduce(s,n).reshape(i)}return this.argReducePacked(e,n)},t.prototype.argMin=function(e,t){return this.argMinMaxReduce(e,t,"min")},t.prototype.argMax=function(e,t){return this.argMinMaxReduce(e,t,"max")},t.prototype.cumsum=function(e,t,n,r){if(t!==e.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(e.rank-1)+" but got axis="+t);var a=new Ou(e.shape,n,r);return this.compileAndRun(a,[e])},t.prototype.equal=function(e,t){if(Da().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(equal(a, b));\n","bool");var n=new pu("return float(a == b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.notEqual=function(e,t){if(Da().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(notEqual(a, b));\n","bool");var n=new pu("return float(a != b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.less=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.less(e,t);if(Da().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(lessThan(a, b));\n","bool");var n=new pu("return float(a < b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.lessEqual=function(e,t){if(Da().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(lessThanEqual(a, b));\n","bool");var n=new pu("return float(a <= b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.greater=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.greater(e,t);if(Da().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(greaterThan(a, b));\n","bool");var n=new pu("return float(a > b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.greaterEqual=function(e,t){if(Da().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(greaterThanEqual(a, b));\n","bool");var n=new pu("return float(a >= b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.logicalNot=function(e){var t=new Qh(e.shape,"return float(!(x >= 1.0));");return this.compileAndRun(t,[e])},t.prototype.logicalAnd=function(e,t){if(Da().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(\n    vec4(greaterThanEqual(a, vec4(1.0))) *\n    vec4(greaterThanEqual(b, vec4(1.0))));\n","bool");var n=new pu("return float(a >= 1.0 && b >= 1.0);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.logicalOr=function(e,t){if(Da().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return min(\n    vec4(greaterThanEqual(a, vec4(1.0))) +\n    vec4(greaterThanEqual(b, vec4(1.0))),\n    vec4(1.0));\n","bool");var n=new pu("return float(a >= 1.0 || b >= 1.0);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.select=function(e,t,n){var r=new Bh(e.rank,t.shape,t.rank);return this.compileAndRun(r,[e,t,n],Xi(t.dtype,n.dtype))},t.prototype.where=function(e){hs("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var t=e.dataSync();return Pl(e.shape,t)},t.prototype.topk=function(e,t,n){return Ll(e.dataSync(),e.shape,e.dtype,t)},t.prototype.min=function(e,t){xs("min",t,e.rank);var n=bs(e.shape,t),r=n[0],a=$a(n[1]),i=e.as2D(-1,a);return this.reduce(i,"min",i.dtype).reshape(r)},t.prototype.minimum=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.minimum(e,t);var n=Da().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new gu("\n  vec4 result = vec4(min(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new pu("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return min(a, b);\n",e.shape,t.shape);return this.compileAndRun(n,[e,t])},t.prototype.mod=function(e,t){var n=Da().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new gu("\n  vec4 result = mod(a, b);\n  vec4 isNaN = vec4(equal(b, vec4(0.0)));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new pu("if (b == 0.0) return NAN;\n  return mod(a, b);",e.shape,t.shape);return this.compileAndRun(n,[e,t])},t.prototype.max=function(e,t){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.max(e,t);xs("max",t,e.rank);var n=bs(e.shape,t),r=n[0],a=$a(n[1]),i=e.as2D(-1,a);return this.reduce(i,"max",i.dtype).reshape(r)},t.prototype.maximum=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.maximum(e,t);var n=Da().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new gu("\n  vec4 result = vec4(max(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new pu("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return max(a, b);\n",e.shape,t.shape);return this.compileAndRun(n,[e,t])},t.prototype.all=function(e,t){xs("all",t,e.rank);var n=bs(e.shape,t),r=n[0],a=$a(n[1]),i=e.as2D(-1,a);return this.reduce(i,"all",i.dtype).reshape(r)},t.prototype.any=function(e,t){xs("any",t,e.rank);var n=bs(e.shape,t),r=n[0],a=$a(n[1]),i=e.as2D(-1,a);return this.reduce(i,"any",i.dtype).reshape(r)},t.prototype.realDivide=function(e,t){if(Da().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  // vec4 one = vec4(equal(a, b));\n  // return one + (vec4(1.0) - one) * a / b;\n  vec4 result = a / b;\n  if(a.x == b.x) {\n    result.x = 1.;\n  }\n  if(a.y == b.y) {\n    result.y = 1.;\n  }\n  if(a.z == b.z) {\n    result.z = 1.;\n  }\n  if(a.w == b.w) {\n    result.w = 1.;\n  }\n\n  return result;\n","float32",!0);var n=new pu("\nif (a == b) {\n  return 1.0;\n};\nreturn a / b;",e.shape,t.shape);return this.compileAndRun(n,[e,t],"float32")},t.prototype.floorDiv=function(e,t){if(Da().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  ivec4 ia = round(a);\n  ivec4 ib = round(b);\n  bvec4 cond = notEqual(ib, ivec4(0));\n  ivec4 result = ivec4(0);\n  vec4 s = sign(a) * sign(b);\n\n  // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n  if (cond[0]) {\n    result[0] = idiv(ia[0], ib[0], s[0]);\n  }\n  if (cond[1]) {\n    result[1] = idiv(ia[1], ib[1], s[1]);\n  }\n  if (cond[2]) {\n    result[2] = idiv(ia[2], ib[2], s[2]);\n  }\n  if (cond[3]) {\n    result[3] = idiv(ia[3], ib[3], s[3]);\n  }\n  return vec4(result);\n","int32");var n=new pu("\n  float s = sign(a) * sign(b);\n  int ia = round(a);\n  int ib = round(b);\n  if (ib != 0) {\n    // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n    return float(idiv(ia, ib, s));\n  } else {\n    return NAN;\n  }\n",e.shape,t.shape);return this.compileAndRun(n,[e,t],"int32")},t.prototype.add=function(e,t){if("complex64"===e.dtype&&"complex64"===t.dtype)return this.complexSeparableBinaryOp(e,t,uu);if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.add(e,t);var n=Xi(e.dtype,t.dtype);if(Da().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,uu,n);var r=new pu(uu,e.shape,t.shape);return this.compileAndRun(r,[e,t],n)},t.prototype.packedUnaryOp=function(e,t,n){var r=new kd(e.shape,t);return this.compileAndRun(r,[e],n)},t.prototype.packedBinaryOp=function(e,t,n,r,a){void 0===a&&(a=!1);var i=new gu(n,e.shape,t.shape,a);return this.compileAndRun(i,[e,t],r)},t.prototype.complexSeparableBinaryOp=function(e,t,n){var r=this,a=this.texData.get(e.dataId),i=this.texData.get(t.dataId),o=[[a.complexTensors.real,i.complexTensors.real],[a.complexTensors.imag,i.complexTensors.imag]].map(function(a){var i=a[0],o=a[1],s=r.makeComplexComponentTensorInfo(e,i),c=r.makeComplexComponentTensorInfo(t,o),l=new pu(n,e.shape,t.shape);return r.compileAndRun(l,[s,c],Xi(i.dtype,o.dtype))}),s=o[0],c=o[1],l=this.complex(s,c);return s.dispose(),c.dispose(),l},t.prototype.makeComplexComponentTensorInfo=function(e,t){return{dataId:t.dataId,dtype:t.dtype,shape:e.shape}},t.prototype.addN=function(e){if(1===e.length)return e[0];if(e.length>Da().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var t=Math.floor(e.length/2),n=this.addN(e.slice(0,t)),r=this.addN(e.slice(t));return this.addN([n,r])}var a=e.map(function(e){return e.dtype}).reduce(function(e,t){return Xi(e,t)}),i=e.map(function(e){return e.shape}),o=Da().getBool("WEBGL_PACK")?new jl(e[0].shape,i):new Ml(e[0].shape,i);return this.compileAndRun(o,e,a)},t.prototype.subtract=function(e,t){if("complex64"===e.dtype&&"complex64"===t.dtype)return this.complexSeparableBinaryOp(e,t,hu);if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.subtract(e,t);var n=Xi(e.dtype,t.dtype);if(Da().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,hu,e.dtype);var r=new pu(hu,e.shape,t.shape);return this.compileAndRun(r,[e,t],n)},t.prototype.pow=function(e,t){var n=Da().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new gu("\n  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.\n  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));\n  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);\n  vec4 result = multiplier * pow(abs(a), b);\n\n  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS\n  bvec4 isExpZero = equal(b, vec4(0.0));\n  result.r = isExpZero.r ? 1.0 : result.r;\n  result.g = isExpZero.g ? 1.0 : result.g;\n  result.b = isExpZero.b ? 1.0 : result.b;\n  result.a = isExpZero.a ? 1.0 : result.a;\n\n  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new pu("\nif(a < 0.0 && floor(b) < b){\n  return NAN;\n}\nif (b == 0.0) {\n  return 1.0;\n}\nreturn (round(mod(b, 2.0)) != 1) ?\n    pow(abs(a), b) : sign(a) * pow(abs(a), b);\n",e.shape,t.shape),r=Xi(e.dtype,t.dtype);return this.compileAndRun(n,[e,t],r)},t.prototype.ceil=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.ceil(e);if(Da().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,od,e.dtype);var t=new Qh(e.shape,od);return this.compileAndRun(t,[e])},t.prototype.floor=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.floor(e);if(Da().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,sd,e.dtype);var t=new Qh(e.shape,sd);return this.compileAndRun(t,[e])},t.prototype.sign=function(e){var t=new Qh(e.shape,"\n  if (isnan(x)) { return 0.0; }\n  return sign(x);\n");return this.compileAndRun(t,[e])},t.prototype.isNaN=function(e){var t=new Qh(e.shape,"return float(isnan(x));");return this.compileAndRun(t,[e],"bool")},t.prototype.isInf=function(e){var t=new Qh(e.shape,"return float(isinf(x));");return this.compileAndRun(t,[e],"bool")},t.prototype.isFinite=function(e){var t=new Qh(e.shape,"return float(!isnan(x) && !isinf(x));");return this.compileAndRun(t,[e],"bool")},t.prototype.round=function(e){var t=new Qh(e.shape,"\n  // OpenGL ES does not support round function.\n  // The algorithm is based on banker's rounding.\n  float base = floor(x);\n  if ((x - base) < 0.5) {\n    return floor(x);\n  } else if ((x - base) > 0.5) {\n    return ceil(x);\n  } else {\n    if (mod(base, 2.0) == 0.0) {\n      return base;\n    } else {\n      return base + 1.0;\n    }\n  }\n");return this.compileAndRun(t,[e])},t.prototype.exp=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.exp(e);if(Da().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,cd,e.dtype);var t=new Qh(e.shape,cd);return this.compileAndRun(t,[e])},t.prototype.expm1=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.expm1(e);if(Da().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,ld,e.dtype);var t=new Qh(e.shape,ld);return this.compileAndRun(t,[e])},t.prototype.softmax=function(e,t){var n=ai([t],e.shape),r=this.max(e,n),a=ys(r.shape,n),i=this.subtract(e,r.reshape(a)),o=this.exp(i),s=this.sum(o,n).reshape(a);return this.realDivide(o,s)},t.prototype.log=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.log(e);if(Da().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,"\n  vec4 result = log(x);\n  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));\n  result.r = isNaN.r == 1.0 ? NAN : result.r;\n  result.g = isNaN.g == 1.0 ? NAN : result.g;\n  result.b = isNaN.b == 1.0 ? NAN : result.b;\n  result.a = isNaN.a == 1.0 ? NAN : result.a;\n\n  return result;\n",e.dtype);var t=new Qh(e.shape,"if (x < 0.0) return NAN;\n  return log(x);");return this.compileAndRun(t,[e])},t.prototype.log1p=function(e){var t=new Qh(e.shape,"return log(1.0 + x);");return this.compileAndRun(t,[e])},t.prototype.sqrt=function(e){var t=new Qh(e.shape,"return sqrt(x);");return this.compileAndRun(t,[e])},t.prototype.rsqrt=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.rsqrt(e);var t=new Qh(e.shape,"return inversesqrt(x);");return this.compileAndRun(t,[e])},t.prototype.reciprocal=function(e){var t=new Qh(e.shape,"return 1.0 / x;");return this.compileAndRun(t,[e])},t.prototype.relu=function(e){var t;return t=Da().getBool("WEBGL_PACK")?new kd(e.shape,yd):new Qh(e.shape,td),this.compileAndRun(t,[e])},t.prototype.relu6=function(e){var t;return t=Da().getBool("WEBGL_PACK")?new kd(e.shape,xd):new Qh(e.shape,nd),this.compileAndRun(t,[e])},t.prototype.prelu=function(e,t){var n=Da().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new gu(mu,e.shape,t.shape):new pu(fu,e.shape,t.shape);return this.compileAndRun(n,[e,t])},t.prototype.elu=function(e){if(Da().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,wd,e.dtype);var t=new Qh(e.shape,rd);return this.compileAndRun(t,[e])},t.prototype.eluDer=function(e,t){var n=Da().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new gu("\n  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));\n  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));\n",e.shape,t.shape):new pu("return (b >= 1.0) ? a : a * (b + 1.0);",e.shape,t.shape);return this.compileAndRun(n,[e,t])},t.prototype.selu=function(e){var t=new Qh(e.shape,ad);return this.compileAndRun(t,[e])},t.prototype.int=function(e){var t=new Qh(e.shape,"return float(int(x));");return this.compileAndRun(t,[e],"int32")},t.prototype.clip=function(e,t,n){var r,a=(r=Da().getBool("WEBGL_PACK_CLIP")?new bu(e.shape):new vu(e.shape)).getCustomSetupFunc(t,n);return this.compileAndRun(r,[e],null,a)},t.prototype.abs=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.abs(e);if(Da().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,ed,e.dtype);var t=new Qh(e.shape,ed);return this.compileAndRun(t,[e])},t.prototype.complexAbs=function(e){var t=this.texData.get(e.dataId),n=new yu(e.shape),r=[this.makeComplexComponentTensorInfo(e,t.complexTensors.real),this.makeComplexComponentTensorInfo(e,t.complexTensors.imag)];return this.compileAndRun(n,r)},t.prototype.sigmoid=function(e){var t=new Qh(e.shape,"return 1.0 / (1.0 + exp(-1.0 * x));");return this.compileAndRun(t,[e])},t.prototype.softplus=function(e){var t=new Qh(e.shape,"\n  float epsilon = 1.1920928955078125e-7;\n  float threshold = log(epsilon) + 2.0;\n\n  bool too_large = x > -threshold;\n  bool too_small = x < threshold;\n\n  float result;\n  float exp_x = exp(x);\n\n  if (too_large){\n    result = x;\n  }\n  else if (too_small){\n    result = exp_x;\n  }\n  else{\n    result = log(exp_x + 1.0);\n  }\n  return result;\n");return this.compileAndRun(t,[e])},t.prototype.sin=function(e){var t=new Qh(e.shape,ud);return this.compileAndRun(t,[e])},t.prototype.cos=function(e){var t=new Qh(e.shape,hd);return this.compileAndRun(t,[e])},t.prototype.tan=function(e){var t=new Qh(e.shape,"return tan(x);");return this.compileAndRun(t,[e])},t.prototype.asin=function(e){var t=new Qh(e.shape,dd);return this.compileAndRun(t,[e])},t.prototype.acos=function(e){var t=new Qh(e.shape,fd);return this.compileAndRun(t,[e])},t.prototype.atan=function(e){var t=new Qh(e.shape,pd);return this.compileAndRun(t,[e])},t.prototype.atan2=function(e,t){var n=Da().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new gu("\n  vec4 result = atan(a, b);\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new pu("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return atan(a, b);\n",e.shape,t.shape);return this.compileAndRun(n,[e,t])},t.prototype.sinh=function(e){var t=new Qh(e.shape,"\n  float e2x = exp(x);\n  return (e2x - 1.0 / e2x) / 2.0;\n");return this.compileAndRun(t,[e])},t.prototype.cosh=function(e){var t=new Qh(e.shape,"\n  float e2x = exp(-x);\n  return (e2x + 1.0 / e2x) / 2.0;\n");return this.compileAndRun(t,[e])},t.prototype.tanh=function(e){var t=new Qh(e.shape,"\n  float e2x = exp(-2.0 * abs(x));\n  return sign(x) * (1.0 - e2x) / (1.0 + e2x);\n");return this.compileAndRun(t,[e])},t.prototype.asinh=function(e){var t=new Qh(e.shape,md);return this.compileAndRun(t,[e])},t.prototype.acosh=function(e){var t=new Qh(e.shape,gd);return this.compileAndRun(t,[e])},t.prototype.atanh=function(e){var t=new Qh(e.shape,vd);return this.compileAndRun(t,[e])},t.prototype.erf=function(e){var t=new Qh(e.shape,'\n  // Error function is calculated approximately with elementary function.\n  // See "Handbook of Mathematical Functions with Formulas,\n  // Graphs, and Mathematical Tables", Abramowitz and Stegun.\n  float p = 0.3275911;\n  float a1 = 0.254829592;\n  float a2 = -0.284496736;\n  float a3 = 1.421413741;\n  float a4 = -1.453152027;\n  float a5 = 1.061405429;\n\n  float sign = sign(x);\n  x = abs(x);\n  float t = 1.0 / (1.0 + p * x);\n  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));\n');return this.compileAndRun(t,[e])},t.prototype.step=function(e,t){var n=new Qh(e.shape,function(e){return void 0===e&&(e=0),Zh+"\n    return x > 0.0 ? 1.0 : float("+e+");\n  "}(t));return this.compileAndRun(n,[e])},t.prototype.conv2dByMatMul=function(e,t,n,r,a,i){var o=e.shape,s=this.texData.get(e.dataId),c=n.inChannels,l=o[0]*o[1]*o[2],u=n.outChannels,h="channelsLast"===n.dataFormat,d=(1===l||1===u)&&c>1e3,f=o[2]%2!=0&&!!s.isPacked;if(d||!Da().getBool("WEBGL_LAZILY_UNPACK")||!Da().getBool("WEBGL_PACK_BINARY_OPERATIONS")||!f){var p=h?o[0]*o[1]*o[2]:o[0]*o[2]*o[3],m=this.reshape(e,[1,p,n.inChannels]),g=this.reshape(t,[1,n.inChannels,n.outChannels]);return this.reshape(this.fusedBatchMatMul({a:m,b:g,transposeA:!1,transposeB:!1,bias:r,activation:a,preluActivationWeights:i}),n.outShape)}var v=h?o[0]*o[1]*(o[2]+1):o[0]*o[2]*(o[3]+1),b={dataId:e.dataId,shape:[1,v,n.inChannels],dtype:e.dtype},y=s.shape;s.shape=s.shape.slice(),s.shape[s.shape.length-2]++,qa($o(s.shape,b.shape),function(){return"packed reshape "+s.shape+" to "+b.shape+" isn't free"});var x=this.reshape(t,[1,n.inChannels,n.outChannels]),w=this.fusedBatchMatMul({a:b,b:x,transposeA:!1,transposeB:!1,bias:r,activation:a,preluActivationWeights:i}),k=this.texData.get(w.dataId);return qa(k.isPacked,function(){return"batchMatMul result is expected to be packed"}),s.shape=y,k.shape=n.outShape,no.makeTensorFromDataId(w.dataId,n.outShape,w.dtype)},t.prototype.conv2dWithIm2Row=function(e,t,n,r,a,i){var o=n.filterWidth,s=n.filterHeight,c=n.inChannels,l=n.outWidth,u=n.outHeight,h="channelsLast"===n.dataFormat,d=o*s*c,f=u*l,p=[d,f],m=e.squeeze([0]),g=t.reshape([1,d,-1]),v=new ph(p,m.shape,n),b=this.compileAndRun(v,[m]).reshape([1,p[0],p[1]]),y=null!=r,x=null!=i,w=a?Cd(a,!0):null,k=new xh(b.shape,[1,f,n.outChannels],!0,!1,y,w,x),S=[b,g];r&&S.push(r),x&&S.push(i);var N=this.compileAndRun(k,S);return h?N.reshape([1,u,l,n.outChannels]):N.reshape([1,n.outChannels,u,l])},t.prototype.fusedConv2d=function(e){var t=e.input,n=e.filter,r=e.convInfo,a=e.bias,i=e.activation,o=e.preluActivationWeights;if(1===r.filterHeight&&1===r.filterWidth&&1===r.dilationHeight&&1===r.dilationWidth&&1===r.strideHeight&&1===r.strideWidth&&("SAME"===r.padInfo.type||"VALID"===r.padInfo.type))return this.conv2dByMatMul(t,n,r,a,i,o);if(Da().getBool("WEBGL_CONV_IM2COL")&&1===t.shape[0])return this.conv2dWithIm2Row(t,n,r,a,i,o);var s=null!=a,c=null!=o,l=i?Cd(i,!1):null,u=new _u(r,s,l,c),h=[t,n];return a&&h.push(a),o&&h.push(o),this.compileAndRun(u,h)},t.prototype.conv2d=function(e,t,n){if(1===n.filterHeight&&1===n.filterWidth&&1===n.dilationHeight&&1===n.dilationWidth&&1===n.strideHeight&&1===n.strideWidth&&("SAME"===n.padInfo.type||"VALID"===n.padInfo.type))return this.conv2dByMatMul(e,t,n);if(Da().getBool("WEBGL_CONV_IM2COL")&&1===e.shape[0])return this.conv2dWithIm2Row(e,t,n);var r=new _u(n);return this.compileAndRun(r,[e,t])},t.prototype.conv2dDerInput=function(e,t,n){var r=new Nu(n);return this.compileAndRun(r,[e,t])},t.prototype.conv2dDerFilter=function(e,t,n){var r=new Su(n);return this.compileAndRun(r,[e,t])},t.prototype.fusedDepthwiseConv2D=function(e){var t,n=e.input,r=e.filter,a=e.convInfo,i=e.bias,o=e.activation,s=e.preluActivationWeights,c=Da().getBool("WEBGL_PACK_DEPTHWISECONV")&&a.strideWidth<=2&&a.outChannels/a.inChannels==1,l=o?Cd(o,c):null,u=[n,r],h=null!=i,d=null!=s;return h&&u.push(i),d&&u.push(s),c?(t=new Fu(a,h,l,d),this.compileAndRun(t,u)):(t=new Ru(a,h,l,d),this.compileAndRun(t,u))},t.prototype.depthwiseConv2D=function(e,t,n){var r;return Da().getBool("WEBGL_PACK_DEPTHWISECONV")&&n.strideWidth<=2&&n.outChannels/n.inChannels==1?(r=new Fu(n),this.compileAndRun(r,[e,t])):(r=new Ru(n),this.compileAndRun(r,[e,t]))},t.prototype.depthwiseConv2DDerInput=function(e,t,n){var r=new Tu(n);return this.compileAndRun(r,[e,t])},t.prototype.depthwiseConv2DDerFilter=function(e,t,n){var r=new Iu(n);return this.compileAndRun(r,[e,t])},t.prototype.conv3d=function(e,t,n){var r=new Au(n);return this.compileAndRun(r,[e,t])},t.prototype.conv3dDerInput=function(e,t,n){var r=new Eu(n);return this.compileAndRun(r,[e,t])},t.prototype.conv3dDerFilter=function(e,t,n){var r=new Cu(n);return this.compileAndRun(r,[e,t])},t.prototype.maxPool=function(e,t){var n=new Eh(t,"max",!1);return this.compileAndRun(n,[e])},t.prototype.avgPool=function(e,t){var n=new Eh(t,"avg",!1);return this.compileAndRun(n,[e],"float32")},t.prototype.maxPoolBackprop=function(e,t,n,r){var a=new Eh(r,"max",!0),i=this.compileAndRun(a,[t]),o=new bh(r),s=this.compileAndRun(o,[e,i],t.dtype);return i.dispose(),s},t.prototype.avgPoolBackprop=function(e,t,n){var r=new iu(n);return this.compileAndRun(r,[e],t.dtype)},t.prototype.cast=function(e,t){return bl(e,t,this)},t.prototype.unstack=function(e,t){for(var n=e.shape[t],r=new Array(e.rank-1),a=0,i=0;i<e.rank;i++)i!==t&&(r[a++]=e.shape[i]);var o=new Array(e.rank).fill(0),s=e.shape.slice();s[t]=1;var c=new Array(n);for(i=0;i<c.length;i++)o[t]=i,c[i]=this.slice(e,o,s).reshape(r);return c},t.prototype.avgPool3d=function(e,t){var n=new Ih(t,"avg",!1);return this.compileAndRun(n,[e],"float32")},t.prototype.avgPool3dBackprop=function(e,t,n){var r=new ou(n);return this.compileAndRun(r,[e],t.dtype)},t.prototype.maxPool3d=function(e,t){var n=new Ih(t,"max",!1);return this.compileAndRun(n,[e],"float32")},t.prototype.maxPool3dBackprop=function(e,t,n,r){var a=new Ih(r,"max",!0),i=this.compileAndRun(a,[t]),o=new yh(r),s=this.compileAndRun(o,[e,i],t.dtype);return i.dispose(),s},t.prototype.reshape=function(e,t){var n=this.texData.get(e.dataId);if(n.isPacked&&!$o(e.shape,t)&&(null===n.texture||!$o(n.shape,t))){var r=this.packedReshape(e,t);return no.makeTensorFromDataId(r.dataId,r.shape,r.dtype)}return yl(e,t)},t.prototype.resizeBilinear=function(e,t,n,r){var a=Da().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new Fh(e.shape,t,n,r):new Rh(e.shape,t,n,r);return this.compileAndRun(a,[e],"float32")},t.prototype.resizeBilinearBackprop=function(e,t,n){var r=new Ah(e,t,n);return this.compileAndRun(r,[e])},t.prototype.resizeNearestNeighbor=function(e,t,n,r){var a=new Oh(e.shape,t,n,r);return this.compileAndRun(a,[e])},t.prototype.resizeNearestNeighborBackprop=function(e,t,n){var r=new Dh(e,t,n);return this.compileAndRun(r,[e])},t.prototype.multinomial=function(e,t,n,r){var a=t?e:Qc(e),i=a.shape[0],o=a.shape[1],s=new wh(i,o,n),c=s.getCustomSetupFunc(r);return this.compileAndRun(s,[a],"int32",c)},t.prototype.oneHot=function(e,t,n,r){var a=new kh(e.size,t,n,r);return this.compileAndRun(a,[e])},t.prototype.diag=function(e){var t=new Bu(e.size);return this.compileAndRun(t,[e])},t.prototype.nonMaxSuppression=function(e,t,n,r,a){return hs("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead"),Il(e.dataSync(),t.dataSync(),n,r,a)},t.prototype.cropAndResize=function(e,t,n,r,a,i){var o=new Du(e.shape,t.shape,r,a,i);return this.compileAndRun(o,[e,t,n],"float32")},t.prototype.depthToSpace=function(e,t,n){qa(t>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+t});var r=e.shape[0],a="NHWC"===n?e.shape[1]:e.shape[2],i="NHWC"===n?e.shape[2]:e.shape[3],o="NHWC"===n?e.shape[3]:e.shape[1],s=a*t,c=i*t,l=o/(t*t),u=new ju("NHWC"===n?[r,s,c,l]:[r,l,s,c],t,n);return this.compileAndRun(u,[e])},t.prototype.split=function(e,t,n){return Dl(e,t,n)},t.prototype.scatterND=function(e,t,n){var r=Vc(0,e,n),a=r.sliceRank,i=r.numUpdates,o=r.sliceSize,s=r.strides,c=r.outputSize,l=[c/o,o],u=e.reshape([i,a]),h=t.reshape([i,o]);if(0===c)return yl(As([]),n);var d=Fs(0),f=new Mh(i,a,u.rank,h.rank,s,l);return this.compileAndRun(f,[h,u,d]).reshape(n)},t.prototype.sparseToDense=function(e,t,n,r){var a=Vc(0,e,n),i=a.sliceRank,o=a.numUpdates,s=a.strides,c=a.outputSize,l=new Mh(o,i,e.rank,t.rank,s,[c,1],!1);return this.compileAndRun(l,[t,e,r]).reshape(n)},t.prototype.fft=function(e){return this.fftImpl(e,!1)},t.prototype.ifft=function(e){return this.fftImpl(e,!0)},t.prototype.fftImpl=function(e,t){var n=this.texData.get(e.dataId),r=new Hu("return real * expR - imag * expI;",e.shape,t),a=new Hu("return real * expI + imag * expR;",e.shape,t),i=[this.makeComplexComponentTensorInfo(e,n.complexTensors.real),this.makeComplexComponentTensorInfo(e,n.complexTensors.imag)],o=this.compileAndRun(r,i),s=this.compileAndRun(a,i),c=this.complex(o,s).as2D(e.shape[0],e.shape[1]);return o.dispose(),s.dispose(),c},t.prototype.gatherND=function(e,t){var n=t.shape,r=n[n.length-1],a=Bc(e,t),i=a[0],o=a[1],s=a[2],c=a[3],l=t.reshape([o,r]),u=e.reshape([e.size/s,s]),h=new Ku(r,c,[o,s]);return this.compileAndRun(h,[u,l]).reshape(i)},t.prototype.fill=function(e,t,n){if("string"===(n=n||vi(t))){var r=si(n,$a(e));return r.fill(t),no.makeTensor(r,e,n,this)}var a=new Gu(e,t),i=a.getCustomSetupFunc(t);return this.compileAndRun(a,[],n,i)},t.prototype.onesLike=function(e){if("string"===e.dtype)throw new Error("onesLike is not supported under string dtype");return this.fill(e.shape,1,e.dtype)},t.prototype.zerosLike=function(e){return this.fill(e.shape,"string"===e.dtype?"":0,e.dtype)},t.prototype.linspace=function(e,t,n){return xl(e,t,n)},t.prototype.makeTensorInfo=function(e,t){var n=this.write(null,e,t);return this.texData.get(n).usage=null,{dataId:n,shape:e,dtype:t}},t.prototype.makeOutput=function(e,t){var n=this.makeTensorInfo(e,t).dataId;return no.makeTensorFromDataId(n,e,t,this)},t.prototype.unpackTensor=function(e){var t=new Sd(e.shape);return this.runWebGLProgram(t,[e],e.dtype)},t.prototype.packTensor=function(e){var t=new Sh(e.shape);return this.runWebGLProgram(t,[e],e.dtype,null,!0)},t.prototype.packedReshape=function(e,t){var n=[Go(e.shape)].concat(qo(e.shape)),r={dtype:e.dtype,shape:n,dataId:e.dataId},a=[Go(t)].concat(qo(t)),i=new _h(a,n),o=this.runWebGLProgram(i,[r],e.dtype,null,!0);return{dataId:o.dataId,shape:t,dtype:o.dtype}},t.prototype.decode=function(e){var t,n=this.texData.get(e),r=n.isPacked,a=n.shape,i=n.dtype,o=Ko(a);return t=r?new Mu(o):new Pu(o),{dtype:i,shape:a,dataId:this.runWebGLProgram(t,[{shape:o,dtype:i,dataId:e}],i,null,!0).dataId}},t.prototype.runWebGLProgram=function(e,t,n,r,a){var i=this;void 0===a&&(a=!1);var o=this.makeTensorInfo(e.outputShape,n),s=this.texData.get(o.dataId);if(e.packedOutput&&(s.isPacked=!0),e.outPackingScheme===io.DENSE){var c=po(e.outputShape);s.texShape=c.map(function(e){return 2*e})}if(null!=e.outTexUsage&&(s.usage=e.outTexUsage),0===$a(o.shape))return s.values=oi(o.dtype,0),o;var l=[],u=t.map(function(t){if("complex64"===t.dtype)throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var n=i.texData.get(t.dataId);if(null==n.texture){if(!e.packedInputs&&$a(t.shape)<=Da().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:t.shape,texData:null,isUniform:!0,uniformValues:n.values};e.packedInputs&&(n.isPacked=!0,n.shape=t.shape)}else if(!!n.isPacked!=!!e.packedInputs)t=n.isPacked?i.unpackTensor(t):i.packTensor(t),l.push(t),n=i.texData.get(t.dataId);else if(n.isPacked&&!$o(n.shape,t.shape)){var r=t,a=t.shape;t.shape=n.shape,t=i.packedReshape(t,a),l.push(t),n=i.texData.get(t.dataId),r.shape=a}return i.uploadToGPU(t.dataId),{shape:t.shape,texData:n,isUniform:!1}});this.uploadToGPU(o.dataId);var h,d={shape:o.shape,texData:s,isUniform:!1},f=function(e,t,n){var r="";t.concat(n).forEach(function(e){var t=null!=e.texData&&null!=e.texData.slice&&e.texData.slice.flatOffset>0,n=e.isUniform?"uniform":e.texData.texShape;r+=e.shape+"_"+n+"_"+t});var a=e.userCode;return e.constructor.name+"_"+r+"_"+a}(e,u,d),p=this.getAndSaveBinary(f,function(){return function(e,t,n,r){var a=t.userCode,i=n.map(function(e,n){var r={logicalShape:e.shape,texShape:e.isUniform?null:e.texData.texShape,isUniform:e.isUniform,isPacked:!e.isUniform&&e.texData.isPacked,flatOffset:null};return null!=e.texData&&null!=e.texData.slice&&e.texData.slice.flatOffset>0&&(r.flatOffset=e.texData.slice.flatOffset),{name:t.variableNames[n],shapeInfo:r}}),o=i.map(function(e){return e.shapeInfo}),s={logicalShape:r.shape,texShape:r.texData.texShape,isUniform:!1,isPacked:r.texData.isPacked,flatOffset:null},c=ql(i,s,a,t.packedInputs),l=e.createProgram(c),u=null,h=e.getUniformLocation(l,"NAN",!1);1===Da().getNumber("WEBGL_VERSION")&&(u=e.getUniformLocation(l,"INFINITY",!1));for(var d={},f=0;f<t.variableNames.length;f++){var p=t.variableNames[f];d[p]=e.getUniformLocation(l,p,!1),d["offset"+p]=e.getUniformLocation(l,"offset"+p,!1)}return{program:t,source:c,webGLProgram:l,uniformLocations:d,inShapeInfos:o,outShapeInfo:s,infLoc:u,nanLoc:h}}(i.gpgpu,e,u,d)}),m=null!=this.activeTimers;if(m&&(h=this.startTimer()),function(e,t,n,r,a){fh(t.inShapeInfos,n),fh([t.outShapeInfo],[r]);var i=r.texData.texture,o=r.texData.texShape;r.texData.isPacked?e.setOutputPackedMatrixTexture(i,o[0],o[1]):e.setOutputMatrixTexture(i,o[0],o[1]),e.setProgram(t.webGLProgram),1===Da().getNumber("WEBGL_VERSION")&&null!==t.infLoc&&e.gl.uniform1f(t.infLoc,1/0),null!==t.nanLoc&&e.gl.uniform1f(t.nanLoc,NaN),n.forEach(function(n,r){var a=t.program.variableNames[r],i=t.uniformLocations[a],o=t.uniformLocations["offset"+a];if(null!=i)if(n.isUniform)if($a(n.shape)<2)e.gl.uniform1f(i,n.uniformValues[0]);else{var s=n.uniformValues;s instanceof Float32Array||(s=new Float32Array(s)),e.gl.uniform1fv(i,s)}else null!=n.texData.slice&&null!=o&&e.gl.uniform1i(o,n.texData.slice.flatOffset),e.setInputMatrixTexture(n.texData.texture,i,r)}),null!=a&&a(e,t.webGLProgram),e.executeProgram()}(this.gpgpu,p,u,d,r),l.forEach(function(e){return i.disposeData(e.dataId)}),m&&(h=this.endTimer(h),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(h)})),!Da().getBool("WEBGL_LAZILY_UNPACK")&&s.isPacked&&!1===a){var g=this.unpackTensor(o);return this.disposeData(o.dataId),g}return o},t.prototype.compileAndRun=function(e,t,n,r,a){void 0===a&&(a=!1),n=n||t[0].dtype;var i=this.runWebGLProgram(e,t,n,r,a);return no.makeTensorFromDataId(i.dataId,i.shape,i.dtype)},t.prototype.getAndSaveBinary=function(e,t){return e in this.binaryCache||(this.binaryCache[e]=t()),this.binaryCache[e]},t.prototype.getTextureManager=function(){return this.textureManager},t.prototype.dispose=function(){var e=this;this.disposed||(Da().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(function(t){e.gpgpu.deleteProgram(e.binaryCache[t].webGLProgram),delete e.binaryCache[t]}),this.textureManager.dispose(),null!=this.canvas&&"undefined"!=typeof HTMLCanvasElement&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)},t.prototype.floatPrecision=function(){var e=this;return null==this.floatPrecisionValue&&(this.floatPrecisionValue=ls(function(){if(!Da().get("WEBGL_RENDER_FLOAT32_ENABLED")){var t=Da().getBool("DEBUG");Da().set("DEBUG",!1);var n=e.abs(Fs(1e-8)).dataSync()[0];if(Da().set("DEBUG",t),n>0)return 32}return 16})),this.floatPrecisionValue},t.prototype.epsilon=function(){return 32===this.floatPrecision()?1e-7:1e-4},t.prototype.uploadToGPU=function(e){var t,n=this.texData.get(e),r=n.shape,a=n.dtype,i=n.values,o=n.texture,s=n.usage,c=n.isPacked;if(null==o){var l,u=null!=this.activeTimers;u&&(l=Ci());var h=n.texShape;if(null==h&&(h=Xo(r,c),n.texShape=h),null!=i){var d=Ko(r),f=void 0,p=h[1],m=h[0],g=i instanceof Uint8Array;c?(p=(t=mo(h[0],h[1]))[0],m=t[1],f=new Vu(d,[m,p],g)):f=new Wu(d,[m,p],g);var v=this.makeTensorInfo([m,p],a);this.texData.get(v.dataId).usage=g?oo.PIXELS:oo.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(v.dataId),p,m,i);var b=this.runWebGLProgram(f,[v],a,null,!0),y=this.texData.get(b.dataId);n.texture=y.texture,n.texShape=y.texShape,n.isPacked=y.isPacked,n.usage=y.usage,this.disposeData(v.dataId),this.texData.delete(b.dataId),n.values=null,u&&(this.uploadWaitMs+=Ci()-l)}else{var x=this.acquireTexture(h,s,a,c);n.texture=x}}},t.prototype.convertAndCacheOnCPU=function(e,t){var n=this.texData.get(e),r=n.dtype;return this.releaseGPUData(e),null!=t&&(n.values=function(e,t){if("float32"===t||"complex64"===t)return e;if("int32"===t||"bool"===t){for(var n="int32"===t?new Int32Array(e.length):new Uint8Array(e.length),r=0;r<n.length;++r)n[r]=Math.round(e[r]);return n}throw new Error("Unknown dtype "+t)}(t,r)),n.values},t.prototype.acquireTexture=function(e,t,n,r){if(this.numBytesInGPU+=this.computeBytes(e,n),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var a=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: "+a+" MB, most likely due to a memory leak")}return this.textureManager.acquireTexture(e,t,r)},t.prototype.computeBytes=function(e,t){return e[0]*e[1]*di(t)},t}(tl);ro()&&no.registerBackend("webgl",function(){return new Ed},2);var Id=Es({square_:function(e){var t=ps(e,"x","square"),n=[t];return no.runKernelFunc(function(e,n){return n([t]),e.square(t)},{x:t},null,"Square",{},n,[])}}),Td="SquaredDifference",_d=Es({squaredDifference_:function(e,t){var n,r=ps(e,"a","squaredDifference"),a=ps(t,"b","squaredDifference");n=$i(r,a),r=n[0],a=n[1],il(r.shape,a.shape);var i={a:r,b:a},o=[r,a];return no.runKernelFunc(function(e,t){var n=e.squaredDifference(r,a);return t([r,a]),n},i,function(e,t){var n=t[0],r=t[1],a=Fs(2);return{a:function(){return e.mul(n.sub(r).mul(a))},b:function(){return e.mul(r.sub(n).mul(a))}}},Td,{},o,[])}}),Ad=Es({abs_:function(e){var t=ps(e,"x","abs");return"complex64"===t.dtype?no.runKernelFunc(function(e){return e.complexAbs(t)},{$x:t}):no.runKernelFunc(function(e,n){var r=e.abs(t);return n([t]),r},{x:t},function(e,t){var n=t[0];return{x:function(){return e.mul(n.toFloat().step(-1))}}},"Abs")}}),Rd=Es({acos_:function(e){var t=ps(e,"x","acos");return no.runKernelFunc(function(e,n){var r=e.acos(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.divStrict(Fs(1).sub(n.toFloat().square()).sqrt()).neg()}}})}}),Fd=Es({acosh_:function(e){var t=ps(e,"x","acosh");return no.runKernelFunc(function(e,n){var r=e.acosh(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.divStrict(n.toFloat().square().sub(1).sqrt())}}})}}),Dd=Es({asin_:function(e){var t=ps(e,"x","asin");return no.runKernelFunc(function(e,n){var r=e.asin(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.divStrict(Fs(1).sub(n.toFloat().square()).sqrt())}}})}}),Od=Es({asinh_:function(e){var t=ps(e,"x","asinh");return no.runKernelFunc(function(e,n){var r=e.asinh(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.divStrict(Fs(1).add(n.toFloat().square()).sqrt())}}})}}),Ld=Es({atan_:function(e){var t=ps(e,"x","atan");return no.runKernelFunc(function(e,n){var r=e.atan(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.div(n.toFloat().square().add(1))}}})}}),Pd=Es({atanh_:function(e){var t=ps(e,"x","atanh");return no.runKernelFunc(function(e,n){var r=e.atanh(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.div(Fs(1).sub(n.toFloat().square()))}}})}}),Md=Es({ceil_:function(e){var t=ps(e,"x","ceil");return no.runKernelFunc(function(e){return e.ceil(t)},{$x:t},function(e){return{$x:function(){return Ws(e)}}})}}),jd=Es({clipByValue_:function(e,t,n){var r=ps(e,"x","clipByValue");qa(t<=n,function(){return"Error in clip: min ("+t+") must be less than or equal to max ("+n+")."});var a=[r],i={min:t,max:n};return no.runKernelFunc(function(e,a){var i=e.clip(r,t,n);return a([r]),i},{x:r},function(e,r){var a=r[0];return{x:function(){return e.where(a.greaterEqual(t).logicalAnd(a.lessEqual(n)),Ws(e))}}},"ClipByValue",i,a)}}),Bd=Es({cos_:function(e){var t=ps(e,"x","cos"),n=[t];return no.runKernelFunc(function(e,n){var r=e.cos(t);return n([t]),r},{x:t},function(e,t){var n=t[0];return{x:function(){return n.toFloat().sin().neg().mul(e)}}},"Cos",{},n)}}),zd=Es({cosh_:function(e){var t=ps(e,"x","cosh");return no.runKernelFunc(function(e,n){var r=e.cosh(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return n.toFloat().sinh().mulStrict(e)}}})}}),Ud=Es({erf_:function(e){var t=ps(e,"x","erf");return qa("int32"===t.dtype||"float32"===t.dtype,function(){return"Input dtype must be `int32` or `float32`."}),"int32"===t.dtype&&(t=t.toFloat()),no.runKernelFunc(function(e,n){var r=e.erf(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.mul(n.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}})}}),Wd=Es({exp_:function(e){var t=ps(e,"x","exp");return no.runKernelFunc(function(e,n){var r=e.exp(t);return n([r]),r},{x:t},function(e,t){return{x:function(){return e.mulStrict(t[0])}}},"Exp",{},[],[!0])}}),Vd=Es({expm1_:function(e){var t=ps(e,"x","expm1");return no.runKernelFunc(function(e,n){var r=e.expm1(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.mul(n.exp())}}})}}),Hd=Es({floor_:function(e){var t=ps(e,"x","floor");return no.runKernelFunc(function(e){return e.floor(t)},{$x:t},function(e){return{$x:function(){return Ws(e)}}})}}),Gd=Es({log_:function(e){var t=ps(e,"x","log"),n=[t];return no.runKernelFunc(function(e,n){var r=e.log(t);return n([t]),r},{x:t},function(e,t){var n=t[0];return{x:function(){return e.div(n.toFloat())}}},"Log",{},n)}}),qd=Es({log1p_:function(e){var t=ps(e,"x","log1p");return no.runKernelFunc(function(e,n){var r=e.log1p(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.div(n.add(1))}}})}}),Kd=Es({logSigmoid_:function(e){var t=ps(e,"x","logSigmoid");return no.runKernelFunc(function(e,n){var r=e.softplus(t.neg()).neg();return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.mul(n.neg().sigmoid())}}})}}),Xd=Es({neg_:function(e){var t=ps(e,"x","neg"),n=[t];return no.runKernelFunc(function(e){return e.neg(t)},{x:t},function(e){return{x:function(){return e.neg()}}},"Neg",{},n)}}),Yd=Es({reciprocal_:function(e){var t=ps(e,"x","reciprocal");return no.runKernelFunc(function(e,n){var r=e.reciprocal(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.div(n.square().neg())}}})}}),$d=Es({round_:function(e){var t=ps(e,"x","round");return no.runKernelFunc(function(e){return e.round(t)},{$x:t},function(e){return{$x:function(){return Ws(e)}}})}}),Jd=Es({rsqrt_:function(e){var t=ps(e,"x","rsqrt"),n=[t];return no.runKernelFunc(function(e,n){var r=e.rsqrt(t);return n([t]),r},{x:t},function(e,t){var n=t[0];return{x:function(){return e.div(n.pow(1.5).mul(2)).neg()}}},"Rsqrt",{},n)}}),Qd=Es({sigmoid_:function(e){var t=ps(e,"x","sigmoid");return no.runKernelFunc(function(e,n){var r=e.sigmoid(t);return n([r]),r},{x:t},function(e,t){var n=t[0];return{x:function(){return e.mul(n.mul(Fs(1).sub(n)))}}},"Sigmoid")}}),Zd=Es({sign_:function(e){var t=ps(e,"x","sign");return no.runKernelFunc(function(e){return e.sign(t)},{$x:t},function(e){return{$x:function(){return Ws(e)}}})}}),ef=Es({isNaN_:function(e){var t=ps(e,"x","isNaN");return no.runKernelFunc(function(e){return e.isNaN(t)},{$x:t},function(e){return{$x:function(){return Ws(e)}}})}}),tf=Es({isInf_:function(e){var t=ps(e,"x","isInf");return no.runKernelFunc(function(e){return e.isInf(t)},{$x:t},function(e){return{$x:function(){return Ws(e)}}})}}),nf=Es({isFinite_:function(e){var t=ps(e,"x","isFinite");return no.runKernelFunc(function(e){return e.isFinite(t)},{$x:t},function(e){return{$x:function(){return Ws(e)}}})}}),rf=Es({sin_:function(e){var t=ps(e,"x","sin"),n=[t];return no.runKernelFunc(function(e,n){var r=e.sin(t);return n([t]),r},{x:t},function(e,t){var n=t[0];return{x:function(){return n.toFloat().cos().mul(e)}}},"Sin",{},n)}}),af=Es({sinh_:function(e){var t=ps(e,"x","sinh");return no.runKernelFunc(function(e,n){var r=e.sinh(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return n.toFloat().cosh().mulStrict(e)}}})}}),of=Es({softplus_:function(e){var t=ps(e,"x","softplus");return no.runKernelFunc(function(e,n){var r=e.softplus(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.mul(n.sigmoid())}}})}}),sf=Es({sqrt_:function(e){var t=ps(e,"x","sqrt");return no.runKernelFunc(function(e,n){var r=e.sqrt(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.div(n.toFloat().sqrt().mul(2))}}})}}),cf=Es({step_:function(e,t){void 0===t&&(t=0);var n=ps(e,"x","step");return no.runKernelFunc(function(e){return e.step(n,t)},{$x:n},function(e){return{$x:function(){return Ws(e)}}})}}),lf=Es({tan_:function(e){var t=ps(e,"x","tan");return no.runKernelFunc(function(e,n){var r=e.tan(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.div(n.cos().square())}}})}}),uf=Es({tanh_:function(e){var t=ps(e,"x","tanh");return no.runKernelFunc(function(e,n){var r=e.tanh(t);return n([r]),r},{x:t},function(e,t){var n=t[0];return{x:function(){return Fs(1).sub(n.square()).mulStrict(e)}}},"Tanh",{},null,[!0])}});function hf(e,t,n,r,a,i){var o,s,c=ps(e,"x","batchNorm"),l=ps(t,"mean","batchNorm"),u=ps(n,"variance","batchNorm");return null!=a&&(o=ps(a,"scale","batchNorm")),null!=r&&(s=ps(r,"offset","batchNorm")),qa(2===c.rank,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+c.rank+"."}),qa(2===l.rank||1===l.rank,function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank "+l.rank+"."}),qa(2===u.rank||1===u.rank,function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank "+u.rank+"."}),null!=o&&qa(2===o.rank||1===o.rank,function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank "+o.rank+"."}),null!=s&&qa(2===s.rank||1===s.rank,function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank "+s.rank+"."}),pf(c,l,u,s,o,i)}function df(e,t,n,r,a,i){var o,s,c=ps(e,"x","batchNorm"),l=ps(t,"mean","batchNorm"),u=ps(n,"variance","batchNorm");return null!=a&&(o=ps(a,"scale","batchNorm")),null!=r&&(s=ps(r,"offset","batchNorm")),qa(3===c.rank,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+c.rank+"."}),qa(3===l.rank||1===l.rank,function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank "+l.rank+"."}),qa(3===u.rank||1===u.rank,function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank "+u.rank+"."}),null!=o&&qa(3===o.rank||1===o.rank,function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank "+o.rank+"."}),null!=s&&qa(3===s.rank||1===s.rank,function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank "+s.rank+"."}),pf(c,l,u,s,o,i)}function ff(e,t,n,r,a,i){var o,s,c=ps(e,"x","batchNorm"),l=ps(t,"mean","batchNorm"),u=ps(n,"variance","batchNorm");return null!=a&&(o=ps(a,"scale","batchNorm")),null!=r&&(s=ps(r,"offset","batchNorm")),qa(4===c.rank,function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+c.rank+"."}),qa(4===l.rank||1===l.rank,function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank "+l.rank+"."}),qa(4===u.rank||1===u.rank,function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank "+u.rank+"."}),null!=o&&qa(4===o.rank||1===o.rank,function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank "+o.rank+"."}),null!=s&&qa(4===s.rank||1===s.rank,function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank "+s.rank+"."}),pf(c,l,u,s,o,i)}function pf(e,t,n,r,a,i){null==i&&(i=.001);var o,s,c,l=ps(e,"x","batchNorm"),u=ps(t,"mean","batchNorm"),h=ps(n,"variance","batchNorm");null!=a&&(o=ps(a,"scale","batchNorm")),null!=r&&(s=ps(r,"offset","batchNorm")),qa(u.rank===h.rank,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),qa(null==s||u.rank===s.rank,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),qa(null==o||u.rank===o.rank,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}),c=0===l.rank||1===l.rank?l.as4D(1,1,1,l.size):2===l.rank?l.as4D(1,1,l.shape[0],l.shape[1]):3===l.rank?l.as4D(1,l.shape[0],l.shape[1],l.shape[2]):l;var d=[l,u,h,o];return no.runKernelFunc(function(e,t){var n=e.batchNormalization(c,mf(u),mf(h),i,mf(o),mf(s));return t([l,u,h,o]),n},{x:l,mean:u,variance:h,scale:o,offset:s},function(e,t){var n=t,r=n[0],a=n[1],o=n[2],s=n[3],l=null==s?Fs(1):s,u=al(a.shape,c.shape),h=[];if(1===a.rank){for(var d=0;d<c.shape.length-1;++d)h.push(c.shape[d]);h.push(1)}var f=r.sub(a),p=e.mul(l),m=Jd(o.add(Fs(i))),g=m.mul(m).mul(m).mul(Fs(-.5));return{x:function(){return 1===a.rank?e.mul(Rc(m.as4D(1,1,1,a.shape[0]),h)).mul(l).reshape(r.shape):e.mul(m).mul(l).reshape(r.shape)},mean:function(){var e=m.mul(Fs(-1)).mul(p);return 1===a.rank&&(e=e.sum(u)),e.reshape(a.shape)},variance:function(){var e=g.mul(f).mul(p);return 1===a.rank&&(e=e.sum(u)),e.reshape(a.shape)},scale:function(){var t=f.mul(m),n=e.mul(t);return 1===a.rank&&(n=n.sum(u)),n.reshape(a.shape)},offset:function(){var t=e;return 1===a.rank&&(t=t.sum(u)),t.reshape(a.shape)}}},"BatchNormalization",{varianceEpsilon:i},d).reshape(l.shape)}function mf(e){return null==e?null:0===e.rank?e.as1D():1===e.rank?e:2===e.rank?e.as4D(1,1,e.shape[0],e.shape[1]):3===e.rank?e.as4D(1,e.shape[0],e.shape[1],e.shape[2]):e}function gf(){cs("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon")}var vf=Es({batchNormalization2d_:function(e,t,n,r,a,i){return void 0===r&&(r=.001),gf(),hf(e,t,n,i,a,r)}}),bf=Es({batchNormalization3d_:function(e,t,n,r,a,i){return void 0===r&&(r=.001),gf(),df(e,t,n,i,a,r)}}),yf=Es({batchNormalization4d_:function(e,t,n,r,a,i){return void 0===r&&(r=.001),gf(),ff(e,t,n,i,a,r)}}),xf=Es({batchNormalization_:function(e,t,n,r,a,i){return void 0===r&&(r=.001),gf(),pf(e,t,n,i,a,r)}}),wf=Es({batchNorm_:pf}),kf=Es({batchNorm2d_:hf}),Sf=Es({batchNorm3d_:df}),Nf=Es({batchNorm4d_:ff}),Cf=Es({logicalAnd_:function(e,t){var n=ps(e,"a","logicalAnd","bool"),r=ps(t,"b","logicalAnd","bool");return il(n.shape,r.shape),no.runKernelFunc(function(e){return e.logicalAnd(n,r)},{a:n,b:r},null,"LogicalAnd")}}),Ef=Es({logicalNot_:function(e){var t=ps(e,"x","logicalNot","bool");return no.runKernelFunc(function(e){return e.logicalNot(t)},{$x:t})}}),If=Es({logicalOr_:function(e,t){var n=ps(e,"a","logicalOr","bool"),r=ps(t,"b","logicalOr","bool");return il(n.shape,r.shape),no.runKernelFunc(function(e){return e.logicalOr(n,r)},{$a:n,$b:r})}}),Tf=Es({logicalXor_:function(e,t){var n=ps(e,"a","logicalXor","bool"),r=ps(t,"b","logicalXor","bool");return il(n.shape,r.shape),If(e,t).logicalAnd(Cf(e,t).logicalNot())}}),_f=Es({where_:function(e,t,n){var r=ps(t,"a","where"),a=ps(n,"b","where"),i=ps(e,"condition","where","bool");return Ka(r.shape,a.shape,"Error in where: "),1===i.rank?qa(i.shape[0]===r.shape[0],function(){return"The first dimension of `a` must match the size of `condition`."}):Ka(i.shape,a.shape,"Error in where: "),no.runKernelFunc(function(e,t){var n=e.select(i,r,a);return t([i]),n},{$condition:i,$a:r,$b:a},function(e,t){var n=t[0];return{$condition:function(){return Ws(n).toFloat()},$a:function(){return e.mul(n.cast(e.dtype))},$b:function(){return e.mul(n.logicalNot().cast(e.dtype))}}})}}),Af=function(e){return Aa(this,void 0,void 0,function(){var t,n,r;return Ra(this,function(a){switch(a.label){case 0:return[4,(t=ps(e,"condition","whereAsync","bool")).data()];case 1:return n=a.sent(),r=Pl(t.shape,n),e!==t&&t.dispose(),[2,r]}})})},Rf=Es({add_:function(e,t){var n,r=ps(e,"a","add"),a=ps(t,"b","add");n=$i(r,a),r=n[0],a=n[1];var i=il(r.shape,a.shape);return no.runKernelFunc(function(e){return e.add(r,a)},{a:r,b:a},function(e){return{a:function(){var t=e,n=al(r.shape,i);return n.length>0&&(t=t.sum(n)),t.reshape(r.shape)},b:function(){var t=e,n=al(a.shape,i);return n.length>0&&(t=t.sum(n)),t.reshape(a.shape)}}},"Add")}}),Ff=Es({addN_:function(e){qa(Array.isArray(e),function(){return"The argument passed to tf.addN() must be a list of tensors"}),qa(e.length>=1,function(){return"Must pass at least one tensor to tf.addN(), but got "+e.length});var t=e.map(function(e,t){return ps(e,"tensors"+t,"addN")}),n=t[0];t.forEach(function(e){if(e.dtype!==n.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),t.forEach(function(e){if(!Ja(e.shape,n.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});var r=t;return no.runKernelFunc(function(e){return e.addN(t)},r,function(e){var n={};return t.forEach(function(t,r){n[r]=function(){return e.clone()}}),n},"AddN")}}),Df=Es({addStrict_:function(e,t){var n=ps(e,"a","addStrict"),r=ps(t,"b","addStrict");return Ka(n.shape,r.shape,"Error in addStrict: "),n.add(r)}}),Of=Es({atan2_:function(e,t){var n,r=ps(e,"a","atan2"),a=ps(t,"b","atan2");n=$i(r,a),r=n[0],a=n[1];var i=il(r.shape,a.shape);return no.runKernelFunc(function(e,t){var n=e.atan2(r,a);return t([r,a]),n},{$a:r,$b:a},function(e,t){var n=t[0],r=t[1];return{$a:function(){var t=Rf(n.square(),r.square()),a=e.mul(r.div(t)),o=al(n.shape,i);return o.length>0&&(a=a.sum(o)),a.reshape(n.shape)},$b:function(){var t=Rf(n.square(),r.square()),a=Xd(e.mul(n.div(t))),o=al(r.shape,i);return o.length>0&&(a=a.sum(o)),a.reshape(r.shape)}}})}}),Lf=Es({div_:function(e,t){var n,r=ps(e,"a","div"),a=ps(t,"b","div");if(n=$i(r,a),r=n[0],a=n[1],"int32"===r.dtype&&"int32"===a.dtype)return jf(r,a);var i=il(r.shape,a.shape);return no.runKernelFunc(function(e,t){var n=e.realDivide(r,a);return t([r,a]),n},{a:r,b:a},function(e,t){var n=t[0],r=t[1];return{a:function(){var t=e.div(r.toFloat()),a=al(n.shape,i);return a.length>0?t.sum(a).reshape(n.shape):t},b:function(){var t=e.mul(n.toFloat()),a=al(r.shape,i);a.length>0&&(t=t.sum(a).reshape(r.shape));var o=r.square();return t.div(o.toFloat()).neg()}}},"Div")}}),Pf=Es({divNoNan_:function(e,t){var n,r=ps(e,"a","div"),a=ps(t,"b","div");r=(n=$i(r,a))[0],a=n[1];var i=Lf(r,a),o=Ws(i),s=a.equal(o);return _f(s,o,i)}}),Mf=Es({divStrict_:function(e,t){var n=ps(e,"a","div"),r=ps(t,"b","div");return Ka(n.shape,r.shape,"Error in divideStrict: "),n.div(r)}}),jf=Es({floorDiv_:function(e,t){var n,r=ps(e,"a","floorDiv"),a=ps(t,"b","floorDiv");n=$i(r,a),r=n[0],a=n[1];var i=il(r.shape,a.shape);return no.runKernelFunc(function(e,t){var n=e.floorDiv(r,a);return t([r,a]),n},{a:r,b:a},function(e,t){var n=t[0],r=t[1];return{a:function(){var t=e.div(r.toFloat()),a=al(n.shape,i);return a.length>0?t.sum(a).reshape(n.shape):t},b:function(){var t=e.mul(n.toFloat()),a=al(r.shape,i);a.length>0&&(t=t.sum(a).reshape(r.shape));var o=r.square();return t.div(o.toFloat()).neg()}}},"FloorDiv")}}),Bf=Es({maximum_:function(e,t){var n,r=ps(e,"a","maximum"),a=ps(t,"b","maximum");return n=$i(r,a),r=n[0],a=n[1],"bool"===r.dtype&&(r=r.toInt(),a=a.toInt()),il(r.shape,a.shape),no.runKernelFunc(function(e,t){var n=e.maximum(r,a);return t([r,a]),n},{a:r,b:a},function(e,t){var n=t[0],r=t[1];return{a:function(){return e.mul(n.greaterEqual(r).toFloat())},b:function(){return e.mul(n.less(r).toFloat())}}},"Maximum")}}),zf=Es({maximumStrict_:function(e,t){var n=ps(e,"a","maximumStrict"),r=ps(t,"b","maximumStrict");return Ka(n.shape,r.shape,"Error in maximumStrict: "),n.maximum(r)}}),Uf=Es({minimum_:function(e,t){var n,r=ps(e,"a","minimum"),a=ps(t,"b","minimum");return n=$i(r,a),r=n[0],a=n[1],"bool"===r.dtype&&(r=r.toInt(),a=a.toInt()),il(r.shape,a.shape),no.runKernelFunc(function(e,t){var n=e.minimum(r,a);return t([r,a]),n},{a:r,b:a},function(e,t){var n=t[0],r=t[1];return{a:function(){return e.mul(n.lessEqual(r).toFloat())},b:function(){return e.mul(n.greater(r).toFloat())}}},"Minimum")}}),Wf=Es({minimumStrict_:function(e,t){var n=ps(e,"a","minimumStrict"),r=ps(t,"b","minimumStrict");return Ka(n.shape,r.shape,"Error in minimumStrict: "),n.minimum(r)}}),Vf=Es({mod_:function(e,t){var n,r=ps(e,"a","mod"),a=ps(t,"b","mod");n=$i(r,a),r=n[0],a=n[1];var i=il(r.shape,a.shape);return no.runKernelFunc(function(e,t){var n=e.mod(r,a);return t([r,a]),n},{$a:r,$b:a},function(e,t){var n=t[0],r=t[1];return{$a:function(){var t=al(n.shape,i);return t.length>0?e.sum(t).reshape(n.shape):e},$b:function(){var t=e.mul(n.div(r).floor().neg()),a=al(r.shape,i);return a.length>0?t.sum(a).reshape(r.shape):t}}})}}),Hf=Es({modStrict_:function(e,t){var n=ps(e,"a","modStrict"),r=ps(t,"b","modStrict");return Ka(n.shape,r.shape,"Error in modStrict: "),n.mod(r)}}),Gf=Es({mul_:function(e,t){var n,r=ps(e,"a","mul"),a=ps(t,"b","mul");n=$i(r,a),r=n[0],a=n[1];var i=il(r.shape,a.shape);return no.runKernelFunc(function(e,t){var n=e.multiply(r,a);return t([r,a]),n},{a:r,b:a},function(e,t){var n=t[0],r=t[1];return{a:function(){var t=e.mul(r.toFloat()),a=al(n.shape,i);return a.length>0?t.sum(a).reshape(n.shape):t},b:function(){var t=e.mul(n.toFloat()),a=al(r.shape,i);return a.length>0?t.sum(a).reshape(r.shape):t}}},"Mul")}}),qf=Es({mulStrict_:function(e,t){var n=ps(e,"a","mul"),r=ps(t,"b","mul");return Ka(n.shape,r.shape,"Error in multiplyStrict: "),n.mul(r)}}),Kf=Es({pow_:function(e,t){var n,r=ps(e,"base","pow"),a=ps(t,"exp","pow");n=$i(r,a),r=n[0],a=n[1];var i=il(r.shape,a.shape),o=[r,a];return no.runKernelFunc(function(e,t){var n=e.pow(r,a);return t([r,a,n]),n},{a:r,b:a},function(e,t){var n=t[0],r=t[1],a=t[2];return{a:function(){var t=r.toFloat(),a=e.mul(t.mul(n.pow(t.sub(Fs(1))))),o=al(n.shape,i);return o.length>0&&(a=a.sum(o)),a.reshape(n.shape)},b:function(){var t=n.greater(0),o=n.log().where(t,Ws(n)),s=e.mul(a.mul(o)),c=al(r.shape,i);return c.length>0&&(s=s.sum(c)),s.reshape(r.shape)}}},"Pow",{},o,[!0])}}),Xf=Es({powStrict_:function(e,t){return Ka(e.shape,t.shape,"Error in powStrict: "),e.pow(t)}}),Yf=Es({squaredDifferenceStrict_:function(e,t){var n=ps(e,"a","squaredDifferenceStrict"),r=ps(t,"b","squaredDifferenceStrict");return Ka(n.shape,r.shape,"Error in squaredDifferenceStrict: "),n.squaredDifference(r)}}),$f=Es({sub_:function(e,t){var n,r=ps(e,"a","sub"),a=ps(t,"b","sub");n=$i(r,a),r=n[0],a=n[1];var i=il(r.shape,a.shape);return no.runKernelFunc(function(e){return e.subtract(r,a)},{a:r,b:a},function(e){return{a:function(){var t=e,n=al(r.shape,i);return n.length>0&&(t=t.sum(n)),t.reshape(r.shape)},b:function(){var t=e,n=al(a.shape,i);return n.length>0&&(t=t.sum(n)),t.neg().reshape(a.shape)}}},"Sub")}}),Jf=Es({subStrict_:function(e,t){var n=ps(e,"a","subStrict"),r=ps(t,"b","subStrict");return Ka(n.shape,r.shape,"Error in subStrict: "),n.sub(r)}}),Qf=Es({equal_:function(e,t){var n,r=ps(e,"a","equal"),a=ps(t,"b","equal");return n=$i(r,a),r=n[0],a=n[1],il(r.shape,a.shape),no.runKernelFunc(function(e){return e.equal(r,a)},{$a:r,$b:a})}}),Zf=Es({equalStrict_:function(e,t){var n=ps(e,"a","equalStrict"),r=ps(t,"b","equalStrict");return Ka(n.shape,r.shape,"Error in equalStrict: "),n.equal(r)}}),ep=Es({greater_:function(e,t){var n,r=ps(e,"a","greater"),a=ps(t,"b","greater");return n=$i(r,a),r=n[0],a=n[1],il(r.shape,a.shape),no.runKernelFunc(function(e){return e.greater(r,a)},{a:r,b:a},null,"Greater")}}),tp=Es({greaterEqual_:function(e,t){var n,r=ps(e,"a","greaterEqual"),a=ps(t,"b","greaterEqual");return n=$i(r,a),r=n[0],a=n[1],il(r.shape,a.shape),no.runKernelFunc(function(e,t){var n=e.greaterEqual(r,a);return t([r,a]),n},{a:r,b:a},function(e,t){var n=t[0],r=t[1];return{a:function(){return Ws(n)},b:function(){return Ws(r)}}},"GreaterEqual")}}),np=Es({greaterEqualStrict_:function(e,t){var n=ps(e,"a","greaterEqualStrict"),r=ps(t,"b","greaterEqualStrict");return Ka(n.shape,r.shape,"Error in greaterEqualStrict: "),n.greaterEqual(r)}}),rp=Es({greaterStrict_:function(e,t){var n=ps(e,"a","greaterStrict"),r=ps(t,"b","greaterStrict");return Ka(n.shape,r.shape,"Error in greaterStrict: "),n.greater(r)}}),ap=Es({less_:function(e,t){var n,r=ps(e,"a","less"),a=ps(t,"b","less");return n=$i(r,a),r=n[0],a=n[1],il(r.shape,a.shape),no.runKernelFunc(function(e){return e.less(r,a)},{a:r,b:a},null,"Less")}}),ip=Es({lessEqual_:function(e,t){var n,r=ps(e,"a","lessEqual"),a=ps(t,"b","lessEqual");return n=$i(r,a),r=n[0],a=n[1],il(r.shape,a.shape),no.runKernelFunc(function(e,t){var n=e.lessEqual(r,a);return t([r,a]),n},{a:r,b:a},null,"LessEqual")}}),op=Es({lessEqualStrict_:function(e,t){var n=ps(e,"a","lessEqualStrict"),r=ps(t,"b","lessEqualStrict");return Ka(n.shape,r.shape,"Error in lessEqualStrict: "),n.lessEqual(r)}}),sp=Es({lessStrict_:function(e,t){var n=ps(e,"a","lessStrict"),r=ps(t,"b","lessStrict");return Ka(n.shape,r.shape,"Error in lessStrict: "),n.less(r)}}),cp=Es({notEqual_:function(e,t){var n,r=ps(e,"a","notEqual"),a=ps(t,"b","notEqual");return n=$i(r,a),r=n[0],a=n[1],il(r.shape,a.shape),no.runKernelFunc(function(e){return e.notEqual(r,a)},{a:r,b:a},null,"NotEqual")}}),lp=Es({notEqualStrict_:function(e,t){var n=ps(e,"a","notEqualStrict"),r=ps(t,"b","notEqualStrict");return Ka(n.shape,r.shape,"Error in notEqualStrict: "),n.notEqual(r)}});function up(e,t){for(var n=[],r=e;r<t;++r)n.push(r);return n}function hp(e){for(var t=[],n=0;n<e.length;++n)for(var r=0;r<e[n].length;++r)t.push(e[n][r]);return t}var dp=Es({gather_:function(e,t,n){void 0===n&&(n=0);var r=ps(e,"x","gather"),a=ps(t,"indices","gather","int32");n=ai(n,r.shape)[0];var i=function(e,t,n){for(var r=e.shape[n],a=[],i=1,o=1,s=0;s<n;s++)a.push(e.shape[s]),i*=e.shape[s];for(s=0;s<t.rank;s++)a.push(t.shape[s]);for(s=n+1;s<e.rank;s++)a.push(e.shape[s]),o*=e.shape[s];return{batchSize:i,sliceSize:o,dimSize:r,outputShape:a}}(r,a,n);return no.runKernelFunc(function(e,t){var i=e.gather(r,a.flatten(),n);return t([a]),i},{x:r,indices:a},function(e,t){var a=t[0];return{x:function(){var t=r.shape,i=a.size,o=t.slice(0,n),s=o.length,c=t.slice(n,t.length).slice(1),l=c.length,u=up(0,s),h=up(s+1,s+1+l),d=hp([o,[i],c]),f=e.reshape(d),p=a.reshape([i]),m=hp([[s],u,h]),g=f.transpose(m),v=fp(g,p,r.shape[n]),b=ks(m);return v.transpose(b)},indices:function(){return a}}},"Gather",{axis:n}).reshape(i.outputShape)}}),fp=Es({unsortedSegmentSum_:function(e,t,n){var r=ps(e,"x","unsortedSegmentSum"),a=ps(t,"segmentIds","unsortedSegmentSum","int32");return qa(Qa(n),function(){return"numSegments must be of dtype int"}),no.runKernelFunc(function(e,t){var i=e.unsortedSegmentSum(r,a,n);return t([a]),i},{$x:r},function(e,t){var n=t[0];return{$x:function(){return function(e,t){for(var n=Bf(t,Ws(t)),r=dp(e,n),a=tp(t,Fs(0,"int32")),i=r.rank-a.rank,o=0;o<i;++o)a=pc(a,o+1);a=Cf(a,Ms(r.shape,"bool"));var s=Ws(r);return _f(a,r,s)}(e,n)}}})}});function pp(e,t,n,r,a,i,o){void 0===i&&(i="NHWC"),qa(e.length===t.rank,function(){return"Length of inShape ("+e.length+") and rank of dy ("+t.rank+") must match"});var s=e,c=t,l=!1;3===t.rank&&(l=!0,c=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]),s=[1,e[0],e[1],e[2]]),qa(4===s.length,function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+s.length+"."}),qa(4===c.rank,function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank "+c.rank}),qa(4===n.rank,function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank "+n.rank});var u="NHWC"===i?s[3]:s[1],h="NHWC"===i?c.shape[3]:c.shape[1];qa(u===n.shape[2],function(){return"Error in conv2dDerInput: depth of input ("+u+") must match input depth for filter "+n.shape[2]+"."}),qa(h===n.shape[3],function(){return"Error in conv2dDerInput: depth of output ("+h+") must match output depth for filter "+n.shape[3]+"."}),null!=o&&qa(Qa(a),function(){return"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+a+"."});var d=vl(i),f=cl(s,n.shape,r,1,a,o,!1,d),p=no.runKernelFunc(function(e,t){var r=e.conv2dDerInput(c,n,f);return t([n,c]),r},{dy4D:c,filter:n},function(e,t){var n=t[0],s=t[1];return{dy4D:function(){return bp(e,n,r,a,i,1,o)},filter:function(){return xp(e,s,n.shape,r,a,i,o)}}});return l?p.as3D(p.shape[1],p.shape[2],p.shape[3]):p}function mp(e){var t=function(e){return"number"==typeof e?[e,e,e]:2===e.length?[e[0],e[1],1]:e}(e),n=t[0],r=t[1],a=t[2];return 1===n&&1===r&&1===a}function gp(e,t,n,r,a){qa(e.length===t.rank,function(){return"Length of inShape ("+e.length+") and rank of dy ("+t.rank+") must match"});var i=e,o=t,s=!1;4===t.rank&&(s=!0,o=t.as5D(1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]),i=[1,e[0],e[1],e[2],e[3]]);var c=i[4],l=o.shape[4];qa(5===i.length,function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+i.length+"."}),qa(5===o.rank,function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank "+o.rank}),qa(5===n.rank,function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank "+n.rank}),qa(c===n.shape[3],function(){return"Error in conv3dDerInput: depth of input ("+c+") must match input depth for filter "+n.shape[3]+"."}),qa(l===n.shape[4],function(){return"Error in conv3dDerInput: depth of output ("+l+") must match output depth for filter "+n.shape[4]+"."});var u=ll(i,n.shape,r,1,a),h=no.runKernelFunc(function(e){return e.conv3dDerInput(o,n,u)},{dy5D:o});return s?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}var vp=Es({conv1d_:function(e,t,n,r,a,i,o){void 0===a&&(a="NWC"),void 0===i&&(i=1);var s=ps(e,"x","conv1d"),c=ps(t,"filter","conv1d"),l=s,u=!1;2===s.rank&&(u=!0,l=s.as3D(1,s.shape[0],s.shape[1])),qa(3===l.rank,function(){return"Error in conv1d: input must be rank 3, but got rank "+l.rank+"."}),qa(3===c.rank,function(){return"Error in conv1d: filter must be rank 3, but got rank "+c.rank+"."}),null!=o&&qa(Qa(r),function(){return"Error in conv1d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+r+"."}),qa(l.shape[2]===c.shape[1],function(){return"Error in conv1d: depth of input ("+l.shape[2]+") must match input depth for filter "+c.shape[1]+"."}),qa(gl(n,i),function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride "+n+" and dilation '"+i+"'"}),qa("NWC"===a,function(){return"Error in conv1d: got dataFormat of "+a+" but only NWC is currently supported."});var h=c.as4D(1,c.shape[0],c.shape[1],c.shape[2]),d=l.as4D(l.shape[0],1,l.shape[1],l.shape[2]),f=bp(d,h,[1,n],r,"NHWC",[1,i],o);return u?f.as2D(f.shape[2],f.shape[3]):f.as3D(f.shape[0],f.shape[2],f.shape[3])}}),bp=Es({conv2d_:function(e,t,n,r,a,i,o){void 0===a&&(a="NHWC"),void 0===i&&(i=[1,1]);var s=ps(e,"x","conv2d"),c=ps(t,"filter","conv2d"),l=s,u=!1;3===s.rank&&(u=!0,l=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),qa(4===l.rank,function(){return"Error in conv2d: input must be rank 4, but got rank "+l.rank+"."}),qa(4===c.rank,function(){return"Error in conv2d: filter must be rank 4, but got rank "+c.rank+"."}),null!=o&&qa(Qa(r),function(){return"Error in conv2d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+r+"."});var h="NHWC"===a?l.shape[3]:l.shape[1];qa(h===c.shape[2],function(){return"Error in conv2d: depth of input ("+h+") must match input depth for filter "+c.shape[2]+"."}),qa(gl(n,i),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+i+"'"});var d=vl(a),f=cl(l.shape,c.shape,n,i,r,o,!1,d),p=[c,l],m=no.runKernelFunc(function(e,t){var n=e.conv2d(l,c,f);return t([c,l]),n},{x:l,filter:c},function(e,t){var o=t,s=o[0],c=o[1];return qa(ml(i),function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+i+"'"}),{x:function(){return wp(c.shape,e,s,n,r,a)},filter:function(){return xp(c,e,s.shape,n,r,a)}}},"Conv2D",f,p);return u?m.as3D(m.shape[1],m.shape[2],m.shape[3]):m}}),yp=Es({conv3d_:function(e,t,n,r,a,i){void 0===a&&(a="NDHWC"),void 0===i&&(i=[1,1,1]);var o=ps(e,"x","conv3d"),s=ps(t,"filter","conv3d"),c=o,l=!1;4===o.rank&&(l=!0,c=o.as5D(1,o.shape[0],o.shape[1],o.shape[2],o.shape[3])),qa(5===c.rank,function(){return"Error in conv3d: input must be rank 5, but got rank "+c.rank+"."}),qa(5===s.rank,function(){return"Error in conv3d: filter must be rank 5, but got rank "+s.rank+"."}),qa(c.shape[4]===s.shape[3],function(){return"Error in conv3d: depth of input ("+c.shape[4]+") must match input depth for filter "+s.shape[3]+"."}),qa(function(e,t){return mp(e)||mp(t)}(n,i),function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+i+"'"}),qa("NDHWC"===a,function(){return"Error in conv3d: got dataFormat of "+a+" but only NDHWC is currently supported."});var u=ll(c.shape,s.shape,n,i,r),h=no.runKernelFunc(function(e,t){var n=e.conv3d(c,s,u);return t([c,s]),n},{x:c,$filter:s},function(e,t){qa(mp(i),function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+i+"'"});var a=t[0],o=t[1];return{x:function(){return gp(a.shape,e,o,n,r)},$filter:function(){return function(e,t,n,r,a){var i=e;4===e.rank&&(i=e.as5D(1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]));var o=t;4===o.rank&&(o=t.as5D(1,t.shape[0],t.shape[1],t.shape[2],t.shape[3])),qa(5===i.rank,function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+i.shape+"."}),qa(5===o.rank,function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+o.shape+"."}),qa(5===n.length,function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+n+"."}),qa(i.shape[4]===n[3],function(){return"Error in conv3dDerFilter: depth of input "+i.shape[4]+") must match input depth in filter ("+n[3]+"."}),qa(o.shape[4]===n[4],function(){return"Error in conv3dDerFilter: depth of dy ("+o.shape[4]+") must match output depth for filter ("+n[4]+")."});var s=ll(i.shape,n,r,1,a);return no.runKernelFunc(function(e){return e.conv3dDerFilter(i,o,s)},{x5D:i,dy5D:o})}(a,e,o.shape,n,r)}}});return l?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}}),xp=Es({conv2dDerFilter_:function(e,t,n,r,a,i,o){void 0===i&&(i="NHWC");var s=e;3===e.rank&&(s=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var c=t;3===c.rank&&(c=t.as4D(1,t.shape[0],t.shape[1],t.shape[2])),qa(4===s.rank,function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+s.shape+"."}),qa(4===c.rank,function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+c.shape+"."}),qa(4===n.length,function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+n+"."});var l="NHWC"===i?s.shape[3]:s.shape[1],u="NHWC"===i?c.shape[3]:c.shape[1];qa(l===n[2],function(){return"Error in conv2dDerFilter: depth of input "+l+") must match input depth in filter ("+n[2]+"."}),qa(u===n[3],function(){return"Error in conv2dDerFilter: depth of dy ("+u+") must match output depth for filter ("+n[3]+")."}),null!=o&&qa(Qa(a),function(){return"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+a+"."});var h=vl(i),d=cl(s.shape,n,r,1,a,o,!1,h);return no.runKernelFunc(function(e){return e.conv2dDerFilter(s,c,d)},{x4D:s,dy4D:c})}}),wp=Es({conv2dDerInput_:pp}),kp=Es({depthwiseConv2d_:function(e,t,n,r,a,i,o){void 0===a&&(a="NHWC"),void 0===i&&(i=[1,1]);var s=ps(e,"x","depthwiseConv2d"),c=ps(t,"filter","depthwiseConv2d"),l=s,u=!1;3===s.rank&&(u=!0,l=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),qa(4===l.rank,function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank "+l.rank+"."}),qa(4===c.rank,function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+c.rank+"."}),qa(l.shape[3]===c.shape[2],function(){return"Error in depthwiseConv2d: number of input channels ("+l.shape[3]+") must match the inChannels dimension in filter "+c.shape[2]+"."}),null==i&&(i=[1,1]),qa(gl(n,i),function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+i+"'"}),null!=o&&qa(Qa(r),function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+r+"."});var h=cl(l.shape,c.shape,n,i,r,o,!0),d=[l,c],f=no.runKernelFunc(function(e,t){var n=e.depthwiseConv2D(l,c,h);return t([l,c]),n},{x:l,filter:c},function(e,t){qa(ml(i),function(){return"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+i+"'"});var n=t[0],r=t[1];return{x:function(){return Sp(n.shape,e,r,h)},filter:function(){return Np(n,e,r.shape,h)}}},"DepthwiseConv2dNative",h,d);return u?f.as3D(f.shape[1],f.shape[2],f.shape[3]):f}}),Sp=Es({depthwiseConv2dDerInput_:function(e,t,n,r){var a=t,i=!1;3===t.rank&&(i=!0,a=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]));var o=no.runKernelFunc(function(e){return e.depthwiseConv2DDerInput(a,n,r)},{dy4D:a});return i?o.as3D(o.shape[1],o.shape[2],o.shape[3]):o}}),Np=Es({depthwiseConv2dDerFilter_:function(e,t,n,r){var a=e;3===e.rank&&(a=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var i=t;return 3===i.rank&&(i=t.as4D(1,t.shape[0],t.shape[1],t.shape[2])),no.runKernelFunc(function(e){return e.depthwiseConv2DDerFilter(a,i,r)},{x4D:a,dy4D:i})}}),Cp=Es({separableConv2d_:function(e,t,n,r,a,i,o){void 0===i&&(i=[1,1]),void 0===o&&(o="NHWC");var s=ps(e,"x","separableConv2d"),c=ps(t,"depthwiseFilter","separableConv2d"),l=ps(n,"pointwiseFilter","separableConv2d"),u=s,h=!1;if(3===s.rank&&(h=!0,u=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),"NCHW"===o)throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");qa(4===u.rank,function(){return"Error in separableConv2d: input must be rank 4, but got rank "+u.rank+"."}),qa(4===c.rank,function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+c.rank+"."}),qa(4===l.rank,function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+c.rank+"."}),qa(1===l.shape[0],function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+l.shape[0]+"."}),qa(1===l.shape[1],function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got "+l.shape[1]+"."});var d=c.shape[2],f=c.shape[3];qa(l.shape[2]===d*f,function(){return"Error in separableConv2d: the third dimension of pointwise filter must be "+d*f+", but got "+l.shape[2]+"."});var p=kp(u,c,r,a,o,i),m=bp(p,l,1,"valid",o);return h?m.as3D(m.shape[1],m.shape[2],m.shape[3]):m}}),Ep=Es({conv2dTranspose_:function(e,t,n,r,a,i){return pp(n,ps(e,"x","conv2dTranspose"),ps(t,"filter","conv2dTranspose"),r,a,"NHWC",i)}}),Ip=Es({conv3dTranspose_:function(e,t,n,r,a){return gp(n,ps(e,"x","conv3dTranspose"),ps(t,"filter","conv3dTranspose"),r,a)}}),Tp=Es({matMul_:function(e,t,n,r){var a;void 0===n&&(n=!1),void 0===r&&(r=!1);var i=ps(e,"a","matMul"),o=ps(t,"b","matMul");a=$i(i,o),i=a[0],o=a[1];var s=n?i.shape[i.rank-2]:i.shape[i.rank-1],c=r?o.shape[o.rank-1]:o.shape[o.rank-2],l=n?i.shape[i.rank-1]:i.shape[i.rank-2],u=r?o.shape[o.rank-2]:o.shape[o.rank-1],h=i.shape.slice(0,-2),d=o.shape.slice(0,-2),f=$a(h),p=$a(d);qa(i.rank>=2&&o.rank>=2&&i.rank===o.rank,function(){return"Error in matMul: inputs must have the same rank of at least 2, got ranks "+i.rank+" and "+o.rank+"."}),qa(Ja(h,d),function(){return"Error in matMul: outer dimensions ("+h+") and ("+d+") of Tensors with shapes "+i.shape+" and "+o.shape+" must match."}),qa(s===c,function(){return"Error in matMul: inner shapes ("+s+") and ("+c+") of Tensors with shapes "+i.shape+" and "+o.shape+" and transposeA="+n+" and transposeB="+r+" must match."});var m=i.shape.slice(0,-2).concat([l,u]),g=n?i.as3D(f,s,l):i.as3D(f,l,s),v=r?o.as3D(p,u,c):o.as3D(p,c,u),b={transposeA:n,transposeB:r};return no.runKernelFunc(function(e,t){var a=e.batchMatMul(g,v,n,r);return t([g,v]),a},{a:g,b:v},function(e,t){var a=t,i=a[0],o=a[1];return n||r?!n&&r?{a:function(){return e.matMul(o,!1,!1)},b:function(){return e.matMul(i,!0,!1)}}:n&&!r?{a:function(){return o.matMul(e,!1,!0)},b:function(){return i.matMul(e,!1,!1)}}:{a:function(){return o.matMul(e,!0,!0)},b:function(){return e.matMul(i,!0,!0)}}:{a:function(){return e.matMul(o,!1,!0)},b:function(){return i.matMul(e,!0,!1)}}},"BatchMatMul",b).reshape(m)}}),_p=Es({dot_:function(e,t){var n=ps(e,"t1","dot"),r=ps(t,"t2","dot");qa(!(1!==n.rank&&2!==n.rank||1!==r.rank&&2!==r.rank),function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+n.rank+" and "+r.rank+"."});var a=1===n.rank?n.size:n.shape[1],i=1===r.rank?r.size:r.shape[0];return qa(a===i,function(){return"Error in dot: inner dimensions of inputs must match, but got "+a+" and "+i+"."}),1===n.rank&&1===r.rank?n.as2D(1,-1).matMul(r.as2D(-1,1)).asScalar():1===n.rank&&2===r.rank?n.as2D(1,-1).matMul(r.as2D(r.shape[0],r.shape[1])).as1D():2===n.rank&&1===r.rank?n.matMul(r.as2D(-1,1)).as1D():n.matMul(r.as2D(r.shape[0],r.shape[1]))}}),Ap=Es({outerProduct_:function(e,t){var n=ps(e,"v1","outerProduct"),r=ps(t,"v2","outerProduct");return qa(1===n.rank&&1===r.rank,function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+n.rank+" and "+r.rank+"."}),n.as2D(-1,1).matMul(r.as2D(1,-1))}}),Rp=Es({reverse_:function(e,t){var n=ps(e,"x","reverse");if(0===n.rank)return n.clone();var r=ai(t,n.shape);return no.runKernelFunc(function(e){return e.reverse(n,r)},{$x:n},function(e){return{$x:function(){return e.reverse(r)}}}).reshapeAs(n)}}),Fp=Es({reverse1d_:function(e){var t=ps(e,"x","reverse");return qa(1===t.rank,function(){return"Error in reverse1D: x must be rank 1 but got rank "+t.rank+"."}),Rp(t,0)}}),Dp=Es({reverse2d_:function(e,t){var n=ps(e,"x","reverse");return qa(2===n.rank,function(){return"Error in reverse2D: x must be rank 2 but got rank "+n.rank+"."}),Rp(n,t)}}),Op=Es({reverse3d_:function(e,t){var n=ps(e,"x","reverse");return qa(3===n.rank,function(){return"Error in reverse3D: x must be rank 3 but got rank "+n.rank+"."}),Rp(n,t)}}),Lp=Es({reverse4d_:function(e,t){var n=ps(e,"x","reverse");return qa(4===n.rank,function(){return"Error in reverse4D: x must be rank 4 but got rank "+n.rank+"."}),Rp(n,t)}});function Pp(e,t,n,r,a,i){var o=ps(e,"x","maxPool"),s=o,c=!1;3===o.rank&&(c=!0,s=o.as4D(1,o.shape[0],o.shape[1],o.shape[2])),null==r&&(r=[1,1]),qa(4===s.rank,function(){return"Error in maxPool: input must be rank 4 but got rank "+s.rank+"."}),qa(gl(n,r),function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+r+"'"}),null!=i&&qa(Qa(a),function(){return"Error in maxPool: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+a+"."});var l=ol(s.shape,t,n,r,a,i);if(1===l.filterWidth&&1===l.filterHeight&&Ja(l.inShape,l.outShape))return o.clone();var u=[s],h=no.runKernelFunc(function(e,t){var n=e.maxPool(s,l);return t([s,n]),n},{x:s},function(e,i){var o=i[0],s=i[1];return{x:function(){return function(e,t,n,r,a,i,o,s){var c=ps(e,"dy","maxPoolBackprop"),l=ps(t,"input","maxPoolBackprop"),u=ps(n,"output","maxPoolBackprop");qa(l.rank===c.rank,function(){return"Rank of input ("+l.rank+") does not match rank of dy ("+c.rank+")"}),null==i&&(i=[1,1]),qa(gl(a,i),function(){return"Error in maxPoolBackProp: Either strides or dilations must be 1. Got strides "+a+" and dilations '"+i+"'"}),qa(4===c.rank,function(){return"Error in maxPoolBackprop: dy must be rank 4 but got rank "+c.rank+"."}),qa(4===l.rank,function(){return"Error in maxPoolBackprop: input must be rank 4 but got rank "+l.rank+"."});var h=ol(l.shape,r,a,i,o,s);return no.runKernelFunc(function(e){return e.maxPoolBackprop(c,l,u,h)},{$dy:c,$input:l})}(e,o,s,t,n,r,a)}}},"MaxPool",l,u);return c?h.as3D(h.shape[1],h.shape[2],h.shape[3]):h}function Mp(e,t,n,r,a,i){var o=ps(e,"x","avgPool","float32");null==r&&(r=[1,1]),qa(gl(n,r),function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+r+"'"});var s=o,c=!1;3===o.rank&&(c=!0,s=o.as4D(1,o.shape[0],o.shape[1],o.shape[2])),qa(4===s.rank,function(){return"Error in avgPool: x must be rank 4 but got rank "+s.rank+"."}),null!=i&&qa(Qa(a),function(){return"Error in avgPool: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+a+"."});var l=ol(s.shape,t,n,r,a,i);if(1===l.filterWidth&&1===l.filterHeight&&Ja(l.inShape,l.outShape))return o.clone();var u=no.runKernelFunc(function(e){return e.avgPool(s,l)},{x:s},function(e){return{x:function(){return function(e,t,n,r,a,i){var o=ps(e,"dy","avgPoolBackprop"),s=ps(t,"input","avgPoolBackprop");qa(s.rank===o.rank,function(){return"Rank of input ("+s.rank+") does not match rank of dy ("+o.rank+")"}),null==a&&(a=[1,1]),qa(gl(r,a),function(){return"Error in avgPoolBackprop: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+a+"'"});var c=s,l=o,u=!1;3===s.rank&&(u=!0,c=s.as4D(1,s.shape[0],s.shape[1],s.shape[2]),l=o.as4D(1,o.shape[0],o.shape[1],o.shape[2])),qa(4===l.rank,function(){return"Error in avgPoolBackprop: dy must be rank 4 but got rank "+l.rank+"."}),qa(4===c.rank,function(){return"Error in avgPoolBackprop: input must be rank 4 but got rank "+c.rank+"."});var h=ol(c.shape,n,r,a,i),d=no.runKernelFunc(function(e){return e.avgPoolBackprop(l,c,h)},{dy4D:l,input4D:c});return u?d.as3D(d.shape[1],d.shape[2],d.shape[3]):d}(e,s,t,n,r,a)}}},"AvgPool",l);return u=u.cast(o.dtype),c?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}var jp=Es({maxPool_:function(e,t,n,r,a){return Pp(e,t,n,1,r,a)}}),Bp=Es({avgPool_:function(e,t,n,r,a){return Mp(e,t,n,1,r,a)}}),zp=Es({pool_:function(e,t,n,r,a,i){null==a&&(a=[1,1]),null==i&&(i=1),0===r&&(r="valid");var o=ps(e,"x","maxPool"),s=o,c=!1;3===o.rank&&(c=!0,s=o.as4D(1,o.shape[0],o.shape[1],o.shape[2])),qa(gl(i,a),function(){return"Error in pool: Either strides or dilations must be 1. Got strides "+i+" and dilations '"+a+"'"});var l,u=ol(s.shape,t,i,a,r),h=[u.dilationHeight,u.dilationWidth];l="same"===r?function(e,t){var n=e.map(function(e,n){return e+(e-1)*(t[n]-1)}).map(function(e){return e-1}),r=n.map(function(e){return Math.floor(e/2)}),a=n.map(function(e,t){return e-r[t]});return n.map(function(e,t){return[r[t],a[t]]})}([u.filterHeight,u.filterWidth],h):[[0,0],[0,0]];var d=1===h[0]&&1===h[1],f=function(e,t,n){var r=n.map(function(e){return e[0]}),a=n.map(function(e){return e[1]}),i=e.concat(r,a),o=t.map(function(e,t){return(e-i[t]%e)%e}),s=a.map(function(e,t){return e+o[t]});return[t.map(function(e,t){return[r[t],s[t]]}),t.map(function(e,t){return[0,o[t]]})]}([u.inHeight,u.inWidth],h,l),p=f[0],m=f[1],g=d?r:"valid",v=d?s:Tc(s,h,p),b=("avg"===n?function(){return Mp(v,t,i,1,g)}:function(){return Pp(v,t,i,1,g)})(),y=d?b:cc(b,h,m);return c?y.as3D(y.shape[1],y.shape[2],y.shape[3]):y}}),Up=Es({maxPool3d_:function(e,t,n,r,a,i,o){void 0===i&&(i="NDHWC");var s=ps(e,"x","maxPool3d"),c=s,l=!1;4===s.rank&&(l=!0,c=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),null==o&&(o=[1,1,1]),qa(5===c.rank,function(){return"Error in maxPool3d: x must be rank 5 but got rank "+c.rank+"."}),qa("NDHWC"===i,function(){return"Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of "+i}),qa(gl(n,o),function(){return"Error in maxPool3d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+o+"'"}),null!=a&&qa(Qa(r),function(){return"Error in maxPool3d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+r+"."});var u=sl(c.shape,t,n,o,r,a,i),h=no.runKernelFunc(function(e,t){var n=e.maxPool3d(c,u);return t([c,n]),n},{x:c},function(e,i){var s=i[0],c=i[1];return{x:function(){return function(e,t,n,r,a,i,o,s){var c=ps(e,"dy","maxPool3dBackprop"),l=ps(t,"input","maxPool3dBackprop"),u=ps(n,"output","maxPool3dBackprop"),h=c,d=l,f=u,p=!1;4===l.rank&&(p=!0,h=c.as5D(1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]),d=l.as5D(1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]),f=u.as5D(1,u.shape[0],u.shape[1],u.shape[2],u.shape[3])),qa(5===h.rank,function(){return"Error in maxPool3dBackprop: dy must be rank 5 but got rank "+h.rank+"."}),qa(5===d.rank,function(){return"Error in maxPool3dBackprop: input must be rank 5 but got rank "+d.rank+"."}),qa(5===f.rank,function(){return"Error in maxPool3dBackprop: output must be rank 5 but got rank "+f.rank+"."}),null==i&&(i=[1,1,1]),qa(gl(a,i),function(){return"Error in maxPool3dBackprop: Either strides or dilations must be 1. Got strides "+a+" and dilations '"+i+"'"}),null!=s&&qa(Qa(o),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+o+"."});var m=sl(d.shape,r,a,i,o,s),g=no.runKernelFunc(function(e){return e.maxPool3dBackprop(h,d,f,m)},{dy5D:h,input5D:d});return p?g.as4D(g.shape[1],g.shape[2],g.shape[3],g.shape[4]):g}(e,s,c,t,n,o,r,a)}}});return l?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}}),Wp=Es({avgPool3d_:function(e,t,n,r,a,i,o){void 0===i&&(i="NDHWC");var s=ps(e,"x","avgPool3d","float32"),c=s,l=!1;4===s.rank&&(l=!0,c=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),null==o&&(o=[1,1,1]),qa(5===c.rank,function(){return"Error in avgPool3d: x must be rank 5 but got rank "+c.rank+"."}),qa("NDHWC"===i,function(){return"Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of "+i}),qa(gl(n,o),function(){return"Error in avgPool3d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+o+"'"}),null!=a&&qa(Qa(r),function(){return"Error in avgPool3d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+r+"."});var u=sl(c.shape,t,n,o,r,a,i),h=no.runKernelFunc(function(e){return e.avgPool3d(c,u)},{x:c},function(e){return{x:function(){return function(e,t,n,r,a,i,o){var s=ps(e,"dy","avgPool3dBackprop"),c=ps(t,"input","avgPool3dBackprop"),l=s,u=c,h=!1;4===c.rank&&(h=!0,l=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]),u=c.as5D(1,c.shape[0],c.shape[1],c.shape[2],c.shape[3])),qa(5===l.rank,function(){return"Error in avgPool3dBackprop: dy must be rank 5 but got rank "+l.rank+"."}),qa(5===u.rank,function(){return"Error in avgPool3dBackprop: input must be rank 5 but got rank "+u.rank+"."}),null==a&&(a=[1,1,1]),qa(gl(r,a),function(){return"Error in avgPool3dBackprop: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+a+"'"}),null!=o&&qa(Qa(i),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+i+"."});var d=sl(u.shape,n,r,a,i,o),f=no.runKernelFunc(function(e){return e.avgPool3dBackprop(l,u,d)},{dy5D:l,input5D:u});return h?f.as4D(f.shape[1],f.shape[2],f.shape[3],f.shape[4]):f}(e,c,t,n,o,r,a)}}});return h=h.cast(c.dtype),l?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}}),Vp=Es({slice_:function(e,t,n){var r,a,i=ps(e,"x","slice");if(0===i.rank)throw new Error("Slicing scalar is not possible");(r="number"==typeof t?[t].concat(new Array(i.rank-1).fill(0)):t.length<i.rank?t.concat(new Array(i.rank-t.length).fill(0)):t.slice()).forEach(function(e){qa(-1!==e,function(){return"slice() does not support negative begin indexing."})}),a=(a=null==n?new Array(i.rank).fill(-1):"number"==typeof n?[n].concat(new Array(i.rank-1).fill(-1)):n.length<i.rank?n.concat(new Array(i.rank-n.length).fill(-1)):n).map(function(e,t){return e>=0?e:(qa(-1===e,function(){return"Negative size values should be exactly -1 but got "+e+" for the slice() size at index "+t+"."}),i.shape[t]-r[t])}),Hc(i,r,a);var o=i.shape,s={begin:r,size:a};return no.runKernelFunc(function(e){return e.slice(i,r,a)},{x:i},function(e){for(var t=[],n=0;n<e.rank;n++)t.push([r[n],o[n]-r[n]-a[n]]);return{x:function(){return e.pad(t)}}},"Slice",s)}}),Hp=Es({slice1d_:function(e,t,n){var r=ps(e,"x","slice1d");return qa(1===r.rank,function(){return"slice1d expects a rank-1 tensor, but got a rank-"+r.rank+" tensor"}),Vp(r,[t],[n])}}),Gp=Es({slice2d_:function(e,t,n){var r=ps(e,"x","slice2d");return qa(2===r.rank,function(){return"slice2d expects a rank-2 tensor, but got a rank-"+r.rank+" tensor"}),Vp(r,t,n)}}),qp=Es({slice3d_:function(e,t,n){var r=ps(e,"x","slice3d");return qa(3===r.rank,function(){return"slice3d expects a rank-3 tensor, but got a rank-"+r.rank+" tensor"}),Vp(r,t,n)}}),Kp=Es({slice4d_:function(e,t,n){var r=ps(e,"x","slice4d");return qa(4===r.rank,function(){return"slice4d expects a rank-4 tensor, but got a rank-"+r.rank+" tensor"}),Vp(r,t,n)}});function Xp(e,t,n,r,a){return t.rank<n.rank&&(t=t.reshape(ys(t.shape,r))),e.rank<n.rank&&(e=e.reshape(ys(e.shape,r))),{x:function(){var r=e.mul(n.equal(t).cast(e.dtype));return null==a?r:r.transpose(a)}}}var Yp=Es({all_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=ps(e,"x","all","bool"),a=ai(t,r.shape),i=a,o=ws(i,r.rank);null!=o&&(r=r.transpose(o),i=Ss(i.length,r.rank));var s=no.runKernelFunc(function(e){return e.all(r,i)},{$x:r});if(n){var c=ys(s.shape,a);return s.reshape(c)}return s}}),$p=Es({any_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=ps(e,"x","any","bool"),a=ai(t,r.shape),i=a,o=ws(i,r.rank);null!=o&&(r=r.transpose(o),i=Ss(i.length,r.rank));var s=no.runKernelFunc(function(e){return e.any(r,i)},{$x:r});if(n){var c=ys(s.shape,a);return s.reshape(c)}return s}}),Jp=Es({argMax_:function(e,t){void 0===t&&(t=0);var n=ps(e,"x","argMax");null==t&&(t=0);var r=ai(t,n.shape),a=ws(r,n.rank);null!=a&&(n=n.transpose(a),r=Ss(r.length,n.rank));var i={axis:r[0]},o=[n];return no.runKernelFunc(function(e,t){var a=e.argMax(n,r[0]);return t([n]),a},{x:n},function(e,t){var n=t[0];return{x:function(){return Ws(n)}}},"ArgMax",i,o)}}),Qp=Es({argMin_:function(e,t){void 0===t&&(t=0);var n=ps(e,"x","argMin");null==t&&(t=0);var r=ai(t,n.shape),a=ws(r,n.rank);return null!=a&&(n=n.transpose(a),r=Ss(r.length,n.rank)),no.runKernelFunc(function(e,t){var a=e.argMin(n,r[0]);return t([n]),a},{$x:n},function(e,t){var n=t[0];return{$x:function(){return Ws(n)}}})}}),Zp=Es({logSumExp_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=ps(e,"x","logSumExp"),a=ai(t,r.shape),i=r.max(a,!0),o=r.sub(i).exp().sum(a).log(),s=i.reshape(o.shape).add(o);if(n){var c=ys(s.shape,a);return s.reshape(c)}return s}}),em=Es({max_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=ps(e,"x","max"),a=r,i=ai(t,r.shape),o=i,s=ws(o,r.rank);null!=s&&(r=r.transpose(s),o=Ss(o.length,r.rank));var c=[r],l=no.runKernelFunc(function(e,t){var n=e.max(r,o);return t([a,n]),n},{x:r},function(e,t){return Xp(e,t[1],t[0],i,s)},"Max",{axes:o},c,[!0]);if(n){var u=ys(l.shape,i);l=l.reshape(u)}return l}}),tm=Es({mean_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=ps(e,"x","mean"),a=ai(t,r.shape),i=$a(bs(r.shape,a)[1]);return Jc(function(e){var r=Fs(i);return{value:(r.dtype===e.dtype?e:e.cast(r.dtype)).div(r).sum(t,n),gradFunc:function(t){var n=e.shape.slice();return a.forEach(function(e){n[e]=1}),t.reshape(n).mul(Ms(e.shape,"float32")).div(i)}}})(r)}}),nm=Es({min_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=ps(e,"x","min"),a=r,i=ai(t,r.shape),o=i,s=ws(o,r.rank);null!=s&&(r=r.transpose(s),o=Ss(o.length,r.rank));var c=[r],l=no.runKernelFunc(function(e,t){var n=e.min(r,o);return t([a,n]),n},{x:r},function(e,t){return Xp(e,t[1],t[0],i,s)},"Min",{axes:o},c,[!0]);if(n){var u=ys(l.shape,i);l=l.reshape(u)}return l}}),rm=Es({moments_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=ai(t,(e=ps(e,"x","moments")).shape),a=e.mean(r,n),i=a.shape;n||(i=ys(a.shape,r));var o=e.toFloat().sub(a.reshape(i)).square();return{mean:a,variance:o.mean(r,n)}}}),am=Es({sum_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=ps(e,"x","sum");"bool"===r.dtype&&(r=r.toInt());var a=ai(t,r.shape);return Jc(function(e){var t=ws(a,e.rank),r=a,i=e;null!=t&&(i=e.transpose(t),r=Ss(r.length,e.rank));var o=function(t){var n=e.shape.slice();return a.forEach(function(e){n[e]=1}),t.reshape(n).mul(Ms(e.shape,"float32"))},s={axes:r},c=no.runKernelFunc(function(e){return e.sum(i,r)},{x:i},function(e){return{x:function(){return o(e)}}},"Sum",s);if(n){var l=ys(c.shape,a);c=c.reshape(l)}return{value:c,gradFunc:o}})(r)}}),im=Es({prod_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=ps(e,"x","prod");"bool"===r.dtype&&(r=r.toInt());var a=ai(t,r.shape),i=ws(a,r.rank),o=a,s=r;null!=i&&(s=r.transpose(i),o=Ss(o.length,r.rank));var c=no.runKernelFunc(function(e){return e.prod(s,o)},{permutedX:s});if(n){var l=ys(c.shape,a);c=c.reshape(l)}return c}}),om=Es({elu_:function(e){var t=ps(e,"x","elu");return no.runKernelFunc(function(e,n){var r=e.elu(t);return n([r]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return no.runKernelFunc(function(t){return t.eluDer(e,n)},{dy:e,y:n})}}})}}),sm=Es({leakyRelu_:function(e,t){void 0===t&&(t=.2);var n=ps(e,"x","leakyRelu");return Bf(Fs(t).mul(n),n)}}),cm=Es({prelu_:function(e,t){var n=ps(e,"x","prelu"),r=ps(t,"alpha","prelu");return no.runKernelFunc(function(e,t){var a=e.prelu(n,r);return t([n,r]),a},{x:n,alpha:r},function(e,t){var n=t[0],r=t[1],a=n.greater(0);return{x:function(){return _f(a,e,e.mul(r))},alpha:function(){var t=_f(a,Ws(e),e.mul(n)),i=al(r.shape,e.shape);return i.length>0&&(t=t.sum(i)),t.reshape(r.shape)}}},"Prelu")}}),lm=Es({relu_:function(e){var t=ps(e,"x","relu");return"bool"===t.dtype?t.toInt():no.runKernelFunc(function(e,n){var r=e.relu(t);return n([t]),r},{x:t},function(e,t){var n=t[0];return{x:function(){return e.mulStrict(n.step().toFloat())}}},"Relu")}}),um=Es({relu6_:function(e){var t=ps(e,"x","relu6");return"bool"===t.dtype?t.toInt():no.runKernelFunc(function(e,n){var r=e.relu6(t);return n([t]),r},{x:t},function(e,t){var n=t[0],r=n.lessEqual(6).mul(n.step());return{x:function(){return e.mulStrict(r.toFloat())}}},"Relu6")}}),hm=Es({selu_:function(e){var t=ps(e,"x","selu");return no.runKernelFunc(function(e,n){var r=e.selu(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){var t=n.greater(Fs(0)),r=Fs($h),a=Fs(Jh),i=e.mul(a),o=e.mul(r).mul(n.toFloat().exp());return _f(t,i,o)}}})}}),dm=Es({transpose_:function(e,t){var n=ps(e,"x","transpose");if(null==t&&(t=n.shape.map(function(e,t){return t}).reverse()),qa(n.rank===t.length,function(){return"Error in transpose: rank of input "+n.rank+" must match length of perm "+t+"."}),t.forEach(function(e){qa(e>=0&&e<n.rank,function(){return"All entries in 'perm' must be between 0 and "+(n.rank-1)+" but got "+t})}),n.rank<=1)return n.clone();var r={perm:t};return no.runKernelFunc(function(e){return e.transpose(n,t)},{x:n},function(e){var n=ks(t);return{x:function(){return e.transpose(n)}}},"Transpose",r)}}),fm=Es({localResponseNormalization_:function(e,t,n,r,a){void 0===t&&(t=5),void 0===n&&(n=1),void 0===r&&(r=1),void 0===a&&(a=.5);var i=ps(e,"x","localResponseNormalization");qa(4===i.rank||3===i.rank,function(){return"Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank "+i.rank+"."}),qa(Qa(t),function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius "+t+"."});var o=i,s=!1;3===i.rank&&(s=!0,o=i.as4D(1,i.shape[0],i.shape[1],i.shape[2]));var c=no.runKernelFunc(function(e,i){var s=e.localResponseNormalization4D(o,t,n,r,a);return i([o,s]),s},{x4D:o},function(e,i){var o=i[0],s=i[1];return{x4D:function(){return no.runKernelFunc(function(i){return i.LRNGrad(e,o,s,t,n,r,a)},{})}}});return s?c.as3D(c.shape[1],c.shape[2],c.shape[3]):c}}),pm=Es({norm_:function(e,t,n,r){void 0===t&&(t="euclidean"),void 0===n&&(n=null),void 0===r&&(r=!1);var a=function e(t,n,r){if(void 0===r&&(r=null),0===t.rank)return t.abs();if(1!==t.rank&&null===r)return e(t.reshape([-1]),n,r);if(1===t.rank||"number"==typeof r||Array.isArray(r)&&1===r.length){if(1===n)return t.abs().sum(r);if(n===1/0)return t.abs().max(r);if(n===-1/0)return t.abs().min(r);if("euclidean"===n||2===n)return t.abs().pow(Fs(2,"int32")).sum(r).sqrt();throw new Error("Error in norm: invalid ord value: "+n)}if(Array.isArray(r)&&2===r.length){if(1===n)return t.abs().sum(r[0]).max(r[1]-1);if(n===1/0)return t.abs().sum(r[1]).max(r[0]);if(n===-1/0)return t.abs().sum(r[1]).min(r[0]);if("fro"===n||"euclidean"===n)return t.square().sum(r).sqrt();throw new Error("Error in norm: invalid ord value: "+n)}throw new Error("Error in norm: invalid axis: "+r)}(e=ps(e,"x","norm"),t,n),i=a.shape;if(r){var o=ai(n,e.shape);i=ys(a.shape,o)}return a.reshape(i)}}),mm=Es({basicLSTMCell_:function(e,t,n,r,a,i){var o=ps(e,"forgetBias","basicLSTMCell"),s=ps(t,"lstmKernel","basicLSTMCell"),c=ps(n,"lstmBias","basicLSTMCell"),l=ps(r,"data","basicLSTMCell"),u=ps(a,"c","basicLSTMCell"),h=ps(i,"h","basicLSTMCell"),d=l.concat(h,1).matMul(s).add(c),f=d.shape[0],p=d.shape[1]/4,m=[f,p],g=d.slice([0,0],m),v=d.slice([0,p],m),b=d.slice([0,2*p],m),y=d.slice([0,3*p],m),x=g.sigmoid().mulStrict(v.tanh()).addStrict(u.mulStrict(o.add(b).sigmoid())),w=x.tanh().mulStrict(y.sigmoid());return[x,w]}}),gm=Es({multiRNNCell_:function(e,t,n,r){for(var a=ps(t,"data","multiRNNCell"),i=ms(n,"c","multiRNNCell"),o=ms(r,"h","multiRNNCell"),s=a,c=[],l=0;l<e.length;l++){var u=e[l](s,i[l],o[l]);c.push(u[0]),c.push(u[1]),s=u[1]}var h=[],d=[];for(l=0;l<c.length;l+=2)h.push(c[l]),d.push(c[l+1]);return[h,d]}}),vm=Es({movingAverage_:function(e,t,n,r,a){void 0===a&&(a=!0);var i=ps(e,"v","movingAverage"),o=ps(t,"x","movingAverage"),s=ps(n,"decay","movingAverage");Ji(i,o),qa(Ja(i.shape,o.shape),function(){return"Shape mismatch in v and x"});var c=Fs(1),l=c.sub(s),u=o.sub(i).mul(l);if(a){qa(null!=r,function(){return"When using zeroDebias: true, step is required."});var h=ps(r,"step","movingAverage");u=u.div(c.sub(Kf(s,h)))}return i.add(u)}}),bm=Es({stridedSlice_:function(e,t,n,r,a,i,o,s,c){if(void 0===a&&(a=0),void 0===i&&(i=0),void 0===o&&(o=0),void 0===s&&(s=0),void 0===c&&(c=0),null==r&&(r=new Array(t.length)),0!==o)throw new Error("ellipsis mask is not yet supported");var l=ps(e,"x","stridedSlice"),u=Gc(s),h=l.shape.slice();u.forEach(function(e){t[e]=0,n[e]=1,h.splice(e,0,1)}),l=l.reshape(h);for(var d=0;d<l.rank;d++)t[d]=Kc(a,t,r,l.shape,d),n[d]=Xc(i,n,r,l.shape,d),r[d]=r[d]||1;var f=Gc(c);f.forEach(function(e){n[e]=t[e]+1,r[e]=1});var p=qc(t,n,r),m=p.filter(function(e,t){return-1===f.indexOf(t)});return r.every(function(e){return 1===e})?Vp(l,t,p).reshape(m):no.runKernelFunc(function(e){return e.stridedSlice(l,t,n,r)},{$x:l}).reshape(m)}}),ym=Es({topk_:function(e,t,n){void 0===t&&(t=1),void 0===n&&(n=!0);var r=ps(e,"x","topk");if(0===r.rank)throw new Error("topk() expects the input to be of rank 1 or higher");var a=r.shape[r.shape.length-1];if(t>a)throw new Error("'k' passed to topk() must be <= the last dimension ("+a+") but got "+t);var i=no.runKernelFunc(function(e){return e.topk(r,t,n)},{$x:r});return{values:i[0],indices:i[1]}}}),xm=Es({scatterND_:function(e,t,n){var r=ps(e,"indices","scatterND","int32"),a=ps(t,"updates","scatterND");return Wc(a,r,n),no.runKernelFunc(function(e){return e.scatterND(r,a,n)},{indices:r,updates:a},null,"ScatterNd",{shape:n})}}),wm=Es({fft_:function(e){qa("complex64"===e.dtype,function(){return"The dtype for tf.spectral.fft() must be complex64 but got "+e.dtype+"."});var t=e.shape[e.shape.length-1],n=e.size/t,r=e.as2D(n,t);return no.runKernelFunc(function(e){return e.fft(r)},{input:e}).reshape(e.shape)}}),km=Es({ifft_:function(e){qa("complex64"===e.dtype,function(){return"The dtype for tf.spectral.ifft() must be complex64 but got "+e.dtype+"."});var t=e.shape[e.shape.length-1],n=e.size/t,r=e.as2D(n,t);return no.runKernelFunc(function(e){return e.ifft(r)},{input:e}).reshape(e.shape)}}),Sm=Es({rfft_:function(e,t){qa("float32"===e.dtype,function(){return"The dtype for rfft() must be real value but got "+e.dtype});var n,r=e.shape[e.shape.length-1],a=e.size/r;if(null!=t&&t<r){var i=e.shape.map(function(e){return 0}),o=e.shape.map(function(e){return e});o[e.shape.length-1]=t,n=e.slice(i,o),r=t}else if(null!=t&&t>r){var s=e.shape.map(function(e){return e});s[e.shape.length-1]=t-r,n=e.concat(js(s),e.shape.length-1),r=t}else n=e;var c=n.zerosLike(),l=Is(n,c).as2D(a,r),u=wm(l),h=Math.floor(r/2)+1,d=Ts(u),f=_s(u),p=d.split([h,r-h],d.shape.length-1),m=f.split([h,r-h],f.shape.length-1),g=n.shape.slice();return g[n.shape.length-1]=h,Is(p[0],m[0]).reshape(g)}}),Nm=Es({irfft_:function(e){var t=e.shape[e.shape.length-1],n=e.size/t;if(t<=2){var r=e.as2D(n,t),a=km(r);return Ts(a)}var i=[n,2*(t-1)],o=Ts(e).as2D(n,t),s=_s(e).as2D(n,t),c=o.slice([0,1],[n,t-2]).reverse(1),l=s.slice([0,1],[n,t-2]).reverse(1).mul(Fs(-1)),u=o.concat(c,1),h=s.concat(l,1);return r=Is(u,h).as2D(i[0],i[1]),a=km(r),Ts(a)}}),Cm=Object.freeze({fft:wm,ifft:km,rfft:Sm,irfft:Nm}),Em=Es({sparseToDense_:function(e,t,n,r){void 0===r&&(r=0);var a=ps(e,"sparseIndices","sparseToDense","int32"),i=ps(t,"sparseValues","sparseToDense"),o=ps(r,"defaultValue","sparseToDense",i.dtype);return function(e,t,n,r){if("int32"!==e.dtype)throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was "+e.dtype+".");if(e.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape "+e.shape+".");var a=e.rank>0?e.shape[0]:1,i=e.rank>1?e.shape[1]:1;if(n.length!==i)throw new Error("outputShape has incorrect number of elements:, "+n.length+", should be: "+i+".");var o=t.size;if(0!==t.rank&&(1!==t.rank||o!==a))throw new Error("sparseValues has incorrect shape "+t.shape+", should be [] or ["+a+"]");if(t.dtype!==r.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(a,i,n,o),no.runKernelFunc(function(e){return e.sparseToDense(a,i,n,o)},{$sparseIndices:a,$sparseValues:i,$defaultValue:o})}}),Im=Es({gatherND_:function(e,t){var n=ps(t,"indices","gatherND","int32"),r=ps(e,"x","gatherND");return no.runKernelFunc(function(e){return e.gatherND(r,n)},{x:r,indices:n},null,"GatherNd")}}),Tm=Es({diag_:function(e){var t=ps(e,"x","diag").flatten(),n=e.shape.concat(e.shape);return no.runKernelFunc(function(e){return e.diag(t)},{$x:t}).reshape(n)}}),_m=Es({dropout_:function(e,t,n,r){var a=ps(e,"x","dropout");if(qa("float32"===a.dtype,function(){return"x has to be a floating point tensor since it's going to be scaled, but got a "+a.dtype+" tensor instead."}),qa(t>=0&&t<1,function(){return"rate must be a float in the range [0, 1), but got "+t+"."}),0===t)return e instanceof zi?a.clone():a;var i=function(e,t){if(null==t)return e.shape.slice();if(Ja(e.shape,t))return t;if(e.shape.length===t.length){for(var n=[],r=0;r<e.shape.length;r++)null==t[r]&&null!=e.shape[r]?n.push(e.shape[r]):n.push(t[r]);return n}return t}(a,n),o=1-t,s=Ec(i,0,1,"float32",r).add(o).floor().div(o);return a.mul(s)}});function Am(e,t,n){for(var r=1-e%2,a=new Float32Array(e),i=0;i<e;++i){var o=2*Math.PI*i/(e+r-1);a[i]=t-n*Math.cos(o)}return Ds(a,"float32")}var Rm,Fm=Es({hannWindow_:function(e){return Am(e,.5,.5)}}),Dm=Es({hammingWindow_:function(e){return Am(e,.54,.46)}}),Om=Es({frame_:function(e,t,n,r,a){void 0===r&&(r=!1),void 0===a&&(a=0);for(var i=0,o=[];i+t<=e.size;)o.push(Vp(e,i,t)),i+=n;if(r)for(;i<e.size;){var s=i+t-e.size,c=Vs([Vp(e,i,t-s),Bs([s],a)]);o.push(c),i+=n}return 0===o.length?Os([],[0,t]):Vs(o).as2D(o.length,t)}}),Lm=Es({stft_:function(e,t,n,r,a){var i;void 0===a&&(a=Fm),null==r&&(i=t,r=Math.floor(Math.pow(2,Math.ceil(Math.log(i)/Math.log(2)))));for(var o=Om(e,t,n),s=Gf(o,a(t)),c=[],l=0;l<o.shape[0];l++)c.push(Sm(s.slice([l,0],[1,t]),r));return Vs(c)}}),Pm=Object.freeze({hannWindow:Fm,hammingWindow:Dm,frame:Om,stft:Lm});!function(e){e[e.NONE=0]="NONE",e[e.MEAN=1]="MEAN",e[e.SUM=2]="SUM",e[e.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"}(Rm||(Rm={}));var Mm=Es({absoluteDifference_:function(e,t,n,r){void 0===r&&(r=Rm.SUM_BY_NONZERO_WEIGHTS);var a=ps(e,"labels","absoluteDifference"),i=ps(t,"predictions","absoluteDifference"),o=null;null!=n&&(o=ps(n,"weights","absoluteDifference")),Ka(a.shape,i.shape,"Error in absoluteDifference: ");var s=a.sub(i).abs();return jm(s,o,r)}}),jm=Es({computeWeightedLoss_:function(e,t,n){void 0===n&&(n=Rm.SUM_BY_NONZERO_WEIGHTS);var r=ps(e,"losses","computeWeightedLoss"),a=null;null!=t&&(a=ps(t,"weights","computeWeightedLoss"));var i=null==a?r:r.mul(a);if(n===Rm.NONE)return i;if(n===Rm.SUM)return i.sum();if(n===Rm.MEAN){if(null==a)return i.mean();var o=r.size/a.size,s=i.sum().div(a.sum());return o>1?s.div(Fs(o)):s}if(n===Rm.SUM_BY_NONZERO_WEIGHTS){if(null==a)return i.sum().div(Fs(r.size));var c=a.mul(Ms(r.shape)).notEqual(Fs(0)).sum().toFloat();return i.sum().div(c)}throw Error("Unknown reduction: "+n)}}),Bm=Es({cosineDistance_:function(e,t,n,r,a){void 0===a&&(a=Rm.SUM_BY_NONZERO_WEIGHTS);var i=ps(e,"labels","cosineDistance"),o=ps(t,"predictions","cosineDistance"),s=null;null!=r&&(s=ps(r,"weights","cosineDistance")),Ka(i.shape,o.shape,"Error in cosineDistance: ");var c=Fs(1).sub(i.mul(o).sum(n,!0));return jm(c,s,a)}}),zm=Es({hingeLoss_:function(e,t,n,r){void 0===r&&(r=Rm.SUM_BY_NONZERO_WEIGHTS);var a=ps(e,"labels","hingeLoss"),i=ps(t,"predictions","hingeLoss"),o=null;null!=n&&(o=ps(n,"weights","hingeLoss")),Ka(a.shape,i.shape,"Error in hingeLoss: ");var s=Fs(1);a=Fs(2).mul(a).sub(s);var c=s.sub(a.mul(i)).relu();return jm(c,o,r)}}),Um=Es({huberLoss_:function(e,t,n,r,a){void 0===r&&(r=1),void 0===a&&(a=Rm.SUM_BY_NONZERO_WEIGHTS);var i=ps(e,"labels","huberLoss"),o=ps(t,"predictions","huberLoss"),s=null;null!=n&&(s=ps(n,"weights","huberLoss")),Ka(i.shape,o.shape,"Error in huberLoss: ");var c=Fs(r),l=o.sub(i).abs(),u=Uf(l,c),h=l.sub(u),d=Fs(.5).mul(u.square()).add(c.mul(h));return jm(d,s,a)}}),Wm=Es({logLoss_:function(e,t,n,r,a){void 0===r&&(r=1e-7),void 0===a&&(a=Rm.SUM_BY_NONZERO_WEIGHTS);var i=ps(e,"labels","logLoss"),o=ps(t,"predictions","logLoss"),s=null;null!=n&&(s=ps(n,"weights","logLoss")),Ka(i.shape,o.shape,"Error in logLoss: ");var c=Fs(1),l=Fs(r),u=i.mul(o.add(l).log()).neg().sub(c.sub(i).mul(c.sub(o).add(l).log()));return jm(u,s,a)}}),Vm=Es({meanSquaredError_:function(e,t,n,r){void 0===r&&(r=Rm.SUM_BY_NONZERO_WEIGHTS);var a=ps(e,"labels","meanSquaredError"),i=ps(t,"predictions","meanSquaredError"),o=null;null!=n&&(o=ps(n,"weights","meanSquaredError")),Ka(a.shape,i.shape,"Error in meanSquaredError: ");var s=a.squaredDifference(i);return jm(s,o,r)}}),Hm=Es({sigmoidCrossEntropy_:function(e,t,n,r,a){void 0===r&&(r=0),void 0===a&&(a=Rm.SUM_BY_NONZERO_WEIGHTS);var i=ps(e,"multiClassLabels","sigmoidCrossEntropy"),o=ps(t,"logits","sigmoidCrossEntropy"),s=null;if(null!=n&&(s=ps(n,"weights","sigmoidCrossEntropy")),Ka(i.shape,o.shape,"Error in sigmoidCrossEntropy: "),r>0){var c=Fs(r),l=Fs(1),u=Fs(.5);i=i.mul(l.sub(c)).add(u.mul(c))}var h=function(e,t){var n=ps(e,"labels","sigmoidCrossEntropyWithLogits"),r=ps(t,"logits","sigmoidCrossEntropyWithLogits");Ka(n.shape,r.shape,"Error in sigmoidCrossEntropyWithLogits: ");var a=r.relu(),i=r.mul(n),o=r.abs().neg().exp().log1p();return a.sub(i).add(o)}(i,o);return jm(h,s,a)}}),Gm=Es({softmaxCrossEntropy_:function(e,t,n,r,a){void 0===r&&(r=0),void 0===a&&(a=Rm.SUM_BY_NONZERO_WEIGHTS);var i=ps(e,"onehotLabels","softmaxCrossEntropy"),o=ps(t,"logits","softmaxCrossEntropy"),s=null;if(null!=n&&(s=ps(n,"weights","softmaxCrossEntropy")),Ka(i.shape,o.shape,"Error in softmaxCrossEntropy: "),r>0){var c=Fs(r),l=Fs(1),u=Fs(i.shape[1]);i=i.mul(l.sub(c)).add(c.div(u))}var h=function(e,t,n){if(void 0===n&&(n=-1),-1===n&&(n=t.rank-1),n!==t.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+t.rank+" and dim was "+n);return Jc(function(e,t,r){var a=t.logSumExp([n],!0),i=t.toFloat().sub(a);return r([e,i]),{value:i.mul(e).neg().sum([n]),gradFunc:function(e,t){var r=t[0],a=t[1],i=ys(e.shape,[n]);return[e.reshape(i).mul(r.toFloat().sub(a.exp())),e.reshape(i).mul(a.exp().sub(r.toFloat()))]}}})(e,t)}(i,o);return jm(h,s,a)}}),qm=Object.freeze({get Reduction(){return Rm},absoluteDifference:Mm,computeWeightedLoss:jm,cosineDistance:Bm,hingeLoss:zm,huberLoss:Um,logLoss:Wm,meanSquaredError:Vm,sigmoidCrossEntropy:Hm,softmaxCrossEntropy:Gm});function Km(e,t){return void 0===t&&(t=!1),no.tidy(function(){if(2!==e.shape.length)throw new Error("qr2d() requires a 2D Tensor, but got a "+e.shape.length+"D Tensor.");for(var n=e.shape[0],r=e.shape[1],a=mc(n),i=e.clone(),o=Os([[1]],[1,1]),s=o.clone(),c=n>=r?r:n,l=function(e){var t,c=i,l=s,u=a;t=no.tidy(function(){var t=i.slice([e,e],[n-e,1]),c=t.norm(),l=i.slice([e,e],[1,1]),u=Os([[-1]]).where(l.greater(0),Os([[1]])),h=l.sub(u.mul(c)),d=t.div(h);s=1===d.shape[0]?o.clone():o.concat(d.slice([1,0],[d.shape[0]-1,d.shape[1]]),0);var f=u.matMul(h).div(c).neg(),p=i.slice([e,0],[n-e,r]),m=f.mul(s);if(0===e)i=p.sub(m.matMul(s.transpose().matMul(p)));else{var g=p.sub(m.matMul(s.transpose().matMul(p)));i=i.slice([0,0],[e,r]).concat(g,0)}var v=a.slice([0,e],[n,a.shape[1]-e]);if(0===e)a=v.sub(v.matMul(s).matMul(m.transpose()));else{var b=v.sub(v.matMul(s).matMul(m.transpose()));a=a.slice([0,0],[n,e]).concat(b,1)}return[s,i,a]}),s=t[0],i=t[1],a=t[2],us([c,l,u])},u=0;u<c;++u)l(u);return!t&&n>r&&(a=a.slice([0,0],[n,r]),i=i.slice([0,0],[r,r])),[a,i]})}var Xm=Es({bandPart_:function(e,t,n){if(t%1!=0)throw new Error("bandPart(): numLower must be an integer, got "+t+".");if(n%1!=0)throw new Error("bandPart(): numUpper must be an integer, got "+n+".");var r=ps(e,"a","bandPart");if(r.rank<2)throw new Error("bandPart(): Rank must be at least 2, got "+r.rank+".");var a=r.shape,i=r.shape.slice(-2),o=i[0],s=i[1];if(!(t<=o))throw new Error("bandPart(): numLower ("+t+") must not be greater than the number of rows ("+o+").");if(!(n<=s))throw new Error("bandPart(): numUpper ("+n+") must not be greater than the number of columns ("+s+").");t<0&&(t=o),n<0&&(n=s);var c=zs(0,o,1,"int32").reshape([-1,1]),l=zs(0,s,1,"int32"),u=$f(c,l),h=Cf(u.lessEqual(Fs(+t,"int32")),u.greaterEqual(Fs(-n,"int32"))),d=js([o,s],r.dtype);return Ac(Dc(r.reshape([-1,o,s])).map(function(e){return _f(h,e,d)})).reshape(a)}}),Ym=Es({gramSchmidt_:function(e){var t;if(Array.isArray(e)){t=!1,qa(null!=e&&e.length>0,function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"});for(var n=e[0].shape[0],r=function(t){qa(e[t].shape[0]===n,function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+e[t].shape[0]+" vs. "+n+")"})},a=1;a<e.length;++a)r(a)}else t=!0,e=Xs(e,e.shape[0],0).map(function(e){return _c(e,[0])});qa(e.length<=e[0].shape[0],function(){return"Gram-Schmidt: Number of vectors ("+e.length+") exceeds number of dimensions ("+e[0].shape[0]+")."});var i=[],o=e,s=function(e){i.push(no.tidy(function(){var t=o[e];if(e>0)for(var n=0;n<e;++n){var r=am(i[n].mulStrict(t)).mul(i[n]);t=t.sub(r)}return t.div(pm(t,"euclidean"))}))};for(a=0;a<e.length;++a)s(a);return t?Ac(i,0):i}}),$m=Es({qr_:function(e,t){if(void 0===t&&(t=!1),e.rank<2)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+e.rank);if(2===e.rank)return Km(e,t);var n=e.shape.slice(0,e.shape.length-2).reduce(function(e,t){return e*t}),r=Dc(e.reshape([n,e.shape[e.shape.length-2],e.shape[e.shape.length-1]]),0),a=[],i=[];return r.forEach(function(e){var n=Km(e,t),r=n[0],o=n[1];a.push(r),i.push(o)}),[Ac(a,0).reshape(e.shape),Ac(i,0).reshape(e.shape)]}}),Jm=Object.freeze({bandPart:Xm,gramSchmidt:Ym,qr:$m});function Qm(e,t,n,r,a,i){null==r&&(r=.5),null==a&&(a=Number.NEGATIVE_INFINITY),null==i&&(i=0);var o=e.shape[0];return n=Math.min(n,o),qa(0<=r&&r<=1,function(){return"iouThreshold must be in [0, 1], but was '"+r+"'"}),qa(2===e.rank,function(){return"boxes must be a 2D tensor, but was of rank '"+e.rank+"'"}),qa(4===e.shape[1],function(){return"boxes must have 4 columns, but 2nd dimension was "+e.shape[1]}),qa(1===t.rank,function(){return"scores must be a 1D tensor"}),qa(t.shape[0]===o,function(){return"scores has incompatible shape with boxes. Expected "+o+", but was "+t.shape[0]}),qa(0<=i&&i<=1,function(){return"softNmsSigma must be in [0, 1], but was '"+i+"'"}),{maxOutputSize:n,iouThreshold:r,scoreThreshold:a,softNmsSigma:i}}var Zm=Es({resizeBilinear_:function(e,t,n){void 0===n&&(n=!1);var r=ps(e,"images","resizeBilinear");qa(3===r.rank||4===r.rank,function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+r.rank+"."}),qa(2===t.length,function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+t+"."});var a=r,i=!1;3===r.rank&&(i=!0,a=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var o=t[0],s=t[1],c=no.runKernelFunc(function(e,t){return t([a]),e.resizeBilinear(a,o,s,n)},{x:a},function(e,t){return{x:function(){return no.runKernelFunc(function(r){return r.resizeBilinearBackprop(e,t[0],n)},{})}}},"ResizeBilinear",{alignCorners:n,newHeight:o,newWidth:s});return i?c.as3D(c.shape[1],c.shape[2],c.shape[3]):c}}),eg=Es({resizeNearestNeighbor_:function(e,t,n){void 0===n&&(n=!1);var r=ps(e,"images","resizeNearestNeighbor");qa(3===r.rank||4===r.rank,function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+r.rank+"."}),qa(2===t.length,function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+t+"."}),qa("float32"===r.dtype||"int32"===r.dtype,function(){return"`images` must have `int32` or `float32` as dtype"});var a=r,i=!1;3===r.rank&&(i=!0,a=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var o=t[0],s=t[1],c=no.runKernelFunc(function(e,t){return t([a]),e.resizeNearestNeighbor(a,o,s,n)},{batchImages:a},function(e,t){return{batchImages:function(){return no.runKernelFunc(function(r){return r.resizeNearestNeighborBackprop(e,t[0],n)},{})}}});return i?c.as3D(c.shape[1],c.shape[2],c.shape[3]):c}}),tg=Es({nonMaxSuppression_:function(e,t,n,r,a){void 0===r&&(r=.5),void 0===a&&(a=Number.NEGATIVE_INFINITY);var i=ps(e,"boxes","nonMaxSuppression"),o=ps(t,"scores","nonMaxSuppression"),s=Qm(i,o,n,r,a);n=s.maxOutputSize,r=s.iouThreshold,a=s.scoreThreshold;var c={maxOutputSize:n,iouThreshold:r,scoreThreshold:a};return no.runKernelFunc(function(e){return e.nonMaxSuppression(i,o,n,r,a)},{boxes:i,scores:o},null,"NonMaxSuppressionV3",c)}}),ng=Es({nonMaxSuppressionWithScore_:function(e,t,n,r,a,i){void 0===r&&(r=.5),void 0===a&&(a=Number.NEGATIVE_INFINITY),void 0===i&&(i=0);var o=ps(e,"boxes","nonMaxSuppression"),s=ps(t,"scores","nonMaxSuppression"),c=Qm(o,s,n,r,a,i),l={maxOutputSize:n=c.maxOutputSize,iouThreshold:r=c.iouThreshold,scoreThreshold:a=c.scoreThreshold,softNmsSigma:i=c.softNmsSigma},u=no.runKernel("NonMaxSuppressionV5",{boxes:o,scores:s},l);return{selectedIndices:u[0],selectedScores:u[1]}}}),rg=Es({cropAndResize_:function(e,t,n,r,a,i){var o=ps(e,"image","cropAndResize"),s=ps(t,"boxes","cropAndResize","float32"),c=ps(n,"boxInd","cropAndResize","int32");a=a||"bilinear",i=i||0;var l=s.shape[0];return qa(4===o.rank,function(){return"Error in cropAndResize: image must be rank 4,but got rank "+o.rank+"."}),qa(2===s.rank&&4===s.shape[1],function(){return"Error in cropAndResize: boxes must be have size ["+l+",4] but had shape "+s.shape+"."}),qa(1===c.rank&&c.shape[0]===l,function(){return"Error in cropAndResize: boxInd must be have size ["+l+"] but had shape "+s.shape+"."}),qa(2===r.length,function(){return"Error in cropAndResize: cropSize must be of length 2, but got length "+r.length+"."}),qa(r[0]>=1&&r[1]>=1,function(){return"cropSize must be atleast [1,1], but was "+r}),qa("bilinear"===a||"nearest"===a,function(){return"method must be bilinear or nearest, but was "+a}),no.runKernelFunc(function(e,t){return e.cropAndResize(o,s,c,r,a,i)},{images:o,boxes:s,boxInd:c},null,"CropAndResize",{method:a,extrapolationValue:i,cropSize:r})}}),ag=Object.freeze({resizeBilinear:Zm,resizeNearestNeighbor:eg,nonMaxSuppression:tg,nonMaxSuppressionAsync:function(e,t,n,r,a){return void 0===r&&(r=.5),void 0===a&&(a=Number.NEGATIVE_INFINITY),Aa(this,void 0,void 0,function(){var i,o,s,c,l,u,h;return Ra(this,function(d){switch(d.label){case 0:return i=ps(e,"boxes","nonMaxSuppressionAsync"),o=ps(t,"scores","nonMaxSuppressionAsync"),s=Qm(i,o,n,r,a),n=s.maxOutputSize,r=s.iouThreshold,a=s.scoreThreshold,[4,Promise.all([i.data(),o.data()])];case 1:return c=d.sent(),l=c[0],u=c[1],h=Il(l,u,n,r,a),i!==e&&i.dispose(),o!==t&&o.dispose(),[2,h]}})})},nonMaxSuppressionWithScore:ng,nonMaxSuppressionWithScoreAsync:function(e,t,n,r,a,i){return void 0===r&&(r=.5),void 0===a&&(a=Number.NEGATIVE_INFINITY),void 0===i&&(i=0),Aa(this,void 0,void 0,function(){var o,s,c,l,u,h,d;return Ra(this,function(f){switch(f.label){case 0:return o=ps(e,"boxes","nonMaxSuppressionAsync"),s=ps(t,"scores","nonMaxSuppressionAsync"),c=Qm(o,s,n,r,a,i),n=c.maxOutputSize,r=c.iouThreshold,a=c.scoreThreshold,i=c.softNmsSigma,[4,Promise.all([o.data(),s.data()])];case 1:return l=f.sent(),u=l[0],h=l[1],d=Tl(u,h,n,r,a,i),o!==e&&o.dispose(),s!==t&&s.dispose(),[2,d]}})})},cropAndResize:rg}),ig=function(e,t){return!(e>0)||"linear"===t},og=function(e,t,n){if(null==n||"linear"===n)return e;if("relu"===n)return e.mul(t.step());throw new Error("Gradient for activation "+n+" has not been implemented yet.")},sg=function(e,t){var n=t,r=al(e.shape,t.shape);return r.length>0&&(n=n.sum(r)),n.reshape(e.shape)},cg=function(e,t,n){if("linear"===t)return e;if("relu"===t)return lm(e);if("elu"===t)return om(e);if("relu6"===t)return um(e);if("prelu"===t)return cm(e,n);throw new Error("Unknown fused activation "+t+".")},lg=Es({fusedMatMul_:function(e){var t,n=e.a,r=e.b,a=e.transposeA,i=void 0!==a&&a,o=e.transposeB,s=void 0!==o&&o,c=e.bias,l=e.activation,u=void 0===l?"linear":l,h=e.preluActivationWeights;if(!1===ig(no.state.gradientDepth,u)){var d=Tp(n,r,i,s);return null!=c&&(d=Rf(d,c)),cg(d,u,h)}var f=ps(n,"a","fused matMul"),p=ps(r,"b","fused matMul");t=$i(f,p),f=t[0],p=t[1];var m=i?f.shape[f.rank-2]:f.shape[f.rank-1],g=s?p.shape[p.rank-1]:p.shape[p.rank-2],v=i?f.shape[f.rank-1]:f.shape[f.rank-2],b=s?p.shape[p.rank-2]:p.shape[p.rank-1],y=f.shape.slice(0,-2),x=p.shape.slice(0,-2),w=$a(y),k=$a(x);qa(f.rank>=2&&p.rank>=2&&f.rank===p.rank,function(){return"Error in fused matMul: inputs must have the same rank of at least 2, got ranks "+f.rank+" and "+p.rank+"."}),qa(Ja(y,x),function(){return"Error in fused matMul: outer dimensions ("+y+") and ("+x+") of Tensors with shapes "+f.shape+" and "+p.shape+" must match."}),qa(m===g,function(){return"Error in fused matMul: inner shapes ("+m+") and ("+g+") of Tensors with shapes "+f.shape+" and "+p.shape+" and transposeA="+i+" and transposeB="+s+" must match."});var S,N,C=f.shape.slice(0,-2).concat([v,b]),E=i?f.as3D(w,m,v):f.as3D(w,v,m),I=s?p.as3D(k,b,g):p.as3D(k,g,b);null!=c&&il(C,(S=$i(S=ps(c,"bias","fused matMul"),f)[0]).shape),null!=h&&(N=ps(h,"prelu weights","fused matMul"));var T={a:E,b:I};null!=c&&(T.bias=S),null!=h&&(T.preluActivationWeights=N);var _=[E,I];return no.runKernelFunc(function(e,t){var n=e.fusedBatchMatMul({a:E,b:I,transposeA:i,transposeB:s,bias:S,activation:u,preluActivationWeights:N});return t([E,I,n]),n},T,function(e,t){var n=t[0],r=t[1],a=t[2],o=og(e,a,u),l={};return null!=c&&(l={bias:function(){return sg(S,o)}}),i||s?!i&&s?Object.assign({a:function(){return o.matMul(r,!1,!1)},b:function(){return o.matMul(n,!0,!1)}},l):i&&!s?Object.assign({a:function(){return r.matMul(o,!1,!0)},b:function(){return n.matMul(o,!1,!1)}},l):Object.assign({a:function(){return r.matMul(o,!0,!0)},b:function(){return o.matMul(n,!0,!0)}},l):Object.assign({a:function(){return o.matMul(r,!1,!0)},b:function(){return n.matMul(o,!0,!1)}},l)},"_FusedMatMul",{transposeA:i,transposeB:s,activation:u},_,[!0]).reshape(C)}}),ug=Es({fusedConv2d_:function(e){var t=e.x,n=e.filter,r=e.strides,a=e.pad,i=e.dataFormat,o=void 0===i?"NHWC":i,s=e.dilations,c=void 0===s?[1,1]:s,l=e.dimRoundingMode,u=e.bias,h=e.activation,d=void 0===h?"linear":h,f=e.preluActivationWeights;if(d=d||"linear",!1===ig(no.state.gradientDepth,d)){var p=bp(t,n,r,a,o,c,l);return null!=u&&(p=Rf(p,u)),cg(p,d,f)}var m=ps(t,"x","conv2d"),g=ps(n,"filter","conv2d"),v=m,b=!1;3===m.rank&&(b=!0,v=m.as4D(1,m.shape[0],m.shape[1],m.shape[2])),qa(4===v.rank,function(){return"Error in fused conv2d: input must be rank 4, but got rank "+v.rank+"."}),qa(4===g.rank,function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+g.rank+"."}),null!=l&&qa(Qa(a),function(){return"Error in fused conv2d: pad must be an integer when using, dimRoundingMode "+l+" but got pad "+a+"."}),qa(v.shape[3]===g.shape[2],function(){return"Error in conv2d: depth of input ("+v.shape[3]+") must match input depth for filter "+g.shape[2]+"."}),qa(gl(r,c),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+c+"'"}),qa("NHWC"===o,function(){return"Error in conv2d: got dataFormat of "+o+" but only NHWC is currently supported."});var y,x,w=cl(v.shape,g.shape,r,c,a,l);null!=u&&(y=$i(y=ps(u,"bias","fused conv2d"),m)[0],il(w.outShape,y.shape)),null!=f&&(x=ps(f,"prelu weights","fused conv2d"));var k={x:v,filter:g};null!=u&&(k.bias=y),null!=f&&(k.preluActivationWeights=x);var S=[g,v],N=no.runKernelFunc(function(e,t){var n=e.fusedConv2d({input:v,filter:g,convInfo:w,bias:y,activation:d,preluActivationWeights:x});return t([g,v,n]),n},k,function(e,t){var n=t,i=n[0],o=n[1],s=n[2],l=og(e,s,d);qa(ml(c),function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+c+"'"});var h={};return null!=u&&(h={bias:function(){return sg(y,l)}}),Object.assign({x:function(){return wp(o.shape,l,i,r,a)},filter:function(){return xp(o,l,i.shape,r,a)}},h)},"FusedConv2D",{convInfo:w,activation:d},S,[!0]);return b?N.as3D(N.shape[1],N.shape[2],N.shape[3]):N}}),hg=Es({fusedDepthwiseConv2d_:function(e){var t=e.x,n=e.filter,r=e.strides,a=e.pad,i=e.dataFormat,o=void 0===i?"NHWC":i,s=e.dilations,c=void 0===s?[1,1]:s,l=e.dimRoundingMode,u=e.bias,h=e.activation,d=void 0===h?"linear":h,f=e.preluActivationWeights;if(!1===ig(no.state.gradientDepth,d)){var p=kp(t,n,r,a,o,c,l);return null!=u&&(p=Rf(p,u)),cg(p,d,f)}var m=ps(t,"x","depthwiseConv2d"),g=ps(n,"filter","depthwiseConv2d"),v=m,b=!1;3===m.rank&&(b=!0,v=m.as4D(1,m.shape[0],m.shape[1],m.shape[2])),qa(4===v.rank,function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got rank "+v.rank+"."}),qa(4===g.rank,function(){return"Error in fused depthwiseConv2d: filter must be rank 4, but got rank "+g.rank+"."}),qa(v.shape[3]===g.shape[2],function(){return"Error in fused depthwiseConv2d: number of input channels ("+v.shape[3]+") must match the inChannels dimension in filter "+g.shape[2]+"."}),null==c&&(c=[1,1]),qa(gl(r,c),function(){return"Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+c+"'"}),null!=l&&qa(Qa(a),function(){return"Error in fused depthwiseConv2d: pad must be an integer when using dimRoundingMode "+l+" but got pad "+a+"."});var y,x,w=cl(v.shape,g.shape,r,c,a,l,!0);null!=u&&(y=$i(y=ps(u,"bias","fused conv2d"),m)[0],il(w.outShape,y.shape)),null!=f&&(x=ps(f,"prelu weights","fused depthwiseConv2d"));var k={x:v,filter:g};null!=u&&(k.bias=y),null!=f&&(k.preluActivationWeights=x);var S=[g,v],N=no.runKernelFunc(function(e,t){var n=e.fusedDepthwiseConv2D({input:v,filter:g,convInfo:w,bias:y,activation:d,preluActivationWeights:x});return t([g,v,n]),n},k,function(e,t){qa(ml(c),function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+c+"'"});var n=t[0],r=t[1],a=t[2],i=og(e,a,d),o={};return null!=u&&(o={bias:function(){return sg(y,i)}}),Object.assign({x:function(){return Sp(r.shape,i,n,w)},filter:function(){return Np(r,i,n.shape,w)}},o)},"FusedDepthwiseConv2D",{convInfo:w,activation:d},S,[!0]);return b?N.as3D(N.shape[1],N.shape[2],N.shape[3]):N}}),dg=Object.freeze({matMul:lg,conv2d:ug,depthwiseConv2d:hg}),fg=Object.freeze({image:ag,linalg:Jm,losses:qm,spectral:Cm,fused:dg,signal:Pm,square:Id,squaredDifference:_d,conv1d:vp,conv2d:bp,conv3d:yp,depthwiseConv2d:kp,separableConv2d:Cp,conv2dTranspose:Ep,conv3dTranspose:Ip,op:Es,batchNormalization2d:vf,batchNormalization3d:bf,batchNormalization4d:yf,batchNormalization:xf,batchNorm:wf,batchNorm2d:kf,batchNorm3d:Sf,batchNorm4d:Nf,booleanMaskAsync:function(e,t,n){return Aa(this,void 0,void 0,function(){var r,a,i,o,s,c,l,u,h,d,f,p,m;return Ra(this,function(g){switch(g.label){case 0:for(r=ps(e,"tensor","boolMask"),a=ps(t,"mask","boolMask","bool"),i=null==n?0:n,o=a.rank,s=r.shape,qa(o>0,function(){return"mask cannot be scalar"}),Ka(s.slice(i,i+o),a.shape,"mask's shape must match the first K dimensions of tensor's shape,"),c=1,l=i;l<i+o;l++)c*=s[l];return u=s.slice(0,i).concat([c],s.slice(i+o)),h=r.reshape(u),d=a.reshape([-1]),[4,Af(d)];case 1:return f=g.sent(),p=f.squeeze([1]),m=dp(h,p,i),e!==r&&r.dispose(),t!==a&&a.dispose(),p.dispose(),h.dispose(),d.dispose(),f.dispose(),[2,m]}})})},complex:Is,real:Ts,imag:_s,concat:Vs,concat1d:Hs,concat2d:Gs,concat3d:qs,concat4d:Ks,split:Xs,matMul:Tp,dot:_p,outerProduct:Ap,reverse:Rp,reverse1d:Fp,reverse2d:Dp,reverse3d:Op,reverse4d:Lp,maxPool:jp,avgPool:Bp,pool:zp,maxPool3d:Up,avgPool3d:Wp,slice:Vp,slice1d:Hp,slice2d:Gp,slice3d:qp,slice4d:Kp,abs:Ad,acos:Rd,acosh:Fd,asin:Dd,asinh:Od,atan:Ld,atanh:Pd,ceil:Md,clipByValue:jd,cos:Bd,cosh:zd,erf:Ud,exp:Wd,expm1:Vd,floor:Hd,log:Gd,log1p:qd,logSigmoid:Kd,neg:Xd,reciprocal:Yd,round:$d,rsqrt:Jd,sigmoid:Qd,sign:Zd,isNaN:ef,isInf:tf,isFinite:nf,sin:rf,sinh:af,softplus:of,sqrt:sf,step:cf,tan:lf,tanh:uf,all:Yp,any:$p,argMax:Jp,argMin:Qp,logSumExp:Zp,max:em,mean:tm,min:nm,moments:rm,sum:am,prod:im,equal:Qf,equalStrict:Zf,greater:ep,greaterEqual:tp,greaterEqualStrict:np,greaterStrict:rp,less:ap,lessEqual:ip,lessEqualStrict:op,lessStrict:sp,notEqual:cp,notEqualStrict:lp,add:Rf,addN:Ff,addStrict:Df,atan2:Of,div:Lf,divNoNan:Pf,divStrict:Mf,floorDiv:jf,maximum:Bf,maximumStrict:zf,minimum:Uf,minimumStrict:Wf,mod:Vf,modStrict:Hf,mul:Gf,mulStrict:qf,pow:Kf,powStrict:Xf,squaredDifferenceStrict:Yf,sub:$f,subStrict:Jf,elu:om,leakyRelu:sm,prelu:cm,relu:lm,relu6:um,selu:hm,logicalAnd:Cf,logicalNot:Ef,logicalOr:If,logicalXor:Tf,where:_f,whereAsync:Af,buffer:sc,print:function(e,t){void 0===t&&(t=!1),console.log(e.toString(t))},batchToSpaceND:cc,broadcastTo:lc,cast:uc,clone:hc,cumsum:dc,depthToSpace:fc,expandDims:pc,eye:mc,multinomial:gc,oneHot:vc,pad:bc,pad1d:yc,pad2d:xc,pad3d:wc,pad4d:kc,rand:Sc,randomNormal:Nc,randomGamma:Cc,randomUniform:Ec,reshape:Ic,spaceToBatchND:Tc,squeeze:_c,stack:Ac,tile:Rc,truncatedNormal:Fc,unstack:Dc,setdiff1dAsync:function(e,t){return Aa(this,void 0,void 0,function(){var n,r,a,i,o,s,c,l,u,h;return Ra(this,function(d){switch(d.label){case 0:return n=ps(e,"x","setdiff1d"),r=ps(t,"y","setdiff1d"),qa(n.dtype===r.dtype,function(){return"x and y should have the same dtype, but got x ("+n.dtype+") and y ("+r.dtype+")."}),qa(1===n.rank,function(){return"x should be 1D tensor, but got x ("+n.shape+")."}),qa(1===r.rank,function(){return"y should be 1D tensor, but got y ("+r.shape+")."}),[4,n.data()];case 1:return a=d.sent(),[4,r.data()];case 2:for(i=d.sent(),o=new Set(i),s=0,u=0;u<a.length;u++)o.has(a[u])||s++;for(c=new Pi([s],n.dtype),l=new Pi([s],"int32"),u=0,h=0;u<a.length;u++)o.has(a[u])||(c.values[h]=a[u],l.values[h]=u,h++);return[2,[c.toTensor(),l.toTensor()]]}})})},fill:Bs,linspace:function(e,t,n){if(n<=0)throw new Error("The number of values should be positive.");return no.runKernelFunc(function(r){return r.linspace(e,t,n)},{})},ones:Ms,range:zs,scalar:Fs,tensor:As,tensor1d:Ds,tensor2d:Os,tensor3d:Ls,tensor4d:Ps,tensor5d:function(e,t,n){if(Xa(e),null!=t&&5!==t.length)throw new Error("tensor5d() requires shape to have five numbers");var r=ds(e,n);if(5!==r.length&&1!==r.length)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return Rs(e,t,r,n)},tensor6d:function(e,t,n){if(Xa(e),null!=t&&6!==t.length)throw new Error("tensor6d() requires shape to have six numbers");var r=ds(e,n);if(6!==r.length&&1!==r.length)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return Rs(e,t=t||r,r,n)},variable:function(e,t,n,r){return void 0===t&&(t=!0),no.makeVariable(e,t,n,r)},zeros:js,onesLike:Us,zerosLike:Ws,transpose:dm,softmax:Qc,logSoftmax:Zc,localResponseNormalization:fm,norm:pm,gather:dp,unsortedSegmentSum:fp,basicLSTMCell:mm,multiRNNCell:gm,movingAverage:vm,stridedSlice:bm,topk:ym,scatterND:xm,fft:wm,ifft:km,rfft:Sm,irfft:Nm,sparseToDense:Em,gatherND:Im,diag:Tm,dropout:_m,hannWindow:Fm,hammingWindow:Dm,frame:Om,stft:Lm,inTopKAsync:function(e,t,n){return void 0===n&&(n=1),Aa(this,void 0,void 0,function(){var r,a,i,o,s,c,l,u,h,d,f,p,m,g;return Ra(this,function(v){switch(v.label){case 0:return r=ps(e,"predictions","inTopK"),a=ps(t,"targets","inTopK"),qa(r.rank>1,function(){return"inTopK() expects the predictions to be of rank 2 or higher, but got "+r.rank}),qa(r.rank-1===a.rank,function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+r.rank+" and targets rank "+a.rank}),Ka(r.shape.slice(0,r.shape.length-1),a.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),i=r.shape[r.shape.length-1],qa(n>0&&n<=i,function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last dimension ("+i+"), but got "+n}),[4,r.data()];case 1:return o=v.sent(),[4,a.data()];case 2:for(s=v.sent(),c=[o.length/i,i],u=c[1],h=oi("bool",l=c[0]),d=0;d<l;d++){for(f=d*u,p=o.subarray(f,f+u),m=[],g=0;g<p.length;g++)m.push({value:p[g],index:g});for(m.sort(function(e,t){return t.value-e.value}),h[d]=0,g=0;g<n;g++)if(m[g].index===s[d]){h[d]=1;break}}return e!==r&&r.dispose(),t!==a&&a.dispose(),[2,As(h,a.shape,"bool")]}})})}});function pg(e,t){Array.isArray(e)||(e=[e]),e.forEach(function(e){null!=e&&qa("complex64"!==e.dtype,function(){return t+" does not support complex64 tensors."})})}function mg(e,t,n,r){if("linear"===n)return e.linear(t);if("relu"===n)return e.relu(t);if("elu"===n)return e.elu(t);if("relu6"===n)return e.relu6(t);if("prelu"===n)return e.prelu(t,r);throw new Error("Activation "+n+" has not been implemented for the CPU backend.")}var gg=function(e){function t(){var t=e.call(this)||this;return t.blockSize=48,t.firstUse=!0,t.data=new el(t,no),t}return _a(t,e),t.prototype.write=function(e,t,n){this.firstUse&&(this.firstUse=!1,Da().get("IS_NODE")&&hs("\n============================\nHi there \ud83d\udc4b. Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.\n============================"));var r={};return this.data.set(r,{values:e,dtype:n}),r},t.prototype.move=function(e,t,n,r){this.data.set(e,{values:t,dtype:r})},t.prototype.numDataIds=function(){return this.data.numDataIds()},t.prototype.read=function(e){return Aa(this,void 0,void 0,function(){return Ra(this,function(t){return[2,this.readSync(e)]})})},t.prototype.readSync=function(e){var t=this.data.get(e),n=t.dtype,r=t.complexTensors;return"complex64"===n?wl(this.readSync(r.real.dataId),this.readSync(r.imag.dataId)):this.data.get(e).values},t.prototype.bufferSync=function(e){var t=this.readSync(e.dataId),n=t;if("string"===e.dtype)try{n=t.map(function(e){return Ti(e)})}catch(e){throw new Error("Failed to decode encoded string bytes into utf-8")}return sc(e.shape,e.dtype,n)},t.prototype.makeOutput=function(e,t,n){var r=this.write(e,t,n);return no.makeTensorFromDataId(r,t,n,this)},t.prototype.disposeData=function(e){if(this.data.has(e)){var t=this.data.get(e).complexTensors;null!=t&&(t.real.dispose(),t.imag.dispose()),this.data.delete(e)}},t.prototype.time=function(e){return Aa(this,void 0,void 0,function(){var t;return Ra(this,function(n){return t=Ci(),e(),[2,{kernelMs:Ci()-t}]})})},t.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},t.prototype.complex=function(e,t){var n=this.makeOutput(null,e.shape,"complex64");return this.data.get(n.dataId).complexTensors={real:no.keep(e.clone()),imag:no.keep(t.clone())},n},t.prototype.real=function(e){return this.data.get(e.dataId).complexTensors.real.clone()},t.prototype.imag=function(e){return this.data.get(e.dataId).complexTensors.imag.clone()},t.prototype.slice=function(e,t,n){if(pg(e,"slice"),Yc(e.shape,t,n)){var r=$c(t,e.strides),a=$a(n);return As(this.readSync(e.dataId).subarray(r,r+a),n,e.dtype)}for(var i=sc(n,e.dtype),o=this.bufferSync(e),s=0;s<i.size;++s){var c=i.indexToLoc(s).map(function(e,n){return e+t[n]});i.values[s]=o.get.apply(o,c)}return i.toTensor()},t.prototype.stridedSlice=function(e,t,n,r){pg(e,"stridedSlice");var a=qc(t,n,r);if(a.some(function(e){return 0===e}))return As([],a);for(var i=sc(a,e.dtype),o=this.bufferSync(e),s=0;s<i.size;s++){for(var c=i.indexToLoc(s),l=new Array(c.length),u=0;u<l.length;u++)l[u]=c[u]*r[u]+t[u];i.set.apply(i,[o.get.apply(o,l)].concat(c))}return i.toTensor()},t.prototype.diag=function(e){for(var t=this.readSync(e.dataId),n=sc([e.size,e.size],e.dtype),r=n.values,a=0;a<t.length;a++)r[a*e.size+a]=t[a];return n.toTensor()},t.prototype.unstack=function(e,t){for(var n=e.shape[t],r=new Array(e.rank-1),a=0,i=0;i<e.rank;i++)i!==t&&(r[a++]=e.shape[i]);var o=new Array(e.rank).fill(0),s=e.shape.slice();s[t]=1;var c=new Array(n);for(i=0;i<c.length;i++)o[t]=i,c[i]=this.slice(e,o,s).reshape(r);return c},t.prototype.reverse=function(e,t){pg(e,"reverse");for(var n=sc(e.shape,e.dtype),r=this.bufferSync(e),a=function(a){var i=n.indexToLoc(a),o=i.slice();t.forEach(function(t){return o[t]=e.shape[t]-1-o[t]}),n.set.apply(n,[r.get.apply(r,o)].concat(i))},i=0;i<n.size;i++)a(i);return n.toTensor()},t.prototype.concat=function(e,t){var n=this;if("complex64"===e[0].dtype){var r=e.map(function(e){return Ts(e)}),a=e.map(function(e){return _s(e)});return Is(this.concat(r,t),this.concat(a,t))}var i=e.map(function(e){var n=$a(e.shape.slice(t));return e.as2D(-1,n)}),o=Cs(i.map(function(e){return e.shape}),1),s=sc(o,e[0].dtype).values;if(1===i[0].shape[0]){var c=0;i.forEach(function(e){s.set(n.readSync(e.dataId),c),c+=e.size})}else{var l=0;i.forEach(function(e){for(var t=n.readSync(e.dataId),r=0,a=0;a<e.shape[0];++a)for(var i=a*o[1]+l,c=0;c<e.shape[1];++c)s[i+c]=t[r++];l+=e.shape[1]})}var u=Cs(e.map(function(e){return e.shape}),t);return As(s,u,e[0].dtype)},t.prototype.neg=function(e){return pg(e,"neg"),this.multiply(Fs(-1),e)},t.prototype.add=function(e,t){return"complex64"===e.dtype||"complex64"===t.dtype?this.broadcastedBinaryComplexOp(e.cast("complex64"),t.cast("complex64"),function(e,t,n,r){return{real:e+n,imag:t+r}}):this.broadcastedBinaryOp(e,t,Xi(e.dtype,t.dtype),function(e,t){return e+t})},t.prototype.addN=function(e){var t=this;pg(e,"addN");for(var n=e.map(function(e){return t.readSync(e.dataId)}),r=sc(e[0].shape,e[0].dtype),a=r.values,i=0;i<e.length;i++)for(var o=n[i],s=0;s<a.length;s++)a[s]+=o[s];return r.toTensor()},t.prototype.softmax=function(e,t){var n=ai([t],e.shape),r=this.max(e,n),a=ys(r.shape,n),i=this.subtract(e,r.reshape(a)),o=this.exp(i),s=this.sum(o,n).reshape(a);return this.realDivide(o,s)},t.prototype.subtract=function(e,t){return"complex64"===e.dtype||"complex64"===t.dtype?this.broadcastedBinaryComplexOp(e.cast("complex64"),t.cast("complex64"),function(e,t,n,r){return{real:e-n,imag:t-r}}):this.broadcastedBinaryOp(e,t,Xi(e.dtype,t.dtype),function(e,t){return e-t})},t.prototype.pow=function(e,t){return pg([e,t],"pow"),this.broadcastedBinaryOp(e,t,e.dtype,function(e,t){return Math.pow(e,t)})},t.prototype.batchMatMul=function(e,t,n,r){pg([e,t],"matMul");for(var a=n?e.shape[1]:e.shape[2],i=n?e.shape[2]:e.shape[1],o=r?t.shape[1]:t.shape[2],s=e.shape[0],c=this.readSync(e.dataId),l=this.readSync(t.dataId),u=n?[e.strides[0],1,e.strides[1]]:[e.strides[0],e.strides[1],1],h=u[0],d=u[1],f=u[2],p=r?[1,t.strides[1],t.strides[0]]:[t.strides[1],1,t.strides[0]],m=p[0],g=p[1],v=p[2],b=i*o,y=sc([s,i,o],e.dtype),x=y.values,w=this.blockSize,k=0;k<s;k++)for(var S=0;S<i;S+=w)for(var N=0;N<o;N+=w)for(var C=0;C<a;C+=w)for(var E=Math.min(S+w,i),I=Math.min(N+w,o),T=Math.min(C+w,a),_=S;_<E;_++)for(var A=N;A<I;A++){for(var R=0,F=C;F<T;F++)R+=c[k*h+_*d+F*f]*l[F*m+A*g+k*v];x[k*b+(_*o+A)]+=R}return y.toTensor()},t.prototype.fusedBatchMatMul=function(e){var t=e.a,n=e.b,r=e.transposeA,a=e.transposeB,i=e.bias,o=e.activation,s=e.preluActivationWeights,c=this.batchMatMul(t,n,r,a);return i&&(c=this.add(c,i)),o&&(c=mg(this,c,o,s)),c},t.prototype.multiply=function(e,t){return"complex64"===e.dtype||"complex64"===t.dtype?this.broadcastedBinaryComplexOp(e.cast("complex64"),t.cast("complex64"),function(e,t,n,r){return{real:e*n-t*r,imag:e*r+t*n}}):this.broadcastedBinaryOp(e,t,Xi(e.dtype,t.dtype),function(e,t){return e*t})},t.prototype.realDivide=function(e,t){return pg([e,t],"realDivide"),this.broadcastedBinaryOp(e,t,"float32",function(e,t){return e/t})},t.prototype.floorDiv=function(e,t){return pg([e,t],"floorDiv"),this.broadcastedBinaryOp(e,t,"int32",function(e,t){return Math.floor(e/t)})},t.prototype.sum=function(e,t){pg(e,"sum"),xs("sum",t,e.rank);for(var n=bs(e.shape,t),r=n[0],a=n[1],i=js(r,Xi(e.dtype,"int32")),o=$a(a),s=this.readSync(i.dataId),c=this.readSync(e.dataId),l=0;l<s.length;++l){for(var u=l*o,h=0,d=0;d<o;++d)h+=c[u+d];s[l]=h}return i},t.prototype.prod=function(e,t){pg(e,"sum");for(var n=bs(e.shape,t),r=n[0],a=n[1],i=js(r,Xi(e.dtype,"int32")),o=$a(a),s=this.readSync(i.dataId),c=this.readSync(e.dataId),l=0;l<s.length;++l){for(var u=l*o,h=1,d=0;d<o;++d)h*=c[u+d];s[l]=h}return i},t.prototype.unsortedSegmentSum=function(e,t,n){pg(e,"unsortedSegmentSum");for(var r=[],a=e.rank-t.rank,i=0;i<a;++i)t=t.expandDims(i+1);for(i=0;i<n;++i){var o=Fs(i,"int32"),s=Qf(o,t).asType("float32").mul(e).sum(0);r.push(s)}return Ac(r)},t.prototype.argMin=function(e,t){pg(e,"argMin");var n=[t];xs("argMin",n,e.rank);for(var r=bs(e.shape,n),a=r[0],i=r[1],o=js(a,"int32"),s=$a(i),c=this.readSync(o.dataId),l=this.readSync(e.dataId),u=0;u<c.length;++u){for(var h=u*s,d=l[h],f=0,p=0;p<s;++p){var m=l[h+p];m<d&&(d=m,f=p)}c[u]=f}return o},t.prototype.argMax=function(e,t){pg(e,"argMax");var n=[t];xs("argMax",n,e.rank);for(var r=bs(e.shape,n),a=r[0],i=r[1],o=js(a,"int32"),s=$a(i),c=this.readSync(o.dataId),l=this.readSync(e.dataId),u=0;u<c.length;++u){for(var h=u*s,d=l[h],f=0,p=0;p<s;++p){var m=l[h+p];m>d&&(d=m,f=p)}c[u]=f}return o},t.prototype.cumsum=function(e,t,n,r){if(pg(e,"cumsum"),t!==e.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(e.rank-1)+" but got axis="+t);for(var a=Xi(e.dtype,"int32"),i=js(e.shape,a),o=this.readSync(i.dataId),s=this.readSync(e.dataId),c=e.shape[e.rank-1],l=r?function(e,t){return e+c-t-1}:function(e,t){return e+t},u=0;u<s.length;u+=c)for(var h=0;h<c;h++){var d=l(u,h);if(0===h)o[d]=n?0:s[d];else{var f=l(u,h-1);o[d]=n?s[f]+o[f]:s[d]+o[f]}}return i},t.prototype.equal=function(e,t){return pg([e,t],"equal"),this.broadcastedBinaryOp(e,t,"bool",function(e,t){return e===t?1:0})},t.prototype.notEqual=function(e,t){return pg([e,t],"notEqual"),this.broadcastedBinaryOp(e,t,"bool",function(e,t){return e!==t?1:0})},t.prototype.less=function(e,t){return pg([e,t],"less"),this.broadcastedBinaryOp(e,t,"bool",function(e,t){return e<t?1:0})},t.prototype.lessEqual=function(e,t){return pg([e,t],"lessEqual"),this.broadcastedBinaryOp(e,t,"bool",function(e,t){return e<=t?1:0})},t.prototype.greater=function(e,t){return pg([e,t],"greater"),this.broadcastedBinaryOp(e,t,"bool",function(e,t){return e>t?1:0})},t.prototype.greaterEqual=function(e,t){return pg([e,t],"greaterEqual"),this.broadcastedBinaryOp(e,t,"bool",function(e,t){return e>=t?1:0})},t.prototype.logicalNot=function(e){pg(e,"logicalNot");for(var t=this.readSync(e.dataId),n=new Uint8Array(t.length),r=0;r<t.length;++r)n[r]=t[r]?0:1;return this.makeOutput(n,e.shape,"bool")},t.prototype.logicalAnd=function(e,t){return pg([e,t],"logicalAnd"),this.broadcastedBinaryOp(e,t,"bool",function(e,t){return e&&t})},t.prototype.logicalOr=function(e,t){return pg([e,t],"logicalOr"),this.broadcastedBinaryOp(e,t,"bool",function(e,t){return e||t})},t.prototype.select=function(e,t,n){pg([e,t,n],"select");for(var r=this.readSync(e.dataId),a=this.readSync(t.dataId),i=this.readSync(n.dataId),o=js(t.shape,Xi(t.dtype,n.dtype)),s=this.readSync(o.dataId),c=0,l=0===e.rank||e.rank>1||1===t.rank?1:$a(t.shape.slice(1)),u=0;u<r.length;u++)for(var h=0;h<l;h++)1===r[u]?s[c++]=a[u]:s[c++]=i[u];return o},t.prototype.where=function(e){pg([e],"where");var t=this.readSync(e.dataId);return Pl(e.shape,t)},t.prototype.topk=function(e,t,n){return pg(e,"topk"),Ll(this.readSync(e.dataId),e.shape,e.dtype,t)},t.prototype.min=function(e,t){pg(e,"min"),xs("min",t,e.rank);for(var n=bs(e.shape,t),r=n[0],a=n[1],i=js(r,e.dtype),o=$a(a),s=this.readSync(i.dataId),c=this.readSync(e.dataId),l=0;l<s.length;++l){for(var u=l*o,h=c[u],d=0;d<o;++d){var f=c[u+d];f<h&&(h=f)}s[l]=h}return i},t.prototype.minimum=function(e,t){return pg([e,t],"minimum"),this.broadcastedBinaryOp(e,t,e.dtype,function(e,t){return Math.min(e,t)})},t.prototype.mod=function(e,t){return pg([e,t],"mod"),this.broadcastedBinaryOp(e,t,e.dtype,function(e,t){var n=e%t;return e<0&&t<0||e>=0&&t>=0?n:(n+t)%t})},t.prototype.max=function(e,t){pg(e,"max"),xs("max",t,e.rank);for(var n=bs(e.shape,t),r=n[0],a=n[1],i=js(r,e.dtype),o=$a(a),s=this.readSync(i.dataId),c=this.readSync(e.dataId),l=0;l<s.length;++l){for(var u=l*o,h=c[u],d=0;d<o;++d){var f=c[u+d];f>h&&(h=f)}s[l]=h}return i},t.prototype.maximum=function(e,t){return pg([e,t],"maximum"),this.broadcastedBinaryOp(e,t,e.dtype,function(e,t){return Math.max(e,t)})},t.prototype.all=function(e,t){pg(e,"all"),xs("all",t,e.rank);for(var n=bs(e.shape,t),r=n[0],a=n[1],i=js(r,e.dtype),o=$a(a),s=this.readSync(i.dataId),c=this.readSync(e.dataId),l=0;l<s.length;++l){for(var u=l*o,h=c[u],d=0;d<o;++d){var f=c[u+d];h=h&&f}s[l]=h}return i},t.prototype.any=function(e,t){pg(e,"any"),xs("any",t,e.rank);for(var n=bs(e.shape,t),r=n[0],a=n[1],i=js(r,e.dtype),o=$a(a),s=this.readSync(i.dataId),c=this.readSync(e.dataId),l=0;l<s.length;++l){for(var u=l*o,h=c[u],d=0;d<o;++d){var f=c[u+d];h=h||f}s[l]=h}return i},t.prototype.squaredDifference=function(e,t){return pg([e,t],"squaredDifference"),this.broadcastedBinaryOp(e,t,e.dtype,function(e,t){var n=e-t;return n*n})},t.prototype.ceil=function(e){pg(e,"ceil");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=Math.ceil(t[r]);return this.makeOutput(n,e.shape,"float32")},t.prototype.floor=function(e){pg(e,"floor");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=Math.floor(t[r]);return this.makeOutput(n,e.shape,"float32")},t.prototype.sign=function(e){pg(e,"x");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)t[r]<0?n[r]=-1:t[r]>0?n[r]=1:n[r]=0;return this.makeOutput(n,e.shape,"float32")},t.prototype.isNaN=function(e){pg(e,"x");for(var t=this.readSync(e.dataId),n=new Uint8Array(t.length),r=0;r<t.length;++r)Number.isNaN(t[r])&&(n[r]=1);return this.makeOutput(n,e.shape,"bool")},t.prototype.isInf=function(e){pg(e,"x");for(var t=this.readSync(e.dataId),n=new Uint8Array(t.length),r=0;r<t.length;++r)Math.abs(t[r])===1/0&&(n[r]=1);return this.makeOutput(n,e.shape,"bool")},t.prototype.isFinite=function(e){pg(e,"x");for(var t=this.readSync(e.dataId),n=new Uint8Array(t.length),r=0;r<t.length;++r)Number.isFinite(t[r])&&(n[r]=1);return this.makeOutput(n,e.shape,"bool")},t.prototype.round=function(e){pg(e,"round");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r){var a=Math.floor(t[r]);t[r]-a<.5?n[r]=Math.floor(t[r]):t[r]-a>.5?n[r]=Math.ceil(t[r]):n[r]=a%2==0?a:a+1}return this.makeOutput(n,e.shape,"float32")},t.prototype.exp=function(e){pg(e,"exp");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=Math.exp(t[r]);return this.makeOutput(n,e.shape,"float32")},t.prototype.expm1=function(e){pg(e,"expm1");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=Math.expm1(t[r]);return this.makeOutput(n,e.shape,"float32")},t.prototype.log=function(e){pg(e,"log");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r){var a=t[r];n[r]=Math.log(a)}return this.makeOutput(n,e.shape,"float32")},t.prototype.log1p=function(e){pg(e,"log1p");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r){var a=t[r];n[r]=Math.log1p(a)}return this.makeOutput(n,e.shape,"float32")},t.prototype.sqrt=function(e){pg(e,"sqrt");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r){var a=t[r];n[r]=Math.sqrt(a)}return this.makeOutput(n,e.shape,"float32")},t.prototype.rsqrt=function(e){pg(e,"rsqrt");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r){var a=t[r];n[r]=1/Math.sqrt(a)}return this.makeOutput(n,e.shape,"float32")},t.prototype.reciprocal=function(e){pg(e,"reciprocal");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=1/t[r];return this.makeOutput(n,e.shape,"float32")},t.prototype.linear=function(e){return e},t.prototype.relu=function(e){pg(e,"relu");for(var t=js(e.shape,e.dtype),n=this.readSync(t.dataId),r=this.readSync(e.dataId),a=0;a<r.length;++a)n[a]=Math.max(0,r[a]);return t},t.prototype.relu6=function(e){pg(e,"relu");for(var t=js(e.shape,e.dtype),n=this.readSync(t.dataId),r=this.readSync(e.dataId),a=0;a<r.length;++a)n[a]=Math.min(Math.max(0,r[a]),6);return t},t.prototype.prelu=function(e,t){return pg([e,t],"prelu"),this.broadcastedBinaryOp(e,t,e.dtype,function(e,t){return e<0?t*e:e})},t.prototype.elu=function(e){pg(e,"elu");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r){var a=n[r];t[r]=a>=0?a:Math.exp(a)-1}return this.makeOutput(t,e.shape,"float32")},t.prototype.eluDer=function(e,t){pg([e,t],"eluDer");for(var n=new Float32Array(t.size),r=this.readSync(t.dataId),a=this.readSync(e.dataId),i=0;i<r.length;++i){var o=r[i];n[i]=o>=1?a[i]:a[i]*(o+1)}return this.makeOutput(n,t.shape,"float32")},t.prototype.selu=function(e){pg(e,"selu");for(var t=$h,n=Jh,r=new Float32Array(e.size),a=this.readSync(e.dataId),i=0;i<a.length;++i){var o=a[i];r[i]=o>=0?n*o:t*(Math.exp(o)-1)}return this.makeOutput(r,e.shape,"float32")},t.prototype.clip=function(e,t,n){pg(e,"clip");for(var r=new Float32Array(e.size),a=this.readSync(e.dataId),i=0;i<a.length;++i){var o=a[i];r[i]=o>n?n:o<t?t:o}return this.makeOutput(r,e.shape,"float32")},t.prototype.abs=function(e){for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.abs(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.complexAbs=function(e){for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<e.size;++r){var a=n[2*r],i=n[2*r+1];t[r]=Math.hypot(a,i)}return this.makeOutput(t,e.shape,"float32")},t.prototype.int=function(e){pg(e,"int");for(var t=new Int32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=n[r];return this.makeOutput(t,e.shape,"int32")},t.prototype.sigmoid=function(e){pg(e,"sigmoid");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=1/(1+Math.exp(-n[r]));return this.makeOutput(t,e.shape,"float32")},t.prototype.softplus=function(e){pg(e,"softplus");for(var t=Math.log(1.1920928955078125e-7)+2,n=new Float32Array(e.size),r=this.readSync(e.dataId),a=0;a<r.length;++a){var i,o=r[a]>-t,s=r[a]<t,c=Math.exp(r[a]);i=s?c:o?r[a]:Math.log(1+c),n[a]=i}return this.makeOutput(n,e.shape,"float32")},t.prototype.sin=function(e){pg(e,"sin");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.sin(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.cos=function(e){pg(e,"cos");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.cos(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.tan=function(e){pg(e,"tan");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.tan(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.asin=function(e){pg(e,"asin");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.asin(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.acos=function(e){pg(e,"acos");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.acos(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.atan=function(e){pg(e,"atan");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.atan(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.atan2=function(e,t){return pg([e,t],"atan2"),this.broadcastedBinaryOp(e,t,e.dtype,function(e,t){return Math.atan2(e,t)})},t.prototype.sinh=function(e){pg(e,"sinh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.sinh(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.cosh=function(e){pg(e,"cosh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.cosh(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.tanh=function(e){pg(e,"tanh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Za(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.asinh=function(e){pg(e,"asinh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.asinh(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.acosh=function(e){pg(e,"acosh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.acosh(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.atanh=function(e){pg(e,"atanh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.atanh(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.erf=function(e){pg(e,"erf");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r){var a=Math.sign(n[r]),i=Math.abs(n[r]),o=1/(1+.3275911*i);t[r]=a*(1-((((1.061405429*o-1.453152027)*o+1.421413741)*o-.284496736)*o+.254829592)*o*Math.exp(-i*i))}return this.makeOutput(t,e.shape,"float32")},t.prototype.step=function(e,t){void 0===t&&(t=0),pg(e,"step");for(var n=new Float32Array(e.size),r=this.readSync(e.dataId),a=0;a<r.length;++a){var i=r[a];isNaN(i)?n[a]=NaN:n[a]=i>0?1:t}return this.makeOutput(n,e.shape,"float32")},t.prototype.fusedConv2d=function(e){var t=e.input,n=e.filter,r=e.convInfo,a=e.bias,i=e.activation,o=e.preluActivationWeights,s=this.conv2d(t,n,r);return a&&(s=this.add(s,a)),i&&(s=mg(this,s,i,o)),s},t.prototype.conv2d=function(e,t,n){pg([e,t],"conv2d");for(var r=n.filterHeight,a=n.filterWidth,i=n.dilationHeight,o=n.dilationWidth,s=n.padInfo.left,c=n.padInfo.top,l="channelsLast"===n.dataFormat,u=sc(n.outShape,e.dtype),h=e.strides[0],d=l?e.strides[1]:e.strides[2],f=l?e.strides[2]:1,p=l?1:e.strides[1],m=u.strides[0],g=l?u.strides[1]:u.strides[2],v=l?u.strides[2]:1,b=l?1:u.strides[1],y=this.readSync(e.dataId),x=this.readSync(t.dataId),w=u.values,k=0;k<n.batchSize;++k)for(var S=k*h,N=k*m,C=0;C<n.outHeight;++C)for(var E=N+C*g,I=C*n.strideHeight-c,T=0;T<r;T++){var _=I+T*i;if(!(_<0||_>=n.inHeight))for(var A=T*t.strides[0],R=S+_*d,F=0;F<n.outWidth;++F)for(var D=E+F*v,O=F*n.strideWidth-s,L=0;L<a;L++){var P=O+L*o;if(!(P<0||P>=n.inWidth))for(var M=R+P*f,j=A+L*t.strides[1],B=0;B<n.inChannels;++B){for(var z=y[M+B*p],U=0;U<n.outChannels;++U)w[D+U*b]+=z*x[j+U];j+=n.outChannels}}}return u.toTensor()},t.prototype.conv3d=function(e,t,n){for(var r=n.filterDepth,a=n.filterHeight,i=n.filterWidth,o=n.dilationDepth,s=n.dilationHeight,c=n.dilationWidth,l=n.padInfo.front,u=n.padInfo.left,h=n.padInfo.top,d=sc(n.outShape,e.dtype),f=this.readSync(e.dataId),p=this.readSync(t.dataId),m=d.values,g=0;g<n.batchSize;++g)for(var v=g*e.strides[0],b=g*d.strides[0],y=0;y<n.outDepth;++y)for(var x=b+y*d.strides[1],w=y*n.strideDepth-l,k=0;k<r;k++){var S=w+k*o;if(!(S<0||S>=n.inDepth))for(var N=k*t.strides[0],C=v+S*e.strides[1],E=0;E<n.outHeight;++E)for(var I=x+E*d.strides[2],T=E*n.strideHeight-h,_=0;_<a;_++){var A=T+_*s;if(!(A<0||A>=n.inHeight))for(var R=N+_*t.strides[1],F=C+A*e.strides[2],D=0;D<n.outWidth;++D)for(var O=I+D*n.outChannels,L=D*n.strideWidth-u,P=0;P<i;P++){var M=L+P*c;if(!(M<0||M>=n.inWidth))for(var j=R+P*t.strides[2],B=F+M*n.inChannels,z=j,U=0;U<n.inChannels;++U){for(var W=f[B+U],V=0;V<n.outChannels;++V)m[O+V]+=W*p[z+V];z+=n.outChannels}}}}return d.toTensor()},t.prototype.conv2dDerInput=function(e,t,n){pg([e,t],"conv2dDerInput");for(var r=sc(n.inShape,"float32"),a=r.values,i=this.readSync(e.dataId),o=this.readSync(t.dataId),s=t.strides,c=s[0],l=s[1],u=s[2],h=n.batchSize,d=n.filterHeight,f=n.filterWidth,p=n.inChannels,m=n.inHeight,g=n.inWidth,v=n.outChannels,b=n.outHeight,y=n.outWidth,x=n.strideHeight,w=n.strideWidth,k=n.dataFormat,S=d-1-n.padInfo.top,N=f-1-n.padInfo.left,C="channelsLast"===k,E=r.strides[0],I=C?r.strides[1]:r.strides[2],T=C?r.strides[2]:1,_=C?1:r.strides[1],A=e.strides[0],R=C?e.strides[1]:e.strides[2],F=C?e.strides[2]:1,D=C?1:e.strides[1],O=0;O<h;++O)for(var L=0;L<p;++L)for(var P=0;P<m;++P)for(var M=P-S,j=Math.max(0,Math.ceil(M/x)),B=Math.min(b,(d+M)/x),z=0;z<g;++z){for(var U=z-N,W=Math.max(0,Math.ceil(U/w)),V=Math.min(y,(f+U)/w),H=0,G=j;G<B;++G)for(var q=G*x-M,K=W;K<V;++K)for(var X=A*O+R*G+F*K,Y=c*(d-1-q)+l*(f-1-(K*w-U))+u*L,$=0;$<v;++$)H+=i[X+D*$]*o[Y+$];a[E*O+I*P+T*z+_*L]=H}return r.toTensor()},t.prototype.conv3dDerInput=function(e,t,n){for(var r=sc(n.inShape,"float32"),a=r.values,i=r.strides,o=i[0],s=i[1],c=i[2],l=i[3],u=this.readSync(e.dataId),h=e.strides,d=h[0],f=h[1],p=h[2],m=h[3],g=this.readSync(t.dataId),v=t.strides,b=v[0],y=v[1],x=v[2],w=v[3],k=n.batchSize,S=n.filterDepth,N=n.filterHeight,C=n.filterWidth,E=n.inChannels,I=n.inDepth,T=n.inHeight,_=n.inWidth,A=n.outChannels,R=n.outDepth,F=n.outHeight,D=n.outWidth,O=n.strideDepth,L=n.strideHeight,P=n.strideWidth,M=S-1-n.padInfo.front,j=N-1-n.padInfo.top,B=C-1-n.padInfo.left,z=0;z<k;++z)for(var U=0;U<E;++U)for(var W=0;W<I;++W)for(var V=W-M,H=Math.max(0,Math.ceil(V/O)),G=Math.min(R,(S+V)/O),q=0;q<T;++q)for(var K=q-j,X=Math.max(0,Math.ceil(K/L)),Y=Math.min(F,(N+K)/L),$=0;$<_;++$){for(var J=$-B,Q=Math.max(0,Math.ceil(J/P)),Z=Math.min(D,(C+J)/P),ee=0,te=H;te<G;++te)for(var ne=te*O-V,re=X;re<Y;++re)for(var ae=re*L-K,ie=Q;ie<Z;++ie)for(var oe=d*z+f*te+p*re+m*ie,se=b*(S-1-ne)+y*(N-1-ae)+x*(C-1-(ie*P-J))+w*U,ce=0;ce<A;++ce)ee+=u[oe+ce]*g[se+ce];a[o*z+s*W+c*q+l*$+U]=ee}return r.toTensor()},t.prototype.conv2dDerFilter=function(e,t,n){pg([e,t],"conv2dDerFilter");for(var r=n.strideHeight,a=n.strideWidth,i=n.filterHeight,o=n.filterWidth,s="channelsLast"===n.dataFormat,c=sc(n.filterShape,"float32"),l=n.padInfo.left,u=n.padInfo.top,h=this.bufferSync(e),d=this.bufferSync(t),f=0;f<i;++f)for(var p=Math.max(0,Math.ceil((u-f)/r)),m=Math.min(n.outHeight,(n.inHeight+u-f)/r),g=0;g<o;++g)for(var v=Math.max(0,Math.ceil((l-g)/a)),b=Math.min(n.outWidth,(n.inWidth+l-g)/a),y=0;y<n.inChannels;++y)for(var x=0;x<n.outChannels;++x){for(var w=0,k=0;k<n.batchSize;++k)for(var S=p;S<m;++S)for(var N=f+S*r-u,C=v;C<b;++C){var E=g+C*a-l;w+=s?h.get(k,N,E,y)*d.get(k,S,C,x):h.get(k,y,N,E)*d.get(k,x,S,C)}c.set(w,f,g,y,x)}return c.toTensor()},t.prototype.conv3dDerFilter=function(e,t,n){for(var r=n.strideDepth,a=n.strideHeight,i=n.strideWidth,o=n.filterDepth,s=n.filterHeight,c=n.filterWidth,l=sc(n.filterShape,"float32"),u=l.values,h=l.strides,d=h[0],f=h[1],p=h[2],m=h[3],g=this.readSync(t.dataId),v=t.strides,b=v[0],y=v[1],x=v[2],w=v[3],k=this.readSync(e.dataId),S=e.strides,N=S[0],C=S[1],E=S[2],I=S[3],T=n.padInfo.front,_=n.padInfo.left,A=n.padInfo.top,R=0;R<o;++R)for(var F=Math.max(0,Math.ceil((T-R)/r)),D=Math.min(n.outDepth,(n.inDepth+T-R)/r),O=R*d,L=0;L<s;++L)for(var P=Math.max(0,Math.ceil((A-L)/a)),M=Math.min(n.outHeight,(n.inHeight+A-L)/a),j=L*f+O,B=0;B<c;++B)for(var z=Math.max(0,Math.ceil((_-B)/i)),U=Math.min(n.outWidth,(n.inWidth+_-B)/i),W=B*p+j,V=0;V<n.inChannels;++V)for(var H=V*m+W,G=0;G<n.outChannels;++G){for(var q=0,K=0;K<n.batchSize;++K)for(var X=K*N,Y=K*b,$=F;$<D;++$)for(var J=(R+$*r-T)*C+X,Q=$*y+Y,Z=P;Z<M;++Z)for(var ee=(L+Z*a-A)*E+J,te=Z*x+Q,ne=z;ne<U;++ne){var re=ne*w+te;q+=k[(B+ne*i-_)*I+ee+V]*g[re+G]}u[H+G]=q}return l.toTensor()},t.prototype.fusedDepthwiseConv2D=function(e){var t=e.input,n=e.filter,r=e.convInfo,a=e.bias,i=e.activation,o=e.preluActivationWeights,s=this.depthwiseConv2D(t,n,r);return a&&(s=this.add(s,a)),i&&(s=mg(this,s,i,o)),s},t.prototype.depthwiseConv2D=function(e,t,n){pg([e,t],"depthwiseConv2D");for(var r=n.filterHeight,a=n.filterWidth,i=n.dilationHeight,o=n.dilationWidth,s=n.padInfo.left,c=n.padInfo.top,l=n.outChannels/n.inChannels,u=sc(n.outShape,e.dtype),h=this.readSync(e.dataId),d=this.readSync(t.dataId),f=u.values,p=0;p<n.batchSize;++p)for(var m=p*e.strides[0],g=p*u.strides[0],v=0;v<n.outHeight;++v)for(var b=g+v*u.strides[1],y=v*n.strideHeight-s,x=0;x<r;++x){var w=y+x*i;if(!(w<0||w>=n.inHeight))for(var k=x*t.strides[0],S=m+w*e.strides[1],N=0;N<n.outWidth;++N)for(var C=b+N*u.strides[2],E=N*n.strideWidth-c,I=0;I<a;++I){var T=E+I*o;if(!(T<0||T>=n.inWidth))for(var _=k+I*t.strides[1],A=S+T*n.inChannels,R=C,F=_,D=0;D<n.inChannels;++D){for(var O=h[A+D],L=0;L<l;++L)f[R+L]+=O*d[F+L];R+=l,F+=l}}}return u.toTensor()},t.prototype.depthwiseConv2DDerInput=function(e,t,n){pg([e,t],"depthwiseConv2DDerInput");for(var r=sc(n.inShape,"float32"),a=r.values,i=r.strides,o=i[0],s=i[1],c=i[2],l=this.readSync(e.dataId),u=e.strides,h=u[0],d=u[1],f=u[2],p=this.readSync(t.dataId),m=t.strides,g=m[0],v=m[1],b=m[2],y=n.batchSize,x=n.filterHeight,w=n.filterWidth,k=n.inChannels,S=n.inHeight,N=n.inWidth,C=n.outChannels,E=n.outHeight,I=n.outWidth,T=n.strideHeight,_=n.strideWidth,A=x-1-n.padInfo.top,R=w-1-n.padInfo.left,F=C/k,D=0;D<y;++D)for(var O=0;O<k;++O)for(var L=0;L<S;++L)for(var P=L-A,M=Math.max(0,Math.ceil(P/T)),j=Math.min(E,(x+P)/T),B=0;B<N;++B){for(var z=B-R,U=Math.max(0,Math.ceil(z/_)),W=Math.min(I,(w+z)/_),V=0,H=M;H<j;++H)for(var G=H*T-P,q=U;q<W;++q)for(var K=h*D+d*H+f*q,X=g*(x-1-G)+v*(w-1-(q*_-z))+b*O,Y=0;Y<F;++Y)V+=l[K+(O*F+Y)]*p[X+Y];a[o*D+s*L+c*B+O]=V}return r.toTensor()},t.prototype.depthwiseConv2DDerFilter=function(e,t,n){pg([e,t],"depthwiseConv2DDerFilter");for(var r=n.strideHeight,a=n.strideWidth,i=n.filterHeight,o=n.filterWidth,s=sc(n.filterShape,"float32"),c=n.padInfo.left,l=n.padInfo.top,u=n.outChannels/n.inChannels,h=this.bufferSync(e),d=this.bufferSync(t),f=0;f<i;++f)for(var p=Math.max(0,Math.ceil((l-f)/r)),m=Math.min(n.outHeight,(n.inHeight+l-f)/r),g=0;g<o;++g)for(var v=Math.max(0,Math.ceil((c-g)/a)),b=Math.min(n.outWidth,(n.inWidth+c-g)/a),y=0;y<n.outChannels;++y){for(var x=Math.trunc(y/u),w=y%u,k=0,S=0;S<n.batchSize;++S)for(var N=p;N<m;++N)for(var C=f+N*r-l,E=v;E<b;++E){var I=g+E*a-c;k+=h.get(S,C,I,x)*d.get(S,N,E,y)}s.set(k,f,g,x,w)}return s.toTensor()},t.prototype.tile=function(e,t){return pg(e,"tile"),Ol(this.bufferSync(e),t)},t.prototype.pad=function(e,t,n){pg(e,"pad");var r=t.map(function(t,n){return t[0]+e.shape[n]+t[1]}),a=t.map(function(e){return e[0]}),i=this.bufferSync(e),o=sc(r,e.dtype);0!==n&&o.values.fill(n);for(var s=0;s<e.size;s++){var c=i.indexToLoc(s),l=c.map(function(e,t){return e+a[t]});o.set.apply(o,[i.get.apply(i,c)].concat(l))}return o.toTensor()},t.prototype.transpose=function(e,t){pg(e,"transpose");for(var n=new Array(e.rank),r=0;r<n.length;r++)n[r]=e.shape[t[r]];var a=this.readSync(e.dataId),i=sc(n,e.dtype),o=this.bufferSync(e);for(r=0;r<e.size;++r){for(var s=o.indexToLoc(r),c=new Array(s.length),l=0;l<c.length;l++)c[l]=s[t[l]];var u=i.locToIndex(c);i.values[u]=a[r]}return i.toTensor()},t.prototype.gather=function(e,t,n){pg([e,t],"gather");var r=e.shape.slice(),a=this.readSync(t.dataId);r[n]=a.length;for(var i=sc(r,e.dtype),o=this.bufferSync(e),s=0;s<i.size;++s){var c=i.indexToLoc(s),l=c.slice();l[n]=a[c[n]];var u=o.locToIndex(l);i.values[s]=o.values[u]}return i.toTensor()},t.prototype.batchToSpaceND=function(e,t,n){pg([e],"batchToSpaceND");var r=t.reduce(function(e,t){return e*t}),a=Oc(e.shape,t,r),i=Lc(a.length,t.length),o=Pc(e.shape,t,r),s=Mc(n,t.length),c=jc(o,n,t.length);return e.reshape(a).transpose(i).reshape(o).slice(s,c)},t.prototype.spaceToBatchND=function(e,t,n){pg([e],"spaceToBatchND");var r=t.reduce(function(e,t){return e*t}),a=[[0,0]];a.push.apply(a,n);for(var i=1+t.length;i<e.shape.length;++i)a.push([0,0]);var o=e.pad(a),s=Oc(o.shape,t,r,!1),c=Lc(s.length,t.length,!1),l=Pc(o.shape,t,r,!1);return o.reshape(s).transpose(c).reshape(l)},t.prototype.pool=function(e,t,n){pg(e,"pool");for(var r=t.strideHeight,a=t.strideWidth,i=t.dilationHeight,o=t.dilationWidth,s=t.effectiveFilterHeight,c=t.effectiveFilterWidth,l=t.padInfo.top,u=t.padInfo.left,h="max"===n?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,d=this.readSync(e.dataId),f=sc(t.outShape,e.dtype),p=f.values,m=t.outShape[1]*t.outShape[2]*t.outShape[3],g=t.outShape[2]*t.outShape[3],v=t.outShape[3],b=0;b<t.batchSize;++b)for(var y=b*m,x=b*e.strides[0],w=0;w<t.inChannels;++w)for(var k=0;k<t.outHeight;++k)for(var S=k*r-l,N=Math.max(0,S),C=Math.min(t.inHeight,s+S),E=y+k*g,I=0;I<t.outWidth;++I){for(var T=I*a-u,_=Math.max(0,T),A=Math.min(t.inWidth,c+T),R=h,F=0,D=0,O=N;O<C;O+=i){for(var L=x+O*e.strides[1],P=_;P<A;P+=o){var M=d[L+P*e.strides[2]+w];"max"===n&&M>R?R=M:"avg"===n&&(F+=M,D++)}if(isNaN(R))break}p[E+I*v+w]="avg"===n?F/D:R}return f.toTensor()},t.prototype.maxPool=function(e,t){return this.pool(e,t,"max")},t.prototype.maxPoolPositions=function(e,t){for(var n=sc(t.outShape,"int32"),r=t.strideHeight,a=t.strideWidth,i=t.dilationHeight,o=t.dilationWidth,s=t.effectiveFilterHeight,c=t.effectiveFilterWidth,l=t.padInfo.top,u=t.padInfo.left,h=this.bufferSync(e),d=0;d<t.batchSize;++d)for(var f=0;f<t.inChannels;++f)for(var p=0;p<t.outHeight;++p){for(var m=p*r-l,g=m;g<0;)g+=i;for(var v=Math.min(t.inHeight,s+m),b=0;b<t.outWidth;++b){for(var y=b*a-u,x=y;x<0;)x+=o;for(var w=Math.min(t.inWidth,c+y),k=Number.NEGATIVE_INFINITY,S=-1,N=g;N<v;N+=i)for(var C=N-m,E=x;E<w;E+=o){var I=E-y,T=h.get(d,N,E,f);T>k&&(k=T,S=C*c+I)}n.set(S,d,p,b,f)}}return n.toTensor()},t.prototype.maxPoolBackprop=function(e,t,n,r){pg([t,n],"maxPoolBackprop");for(var a=this.maxPoolPositions(t,r),i=r.strideHeight,o=r.strideWidth,s=r.dilationHeight,c=r.dilationWidth,l=r.effectiveFilterHeight,u=r.effectiveFilterWidth,h=u-1-r.padInfo.left,d=l-1-r.padInfo.top,f=sc(t.shape,"float32"),p=this.bufferSync(a),m=this.bufferSync(e),g=0;g<r.batchSize;++g)for(var v=0;v<r.inChannels;++v)for(var b=0;b<r.inHeight;++b)for(var y=0;y<r.inWidth;++y){for(var x=b-d,w=y-h,k=0,S=0;S<l;S+=s){var N=(x+S)/i;if(!(N<0||N>=r.outHeight||Math.floor(N)!==N))for(var C=0;C<u;C+=c){var E=(w+C)/o;if(!(E<0||E>=r.outWidth||Math.floor(E)!==E)){var I=l*u-1-p.get(g,N,E,v)===S*u+C?1:0;0!==I&&(k+=m.get(g,N,E,v)*I)}}}f.set(k,g,b,y,v)}return f.toTensor()},t.prototype.avgPoolBackprop=function(e,t,n){pg([e,t],"avgPoolBackprop");for(var r=n.strideHeight,a=n.strideWidth,i=n.filterHeight,o=n.filterWidth,s=n.dilationHeight,c=n.dilationWidth,l=n.effectiveFilterHeight,u=n.effectiveFilterWidth,h=u-1-n.padInfo.left,d=l-1-n.padInfo.top,f=sc(t.shape,"float32"),p=1/(i*o),m=this.bufferSync(e),g=0;g<n.batchSize;++g)for(var v=0;v<n.inChannels;++v)for(var b=0;b<n.inHeight;++b)for(var y=0;y<n.inWidth;++y){for(var x=b-d,w=y-h,k=0,S=0;S<l;S+=s){var N=(x+S)/r;if(!(N<0||N>=n.outHeight||Math.floor(N)!==N))for(var C=0;C<u;C+=c){var E=(w+C)/a;E<0||E>=n.outWidth||Math.floor(E)!==E||(k+=m.get(g,N,E,v))}}f.set(k*p,g,b,y,v)}return f.toTensor()},t.prototype.pool3d=function(e,t,n){pg(e,"pool3d");for(var r=t.strideDepth,a=t.strideHeight,i=t.strideWidth,o=t.dilationDepth,s=t.dilationHeight,c=t.dilationWidth,l=t.effectiveFilterDepth,u=t.effectiveFilterHeight,h=t.effectiveFilterWidth,d=t.padInfo.front,f=t.padInfo.top,p=t.padInfo.left,m="max"===n?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,g=this.readSync(e.dataId),v=sc(t.outShape,e.dtype),b=v.values,y=t.outShape[1]*t.outShape[2]*t.outShape[3]*t.outShape[4],x=t.outShape[2]*t.outShape[3]*t.outShape[4],w=t.outShape[3]*t.outShape[4],k=t.outShape[4],S=0;S<t.batchSize;++S)for(var N=S*y,C=S*e.strides[0],E=0;E<t.inChannels;++E)for(var I=0;I<t.outDepth;++I){for(var T=I*r-d,_=T;_<0;)_+=o;for(var A=Math.min(t.inDepth,l+T),R=N+I*x,F=0;F<t.outHeight;++F){for(var D=F*a-f,O=D;O<0;)O+=s;for(var L=Math.min(t.inHeight,u+D),P=R+F*w,M=0;M<t.outWidth;++M){for(var j=M*i-p,B=j;B<0;)B+=c;for(var z=Math.min(t.inWidth,h+j),U=P+M*k,W=m,V=0,H=0,G=_;G<A;G+=o){for(var q=C+G*e.strides[1],K=O;K<L;K+=s){for(var X=q+K*e.strides[2],Y=B;Y<z;Y+=c){var $=g[X+Y*e.strides[3]+E];if("max"===n&&$>W?W=$:"avg"===n&&(V+=$,H++),isNaN(W))break}if(isNaN(W))break}if(isNaN(W))break}b[U+E]="avg"===n?V/H:W}}}return v.toTensor()},t.prototype.avgPool3d=function(e,t){return pg(e,"avgPool3d"),this.pool3d(e,t,"avg").toFloat()},t.prototype.avgPool3dBackprop=function(e,t,n){pg([e,t],"avgPool3dBackprop");for(var r=n.strideDepth,a=n.strideHeight,i=n.strideWidth,o=n.filterDepth,s=n.filterHeight,c=n.filterWidth,l=n.dilationDepth,u=n.dilationHeight,h=n.dilationWidth,d=n.effectiveFilterDepth,f=n.effectiveFilterHeight,p=n.effectiveFilterWidth,m=d-1-n.padInfo.front,g=p-1-n.padInfo.left,v=f-1-n.padInfo.top,b=sc(t.shape,"float32"),y=1/(o*s*c),x=this.bufferSync(e),w=0;w<n.batchSize;++w)for(var k=0;k<n.inChannels;++k)for(var S=0;S<n.inDepth;++S)for(var N=0;N<n.inHeight;++N)for(var C=0;C<n.inWidth;++C){for(var E=S-m,I=N-v,T=C-g,_=0,A=0;A<d;A+=l){var R=(E+A)/r;if(!(R<0||R>=n.outDepth||Math.floor(R)!==R))for(var F=0;F<f;F+=u){var D=(I+F)/a;if(!(D<0||D>=n.outHeight||Math.floor(D)!==D))for(var O=0;O<p;O+=h){var L=(T+O)/i;L<0||L>=n.outWidth||Math.floor(L)!==L||(_+=x.get(w,R,D,L,k))}}}b.set(_*y,w,S,N,C,k)}return b.toTensor()},t.prototype.maxPool3d=function(e,t){return pg(e,"maxPool3d"),this.pool3d(e,t,"max").toFloat()},t.prototype.maxPool3dPositions=function(e,t){for(var n=sc(t.outShape,"int32"),r=t.strideDepth,a=t.strideHeight,i=t.strideWidth,o=t.dilationDepth,s=t.dilationHeight,c=t.dilationWidth,l=t.effectiveFilterDepth,u=t.effectiveFilterHeight,h=t.effectiveFilterWidth,d=t.padInfo.front,f=t.padInfo.top,p=t.padInfo.left,m=this.bufferSync(e),g=0;g<t.batchSize;++g)for(var v=0;v<t.inChannels;++v)for(var b=0;b<t.outDepth;++b){for(var y=b*r-d,x=y;x<0;)x+=o;for(var w=Math.min(t.inDepth,l+y),k=0;k<t.outHeight;++k){for(var S=k*a-f,N=S;N<0;)N+=s;for(var C=Math.min(t.inHeight,u+S),E=0;E<t.outWidth;++E){for(var I=E*i-p,T=I;T<0;)T+=c;for(var _=Math.min(t.inWidth,h+I),A=Number.NEGATIVE_INFINITY,R=-1,F=x;F<w;F+=o)for(var D=F-y,O=N;O<C;O+=s)for(var L=O-S,P=T;P<_;P+=c){var M=P-I,j=m.get(g,F,O,P,v);j>=A&&(A=j,R=D*u*h+L*u+M)}n.set(R,g,b,k,E,v)}}}return n.toTensor()},t.prototype.maxPool3dBackprop=function(e,t,n,r){pg([t,n],"maxPool3dBackprop");for(var a=this.maxPool3dPositions(t,r),i=r.strideDepth,o=r.strideHeight,s=r.strideWidth,c=r.dilationDepth,l=r.dilationHeight,u=r.dilationWidth,h=r.effectiveFilterDepth,d=r.effectiveFilterHeight,f=r.effectiveFilterWidth,p=h-1-r.padInfo.front,m=f-1-r.padInfo.left,g=d-1-r.padInfo.top,v=sc(t.shape,"float32"),b=this.bufferSync(a),y=this.bufferSync(e),x=0;x<r.batchSize;++x)for(var w=0;w<r.inChannels;++w)for(var k=0;k<r.inDepth;++k)for(var S=0;S<r.inHeight;++S)for(var N=0;N<r.inWidth;++N){for(var C=k-p,E=S-g,I=N-m,T=0,_=0;_<h;_+=c){var A=(C+_)/i;if(!(A<0||A>=r.outDepth||Math.floor(A)!==A))for(var R=0;R<d;R+=l){var F=(E+R)/o;if(!(F<0||F>=r.outHeight||Math.floor(F)!==F))for(var D=0;D<f;D+=u){var O=(I+D)/s;if(!(O<0||O>=r.outWidth||Math.floor(O)!==O)){var L=h*d*f-1-b.get(x,A,F,O,w)===_*d*f+R*f+D?1:0;0!==L&&(T+=y.get(x,A,F,O,w)*L)}}}}v.set(T,x,k,S,N,w)}return v.toTensor()},t.prototype.cast=function(e,t){return bl(e,t,this)},t.prototype.reshape=function(e,t){return yl(e,t)},t.prototype.avgPool=function(e,t){return pg(e,"avgPool"),this.pool(e,t,"avg").toFloat()},t.prototype.resizeBilinear=function(e,t,n,r){pg(e,"resizeBilinear");for(var a=e.shape,i=a[0],o=a[1],s=a[2],c=a[3],l=this.readSync(e.dataId),u=new Float32Array($a([i,t,n,c])),h=[r&&t>1?o-1:o,r&&n>1?s-1:s],d=[r&&t>1?t-1:t,r&&n>1?n-1:n],f=0,p=h[0]/d[0],m=h[1]/d[1],g=0;g<i;g++)for(var v=0;v<t;v++)for(var b=p*v,y=Math.floor(b),x=b-y,w=Math.min(o-1,Math.ceil(b)),k=g*e.strides[0]+y*e.strides[1],S=g*e.strides[0]+w*e.strides[1],N=0;N<n;N++)for(var C=m*N,E=Math.floor(C),I=C-E,T=Math.min(s-1,Math.ceil(C)),_=k+E*e.strides[2],A=S+E*e.strides[2],R=k+T*e.strides[2],F=S+T*e.strides[2],D=0;D<c;D++){var O=l[_+D],L=l[A+D],P=O+(l[R+D]-O)*I,M=P+(L+(l[F+D]-L)*I-P)*x;u[f++]=M}return As(u,[i,t,n,c])},t.prototype.resizeBilinearBackprop=function(e,t,n){pg([e,t],"resizeBilinearBackprop");for(var r=t.shape,a=r[0],i=r[1],o=r[2],s=r[3],c=e.shape,l=c[1],u=c[2],h=new Float32Array(a*i*o*s),d=[n&&l>1?i-1:i,n&&u>1?o-1:o],f=[n&&l>1?l-1:l,n&&u>1?u-1:u],p=d[0]/f[0],m=d[1]/f[1],g=this.readSync(e.dataId),v=0,b=0;b<a;b++)for(var y=b*t.strides[0],x=0;x<l;x++)for(var w=x*p,k=Math.floor(w),S=Math.min(Math.ceil(w),i-1),N=y+k*t.strides[1],C=y+S*t.strides[1],E=w-k,I=1-E,T=0;T<u;T++)for(var _=T*m,A=Math.floor(_),R=Math.min(Math.ceil(_),o-1),F=_-A,D=1-F,O=N+A*t.strides[2],L=N+R*t.strides[2],P=C+A*t.strides[2],M=C+R*t.strides[2],j=I*D,B=I*F,z=E*D,U=E*F,W=0;W<s;W++){var V=g[v++];h[O+W]+=V*j,h[L+W]+=V*B,h[P+W]+=V*z,h[M+W]+=V*U}return Ps(h,[a,o,i,s],t.dtype)},t.prototype.resizeNearestNeighbor=function(e,t,n,r){pg(e,"resizeNearestNeighbor");for(var a=e.shape,i=a[0],o=a[1],s=a[2],c=a[3],l=this.readSync(e.dataId),u=new Float32Array(i*t*n*c),h=[r&&t>1?o-1:o,r&&n>1?s-1:s],d=[r&&t>1?t-1:t,r&&n>1?n-1:n],f=h[0]/d[0],p=h[1]/d[1],m=0,g=0;g<i;g++)for(var v=g*e.strides[0],b=0;b<t;b++)for(var y=f*b,x=v+Math.min(o-1,r?Math.round(y):Math.floor(y))*e.strides[1],w=0;w<n;w++)for(var k=p*w,S=x+Math.min(s-1,r?Math.round(k):Math.floor(k))*e.strides[2],N=0;N<c;N++){var C=l[S+N];u[m++]=C}return As(u,[i,t,n,c],e.dtype)},t.prototype.resizeNearestNeighborBackprop=function(e,t,n){pg([e,t],"resizeNearestNeighborBackprop");for(var r=t.shape,a=r[0],i=r[1],o=r[2],s=r[3],c=e.shape,l=c[1],u=c[2],h=new Float32Array(a*i*o*s),d=this.readSync(e.dataId),f=[n&&l>1?i-1:i,n&&u>1?o-1:o],p=[n&&l>1?l-1:l,n&&u>1?u-1:u],m=f[0]/p[0],g=f[1]/p[1],v=1/m,b=1/g,y=2*Math.ceil(v)+2,x=2*Math.ceil(b)+2,w=0;w<a;w++)for(var k=w*t.strides[0],S=0;S<i;S++)for(var N=k+S*t.strides[1],C=Math.floor(S*v),E=Math.floor(C-y/2),I=0;I<o;I++)for(var T=N+I*t.strides[2],_=Math.floor(I*b),A=Math.floor(_-x/2),R=0;R<s;R++){for(var F=0,D=0;D<y;D++){var O=D+E;if(!(O<0||O>=l)){var L=k+O*e.strides[1],P=O*m;if(S===Math.min(i-1,n?Math.round(P):Math.floor(P)))for(var M=0;M<x;M++){var j=M+A;if(!(j<0||j>=u)){var B=L+j*e.strides[2],z=j*g;I===Math.min(o-1,n?Math.round(z):Math.floor(z))&&(F+=d[B+R])}}}}h[T+R]=F}return Ps(h,t.shape,t.dtype)},t.prototype.batchNormalization=function(e,t,n,r,a,i){pg([e,t,n,a,i],"batchNorm");for(var o=this.readSync(e.dataId),s=this.readSync(t.dataId),c=this.readSync(n.dataId),l=a?this.readSync(a.dataId):new Float32Array([1]),u=i?this.readSync(i.dataId):new Float32Array([0]),h=new Float32Array(o.length),d=u.length,f=l.length,p=c.length,m=s.length,g=0,v=0,b=0,y=0,x=0;x<o.length;++x)h[x]=u[g++]+(o[x]-s[v++])*l[b++]/Math.sqrt(c[y++]+r),g>=d&&(g=0),v>=m&&(v=0),b>=f&&(b=0),y>=p&&(y=0);return Ps(h,e.shape)},t.prototype.localResponseNormalization4D=function(e,t,n,r,a){pg(e,"localResponseNormalization4D");var i=e.shape[3],o=i-1,s=this.readSync(e.dataId),c=e.size,l=new Float32Array(c);function u(e){for(var n=e%i,r=e-n+Math.max(0,n-t),a=e-n+Math.min(n+t,o),c=0;r<=a;r++){var l=s[r];c+=l*l}return c}for(var h=0;h<c;h++){var d=u(h),f=s[h]*Math.pow(n+r*d,-a);l[h]=f}return Ps(l,e.shape)},t.prototype.LRNGrad=function(e,t,n,r,a,i,o){pg(e,"LRNGrad");for(var s=e.shape[3],c=this.readSync(e.dataId),l=this.readSync(t.dataId),u=this.readSync(n.dataId),h=new Float32Array(e.size),d=e.size,f=0;f<d;f++){for(var p=f%s,m=f-p+Math.max(0,p-r),g=f-p+Math.min(s,p+r+1),v=0,b=m;b<g;b++)v+=Math.pow(l[b],2);for(v=i*v+a,b=m;b<g;b++){var y=-2*i*o*l[b]*u[f]/v;f===b&&(y+=Math.pow(v,-o)),y*=c[f],h[b]+=y}}return Ps(h,e.shape)},t.prototype.multinomial=function(e,t,n,r){pg(e,"multinomial");for(var a=t?e:Qc(e),i=a.shape[0],o=a.shape[1],s=js([i,n],"int32"),c=this.readSync(s.dataId),l=this.readSync(a.dataId),u=0;u<i;++u){var h=u*o,d=new Float32Array(o-1);d[0]=l[h];for(var f=1;f<d.length;++f)d[f]=d[f-1]+l[h+f];for(var p=rc(r.toString()),m=u*n,g=0;g<n;++g){var v=p();c[m+g]=d.length;for(var b=0;b<d.length;b++)if(v<d[b]){c[m+g]=b;break}}}return s},t.prototype.oneHot=function(e,t,n,r){pg(e,"oneHot");var a=new Float32Array(e.size*t);a.fill(r);for(var i=this.readSync(e.dataId),o=0;o<e.size;++o)i[o]>=0&&i[o]<t&&(a[o*t+i[o]]=n);return Os(a,[e.size,t],"int32")},t.prototype.nonMaxSuppression=function(e,t,n,r,a){return pg(e,"nonMaxSuppression"),Il(this.readSync(e.dataId),this.readSync(t.dataId),n,r,a)},t.prototype.fft=function(e){return this.fftBatch(e,!1)},t.prototype.ifft=function(e){return this.fftBatch(e,!0)},t.prototype.fftBatch=function(e,t){for(var n=e.shape[0],r=e.shape[1],a=sc(e.shape,"float32"),i=sc(e.shape,"float32"),o=Ts(e).as2D(n,r),s=_s(e).as2D(n,r),c=0;c<n;c++)for(var l=o.slice([c,0],[1,r]),u=s.slice([c,0],[1,r]),h=Is(l,u),d=this.readSync(this.fftImpl(h,t).dataId),f=0;f<r;f++){var p=kl(d,f);a.values[c*r+f]=p.real,i.values[c*r+f]=p.imag}return Is(a.toTensor(),i.toTensor()).as2D(n,r)},t.prototype.fftImpl=function(e,t){var n=e.as1D(),r=n.size;if(this.isExponentOf2(r)){var a=this.fftRadix2(n,r,t).as2D(e.shape[0],e.shape[1]);return t&&(a=Is(Ts(a).div(Fs(r)),_s(a).div(Fs(r)))),a}var i=this.readSync(e.dataId),o=function(e){for(var t=new Float32Array(e.length/2),n=new Float32Array(e.length/2),r=0;r<e.length;r+=2)t[r/2]=e[r],n[r/2]=e[r+1];return{real:t,imag:n}}(this.fourierTransformByMatmul(i,r,t));return Is(o.real,o.imag).as2D(e.shape[0],e.shape[1])},t.prototype.isExponentOf2=function(e){return 0==(e&e-1)},t.prototype.fftRadix2=function(e,t,n){if(1===t)return e;var r=this.readSync(e.dataId),a=t/2,i=function(e){for(var t=Math.ceil(e.length/4),n=new Float32Array(t),r=new Float32Array(t),a=0;a<e.length;a+=4)n[Math.floor(a/4)]=e[a],r[Math.floor(a/4)]=e[a+1];return{real:n,imag:r}}(r),o=Is(i.real,i.imag).as1D(),s=function(e){for(var t=Math.floor(e.length/4),n=new Float32Array(t),r=new Float32Array(t),a=2;a<e.length;a+=4)n[Math.floor(a/4)]=e[a],r[Math.floor(a/4)]=e[a+1];return{real:n,imag:r}}(r),c=Is(s.real,s.imag).as1D();o=this.fftRadix2(o,a,n),c=this.fftRadix2(c,a,n);var l=function(e,t){for(var n=new Float32Array(e/2),r=new Float32Array(e/2),a=0;a<Math.ceil(e/2);a++){var i=(t?2:-2)*Math.PI*(a/e);n[a]=Math.cos(i),r[a]=Math.sin(i)}return{real:n,imag:r}}(t,n),u=Is(l.real,l.imag).mul(c),h=o.add(u),d=o.sub(u),f=Ts(h).concat(Ts(d)),p=_s(h).concat(_s(d));return Is(f,p).as1D()},t.prototype.fourierTransformByMatmul=function(e,t,n){for(var r=new Float32Array(2*t),a=0;a<t;a++){for(var i=0,o=0,s=0;s<t;s++){var c=Nl(a*s,t,n),l=kl(e,s);i+=l.real*c.real-l.imag*c.imag,o+=l.real*c.imag+l.imag*c.real}n&&(i/=t,o/=t),Sl(r,i,o,a)}return r},t.prototype.depthToSpace=function(e,t,n){qa("NHWC"===n,function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+n}),qa(t>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+t});for(var r=e.shape[0],a=e.shape[1],i=e.shape[2],o=e.shape[3],s=a*t,c=i*t,l=o/(t*t),u=this.readSync(e.dataId),h=new Float32Array(r*s*c*l),d=0,f=0;f<r;++f)for(var p=0;p<s;++p)for(var m=Math.floor(p/t),g=p%t,v=0;v<c;++v)for(var b=Math.floor(v/t),y=(g*t+v%t)*l,x=0;x<l;++x){var w=x+y+o*(b+i*(m+a*f));h[d++]=u[w]}return Ps(h,[r,s,c,l])},t.prototype.broadcastedBinaryOp=function(e,t,n,r){var a=il(e.shape,t.shape),i=sc(a,n),o=this.readSync(e.dataId),s=this.readSync(t.dataId),c=rl(e.shape,a),l=rl(t.shape,a),u=i.values;if(c.length+l.length===0)for(var h=0;h<u.length;++h)u[h]=r(o[h%o.length],s[h%s.length]);else{var d=this.bufferSync(e),f=this.bufferSync(t),p=function(n){var a=i.indexToLoc(n),h=a.slice(-e.rank);c.forEach(function(e){return h[e]=0});var p=d.locToIndex(h),m=a.slice(-t.rank);l.forEach(function(e){return m[e]=0});var g=f.locToIndex(m);u[n]=r(o[p],s[g])};for(h=0;h<u.length;++h)p(h)}return i.toTensor()},t.prototype.broadcastedBinaryComplexOp=function(e,t,n){var r=il(e.shape,t.shape),a=sc(r,"float32"),i=sc(r,"float32"),o=this.readSync(e.dataId),s=this.readSync(t.dataId),c=rl(e.shape,r),l=rl(t.shape,r),u=a.values,h=i.values;if(c.length+l.length===0)for(var d=0;d<u.length;d++){var f=d%o.length,p=d%s.length,m=n(o[2*f],o[2*f+1],s[2*p],s[2*p+1]);u[d]=m.real,h[d]=m.imag}else{var g=this.bufferSync(this.data.get(e.dataId).complexTensors.real),v=this.bufferSync(this.data.get(t.dataId).complexTensors.real),b=function(r){var i=a.indexToLoc(r),d=i.slice(-e.rank);c.forEach(function(e){return d[e]=0});var f=g.locToIndex(d),p=i.slice(-t.rank);l.forEach(function(e){return p[e]=0});var m=v.locToIndex(p),b=n(o[2*f],o[2*f+1],s[2*m],s[2*m+1]);u[r]=b.real,h[r]=b.imag};for(d=0;d<u.length;d++)b(d)}return this.complex(a.toTensor(),i.toTensor())},t.prototype.split=function(e,t,n){return Dl(e,t,n)},t.prototype.dispose=function(){},t.prototype.floatPrecision=function(){return 32},t.prototype.epsilon=function(){return 1e-7},t.prototype.cropAndResize=function(e,t,n,r,a,i){for(var o=e.shape,s=o[0],c=o[1],l=o[2],u=o[3],h=t.shape[0],d=r[0],f=r[1],p=sc([h,d,f,u],"float32"),m=this.readSync(t.dataId),g=this.readSync(n.dataId),v=this.readSync(e.dataId),b=e.strides,y=p.strides,x=0;x<h;x++){var w=4*x,k=m[w],S=m[w+1],N=m[w+2],C=m[w+3],E=g[x];if(!(E>=s))for(var I=d>1?(N-k)*(c-1)/(d-1):0,T=f>1?(C-S)*(l-1)/(f-1):0,_=0;_<d;_++){var A=d>1?k*(c-1)+_*I:.5*(k+N)*(c-1);if(A<0||A>c-1)for(var R=0;R<f;R++)for(var F=0;F<u;F++){var D=F+R*y[2]+_*y[1]+x*y[0];p.values[D]=i}else if("bilinear"===a){var O=Math.floor(A),L=Math.ceil(A),P=A-O;for(R=0;R<f;R++)if((G=f>1?S*(l-1)+R*T:.5*(S+C)*(l-1))<0||G>l-1)for(F=0;F<u;F++)D=F+R*y[2]+_*y[1]+x*y[0],p.values[D]=i;else{var M=Math.floor(G),j=Math.ceil(G),B=G-M;for(F=0;F<u;F++){var z=v[D=F+M*b[2]+O*b[1]+E*b[0]],U=v[D=F+j*b[2]+O*b[1]+E*b[0]],W=v[D=F+M*b[2]+L*b[1]+E*b[0]],V=z+(U-z)*B,H=W+(v[D=F+j*b[2]+L*b[1]+E*b[0]]-W)*B;D=F+R*y[2]+_*y[1]+x*y[0],p.values[D]=V+(H-V)*P}}}else for(R=0;R<f;++R){var G;if((G=f>1?S*(l-1)+R*T:.5*(S+C)*(l-1))<0||G>l-1)for(F=0;F<u;F++)D=F+R*y[2]+_*y[1]+x*y[0],p.values[D]=i;else{var q=Math.round(G),K=Math.round(A);for(F=0;F<u;F++){var X=F+q*b[2]+K*b[1]+E*b[0],Y=F+R*y[2]+_*y[1]+x*y[0];p.values[Y]=v[X]}}}}}return p.toTensor()},t.prototype.sparseToDense=function(e,t,n,r){var a=Vc(0,e,n),i=a.sliceRank,o=a.numUpdates,s=a.sliceSize,c=a.strides,l=a.outputSize;return this.scatter(e,t,n,l,s,o,i,c,r,!1)},t.prototype.gatherND=function(e,t){var n=t.shape,r=n[n.length-1],a=Bc(e,t),i=a[0],o=a[1],s=a[2],c=a[3];if(0===o)return As([],i,e.dtype);for(var l=new Pi([o,s],e.dtype),u=this.readSync(t.dataId),h=this.readSync(e.dataId),d=0;d<o;d++){for(var f=[],p=0,m=0;m<r;m++){var g=u[d*r+m];p+=g*c[m],f.push(g)}if(p<0||p>=e.size/s)throw new Error("Invalid indices: "+f+" does not index into "+e.shape);for(var v=0;v<s;v++)l.values[d*s+v]=h[p*s+v]}return l.toTensor().reshape(i)},t.prototype.scatterND=function(e,t,n){var r=Vc(0,e,n),a=r.sliceRank,i=r.numUpdates,o=r.sliceSize,s=r.strides,c=r.outputSize,l=Fs(0);return this.scatter(e,t,n,c,o,i,a,s,l,!0)},t.prototype.fill=function(e,t,n){var r=si(n=n||vi(t),$a(e));return r.fill(t),no.makeTensor(r,e,n,this)},t.prototype.onesLike=function(e){if("string"===e.dtype)throw new Error("onesLike is not supported for string tensors");return this.fill(e.shape,1,e.dtype)},t.prototype.zerosLike=function(e){var t=si(e.dtype,$a(e.shape));return this.makeOutput(t,e.shape,e.dtype)},t.prototype.linspace=function(e,t,n){return xl(e,t,n)},t.prototype.scatter=function(e,t,n,r,a,i,o,s,c,l){var u=[r/a,a],h=this.readSync(e.dataId),d=this.readSync(t.dataId);if(0===r)return As([],n,t.dtype);var f=new Pi(u,t.dtype);f.values.fill(this.readSync(c.dataId)[0]);for(var p=0;p<i;p++){for(var m=[],g=0,v=0;v<o;v++){var b=h[p*o+v];m.push(b),g+=b*s[v]}if(g<0||g>=r/a)throw new Error("Invalid indices: "+m+" does not index into "+n);for(var y=0;y<a;y++)l?f.values[g*a+y]+=d[p*a+y]:f.values[g*a+y]=0===t.rank?d[0]:d[p*a+y]}return f.toTensor().reshape(n)},t}(tl);no.registerBackend("cpu",function(){return new gg},1);for(var vg=0,bg=[{kernelName:"NonMaxSuppressionV5",backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t,i=a.boxes,o=a.scores,s=r,c=s.maxOutputSize,l=s.iouThreshold,u=s.scoreThreshold,h=s.softNmsSigma,d=n;pg(i,"NonMaxSuppressionWithScore");var f=Tl(d.data.get(i.dataId).values,d.data.get(o.dataId).values,c,l,u,h);return[f.selectedIndices,f.selectedScores]}},{kernelName:"Square",backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,a=n;pg(r,"square");for(var i=a.data.get(r.dataId).values,o=new Float32Array(i.length),s=0;s<i.length;++s){var c=i[s];o[s]=c*c}return{dataId:a.write(o,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},{kernelName:Td,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t,a=r.a,i=r.b,o=n;pg([a,i],Td);var s=o.data.get(a.dataId).values,c=o.data.get(i.dataId).values,l=function(e,t,n,r,a,i){var o=il(e,t),s=o.length,c=xi(o),l=oi(a,$a(o)),u=e.length,h=t.length,d=xi(e),f=xi(t),p=rl(e,o),m=rl(t,o);if(p.length+m.length===0)for(var g=0;g<l.length;++g)l[g]=i(n[g%n.length],r[g%r.length]);else{var v=function(e){var t=Ai(e,s,c),a=t.slice(-u);p.forEach(function(e){return a[e]=0});var o=_i(a,u,d),g=t.slice(-h);m.forEach(function(e){return g[e]=0});var v=_i(g,h,f);l[e]=i(n[o],r[v])};for(g=0;g<l.length;++g)v(g)}return[l,o]}(a.shape,i.shape,s,c,a.dtype,function(e,t){var n=e-t;return n*n}),u=l[0],h=l[1];return{dataId:o.write(u,h,a.dtype),shape:h,dtype:a.dtype}}}];vg<bg.length;vg++)Ba(bg[vg]);for(var yg,xg=function(e){this.variableNames=["A"];var t=Wl(),n=e[0],r=e[1];this.outputShape=e,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+r+".0, "+n+".0);\n\n        vec4 values = "+t.texture2D+"(A, uv);\n        float value;\n        if (depth == 0) {\n          value = values.r;\n        } else if (depth == 1) {\n          value = values.g;\n        } else if (depth == 2) {\n          value = values.b;\n        } else if (depth == 3) {\n          value = values.a;\n        }\n\n        setOutput(floor(value * 255.0 + 0.5));\n      }\n    "},wg=function(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var t=Wl(),n=e[0],r=e[1];this.outputShape=e,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n\n        vec4 result = vec4(0.);\n\n        for(int row=0; row<=1; row++) {\n          for(int col=0; col<=1; col++) {\n            texC = coords[1] + row;\n            depth = coords[2] + col;\n\n            vec2 uv = (vec2(texC, texR) + halfCR) /\n                       vec2("+r+".0, "+n+".0);\n            vec4 values = "+t.texture2D+"(A, uv);\n            float value;\n            if (depth == 0) {\n              value = values.r;\n            } else if (depth == 1) {\n              value = values.g;\n            } else if (depth == 2) {\n              value = values.b;\n            } else if (depth == 3) {\n              value = values.a;\n            }\n\n            result[row * 2 + col] = floor(value * 255.0 + 0.5);\n          }\n        }\n\n        "+t.output+" = result;\n      }\n    "},kg=0,Sg=[{kernelName:"FromPixels",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.pixels,i=r.numChannels,o="undefined"!=typeof HTMLVideoElement&&a instanceof HTMLVideoElement,s="undefined"!=typeof HTMLImageElement&&a instanceof HTMLImageElement,c=o?[a.videoWidth,a.videoHeight]:[a.width,a.height],l=c[0],u=c[1],h=[u,l],d=[u,l,i];(s||o)&&(null==yg&&(yg=document.createElement("canvas").getContext("2d")),yg.canvas.width=l,yg.canvas.height=u,yg.drawImage(a,0,0,l,u),a=yg.canvas);var f=n.makeTensorInfo(h,"int32");n.texData.get(f.dataId).usage=oo.PIXELS,n.gpgpu.uploadPixelDataToTexture(n.getTexture(f.dataId),a);var p=Da().getBool("WEBGL_PACK")?new wg(d):new xg(d),m=n.runWebGLProgram(p,[f],"int32");return n.disposeData(f.dataId),m}},{kernelName:"NonMaxSuppressionV5",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs;hs("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var a=t,i=a.boxes,o=a.scores,s=r,c=s.maxOutputSize,l=s.iouThreshold,u=s.scoreThreshold,h=s.softNmsSigma,d=n,f=Tl(d.readSync(i.dataId),d.readSync(o.dataId),c,l,u,h);return[f.selectedIndices,f.selectedScores]}},{kernelName:"Square",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,a=n,i=new Qh(r.shape,"return x * x;");return a.runWebGLProgram(i,[r],r.dtype)}},{kernelName:Td,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t,a=r.a,i=r.b,o=n,s=Da().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new gu("return (a - b) * (a - b);",a.shape,i.shape):new pu("return (a - b) * (a - b);",a.shape,i.shape);return o.compileAndRun(s,[a,i])}}];kg<Sg.length;kg++)Ba(Sg[kg]);for(var Ng=0,Cg=[{kernelName:"Square",gradFunc:function(e,t){var n=t[0];return{x:function(){return e.mul(n.toFloat().mul(2))}}}},{kernelName:Td,gradFunc:function(e,t){var n=t[0],r=t[1],a=Fs(2);return{a:function(){return Gf(e,Gf(a,$f(n,r)))},b:function(){return Gf(e,Gf(a,$f(r,n)))}}}}];Ng<Cg.length;Ng++)za(Cg[Ng]);var Eg=function(){function e(){}return e.prototype.fetch=function(e,t){return fetch(e,t)},e.prototype.now=function(){return performance.now()},e.prototype.encode=function(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Browser's encoder only supports utf-8, but got "+t);return null==this.textEncoder&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)},e.prototype.decode=function(e,t){return new TextDecoder(t).decode(e)},e}();Da().get("IS_BROWSER")&&Da().setPlatform("browser",new Eg);var Ig,Tg=function(){function e(){this.util=n(3886),this.textEncoder=new this.util.TextEncoder}return e.prototype.fetch=function(e,t){return null!=Da().global.fetch?Da().global.fetch(e,t):(null==Ig&&(Ig=n(1065)),Ig(e,t))},e.prototype.now=function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6},e.prototype.encode=function(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Node built-in encoder only supports utf-8, but got "+t);return this.textEncoder.encode(e)},e.prototype.decode=function(e,t){return 0===e.length?"":new this.util.TextDecoder(t).decode(e)},e}();Da().get("IS_NODE")&&Da().setPlatform("node",new Tg);var _g={float32:4,int32:4,uint16:2,uint8:1,bool:1};function Ag(e,t){for(var n={},r=0,a=function(t){var a=t.name,i=t.dtype,o=t.shape,s=$a(o),c=void 0;if("quantization"in t){var l=t.quantization;if("uint8"!==l.dtype&&"uint16"!==l.dtype)throw new Error("Weight "+t.name+" has unknown quantization dtype "+l.dtype+". Supported quantization dtypes are: 'uint8' and 'uint16'.");var u=_g[l.dtype],h=e.slice(r,r+s*u),d="uint8"===l.dtype?new Uint8Array(h):new Uint16Array(h);if("float32"===i)c=Float32Array.from(d,function(e){return e*l.scale+l.min});else{if("int32"!==i)throw new Error("Unsupported dtype in weight '"+a+"': "+i);c=Int32Array.from(d,function(e){return Math.round(e*l.scale+l.min)})}r+=s*u}else if("string"===i){var f=$a(t.shape);c=[];for(var p=0;p<f;p++){var m=new Uint32Array(e.slice(r,r+4))[0];r+=4;var g=new Uint8Array(e.slice(r,r+m));c.push(g),r+=m}}else{var v=_g[i];if(h=e.slice(r,r+s*v),"float32"===i)c=new Float32Array(h);else if("int32"===i)c=new Int32Array(h);else{if("bool"!==i)throw new Error("Unsupported dtype in weight '"+a+"': "+i);c=new Uint8Array(h)}r+=s*v}n[a]=As(c,o,i)},i=0,o=t;i<o.length;i++)a(o[i]);return n}function Rg(e){if(null===e)throw new Error("Invalid input value: "+JSON.stringify(e));var t=0,n=[];e.forEach(function(e){if(t+=e.byteLength,n.push(e.byteLength===e.buffer.byteLength?e:new e.constructor(e)),!(e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+e.constructor.name)});var r=new Uint8Array(t),a=0;return n.forEach(function(e){r.set(new Uint8Array(e.buffer),a),a+=e.byteLength}),r.buffer}var Fg="undefined"!=typeof Buffer&&("undefined"==typeof Blob||"undefined"==typeof atob||"undefined"==typeof btoa);function Dg(e){return Fg?Buffer.byteLength(e):new Blob([e]).size}function Og(e){var t=0;e.forEach(function(e){t+=e.byteLength});var n=new Uint8Array(t),r=0;return e.forEach(function(e){n.set(new Uint8Array(e),r),r+=e.byteLength}),n.buffer}function Lg(e){for(e=e.trim();e.endsWith("/");)e=e.slice(0,e.length-1);var t=e.split("/");return t[t.length-1]}function Pg(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==e.modelTopology?0:Dg(JSON.stringify(e.modelTopology)),weightSpecsBytes:null==e.weightSpecs?0:Dg(JSON.stringify(e.weightSpecs)),weightDataBytes:null==e.weightData?0:e.weightData.byteLength}}var Mg=function(){function e(){this.saveRouters=[],this.loadRouters=[]}return e.getInstance=function(){return null==e.instance&&(e.instance=new e),e.instance},e.registerSaveRouter=function(t){e.getInstance().saveRouters.push(t)},e.registerLoadRouter=function(t){e.getInstance().loadRouters.push(t)},e.getSaveHandlers=function(t){return e.getHandlers(t,"save")},e.getLoadHandlers=function(t,n){return e.getHandlers(t,"load",n)},e.getHandlers=function(t,n,r){var a=[];return("load"===n?e.getInstance().loadRouters:e.getInstance().saveRouters).forEach(function(e){var n=e(t,r);null!==n&&a.push(n)}),a},e}(),jg="://",Bg=function(){function e(){this.managers={}}return e.getInstance=function(){return null==e.instance&&(e.instance=new e),e.instance},e.registerManager=function(t,n){qa(null!=t,function(){return"scheme must not be undefined or null."}),t.endsWith(jg)&&(t=t.slice(0,t.indexOf(jg))),qa(t.length>0,function(){return"scheme must not be an empty string."});var r=e.getInstance();qa(null==r.managers[t],function(){return"A model store manager is already registered for scheme '"+t+"'."}),r.managers[t]=n},e.getManager=function(e){var t=this.getInstance().managers[e];if(null==t)throw new Error("Cannot find model manager for scheme '"+e+"'");return t},e.getSchemes=function(){return Object.keys(this.getInstance().managers)},e}();function zg(e){if(-1===e.indexOf(jg))throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+Bg.getSchemes().join(","));return{scheme:e.split(jg)[0],path:e.split(jg)[1]}}function Ug(e,t,n){return void 0===n&&(n=!1),Aa(this,void 0,void 0,function(){var r,a,i,o,s,c,l,u,h;return Ra(this,function(d){switch(d.label){case 0:return qa(e!==t,function(){return"Old path and new path are the same: '"+e+"'"}),qa((r=Mg.getLoadHandlers(e)).length>0,function(){return"Copying failed because no load handler is found for source URL "+e+"."}),qa(r.length<2,function(){return"Copying failed because more than one ("+r.length+") load handlers for source URL "+e+"."}),a=r[0],qa((i=Mg.getSaveHandlers(t)).length>0,function(){return"Copying failed because no save handler is found for destination URL "+t+"."}),qa(i.length<2,function(){return"Copying failed because more than one ("+r.length+") save handlers for destination URL "+t+"."}),o=i[0],s=zg(e).scheme,c=zg(e).path,l=s===zg(e).scheme,[4,a.load()];case 1:return u=d.sent(),n&&l?[4,Bg.getManager(s).removeModel(c)]:[3,3];case 2:d.sent(),d.label=3;case 3:return[4,o.save(u)];case 4:return h=d.sent(),!n||l?[3,6]:[4,Bg.getManager(s).removeModel(c)];case 5:d.sent(),d.label=6;case 6:return[2,h.modelArtifactsInfo]}})})}var Wg="models_store",Vg="model_info_store";function Hg(){if(!Da().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var e=window||self,t=e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB||e.shimIndexedDB;if(null==t)throw new Error("The current browser does not appear to support IndexedDB.");return t}function Gg(e){var t=e.result;t.createObjectStore(Wg,{keyPath:"modelPath"}),t.createObjectStore(Vg,{keyPath:"modelPath"})}var qg=function(){function e(e){if(this.indexedDB=Hg(),null==e||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}return e.prototype.save=function(e){return Aa(this,void 0,void 0,function(){return Ra(this,function(t){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,e)]})})},e.prototype.load=function(){return Aa(this,void 0,void 0,function(){return Ra(this,function(e){return[2,this.databaseAction(this.modelPath)]})})},e.prototype.databaseAction=function(e,t){var n=this;return new Promise(function(e,r){var a=n.indexedDB.open("tensorflowjs",1);a.onupgradeneeded=function(){return Gg(a)},a.onsuccess=function(){var i=a.result;if(null==t){var o=i.transaction(Wg,"readonly"),s=o.objectStore(Wg).get(n.modelPath);s.onsuccess=function(){if(null==s.result)return i.close(),r(new Error("Cannot find model with path '"+n.modelPath+"' in IndexedDB."));e(s.result.modelArtifacts)},s.onerror=function(e){return i.close(),r(s.error)},o.oncomplete=function(){return i.close()}}else{var c,l=Pg(t),u=i.transaction(Vg,"readwrite"),h=u.objectStore(Vg),d=h.put({modelPath:n.modelPath,modelArtifactsInfo:l});d.onsuccess=function(){var a=(c=i.transaction(Wg,"readwrite")).objectStore(Wg).put({modelPath:n.modelPath,modelArtifacts:t,modelArtifactsInfo:l});a.onsuccess=function(){return e({modelArtifactsInfo:l})},a.onerror=function(e){var t=(h=u.objectStore(Vg)).delete(n.modelPath);t.onsuccess=function(){return i.close(),r(a.error)},t.onerror=function(e){return i.close(),r(a.error)}}},d.onerror=function(e){return i.close(),r(d.error)},u.oncomplete=function(){null==c?i.close():c.oncomplete=function(){return i.close()}}}},a.onerror=function(e){return r(a.error)}})},e.URL_SCHEME="indexeddb://",e}(),Kg=function(e){return Da().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(qg.URL_SCHEME)?(t=e.slice(qg.URL_SCHEME.length),new qg(t)):null;var t};Mg.registerSaveRouter(Kg),Mg.registerLoadRouter(Kg);var Xg=function(){function e(){this.indexedDB=Hg()}return e.prototype.listModels=function(){return Aa(this,void 0,void 0,function(){var e=this;return Ra(this,function(t){return[2,new Promise(function(t,n){var r=e.indexedDB.open("tensorflowjs",1);r.onupgradeneeded=function(){return Gg(r)},r.onsuccess=function(){var e=r.result,a=e.transaction(Vg,"readonly"),i=a.objectStore(Vg).getAll();i.onsuccess=function(){for(var e={},n=0,r=i.result;n<r.length;n++){var a=r[n];e[a.modelPath]=a.modelArtifactsInfo}t(e)},i.onerror=function(t){return e.close(),n(i.error)},a.oncomplete=function(){return e.close()}},r.onerror=function(e){return n(r.error)}})]})})},e.prototype.removeModel=function(e){return Aa(this,void 0,void 0,function(){var t=this;return Ra(this,function(n){var r;return e=(r=e).startsWith(qg.URL_SCHEME)?r.slice(qg.URL_SCHEME.length):r,[2,new Promise(function(n,r){var a=t.indexedDB.open("tensorflowjs",1);a.onupgradeneeded=function(){return Gg(a)},a.onsuccess=function(){var t,i=a.result,o=i.transaction(Vg,"readwrite"),s=o.objectStore(Vg),c=s.get(e);c.onsuccess=function(){if(null==c.result)return i.close(),r(new Error("Cannot find model with path '"+e+"' in IndexedDB."));var a=s.delete(e),o=function(){var a=(t=i.transaction(Wg,"readwrite")).objectStore(Wg).delete(e);a.onsuccess=function(){return n(c.result.modelArtifactsInfo)},a.onerror=function(e){return r(c.error)}};a.onsuccess=o,a.onerror=function(e){return o(),i.close(),r(c.error)}},c.onerror=function(e){return i.close(),r(c.error)},o.oncomplete=function(){null==t?i.close():t.oncomplete=function(){return i.close()}}},a.onerror=function(e){return r(a.error)}})]})})},e}();if(Da().getBool("IS_BROWSER"))try{Bg.registerManager(qg.URL_SCHEME,new Xg)}catch(Ta){}var Yg="/",$g="tensorflowjs_models",Jg="info",Qg="model_topology",Zg="weight_specs",ev="weight_data",tv="model_metadata";function nv(e){return{info:[$g,e,Jg].join(Yg),topology:[$g,e,Qg].join(Yg),weightSpecs:[$g,e,Zg].join(Yg),weightData:[$g,e,ev].join(Yg),modelMetadata:[$g,e,tv].join(Yg)}}function rv(e){var t=e.split(Yg);if(t.length<3)throw new Error("Invalid key format: "+e);return t.slice(1,t.length-1).join(Yg)}var av=function(){function e(e){if(!Da().getBool("IS_BROWSER")||"undefined"==typeof window||void 0===window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==e||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=nv(this.modelPath)}return e.prototype.save=function(e){return Aa(this,void 0,void 0,function(){var t,n,r;return Ra(this,function(a){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");t=JSON.stringify(e.modelTopology),n=JSON.stringify(e.weightSpecs),r=Pg(e);try{return this.LS.setItem(this.keys.info,JSON.stringify(r)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,n),this.LS.setItem(this.keys.weightData,function(e){if(Fg)return Buffer.from(e).toString("base64");for(var t=new Uint8Array(e),n="",r=0,a=t.length;r<a;r++)n+=String.fromCharCode(t[r]);return btoa(n)}(e.weightData)),this.LS.setItem(this.keys.modelMetadata,JSON.stringify({format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,userDefinedMetadata:e.userDefinedMetadata})),[2,{modelArtifactsInfo:r}]}catch(e){throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+r.modelTopologyBytes+", weightSpecsBytes="+r.weightSpecsBytes+", weightDataBytes="+r.weightDataBytes+".")}})})},e.prototype.load=function(){return Aa(this,void 0,void 0,function(){var e,t,n,r,a,i,o;return Ra(this,function(s){if(null==(e=JSON.parse(this.LS.getItem(this.keys.info))))throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if("JSON"!==e.modelTopologyType)throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(t={},null==(n=JSON.parse(this.LS.getItem(this.keys.topology))))throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(t.modelTopology=n,null==(r=JSON.parse(this.LS.getItem(this.keys.weightSpecs))))throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(t.weightSpecs=r,null!=(a=this.LS.getItem(this.keys.modelMetadata))&&(i=JSON.parse(a),t.format=i.format,t.generatedBy=i.generatedBy,t.convertedBy=i.convertedBy,t.userDefinedMetadata=i.userDefinedMetadata),null==(o=this.LS.getItem(this.keys.weightData)))throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return t.weightData=function(e){if(Fg){var t=Buffer.from(e,"base64");return t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)}for(var n=atob(e),r=new Uint8Array(n.length),a=0;a<n.length;++a)r.set([n.charCodeAt(a)],a);return r.buffer}(o),[2,t]})})},e.URL_SCHEME="localstorage://",e}(),iv=function(e){return Da().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(av.URL_SCHEME)?(t=e.slice(av.URL_SCHEME.length),new av(t)):null;var t};Mg.registerSaveRouter(iv),Mg.registerLoadRouter(iv);var ov=function(){function e(){qa(Da().getBool("IS_BROWSER"),function(){return"Current environment is not a web browser"}),qa("undefined"==typeof window||void 0!==window.localStorage,function(){return"Current browser does not appear to support localStorage"}),this.LS=window.localStorage}return e.prototype.listModels=function(){return Aa(this,void 0,void 0,function(){var e,t,n,r,a,i;return Ra(this,function(o){for(e={},t=$g+Yg,n=Yg+Jg,r=0;r<this.LS.length;++r)(a=this.LS.key(r)).startsWith(t)&&a.endsWith(n)&&(i=rv(a),e[i]=JSON.parse(this.LS.getItem(a)));return[2,e]})})},e.prototype.removeModel=function(e){return Aa(this,void 0,void 0,function(){var t,n;return Ra(this,function(r){var a;if(e=(a=e).startsWith(av.URL_SCHEME)?a.slice(av.URL_SCHEME.length):a,t=nv(e),null==this.LS.getItem(t.info))throw new Error("Cannot find model at path '"+e+"'");return n=JSON.parse(this.LS.getItem(t.info)),this.LS.removeItem(t.info),this.LS.removeItem(t.topology),this.LS.removeItem(t.weightSpecs),this.LS.removeItem(t.weightData),[2,n]})})},e}();if(Da().getBool("IS_BROWSER"))try{Bg.registerManager(av.URL_SCHEME,new ov)}catch(Ta){}function sv(e){return new Promise(function(e){return setTimeout(e)}).then(e)}var cv=function(){function e(t){if(!Da().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");t.startsWith(e.URL_SCHEME)&&(t=t.slice(e.URL_SCHEME.length)),null!=t&&0!==t.length||(t="model"),this.modelTopologyFileName=t+".json",this.weightDataFileName=t+".weights.bin"}return e.prototype.save=function(e){return Aa(this,void 0,void 0,function(){var t,n,r,a,i,o;return Ra(this,function(s){switch(s.label){case 0:if("undefined"==typeof document)throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(t=window.URL.createObjectURL(new Blob([e.weightData],{type:"application/octet-stream"})),!(e.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return n=[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}],r={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:n},a=window.URL.createObjectURL(new Blob([JSON.stringify(r)],{type:"application/json"})),(i=null==this.jsonAnchor?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,i.href=a,[4,sv(function(){return i.dispatchEvent(new MouseEvent("click"))})];case 2:return s.sent(),null==e.weightData?[3,4]:((o=null==this.weightDataAnchor?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,o.href=t,[4,sv(function(){return o.dispatchEvent(new MouseEvent("click"))})]);case 3:s.sent(),s.label=4;case 4:return[2,{modelArtifactsInfo:Pg(e)}]}})})},e.URL_SCHEME="downloads://",e}(),lv=function(){function e(e){if(null==e||e.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received "+e);this.files=e}return e.prototype.load=function(){return Aa(this,void 0,void 0,function(){var e,t,n=this;return Ra(this,function(r){return e=this.files[0],t=this.files.slice(1),[2,new Promise(function(r,a){var i=new FileReader;i.onload=function(i){var o=JSON.parse(i.target.result),s=o.modelTopology;if(null!=s){0===t.length&&r({modelTopology:s});var c=o.weightsManifest;if(null!=c){var l;try{l=n.checkManifestAndWeightFiles(c,t)}catch(e){return void a(e)}var u=[],h=[],d=[];c.forEach(function(e){e.paths.forEach(function(e){h.push(e),d.push(null)}),u.push.apply(u,e.weights)}),c.forEach(function(e){e.paths.forEach(function(e){var t=new FileReader;t.onload=function(t){var n=t.target.result,a=h.indexOf(e);d[a]=n,-1===d.indexOf(null)&&r({modelTopology:s,weightSpecs:u,weightData:Og(d),format:o.format,generatedBy:o.generatedBy,convertedBy:o.convertedBy,userDefinedMetadata:o.userDefinedMetadata})},t.onerror=function(t){return a("Failed to weights data from file of path '"+e+"'.")},t.readAsArrayBuffer(l[e])})})}else a(new Error("weightManifest field is missing from file "+e.name))}else a(new Error("modelTopology field is missing from file "+e.name))},i.onerror=function(t){return a("Failed to read model topology and weights manifest JSON from file '"+e.name+"'. BrowserFiles supports loading Keras-style tf.Model artifacts only.")},i.readAsText(e)})]})})},e.prototype.checkManifestAndWeightFiles=function(e,t){for(var n=[],r=t.map(function(e){return Lg(e.name)}),a={},i=0,o=e;i<o.length;i++)o[i].paths.forEach(function(e){var i=Lg(e);if(-1!==n.indexOf(i))throw new Error("Duplicate file basename found in weights manifest: '"+i+"'");if(n.push(i),-1===r.indexOf(i))throw new Error("Weight file with basename '"+i+"' is not provided.");a[e]=t[r.indexOf(i)]});if(n.length!==t.length)throw new Error("Mismatch in the number of files in weights manifest ("+n.length+") and the number of weight files provided ("+t.length+").");return a},e}();function uv(e,t,n,r){!function(e){qa(null!=e&&Array.isArray(e)&&e.length>0,function(){return"promises must be a none empty array"})}(e),function(e,t){qa(e>=0&&e<=1,function(){return"Progress fraction must be in range [0, 1], but got startFraction "+e}),qa(t>=0&&t<=1,function(){return"Progress fraction must be in range [0, 1], but got endFraction "+t}),qa(t>=e,function(){return"startFraction must be no more than endFraction, but got startFraction "+e+" and endFraction "+t})}(n=null==n?0:n,r=null==r?1:r);var a=0;return Promise.all(e.map(function(i){return i.then(function(i){var o=n+ ++a/e.length*(r-n);return t(o),i}),i}))}function hv(e,t){return Aa(this,void 0,void 0,function(){var n,r,a,i,o,s,c,l,u;return Ra(this,function(h){switch(h.label){case 0:return null==t&&(t={}),n=null==t.fetchFunc?Da().platform.fetch:t.fetchFunc,r=e.map(function(e){return n(e,t.requestInit,{isBinary:!0})}),a=0,i=.5,null!=t.onProgress?[3,2]:[4,Promise.all(r)];case 1:return o=h.sent(),[3,4];case 2:return[4,uv(r,t.onProgress,a,i)];case 3:o=h.sent(),h.label=4;case 4:return s=o.map(function(e){return e.arrayBuffer()}),c=.5,l=1,null!=t.onProgress?[3,6]:[4,Promise.all(s)];case 5:return u=h.sent(),[3,8];case 6:return[4,uv(s,t.onProgress,c,l)];case 7:u=h.sent(),h.label=8;case 8:return[2,u]}})})}function dv(e){var t=this;return function(n,r,a){return void 0===r&&(r=""),Aa(t,void 0,void 0,function(){var t,i,o,s,c,l,u,h,d,f;return Ra(this,function(p){switch(p.label){case 0:if(t=n.map(function(){return!1}),i={},o=null!=a?a.map(function(){return!1}):[],s=[],n.forEach(function(e,n){var r=0;e.weights.forEach(function(e){var c="quantization"in e?e.quantization.dtype:e.dtype,l=_g[c]*$a(e.shape),u=function(){t[n]=!0,null==i[n]&&(i[n]=[]),i[n].push({manifestEntry:e,groupOffset:r,sizeBytes:l})};null!=a?a.forEach(function(t,n){t===e.name&&(u(),o[n]=!0)}):u(),s.push(e.name),r+=l})}),!o.every(function(e){return e}))throw c=a.filter(function(e,t){return!o[t]}),new Error("Could not find weights in manifest with names: "+c.join(", ")+". \nManifest JSON has weights with names: "+s.join(", ")+".");return l=t.reduce(function(e,t,n){return t&&e.push(n),e},[]),u=[],l.forEach(function(e){n[e].paths.forEach(function(e){var t=r+(r.endsWith("/")?"":"/")+e;u.push(t)})}),[4,e(u)];case 1:return h=p.sent(),d={},f=0,l.forEach(function(e){for(var t=n[e].paths.length,r=0,a=0;a<t;a++)r+=h[f+a].byteLength;for(var o=new ArrayBuffer(r),s=new Uint8Array(o),c=0,l=0;l<t;l++){var u=new Uint8Array(h[f+l]);s.set(u,c),c+=u.byteLength}i[e].forEach(function(e){var t=Ag(o.slice(e.groupOffset,e.groupOffset+e.sizeBytes),[e.manifestEntry]);for(var n in t)d[n]=t[n]}),f+=t}),[2,d]}})})}}Mg.registerSaveRouter(function(e){return Da().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(cv.URL_SCHEME)?function(e){return void 0===e&&(e="model"),new cv(e)}(e.slice(cv.URL_SCHEME.length)):null});var fv=function(){function e(e,t){if(this.DEFAULT_METHOD="POST",null==t&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.onProgress=t.onProgress,null!=t.fetchFunc?(qa("function"==typeof t.fetchFunc,function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"}),this.fetch=t.fetchFunc):this.fetch=Da().platform.fetch,qa(null!=e&&e.length>0,function(){return"URL path for http must not be null, undefined or empty."}),Array.isArray(e)&&qa(2===e.length,function(){return"URL paths for http must have a length of 2, (actual length is "+e.length+")."}),this.path=e,null!=t.requestInit&&null!=t.requestInit.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{}}return e.prototype.save=function(e){return Aa(this,void 0,void 0,function(){var t,n,r,a;return Ra(this,function(i){switch(i.label){case 0:if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,n=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],r={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,userDefinedMetadata:e.userDefinedMetadata,weightsManifest:n},t.body.append("model.json",new Blob([JSON.stringify(r)],{type:"application/json"}),"model.json"),null!=e.weightData&&t.body.append("model.weights.bin",new Blob([e.weightData],{type:"application/octet-stream"}),"model.weights.bin"),[4,this.fetch(this.path,t)];case 1:if((a=i.sent()).ok)return[2,{modelArtifactsInfo:Pg(e),responses:[a]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+a.status+".")}})})},e.prototype.load=function(){return Aa(this,void 0,void 0,function(){var e,t,n,r,a,i,o,s,c,l,u,h;return Ra(this,function(d){switch(d.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(!(e=d.sent()).ok)throw new Error("Request to "+this.path+" failed with status code "+e.status+". Please verify this URL points to the model JSON of the model to load.");d.label=2;case 2:return d.trys.push([2,4,,5]),[4,e.json()];case 3:return t=d.sent(),[3,5];case 4:throw d.sent(),n="Failed to parse model JSON of response from "+this.path+".",this.path.endsWith(".pb")?n+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":n+=" Please make sure the server is serving valid JSON for this request.",new Error(n);case 5:if(r=t.modelTopology,a=t.weightsManifest,i=t.generatedBy,o=t.convertedBy,s=t.format,c=t.userDefinedMetadata,null==r&&null==a)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return null==a?[3,7]:[4,this.loadWeights(a)];case 6:h=d.sent(),l=h[0],u=h[1],d.label=7;case 7:return[2,{modelTopology:r,weightSpecs:l,weightData:u,userDefinedMetadata:c,generatedBy:i,convertedBy:o,format:s}]}})})},e.prototype.loadWeights=function(e){return Aa(this,void 0,void 0,function(){var t,n,r,a,i,o,s,c,l,u,h;return Ra(this,function(d){switch(d.label){case 0:for(t=Array.isArray(this.path)?this.path[1]:this.path,n=function(e){var t=e.lastIndexOf("/"),n=e.lastIndexOf("?");return[e.substring(0,t)+"/",n>t?e.substring(n):""]}(t),r=n[0],a=n[1],i=this.weightPathPrefix||r,o=[],s=0,c=e;s<c.length;s++)l=c[s],o.push.apply(o,l.weights);return u=[],e.forEach(function(e){e.paths.forEach(function(e){u.push(i+e+a)})}),[4,hv(u,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})];case 1:return h=d.sent(),[2,[o,Og(h)]]}})})},e.URL_SCHEME_REGEX=/^https?:\/\//,e}();function pv(e){return null!=e.match(fv.URL_SCHEME_REGEX)}var mv=function(e,t){return"undefined"==typeof fetch?null:(Array.isArray(e)?e.every(function(e){return pv(e)}):pv(e))?gv(e,{onProgress:t}):null};function gv(e,t){return new fv(e,t)}Mg.registerSaveRouter(mv),Mg.registerLoadRouter(mv);var vv,bv=function(){function e(e){this.modelArtifacts=e}return e.prototype.load=function(){return Aa(this,void 0,void 0,function(){return Ra(this,function(e){return[2,this.modelArtifacts]})})},e}(),yv=function(){function e(e){this.saveHandler=e}return e.prototype.save=function(e){return Aa(this,void 0,void 0,function(){return Ra(this,function(t){return[2,this.saveHandler(e)]})})},e}(),xv=Object.freeze({browserFiles:function(e){return new lv(e)},browserHTTPRequest:function(e,t){return gv(e,t)},concatenateArrayBuffers:Og,decodeWeights:Ag,encodeWeights:function(e,t){return Aa(this,void 0,void 0,function(){var n,r,a,i,o,s=this;return Ra(this,function(c){switch(c.label){case 0:for(n=[],r=[],a=Array.isArray(e)?e.map(function(e){return e.name}):Object.keys(e),i=function(i){var o=a[i],c=Array.isArray(e)?e[i].tensor:e[o];if("float32"!==c.dtype&&"int32"!==c.dtype&&"bool"!==c.dtype&&"string"!==c.dtype)throw new Error("Unsupported dtype in weight '"+o+"': "+c.dtype);var l={name:o,shape:c.shape,dtype:c.dtype};if("string"===c.dtype){var u=new Promise(function(e){return Aa(s,void 0,void 0,function(){var t,n,r,a,i,o,s;return Ra(this,function(l){switch(l.label){case 0:return[4,c.bytes()];case 1:for(t=l.sent(),n=t.reduce(function(e,t){return e+t.length},0)+4*t.length,r=new Uint8Array(n),a=0,i=0;i<t.length;i++)o=t[i],s=new Uint8Array(new Uint32Array([o.length]).buffer),r.set(s,a),a+=4,r.set(o,a),a+=o.length;return e(r),[2]}})})});r.push(u)}else r.push(c.data());null!=t&&(l.group=t),n.push(l)},o=0;o<a.length;++o)i(o);return[4,Promise.all(r)];case 1:return[2,{data:Rg(c.sent()),specs:n}]}})})},fromMemory:function(e,t,n,r){return 1===arguments.length?null!=e.modelTopology||null!=e.weightSpecs?new bv(e):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new bv({modelTopology:e})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new bv({modelTopology:e,weightSpecs:t,weightData:n,trainingConfig:r}))},getLoadHandlers:function(e,t){return Mg.getLoadHandlers(e,t)},getModelArtifactsInfoForJSON:Pg,getSaveHandlers:function(e){return Mg.getSaveHandlers(e)},http:gv,isHTTPScheme:pv,loadWeights:function(e,t,n,r){return void 0===t&&(t=""),Aa(this,void 0,void 0,function(){return Ra(this,function(a){return[2,dv(function(e){return hv(e,{requestInit:r})})(e,t,n)]})})},registerLoadRouter:function(e){return Mg.registerLoadRouter(e)},registerSaveRouter:function(e){return Mg.registerSaveRouter(e)},weightsLoaderFactory:dv,withSaveHandler:function(e){return new yv(e)},copyModel:function(e,t){return Aa(this,void 0,void 0,function(){return Ra(this,function(n){return[2,Ug(e,t,!1)]})})},listModels:function(){return Aa(this,void 0,void 0,function(){var e,t,n,r,a,i,o;return Ra(this,function(s){switch(s.label){case 0:e=Bg.getSchemes(),t={},n=0,r=e,s.label=1;case 1:return n<r.length?(a=r[n],[4,Bg.getManager(a).listModels()]):[3,4];case 2:for(o in i=s.sent())t[a+jg+o]=i[o];s.label=3;case 3:return n++,[3,1];case 4:return[2,t]}})})},moveModel:function(e,t){return Aa(this,void 0,void 0,function(){return Ra(this,function(n){return[2,Ug(e,t,!0)]})})},removeModel:function(e){return Aa(this,void 0,void 0,function(){var t;return Ra(this,function(n){return t=zg(e),[2,Bg.getManager(t.scheme).removeModel(t.path)]})})}}),wv=Es({confusionMatrix_:function(e,t,n){var r=ps(e,"labels","confusionMatrix"),a=ps(t,"predictions","confusionMatrix");qa(null==n||n>0&&Number.isInteger(n),function(){return"If provided, numClasses must be a positive integer, but got "+n}),qa(1===r.rank,function(){return"Expected the rank of labels to be 1, but got "+r.rank}),qa(1===a.rank,function(){return"Expected the rank of predictions to be 1, but got "+a.rank}),qa(r.shape[0]===a.shape[0],function(){return"Mismatch in the number of examples: "+r.shape[0]+" vs. "+a.shape[0]+". Labels and predictions should have the same number of elements."}),qa(n>0&&Number.isInteger(n),function(){return"numClasses is required to be a positive integer, but got "+n});var i=vc(r.asType("int32"),n),o=vc(a.asType("int32"),n);return i.transpose().matMul(o).asType("int32")}}),kv=(Object.freeze({confusionMatrix:wv}),Es({fromPixels_:function(e,t){if(void 0===t&&(t=3),t>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(null==e)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var n=!1,r=!1,a=!1,i=!1,o=!1;if(e.data instanceof Uint8Array)n=!0;else if("undefined"!=typeof ImageData&&e instanceof ImageData)r=!0;else if("undefined"!=typeof HTMLVideoElement&&e instanceof HTMLVideoElement)a=!0;else if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement)i=!0;else{if(null==e.getContext)throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was "+e.constructor.name);o=!0}if(a&&a&&e.readyState<2)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.");if(null!=Ma("FromPixels",no.backendName))return no.runKernel("FromPixels",{pixels:e},{numChannels:t});var s,c,l=a?[e.videoWidth,e.videoHeight]:[e.width,e.height],u=l[0],h=l[1];if(o?s=e.getContext("2d").getImageData(0,0,u,h).data:r||n?s=e.data:(i||a)&&(null==vv&&(vv=document.createElement("canvas").getContext("2d")),vv.canvas.width=u,vv.canvas.height=h,vv.drawImage(e,0,0,u,h),s=vv.getImageData(0,0,u,h).data),4===t)c=new Int32Array(s);else{var d=u*h;c=new Int32Array(d*t);for(var f=0;f<d;f++)for(var p=0;p<t;++p)c[f*t+p]=s[4*f+p]}return Ls(c,[h,u,t],"int32")}})),Sv=Object.freeze({toPixels:function(e,t){return Aa(this,void 0,void 0,function(){var n,r,a,i,o,s,c,l,u,h,d,f,p,m,g,v,b,y,x,w,k,S,N;return Ra(this,function(C){switch(C.label){case 0:if(n=ps(e,"img","toPixels"),e instanceof zi||(n=n.toInt()),2!==n.rank&&3!==n.rank)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+n.rank+".");if(r=n.shape.slice(0,2),a=r[0],i=r[1],(o=2===n.rank?1:n.shape[2])>4||2===o)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+o);return[4,n.data()];case 1:return s=C.sent(),c=n.min(),l=n.max(),[4,Promise.all([c.data(),l.data()])];case 2:if(u=C.sent(),h=u[0],d=u[1],f=h[0],p=d[0],c.dispose(),l.dispose(),"float32"===n.dtype){if(f<0||p>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+f+" - "+p+"].")}else{if("int32"!==n.dtype)throw new Error("Unsupported type for toPixels: "+n.dtype+". Please use float32 or int32 tensors.");if(f<0||p>255)throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+f+" - "+p+"].")}for(m="float32"===n.dtype?255:1,g=new Uint8ClampedArray(i*a*4),v=0;v<a*i;++v)b=void 0,y=void 0,x=void 0,w=void 0,1===o?(b=s[v]*m,y=s[v]*m,x=s[v]*m,w=255):3===o?(b=s[3*v]*m,y=s[3*v+1]*m,x=s[3*v+2]*m,w=255):4===o&&(b=s[4*v]*m,y=s[4*v+1]*m,x=s[4*v+2]*m,w=s[4*v+3]*m),g[0+(k=4*v)]=Math.round(b),g[k+1]=Math.round(y),g[k+2]=Math.round(x),g[k+3]=Math.round(w);return null!=t&&(t.width=i,t.height=a,S=t.getContext("2d"),N=new ImageData(g,i,a),S.putImageData(N,0,0)),n!==e&&n.dispose(),[2,g]}})})},fromPixels:kv}),Nv=function(){function e(){}return e.prototype.getClassName=function(){return this.constructor.className},e.fromConfig=function(e,t){return new e(t)},e}(),Cv=function(){function e(){this.classNameMap={}}return e.getMap=function(){return null==e.instance&&(e.instance=new e),e.instance},e.register=function(t){e.getMap().classNameMap[t.className]=[t,t.fromConfig]},e}();function Ev(e){qa(null!=e.className,function(){return"Class being registered does not have the static className property defined."}),qa("string"==typeof e.className,function(){return"className is required to be a string, but got type "+typeof e.className}),qa(e.className.length>0,function(){return"Class being registered has an empty-string as its className, which is disallowed."}),Cv.register(e)}Object.freeze({Serializable:Nv,SerializationMap:Cv,registerClass:Ev});function Iv(){return 32===no.backend.floatPrecision()?.001:.1}function Tv(e,t,n){var r=!0;if((hi(e)||hi(t))&&(r=!1),hi(e)&&hi(t)&&(r=!0),r){var a=e.constructor.name,i=t.constructor.name;if(a!==i)throw new Error("Arrays are of different type. Actual: "+a+". Expected: "+i)}if(Array.isArray(e)&&Array.isArray(t)){var o=ds(e),s=ds(t);if(!Ja(o,s))throw new Error("Arrays have different shapes. Actual: ["+o+"]. Expected: ["+s+"]")}var c=hi(e)?e:Ya(e),l=hi(t)?t:Ya(t);if(c.length!==l.length)throw new Error("Arrays have different lengths actual: "+c.length+" vs expected: "+l.length+".\nActual:   "+c+".\nExpected: "+l+".");for(var u=0;u<l.length;++u){var h=c[u],d=l[u];if(!n(h,d))throw new Error("Arrays differ: actual["+u+"] = "+h+", expected["+u+"] = "+d+".\nActual:   "+c+".\nExpected: "+l+".")}}function _v(e,t,n){return!isFinite(e)&&!isFinite(t)||!(isNaN(e)||isNaN(t)||Math.abs(e-t)>n)}Object.freeze({TEST_EPSILON_FLOAT16:.1,expectArraysClose:function(e,t,n){return null==n&&(n=Iv()),Tv(e,t,function(e,t){return _v(e,t,n)})},testEpsilon:Iv,expectPromiseToFail:function(e,t){e().then(function(){return t.fail()},function(){return t()})},expectArraysEqual:function(e,t){var n="string"==typeof t||"number"==typeof t||"boolean"==typeof t?[t]:t;return pi(e)||pi(e[0])||pi(t)||pi(t[0])?Tv(e,n,function(e,t){return e==t}):Tv(e,t,function(e,t){return _v(e,t,0)})},expectNumbersClose:function(e,t,n){if(null==n&&(n=Iv()),!_v(e,t,n))throw new Error("Numbers differ: actual === "+e+", expected === "+t)},expectValuesInRange:function(e,t,n){for(var r=0;r<e.length;r++)if(e[r]<t||e[r]>n)throw new Error("Value out of range:"+e[r]+" low: "+t+", high: "+n)},expectArrayBuffersEqual:function(e,t){expect(new Float32Array(e)).toEqual(new Float32Array(t))}}),Object.freeze({gpgpu_util:hh,webgl_util:os,forceHalfFloat:function(){Da().set("WEBGL_FORCE_F16_TEXTURES",!0)},MathBackendWebGL:Ed,setWebGLContext:uo,GPGPUContext:dh});var Av=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return _a(t,e),t.prototype.minimize=function(e,t,n){void 0===t&&(t=!1);var r=this.computeGradients(e,n),a=r.value,i=r.grads;if(null!=n){var o=n.map(function(e){return{name:e.name,tensor:i[e.name]}});this.applyGradients(o)}else this.applyGradients(i);return us(i),t?a:(a.dispose(),null)},Object.defineProperty(t.prototype,"iterations",{get:function(){return null==this.iterations_&&(this.iterations_=0),this.iterations_},enumerable:!0,configurable:!0}),t.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},t.prototype.computeGradients=function(e,t){return function(e,t){qa(bi(e),function(){return"The f passed in variableGrads(f) must be a function"}),qa(null==t||Array.isArray(t)&&t.every(function(e){return e instanceof qi}),function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"});var n=null!=t;if(!n)for(var r in t=[],no.registeredVariables)t.push(no.registeredVariables[r]);var a=n?t.filter(function(e){return!e.trainable}):null,i=t.length;qa((t=t.filter(function(e){return e.trainable})).length>0,function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the "+i+" variables is trainable."});var o=no.gradients(e,t,null,!0),s=o.value,c=o.grads;qa(c.some(function(e){return null!=e}),function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."}),qa(0===s.rank,function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+s.rank+" tensor"});var l={};return t.forEach(function(e,t){null!=c[t]&&(l[e.name]=c[t])}),null!=a&&a.forEach(function(e){return l[e.name]=null}),{value:s,grads:l}}(e,t)},t.prototype.dispose=function(){null!=this.iterations_&&us(this.iterations_)},t.prototype.saveIterations=function(){return Aa(this,void 0,void 0,function(){return Ra(this,function(e){return null==this.iterations_&&(this.iterations_=0),[2,{name:"iter",tensor:Fs(this.iterations_,"int32")}]})})},t.prototype.getWeights=function(){return Aa(this,void 0,void 0,function(){return Ra(this,function(e){throw new Error("getWeights() is not implemented for this optimizer yet.")})})},t.prototype.setWeights=function(e){return Aa(this,void 0,void 0,function(){return Ra(this,function(e){throw new Error("setWeights() is not implemented for this optimizer class "+this.getClassName())})})},t.prototype.extractIterations=function(e){return Aa(this,void 0,void 0,function(){var t;return Ra(this,function(n){switch(n.label){case 0:return t=this,[4,e[0].tensor.data()];case 1:return t.iterations_=n.sent()[0],[2,e.slice(1)]}})})},t}(Nv);Object.defineProperty(Av,Symbol.hasInstance,{value:function(e){return null!=e.minimize&&null!=e.computeGradients&&null!=e.applyGradients}});var Rv=function(e){function t(t,n,r){void 0===r&&(r=null);var a=e.call(this)||this;return a.learningRate=t,a.rho=n,a.epsilon=r,a.accumulatedGrads=[],a.accumulatedUpdates=[],null==r&&(a.epsilon=no.backend.epsilon()),a}return _a(t,e),t.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map(function(e){return e.name}):Object.keys(e)).forEach(function(n,r){var a=no.registeredVariables[n];null==t.accumulatedGrads[r]&&(t.accumulatedGrads[r]={originalName:n+"/accum_grad",variable:ls(function(){return Ws(a).variable(!1)})}),null==t.accumulatedUpdates[r]&&(t.accumulatedUpdates[r]={originalName:n+"/accum_var",variable:ls(function(){return Ws(a).variable(!1)})});var i=Array.isArray(e)?e[r].tensor:e[n];if(null!=i){var o=t.accumulatedGrads[r].variable,s=t.accumulatedUpdates[r].variable;ls(function(){var e=o.mul(t.rho).add(i.square().mul(1-t.rho)),n=s.add(t.epsilon).sqrt().div(o.add(t.epsilon).sqrt()).mul(i),r=s.mul(t.rho).add(n.square().mul(1-t.rho));o.assign(e),s.assign(r);var c=n.mul(-t.learningRate).add(a);a.assign(c)})}}),this.incrementIterations()},t.prototype.dispose=function(){null!=this.accumulatedUpdates&&(us(this.accumulatedGrads.map(function(e){return e.variable})),us(this.accumulatedUpdates.map(function(e){return e.variable})))},t.prototype.getWeights=function(){return Aa(this,void 0,void 0,function(){var e;return Ra(this,function(t){switch(t.label){case 0:return e=this.accumulatedGrads.concat(this.accumulatedUpdates),[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(e.map(function(e){return{name:e.originalName,tensor:e.variable}}))]}})})},t.prototype.setWeights=function(e){return Aa(this,void 0,void 0,function(){var t;return Ra(this,function(n){switch(n.label){case 0:return[4,this.extractIterations(e)];case 1:return e=n.sent(),t=e.length/2,this.accumulatedGrads=e.slice(0,t).map(function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}}),this.accumulatedUpdates=e.slice(t,2*t).map(function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}}),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},t.fromConfig=function(e,t){return new e(t.learningRate,t.rho,t.epsilon)},t.className="Adadelta",t}(Av);Ev(Rv);var Fv=function(e){function t(t,n){void 0===n&&(n=.1);var r=e.call(this)||this;return r.learningRate=t,r.initialAccumulatorValue=n,r.accumulatedGrads=[],r}return _a(t,e),t.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map(function(e){return e.name}):Object.keys(e)).forEach(function(n,r){var a=no.registeredVariables[n];null==t.accumulatedGrads[r]&&(t.accumulatedGrads[r]={originalName:n+"/accumulator",variable:ls(function(){return Bs(a.shape,t.initialAccumulatorValue).variable(!1)})});var i=Array.isArray(e)?e[r].tensor:e[n];if(null!=i){var o=t.accumulatedGrads[r].variable;ls(function(){var e=o.add(i.square());o.assign(e);var n=i.div(e.add(no.backend.epsilon()).sqrt()).mul(-t.learningRate).add(a);a.assign(n)})}}),this.incrementIterations()},t.prototype.dispose=function(){null!=this.accumulatedGrads&&us(this.accumulatedGrads.map(function(e){return e.variable}))},t.prototype.getWeights=function(){return Aa(this,void 0,void 0,function(){return Ra(this,function(e){switch(e.label){case 0:return[4,this.saveIterations()];case 1:return[2,[e.sent()].concat(this.accumulatedGrads.map(function(e){return{name:e.originalName,tensor:e.variable}}))]}})})},t.prototype.setWeights=function(e){return Aa(this,void 0,void 0,function(){return Ra(this,function(t){switch(t.label){case 0:return[4,this.extractIterations(e)];case 1:return e=t.sent(),this.accumulatedGrads=e.map(function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}}),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},t.fromConfig=function(e,t){return new e(t.learningRate,t.initialAccumulatorValue)},t.className="Adagrad",t}(Av);Ev(Fv);var Dv=function(e){function t(t,n,r,a){void 0===a&&(a=null);var i=e.call(this)||this;return i.learningRate=t,i.beta1=n,i.beta2=r,i.epsilon=a,i.accumulatedFirstMoment=[],i.accumulatedSecondMoment=[],ls(function(){i.accBeta1=Fs(n).variable(),i.accBeta2=Fs(r).variable()}),null==a&&(i.epsilon=no.backend.epsilon()),i}return _a(t,e),t.prototype.applyGradients=function(e){var t=this,n=Array.isArray(e)?e.map(function(e){return e.name}):Object.keys(e);ls(function(){var r=$f(1,t.accBeta1),a=$f(1,t.accBeta2);n.forEach(function(n,i){var o=no.registeredVariables[n];null==t.accumulatedFirstMoment[i]&&(t.accumulatedFirstMoment[i]={originalName:n+"/m",variable:ls(function(){return Ws(o).variable(!1)})}),null==t.accumulatedSecondMoment[i]&&(t.accumulatedSecondMoment[i]={originalName:n+"/v",variable:ls(function(){return Ws(o).variable(!1)})});var s=Array.isArray(e)?e[i].tensor:e[n];if(null!=s){var c=t.accumulatedFirstMoment[i].variable,l=t.accumulatedSecondMoment[i].variable,u=c.mul(t.beta1).add(s.mul(1-t.beta1)),h=l.mul(t.beta2).add(s.square().mul(1-t.beta2)),d=u.div(r),f=h.div(a);c.assign(u),l.assign(h);var p=d.div(f.sqrt().add(t.epsilon)).mul(-t.learningRate).add(o);o.assign(p)}}),t.accBeta1.assign(t.accBeta1.mul(t.beta1)),t.accBeta2.assign(t.accBeta2.mul(t.beta2))}),this.incrementIterations()},t.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),null!=this.accumulatedFirstMoment&&us(this.accumulatedFirstMoment.map(function(e){return e.variable})),null!=this.accumulatedSecondMoment&&us(this.accumulatedSecondMoment.map(function(e){return e.variable}))},t.prototype.getWeights=function(){return Aa(this,void 0,void 0,function(){var e;return Ra(this,function(t){switch(t.label){case 0:return e=this.accumulatedFirstMoment.concat(this.accumulatedSecondMoment),[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(e.map(function(e){return{name:e.originalName,tensor:e.variable}}))]}})})},t.prototype.setWeights=function(e){return Aa(this,void 0,void 0,function(){var t,n=this;return Ra(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(e)];case 1:return e=r.sent(),ls(function(){n.accBeta1.assign(Kf(n.beta1,n.iterations_+1)),n.accBeta2.assign(Kf(n.beta2,n.iterations_+1))}),t=e.length/2,this.accumulatedFirstMoment=e.slice(0,t).map(function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}}),this.accumulatedSecondMoment=e.slice(t,2*t).map(function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}}),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},t.fromConfig=function(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon)},t.className="Adam",t}(Av);Ev(Dv);var Ov=function(e){function t(t,n,r,a,i){void 0===a&&(a=null),void 0===i&&(i=0);var o=e.call(this)||this;return o.learningRate=t,o.beta1=n,o.beta2=r,o.epsilon=a,o.decay=i,o.accumulatedFirstMoment=[],o.accumulatedWeightedInfNorm=[],ls(function(){o.iteration=Fs(0).variable(),o.accBeta1=Fs(n).variable()}),null==a&&(o.epsilon=no.backend.epsilon()),o}return _a(t,e),t.prototype.applyGradients=function(e){var t=this,n=Array.isArray(e)?e.map(function(e){return e.name}):Object.keys(e);ls(function(){var r=$f(1,t.accBeta1),a=Lf(-t.learningRate,t.iteration.mul(t.decay).add(1));n.forEach(function(n,i){var o=no.registeredVariables[n];null==t.accumulatedFirstMoment[i]&&(t.accumulatedFirstMoment[i]={originalName:n+"/m",variable:Ws(o).variable(!1)}),null==t.accumulatedWeightedInfNorm[i]&&(t.accumulatedWeightedInfNorm[i]={originalName:n+"/v",variable:Ws(o).variable(!1)});var s=Array.isArray(e)?e[i].tensor:e[n];if(null!=s){var c=t.accumulatedFirstMoment[i].variable,l=t.accumulatedWeightedInfNorm[i].variable,u=c.mul(t.beta1).add(s.mul(1-t.beta1)),h=l.mul(t.beta2),d=s.abs(),f=h.maximum(d);c.assign(u),l.assign(f);var p=a.div(r).mul(u.div(f.add(t.epsilon))).add(o);o.assign(p)}}),t.iteration.assign(t.iteration.add(1)),t.accBeta1.assign(t.accBeta1.mul(t.beta1))}),this.incrementIterations()},t.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),null!=this.accumulatedFirstMoment&&us(this.accumulatedFirstMoment.map(function(e){return e.variable})),null!=this.accumulatedWeightedInfNorm&&us(this.accumulatedWeightedInfNorm.map(function(e){return e.variable}))},t.prototype.getWeights=function(){return Aa(this,void 0,void 0,function(){return Ra(this,function(e){throw new Error("getWeights() is not implemented for Adamax yet.")})})},t.prototype.setWeights=function(e){return Aa(this,void 0,void 0,function(){return Ra(this,function(e){throw new Error("setWeights() is not implemented for Adamax yet.")})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},t.fromConfig=function(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon,t.decay)},t.className="Adamax",t}(Av);Ev(Ov);var Lv=function(e){function t(t){var n=e.call(this)||this;return n.learningRate=t,n.setLearningRate(t),n}return _a(t,e),t.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map(function(e){return e.name}):Object.keys(e)).forEach(function(n,r){var a=Array.isArray(e)?e[r].tensor:e[n];if(null!=a){var i=no.registeredVariables[n];ls(function(){var e=t.c.mul(a).add(i);i.assign(e)})}}),this.incrementIterations()},t.prototype.setLearningRate=function(e){this.learningRate=e,null!=this.c&&this.c.dispose(),this.c=function(e){return no.keep(e)}(Fs(-e))},t.prototype.dispose=function(){this.c.dispose()},t.prototype.getWeights=function(){return Aa(this,void 0,void 0,function(){return Ra(this,function(e){switch(e.label){case 0:return[4,this.saveIterations()];case 1:return[2,[e.sent()]]}})})},t.prototype.setWeights=function(e){return Aa(this,void 0,void 0,function(){return Ra(this,function(t){switch(t.label){case 0:return[4,this.extractIterations(e)];case 1:if(0!==(e=t.sent()).length)throw new Error("SGD optimizer does not have settable weights.");return[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate}},t.fromConfig=function(e,t){return new e(t.learningRate)},t.className="SGD",t}(Av);Ev(Lv);var Pv=function(e){function t(t,n,r){void 0===r&&(r=!1);var a=e.call(this,t)||this;return a.learningRate=t,a.momentum=n,a.useNesterov=r,a.accumulations=[],a.m=Fs(a.momentum),a}return _a(t,e),t.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map(function(e){return e.name}):Object.keys(e)).forEach(function(n,r){var a=no.registeredVariables[n];null==t.accumulations[r]&&(t.accumulations[r]={originalName:n+"/momentum",variable:ls(function(){return Ws(a).variable(!1)})});var i=t.accumulations[r].variable,o=Array.isArray(e)?e[r].tensor:e[n];null!=o&&ls(function(){var e,n=t.m.mul(i).add(o);e=t.useNesterov?t.c.mul(o.add(n.mul(t.m))).add(a):t.c.mul(n).add(a),i.assign(n),a.assign(e)})}),this.incrementIterations()},t.prototype.dispose=function(){this.m.dispose(),null!=this.accumulations&&us(this.accumulations.map(function(e){return e.variable}))},t.prototype.setMomentum=function(e){this.momentum=e},t.prototype.getWeights=function(){return Aa(this,void 0,void 0,function(){return Ra(this,function(e){switch(e.label){case 0:return[4,this.saveIterations()];case 1:return[2,[e.sent()].concat(this.accumulations.map(function(e){return{name:e.originalName,tensor:e.variable}}))]}})})},t.prototype.setWeights=function(e){return Aa(this,void 0,void 0,function(){return Ra(this,function(t){switch(t.label){case 0:return[4,this.extractIterations(e)];case 1:return e=t.sent(),this.accumulations=e.map(function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}}),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},t.fromConfig=function(e,t){return new e(t.learningRate,t.momentum,t.useNesterov)},t.className="Momentum",t}(Lv);Ev(Pv);var Mv=function(e){function t(t,n,r,a,i){void 0===n&&(n=.9),void 0===r&&(r=0),void 0===a&&(a=null),void 0===i&&(i=!1);var o=e.call(this)||this;if(o.learningRate=t,o.decay=n,o.momentum=r,o.epsilon=a,o.accumulatedMeanSquares=[],o.accumulatedMoments=[],o.accumulatedMeanGrads=[],o.centered=i,null==a&&(o.epsilon=no.backend.epsilon()),null==t)throw new Error("learningRate for RMSPropOptimizer must be defined.");return o}return _a(t,e),t.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map(function(e){return e.name}):Object.keys(e)).forEach(function(n,r){var a=no.registeredVariables[n];null==t.accumulatedMeanSquares[r]&&(t.accumulatedMeanSquares[r]={originalName:n+"/rms",variable:ls(function(){return Ws(a).variable(!1)})}),null==t.accumulatedMoments[r]&&(t.accumulatedMoments[r]={originalName:n+"/momentum",variable:ls(function(){return Ws(a).variable(!1)})}),null==t.accumulatedMeanGrads[r]&&t.centered&&(t.accumulatedMeanGrads[r]={originalName:n+"/mg",variable:ls(function(){return Ws(a).variable(!1)})});var i=Array.isArray(e)?e[r].tensor:e[n];if(null!=i){var o=t.accumulatedMeanSquares[r].variable,s=t.accumulatedMoments[r].variable;ls(function(){var e=o.mul(t.decay).add(i.square().mul(1-t.decay));if(t.centered){var n=t.accumulatedMeanGrads[r].variable,c=n.mul(t.decay).add(i.mul(1-t.decay)),l=s.mul(t.momentum).add(i.mul(t.learningRate).div(e.sub(c.square().add(t.epsilon)).sqrt()));o.assign(e),n.assign(c),s.assign(l);var u=a.sub(l);a.assign(u)}else{var h=o.mul(t.decay).add(i.square().mul(1-t.decay));l=s.mul(t.momentum).add(i.mul(t.learningRate).div(h.add(t.epsilon).sqrt())),o.assign(h),s.assign(l),u=a.sub(l),a.assign(u)}})}}),this.incrementIterations()},t.prototype.dispose=function(){null!=this.accumulatedMeanSquares&&us(this.accumulatedMeanSquares.map(function(e){return e.variable})),null!=this.accumulatedMeanGrads&&this.centered&&us(this.accumulatedMeanGrads.map(function(e){return e.variable})),null!=this.accumulatedMoments&&us(this.accumulatedMoments.map(function(e){return e.variable}))},t.prototype.getWeights=function(){return Aa(this,void 0,void 0,function(){var e;return Ra(this,function(t){switch(t.label){case 0:return e=this.accumulatedMeanSquares.concat(this.accumulatedMoments),this.centered&&e.push.apply(e,this.accumulatedMeanGrads),[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(e.map(function(e){return{name:e.originalName,tensor:e.variable}}))]}})})},t.prototype.setWeights=function(e){return Aa(this,void 0,void 0,function(){var t;return Ra(this,function(n){switch(n.label){case 0:return[4,this.extractIterations(e)];case 1:return e=n.sent(),t=this.centered?e.length/3:e.length/2,this.accumulatedMeanSquares=e.slice(0,t).map(function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}}),this.accumulatedMoments=e.slice(t,2*t).map(function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}}),this.centered&&(this.accumulatedMeanGrads=e.slice(2*t,3*t).map(function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},t.fromConfig=function(e,t){return new e(t.learningRate,t.decay,t.momentum,t.epsilon,t.centered)},t.className="RMSProp",t}(Av);Ev(Mv);var jv=function(){function e(){}return e.sgd=function(e){return new Lv(e)},e.momentum=function(e,t,n){return void 0===n&&(n=!1),new Pv(e,t,n)},e.rmsprop=function(e,t,n,r,a){return void 0===t&&(t=.9),void 0===n&&(n=0),void 0===r&&(r=null),void 0===a&&(a=!1),new Mv(e,t,n,r,a)},e.adam=function(e,t,n,r){return void 0===e&&(e=.001),void 0===t&&(t=.9),void 0===n&&(n=.999),void 0===r&&(r=null),new Dv(e,t,n,r)},e.adadelta=function(e,t,n){return void 0===e&&(e=.001),void 0===t&&(t=.95),void 0===n&&(n=null),new Rv(e,t,n)},e.adamax=function(e,t,n,r,a){return void 0===e&&(e=.002),void 0===t&&(t=.9),void 0===n&&(n=.999),void 0===r&&(r=null),void 0===a&&(a=0),new Ov(e,t,n,r,a)},e.adagrad=function(e,t){return void 0===t&&(t=.1),new Fv(e,t)},e}();jv.sgd,jv.momentum,jv.adadelta,jv.adagrad,jv.rmsprop,jv.adamax,jv.adam,"undefined"!=typeof requestAnimationFrame?requestAnimationFrame:"undefined"!=typeof setImmediate&&setImmediate;zi.prototype.squaredDifference=function(e){return _d(this,e)},ji=fg;var Bv=function(e,t){return Bv=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},Bv(e,t)};function zv(e,t){function n(){this.constructor=e}Bv(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var Uv=function(){return Uv=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},Uv.apply(this,arguments)};function Wv(e,t,n,r){return new(n||(n=Promise))(function(a,i){function o(e){try{c(r.next(e))}catch(_a){i(_a)}}function s(e){try{c(r.throw(e))}catch(_a){i(_a)}}function c(e){e.done?a(e.value):function(e){return e instanceof n?e:new n(function(t){t(e)})}(e.value).then(o,s)}c((r=r.apply(e,t||[])).next())})}function Vv(e,t){var n,r,a,i,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(a=(a=o.trys).length>0&&a[a.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(_a){i=[6,_a],r=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}function Hv(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),a=0;for(t=0;t<n;t++)for(var i=arguments[t],o=0,s=i.length;o<s;o++,a++)r[a]=i[o];return r}var Gv=function(){function e(e,t){if(!Zv(e)||!Zv(t))throw new Error("Dimensions.constructor - expected width and height to be valid numbers, instead have "+JSON.stringify({width:e,height:t}));this._width=e,this._height=t}return Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),e.prototype.reverse=function(){return new e(1/this.width,1/this.height)},e}();function qv(e,t){return e instanceof zi&&e.shape.length===t}function Kv(e){return qv(e,3)}function Xv(e){return qv(e,4)}function Yv(e){return e%2===0}function $v(e){return e&&e.width&&e.height}function Jv(e){return e.reduce(function(e,t){return e.add(t)},new tb(0,0)).div(new tb(e.length,e.length))}function Qv(e,t,n){return Array(e).fill(0).map(function(e,r){return t+r*n})}function Zv(e){return!!e&&e!==1/0&&e!==-1/0&&!isNaN(e)||0===e}function eb(e){return Zv(e)&&0<=e&&e<=1}var tb=function(){function e(e,t){this._x=e,this._y=t}return Object.defineProperty(e.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),e.prototype.add=function(t){return new e(this.x+t.x,this.y+t.y)},e.prototype.sub=function(t){return new e(this.x-t.x,this.y-t.y)},e.prototype.mul=function(t){return new e(this.x*t.x,this.y*t.y)},e.prototype.div=function(t){return new e(this.x/t.x,this.y/t.y)},e.prototype.abs=function(){return new e(Math.abs(this.x),Math.abs(this.y))},e.prototype.magnitude=function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))},e.prototype.floor=function(){return new e(Math.floor(this.x),Math.floor(this.y))},e}(),nb=function(){function e(t,n){void 0===n&&(n=!0);var r=t||{},a=[r.left,r.top,r.right,r.bottom].every(Zv),i=[r.x,r.y,r.width,r.height].every(Zv);if(!i&&!a)throw new Error("Box.constructor - expected box to be IBoundingBox | IRect, instead have "+JSON.stringify(r));var o=i?[r.x,r.y,r.width,r.height]:[r.left,r.top,r.right-r.left,r.bottom-r.top],s=o[0],c=o[1],l=o[2],u=o[3];e.assertIsValidBox({x:s,y:c,width:l,height:u},"Box.constructor",n),this._x=s,this._y=c,this._width=l,this._height=u}return e.isRect=function(e){return!!e&&[e.x,e.y,e.width,e.height].every(Zv)},e.assertIsValidBox=function(t,n,r){if(void 0===r&&(r=!1),!e.isRect(t))throw new Error(n+" - invalid box: "+JSON.stringify(t)+", expected object with properties x, y, width, height");if(!r&&(t.width<0||t.height<0))throw new Error(n+" - width ("+t.width+") and height ("+t.height+") must be positive numbers")},Object.defineProperty(e.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"left",{get:function(){return this.x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"top",{get:function(){return this.y},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"right",{get:function(){return this.x+this.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"area",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"topLeft",{get:function(){return new tb(this.left,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"topRight",{get:function(){return new tb(this.right,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottomLeft",{get:function(){return new tb(this.left,this.bottom)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottomRight",{get:function(){return new tb(this.right,this.bottom)},enumerable:!0,configurable:!0}),e.prototype.round=function(){var t=[this.x,this.y,this.width,this.height].map(function(e){return Math.round(e)});return new e({x:t[0],y:t[1],width:t[2],height:t[3]})},e.prototype.floor=function(){var t=[this.x,this.y,this.width,this.height].map(function(e){return Math.floor(e)});return new e({x:t[0],y:t[1],width:t[2],height:t[3]})},e.prototype.toSquare=function(){var t=this,n=t.x,r=t.y,a=t.width,i=t.height,o=Math.abs(a-i);return a<i&&(n-=o/2,a+=o),i<a&&(r-=o/2,i+=o),new e({x:n,y:r,width:a,height:i})},e.prototype.rescale=function(t){var n=$v(t)?t.width:t,r=$v(t)?t.height:t;return new e({x:this.x*n,y:this.y*r,width:this.width*n,height:this.height*r})},e.prototype.pad=function(t,n){var r=[this.x-t/2,this.y-n/2,this.width+t,this.height+n];return new e({x:r[0],y:r[1],width:r[2],height:r[3]})},e.prototype.clipAtImageBorders=function(t,n){var r=this,a=r.x,i=r.y,o=r.right,s=r.bottom,c=Math.max(a,0),l=Math.max(i,0),u=o-c,h=s-l;return new e({x:c,y:l,width:Math.min(u,t-c),height:Math.min(h,n-l)}).floor()},e.prototype.shift=function(t,n){var r=this.width,a=this.height;return new e({x:this.x+t,y:this.y+n,width:r,height:a})},e.prototype.padAtBorders=function(e,t){var n=this.width+1,r=this.height+1,a=n,i=r,o=this.left,s=this.top,c=this.right,l=this.bottom;return c>t&&(a=-c+t+n,c=t),l>e&&(i=-l+e+r,l=e),o<1&&(i=2-o,o=1),s<1&&(i=2-s,s=1),{dy:1,edy:i,dx:1,edx:a,y:s,ey:l,x:o,ex:c,w:n,h:r}},e.prototype.calibrate=function(t){return new e({left:this.left+t.left*this.width,top:this.top+t.top*this.height,right:this.right+t.right*this.width,bottom:this.bottom+t.bottom*this.height}).toSquare().round()},e}(),rb=function(e){function t(t,n,r,a,i){return void 0===i&&(i=!1),e.call(this,{left:t,top:n,right:r,bottom:a},i)||this}return zv(t,e),t}(nb),ab=function(){function e(e,t,n,r,a){this._imageDims=new Gv(a.width,a.height),this._score=e,this._classScore=t,this._className=n,this._box=new nb(r).rescale(this._imageDims)}return Object.defineProperty(e.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"className",{get:function(){return this._className},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"box",{get:function(){return this._box},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageDims",{get:function(){return this._imageDims},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageWidth",{get:function(){return this.imageDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageHeight",{get:function(){return this.imageDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"relativeBox",{get:function(){return new nb(this._box).rescale(this.imageDims.reverse())},enumerable:!0,configurable:!0}),e.prototype.forSize=function(t,n){return new e(this.score,this.classScore,this.className,this.relativeBox,{width:t,height:n})},e}(),ib=function(e){function t(t,n,r){return e.call(this,t,t,"",n,r)||this}return zv(t,e),t.prototype.forSize=function(n,r){var a=e.prototype.forSize.call(this,n,r);return new t(a.score,a.relativeBox,a.imageDims)},t}(ab);function ob(e,t,n){void 0===n&&(n=!0);var r=Math.max(0,Math.min(e.right,t.right)-Math.max(e.left,t.left))*Math.max(0,Math.min(e.bottom,t.bottom)-Math.max(e.top,t.top));return n?r/(e.area+t.area-r):r/Math.min(e.area,t.area)}function sb(e,t,n,r){void 0===r&&(r=!0);for(var a=t.map(function(e,t){return{score:e,boxIndex:t}}).sort(function(e,t){return e.score-t.score}).map(function(e){return e.boxIndex}),i=[],o=function(){var t=a.pop();i.push(t);for(var o=a,s=[],c=0;c<o.length;c++){var l=o[c],u=e[t],h=e[l];s.push(ob(u,h,r))}a=a.filter(function(e,t){return s[t]<=n})};a.length>0;)o();return i}function cb(e,t){return ls(function(){var n=t[0],r=t[1],a=t[2],i=Bs(Hv(e.shape.slice(0,3),[1]),n),o=Bs(Hv(e.shape.slice(0,3),[1]),r),s=Bs(Hv(e.shape.slice(0,3),[1]),a),c=Vs([i,o,s],3);return $f(e,c)})}function lb(e){return 1/(1+Math.exp(-e))}var ub,hb=function(e){function t(t,n,r,a,i){return void 0===i&&(i=!1),e.call(this,{x:t,y:n,width:r,height:a},i)||this}return zv(t,e),t}(nb),db=function(){function e(e,t,n){void 0===n&&(n=new tb(0,0));var r=t.width,a=t.height;this._imgDims=new Gv(r,a),this._shift=n,this._positions=e.map(function(e){return e.mul(new tb(r,a)).add(n)})}return Object.defineProperty(e.prototype,"shift",{get:function(){return new tb(this._shift.x,this._shift.y)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageWidth",{get:function(){return this._imgDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageHeight",{get:function(){return this._imgDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"positions",{get:function(){return this._positions},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"relativePositions",{get:function(){var e=this;return this._positions.map(function(t){return t.sub(e._shift).div(new tb(e.imageWidth,e.imageHeight))})},enumerable:!0,configurable:!0}),e.prototype.forSize=function(e,t){return new this.constructor(this.relativePositions,{width:e,height:t})},e.prototype.shiftBy=function(e,t){return new this.constructor(this.relativePositions,this._imgDims,new tb(e,t))},e.prototype.shiftByPoint=function(e){return this.shiftBy(e.x,e.y)},e.prototype.align=function(e,t){if(void 0===t&&(t={}),e){var n=e instanceof ib?e.box.floor():new nb(e);return this.shiftBy(n.x,n.y).align(null,t)}var r=Object.assign({},{useDlibAlignment:!1,minBoxPadding:.2},t),a=r.useDlibAlignment,i=r.minBoxPadding;return a?this.alignDlib():this.alignMinBbox(i)},e.prototype.alignDlib=function(){var e=this.getRefPointsForAlignment(),t=e[0],n=e[1],r=e[2],a=function(e){return r.sub(e).magnitude()},i=(a(t)+a(n))/2,o=Math.floor(i/.45),s=Jv(e),c=Math.floor(Math.max(0,s.x-.5*o)),l=Math.floor(Math.max(0,s.y-.43*o));return new hb(c,l,Math.min(o,this.imageWidth+c),Math.min(o,this.imageHeight+l))},e.prototype.alignMinBbox=function(e){var t=function(e){var t=e.map(function(e){return e.x}),n=e.map(function(e){return e.y}),r=t.reduce(function(e,t){return t<e?t:e},1/0),a=n.reduce(function(e,t){return t<e?t:e},1/0),i=t.reduce(function(e,t){return e<t?t:e},0),o=n.reduce(function(e,t){return e<t?t:e},0);return new rb(r,a,i,o)}(this.positions);return t.pad(t.width*e,t.height*e)},e.prototype.getRefPointsForAlignment=function(){throw new Error("getRefPointsForAlignment not implemented by base class")},e}(),fb=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return zv(t,e),t.prototype.getRefPointsForAlignment=function(){var e=this.positions;return[e[0],e[1],Jv([e[3],e[4]])]},t}(db),pb=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return zv(t,e),t.prototype.getJawOutline=function(){return this.positions.slice(0,17)},t.prototype.getLeftEyeBrow=function(){return this.positions.slice(17,22)},t.prototype.getRightEyeBrow=function(){return this.positions.slice(22,27)},t.prototype.getNose=function(){return this.positions.slice(27,36)},t.prototype.getLeftEye=function(){return this.positions.slice(36,42)},t.prototype.getRightEye=function(){return this.positions.slice(42,48)},t.prototype.getMouth=function(){return this.positions.slice(48,68)},t.prototype.getRefPointsForAlignment=function(){return[this.getLeftEye(),this.getRightEye(),this.getMouth()].map(Jv)},t}(db),mb=function(){function e(e,t){this._label=e,this._distance=t}return Object.defineProperty(e.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"distance",{get:function(){return this._distance},enumerable:!0,configurable:!0}),e.prototype.toString=function(e){return void 0===e&&(e=!0),this.label+(e?" ("+function(e,t){void 0===t&&(t=2);var n=Math.pow(10,t);return Math.floor(e*n)/n}(this.distance)+")":"")},e}(),gb=function(e){function t(t,n){var r=e.call(this,t)||this;return r._label=n,r}return zv(t,e),t.assertIsValidLabeledBox=function(e,t){if(nb.assertIsValidBox(e,t),!Zv(e.label))throw new Error(t+" - expected property label ("+e.label+") to be a number")},Object.defineProperty(t.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),t}(nb),vb=function(){function e(e,t){if("string"!==typeof e)throw new Error("LabeledFaceDescriptors - constructor expected label to be a string");if(!Array.isArray(t)||t.some(function(e){return!(e instanceof Float32Array)}))throw new Error("LabeledFaceDescriptors - constructor expected descriptors to be an array of Float32Array");this._label=e,this._descriptors=t}return Object.defineProperty(e.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"descriptors",{get:function(){return this._descriptors},enumerable:!0,configurable:!0}),e.prototype.toJSON=function(){return{label:this.label,descriptors:this.descriptors.map(function(e){return Array.from(e)})}},e.fromJSON=function(t){var n=t.descriptors.map(function(e){return new Float32Array(e)});return new e(t.label,n)},e}();!function(e){function t(t,n,r,a){var i=e.call(this,t,n)||this;return i._score=r,i._classScore=a,i}zv(t,e),t.assertIsValidPredictedBox=function(e,t){if(gb.assertIsValidLabeledBox(e,t),!eb(e.score)||!eb(e.classScore))throw new Error(t+" - expected properties score ("+e.score+") and ("+e.classScore+") to be a number between [0, 1]")},Object.defineProperty(t.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0})}(gb);function bb(e,t){var n={detection:t};return Object.assign({},e,n)}function yb(){var e=window.fetch||function(){throw new Error("fetch - missing fetch implementation for browser environment")};return{Canvas:HTMLCanvasElement,CanvasRenderingContext2D:CanvasRenderingContext2D,Image:HTMLImageElement,ImageData:ImageData,Video:HTMLVideoElement,createCanvasElement:function(){return document.createElement("canvas")},createImageElement:function(){return document.createElement("img")},fetch:e,readFile:function(){throw new Error("readFile - filesystem not available for browser environment")}}}function xb(e){var t="";if(!e)try{e=n(Object(function(){var e=new Error("Cannot find module 'fs'");throw e.code="MODULE_NOT_FOUND",e}()))}catch(a){t=a.toString()}var r=e?function(t){return new Promise(function(n,r){e.readFile(t,function(e,t){return e?r(e):n(t)})})}:function(){throw new Error("readFile - failed to require fs in nodejs environment with error: "+t)};return{readFile:r}}function wb(){var e=n.g.Canvas||n.g.HTMLCanvasElement,t=n.g.Image||n.g.HTMLImageElement,r=n.g.fetch||function(){throw new Error("fetch - missing fetch implementation for nodejs environment")},a=xb();return Uv({Canvas:e||function(){},CanvasRenderingContext2D:n.g.CanvasRenderingContext2D||function(){},Image:t||function(){},ImageData:n.g.ImageData||function(){},Video:n.g.HTMLVideoElement||function(){},createCanvasElement:function(){if(e)return new e;throw new Error("createCanvasElement - missing Canvas implementation for nodejs environment")},createImageElement:function(){if(t)return new t;throw new Error("createImageElement - missing Image implementation for nodejs environment")},fetch:r},a)}function kb(){return"object"===typeof window&&"undefined"!==typeof document&&"undefined"!==typeof HTMLImageElement&&"undefined"!==typeof HTMLCanvasElement&&"undefined"!==typeof HTMLVideoElement&&"undefined"!==typeof ImageData&&"undefined"!==typeof CanvasRenderingContext2D}function Sb(){return"object"===typeof n.g&&"undefined"!==typeof process&&!!process.version}function Nb(e){ub=e}function Cb(){kb()&&Nb(yb()),Sb()&&Nb(wb())}var Eb,Ib={getEnv:function(){if(!ub)throw new Error("getEnv - environment is not defined, check isNodejs() and isBrowser()");return ub},setEnv:Nb,initialize:Cb,createBrowserEnv:yb,createFileSystem:xb,createNodejsEnv:wb,monkeyPatch:function(e){if(ub||Cb(),!ub)throw new Error("monkeyPatch - environment is not defined, check isNodejs() and isBrowser()");var t=e.Canvas,n=void 0===t?ub.Canvas:t,r=e.Image,a=void 0===r?ub.Image:r;ub.Canvas=n,ub.Image=a,ub.createCanvasElement=e.createCanvasElement||function(){return new n},ub.createImageElement=e.createImageElement||function(){return new a},ub.ImageData=e.ImageData||ub.ImageData,ub.Video=e.Video||ub.Video,ub.fetch=e.fetch||ub.fetch,ub.readFile=e.readFile||ub.readFile},isBrowser:kb,isNodejs:Sb};function Tb(e){return Ib.isNodejs()||"string"!==typeof e?e:document.getElementById(e)}function _b(e){var t=Ib.getEnv(),n=t.Canvas;if(e instanceof t.CanvasRenderingContext2D)return e;var r=Tb(e);if(!(r instanceof n))throw new Error("resolveContext2d - expected canvas to be of instance of Canvas");var a=r.getContext("2d");if(!a)throw new Error("resolveContext2d - canvas 2d context is null");return a}Cb(),function(e){e.TOP_LEFT="TOP_LEFT",e.TOP_RIGHT="TOP_RIGHT",e.BOTTOM_LEFT="BOTTOM_LEFT",e.BOTTOM_RIGHT="BOTTOM_RIGHT"}(Eb||(Eb={}));var Ab=function(e){void 0===e&&(e={});var t=e.anchorPosition,n=e.backgroundColor,r=e.fontColor,a=e.fontSize,i=e.fontStyle,o=e.padding;this.anchorPosition=t||Eb.TOP_LEFT,this.backgroundColor=n||"rgba(0, 0, 0, 0.5)",this.fontColor=r||"rgba(255, 255, 255, 1)",this.fontSize=a||14,this.fontStyle=i||"Georgia",this.padding=o||4},Rb=function(){function e(t,n,r){void 0===r&&(r={}),this.text="string"===typeof t?[t]:t instanceof e?t.text:t,this.anchor=n,this.options=new Ab(r)}return e.prototype.measureWidth=function(e){var t=this.options.padding;return this.text.map(function(t){return e.measureText(t).width}).reduce(function(e,t){return e<t?t:e},0)+2*t},e.prototype.measureHeight=function(){var e=this.options,t=e.fontSize,n=e.padding;return this.text.length*t+2*n},e.prototype.getUpperLeft=function(e,t){var n=this.options.anchorPosition,r=n===Eb.BOTTOM_RIGHT||n===Eb.TOP_RIGHT,a=n===Eb.BOTTOM_LEFT||n===Eb.BOTTOM_RIGHT,i=this.measureWidth(e),o=this.measureHeight(),s=r?this.anchor.x-i:this.anchor.x,c=a?this.anchor.y-o:this.anchor.y;if(t){var l=t.width,u=t.height;return{x:Math.max(Math.min(s,l-i),0),y:Math.max(Math.min(c,u-o),0)}}return{x:s,y:c}},e.prototype.draw=function(e){var t=Tb(e),n=_b(t),r=this.options,a=r.backgroundColor,i=r.fontColor,o=r.fontSize,s=r.fontStyle,c=r.padding;n.font=o+"px "+s;var l=this.measureWidth(n),u=this.measureHeight();n.fillStyle=a;var h=this.getUpperLeft(n,t);n.fillRect(h.x,h.y,l,u),n.fillStyle=i,this.text.forEach(function(e,t){var r=c+h.x,a=c+h.y+(t+1)*o;n.fillText(e,r,a)})},e}(),Fb=function(e){void 0===e&&(e={});var t=e.boxColor,n=e.lineWidth,r=e.label,a=e.drawLabelOptions;this.boxColor=t||"rgba(0, 0, 255, 1)",this.lineWidth=n||2,this.label=r;var i={anchorPosition:Eb.BOTTOM_LEFT,backgroundColor:this.boxColor};this.drawLabelOptions=new Ab(Object.assign({},i,a))};!function(){function e(e,t){void 0===t&&(t={}),this.box=new nb(e),this.options=new Fb(t)}e.prototype.draw=function(e){var t=_b(e),n=this.options,r=n.boxColor,a=n.lineWidth,i=this.box,o=i.x,s=i.y,c=i.width,l=i.height;t.strokeStyle=r,t.lineWidth=a,t.strokeRect(o,s,c,l);var u=this.options.label;u&&new Rb([u],{x:o-a/2,y:s},this.options.drawLabelOptions).draw(e)}}();function Db(e){var t=Ib.getEnv(),n=t.Image,r=t.Video;return e instanceof n&&e.complete||e instanceof r&&e.readyState>=3}function Ob(e){var t=Ib.getEnv(),n=t.Image,r=t.Video;return e instanceof n?new Gv(e.naturalWidth,e.naturalHeight):e instanceof r?new Gv(e.videoWidth,e.videoHeight):new Gv(e.width,e.height)}function Lb(e){var t=e.width,n=e.height,r=(0,Ib.getEnv().createCanvasElement)();return r.width=t,r.height=n,r}function Pb(e,t){var n=Ib.getEnv().ImageData;if(!(e instanceof n)&&!Db(e))throw new Error("createCanvasFromMedia - media has not finished loading yet");var r=t||Ob(e),a=r.width,i=r.height,o=Lb({width:a,height:i});return e instanceof n?_b(o).putImageData(e,0,0):_b(o).drawImage(e,0,0,a,i),o}function Mb(e,t){return Wv(this,void 0,void 0,function(){var n,r,a,i,o,s;return Vv(this,function(c){switch(c.label){case 0:return n=t||Ib.getEnv().createCanvasElement(),r=e.shape.slice(Xv(e)?1:0),a=r[0],i=r[1],o=r[2],s=ls(function(){return e.as3D(a,i,o).toInt()}),[4,Sv.toPixels(s,n)];case 1:return c.sent(),s.dispose(),[2,n]}})})}function jb(e){var t=Ib.getEnv(),n=t.Image,r=t.Canvas,a=t.Video;return e instanceof n||e instanceof r||e instanceof a}var Bb=function(){function e(e,t){var n=this;if(void 0===t&&(t=!1),this._imageTensors=[],this._canvases=[],this._treatAsBatchInput=!1,this._inputDimensions=[],!Array.isArray(e))throw new Error("NetInput.constructor - expected inputs to be an Array of TResolvedNetInput or to be instanceof tf.Tensor4D, instead have "+e);this._treatAsBatchInput=t,this._batchSize=e.length,e.forEach(function(e,t){if(Kv(e))return n._imageTensors[t]=e,void(n._inputDimensions[t]=e.shape);if(Xv(e)){var r=e.shape[0];if(1!==r)throw new Error("NetInput - tf.Tensor4D with batchSize "+r+" passed, but not supported in input array");return n._imageTensors[t]=e,void(n._inputDimensions[t]=e.shape.slice(1))}var a=e instanceof Ib.getEnv().Canvas?e:Pb(e);n._canvases[t]=a,n._inputDimensions[t]=[a.height,a.width,3]})}return Object.defineProperty(e.prototype,"imageTensors",{get:function(){return this._imageTensors},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"canvases",{get:function(){return this._canvases},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isBatchInput",{get:function(){return this.batchSize>1||this._treatAsBatchInput},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"batchSize",{get:function(){return this._batchSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inputDimensions",{get:function(){return this._inputDimensions},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"reshapedInputDimensions",{get:function(){var e=this;return Qv(this.batchSize,0,1).map(function(t,n){return e.getReshapedInputDimensions(n)})},enumerable:!0,configurable:!0}),e.prototype.getInput=function(e){return this.canvases[e]||this.imageTensors[e]},e.prototype.getInputDimensions=function(e){return this._inputDimensions[e]},e.prototype.getInputHeight=function(e){return this._inputDimensions[e][0]},e.prototype.getInputWidth=function(e){return this._inputDimensions[e][1]},e.prototype.getReshapedInputDimensions=function(e){if("number"!==typeof this.inputSize)throw new Error("getReshapedInputDimensions - inputSize not set, toBatchTensor has not been called yet");return function(e,t){var n=e.width,r=e.height,a=t/Math.max(r,n);return new Gv(Math.round(n*a),Math.round(r*a))}({width:this.getInputWidth(e),height:this.getInputHeight(e)},this.inputSize)},e.prototype.toBatchTensor=function(e,t){var n=this;return void 0===t&&(t=!0),this._inputSize=e,ls(function(){var r=Qv(n.batchSize,0,1).map(function(r){var a=n.getInput(r);if(a instanceof zi){var i=Xv(a)?a:a.expandDims();return i=function(e,t){return void 0===t&&(t=!1),ls(function(){var n=e.shape.slice(1),r=n[0],a=n[1];if(r===a)return e;var i=Math.abs(r-a),o=Math.round(i*(t?.5:1)),s=r>a?2:1,c=function(t){var n=e.shape.slice();return n[s]=t,Bs(n,0)},l=c(o),u=i-l.shape[s],h=[t&&u?c(u):null,e,l].filter(function(e){return!!e}).map(function(e){return e.toFloat()});return Vs(h,s)})}(i,t),i.shape[1]===e&&i.shape[2]===e||(i=ag.resizeBilinear(i,[e,e])),i.as3D(e,e,3)}if(a instanceof Ib.getEnv().Canvas)return Sv.fromPixels(function(e,t,n){void 0===n&&(n=!1);var r=Ib.getEnv(),a=r.Image,i=r.Canvas;if(!(e instanceof a||e instanceof i))throw new Error("imageToSquare - expected arg0 to be HTMLImageElement | HTMLCanvasElement");var o=Ob(e),s=t/Math.max(o.height,o.width),c=s*o.width,l=s*o.height,u=Lb({width:t,height:t}),h=e instanceof i?e:Pb(e),d=Math.abs(c-l)/2,f=n&&c<l?d:0,p=n&&l<c?d:0;return _b(u).drawImage(h,f,p,c,l),u}(a,e,t));throw new Error("toBatchTensor - at batchIdx "+r+", expected input to be instanceof tf.Tensor or instanceof HTMLCanvasElement, instead have "+a)}),a=Ac(r.map(function(e){return e.toFloat()})).as4D(n.batchSize,e,e,3);return a})},e}();function zb(e){return Wv(this,void 0,void 0,function(){var t,n,r;return Vv(this,function(a){switch(a.label){case 0:if(e instanceof Bb)return[2,e];if(!(t=Array.isArray(e)?e:[e]).length)throw new Error("toNetInput - empty array passed as input");return n=function(t){return Array.isArray(e)?" at input index "+t+":":""},(r=t.map(Tb)).forEach(function(e,r){if(!jb(e)&&!Kv(e)&&!Xv(e)){if("string"===typeof t[r])throw new Error("toNetInput -"+n(r)+" string passed, but could not resolve HTMLElement for element id "+t[r]);throw new Error("toNetInput -"+n(r)+" expected media to be of type HTMLImageElement | HTMLVideoElement | HTMLCanvasElement | tf.Tensor3D, or to be an element id")}if(Xv(e)){var a=e.shape[0];if(1!==a)throw new Error("toNetInput -"+n(r)+" tf.Tensor4D with batchSize "+a+" passed, but not supported in input array")}}),[4,Promise.all(r.map(function(e){return jb(e)&&(t=e,new Promise(function(e,n){if(t instanceof Ib.getEnv().Canvas||Db(t))return e();function r(t){t.currentTarget&&(t.currentTarget.removeEventListener("load",r),t.currentTarget.removeEventListener("error",a),e(t))}function a(e){e.currentTarget&&(e.currentTarget.removeEventListener("load",r),e.currentTarget.removeEventListener("error",a),n(e))}t.addEventListener("load",r),t.addEventListener("error",a)}));var t}))];case 1:return a.sent(),[2,new Bb(r,Array.isArray(e))]}})})}function Ub(e,t){return Wv(this,void 0,void 0,function(){var n,r,a,i,o,s;return Vv(this,function(c){switch(c.label){case 0:return n=Ib.getEnv().Canvas,r=e,e instanceof n?[3,5]:[4,zb(e)];case 1:if((a=c.sent()).batchSize>1)throw new Error("extractFaces - batchSize > 1 not supported");return(i=a.getInput(0))instanceof n?(o=i,[3,4]):[3,2];case 2:return[4,Mb(i)];case 3:o=c.sent(),c.label=4;case 4:r=o,c.label=5;case 5:return s=_b(r),[2,t.map(function(e){return e instanceof ib?e.forSize(r.width,r.height).box.floor():e}).map(function(e){return e.clipAtImageBorders(r.width,r.height)}).map(function(e){var t=e.x,n=e.y,r=e.width,a=e.height,i=Lb({width:r,height:a});return _b(i).putImageData(s.getImageData(t,n,r,a),0,0),i})]}})})}function Wb(e,t){return Wv(this,void 0,void 0,function(){return Vv(this,function(n){if(!Kv(e)&&!Xv(e))throw new Error("extractFaceTensors - expected image tensor to be 3D or 4D");if(Xv(e)&&e.shape[0]>1)throw new Error("extractFaceTensors - batchSize > 1 not supported");return[2,ls(function(){var n=e.shape.slice(Xv(e)?1:0),r=n[0],a=n[1],i=n[2],o=t.map(function(e){return e instanceof ib?e.forSize(a,r).box:e}).map(function(e){return e.clipAtImageBorders(a,r)}).map(function(t){var n=t.x,o=t.y,s=t.width,c=t.height;return qp(e.as3D(r,a,i),[o,n,0],[c,s,i])});return o})]})})}function Vb(e,t){return Wv(this,void 0,void 0,function(){var n;return Vv(this,function(r){switch(r.label){case 0:return[4,(0,Ib.getEnv().fetch)(e,t)];case 1:if(!((n=r.sent()).status<400))throw new Error("failed to fetch: ("+n.status+") "+n.statusText+", from url: "+n.url);return[2,n]}})})}function Hb(e){return Wv(this,void 0,void 0,function(){var t,n;return Vv(this,function(r){switch(r.label){case 0:return[4,Vb(e)];case 1:return[4,(t=r.sent()).blob()];case 2:if(!(n=r.sent()).type.startsWith("image/"))throw new Error("fetchImage - expected blob type to be of type image/*, instead have: "+n.type+", for url: "+t.url);return[2,(a=n,new Promise(function(e,t){if(!(a instanceof Blob))return t("bufferToImage - expected buf to be of type: Blob");var n=new FileReader;n.onload=function(){if("string"!==typeof n.result)return t("bufferToImage - expected reader.result to be a string, in onload");var r=Ib.getEnv().createImageElement();r.onload=function(){return e(r)},r.onerror=t,r.src=n.result},n.onerror=t,n.readAsDataURL(a)}))]}var a})})}function Gb(e){return Wv(this,void 0,void 0,function(){return Vv(this,function(t){switch(t.label){case 0:return[4,Vb(e)];case 1:return[2,t.sent().json()]}})})}function qb(e,t){var n=t+"-weights_manifest.json";if(!e)return{modelBaseUri:"",manifestUri:n};if("/"===e)return{modelBaseUri:"/",manifestUri:"/"+n};var r=e.startsWith("http://")?"http://":e.startsWith("https://")?"https://":"",a=(e=e.replace(r,"")).split("/").filter(function(e){return e}),i=e.endsWith(".json")?a[a.length-1]:n,o=r+(e.endsWith(".json")?a.slice(0,a.length-1):a).join("/");return{modelBaseUri:o=e.startsWith("/")?"/"+o:o,manifestUri:"/"===o?"/"+i:o+"/"+i}}function Kb(e,t){return Wv(this,void 0,void 0,function(){var n,r,a,i;return Vv(this,function(o){switch(o.label){case 0:return n=qb(e,t),r=n.manifestUri,a=n.modelBaseUri,[4,Gb(r)];case 1:return i=o.sent(),[2,xv.loadWeights(i,a)]}})})}var Xb=function(){function e(e){this._name=e,this._params=void 0,this._paramMappings=[]}return Object.defineProperty(e.prototype,"params",{get:function(){return this._params},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"paramMappings",{get:function(){return this._paramMappings},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isLoaded",{get:function(){return!!this.params},enumerable:!0,configurable:!0}),e.prototype.getParamFromPath=function(e){var t=this.traversePropertyPath(e);return t.obj[t.objProp]},e.prototype.reassignParamFromPath=function(e,t){var n=this.traversePropertyPath(e),r=n.obj,a=n.objProp;r[a].dispose(),r[a]=t},e.prototype.getParamList=function(){var e=this;return this._paramMappings.map(function(t){var n=t.paramPath;return{path:n,tensor:e.getParamFromPath(n)}})},e.prototype.getTrainableParams=function(){return this.getParamList().filter(function(e){return e.tensor instanceof qi})},e.prototype.getFrozenParams=function(){return this.getParamList().filter(function(e){return!(e.tensor instanceof qi)})},e.prototype.variable=function(){var e=this;this.getFrozenParams().forEach(function(t){var n=t.path,r=t.tensor;e.reassignParamFromPath(n,r.variable())})},e.prototype.freeze=function(){var e=this;this.getTrainableParams().forEach(function(t){var n=t.path,r=t.tensor,a=As(r.dataSync());r.dispose(),e.reassignParamFromPath(n,a)})},e.prototype.dispose=function(e){void 0===e&&(e=!0),this.getParamList().forEach(function(t){if(e&&t.tensor.isDisposed)throw new Error("param tensor has already been disposed for path "+t.path);t.tensor.dispose()}),this._params=void 0},e.prototype.serializeParams=function(){return new Float32Array(this.getParamList().map(function(e){var t=e.tensor;return Array.from(t.dataSync())}).reduce(function(e,t){return e.concat(t)}))},e.prototype.load=function(e){return Wv(this,void 0,void 0,function(){return Vv(this,function(t){switch(t.label){case 0:return e instanceof Float32Array?(this.extractWeights(e),[2]):[4,this.loadFromUri(e)];case 1:return t.sent(),[2]}})})},e.prototype.loadFromUri=function(e){return Wv(this,void 0,void 0,function(){var t;return Vv(this,function(n){switch(n.label){case 0:if(e&&"string"!==typeof e)throw new Error(this._name+".loadFromUri - expected model uri");return[4,Kb(e,this.getDefaultModelName())];case 1:return t=n.sent(),this.loadFromWeightMap(t),[2]}})})},e.prototype.loadFromDisk=function(e){return Wv(this,void 0,void 0,function(){var t,n,r,a,i,o,s,c,l,u;return Vv(this,function(h){switch(h.label){case 0:if(e&&"string"!==typeof e)throw new Error(this._name+".loadFromDisk - expected model file path");return t=Ib.getEnv().readFile,n=qb(e,this.getDefaultModelName()),r=n.manifestUri,a=n.modelBaseUri,i=function(e){return Promise.all(e.map(function(e){return t(e).then(function(e){return e.buffer})}))},o=xv.weightsLoaderFactory(i),l=(c=JSON).parse,[4,t(r)];case 1:return s=l.apply(c,[h.sent().toString()]),[4,o(s,a)];case 2:return u=h.sent(),this.loadFromWeightMap(u),[2]}})})},e.prototype.loadFromWeightMap=function(e){var t=this.extractParamsFromWeigthMap(e),n=t.paramMappings,r=t.params;this._paramMappings=n,this._params=r},e.prototype.extractWeights=function(e){var t=this.extractParams(e),n=t.paramMappings,r=t.params;this._paramMappings=n,this._params=r},e.prototype.traversePropertyPath=function(e){if(!this.params)throw new Error("traversePropertyPath - model has no loaded params");var t=e.split("/").reduce(function(t,n){if(!t.nextObj.hasOwnProperty(n))throw new Error("traversePropertyPath - object does not have property "+n+", for path "+e);return{obj:t.nextObj,objProp:n,nextObj:t.nextObj[n]}},{nextObj:this.params}),n=t.obj,r=t.objProp;if(!n||!r||!(n[r]instanceof zi))throw new Error("traversePropertyPath - parameter is not a tensor, for path "+e);return{obj:n,objProp:r}},e}();function Yb(e,t,n){return ls(function(){var r=Cp(e,t.depthwise_filter,t.pointwise_filter,n,"same");return r=Rf(r,t.bias)})}function $b(e,t,n){return void 0===n&&(n=!1),ls(function(){var r=lm(n?Rf(bp(e,t.conv0.filters,[2,2],"same"),t.conv0.bias):Yb(e,t.conv0,[2,2])),a=Yb(r,t.conv1,[1,1]),i=Yb(lm(Rf(r,a)),t.conv2,[1,1]);return lm(Rf(r,Rf(a,i)))})}function Jb(e,t,n,r){return void 0===n&&(n=!1),void 0===r&&(r=!0),ls(function(){var a=lm(n?Rf(bp(e,t.conv0.filters,r?[2,2]:[1,1],"same"),t.conv0.bias):Yb(e,t.conv0,r?[2,2]:[1,1])),i=Yb(a,t.conv1,[1,1]),o=Yb(lm(Rf(a,i)),t.conv2,[1,1]),s=Yb(lm(Rf(a,Rf(i,o))),t.conv3,[1,1]);return lm(Rf(a,Rf(i,Rf(o,s))))})}function Qb(e,t,n,r){return void 0===n&&(n="same"),void 0===r&&(r=!1),ls(function(){var a=Rf(bp(e,t.filters,[1,1],n),t.bias);return r?lm(a):a})}function Zb(e,t){Object.keys(e).forEach(function(n){t.some(function(e){return e.originalPath===n})||e[n].dispose()})}function ey(e,t){return function(n,r,a,i){var o=Ps(e(n*r*a*a),[a,a,n,r]),s=Ds(e(r));return t.push({paramPath:i+"/filters"},{paramPath:i+"/bias"}),{filters:o,bias:s}}}function ty(e,t){return function(n,r,a){var i=Os(e(n*r),[n,r]),o=Ds(e(r));return t.push({paramPath:a+"/weights"},{paramPath:a+"/bias"}),{weights:i,bias:o}}}var ny=function(e,t,n){this.depthwise_filter=e,this.pointwise_filter=t,this.bias=n};function ry(e,t){return function(n,r,a){var i=Ps(e(9*n),[3,3,n,1]),o=Ps(e(n*r),[1,1,n,r]),s=Ds(e(r));return t.push({paramPath:a+"/depthwise_filter"},{paramPath:a+"/pointwise_filter"},{paramPath:a+"/bias"}),new ny(i,o,s)}}function ay(e){return function(t){var n=e(t+"/depthwise_filter",4),r=e(t+"/pointwise_filter",4),a=e(t+"/bias",1);return new ny(n,r,a)}}function iy(e,t){return function(n,r,a){var i=e[n];if(!qv(i,r))throw new Error("expected weightMap["+n+"] to be a Tensor"+r+"D, instead have "+i);return t.push({originalPath:n,paramPath:a||n}),i}}function oy(e){var t=e;return{extractWeights:function(e){var n=t.slice(0,e);return t=t.slice(e),n},getRemainingWeights:function(){return t}}}function sy(e,t){var n=ey(e,t),r=ry(e,t);function a(e,t,a,i){return void 0===i&&(i=!1),{conv0:i?n(e,t,3,a+"/conv0"):r(e,t,a+"/conv0"),conv1:r(t,t,a+"/conv1"),conv2:r(t,t,a+"/conv2")}}return{extractDenseBlock3Params:a,extractDenseBlock4Params:function(e,t,n,i){void 0===i&&(i=!1);var o=a(e,t,n,i);return{conv0:o.conv0,conv1:o.conv1,conv2:o.conv2,conv3:r(t,t,n+"/conv3")}}}}function cy(e){return function(t){return{filters:e(t+"/filters",4),bias:e(t+"/bias",1)}}}function ly(e,t){var n=iy(e,t),r=cy(n),a=ay(n);return{extractDenseBlock3Params:function(e,t){return void 0===t&&(t=!1),{conv0:t?r(e+"/conv0"):a(e+"/conv0"),conv1:a(e+"/conv1"),conv2:a(e+"/conv2")}},extractDenseBlock4Params:function(e,t){return void 0===t&&(t=!1),{conv0:t?r(e+"/conv0"):a(e+"/conv0"),conv1:a(e+"/conv1"),conv2:a(e+"/conv2"),conv3:a(e+"/conv3")}}}}var uy=function(e){function t(){return e.call(this,"FaceFeatureExtractor")||this}return zv(t,e),t.prototype.forwardInput=function(e){var t=this.params;if(!t)throw new Error("FaceFeatureExtractor - load model before inference");return ls(function(){var n=Jb(cb(e.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(Fs(255)),t.dense0,!0);return n=Jb(n,t.dense1),n=Jb(n,t.dense2),n=Jb(n,t.dense3),n=Bp(n,[7,7],[2,2],"valid")})},t.prototype.forward=function(e){return Wv(this,void 0,void 0,function(){var t;return Vv(this,function(n){switch(n.label){case 0:return t=this.forwardInput,[4,zb(e)];case 1:return[2,t.apply(this,[n.sent()])]}})})},t.prototype.getDefaultModelName=function(){return"face_feature_extractor_model"},t.prototype.extractParamsFromWeigthMap=function(e){return function(e){var t=[],n=ly(e,t).extractDenseBlock4Params,r={dense0:n("dense0",!0),dense1:n("dense1"),dense2:n("dense2"),dense3:n("dense3")};return Zb(e,t),{params:r,paramMappings:t}}(e)},t.prototype.extractParams=function(e){return function(e){var t=[],n=oy(e),r=n.extractWeights,a=n.getRemainingWeights,i=sy(r,t).extractDenseBlock4Params,o=i(3,32,"dense0",!0),s=i(32,64,"dense1"),c=i(64,128,"dense2"),l=i(128,256,"dense3");if(0!==a().length)throw new Error("weights remaing after extract: "+a().length);return{paramMappings:t,params:{dense0:o,dense1:s,dense2:c,dense3:l}}}(e)},t}(Xb);function hy(e,t){return ls(function(){return Rf(Tp(e,t.weights),t.bias)})}function dy(e){var t={},n={};return Object.keys(e).forEach(function(r){(r.startsWith("fc")?n:t)[r]=e[r]}),{featureExtractorMap:t,classifierMap:n}}var fy=function(e){function t(t,n){var r=e.call(this,t)||this;return r._faceFeatureExtractor=n,r}return zv(t,e),Object.defineProperty(t.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),t.prototype.runNet=function(e){var t=this,n=this.params;if(!n)throw new Error(this._name+" - load model before inference");return ls(function(){var r=e instanceof Bb?t.faceFeatureExtractor.forwardInput(e):e;return hy(r.as2D(r.shape[0],-1),n.fc)})},t.prototype.dispose=function(t){void 0===t&&(t=!0),this.faceFeatureExtractor.dispose(t),e.prototype.dispose.call(this,t)},t.prototype.loadClassifierParams=function(e){var t=this.extractClassifierParams(e),n=t.params,r=t.paramMappings;this._params=n,this._paramMappings=r},t.prototype.extractClassifierParams=function(e){return function(e,t,n){var r=[],a=oy(e),i=a.extractWeights,o=a.getRemainingWeights,s=ty(i,r)(t,n,"fc");if(0!==o().length)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:r,params:{fc:s}}}(e,this.getClassifierChannelsIn(),this.getClassifierChannelsOut())},t.prototype.extractParamsFromWeigthMap=function(e){var t=dy(e),n=t.featureExtractorMap,r=t.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(n),function(e){var t,n=[],r=iy(e,n),a={fc:(t="fc",{weights:r(t+"/weights",2),bias:r(t+"/bias",1)})};return Zb(e,n),{params:a,paramMappings:n}}(r)},t.prototype.extractParams=function(e){var t=this.getClassifierChannelsIn(),n=this.getClassifierChannelsOut(),r=n*t+n,a=e.slice(0,e.length-r),i=e.slice(e.length-r);return this.faceFeatureExtractor.extractWeights(a),this.extractClassifierParams(i)},t}(Xb),py=["neutral","happy","sad","angry","fearful","disgusted","surprised"],my=function(){function e(e){var t=this;if(7!==e.length)throw new Error("FaceExpressions.constructor - expected probabilities.length to be 7, have: "+e.length);py.forEach(function(n,r){t[n]=e[r]})}return e.prototype.asSortedArray=function(){var e=this;return py.map(function(t){return{expression:t,probability:e[t]}}).sort(function(e,t){return t.probability-e.probability})},e}(),gy=function(e){function t(t){return void 0===t&&(t=new uy),e.call(this,"FaceExpressionNet",t)||this}return zv(t,e),t.prototype.forwardInput=function(e){var t=this;return ls(function(){return Qc(t.runNet(e))})},t.prototype.forward=function(e){return Wv(this,void 0,void 0,function(){var t;return Vv(this,function(n){switch(n.label){case 0:return t=this.forwardInput,[4,zb(e)];case 1:return[2,t.apply(this,[n.sent()])]}})})},t.prototype.predictExpressions=function(e){return Wv(this,void 0,void 0,function(){var t,n,r,a,i=this;return Vv(this,function(o){switch(o.label){case 0:return[4,zb(e)];case 1:return t=o.sent(),[4,this.forwardInput(t)];case 2:return n=o.sent(),[4,Promise.all(Dc(n).map(function(e){return Wv(i,void 0,void 0,function(){var t;return Vv(this,function(n){switch(n.label){case 0:return[4,e.data()];case 1:return t=n.sent(),e.dispose(),[2,t]}})})}))];case 3:return r=o.sent(),n.dispose(),a=r.map(function(e){return new my(e)}),[2,t.isBatchInput?a:a[0]]}})})},t.prototype.getDefaultModelName=function(){return"face_expression_model"},t.prototype.getClassifierChannelsIn=function(){return 256},t.prototype.getClassifierChannelsOut=function(){return 7},t}(fy);function vy(e,t){var n={expressions:t};return Object.assign({},e,n)}function by(e){return function(e){return e.detection instanceof ib}(e)&&e.landmarks instanceof db&&e.unshiftedLandmarks instanceof db&&e.alignedRect instanceof ib}function yy(e,t){var n=e.detection.box,r=t.shiftBy(n.x,n.y),a=r.align(),i=e.detection.imageDims,o={landmarks:r,unshiftedLandmarks:t,alignedRect:new ib(e.detection.score,a.rescale(i.reverse()),i)};return Object.assign({},e,o)}function xy(e,t,n){if(void 0===n&&(n=!1),e.beginPath(),t.slice(1).forEach(function(n,r){var a=n.x,i=n.y,o=t[r];e.moveTo(o.x,o.y),e.lineTo(a,i)}),n){var r=t[t.length-1],a=t[0];if(!r||!a)return;e.moveTo(r.x,r.y),e.lineTo(a.x,a.y)}e.stroke()}var wy=function(e){void 0===e&&(e={});var t=e.drawLines,n=void 0===t||t,r=e.drawPoints,a=void 0===r||r,i=e.lineWidth,o=e.lineColor,s=e.pointSize,c=e.pointColor;this.drawLines=n,this.drawPoints=a,this.lineWidth=i||1,this.pointSize=s||2,this.lineColor=o||"rgba(0, 255, 255, 1)",this.pointColor=c||"rgba(255, 0, 255, 1)"};!function(){function e(e,t){void 0===t&&(t={}),this.faceLandmarks=e,this.options=new wy(t)}e.prototype.draw=function(e){var t=_b(e),n=this.options,r=n.drawLines,a=n.drawPoints,i=n.lineWidth,o=n.lineColor,s=n.pointSize,c=n.pointColor;if(r&&this.faceLandmarks instanceof pb&&(t.strokeStyle=o,t.lineWidth=i,xy(t,this.faceLandmarks.getJawOutline()),xy(t,this.faceLandmarks.getLeftEyeBrow()),xy(t,this.faceLandmarks.getRightEyeBrow()),xy(t,this.faceLandmarks.getNose()),xy(t,this.faceLandmarks.getLeftEye(),!0),xy(t,this.faceLandmarks.getRightEye(),!0),xy(t,this.faceLandmarks.getMouth(),!0)),a){t.strokeStyle=c,t.fillStyle=c;this.faceLandmarks.positions.forEach(function(e){t.beginPath(),t.arc(e.x,e.y,s,0,2*Math.PI),t.fill()})}}}();function ky(e,t){var n=[],r=oy(e),a=r.extractWeights,i=r.getRemainingWeights,o=function(e,t){var n=ey(e,t),r=ry(e,t);return{extractConvParams:n,extractSeparableConvParams:r,extractReductionBlockParams:function(e,t,a){return{separable_conv0:r(e,t,a+"/separable_conv0"),separable_conv1:r(t,t,a+"/separable_conv1"),expansion_conv:n(e,t,1,a+"/expansion_conv")}},extractMainBlockParams:function(e,t){return{separable_conv0:r(e,e,t+"/separable_conv0"),separable_conv1:r(e,e,t+"/separable_conv1"),separable_conv2:r(e,e,t+"/separable_conv2")}}}}(a,n),s=o.extractConvParams,c=o.extractSeparableConvParams,l=o.extractReductionBlockParams,u=o.extractMainBlockParams,h={conv_in:s(3,32,3,"entry_flow/conv_in"),reduction_block_0:l(32,64,"entry_flow/reduction_block_0"),reduction_block_1:l(64,128,"entry_flow/reduction_block_1")},d={};Qv(t,0,1).forEach(function(e){d["main_block_"+e]=u(128,"middle_flow/main_block_"+e)});var f={reduction_block:l(128,256,"exit_flow/reduction_block"),separable_conv:c(256,512,"exit_flow/separable_conv")};if(0!==i().length)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:n,params:{entry_flow:h,middle_flow:d,exit_flow:f}}}function Sy(e,t){var n=[],r=function(e,t){var n=iy(e,t),r=cy(n),a=ay(n);return{extractConvParams:r,extractSeparableConvParams:a,extractReductionBlockParams:function(e){return{separable_conv0:a(e+"/separable_conv0"),separable_conv1:a(e+"/separable_conv1"),expansion_conv:r(e+"/expansion_conv")}},extractMainBlockParams:function(e){return{separable_conv0:a(e+"/separable_conv0"),separable_conv1:a(e+"/separable_conv1"),separable_conv2:a(e+"/separable_conv2")}}}}(e,n),a=r.extractConvParams,i=r.extractSeparableConvParams,o=r.extractReductionBlockParams,s=r.extractMainBlockParams,c={conv_in:a("entry_flow/conv_in"),reduction_block_0:o("entry_flow/reduction_block_0"),reduction_block_1:o("entry_flow/reduction_block_1")},l={};Qv(t,0,1).forEach(function(e){l["main_block_"+e]=s("middle_flow/main_block_"+e)});var u={reduction_block:o("exit_flow/reduction_block"),separable_conv:i("exit_flow/separable_conv")};return Zb(e,n),{params:{entry_flow:c,middle_flow:l,exit_flow:u},paramMappings:n}}function Ny(e,t,n){return Rf(bp(e,t.filters,n,"same"),t.bias)}function Cy(e,t,n){void 0===n&&(n=!0);var r=n?lm(e):e;return r=Yb(r,t.separable_conv0,[1,1]),r=Yb(lm(r),t.separable_conv1,[1,1]),r=jp(r,[3,3],[2,2],"same"),r=Rf(r,Ny(e,t.expansion_conv,[2,2]))}var Ey,Iy=function(e){function t(t){var n=e.call(this,"TinyXception")||this;return n._numMainBlocks=t,n}return zv(t,e),t.prototype.forwardInput=function(e){var t=this,n=this.params;if(!n)throw new Error("TinyXception - load model before inference");return ls(function(){var r=cb(e.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(Fs(256)),a=lm(Ny(r,n.entry_flow.conv_in,[2,2]));return a=Cy(a,n.entry_flow.reduction_block_0,!1),a=Cy(a,n.entry_flow.reduction_block_1),Qv(t._numMainBlocks,0,1).forEach(function(e){a=function(e,t){var n=Yb(lm(e),t.separable_conv0,[1,1]);return n=Yb(lm(n),t.separable_conv1,[1,1]),n=Yb(lm(n),t.separable_conv2,[1,1]),Rf(n,e)}(a,n.middle_flow["main_block_"+e])}),a=Cy(a,n.exit_flow.reduction_block),a=lm(Yb(a,n.exit_flow.separable_conv,[1,1]))})},t.prototype.forward=function(e){return Wv(this,void 0,void 0,function(){var t;return Vv(this,function(n){switch(n.label){case 0:return t=this.forwardInput,[4,zb(e)];case 1:return[2,t.apply(this,[n.sent()])]}})})},t.prototype.getDefaultModelName=function(){return"tiny_xception_model"},t.prototype.extractParamsFromWeigthMap=function(e){return Sy(e,this._numMainBlocks)},t.prototype.extractParams=function(e){return ky(e,this._numMainBlocks)},t}(Xb);!function(e){e.FEMALE="female",e.MALE="male"}(Ey||(Ey={}));var Ty=function(e){function t(t){void 0===t&&(t=new Iy(2));var n=e.call(this,"AgeGenderNet")||this;return n._faceFeatureExtractor=t,n}return zv(t,e),Object.defineProperty(t.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),t.prototype.runNet=function(e){var t=this,n=this.params;if(!n)throw new Error(this._name+" - load model before inference");return ls(function(){var r=e instanceof Bb?t.faceFeatureExtractor.forwardInput(e):e,a=Bp(r,[7,7],[2,2],"valid").as2D(r.shape[0],-1);return{age:hy(a,n.fc.age).as1D(),gender:hy(a,n.fc.gender)}})},t.prototype.forwardInput=function(e){var t=this;return ls(function(){var n=t.runNet(e),r=n.age,a=n.gender;return{age:r,gender:Qc(a)}})},t.prototype.forward=function(e){return Wv(this,void 0,void 0,function(){var t;return Vv(this,function(n){switch(n.label){case 0:return t=this.forwardInput,[4,zb(e)];case 1:return[2,t.apply(this,[n.sent()])]}})})},t.prototype.predictAgeAndGender=function(e){return Wv(this,void 0,void 0,function(){var t,n,r,a,i,o,s=this;return Vv(this,function(c){switch(c.label){case 0:return[4,zb(e)];case 1:return t=c.sent(),[4,this.forwardInput(t)];case 2:return n=c.sent(),r=Dc(n.age),a=Dc(n.gender),i=r.map(function(e,t){return{ageTensor:e,genderTensor:a[t]}}),[4,Promise.all(i.map(function(e){var t=e.ageTensor,n=e.genderTensor;return Wv(s,void 0,void 0,function(){var e,r,a,i,o;return Vv(this,function(s){switch(s.label){case 0:return[4,t.data()];case 1:return e=s.sent()[0],[4,n.data()];case 2:return r=s.sent()[0],i=(a=r>.5)?Ey.MALE:Ey.FEMALE,o=a?r:1-r,t.dispose(),n.dispose(),[2,{age:e,gender:i,genderProbability:o}]}})})}))];case 3:return o=c.sent(),n.age.dispose(),n.gender.dispose(),[2,t.isBatchInput?o:o[0]]}})})},t.prototype.getDefaultModelName=function(){return"age_gender_model"},t.prototype.dispose=function(t){void 0===t&&(t=!0),this.faceFeatureExtractor.dispose(t),e.prototype.dispose.call(this,t)},t.prototype.loadClassifierParams=function(e){var t=this.extractClassifierParams(e),n=t.params,r=t.paramMappings;this._params=n,this._paramMappings=r},t.prototype.extractClassifierParams=function(e){return function(e){var t=[],n=oy(e),r=n.extractWeights,a=n.getRemainingWeights,i=ty(r,t),o=i(512,1,"fc/age"),s=i(512,2,"fc/gender");if(0!==a().length)throw new Error("weights remaing after extract: "+a().length);return{paramMappings:t,params:{fc:{age:o,gender:s}}}}(e)},t.prototype.extractParamsFromWeigthMap=function(e){var t=dy(e),n=t.featureExtractorMap,r=t.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(n),function(e){var t=[],n=iy(e,t);function r(e){return{weights:n(e+"/weights",2),bias:n(e+"/bias",1)}}var a={fc:{age:r("fc/age"),gender:r("fc/gender")}};return Zb(e,t),{params:a,paramMappings:t}}(r)},t.prototype.extractParams=function(e){var t=e.slice(0,e.length-1539),n=e.slice(e.length-1539);return this.faceFeatureExtractor.extractWeights(t),this.extractClassifierParams(n)},t}(Xb),_y=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return zv(t,e),t.prototype.postProcess=function(e,t,n){var r=n.map(function(e){var n=e.width,r=e.height,a=t/Math.max(r,n);return{width:n*a,height:r*a}}),a=r.length;return ls(function(){var n=function(e,t){return Ac([Bs([68],e),Bs([68],t)],1).as2D(1,136).as1D()},i=function(e,t){var n=r[e],a=n.width,i=n.height;return t(a,i)?Math.abs(a-i)/2:0},o=e.mul(Bs([a,136],t)).sub(Ac(Array.from(Array(a),function(e,t){return n(function(e){return i(e,function(e,t){return e<t})}(t),function(e){return i(e,function(e,t){return t<e})}(t))}))).div(Ac(Array.from(Array(a),function(e,t){return n(r[t].width,r[t].height)})));return o})},t.prototype.forwardInput=function(e){var t=this;return ls(function(){var n=t.runNet(e);return t.postProcess(n,e.inputSize,e.inputDimensions.map(function(e){return{height:e[0],width:e[1]}}))})},t.prototype.forward=function(e){return Wv(this,void 0,void 0,function(){var t;return Vv(this,function(n){switch(n.label){case 0:return t=this.forwardInput,[4,zb(e)];case 1:return[2,t.apply(this,[n.sent()])]}})})},t.prototype.detectLandmarks=function(e){return Wv(this,void 0,void 0,function(){var t,n,r,a=this;return Vv(this,function(i){switch(i.label){case 0:return[4,zb(e)];case 1:return t=i.sent(),n=ls(function(){return Dc(a.forwardInput(t))}),[4,Promise.all(n.map(function(e,n){return Wv(a,void 0,void 0,function(){var r,a,i,o,s;return Vv(this,function(c){switch(c.label){case 0:return i=(a=Array).from,[4,e.data()];case 1:return r=i.apply(a,[c.sent()]),o=r.filter(function(e,t){return Yv(t)}),s=r.filter(function(e,t){return!Yv(t)}),[2,new pb(Array(68).fill(0).map(function(e,t){return new tb(o[t],s[t])}),{height:t.getInputHeight(n),width:t.getInputWidth(n)})]}})})}))];case 2:return r=i.sent(),n.forEach(function(e){return e.dispose()}),[2,t.isBatchInput?r:r[0]]}})})},t.prototype.getClassifierChannelsOut=function(){return 136},t}(fy),Ay=function(e){function t(t){return void 0===t&&(t=new uy),e.call(this,"FaceLandmark68Net",t)||this}return zv(t,e),t.prototype.getDefaultModelName=function(){return"face_landmark_68_model"},t.prototype.getClassifierChannelsIn=function(){return 256},t}(_y);var Ry=function(e){function t(){return e.call(this,"TinyFaceFeatureExtractor")||this}return zv(t,e),t.prototype.forwardInput=function(e){var t=this.params;if(!t)throw new Error("TinyFaceFeatureExtractor - load model before inference");return ls(function(){var n=$b(cb(e.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(Fs(255)),t.dense0,!0);return n=$b(n,t.dense1),n=$b(n,t.dense2),n=Bp(n,[14,14],[2,2],"valid")})},t.prototype.forward=function(e){return Wv(this,void 0,void 0,function(){var t;return Vv(this,function(n){switch(n.label){case 0:return t=this.forwardInput,[4,zb(e)];case 1:return[2,t.apply(this,[n.sent()])]}})})},t.prototype.getDefaultModelName=function(){return"face_feature_extractor_tiny_model"},t.prototype.extractParamsFromWeigthMap=function(e){return function(e){var t=[],n=ly(e,t).extractDenseBlock3Params,r={dense0:n("dense0",!0),dense1:n("dense1"),dense2:n("dense2")};return Zb(e,t),{params:r,paramMappings:t}}(e)},t.prototype.extractParams=function(e){return function(e){var t=[],n=oy(e),r=n.extractWeights,a=n.getRemainingWeights,i=sy(r,t).extractDenseBlock3Params,o=i(3,32,"dense0",!0),s=i(32,64,"dense1"),c=i(64,128,"dense2");if(0!==a().length)throw new Error("weights remaing after extract: "+a().length);return{paramMappings:t,params:{dense0:o,dense1:s,dense2:c}}}(e)},t}(Xb),Fy=function(e){function t(t){return void 0===t&&(t=new Ry),e.call(this,"FaceLandmark68TinyNet",t)||this}return zv(t,e),t.prototype.getDefaultModelName=function(){return"face_landmark_68_tiny_model"},t.prototype.getClassifierChannelsIn=function(){return 128},t}(_y);!function(e){function t(){return null!==e&&e.apply(this,arguments)||this}zv(t,e)}(Ay);function Dy(e,t,n,r,a){void 0===a&&(a="same");var i=t.conv,o=i.filters,s=i.bias,c=bp(e,o,n,a);return c=function(e,t){return Rf(Gf(e,t.weights),t.biases)}(c=Rf(c,s),t.scale),r?lm(c):c}function Oy(e,t){return Dy(e,t,[1,1],!1)}function Ly(e,t){return Dy(e,t,[2,2],!0,"valid")}function Py(e,t){function n(n,r,a,i){var o=function(t,n,r){var a=e(t),i=a.length/(n*r*r);if(i%1!==0)throw new Error("depth has to be an integer: "+i+", weights.length: "+a.length+", numFilters: "+n+", filterSize: "+r);return ls(function(){return dm(Ps(a,[n,i,r,r]),[2,3,1,0])})}(n,r,a),s=Ds(e(r));return t.push({paramPath:i+"/filters"},{paramPath:i+"/bias"}),{filters:o,bias:s}}function r(r,a,i,o){var s=n(r,a,i,o+"/conv"),c=function(n,r){var a=Ds(e(n)),i=Ds(e(n));return t.push({paramPath:r+"/weights"},{paramPath:r+"/biases"}),{weights:a,biases:i}}(a,o+"/scale");return{conv:s,scale:c}}return{extractConvLayerParams:r,extractResidualLayerParams:function(e,t,n,a,i){return void 0===i&&(i=!1),{conv1:r((i?.5:1)*e,t,n,a+"/conv1"),conv2:r(e,t,n,a+"/conv2")}}}}function My(e,t){var n=iy(e,t);function r(e){var t=n(e+"/conv/filters",4),r=n(e+"/conv/bias",1),a=function(e){return{weights:n(e+"/scale/weights",1),biases:n(e+"/scale/biases",1)}}(e);return{conv:{filters:t,bias:r},scale:a}}return{extractConvLayerParams:r,extractResidualLayerParams:function(e){return{conv1:r(e+"/conv1"),conv2:r(e+"/conv2")}}}}function jy(e){var t=[],n=My(e,t),r=n.extractConvLayerParams,a=n.extractResidualLayerParams,i=r("conv32_down"),o=a("conv32_1"),s=a("conv32_2"),c=a("conv32_3"),l=a("conv64_down"),u=a("conv64_1"),h=a("conv64_2"),d=a("conv64_3"),f=a("conv128_down"),p=a("conv128_1"),m=a("conv128_2"),g=a("conv256_down"),v=a("conv256_1"),b=a("conv256_2"),y=a("conv256_down_out"),x=e.fc;if(t.push({originalPath:"fc",paramPath:"fc"}),!function(e){return qv(e,2)}(x))throw new Error("expected weightMap[fc] to be a Tensor2D, instead have "+x);var w={conv32_down:i,conv32_1:o,conv32_2:s,conv32_3:c,conv64_down:l,conv64_1:u,conv64_2:h,conv64_3:d,conv128_down:f,conv128_1:p,conv128_2:m,conv256_down:g,conv256_1:v,conv256_2:b,conv256_down_out:y,fc:x};return Zb(e,t),{params:w,paramMappings:t}}function By(e,t){var n=function(e,t){return Dy(e,t,[1,1],!0)}(e,t.conv1);return n=Oy(n,t.conv2),n=Rf(n,e),n=lm(n)}function zy(e,t){var n=Ly(e,t.conv1);n=Oy(n,t.conv2);var r=Bp(e,2,2,"valid"),a=js(r.shape),i=r.shape[3]!==n.shape[3];if(r.shape[1]!==n.shape[1]||r.shape[2]!==n.shape[2]){var o=Hv(n.shape);o[1]=1;var s=js(o),c=Hv((n=Vs([n,s],1)).shape);c[2]=1;var l=js(c);n=Vs([n,l],2)}return r=i?Vs([r,a],3):r,n=Rf(r,n),n=lm(n)}var Uy=function(e){function t(){return e.call(this,"FaceRecognitionNet")||this}return zv(t,e),t.prototype.forwardInput=function(e){var t=this.params;if(!t)throw new Error("FaceRecognitionNet - load model before inference");return ls(function(){var n=Ly(cb(e.toBatchTensor(150,!0).toFloat(),[122.782,117.001,104.298]).div(Fs(256)),t.conv32_down);n=By(n=jp(n,3,2,"valid"),t.conv32_1),n=By(n,t.conv32_2),n=By(n,t.conv32_3),n=By(n=zy(n,t.conv64_down),t.conv64_1),n=By(n,t.conv64_2),n=By(n,t.conv64_3),n=By(n=zy(n,t.conv128_down),t.conv128_1),n=By(n,t.conv128_2),n=By(n=zy(n,t.conv256_down),t.conv256_1);var r=(n=zy(n=By(n,t.conv256_2),t.conv256_down_out)).mean([1,2]);return Tp(r,t.fc)})},t.prototype.forward=function(e){return Wv(this,void 0,void 0,function(){var t;return Vv(this,function(n){switch(n.label){case 0:return t=this.forwardInput,[4,zb(e)];case 1:return[2,t.apply(this,[n.sent()])]}})})},t.prototype.computeFaceDescriptor=function(e){return Wv(this,void 0,void 0,function(){var t,n,r,a=this;return Vv(this,function(i){switch(i.label){case 0:return[4,zb(e)];case 1:return t=i.sent(),n=ls(function(){return Dc(a.forwardInput(t))}),[4,Promise.all(n.map(function(e){return e.data()}))];case 2:return r=i.sent(),n.forEach(function(e){return e.dispose()}),[2,t.isBatchInput?r:r[0]]}})})},t.prototype.getDefaultModelName=function(){return"face_recognition_model"},t.prototype.extractParamsFromWeigthMap=function(e){return jy(e)},t.prototype.extractParams=function(e){return function(e){var t=oy(e),n=t.extractWeights,r=t.getRemainingWeights,a=[],i=Py(n,a),o=i.extractConvLayerParams,s=i.extractResidualLayerParams,c=o(4704,32,7,"conv32_down"),l=s(9216,32,3,"conv32_1"),u=s(9216,32,3,"conv32_2"),h=s(9216,32,3,"conv32_3"),d=s(36864,64,3,"conv64_down",!0),f=s(36864,64,3,"conv64_1"),p=s(36864,64,3,"conv64_2"),m=s(36864,64,3,"conv64_3"),g=s(147456,128,3,"conv128_down",!0),v=s(147456,128,3,"conv128_1"),b=s(147456,128,3,"conv128_2"),y=s(589824,256,3,"conv256_down",!0),x=s(589824,256,3,"conv256_1"),w=s(589824,256,3,"conv256_2"),k=s(589824,256,3,"conv256_down_out"),S=ls(function(){return dm(Os(n(32768),[128,256]),[1,0])});if(a.push({paramPath:"fc"}),0!==r().length)throw new Error("weights remaing after extract: "+r().length);return{params:{conv32_down:c,conv32_1:l,conv32_2:u,conv32_3:h,conv64_down:d,conv64_1:f,conv64_2:p,conv64_3:m,conv128_down:g,conv128_1:v,conv128_2:b,conv256_down:y,conv256_1:x,conv256_2:w,conv256_down_out:k,fc:S},paramMappings:a}}(e)},t}(Xb);function Wy(e,t,n){var r={gender:t,genderProbability:n};return Object.assign({},e,r)}var Vy=function(){function e(e){var t=void 0===e?{}:e,n=t.minFaceSize,r=t.scaleFactor,a=t.maxNumScales,i=t.scoreThresholds,o=t.scaleSteps;if(this._name="MtcnnOptions",this._minFaceSize=n||20,this._scaleFactor=r||.709,this._maxNumScales=a||10,this._scoreThresholds=i||[.6,.7,.7],this._scaleSteps=o,"number"!==typeof this._minFaceSize||this._minFaceSize<0)throw new Error(this._name+" - expected minFaceSize to be a number > 0");if("number"!==typeof this._scaleFactor||this._scaleFactor<=0||this._scaleFactor>=1)throw new Error(this._name+" - expected scaleFactor to be a number between 0 and 1");if("number"!==typeof this._maxNumScales||this._maxNumScales<0)throw new Error(this._name+" - expected maxNumScales to be a number > 0");if(!Array.isArray(this._scoreThresholds)||3!==this._scoreThresholds.length||this._scoreThresholds.some(function(e){return"number"!==typeof e}))throw new Error(this._name+" - expected scoreThresholds to be an array of numbers of length 3");if(this._scaleSteps&&(!Array.isArray(this._scaleSteps)||this._scaleSteps.some(function(e){return"number"!==typeof e})))throw new Error(this._name+" - expected scaleSteps to be an array of numbers")}return Object.defineProperty(e.prototype,"minFaceSize",{get:function(){return this._minFaceSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleFactor",{get:function(){return this._scaleFactor},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxNumScales",{get:function(){return this._maxNumScales},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scoreThresholds",{get:function(){return this._scoreThresholds},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleSteps",{get:function(){return this._scaleSteps},enumerable:!0,configurable:!0}),e}();function Hy(e,t){function n(n,r,a,i,o){var s=Ps(e(n*r*a*a),[a,a,n,r]),c=Ds(e(r));return t.push({paramPath:i+"/filters"},{paramPath:i+"/"+(o?"batch_norm_offset":"bias")}),{filters:s,bias:c}}function r(e,t,r,a){var i=n(e,t,r,a,!0);return{filters:i.filters,batch_norm_offset:i.bias}}function a(n,a,i){var o=function(n,r){var a=Ps(e(9*n),[3,3,n,1]),i=Ds(e(n)),o=Ds(e(n)),s=Ds(e(n)),c=Ds(e(n));return t.push({paramPath:r+"/filters"},{paramPath:r+"/batch_norm_scale"},{paramPath:r+"/batch_norm_offset"},{paramPath:r+"/batch_norm_mean"},{paramPath:r+"/batch_norm_variance"}),{filters:a,batch_norm_scale:i,batch_norm_offset:o,batch_norm_mean:s,batch_norm_variance:c}}(n,i+"/depthwise_conv");return{depthwise_conv:o,pointwise_conv:r(n,a,1,i+"/pointwise_conv")}}return{extractMobilenetV1Params:function(){return{conv_0:r(3,32,3,"mobilenetv1/conv_0"),conv_1:a(32,64,"mobilenetv1/conv_1"),conv_2:a(64,128,"mobilenetv1/conv_2"),conv_3:a(128,128,"mobilenetv1/conv_3"),conv_4:a(128,256,"mobilenetv1/conv_4"),conv_5:a(256,256,"mobilenetv1/conv_5"),conv_6:a(256,512,"mobilenetv1/conv_6"),conv_7:a(512,512,"mobilenetv1/conv_7"),conv_8:a(512,512,"mobilenetv1/conv_8"),conv_9:a(512,512,"mobilenetv1/conv_9"),conv_10:a(512,512,"mobilenetv1/conv_10"),conv_11:a(512,512,"mobilenetv1/conv_11"),conv_12:a(512,1024,"mobilenetv1/conv_12"),conv_13:a(1024,1024,"mobilenetv1/conv_13")}},extractPredictionLayerParams:function(){return{conv_0:r(1024,256,1,"prediction_layer/conv_0"),conv_1:r(256,512,3,"prediction_layer/conv_1"),conv_2:r(512,128,1,"prediction_layer/conv_2"),conv_3:r(128,256,3,"prediction_layer/conv_3"),conv_4:r(256,128,1,"prediction_layer/conv_4"),conv_5:r(128,256,3,"prediction_layer/conv_5"),conv_6:r(256,64,1,"prediction_layer/conv_6"),conv_7:r(64,128,3,"prediction_layer/conv_7"),box_predictor_0:{box_encoding_predictor:n(512,12,1,"prediction_layer/box_predictor_0/box_encoding_predictor"),class_predictor:n(512,9,1,"prediction_layer/box_predictor_0/class_predictor")},box_predictor_1:{box_encoding_predictor:n(1024,24,1,"prediction_layer/box_predictor_1/box_encoding_predictor"),class_predictor:n(1024,18,1,"prediction_layer/box_predictor_1/class_predictor")},box_predictor_2:{box_encoding_predictor:n(512,24,1,"prediction_layer/box_predictor_2/box_encoding_predictor"),class_predictor:n(512,18,1,"prediction_layer/box_predictor_2/class_predictor")},box_predictor_3:{box_encoding_predictor:n(256,24,1,"prediction_layer/box_predictor_3/box_encoding_predictor"),class_predictor:n(256,18,1,"prediction_layer/box_predictor_3/class_predictor")},box_predictor_4:{box_encoding_predictor:n(256,24,1,"prediction_layer/box_predictor_4/box_encoding_predictor"),class_predictor:n(256,18,1,"prediction_layer/box_predictor_4/class_predictor")},box_predictor_5:{box_encoding_predictor:n(128,24,1,"prediction_layer/box_predictor_5/box_encoding_predictor"),class_predictor:n(128,18,1,"prediction_layer/box_predictor_5/class_predictor")}}}}}function Gy(e){var t=[],n=function(e,t){var n=iy(e,t);function r(e,t,r){return{filters:n(e+"/Conv2d_"+t+"_pointwise/weights",4,r+"/filters"),batch_norm_offset:n(e+"/Conv2d_"+t+"_pointwise/convolution_bn_offset",1,r+"/batch_norm_offset")}}function a(e){var t="mobilenetv1/conv_"+e,a="MobilenetV1/Conv2d_"+e+"_depthwise",i=t+"/depthwise_conv",o=t+"/pointwise_conv";return{depthwise_conv:{filters:n(a+"/depthwise_weights",4,i+"/filters"),batch_norm_scale:n(a+"/BatchNorm/gamma",1,i+"/batch_norm_scale"),batch_norm_offset:n(a+"/BatchNorm/beta",1,i+"/batch_norm_offset"),batch_norm_mean:n(a+"/BatchNorm/moving_mean",1,i+"/batch_norm_mean"),batch_norm_variance:n(a+"/BatchNorm/moving_variance",1,i+"/batch_norm_variance")},pointwise_conv:r("MobilenetV1",e,o)}}function i(e,t){return{filters:n(e+"/weights",4,t+"/filters"),bias:n(e+"/biases",1,t+"/bias")}}function o(e){return{box_encoding_predictor:i("Prediction/BoxPredictor_"+e+"/BoxEncodingPredictor","prediction_layer/box_predictor_"+e+"/box_encoding_predictor"),class_predictor:i("Prediction/BoxPredictor_"+e+"/ClassPredictor","prediction_layer/box_predictor_"+e+"/class_predictor")}}return{extractMobilenetV1Params:function(){return{conv_0:r("MobilenetV1",0,"mobilenetv1/conv_0"),conv_1:a(1),conv_2:a(2),conv_3:a(3),conv_4:a(4),conv_5:a(5),conv_6:a(6),conv_7:a(7),conv_8:a(8),conv_9:a(9),conv_10:a(10),conv_11:a(11),conv_12:a(12),conv_13:a(13)}},extractPredictionLayerParams:function(){return{conv_0:r("Prediction",0,"prediction_layer/conv_0"),conv_1:r("Prediction",1,"prediction_layer/conv_1"),conv_2:r("Prediction",2,"prediction_layer/conv_2"),conv_3:r("Prediction",3,"prediction_layer/conv_3"),conv_4:r("Prediction",4,"prediction_layer/conv_4"),conv_5:r("Prediction",5,"prediction_layer/conv_5"),conv_6:r("Prediction",6,"prediction_layer/conv_6"),conv_7:r("Prediction",7,"prediction_layer/conv_7"),box_predictor_0:o(0),box_predictor_1:o(1),box_predictor_2:o(2),box_predictor_3:o(3),box_predictor_4:o(4),box_predictor_5:o(5)}}}}(e,t),r=n.extractMobilenetV1Params,a=n.extractPredictionLayerParams,i=e["Output/extra_dim"];if(t.push({originalPath:"Output/extra_dim",paramPath:"output_layer/extra_dim"}),!Kv(i))throw new Error("expected weightMap['Output/extra_dim'] to be a Tensor3D, instead have "+i);var o={mobilenetv1:r(),prediction_layer:a(),output_layer:{extra_dim:i}};return Zb(e,t),{params:o,paramMappings:t}}function qy(e,t,n){return ls(function(){var r=bp(e,t.filters,n,"same");return r=Rf(r,t.batch_norm_offset),jd(r,0,6)})}function Ky(e,t){return ls(function(){var n=null,r=qy(e,t.conv_0,[2,2]);if([t.conv_1,t.conv_2,t.conv_3,t.conv_4,t.conv_5,t.conv_6,t.conv_7,t.conv_8,t.conv_9,t.conv_10,t.conv_11,t.conv_12,t.conv_13].forEach(function(e,t){var a=t+1,i=function(e){return[2,4,6,12].some(function(t){return t===e})?[2,2]:[1,1]}(a);r=function(e,t,n){return ls(function(){var r=kp(e,t.filters,n,"same");return r=wf(r,t.batch_norm_mean,t.batch_norm_variance,t.batch_norm_offset,t.batch_norm_scale,.0010000000474974513),jd(r,0,6)})}(r,e.depthwise_conv,i),r=qy(r,e.pointwise_conv,[1,1]),11===a&&(n=r)}),null===n)throw new Error("mobileNetV1 - output of conv layer 11 is null");return{out:r,conv11:n}})}function Xy(e,t,n){var r=e.arraySync(),a=Math.min(r[t][0],r[t][2]),i=Math.min(r[t][1],r[t][3]),o=Math.max(r[t][0],r[t][2]),s=Math.max(r[t][1],r[t][3]),c=Math.min(r[n][0],r[n][2]),l=Math.min(r[n][1],r[n][3]),u=Math.max(r[n][0],r[n][2]),h=Math.max(r[n][1],r[n][3]),d=(o-a)*(s-i),f=(u-c)*(h-l);if(d<=0||f<=0)return 0;var p=Math.max(a,c),m=Math.max(i,l),g=Math.min(o,u),v=Math.min(s,h),b=Math.max(g-p,0)*Math.max(v-m,0);return b/(d+f-b)}function Yy(e,t){var n=function(e){var t=Dc(dm(e,[1,0])),n=[$f(t[2],t[0]),$f(t[3],t[1])];return{sizes:n,centers:[Rf(t[0],Lf(n[0],Fs(2))),Rf(t[1],Lf(n[1],Fs(2)))]}}(e),r=n.sizes,a=n.centers,i=Dc(dm(t,[1,0])),o=Lf(Gf(Wd(Lf(i[2],Fs(5))),r[0]),Fs(2)),s=Rf(Gf(Lf(i[0],Fs(10)),r[0]),a[0]),c=Lf(Gf(Wd(Lf(i[3],Fs(5))),r[1]),Fs(2)),l=Rf(Gf(Lf(i[1],Fs(10)),r[1]),a[1]);return dm(Ac([$f(s,o),$f(l,c),Rf(s,o),Rf(l,c)]),[1,0])}function $y(e,t){return ls(function(){var n=e.shape[0];return{boxPredictionEncoding:Ic(Qb(e,t.box_encoding_predictor),[n,-1,1,4]),classPrediction:Ic(Qb(e,t.class_predictor),[n,-1,3])}})}var Jy=function(){function e(e){var t=void 0===e?{}:e,n=t.minConfidence,r=t.maxResults;if(this._name="SsdMobilenetv1Options",this._minConfidence=n||.5,this._maxResults=r||100,"number"!==typeof this._minConfidence||this._minConfidence<=0||this._minConfidence>=1)throw new Error(this._name+" - expected minConfidence to be a number between 0 and 1");if("number"!==typeof this._maxResults)throw new Error(this._name+" - expected maxResults to be a number")}return Object.defineProperty(e.prototype,"minConfidence",{get:function(){return this._minConfidence},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxResults",{get:function(){return this._maxResults},enumerable:!0,configurable:!0}),e}(),Qy=function(e){function t(){return e.call(this,"SsdMobilenetv1")||this}return zv(t,e),t.prototype.forwardInput=function(e){var t=this.params;if(!t)throw new Error("SsdMobilenetv1 - load model before inference");return ls(function(){var n=e.toBatchTensor(512,!1).toFloat(),r=Ky($f(Gf(n,Fs(.007843137718737125)),Fs(1)),t.mobilenetv1),a=function(e,t,n){return ls(function(){var r=qy(e,n.conv_0,[1,1]),a=qy(r,n.conv_1,[2,2]),i=qy(a,n.conv_2,[1,1]),o=qy(i,n.conv_3,[2,2]),s=qy(o,n.conv_4,[1,1]),c=qy(s,n.conv_5,[2,2]),l=qy(c,n.conv_6,[1,1]),u=qy(l,n.conv_7,[2,2]),h=$y(t,n.box_predictor_0),d=$y(e,n.box_predictor_1),f=$y(a,n.box_predictor_2),p=$y(o,n.box_predictor_3),m=$y(c,n.box_predictor_4),g=$y(u,n.box_predictor_5);return{boxPredictions:Vs([h.boxPredictionEncoding,d.boxPredictionEncoding,f.boxPredictionEncoding,p.boxPredictionEncoding,m.boxPredictionEncoding,g.boxPredictionEncoding],1),classPredictions:Vs([h.classPrediction,d.classPrediction,f.classPrediction,p.classPrediction,m.classPrediction,g.classPrediction],1)}})}(r.out,r.conv11,t.prediction_layer);return function(e,t,n){return ls(function(){var r=e.shape[0],a=Yy(Ic(Rc(n.extra_dim,[r,1,1]),[-1,4]),Ic(e,[-1,4]));a=Ic(a,[r,a.shape[0]/r,4]);var i=Qd(Vp(t,[0,0,1],[-1,-1,-1])),o=Vp(i,[0,0,0],[-1,-1,1]);return o=Ic(o,[r,o.shape[1]]),{boxes:Dc(a),scores:Dc(o)}})}(a.boxPredictions,a.classPredictions,t.output_layer)})},t.prototype.forward=function(e){return Wv(this,void 0,void 0,function(){var t;return Vv(this,function(n){switch(n.label){case 0:return t=this.forwardInput,[4,zb(e)];case 1:return[2,t.apply(this,[n.sent()])]}})})},t.prototype.locateFaces=function(e,t){return void 0===t&&(t={}),Wv(this,void 0,void 0,function(){var n,r,a,i,o,s,c,l,u,h,d,f,p,m,g,v,b,y,x,w;return Vv(this,function(k){switch(k.label){case 0:return n=new Jy(t),r=n.maxResults,a=n.minConfidence,[4,zb(e)];case 1:for(i=k.sent(),o=this.forwardInput(i),s=o.boxes,c=o.scores,l=s[0],u=c[0],h=1;h<s.length;h++)s[h].dispose(),c[h].dispose();return p=(f=Array).from,[4,u.data()];case 2:return d=p.apply(f,[k.sent()]),m=function(e,t,n,r,a){var i=e.shape[0],o=Math.min(n,i),s=t.map(function(e,t){return{score:e,boxIndex:t}}).filter(function(e){return e.score>a}).sort(function(e,t){return t.score-e.score}),c=function(e){return e<=r?1:0},l=[];return s.forEach(function(t){if(!(l.length>=o)){for(var n=t.score,r=l.length-1;r>=0;--r){var i=Xy(e,t.boxIndex,l[r]);if(0!==i&&(t.score*=c(i),t.score<=a))break}n===t.score&&l.push(t.boxIndex)}}),l}(l,d,r,.5,a),g=i.getReshapedInputDimensions(0),v=i.inputSize,b=v/g.width,y=v/g.height,x=l.arraySync(),w=m.map(function(e){var t=[Math.max(0,x[e][0]),Math.min(1,x[e][2])].map(function(e){return e*y}),n=t[0],r=t[1],a=[Math.max(0,x[e][1]),Math.min(1,x[e][3])].map(function(e){return e*b}),o=a[0],s=a[1];return new ib(d[e],new hb(o,n,s-o,r-n),{height:i.getInputHeight(0),width:i.getInputWidth(0)})}),l.dispose(),u.dispose(),[2,w]}})})},t.prototype.getDefaultModelName=function(){return"ssd_mobilenetv1_model"},t.prototype.extractParamsFromWeigthMap=function(e){return Gy(e)},t.prototype.extractParams=function(e){return function(e){var t=[],n=oy(e),r=n.extractWeights,a=n.getRemainingWeights,i=Hy(r,t),o=i.extractMobilenetV1Params,s=i.extractPredictionLayerParams,c=o(),l=s(),u={extra_dim:Ls(r(20472),[1,5118,4])};if(t.push({paramPath:"output_layer/extra_dim"}),0!==a().length)throw new Error("weights remaing after extract: "+a().length);return{params:{mobilenetv1:c,prediction_layer:l,output_layer:u},paramMappings:t}}(e)},t}(Xb);!function(e){function t(){return null!==e&&e.apply(this,arguments)||this}zv(t,e)}(Qy);var Zy,ex=[new tb(.738768,.874946),new tb(2.42204,2.65704),new tb(4.30971,7.04493),new tb(10.246,4.59428),new tb(12.6868,11.8741)],tx=[new tb(1.603231,2.094468),new tb(6.041143,7.080126),new tb(2.882459,3.518061),new tb(4.266906,5.178857),new tb(9.041765,10.66308)],nx=[117.001,114.697,97.404],rx=function(e){return"number"===typeof e};function ax(e){return ls(function(){var t=Gf(e,Fs(.10000000149011612));return Rf(lm($f(e,t)),t)})}function ix(e,t){return ls(function(){var n=bc(e,[[0,0],[1,1],[1,1],[0,0]]);return n=bp(n,t.conv.filters,[1,1],"valid"),n=$f(n,t.bn.sub),n=Gf(n,t.bn.truediv),ax(n=Rf(n,t.conv.bias))})}function ox(e,t){return ls(function(){var n=bc(e,[[0,0],[1,1],[1,1],[0,0]]);return n=Cp(n,t.depthwise_filter,t.pointwise_filter,[1,1],"valid"),ax(n=Rf(n,t.bias))})}function sx(e,t){var n=ey(e,t);var r=ry(e,t);return{extractConvParams:n,extractConvWithBatchNormParams:function(r,a,i){var o=n(r,a,3,i+"/conv"),s=function(n,r){var a=Ds(e(n)),i=Ds(e(n));return t.push({paramPath:r+"/sub"},{paramPath:r+"/truediv"}),{sub:a,truediv:i}}(a,i+"/bn");return{conv:o,bn:s}},extractSeparableConvParams:r}}function cx(e,t){var n=iy(e,t);function r(e){return{filters:n(e+"/filters",4),bias:n(e+"/bias",1)}}return{extractConvParams:r,extractConvWithBatchNormParams:function(e){var t=r(e+"/conv"),a=function(e){return{sub:n(e+"/sub",1),truediv:n(e+"/truediv",1)}}(e+"/bn");return{conv:t,bn:a}},extractSeparableConvParams:ay(n)}}!function(e){e[e.XS=224]="XS",e[e.SM=320]="SM",e[e.MD=416]="MD",e[e.LG=608]="LG"}(Zy||(Zy={}));var lx=function(){function e(e){var t=void 0===e?{}:e,n=t.inputSize,r=t.scoreThreshold;if(this._name="TinyYolov2Options",this._inputSize=n||416,this._scoreThreshold=r||.5,"number"!==typeof this._inputSize||this._inputSize%32!==0)throw new Error(this._name+" - expected inputSize to be a number divisible by 32");if("number"!==typeof this._scoreThreshold||this._scoreThreshold<=0||this._scoreThreshold>=1)throw new Error(this._name+" - expected scoreThreshold to be a number between 0 and 1")}return Object.defineProperty(e.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scoreThreshold",{get:function(){return this._scoreThreshold},enumerable:!0,configurable:!0}),e}(),ux=function(e){function t(t){var n=e.call(this,"TinyYolov2")||this;return function(e){if(!e)throw new Error("invalid config: "+e);if("boolean"!==typeof e.withSeparableConvs)throw new Error("config.withSeparableConvs has to be a boolean, have: "+e.withSeparableConvs);if(!rx(e.iouThreshold)||e.iouThreshold<0||e.iouThreshold>1)throw new Error("config.iouThreshold has to be a number between [0, 1], have: "+e.iouThreshold);if(!Array.isArray(e.classes)||!e.classes.length||!e.classes.every(function(e){return"string"===typeof e}))throw new Error("config.classes has to be an array class names: string[], have: "+JSON.stringify(e.classes));if(!Array.isArray(e.anchors)||!e.anchors.length||!e.anchors.map(function(e){return e||{}}).every(function(e){return rx(e.x)&&rx(e.y)}))throw new Error("config.anchors has to be an array of { x: number, y: number }, have: "+JSON.stringify(e.anchors));if(e.meanRgb&&(!Array.isArray(e.meanRgb)||3!==e.meanRgb.length||!e.meanRgb.every(rx)))throw new Error("config.meanRgb has to be an array of shape [number, number, number], have: "+JSON.stringify(e.meanRgb))}(t),n._config=t,n}return zv(t,e),Object.defineProperty(t.prototype,"config",{get:function(){return this._config},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"withClassScores",{get:function(){return this.config.withClassScores||this.config.classes.length>1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"boxEncodingSize",{get:function(){return 5+(this.withClassScores?this.config.classes.length:0)},enumerable:!0,configurable:!0}),t.prototype.runTinyYolov2=function(e,t){var n=ix(e,t.conv0);return n=ix(n=jp(n,[2,2],[2,2],"same"),t.conv1),n=ix(n=jp(n,[2,2],[2,2],"same"),t.conv2),n=ix(n=jp(n,[2,2],[2,2],"same"),t.conv3),n=ix(n=jp(n,[2,2],[2,2],"same"),t.conv4),n=ix(n=jp(n,[2,2],[2,2],"same"),t.conv5),n=ix(n=jp(n,[2,2],[1,1],"same"),t.conv6),Qb(n=ix(n,t.conv7),t.conv8,"valid",!1)},t.prototype.runMobilenet=function(e,t){var n=this.config.isFirstLayerConv2d?ax(Qb(e,t.conv0,"valid",!1)):ox(e,t.conv0);return n=ox(n=jp(n,[2,2],[2,2],"same"),t.conv1),n=ox(n=jp(n,[2,2],[2,2],"same"),t.conv2),n=ox(n=jp(n,[2,2],[2,2],"same"),t.conv3),n=ox(n=jp(n,[2,2],[2,2],"same"),t.conv4),n=ox(n=jp(n,[2,2],[2,2],"same"),t.conv5),n=jp(n,[2,2],[1,1],"same"),n=t.conv6?ox(n,t.conv6):n,Qb(n=t.conv7?ox(n,t.conv7):n,t.conv8,"valid",!1)},t.prototype.forwardInput=function(e,t){var n=this,r=this.params;if(!r)throw new Error("TinyYolov2 - load model before inference");return ls(function(){var a=e.toBatchTensor(t,!1).toFloat();return a=(a=n.config.meanRgb?cb(a,n.config.meanRgb):a).div(Fs(256)),n.config.withSeparableConvs?n.runMobilenet(a,r):n.runTinyYolov2(a,r)})},t.prototype.forward=function(e,t){return Wv(this,void 0,void 0,function(){var n;return Vv(this,function(r){switch(r.label){case 0:return n=this.forwardInput,[4,zb(e)];case 1:return[4,n.apply(this,[r.sent(),t])];case 2:return[2,r.sent()]}})})},t.prototype.detect=function(e,t){return void 0===t&&(t={}),Wv(this,void 0,void 0,function(){var n,r,a,i,o,s,c,l,u,h,d,f,p,m=this;return Vv(this,function(g){switch(g.label){case 0:return n=new lx(t),r=n.inputSize,a=n.scoreThreshold,[4,zb(e)];case 1:return i=g.sent(),[4,this.forwardInput(i,r)];case 2:return o=g.sent(),s=ls(function(){return Dc(o)[0].expandDims()}),c={width:i.getInputWidth(0),height:i.getInputHeight(0)},[4,this.extractBoxes(s,i.getReshapedInputDimensions(0),a)];case 3:return l=g.sent(),o.dispose(),s.dispose(),u=l.map(function(e){return e.box}),h=l.map(function(e){return e.score}),d=l.map(function(e){return e.classScore}),f=l.map(function(e){return m.config.classes[e.label]}),p=sb(u.map(function(e){return e.rescale(r)}),h,this.config.iouThreshold,!0),[2,p.map(function(e){return new ab(h[e],d[e],f[e],u[e],c)})]}})})},t.prototype.getDefaultModelName=function(){return""},t.prototype.extractParamsFromWeigthMap=function(e){return function(e,t){var n,r=[],a=cx(e,r),i=a.extractConvParams,o=a.extractConvWithBatchNormParams,s=a.extractSeparableConvParams;if(t.withSeparableConvs){var c=t.filterSizes&&t.filterSizes.length||9;n={conv0:t.isFirstLayerConv2d?i("conv0"):s("conv0"),conv1:s("conv1"),conv2:s("conv2"),conv3:s("conv3"),conv4:s("conv4"),conv5:s("conv5"),conv6:c>7?s("conv6"):void 0,conv7:c>8?s("conv7"):void 0,conv8:i("conv8")}}else n={conv0:o("conv0"),conv1:o("conv1"),conv2:o("conv2"),conv3:o("conv3"),conv4:o("conv4"),conv5:o("conv5"),conv6:o("conv6"),conv7:o("conv7"),conv8:i("conv8")};return Zb(e,r),{params:n,paramMappings:r}}(e,this.config)},t.prototype.extractParams=function(e){var n=this.config.filterSizes||t.DEFAULT_FILTER_SIZES,r=n?n.length:void 0;if(7!==r&&8!==r&&9!==r)throw new Error("TinyYolov2 - expected 7 | 8 | 9 convolutional filters, but found "+r+" filterSizes in config");return function(e,t,n,r){var a,i=oy(e),o=i.extractWeights,s=i.getRemainingWeights,c=[],l=sx(o,c),u=l.extractConvParams,h=l.extractConvWithBatchNormParams,d=l.extractSeparableConvParams;if(t.withSeparableConvs){var f=r[0],p=r[1],m=r[2],g=r[3],v=r[4],b=r[5],y=r[6],x=r[7],w=r[8];a={conv0:t.isFirstLayerConv2d?u(f,p,3,"conv0"):d(f,p,"conv0"),conv1:d(p,m,"conv1"),conv2:d(m,g,"conv2"),conv3:d(g,v,"conv3"),conv4:d(v,b,"conv4"),conv5:d(b,y,"conv5"),conv6:x?d(y,x,"conv6"):void 0,conv7:w?d(x,w,"conv7"):void 0,conv8:u(w||x||y,5*n,1,"conv8")}}else f=r[0],p=r[1],m=r[2],g=r[3],v=r[4],b=r[5],y=r[6],x=r[7],w=r[8],a={conv0:h(f,p,"conv0"),conv1:h(p,m,"conv1"),conv2:h(m,g,"conv2"),conv3:h(g,v,"conv3"),conv4:h(v,b,"conv4"),conv5:h(b,y,"conv5"),conv6:h(y,x,"conv6"),conv7:h(x,w,"conv7"),conv8:u(w,5*n,1,"conv8")};if(0!==s().length)throw new Error("weights remaing after extract: "+s().length);return{params:a,paramMappings:c}}(e,this.config,this.boxEncodingSize,n)},t.prototype.extractBoxes=function(e,t,n){return Wv(this,void 0,void 0,function(){var r,a,i,o,s,c,l,u,h,d,f,p,m,g,v,b,y,x,w,k,S,N,C,E,I,T,_,A,R,F=this;return Vv(this,function(D){switch(D.label){case 0:return r=t.width,a=t.height,i=Math.max(r,a),o=i/r,s=i/a,c=e.shape[1],l=this.config.anchors.length,u=ls(function(){var t=e.reshape([c,c,l,F.boxEncodingSize]);return[t.slice([0,0,0,0],[c,c,l,4]),t.slice([0,0,0,4],[c,c,l,1]),F.withClassScores?Qc(t.slice([0,0,0,5],[c,c,l,F.config.classes.length]),3):Fs(0)]}),h=u[0],d=u[1],f=u[2],p=[],[4,d.array()];case 1:return m=D.sent(),[4,h.array()];case 2:g=D.sent(),v=0,D.label=3;case 3:if(!(v<c))return[3,12];b=0,D.label=4;case 4:if(!(b<c))return[3,11];y=0,D.label=5;case 5:return y<l?(x=lb(m[v][b][y][0]),!n||x>n?(w=(b+lb(g[v][b][y][0]))/c*o,k=(v+lb(g[v][b][y][1]))/c*s,S=Math.exp(g[v][b][y][2])*this.config.anchors[y].x/c*o,N=Math.exp(g[v][b][y][3])*this.config.anchors[y].y/c*s,C=w-S/2,E=k-N/2,I={row:v,col:b,anchor:y},this.withClassScores?[4,this.extractPredictedClass(f,I)]:[3,7]):[3,9]):[3,10];case 6:return R=D.sent(),[3,8];case 7:R={classScore:1,label:0},D.label=8;case 8:_=(T=R).classScore,A=T.label,p.push(Uv({box:new rb(C,E,C+S,E+N),score:x,classScore:x*_,label:A},I)),D.label=9;case 9:return y++,[3,5];case 10:return b++,[3,4];case 11:return v++,[3,3];case 12:return h.dispose(),d.dispose(),f.dispose(),[2,p]}})})},t.prototype.extractPredictedClass=function(e,t){return Wv(this,void 0,void 0,function(){var n,r,a,i;return Vv(this,function(o){switch(o.label){case 0:return n=t.row,r=t.col,a=t.anchor,[4,e.array()];case 1:return i=o.sent(),[2,Array(this.config.classes.length).fill(0).map(function(e,t){return i[n][r][a][t]}).map(function(e,t){return{classScore:e,label:t}}).reduce(function(e,t){return e.classScore>t.classScore?e:t})]}})})},t.DEFAULT_FILTER_SIZES=[3,16,32,64,128,256,512,1024,1024],t}(Xb),hx=function(e){function t(t){void 0===t&&(t=!0);var n=Object.assign({},{withSeparableConvs:t,iouThreshold:.4,classes:["face"]},t?{anchors:tx,meanRgb:nx}:{anchors:ex,withClassScores:!0});return e.call(this,n)||this}return zv(t,e),Object.defineProperty(t.prototype,"withSeparableConvs",{get:function(){return this.config.withSeparableConvs},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),t.prototype.locateFaces=function(e,t){return Wv(this,void 0,void 0,function(){return Vv(this,function(n){switch(n.label){case 0:return[4,this.detect(e,t)];case 1:return[2,n.sent().map(function(e){return new ib(e.score,e.relativeBox,{width:e.imageWidth,height:e.imageHeight})})]}})})},t.prototype.getDefaultModelName=function(){return this.withSeparableConvs?"tiny_yolov2_separable_conv_model":"tiny_yolov2_model"},t.prototype.extractParamsFromWeigthMap=function(t){return e.prototype.extractParamsFromWeigthMap.call(this,t)},t}(ux);var dx=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._name="TinyFaceDetectorOptions",t}return zv(t,e),t}(lx),fx=function(){function e(){}return e.prototype.then=function(e){return Wv(this,void 0,void 0,function(){var t;return Vv(this,function(n){switch(n.label){case 0:return t=e,[4,this.run()];case 1:return[2,t.apply(void 0,[n.sent()])]}})})},e.prototype.run=function(){return Wv(this,void 0,void 0,function(){return Vv(this,function(e){throw new Error("ComposableTask - run is not implemented")})})},e}();function px(e,t){var n={descriptor:t};return Object.assign({},e,n)}function mx(e,t,n,r,a){return void 0===a&&(a=function(e){return e.alignedRect}),Wv(this,void 0,void 0,function(){var i,o,s,c,l;return Vv(this,function(u){switch(u.label){case 0:return i=e.map(function(e){return by(e)?a(e):e.detection}),(s=r)?[3,5]:t instanceof zi?[4,Wb(t,i)]:[3,2];case 1:return c=u.sent(),[3,4];case 2:return[4,Ub(t,i)];case 3:c=u.sent(),u.label=4;case 4:s=c,u.label=5;case 5:return[4,n(o=s)];case 6:return l=u.sent(),o.forEach(function(e){return e instanceof zi&&e.dispose()}),[2,l]}})})}function gx(e,t,n,r,a){return Wv(this,void 0,void 0,function(){var i=this;return Vv(this,function(o){return[2,mx([e],t,function(e){return Wv(i,void 0,void 0,function(){return Vv(this,function(t){return[2,n(e[0])]})})},r,a)]})})}function vx(e){var t=oy(e),n=t.extractWeights,r=t.getRemainingWeights,a=[],i=function(e,t){var n=ey(e,t),r=ty(e,t);function a(n,r){var a=Ds(e(n));return t.push({paramPath:r}),a}function i(e,t,r){return void 0===r&&(r=!1),{conv1:n(e[0],e[1],3,t+"/conv1"),prelu1_alpha:a(e[1],t+"/prelu1_alpha"),conv2:n(e[1],e[2],3,t+"/conv2"),prelu2_alpha:a(e[2],t+"/prelu2_alpha"),conv3:n(e[2],e[3],r?2:3,t+"/conv3"),prelu3_alpha:a(e[3],t+"/prelu3_alpha")}}return{extractPNetParams:function(){var e=i([3,10,16,32],"pnet"),t=n(32,2,1,"pnet/conv4_1"),r=n(32,4,1,"pnet/conv4_2");return Uv(Uv({},e),{conv4_1:t,conv4_2:r})},extractRNetParams:function(){var e=i([3,28,48,64],"rnet",!0),t=r(576,128,"rnet/fc1"),n=a(128,"rnet/prelu4_alpha"),o=r(128,2,"rnet/fc2_1"),s=r(128,4,"rnet/fc2_2");return Uv(Uv({},e),{fc1:t,prelu4_alpha:n,fc2_1:o,fc2_2:s})},extractONetParams:function(){var e=i([3,32,64,64],"onet"),t=n(64,128,2,"onet/conv4"),o=a(128,"onet/prelu4_alpha"),s=r(1152,256,"onet/fc1"),c=a(256,"onet/prelu5_alpha"),l=r(256,2,"onet/fc2_1"),u=r(256,4,"onet/fc2_2"),h=r(256,10,"onet/fc2_3");return Uv(Uv({},e),{conv4:t,prelu4_alpha:o,fc1:s,prelu5_alpha:c,fc2_1:l,fc2_2:u,fc2_3:h})}}}(n,a),o=i.extractPNetParams,s=i.extractRNetParams,c=i.extractONetParams,l=o(),u=s(),h=c();if(0!==r().length)throw new Error("weights remaing after extract: "+r().length);return{params:{pnet:l,rnet:u,onet:h},paramMappings:a}}function bx(e){var t=[],n=function(e,t){var n=iy(e,t);function r(e){return{filters:n(e+"/weights",4,e+"/filters"),bias:n(e+"/bias",1)}}function a(e){return{weights:n(e+"/weights",2),bias:n(e+"/bias",1)}}function i(e){return n(e,1)}function o(e){return{conv1:r(e+"/conv1"),prelu1_alpha:i(e+"/prelu1_alpha"),conv2:r(e+"/conv2"),prelu2_alpha:i(e+"/prelu2_alpha"),conv3:r(e+"/conv3"),prelu3_alpha:i(e+"/prelu3_alpha")}}return{extractPNetParams:function(){var e=o("pnet"),t=r("pnet/conv4_1"),n=r("pnet/conv4_2");return Uv(Uv({},e),{conv4_1:t,conv4_2:n})},extractRNetParams:function(){var e=o("rnet"),t=a("rnet/fc1"),n=i("rnet/prelu4_alpha"),r=a("rnet/fc2_1"),s=a("rnet/fc2_2");return Uv(Uv({},e),{fc1:t,prelu4_alpha:n,fc2_1:r,fc2_2:s})},extractONetParams:function(){var e=o("onet"),t=r("onet/conv4"),n=i("onet/prelu4_alpha"),s=a("onet/fc1"),c=i("onet/prelu5_alpha"),l=a("onet/fc2_1"),u=a("onet/fc2_2"),h=a("onet/fc2_3");return Uv(Uv({},e),{conv4:t,prelu4_alpha:n,fc1:s,prelu5_alpha:c,fc2_1:l,fc2_2:u,fc2_3:h})}}}(e,t),r=n.extractPNetParams,a=n.extractRNetParams,i=n.extractONetParams,o=r(),s=a(),c=i();return Zb(e,t),{params:{pnet:o,rnet:s,onet:c},paramMappings:t}}function yx(e,t){var n=t[0],r=t[1];return{height:Math.floor(n*e),width:Math.floor(r*e)}}var xx=function(e){function t(t,n,r,a){return e.call(this,{left:t,top:n,right:r,bottom:a},!0)||this}return zv(t,e),t}(nb);function wx(e){return ls(function(){return Gf($f(e,Fs(127.5)),Fs(.0078125))})}function kx(e,t){return ls(function(){return Rf(lm(e),Gf(t,Xd(lm(Xd(e)))))})}function Sx(e,t,n){return void 0===n&&(n=!1),ls(function(){var r=Qb(e,t.conv1,"valid");return r=kx(r,t.prelu1_alpha),r=kx(r=Qb(r=jp(r,n?[2,2]:[3,3],[2,2],"same"),t.conv2,"valid"),t.prelu2_alpha),r=kx(r=Qb(r=n?r:jp(r,[3,3],[2,2],"valid"),t.conv3,"valid"),t.prelu3_alpha)})}function Nx(e,t,n,r,a){a.stage1=[];var i=t.map(function(t){return ls(function(){var n={scale:t},a=function(e,t){return ls(function(){var n=yx(t,e.shape.slice(1)),r=n.height,a=n.width,i=wx(ag.resizeBilinear(e,[r,a]));return dm(i,[0,2,1,3])})}(e,t),i=Date.now(),o=function(e,t){return ls(function(){var n=Sx(e,t,!0),r=Qb(n,t.conv4_1,"valid"),a=pc(em(r,3),3);return{prob:Qc($f(r,a),3),regions:Qb(n,t.conv4_2,"valid")}})}(a,r),s=o.prob,c=o.regions;return n.pnet=Date.now()-i,{scoresTensor:Dc(Dc(s,3)[1])[0],regionsTensor:Dc(c)[0],scale:t,statsForScale:n}})}),o=i.map(function(e){var t=e.scoresTensor,r=e.regionsTensor,i=e.scale,o=e.statsForScale,s=function(e,t,n,r){for(var a=[],i=e.arraySync(),o=0;o<e.shape[0];o++)for(var s=0;s<e.shape[1];s++)i[o][s]>=r&&a.push(new tb(s,o));return a.map(function(e){var r=new rb(Math.round((2*e.y+1)/n),Math.round((2*e.x+1)/n),Math.round((2*e.y+12)/n),Math.round((2*e.x+12)/n)),a=i[e.y][e.x],o=t.arraySync();return{cell:r,score:a,region:new xx(o[e.y][e.x][0],o[e.y][e.x][1],o[e.y][e.x][2],o[e.y][e.x][3])}})}(t,r,i,n);if(t.dispose(),r.dispose(),!s.length)return a.stage1.push(o),[];var c=Date.now(),l=sb(s.map(function(e){return e.cell}),s.map(function(e){return e.score}),.5);return o.nms=Date.now()-c,o.numBoxes=l.length,a.stage1.push(o),l.map(function(e){return s[e]})}),s=o.reduce(function(e,t){return e.concat(t)},[]),c=[],l=[];if(s.length>0){var u=Date.now(),h=sb(s.map(function(e){return e.cell}),s.map(function(e){return e.score}),.7);a.stage1_nms=Date.now()-u,l=h.map(function(e){return s[e].score}),c=h.map(function(e){return s[e]}).map(function(e){var t=e.cell,n=e.region;return new rb(t.left+n.left*t.width,t.top+n.top*t.height,t.right+n.right*t.width,t.bottom+n.bottom*t.height).toSquare().round()})}return{boxes:c,scores:l}}function Cx(e,t,n){var r=n.width,a=n.height;return Wv(this,void 0,void 0,function(){var n,i,o,s=this;return Vv(this,function(c){switch(c.label){case 0:return n=_b(e),[4,Promise.all(t.map(function(t){return Wv(s,void 0,void 0,function(){var r,a,i,o,s,c,l,u;return Vv(this,function(h){return r=t.padAtBorders(e.height,e.width),a=r.y,i=r.ey,o=r.x,s=r.ex,c=o-1,l=a-1,u=n.getImageData(c,l,s-c,i-l),[2,Ib.isNodejs()?Pb(u):createImageBitmap(u)]})})}))];case 1:return i=c.sent(),o=[],i.forEach(function(e){var t=_b(Lb({width:r,height:a}));t.drawImage(e,0,0,r,a);for(var n=t.getImageData(0,0,r,a).data,i=[],s=0;s<n.length;s+=4)i.push(n[s+2]),i.push(n[s+1]),i.push(n[s]);o.push(i)}),[2,o.map(function(e){return ls(function(){return wx(dm(Ps(e,[1,r,a,3]),[0,2,1,3]).toFloat())})})]}})})}function Ex(e,t,n,r,a){return Wv(this,void 0,void 0,function(){var i,o,s,c,l,u,h,d,f,p,m,g,v,b;return Vv(this,function(y){switch(y.label){case 0:return i=Date.now(),[4,Cx(e,t,{width:24,height:24})];case 1:return o=y.sent(),a.stage2_extractImagePatches=Date.now()-i,i=Date.now(),s=o.map(function(e){var t=function(e,t){return ls(function(){var n=Sx(e,t),r=kx(hy(Ic(n,[n.shape[0],t.fc1.weights.shape[0]]),t.fc1),t.prelu4_alpha),a=hy(r,t.fc2_1),i=pc(em(a,1),1),o=Qc($f(a,i),1),s=hy(r,t.fc2_2);return{scores:Dc(o,1)[1],regions:s}})}(e,r);return e.dispose(),t}),a.stage2_rnet=Date.now()-i,c=s.length>1?Vs(s.map(function(e){return e.scores})):s[0].scores,h=(u=Array).from,[4,c.data()];case 2:return l=h.apply(u,[y.sent()]),c.dispose(),d=l.map(function(e,t){return{score:e,idx:t}}).filter(function(e){return e.score>n}).map(function(e){return e.idx}),f=d.map(function(e){return t[e]}),p=d.map(function(e){return l[e]}),m=[],g=[],f.length>0&&(i=Date.now(),v=sb(f,p,.7),a.stage2_nms=Date.now()-i,b=v.map(function(e){var t=s[d[e]].regions.arraySync();return new xx(t[0][0],t[0][1],t[0][2],t[0][3])}),g=v.map(function(e){return p[e]}),m=v.map(function(e,t){return f[e].calibrate(b[t])})),s.forEach(function(e){e.regions.dispose(),e.scores.dispose()}),[2,{boxes:m,scores:g}]}})})}function Ix(e,t,n,r,a){return Wv(this,void 0,void 0,function(){var i,o,s,c,l,u,h,d,f,p,m,g,v,b,y;return Vv(this,function(x){switch(x.label){case 0:return i=Date.now(),[4,Cx(e,t,{width:48,height:48})];case 1:return o=x.sent(),a.stage3_extractImagePatches=Date.now()-i,i=Date.now(),s=o.map(function(e){var t=function(e,t){return ls(function(){var n=Sx(e,t);n=kx(n=Qb(n=jp(n,[2,2],[2,2],"same"),t.conv4,"valid"),t.prelu4_alpha);var r=kx(hy(Ic(n,[n.shape[0],t.fc1.weights.shape[0]]),t.fc1),t.prelu5_alpha),a=hy(r,t.fc2_1),i=pc(em(a,1),1),o=Qc($f(a,i),1),s=hy(r,t.fc2_2),c=hy(r,t.fc2_3);return{scores:Dc(o,1)[1],regions:s,points:c}})}(e,r);return e.dispose(),t}),a.stage3_onet=Date.now()-i,c=s.length>1?Vs(s.map(function(e){return e.scores})):s[0].scores,h=(u=Array).from,[4,c.data()];case 2:return l=h.apply(u,[x.sent()]),c.dispose(),d=l.map(function(e,t){return{score:e,idx:t}}).filter(function(e){return e.score>n}).map(function(e){return e.idx}),f=d.map(function(e){var t=s[e].regions.arraySync();return new xx(t[0][0],t[0][1],t[0][2],t[0][3])}),p=d.map(function(e,n){return t[e].calibrate(f[n])}),m=d.map(function(e){return l[e]}),g=[],v=[],b=[],p.length>0&&(i=Date.now(),y=sb(p,m,.7,!1),a.stage3_nms=Date.now()-i,g=y.map(function(e){return p[e]}),v=y.map(function(e){return m[e]}),b=y.map(function(e,t){return Array(5).fill(0).map(function(n,r){var a=s[e].points.arraySync();return new tb(a[0][r]*(g[t].width+1)+g[t].left,a[0][r+5]*(g[t].height+1)+g[t].top)})})),s.forEach(function(e){e.regions.dispose(),e.scores.dispose(),e.points.dispose()}),[2,{boxes:g,scores:v,points:b}]}})})}var Tx=function(e){function t(){return e.call(this,"Mtcnn")||this}return zv(t,e),t.prototype.load=function(t){return Wv(this,void 0,void 0,function(){return Vv(this,function(n){return console.warn("mtcnn is deprecated and will be removed soon"),[2,e.prototype.load.call(this,t)]})})},t.prototype.loadFromDisk=function(t){return Wv(this,void 0,void 0,function(){return Vv(this,function(n){return console.warn("mtcnn is deprecated and will be removed soon"),[2,e.prototype.loadFromDisk.call(this,t)]})})},t.prototype.forwardInput=function(e,t){return void 0===t&&(t={}),Wv(this,void 0,void 0,function(){var n,r,a,i,o,s,c,l,u,h,d,f,p,m,g,v,b,y,x,w,k;return Vv(this,function(S){switch(S.label){case 0:if(!(n=this.params))throw new Error("Mtcnn - load model before inference");if(!(r=e.canvases[0]))throw new Error("Mtcnn - inputCanvas is not defined, note that passing tensors into Mtcnn.forwardInput is not supported yet.");return a={},i=Date.now(),o=ls(function(){return function(e){return ls(function(){return Ac(Dc(e,3).reverse(),3)})}(pc(Sv.fromPixels(r)).toFloat())}),s=function(e){return o.dispose(),a.total=Date.now()-i,e},c=o.shape.slice(1),l=c[0],u=c[1],h=new Vy(t),d=h.minFaceSize,f=h.scaleFactor,p=h.maxNumScales,m=h.scoreThresholds,g=h.scaleSteps,v=(g||function(e,t,n){for(var r=n[0],a=n[1],i=12/e,o=[],s=Math.min(r,a)*i,c=0;s>=12;)o.push(i*Math.pow(t,c)),s*=t,c+=1;return o}(d,f,[l,u])).filter(function(e){var t=yx(e,[l,u]);return Math.min(t.width,t.height)>12}).slice(0,p),a.scales=v,a.pyramid=v.map(function(e){return yx(e,[l,u])}),b=Date.now(),[4,Nx(o,v,m[0],n.pnet,a)];case 1:return y=S.sent(),a.total_stage1=Date.now()-b,y.boxes.length?(a.stage2_numInputBoxes=y.boxes.length,b=Date.now(),[4,Ex(r,y.boxes,m[1],n.rnet,a)]):[2,s({results:[],stats:a})];case 2:return x=S.sent(),a.total_stage2=Date.now()-b,x.boxes.length?(a.stage3_numInputBoxes=x.boxes.length,b=Date.now(),[4,Ix(r,x.boxes,m[2],n.onet,a)]):[2,s({results:[],stats:a})];case 3:return w=S.sent(),a.total_stage3=Date.now()-b,k=w.boxes.map(function(e,t){return yy(bb({},new ib(w.scores[t],new hb(e.left/u,e.top/l,e.width/u,e.height/l),{height:l,width:u})),new fb(w.points[t].map(function(t){return t.sub(new tb(e.left,e.top)).div(new tb(e.width,e.height))}),{width:e.width,height:e.height}))}),[2,s({results:k,stats:a})]}})})},t.prototype.forward=function(e,t){return void 0===t&&(t={}),Wv(this,void 0,void 0,function(){var n;return Vv(this,function(r){switch(r.label){case 0:return n=this.forwardInput,[4,zb(e)];case 1:return[4,n.apply(this,[r.sent(),t])];case 2:return[2,r.sent().results]}})})},t.prototype.forwardWithStats=function(e,t){return void 0===t&&(t={}),Wv(this,void 0,void 0,function(){var n;return Vv(this,function(r){switch(r.label){case 0:return n=this.forwardInput,[4,zb(e)];case 1:return[2,n.apply(this,[r.sent(),t])]}})})},t.prototype.getDefaultModelName=function(){return"mtcnn_model"},t.prototype.extractParamsFromWeigthMap=function(e){return bx(e)},t.prototype.extractParams=function(e){return vx(e)},t}(Xb),_x=[new tb(1.603231,2.094468),new tb(6.041143,7.080126),new tb(2.882459,3.518061),new tb(4.266906,5.178857),new tb(9.041765,10.66308)],Ax=[117.001,114.697,97.404],Rx=function(e){function t(){var t={withSeparableConvs:!0,iouThreshold:.4,classes:["face"],anchors:_x,meanRgb:Ax,isFirstLayerConv2d:!0,filterSizes:[3,16,32,64,128,256,512]};return e.call(this,t)||this}return zv(t,e),Object.defineProperty(t.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),t.prototype.locateFaces=function(e,t){return Wv(this,void 0,void 0,function(){return Vv(this,function(n){switch(n.label){case 0:return[4,this.detect(e,t)];case 1:return[2,n.sent().map(function(e){return new ib(e.score,e.relativeBox,{width:e.imageWidth,height:e.imageHeight})})]}})})},t.prototype.getDefaultModelName=function(){return"tiny_face_detector_model"},t.prototype.extractParamsFromWeigthMap=function(t){return e.prototype.extractParamsFromWeigthMap.call(this,t)},t}(ux),Fx={ssdMobilenetv1:new Qy,tinyFaceDetector:new Rx,tinyYolov2:new hx,mtcnn:new Tx,faceLandmark68Net:new Ay,faceLandmark68TinyNet:new Fy,faceRecognitionNet:new Uy,faceExpressionNet:new gy,ageGenderNet:new Ty};function Dx(e,t){var n={age:t};return Object.assign({},e,n)}var Ox=function(e){function t(t,n,r){var a=e.call(this)||this;return a.parentTask=t,a.input=n,a.extractedFaces=r,a}return zv(t,e),t}(fx),Lx=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return zv(t,e),t.prototype.run=function(){return Wv(this,void 0,void 0,function(){var e,t,n=this;return Vv(this,function(r){switch(r.label){case 0:return[4,this.parentTask];case 1:return[4,mx(e=r.sent(),this.input,function(e){return Wv(n,void 0,void 0,function(){return Vv(this,function(t){switch(t.label){case 0:return[4,Promise.all(e.map(function(e){return Fx.faceExpressionNet.predictExpressions(e)}))];case 1:return[2,t.sent()]}})})},this.extractedFaces)];case 2:return t=r.sent(),[2,e.map(function(e,n){return vy(e,t[n])})]}})})},t.prototype.withAgeAndGender=function(){return new zx(this,this.input)},t}(Ox),Px=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return zv(t,e),t.prototype.run=function(){return Wv(this,void 0,void 0,function(){var e,t;return Vv(this,function(n){switch(n.label){case 0:return[4,this.parentTask];case 1:return(e=n.sent())?[4,gx(e,this.input,function(e){return Fx.faceExpressionNet.predictExpressions(e)},this.extractedFaces)]:[2];case 2:return t=n.sent(),[2,vy(e,t)]}})})},t.prototype.withAgeAndGender=function(){return new Ux(this,this.input)},t}(Ox),Mx=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return zv(t,e),t.prototype.withAgeAndGender=function(){return new Wx(this,this.input)},t.prototype.withFaceDescriptors=function(){return new Gx(this,this.input)},t}(Lx),jx=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return zv(t,e),t.prototype.withAgeAndGender=function(){return new Vx(this,this.input)},t.prototype.withFaceDescriptor=function(){return new qx(this,this.input)},t}(Px),Bx=function(e){function t(t,n,r){var a=e.call(this)||this;return a.parentTask=t,a.input=n,a.extractedFaces=r,a}return zv(t,e),t}(fx),zx=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return zv(t,e),t.prototype.run=function(){return Wv(this,void 0,void 0,function(){var e,t,n=this;return Vv(this,function(r){switch(r.label){case 0:return[4,this.parentTask];case 1:return[4,mx(e=r.sent(),this.input,function(e){return Wv(n,void 0,void 0,function(){return Vv(this,function(t){switch(t.label){case 0:return[4,Promise.all(e.map(function(e){return Fx.ageGenderNet.predictAgeAndGender(e)}))];case 1:return[2,t.sent()]}})})},this.extractedFaces)];case 2:return t=r.sent(),[2,e.map(function(e,n){var r=t[n],a=r.age;return Dx(Wy(e,r.gender,r.genderProbability),a)})]}})})},t.prototype.withFaceExpressions=function(){return new Lx(this,this.input)},t}(Bx),Ux=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return zv(t,e),t.prototype.run=function(){return Wv(this,void 0,void 0,function(){var e,t,n,r,a;return Vv(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return(e=i.sent())?[4,gx(e,this.input,function(e){return Fx.ageGenderNet.predictAgeAndGender(e)},this.extractedFaces)]:[2];case 2:return t=i.sent(),n=t.age,r=t.gender,a=t.genderProbability,[2,Dx(Wy(e,r,a),n)]}})})},t.prototype.withFaceExpressions=function(){return new Px(this,this.input)},t}(Bx),Wx=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return zv(t,e),t.prototype.withFaceExpressions=function(){return new Mx(this,this.input)},t.prototype.withFaceDescriptors=function(){return new Gx(this,this.input)},t}(zx),Vx=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return zv(t,e),t.prototype.withFaceExpressions=function(){return new jx(this,this.input)},t.prototype.withFaceDescriptor=function(){return new qx(this,this.input)},t}(Ux),Hx=function(e){function t(t,n){var r=e.call(this)||this;return r.parentTask=t,r.input=n,r}return zv(t,e),t}(fx),Gx=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return zv(t,e),t.prototype.run=function(){return Wv(this,void 0,void 0,function(){var e;return Vv(this,function(t){switch(t.label){case 0:return[4,this.parentTask];case 1:return[4,mx(e=t.sent(),this.input,function(e){return Promise.all(e.map(function(e){return Fx.faceRecognitionNet.computeFaceDescriptor(e)}))},null,function(e){return e.landmarks.align(null,{useDlibAlignment:!0})})];case 2:return[2,t.sent().map(function(t,n){return px(e[n],t)})]}})})},t.prototype.withFaceExpressions=function(){return new Mx(this,this.input)},t.prototype.withAgeAndGender=function(){return new Wx(this,this.input)},t}(Hx),qx=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return zv(t,e),t.prototype.run=function(){return Wv(this,void 0,void 0,function(){var e,t;return Vv(this,function(n){switch(n.label){case 0:return[4,this.parentTask];case 1:return(e=n.sent())?[4,gx(e,this.input,function(e){return Fx.faceRecognitionNet.computeFaceDescriptor(e)},null,function(e){return e.landmarks.align(null,{useDlibAlignment:!0})})]:[2];case 2:return t=n.sent(),[2,px(e,t)]}})})},t.prototype.withFaceExpressions=function(){return new jx(this,this.input)},t.prototype.withAgeAndGender=function(){return new Vx(this,this.input)},t}(Hx),Kx=function(e){function t(t,n,r){var a=e.call(this)||this;return a.parentTask=t,a.input=n,a.useTinyLandmarkNet=r,a}return zv(t,e),Object.defineProperty(t.prototype,"landmarkNet",{get:function(){return this.useTinyLandmarkNet?Fx.faceLandmark68TinyNet:Fx.faceLandmark68Net},enumerable:!0,configurable:!0}),t}(fx),Xx=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return zv(t,e),t.prototype.run=function(){return Wv(this,void 0,void 0,function(){var e,t,n,r,a,i=this;return Vv(this,function(o){switch(o.label){case 0:return[4,this.parentTask];case 1:return e=o.sent(),t=e.map(function(e){return e.detection}),this.input instanceof zi?[4,Wb(this.input,t)]:[3,3];case 2:return r=o.sent(),[3,5];case 3:return[4,Ub(this.input,t)];case 4:r=o.sent(),o.label=5;case 5:return n=r,[4,Promise.all(n.map(function(e){return i.landmarkNet.detectLandmarks(e)}))];case 6:return a=o.sent(),n.forEach(function(e){return e instanceof zi&&e.dispose()}),[2,e.map(function(e,t){return yy(e,a[t])})]}})})},t.prototype.withFaceExpressions=function(){return new Mx(this,this.input)},t.prototype.withAgeAndGender=function(){return new Wx(this,this.input)},t.prototype.withFaceDescriptors=function(){return new Gx(this,this.input)},t}(Kx),Yx=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return zv(t,e),t.prototype.run=function(){return Wv(this,void 0,void 0,function(){var e,t,n,r,a;return Vv(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return(e=i.sent())?(t=e.detection,this.input instanceof zi?[4,Wb(this.input,[t])]:[3,3]):[2];case 2:return r=i.sent(),[3,5];case 3:return[4,Ub(this.input,[t])];case 4:r=i.sent(),i.label=5;case 5:return n=r,[4,this.landmarkNet.detectLandmarks(n[0])];case 6:return a=i.sent(),n.forEach(function(e){return e instanceof zi&&e.dispose()}),[2,yy(e,a)]}})})},t.prototype.withFaceExpressions=function(){return new jx(this,this.input)},t.prototype.withAgeAndGender=function(){return new Vx(this,this.input)},t.prototype.withFaceDescriptor=function(){return new qx(this,this.input)},t}(Kx),$x=function(e){function t(t,n){void 0===n&&(n=new Jy);var r=e.call(this)||this;return r.input=t,r.options=n,r}return zv(t,e),t}(fx),Jx=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return zv(t,e),t.prototype.run=function(){return Wv(this,void 0,void 0,function(){var e,t,n,r;return Vv(this,function(a){switch(a.label){case 0:return t=(e=this).input,(n=e.options)instanceof Vy?[4,Fx.mtcnn.forward(t,n)]:[3,2];case 1:return[2,a.sent().map(function(e){return e.detection})];case 2:if(r=n instanceof dx?function(e){return Fx.tinyFaceDetector.locateFaces(e,n)}:n instanceof Jy?function(e){return Fx.ssdMobilenetv1.locateFaces(e,n)}:n instanceof lx?function(e){return Fx.tinyYolov2.locateFaces(e,n)}:null,!r)throw new Error("detectFaces - expected options to be instance of TinyFaceDetectorOptions | SsdMobilenetv1Options | MtcnnOptions | TinyYolov2Options");return[2,r(t)]}})})},t.prototype.runAndExtendWithFaceDetections=function(){var e=this;return new Promise(function(t){return Wv(e,void 0,void 0,function(){var e;return Vv(this,function(n){switch(n.label){case 0:return[4,this.run()];case 1:return e=n.sent(),[2,t(e.map(function(e){return bb({},e)}))]}})})})},t.prototype.withFaceLandmarks=function(e){return void 0===e&&(e=!1),new Xx(this.runAndExtendWithFaceDetections(),this.input,e)},t.prototype.withFaceExpressions=function(){return new Lx(this.runAndExtendWithFaceDetections(),this.input)},t.prototype.withAgeAndGender=function(){return new zx(this.runAndExtendWithFaceDetections(),this.input)},t}($x),Qx=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return zv(t,e),t.prototype.run=function(){return Wv(this,void 0,void 0,function(){var e,t;return Vv(this,function(n){switch(n.label){case 0:return[4,new Jx(this.input,this.options)];case 1:return e=n.sent(),t=e[0],e.forEach(function(e){e.score>t.score&&(t=e)}),[2,t]}})})},t.prototype.runAndExtendWithFaceDetection=function(){var e=this;return new Promise(function(t){return Wv(e,void 0,void 0,function(){var e;return Vv(this,function(n){switch(n.label){case 0:return[4,this.run()];case 1:return e=n.sent(),[2,t(e?bb({},e):void 0)]}})})})},t.prototype.withFaceLandmarks=function(e){return void 0===e&&(e=!1),new Yx(this.runAndExtendWithFaceDetection(),this.input,e)},t.prototype.withFaceExpressions=function(){return new Px(this.runAndExtendWithFaceDetection(),this.input)},t.prototype.withAgeAndGender=function(){return new Ux(this.runAndExtendWithFaceDetection(),this.input)},t}($x);function Zx(e,t){return void 0===t&&(t=new Jy),new Qx(e,t)}!function(){function e(e,t){void 0===t&&(t=.6),this._distanceThreshold=t;var n=Array.isArray(e)?e:[e];if(!n.length)throw new Error("FaceRecognizer.constructor - expected atleast one input");var r=1,a=function(){return"person "+r++};this._labeledDescriptors=n.map(function(e){if(e instanceof vb)return e;if(e instanceof Float32Array)return new vb(a(),[e]);if(e.descriptor&&e.descriptor instanceof Float32Array)return new vb(a(),[e.descriptor]);throw new Error("FaceRecognizer.constructor - expected inputs to be of type LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array | Array<LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array>")})}Object.defineProperty(e.prototype,"labeledDescriptors",{get:function(){return this._labeledDescriptors},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"distanceThreshold",{get:function(){return this._distanceThreshold},enumerable:!0,configurable:!0}),e.prototype.computeMeanDistance=function(e,t){return t.map(function(t){return function(e,t){if(e.length!==t.length)throw new Error("euclideanDistance: arr1.length !== arr2.length");var n=Array.from(e),r=Array.from(t);return Math.sqrt(n.map(function(e,t){return e-r[t]}).reduce(function(e,t){return e+Math.pow(t,2)},0))}(t,e)}).reduce(function(e,t){return e+t},0)/(t.length||1)},e.prototype.matchDescriptor=function(e){var t=this;return this.labeledDescriptors.map(function(n){var r=n.descriptors,a=n.label;return new mb(a,t.computeMeanDistance(e,r))}).reduce(function(e,t){return e.distance<t.distance?e:t})},e.prototype.findBestMatch=function(e){var t=this.matchDescriptor(e);return t.distance<this.distanceThreshold?t:new mb("unknown",t.distance)},e.prototype.toJSON=function(){return{distanceThreshold:this.distanceThreshold,labeledDescriptors:this.labeledDescriptors.map(function(e){return e.toJSON()})}},e.fromJSON=function(t){var n=t.labeledDescriptors.map(function(e){return vb.fromJSON(e)});return new e(n,t.distanceThreshold)}}();const ew=e=>{let{onAddSuccess:t,onCancel:n}=e;const[r,a]=(0,c.useState)({name:"",email:"",password:"",rfid:""}),[i,o]=(0,c.useState)([]),[s,l]=(0,c.useState)(""),[u,h]=(0,c.useState)(!1),[d,f]=(0,c.useState)(!1),p=(0,c.useRef)(null),[m,g]=(0,c.useState)(!1),[v,b]=(0,c.useState)(""),y=()=>{const e="ABCDEFGHIJKLMNOPQRSTUVWXYZ";return e.charAt(Math.floor(26*Math.random()))+e.charAt(Math.floor(26*Math.random()))+Math.floor(1e3+9e3*Math.random()).toString()};(0,c.useEffect)(()=>{x(),a(e=>Kt(Kt({},e),{},{rfid:y()}))},[]);const x=async()=>{const e="/models";try{await Fx.ssdMobilenetv1.loadFromUri(e),await Fx.faceLandmark68Net.loadFromUri(e),await Fx.faceRecognitionNet.loadFromUri(e),g(!0)}catch(t){console.error("Error loading models:",t),l("Failed to load face recognition models."),h(!0)}},w=e=>{a(Kt(Kt({},r),{},{[e.target.name]:e.target.value}))};return(0,xa.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),f(!0),i.length>0&&i.length<3)return l("For high accuracy, please capture at least 3 face photos or remove all to skip face registration."),h(!0),void f(!1);try{const e=Kt(Kt({},r),{},{faceEncodings:i.length>0?i:[]});await ya.post("/fighters/register",e),l("Fighter added successfully with high accuracy face recognition!"),h(!1),a({name:"",email:"",password:"",rfid:y()}),o([]),t&&t()}catch(u){var n,s,c;console.error("Registration error:",(null===(n=u.response)||void 0===n?void 0:n.data)||u.message),l((null===(s=u.response)||void 0===s||null===(c=s.data)||void 0===c?void 0:c.msg)||"Error adding fighter. Please try again."),h(!0)}finally{f(!1)}},className:"space-y-8",children:[s&&(0,xa.jsxs)("div",{className:"p-4 rounded-xl flex items-center ".concat(u?"bg-red-50 border border-red-200 text-red-800":"bg-green-50 border border-green-200 text-green-800"),children:[u?(0,xa.jsx)(gt,{className:"mr-3 text-red-500"}):(0,xa.jsx)(st,{className:"mr-3 text-green-500"}),(0,xa.jsx)("span",{className:"font-medium",children:s})]}),(0,xa.jsxs)("div",{className:"bg-gray-50 rounded-xl p-6 border border-gray-200",children:[(0,xa.jsxs)("div",{className:"flex items-center mb-6",children:[(0,xa.jsx)("div",{className:"bg-red-100 p-2 rounded-lg mr-3",children:(0,xa.jsx)(Vt,{className:"text-red-600"})}),(0,xa.jsx)("h3",{className:"text-xl font-bold text-gray-800",children:"Personal Information"})]}),(0,xa.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,xa.jsxs)("div",{children:[(0,xa.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",htmlFor:"name",children:["Full Name ",(0,xa.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,xa.jsxs)("div",{className:"relative",children:[(0,xa.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,xa.jsx)(Vt,{className:"text-gray-400"})}),(0,xa.jsx)("input",{type:"text",id:"name",name:"name",value:r.name,onChange:w,className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent transition",required:!0,placeholder:"Enter full name"})]})]}),(0,xa.jsxs)("div",{children:[(0,xa.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",htmlFor:"email",children:["Email Address ",(0,xa.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,xa.jsxs)("div",{className:"relative",children:[(0,xa.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,xa.jsx)(pt,{className:"text-gray-400"})}),(0,xa.jsx)("input",{type:"email",id:"email",name:"email",value:r.email,onChange:w,className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent transition",required:!0,placeholder:"Enter email address"})]})]}),(0,xa.jsxs)("div",{children:[(0,xa.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",htmlFor:"password",children:["Password ",(0,xa.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,xa.jsxs)("div",{className:"relative",children:[(0,xa.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,xa.jsx)(Et,{className:"text-gray-400"})}),(0,xa.jsx)("input",{type:"password",id:"password",name:"password",value:r.password,onChange:w,className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent transition",required:!0,placeholder:"Create a strong password"})]})]}),(0,xa.jsxs)("div",{children:[(0,xa.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",htmlFor:"rfid",children:["RFID ",(0,xa.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,xa.jsxs)("div",{className:"relative",children:[(0,xa.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,xa.jsx)(St,{className:"text-gray-400"})}),(0,xa.jsx)("input",{type:"text",id:"rfid",name:"rfid",value:r.rfid,readOnly:!0,className:"w-full pl-10 pr-12 py-3 border border-gray-300 rounded-lg bg-gray-100 text-gray-600 cursor-not-allowed",placeholder:"RFID will be generated"}),(0,xa.jsx)("button",{type:"button",onClick:()=>a(e=>Kt(Kt({},e),{},{rfid:y()})),className:"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-500 hover:text-gray-700",title:"Regenerate RFID",children:(0,xa.jsx)(Dt,{})})]})]})]})]}),(0,xa.jsxs)("div",{className:"bg-gray-50 rounded-xl p-6 border border-gray-200",children:[(0,xa.jsxs)("div",{className:"flex items-center mb-6",children:[(0,xa.jsx)("div",{className:"bg-blue-100 p-2 rounded-lg mr-3",children:(0,xa.jsx)(jt,{className:"text-blue-600"})}),(0,xa.jsx)("h3",{className:"text-xl font-bold text-gray-800",children:"Face Recognition Setup"}),(0,xa.jsx)("span",{className:"ml-3 inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-yellow-100 text-yellow-800",children:"Optional"})]}),(0,xa.jsx)("p",{className:"text-gray-600 mb-6",children:"Capture 5 clear images of the fighter's face from different angles for better attendance recognition. This will enable face recognition for attendance tracking."}),(0,xa.jsxs)("div",{className:"flex flex-col lg:flex-row items-center gap-8 mb-6",children:[(0,xa.jsxs)("div",{className:"w-full lg:w-72",children:[(0,xa.jsx)("div",{className:"rounded-xl overflow-hidden border-2 border-gray-300 shadow-md",children:(0,xa.jsx)(Ia(),{audio:!1,ref:p,screenshotFormat:"image/jpeg",width:288,height:216,className:"w-full"})}),(0,xa.jsx)("div",{className:"mt-3 text-center",children:(0,xa.jsx)("p",{className:"text-sm text-gray-500",children:"Position face in the center of the frame"})})]}),(0,xa.jsxs)("div",{className:"flex-grow w-full",children:[(0,xa.jsxs)("button",{type:"button",onClick:async()=>{if(i.length>=4)b("Maximum of 4 photos reached for high accuracy.");else{if(b("Detecting face with high accuracy..."),f(!0),p.current&&m){const e=p.current.getScreenshot();if(e){const t=await Hb(e),n=await Zx(t,new Jy({minConfidence:.9})).withFaceLandmarks().withFaceDescriptor();if(n){const e={encoding:Array.from(n.descriptor),angle:"capture_".concat(i.length+1),timestamp:(new Date).toISOString()};o(t=>[...t,e]),b("Capture ".concat(i.length+1," successful!")),i.length+1>=4&&b("Maximum captures reached. Face registration complete for high accuracy.")}else b("No face detected. Ensure good lighting and try again.")}}f(!1)}},className:"w-full flex items-center justify-center bg-gradient-to-r from-blue-500 to-blue-600 text-white font-bold py-3 px-4 rounded-lg hover:from-blue-600 hover:to-blue-700 transition duration-300 disabled:opacity-50 shadow-md",disabled:d||!m||i.length>=5,children:[(0,xa.jsx)(it,{className:"mr-2"}),d?"Processing...":"Capture Face (".concat(i.length,"/5)")]}),(0,xa.jsxs)("div",{className:"mt-4",children:[(0,xa.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2.5",children:(0,xa.jsx)("div",{className:"bg-blue-600 h-2.5 rounded-full transition-all duration-300",style:{width:"".concat(i.length/5*100,"%")}})}),(0,xa.jsxs)("div",{className:"flex justify-between text-sm text-gray-600 mt-1",children:[(0,xa.jsx)("span",{children:"Progress"}),(0,xa.jsxs)("span",{children:[i.length,"/5 captures"]})]})]}),(0,xa.jsxs)("div",{className:"mt-3 text-center",children:[(0,xa.jsx)("p",{className:"text-sm ".concat(v.includes("successful")?"text-green-600":v.includes("No face")?"text-red-600":"text-gray-600"),children:v||"Position face in the center and capture."}),0===i.length&&(0,xa.jsx)("p",{className:"text-orange-600 mt-2 font-medium",children:"Face recognition is recommended for attendance."}),i.length>=5&&(0,xa.jsx)("p",{className:"text-green-600 mt-2 font-medium",children:"Maximum of 5 photos captured."})]})]})]}),i.length>0&&(0,xa.jsxs)("div",{className:"mt-6",children:[(0,xa.jsx)("h4",{className:"font-medium text-gray-700 mb-3",children:"Captured Photos:"}),(0,xa.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-5 gap-3",children:i.map((e,t)=>(0,xa.jsxs)("div",{className:"relative group",children:[(0,xa.jsx)("div",{className:"bg-gradient-to-br from-blue-100 to-blue-200 border-2 border-dashed border-blue-300 rounded-xl w-16 h-16 flex items-center justify-center shadow-sm",children:(0,xa.jsx)("span",{className:"text-lg font-bold text-blue-700",children:t+1})}),(0,xa.jsx)("button",{type:"button",onClick:()=>(e=>{o(t=>t.filter((t,n)=>n!==e))})(t),className:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full p-1.5 opacity-0 group-hover:opacity-100 transition-opacity shadow-md hover:bg-red-600",title:"Remove photo",children:(0,xa.jsx)(Pt,{size:10})})]},t))})]})]}),(0,xa.jsxs)("div",{className:"flex flex-col sm:flex-row justify-end gap-4 pt-4",children:[(0,xa.jsx)("button",{type:"button",onClick:n,className:"w-full sm:w-auto bg-gray-200 text-gray-800 font-bold py-3 px-6 rounded-lg hover:bg-gray-300 transition duration-300",children:"Cancel"}),(0,xa.jsx)("button",{type:"submit",className:"w-full sm:w-auto bg-gradient-to-r from-red-600 to-red-700 text-white font-bold py-3 px-6 rounded-lg hover:from-red-700 hover:to-red-800 transition duration-300 disabled:opacity-50 shadow-md",disabled:d,children:d?(0,xa.jsxs)("span",{className:"flex items-center justify-center",children:[(0,xa.jsxs)("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,xa.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,xa.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Saving Fighter..."]}):"Add Fighter"})]})]})},tw=()=>{const e=ie();return(0,xa.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 py-8 px-4 sm:px-6",children:(0,xa.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,xa.jsxs)("div",{className:"text-center mb-8",children:[(0,xa.jsx)("h1",{className:"text-3xl md:text-4xl font-bold text-gray-900 mb-2",children:"Register New Fighter"}),(0,xa.jsx)("p",{className:"text-gray-600 max-w-2xl mx-auto",children:"Add a new fighter to the system. Fill in the required information and optionally set up face recognition for attendance tracking."})]}),(0,xa.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl overflow-hidden",children:[(0,xa.jsx)("div",{className:"bg-gradient-to-r from-red-600 to-red-700 px-6 py-4",children:(0,xa.jsx)("h2",{className:"text-xl font-semibold text-white",children:"Fighter Registration Form"})}),(0,xa.jsx)("div",{className:"p-6 md:p-8",children:(0,xa.jsx)(ew,{onAddSuccess:()=>{e("/admin")},onCancel:()=>{e("/admin")}})})]})]})})},nw=()=>{const{id:e}=oe(),t=ie(),[n,r]=(0,c.useState)({name:"",fighterBatchNo:"",email:""}),[a,i]=(0,c.useState)(""),[o,s]=(0,c.useState)(!1),[l,u]=(0,c.useState)(!0);(0,c.useEffect)(()=>{(async()=>{try{const t=await ya.get("/fighters/".concat(e));r({name:t.data.name,fighterBatchNo:t.data.fighterBatchNo,email:t.data.email})}catch(t){i("Error fetching fighter data."),s(!0),console.error(t)}finally{u(!1)}})()},[e]);const h=e=>{r(Kt(Kt({},n),{},{[e.target.name]:e.target.value}))};return l?(0,xa.jsx)("div",{className:"p-8 text-center text-gray-500",children:"Loading fighter data for editing..."}):(0,xa.jsxs)("div",{className:"p-4 md:p-8 max-w-xl mx-auto",children:[(0,xa.jsx)("h2",{className:"text-3xl font-bold mb-6 text-center text-red-600",children:"Edit Fighter"}),(0,xa.jsxs)("form",{onSubmit:async r=>{r.preventDefault();try{await ya.put("/fighters/".concat(e),n),i("Fighter updated successfully!"),s(!1),setTimeout(()=>t("/admin"),2e3)}catch(a){i("Error updating fighter. Please try again."),s(!0),console.error(a)}},className:"bg-white p-6 rounded-lg shadow-md space-y-4",children:[a&&(0,xa.jsx)("div",{className:"p-3 rounded-md text-sm ".concat(o?"bg-red-100 text-red-700":"bg-green-100 text-green-700"),children:a}),(0,xa.jsxs)("div",{children:[(0,xa.jsx)("label",{className:"block text-gray-700",children:"Fighter Name"}),(0,xa.jsx)("input",{type:"text",name:"name",value:n.name,onChange:h,className:"w-full px-3 py-2 border rounded-md",required:!0})]}),(0,xa.jsxs)("div",{children:[(0,xa.jsx)("label",{className:"block text-gray-700",children:"Batch Number"}),(0,xa.jsx)("input",{type:"text",name:"fighterBatchNo",value:n.fighterBatchNo,onChange:h,className:"w-full px-3 py-2 border rounded-md",required:!0})]}),(0,xa.jsxs)("div",{children:[(0,xa.jsx)("label",{className:"block text-gray-700",children:"Email (for login)"}),(0,xa.jsx)("input",{type:"email",name:"email",value:n.email,onChange:h,className:"w-full px-3 py-2 border rounded-md",required:!0})]}),(0,xa.jsx)("button",{type:"submit",className:"w-full bg-blue-600 text-white py-2 rounded-md hover:bg-blue-700 transition duration-300",children:"Save Changes"})]})]})},rw=()=>(0,xa.jsx)(nw,{}),aw=e=>{let{fighterData:t}=e;const[n,r]=(0,c.useState)(t||null),[a,i]=(0,c.useState)(!0),[o,s]=(0,c.useState)(null),l=["stance","jab","straight","left_hook","right_hook","thigh_kick","rib_kick","face_slap_kick","inner_kick","outer_kick","front_kick","rise_kick","boxing_movements","push_ups","cambo"],u=["stamina","speed","flexibility","power","martial_arts_knowledge","discipline"];(0,c.useEffect)(()=>{if(t)return r(t),void i(!1);const e=async()=>{try{const e=await ya.get("/fighters/me");r(e.data)}catch(n){var e,t;console.error("Error fetching fighter data:",n),401===(null===(e=n.response)||void 0===e?void 0:e.status)||403===(null===(t=n.response)||void 0===t?void 0:t.status)?s("Please log in to view your level progress"):s("Failed to load fighter data. Please try again later.")}finally{i(!1)}};e();const n=setInterval(e,3e3);return()=>clearInterval(n)},[t]);const h=e=>e<30?"bg-red-500":e<70?"bg-yellow-500":"bg-green-500",d=e=>e<30?"from-red-400 to-red-600":e<70?"from-yellow-400 to-yellow-600":"from-green-400 to-green-600",f=e=>{let{percentage:t,label:n,size:r=120}=e;const a=(r-8)/2,i=2*a*Math.PI,o=i-Math.min(100,t)/100*i;return(0,xa.jsxs)("div",{className:"flex flex-col items-center",children:[(0,xa.jsxs)("div",{className:"relative",children:[(0,xa.jsxs)("svg",{width:r,height:r,className:"transform -rotate-90",children:[(0,xa.jsx)("circle",{cx:r/2,cy:r/2,r:a,stroke:"currentColor",strokeWidth:8,fill:"transparent",className:"text-gray-200"}),(0,xa.jsx)("circle",{cx:r/2,cy:r/2,r:a,stroke:"currentColor",strokeWidth:8,fill:"transparent",strokeDasharray:i,strokeDashoffset:o,className:"text-".concat(h(t).split("-")[1],"-500"),strokeLinecap:"round"})]}),(0,xa.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,xa.jsxs)("span",{className:"text-xl font-bold text-gray-800",children:[t,"%"]})})]}),(0,xa.jsx)("span",{className:"mt-2 text-sm font-medium text-gray-600",children:n})]})},p=e=>{let{label:t,percentage:n,color:r}=e;return(0,xa.jsxs)("div",{className:"mb-4",children:[(0,xa.jsxs)("div",{className:"flex justify-between mb-1",children:[(0,xa.jsx)("span",{className:"text-sm font-medium text-gray-700",children:t}),(0,xa.jsxs)("span",{className:"text-sm font-medium text-gray-700",children:[n,"%"]})]}),(0,xa.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-3",children:(0,xa.jsx)("div",{className:"h-3 rounded-full bg-gradient-to-r ".concat(d(n)," transition-all duration-1000 ease-out"),style:{width:"".concat(Math.min(100,n),"%")}})})]})};if(a)return(0,xa.jsx)("div",{className:"bg-white p-6 rounded-lg shadow-md",children:(0,xa.jsxs)("div",{className:"text-center p-8",children:[(0,xa.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-red-600 mx-auto mb-4"}),(0,xa.jsx)("p",{className:"text-gray-600",children:"Loading level progress..."})]})});if(o)return(0,xa.jsx)("div",{className:"bg-white p-6 rounded-lg shadow-md",children:(0,xa.jsxs)("div",{className:"text-center p-8",children:[(0,xa.jsx)("div",{className:"text-red-500 text-2xl mb-2",children:"\u26a0\ufe0f"}),(0,xa.jsx)("p",{className:"text-red-600 font-medium",children:o}),o.includes("log in")?(0,xa.jsx)("p",{className:"text-gray-500 mt-2",children:"Please log in to view your level progress"}):(0,xa.jsx)("p",{className:"text-gray-500 mt-2",children:"Please contact your administrator"})]})});if(!n||!n.assessment)return(0,xa.jsx)("div",{className:"bg-white p-6 rounded-lg shadow-md",children:(0,xa.jsxs)("div",{className:"text-center p-8",children:[(0,xa.jsx)("div",{className:"text-gray-400 text-4xl mb-2",children:"\ud83d\udcca"}),(0,xa.jsx)("h3",{className:"text-xl font-semibold text-gray-700 mb-2",children:"Level Progress"}),(0,xa.jsx)("p",{className:"text-gray-500",children:"Your assessment has not been recorded by an admin yet."}),(0,xa.jsx)("p",{className:"text-gray-400 text-sm mt-2",children:"Check back later for updates."})]})});const m=(()=>{if(!n||!n.assessment)return{overallProgress:0,tribeLevel:0,technicalProgress:0,skillProgress:0,specialGradeScore:0};const e=n.assessment;let t=0,r=0,a=0;l.forEach(n=>{const i=e[n]||{},o=parseInt(i.fighterScore)||0,s=parseInt(i.masterScore)||0;s>0&&(t+=o,r+=s,a++)});const i=r>0?Math.min(100,Math.round(t/r*100)):0;let o=0,s=0,c=0;u.forEach(t=>{const n=e[t]||{},r=parseInt(n.fighterScore)||0,a=parseInt(n.masterScore)||0;a>0&&(o+=r,s+=a,c++)});const h=s>0?Math.min(100,Math.round(o/s*100)):0,d=a+c>0?Math.min(100,Math.round((i*a+h*c)/(a+c))):0,f=parseInt(e.specialGradeScore)||0;return{overallProgress:d,tribeLevel:Math.min(100,Math.max(0,f)),technicalProgress:i,skillProgress:h,specialGradeScore:f}})();return(0,xa.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-md",children:[(0,xa.jsxs)("div",{className:"mb-6",children:[(0,xa.jsx)("h3",{className:"text-xl font-semibold text-gray-800 mb-2",children:"Real-Time Level Progress"}),(0,xa.jsx)("p",{className:"text-gray-600 text-sm",children:"Dynamically updated based on admin assessments"})]}),(0,xa.jsx)("div",{className:"flex flex-col items-center mb-6",children:(0,xa.jsx)(f,{percentage:m.overallProgress,label:"Overall Progress",size:140})}),(0,xa.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[(0,xa.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg",children:[(0,xa.jsxs)("h4",{className:"font-semibold text-gray-700 mb-3 flex items-center",children:[(0,xa.jsx)("span",{className:"w-3 h-3 bg-blue-500 rounded-full mr-2"}),"Technical Skills"]}),(0,xa.jsx)(p,{label:"Techniques Mastery",percentage:m.technicalProgress,color:h(m.technicalProgress)})]}),(0,xa.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg",children:[(0,xa.jsxs)("h4",{className:"font-semibold text-gray-700 mb-3 flex items-center",children:[(0,xa.jsx)("span",{className:"w-3 h-3 bg-purple-500 rounded-full mr-2"}),"Skill Advantages"]}),(0,xa.jsx)(p,{label:"Attributes Development",percentage:m.skillProgress,color:h(m.skillProgress)})]})]}),(0,xa.jsxs)("div",{className:"mb-6 pt-4 border-t border-gray-200",children:[(0,xa.jsxs)("div",{className:"flex justify-between items-center mb-3",children:[(0,xa.jsxs)("h4",{className:"font-semibold text-gray-700 flex items-center",children:[(0,xa.jsx)("span",{className:"w-3 h-3 bg-indigo-500 rounded-full mr-2"}),"Tribe Level"]}),(0,xa.jsx)("span",{className:"text-lg font-bold text-indigo-600",children:m.tribeLevel})]}),(0,xa.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-4",children:(0,xa.jsx)("div",{className:"h-4 rounded-full bg-gradient-to-r from-indigo-500 to-purple-500 transition-all duration-1000 ease-out",style:{width:"".concat(Math.min(100,m.tribeLevel),"%")}})}),(0,xa.jsx)("p",{className:"text-xs text-gray-500 mt-2",children:"Based on your special grade score"})]}),(0,xa.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg border border-blue-100",children:[(0,xa.jsx)("span",{className:"font-medium text-gray-700",children:"Special Grade Score"}),(0,xa.jsx)("span",{className:"px-3 py-1 bg-blue-500 text-white font-bold rounded-full text-sm",children:m.specialGradeScore})]}),(0,xa.jsxs)("div",{className:"mt-4 flex items-center justify-center text-xs text-gray-500",children:[(0,xa.jsxs)("span",{className:"flex h-2 w-2 mr-1",children:[(0,xa.jsx)("span",{className:"animate-ping absolute h-2 w-2 rounded-full bg-green-400 opacity-75"}),(0,xa.jsx)("span",{className:"relative h-2 w-2 rounded-full bg-green-500"})]}),"Live updates enabled"]})]})},iw=()=>{var e;const{id:t}=oe(),[n,r]=(0,c.useState)(null),[a,i]=(0,c.useState)(!0);if((0,c.useEffect)(()=>{(async()=>{try{const e=await ya.get("/fighters/".concat(t));r(e.data)}catch(e){console.error("Error fetching fighter details:",e)}finally{i(!1)}})()},[t]),a)return(0,xa.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-100",children:"Loading fighter details..."});if(!n)return(0,xa.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-100 p-8",children:"Fighter not found."});const o=e=>{let{label:t,value:n}=e;return(0,xa.jsxs)("div",{children:[(0,xa.jsx)("p",{className:"text-sm text-gray-400",children:t}),(0,xa.jsx)("p",{className:"text-white font-medium",children:n||"N/A"})]})},s=e=>{var t;let{skill:r}=e;const a=(null===(t=n.assessment)||void 0===t?void 0:t[r])||{},i=a.fighterScore||0,o=a.masterScore||0,s=o-i;return(0,xa.jsxs)("tr",{className:"border-b border-gray-700",children:[(0,xa.jsx)("td",{className:"py-2 px-2 capitalize text-gray-300 font-medium",children:r.replace(/_/g," ")}),(0,xa.jsx)("td",{className:"py-2 px-2 text-center text-white",children:i}),(0,xa.jsx)("td",{className:"py-2 px-2 text-center text-white",children:o}),(0,xa.jsx)("td",{className:"py-2 px-2 text-center text-white font-bold",children:s})]})};return(0,xa.jsx)("div",{className:"p-4 sm:p-6 lg:p-8 bg-gray-100 min-h-full",children:(0,xa.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,xa.jsx)("div",{className:"text-center mb-8 border-b pb-4",children:(0,xa.jsx)("h1",{className:"text-4xl font-bold text-gray-800",children:"Fighter Profile"})}),(0,xa.jsxs)("div",{className:"bg-white shadow-lg rounded-lg p-6",children:[(0,xa.jsx)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:(0,xa.jsx)("div",{className:"lg:col-span-3",children:(0,xa.jsxs)("div",{className:"bg-gray-800 p-6 rounded-lg shadow-lg h-full",children:[(0,xa.jsx)("h2",{className:"text-2xl font-bold border-b-2 border-red-500 pb-2 mb-6 text-white",children:"Fighter Details"}),(0,xa.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,xa.jsxs)("div",{className:"md:col-span-1 flex flex-col items-center text-center",children:[(0,xa.jsx)("div",{className:"w-32 h-32 bg-gray-700 rounded-full mb-4 border-2 border-gray-600 flex items-center justify-center",children:(0,xa.jsx)("span",{className:"text-gray-500",children:"No Image"})}),(0,xa.jsx)("h3",{className:"text-2xl font-bold text-white",children:n.name}),(0,xa.jsxs)("p",{className:"text-gray-400 italic mt-2",children:['"',n.motto||"No motto provided",'"']})]}),(0,xa.jsx)("div",{className:"md:col-span-2",children:(0,xa.jsxs)("div",{className:"grid grid-cols-2 gap-x-4 gap-y-5",children:[(0,xa.jsx)(o,{label:"RFID:",value:n.rfid}),(0,xa.jsx)(o,{label:"Batch No:",value:n.fighterBatchNo}),(0,xa.jsx)(o,{label:"Age:",value:n.age}),(0,xa.jsx)(o,{label:"Gender:",value:n.gender}),(0,xa.jsx)(o,{label:"Phone:",value:n.phNo}),(0,xa.jsx)(o,{label:"Height:",value:n.height}),(0,xa.jsx)(o,{label:"Weight:",value:n.weight}),(0,xa.jsx)(o,{label:"Blood Group:",value:n.bloodGroup}),(0,xa.jsx)(o,{label:"Occupation:",value:n.occupation}),(0,xa.jsx)(o,{label:"Package:",value:n.package}),(0,xa.jsx)(o,{label:"Joining Date:",value:new Date(n.dateOfJoining).toLocaleDateString()}),(0,xa.jsx)("div",{className:"col-span-2",children:(0,xa.jsx)(o,{label:"Address:",value:n.address})}),(0,xa.jsx)("div",{className:"col-span-2",children:(0,xa.jsx)(o,{label:"Goals:",value:null===(e=n.goals)||void 0===e?void 0:e.join(", ")})}),(0,xa.jsx)("div",{className:"col-span-2",children:(0,xa.jsx)(o,{label:"Previous Experience:",value:n.previousExperience})}),(0,xa.jsx)("div",{className:"col-span-2",children:(0,xa.jsx)(o,{label:"Medical Issues:",value:n.medicalIssue})})]})})]})]})})}),(0,xa.jsx)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8 mt-8",children:(0,xa.jsx)("div",{className:"lg:col-span-3",children:n.assessment?(0,xa.jsx)(aw,{fighterData:n}):null})}),n.assessment&&(0,xa.jsx)("div",{className:"mt-8",children:(0,xa.jsxs)("div",{className:"bg-gray-800 p-6 rounded-lg shadow-lg",children:[(0,xa.jsx)("h2",{className:"text-2xl font-bold border-b-2 border-red-500 pb-2 mb-6 text-white",children:"Skill Assessment"}),(0,xa.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-x-8",children:[(0,xa.jsxs)("div",{children:[(0,xa.jsx)("h3",{className:"text-xl font-semibold mb-4 text-red-400",children:"Technical Advantage"}),(0,xa.jsxs)("table",{className:"w-full",children:[(0,xa.jsx)("thead",{children:(0,xa.jsxs)("tr",{className:"border-b-2 border-gray-600",children:[(0,xa.jsx)("th",{className:"py-2 px-2 text-left text-sm font-bold text-gray-400",children:"Skill"}),(0,xa.jsx)("th",{className:"py-2 px-2 text-center text-sm font-bold text-gray-400",children:"Fighter Score"}),(0,xa.jsx)("th",{className:"py-2 px-2 text-center text-sm font-bold text-gray-400",children:"Master Score"}),(0,xa.jsx)("th",{className:"py-2 px-2 text-center text-sm font-bold text-gray-400",children:"Diff"})]})}),(0,xa.jsx)("tbody",{children:["stance","jab","straight","left_hook","right_hook","thigh_kick","rib_kick","face_slap_kick","inner_kick","outer_kick","front_kick","rise_kick","boxing_movements","push_ups","cambo"].map(e=>(0,xa.jsx)(s,{skill:e},e))})]})]}),(0,xa.jsxs)("div",{children:[(0,xa.jsx)("h3",{className:"text-xl font-semibold mb-4 text-red-400",children:"Skill Advantage"}),(0,xa.jsxs)("table",{className:"w-full",children:[(0,xa.jsx)("thead",{children:(0,xa.jsxs)("tr",{className:"border-b-2 border-gray-600",children:[(0,xa.jsx)("th",{className:"py-2 px-2 text-left text-sm font-bold text-gray-400",children:"Skill"}),(0,xa.jsx)("th",{className:"py-2 px-2 text-center text-sm font-bold text-gray-400",children:"Fighter Score"}),(0,xa.jsx)("th",{className:"py-2 px-2 text-center text-sm font-bold text-gray-400",children:"Master Score"}),(0,xa.jsx)("th",{className:"py-2 px-2 text-center text-sm font-bold text-gray-400",children:"Diff"})]})}),(0,xa.jsx)("tbody",{children:["stamina","speed","flexibility","power","martial_arts_knowledge","discipline"].map(e=>(0,xa.jsx)(s,{skill:e},e))})]})]})]}),(0,xa.jsx)("div",{className:"mt-6 pt-4 border-t border-gray-700",children:(0,xa.jsxs)("p",{className:"text-lg text-white",children:[(0,xa.jsx)("span",{className:"font-bold text-gray-400",children:"Special Grade Score: "}),n.assessment.specialGradeScore||"N/A"]})})]})})]})]})})},ow=()=>(0,xa.jsx)(iw,{}),sw=()=>{const[e,t]=(0,c.useState)({latitude:"",longitude:"",radius:100,enabled:!0}),[n,r]=(0,c.useState)(""),[a,i]=(0,c.useState)(!0),[o,s]=(0,c.useState)(!1);(0,c.useEffect)(()=>{(async()=>{try{var e,n,r,a;const i=await ya.get("/settings");t({latitude:void 0!==(null===(e=i.data.location)||void 0===e?void 0:e.latitude)?i.data.location.latitude:"",longitude:void 0!==(null===(n=i.data.location)||void 0===n?void 0:n.longitude)?i.data.location.longitude:"",radius:(null===(r=i.data.location)||void 0===r?void 0:r.radius)||100,enabled:void 0===(null===(a=i.data.location)||void 0===a?void 0:a.enabled)||i.data.location.enabled})}catch(o){console.error("Error fetching settings:",o),t({latitude:"",longitude:"",radius:100,enabled:!0})}finally{i(!1)}})()},[]);const l=n=>{const{name:r,value:a,type:i,checked:o}=n.target;"number"===i?"latitude"===r||"longitude"===r?(""===a||/^-?\d*\.?\d*$/.test(a))&&t(Kt(Kt({},e),{},{[r]:a})):"radius"===r?(""===a||/^\d*$/.test(a))&&t(Kt(Kt({},e),{},{[r]:a})):(""===a||/^\d*$/.test(a))&&t(Kt(Kt({},e),{},{[r]:a})):t(Kt(Kt({},e),{},"checkbox"===i?{[r]:o}:{[r]:a}))};return a?(0,xa.jsx)("div",{className:"flex justify-center items-center h-full",children:(0,xa.jsxs)("div",{className:"text-center text-gray-500",children:[(0,xa.jsx)("div",{className:"loader ease-linear rounded-full border-8 border-t-8 border-gray-200 h-32 w-32 mb-4"}),(0,xa.jsx)("h2",{className:"text-xl font-semibold",children:"Loading Settings..."}),(0,xa.jsx)("p",{children:"Please wait a moment."})]})}):(0,xa.jsx)("div",{className:"max-w-2xl mx-auto p-4 md:p-6",children:(0,xa.jsxs)("div",{className:"bg-white rounded-xl shadow-lg overflow-hidden",children:[(0,xa.jsx)("div",{className:"bg-red-600 py-4 px-6",children:(0,xa.jsx)("h2",{className:"text-2xl font-bold text-white text-center",children:"Gym Settings"})}),(0,xa.jsx)("div",{className:"p-6",children:(0,xa.jsxs)("form",{onSubmit:async t=>{t.preventDefault(),r(""),s(!0);try{if(e.enabled){if(!e.latitude&&0!==e.latitude||!e.longitude&&0!==e.longitude)return r("Error: Latitude and longitude are required when location verification is enabled"),void s(!1);const t=parseFloat(e.latitude),n=parseFloat(e.longitude);if(isNaN(t)||isNaN(n))return r("Error: Latitude and longitude must be valid numbers"),void s(!1);if(t<-90||t>90)return r("Error: Latitude must be between -90 and 90 degrees"),void s(!1);if(n<-180||n>180)return r("Error: Longitude must be between -180 and 180 degrees"),void s(!1)}const t=parseInt(e.radius);if(isNaN(t)||t<50||t>500)return r("Error: Radius must be a number between 50 and 500 meters"),void s(!1);let n;n=e.enabled?{latitude:parseFloat(e.latitude),longitude:parseFloat(e.longitude),radius:t,enabled:e.enabled}:{latitude:0,longitude:0,radius:t,enabled:e.enabled},console.log("Sending location data:",{location:n});const a=await ya.post("/settings",{location:n});r(a.data.msg)}catch(i){var n,a;console.error("Error updating settings:",i);const e=(null===(n=i.response)||void 0===n||null===(a=n.data)||void 0===a?void 0:a.msg)||i.message||"Error updating location. Please try again.";r("Error: ".concat(e))}finally{s(!1)}},className:"space-y-6",children:[n&&(0,xa.jsx)("div",{className:"p-3 rounded-md text-sm ".concat(n.includes("Error")?"bg-red-100 text-red-700":"bg-green-100 text-green-700"),children:n}),(0,xa.jsxs)("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:[(0,xa.jsxs)("div",{children:[(0,xa.jsx)("h3",{className:"font-semibold text-gray-800",children:"Location Verification"}),(0,xa.jsx)("p",{className:"text-sm text-gray-600",children:"Enable or disable location verification for attendance"})]}),(0,xa.jsxs)("label",{className:"relative inline-flex items-center cursor-pointer",children:[(0,xa.jsx)("input",{type:"checkbox",name:"enabled",checked:e.enabled,onChange:l,className:"sr-only peer"}),(0,xa.jsx)("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-red-600"})]})]}),(0,xa.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,xa.jsxs)("div",{children:[(0,xa.jsx)("label",{className:"block text-gray-700 font-medium mb-2",children:"Gym Latitude"}),(0,xa.jsx)("input",{type:"number",name:"latitude",value:e.latitude,onChange:l,step:"any",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500",required:e.enabled,disabled:!e.enabled})]}),(0,xa.jsxs)("div",{children:[(0,xa.jsx)("label",{className:"block text-gray-700 font-medium mb-2",children:"Gym Longitude"}),(0,xa.jsx)("input",{type:"number",name:"longitude",value:e.longitude,onChange:l,step:"any",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500",required:e.enabled,disabled:!e.enabled})]})]}),(0,xa.jsxs)("div",{children:[(0,xa.jsx)("label",{className:"block text-gray-700 font-medium mb-2",children:"Allowed Radius (meters)"}),(0,xa.jsx)("input",{type:"number",name:"radius",value:e.radius,onChange:l,min:"50",max:"500",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500",required:!0,disabled:!e.enabled}),(0,xa.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:"Maximum distance fighters can be from the gym to mark attendance"})]}),(0,xa.jsxs)("div",{className:"flex flex-col sm:flex-row gap-3 pt-2",children:[(0,xa.jsx)("button",{type:"button",onClick:async()=>{r(""),navigator.geolocation?navigator.geolocation.getCurrentPosition(n=>{t(Kt(Kt({},e),{},{latitude:parseFloat(n.coords.latitude.toFixed(6)),longitude:parseFloat(n.coords.longitude.toFixed(6))})),r("Location updated successfully!")},e=>{console.error("Error getting location:",e),r("Unable to retrieve your location. Please try again.")}):r("Geolocation is not supported by your browser.")},className:"flex-1 bg-gray-800 text-white font-medium py-2.5 px-4 rounded-lg hover:bg-gray-700 transition duration-300 disabled:bg-gray-400",disabled:!e.enabled||o,children:"Use Current Location"}),(0,xa.jsx)("button",{type:"submit",className:"flex-1 bg-red-600 text-white font-bold py-2.5 px-4 rounded-lg hover:bg-red-700 transition duration-300 disabled:bg-gray-400",disabled:o,children:o?"Saving...":"Save Settings"})]})]})})]})})};class cw{constructor(e,t){this.backend=e,this.dataMover=t,this.data=new WeakMap,this.dataIdsCount=0}get(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)}set(e,t){this.dataIdsCount++,this.data.set(e,t)}has(e){return this.data.has(e)}delete(e){return this.dataIdsCount--,this.data.delete(e)}numDataIds(){return this.dataIdsCount}}class lw{refCount(e){return uw("refCount")}incRef(e){return uw("incRef")}timerAvailable(){return!0}time(e){return uw("time")}read(e){return uw("read")}readSync(e){return uw("readSync")}readToGPU(e,t){return uw("readToGPU")}numDataIds(){return uw("numDataIds")}disposeData(e,t){return uw("disposeData")}write(e,t,n){return uw("write")}move(e,t,n,r,a){return uw("move")}createTensorFromGPUData(e,t,n){return uw("createTensorFromGPUData")}memory(){return uw("memory")}floatPrecision(){return uw("floatPrecision")}epsilon(){return 32===this.floatPrecision()?1e-7:1e-4}dispose(){return uw("dispose")}}function uw(e){throw new Error("'".concat(e,"' not yet implemented or not found in the registry. ")+"This kernel may not be supported by the tfjs backend you have chosen")}function hw(e){let t=e.length,n=0;for(;t>0;)n=Math.random()*t|0,t--,pw(e,t,n)}function dw(e,t,n){return Math.max(e,Math.min(t,n))}function fw(e){return e%2===0?e:e+1}function pw(e,t,n){const r=e[t];e[t]=e[n],e[n]=r}function mw(e,t){if(!e)throw new Error("string"===typeof t?t:t())}function gw(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";mw(yw(e,t),()=>n+" Shapes ".concat(e," and ").concat(t," must match"))}function vw(e){mw(null!=e,()=>"The input to the tensor constructor must be a non-null value.")}function bw(e){if(0===e.length)return 1;let t=e[0];for(let n=1;n<e.length;n++)t*=e[n];return t}function yw(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function xw(e){return e%1===0}function ww(e){const t=Math.ceil(Math.sqrt(e));return[t,Math.ceil(e/t)]}function kw(e,t){return t<=e.length?e:e+" ".repeat(t-e.length)}function Sw(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e=>0,n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;return new Promise((a,i)=>{let o=0;const s=()=>{if(e())return void a();o++;const c=t(o);null!=n&&o>=n?i():null!=r?r(s,c):setTimeout(s,c)};s()})}function Nw(e,t){let n=1,r=-1;for(let i=0;i<e.length;++i)if(e[i]>=0)n*=e[i];else if(-1===e[i]){if(-1!==r)throw Error("Shapes can only have 1 implicit size. "+"Found -1 at dim ".concat(r," and dim ").concat(i));r=i}else if(e[i]<0)throw Error("Shapes can not be < 0. Found ".concat(e[i]," at dim ").concat(i));if(-1===r){if(t>0&&t!==n)throw Error("Size(".concat(t,") must match the product of shape ").concat(e));return e}if(0===n)throw Error("Cannot infer the missing size in [".concat(e,"] when ")+"there are 0 elements");if(t%n!==0)throw Error("The implicit shape can't be a fractional number. "+"Got ".concat(t," / ").concat(n));const a=e.slice();return a[r]=t/n,a}function Cw(e,t){const n=t.length;return e=null==e?t.map((e,t)=>t):[].concat(e),mw(e.every(e=>e>=-n&&e<n),()=>"All values in axis param must be in range [-".concat(n,", ").concat(n,") but ")+"got axis ".concat(e)),mw(e.every(e=>xw(e)),()=>"All values in axis param must be integers but "+"got axis ".concat(e)),e.map(e=>e<0?n+e:e)}function Ew(e,t){const n=[],r=[],a=null!=t&&Array.isArray(t)&&0===t.length,i=null==t||a?null:Cw(t,e).sort();let o=0;for(let s=0;s<e.length;++s){if(null!=i){if(i[o]===s&&1!==e[s])throw new Error("Can't squeeze axis ".concat(s," since its dim '").concat(e[s],"' is not 1"));(null==i[o]||i[o]>s)&&1===e[s]&&(n.push(e[s]),r.push(s)),i[o]<=s&&o++}1!==e[s]&&(n.push(e[s]),r.push(s))}return{newShape:n,keptDims:r}}function Iw(e,t){return Tw(e,t)}function Tw(e,t){let n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else if("bool"===e)n=new Uint8Array(t);else{if("string"!==e)throw new Error("Unknown data type ".concat(e));n=new Array(t)}return n}function _w(e,t){return"complex64"!==t&&(("float32"!==t||"complex64"===e)&&(("int32"!==t||"float32"===e||"complex64"===e)&&("bool"!==t||"bool"!==e)))}function Aw(e){if("float32"===e||"int32"===e)return 4;if("complex64"===e)return 8;if("bool"===e)return 1;throw new Error("Unknown dtype ".concat(e))}function Rw(e){return"string"===typeof e||e instanceof String}function Fw(e){return"number"===typeof e}function Dw(e){return Array.isArray(e)?Dw(e[0]):e instanceof Float32Array?"float32":e instanceof Int32Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray?"int32":Fw(e)?"float32":Rw(e)?"string":function(e){return"boolean"===typeof e}(e)?"bool":"float32"}function Ow(e){return!!(e&&e.constructor&&e.call&&e.apply)}function Lw(e,t){for(let n=t;n<e;++n)if(e%n===0)return n;return e}function Pw(e){const t=e.length;if(t<2)return[];const n=new Array(t-1);n[t-2]=e[t-1];for(let r=t-3;r>=0;--r)n[r]=n[r+1]*e[r+1];return n}function Mw(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const a=new Array;if(1===t.length){const i=t[0]*(r?2:1);for(let t=0;t<i;t++)a[t]=n[e+t]}else{const i=t[0],o=t.slice(1),s=o.reduce((e,t)=>e*t)*(r?2:1);for(let t=0;t<i;t++)a[t]=Mw(e+t*s,o,n,r)}return a}function jw(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(0===e.length)return t[0];const r=e.reduce((e,t)=>e*t)*(n?2:1);if(0===r)return[];if(r!==t.length)throw new Error("[".concat(e,"] does not match the input size ").concat(t.length).concat(n?" for a complex tensor":"","."));return Mw(0,e,t,n)}function Bw(e,t){const n=zw(e,t);for(let r=0;r<n.length;r++)n[r]=1;return n}function zw(e,t){if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t)return new Uint8Array(e);throw new Error("Unknown data type ".concat(t))}function Uw(e,t){const n=e.reduce((e,t)=>e*t,1);if(null==t||"float32"===t)return jw(e,new Float32Array(n));if("int32"===t)return jw(e,new Int32Array(n));if("bool"===t)return jw(e,new Uint8Array(n));throw new Error("Unknown data type ".concat(t))}function Ww(e){e.forEach(t=>{mw(Number.isInteger(t)&&t>=0,()=>"Tensor must have a shape comprised of positive integers but got "+"shape [".concat(e,"]."))})}function Vw(e,t,n){if(0===t)return 0;if(1===t)return e[0];let r=e[e.length-1];for(let a=0;a<e.length-1;++a)r+=n[a]*e[a];return r}function Hw(e,t,n){if(0===t)return[];if(1===t)return[e];const r=new Array(t);for(let a=0;a<r.length-1;++a)r[a]=Math.floor(e/n[a]),e-=r[a]*n[a];return r[r.length-1]=e,r}function Gw(e){return e&&e.then&&"function"===typeof e.then}const qw="tfjsflags";class Kw{constructor(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=Xw,this.populateURLFlags()}setPlatform(e,t){null!=this.platform&&(Yw().getBool("IS_TEST")||Yw().getBool("PROD")||console.warn("Platform ".concat(this.platformName," has already been set. ")+"Overwriting the platform with ".concat(e,"."))),this.platformName=e,this.platform=t}registerFlag(e,t,n){if(this.flagRegistry[e]={evaluationFn:t,setHook:n},null!=this.urlFlags[e]){const t=this.urlFlags[e];Yw().getBool("IS_TEST")||Yw().getBool("PROD")||console.warn("Setting feature override from URL ".concat(e,": ").concat(t,".")),this.set(e,t)}}async getAsync(e){return e in this.flags||(this.flags[e]=await this.evaluateFlag(e)),this.flags[e]}get(e){if(e in this.flags)return this.flags[e];const t=this.evaluateFlag(e);if(Gw(t))throw new Error("Flag ".concat(e," cannot be synchronously evaluated. ")+"Please use getAsync() instead.");return this.flags[e]=t,this.flags[e]}getNumber(e){return this.get(e)}getBool(e){return this.get(e)}getString(e){return this.get(e)}getFlags(){return this.flags}get features(){return this.flags}set(e,t){if(null==this.flagRegistry[e])throw new Error("Cannot set flag ".concat(e," as it has not been registered."));this.flags[e]=t,null!=this.flagRegistry[e].setHook&&this.flagRegistry[e].setHook(t)}evaluateFlag(e){if(null==this.flagRegistry[e])throw new Error("Cannot evaluate flag '".concat(e,"': no evaluation function found."));return this.flagRegistry[e].evaluationFn()}setFlags(e){this.flags=Object.assign({},e)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if("undefined"===typeof this.global||"undefined"===typeof this.global.location||"undefined"===typeof this.global.location.search)return;const e=this.getQueryParams(this.global.location.search);if(qw in e){e[qw].split(",").forEach(e=>{const[t,n]=e.split(":");this.urlFlags[t]=function(e,t){const n=t.toLowerCase();return"true"===n||"false"===n?"true"===n:"".concat(+n)===n?+n:t}(0,n)})}}}function Xw(e){const t={};return e.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];return function(e,t,n){e[decodeURIComponent(t)]=decodeURIComponent(n||"")}(t,r[0],r[1]),r.join("=")}),t}function Yw(){return Jw}let $w,Jw=null;function Qw(){if(null==$w){let e;if("undefined"!==typeof window)e=window;else if("undefined"!==typeof n.g)e=n.g;else if("undefined"!==typeof process)e=process;else{if("undefined"===typeof self)throw new Error("Could not find a global object");e=self}$w=e}return $w}function Zw(e,t){const n=function(){const e=Qw();return null==e._tfGlobals&&(e._tfGlobals=new Map),e._tfGlobals}();if(n.has(e))return n.get(e);{const r=t();return n.set(e,r),n.get(e)}}const ek="Abs",tk="Acos",nk="Acosh",rk="Add",ak="AddN",ik="All",ok="Any",sk="ArgMax",ck="ArgMin",lk="Asin",uk="Asinh",hk="Atan",dk="Atanh",fk="Atan2",pk="AvgPool",mk="AvgPoolGrad",gk="AvgPool3D",vk="AvgPool3DGrad",bk="BatchMatMul",yk="BatchToSpaceND",xk="Bincount",wk="BitwiseAnd",kk="BroadcastArgs",Sk="Cast",Nk="Ceil",Ck="ClipByValue",Ek="Complex",Ik="ComplexAbs",Tk="Concat",_k="Conv2D",Ak="Conv2DBackpropFilter",Rk="Conv2DBackpropInput",Fk="Conv3D",Dk="Conv3DBackpropFilterV2",Ok="Conv3DBackpropInputV2",Lk="Cos",Pk="Cosh",Mk="Cumprod",jk="Cumsum",Bk="CropAndResize",zk="DenseBincount",Uk="DepthToSpace",Wk="DepthwiseConv2dNative",Vk="DepthwiseConv2dNativeBackpropFilter",Hk="DepthwiseConv2dNativeBackpropInput",Gk="Diag",qk="Dilation2D",Kk="Dilation2DBackpropInput",Xk="Dilation2DBackpropFilter",Yk="Draw",$k="RealDiv",Jk="Einsum",Qk="Elu",Zk="EluGrad",eS="Erf",tS="Equal",nS="Exp",rS="ExpandDims",aS="Expm1",iS="FFT",oS="Fill",sS="FlipLeftRight",cS="Floor",lS="FloorDiv",uS="FusedBatchNorm",hS="GatherV2",dS="GatherNd",fS="Greater",pS="GreaterEqual",mS="Identity",gS="IFFT",vS="Imag",bS="IsFinite",yS="IsInf",xS="IsNan",wS="LeakyRelu",kS="Less",SS="LessEqual",NS="LinSpace",CS="Log",ES="Log1p",IS="LogicalAnd",TS="LogicalNot",_S="LogicalOr",AS="LRN",RS="LRNGrad",FS="Max",DS="Maximum",OS="MaxPool",LS="MaxPoolGrad",PS="MaxPool3D",MS="MaxPool3DGrad",jS="MaxPoolWithArgmax",BS="Mean",zS="Min",US="Minimum",WS="MirrorPad",VS="Mod",HS="Multinomial",GS="Multiply",qS="Neg",KS="NotEqual",XS="NonMaxSuppressionV3",YS="NonMaxSuppressionV4",$S="NonMaxSuppressionV5",JS="OnesLike",QS="OneHot",ZS="Pack",eN="PadV2",tN="Pow",nN="Prelu",rN="Prod",aN="RaggedGather",iN="RaggedRange",oN="RaggedTensorToTensor",sN="Range",cN="Real",lN="Reciprocal",uN="Relu",hN="Reshape",dN="ResizeNearestNeighbor",fN="ResizeNearestNeighborGrad",pN="ResizeBilinear",mN="ResizeBilinearGrad",gN="Relu6",vN="Reverse",bN="Round",yN="Rsqrt",xN="ScatterNd",wN="TensorScatterUpdate",kN="SearchSorted",SN="Select",NN="Selu",CN="Slice",EN="Sin",IN="Sinh",TN="Sign",_N="Sigmoid",AN="Softplus",RN="Sqrt",FN="Sum",DN="SpaceToBatchND",ON="SplitV",LN="Softmax",PN="SparseFillEmptyRows",MN="SparseReshape",jN="SparseSegmentMean",BN="SparseSegmentSum",zN="SparseToDense",UN="SquaredDifference",WN="Square",VN="StaticRegexReplace",HN="StridedSlice",GN="StringNGrams",qN="StringSplit",KN="StringToHashBucketFast",XN="Sub",YN="Tan",$N="Tanh",JN="Tile",QN="TopK",ZN="Transform",eC="Transpose",tC="Unique",nC="Unpack",rC="UnsortedSegmentSum",aC="ZerosLike",iC="Step",oC="FromPixels",sC="RotateWithOffset",cC="_FusedMatMul",lC="FusedConv2D",uC="FusedDepthwiseConv2D";function hC(){Yw().getBool("IS_TEST")||Yw().getBool("PROD")||console.warn(...arguments)}function dC(){Yw().getBool("IS_TEST")||Yw().getBool("PROD")||console.log(...arguments)}const fC=Zw("kernelRegistry",()=>new Map),pC=Zw("gradRegistry",()=>new Map);function mC(e,t){const n=xC(e,t);return fC.get(n)}function gC(e){return pC.get(e)}function vC(e){const t=fC.entries(),n=[];for(;;){const{done:r,value:a}=t.next();if(r)break;const[i,o]=a,[s]=i.split("_");s===e&&n.push(o)}return n}function bC(e){const{kernelName:t,backendName:n}=e,r=xC(t,n);fC.has(r)&&hC("The kernel '".concat(t,"' for backend ")+"'".concat(n,"' is already registered")),fC.set(r,e)}function yC(e){const{kernelName:t}=e;pC.has(t)&&Yw().getBool("DEBUG")&&hC("Overriding the gradient for '".concat(t,"'")),pC.set(t,e)}function xC(e,t){return"".concat(t,"_").concat(e)}function wC(e){return e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray}var kC=n(1072);const SC=n.n(kC)()||kC;function NC(e){return SC.fromString(e,!0,16)}const CC=NC("c3a5c85c97cb3127"),EC=NC("b492b66fbe98f273"),IC=NC("9ae16a3b2f90404f");function TC(e){return e.xor(e.shru(47))}function _C(e,t,n){const r=e.slice(t,t+n);return SC.fromBytes(Array.from(r),!0,!0)}function AC(e,t){return _C(e,t,8)}function RC(e,t){return _C(e,t,4)}function FC(e,t){return 0===t?e:e.shru(t).or(e.shl(64-t))}function DC(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:NC("9ddfea08eb382d69"),r=e.xor(t).mul(n);r=r.xor(r.shru(47));let a=t.xor(r).mul(n);return a=a.xor(a.shru(47)),a=a.mul(n),a}function OC(e,t,n,r){return function(e,t,n,r,a,i){a=a.add(e),i=FC(i.add(a).add(r),21);const o=a;return a=(a=a.add(t)).add(n),i=i.add(FC(a,44)),[a.add(r),i.add(o)]}(AC(e,t),AC(e,t+8),AC(e,t+16),AC(e,t+24),n,r)}function LC(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.length;const n=SC.fromNumber(81,!0);if(t<=32)return t<=16?function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.length;if(t>=8){const n=IC.add(2*t),r=AC(e,0).add(IC),a=AC(e,t-8);return DC(FC(a,37).mul(n).add(r),FC(r,25).add(a).mul(n),n)}if(t>=4){const n=IC.add(2*t);return DC(RC(e,0).shl(3).add(t),RC(e,t-4),n)}if(t>0){const n=e[0]+(e[t>>1]<<8),r=t+(e[t-1]<<2);return TC(IC.mul(n).xor(CC.mul(r))).mul(IC)}return IC}(e,t):function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.length;const n=IC.add(2*t),r=AC(e,0).mul(EC),a=AC(e,8),i=AC(e,t-8).mul(n),o=AC(e,t-16).mul(IC);return DC(FC(r.add(a),43).add(FC(i,30)).add(o),r.add(FC(a.add(IC),18)).add(i),n)}(e,t);if(t<=64)return function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.length;const n=IC.add(2*t),r=AC(e,0).mul(IC),a=AC(e,8),i=AC(e,t-8).mul(n),o=AC(e,t-16).mul(IC),s=FC(r.add(a),43).add(FC(i,30)).add(o),c=DC(s,r.add(FC(a.add(IC),18)).add(i),n),l=AC(e,16).mul(n),u=AC(e,24),h=s.add(AC(e,t-32)).mul(n),d=c.add(AC(e,t-24)).mul(n);return DC(FC(l.add(u),43).add(FC(h,30)).add(d),l.add(FC(u.add(r),18)).add(h),n)}(e,t);let r=n,a=n.mul(EC).add(113),i=TC(a.mul(IC).add(113)).mul(IC),o=[SC.UZERO,SC.UZERO],s=[SC.UZERO,SC.UZERO];r=r.mul(IC).add(AC(e,0));let c=0;const l=64*(t-1>>6),u=l+(t-1&63)-63;do{r=FC(r.add(a).add(o[0]).add(AC(e,c+8)),37).mul(EC),a=FC(a.add(o[1]).add(AC(e,c+48)),42).mul(EC),r=r.xor(s[1]),a=a.add(o[0]).add(AC(e,c+40)),i=FC(i.add(s[0]),33).mul(EC),o=OC(e,c,o[1].mul(EC),r.add(s[0])),s=OC(e,c+32,i.add(s[1]),a.add(AC(e,c+16))),[i,r]=[r,i],c+=64}while(c!==l);const h=EC.add(i.and(255).shl(1));return c=u,s[0]=s[0].add(t-1&63),o[0]=o[0].add(s[0]),s[0]=s[0].add(o[0]),r=FC(r.add(a).add(o[0]).add(AC(e,c+8)),37).mul(h),a=FC(a.add(o[1]).add(AC(e,c+48)),42).mul(h),r=r.xor(s[1].mul(9)),a=a.add(o[0].mul(9).add(AC(e,c+40))),i=FC(i.add(s[0]),33).mul(h),o=OC(e,c,o[1].mul(h),r.add(s[0])),s=OC(e,c+32,i.add(s[1]),a.add(AC(e,c+16))),[i,r]=[r,i],DC(DC(o[0],s[0],h).add(TC(a).mul(CC)).add(i),DC(o[1],s[1],h).add(r),h)}function PC(e,t){return"string"===t?BC(e):MC([e],t)}function MC(e,t){if("string"===t)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(e)&&(e=WC(e)),Yw().getBool("DEBUG")&&function(e,t){for(let n=0;n<e.length;n++){const r=e[n];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type ".concat(t," being uploaded contains ").concat(r,"."))}}(e,t),function(e,t){return e instanceof Float32Array&&"float32"===t||e instanceof Int32Array&&"int32"===t||e instanceof Uint8Array&&"bool"===t}(e,t))return e;if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t){const t=new Uint8Array(e.length);for(let n=0;n<t.length;++n)0!==Math.round(e[n])&&(t[n]=1);return t}throw new Error("Unknown data type ".concat(t))}function jC(){return Yw().platform.now()}function BC(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf-8";return t=t||"utf-8",Yw().platform.encode(e,t)}function zC(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf-8";return t=t||"utf-8",Yw().platform.decode(e,t)}function UC(e){return null!=Yw().platform.isTypedArray?Yw().platform.isTypedArray(e):wC(e)}function WC(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(null==t&&(t=[]),"boolean"===typeof e||"number"===typeof e||"string"===typeof e||Gw(e)||null==e||UC(e)&&n)t.push(e);else if(Array.isArray(e)||UC(e))for(let r=0;r<e.length;++r)WC(e[r],t,n);else{let r=-1;for(const t of Object.keys(e))/^([1-9]+[0-9]*|0)$/.test(t)&&(r=Math.max(r,Number(t)));for(let a=0;a<=r;a++)WC(e[a],t,n)}return t}class VC{constructor(e,t){this.backendTimer=e,this.logger=t,null==t&&(this.logger=new GC)}profileKernel(e,t,n){let r;const a=()=>{r=n()};let i;const o=jC();if(this.backendTimer.timerAvailable())i=this.backendTimer.time(a);else{a();for(const e of r)e.dataSync();i=Promise.resolve({kernelMs:jC()-o})}if(Yw().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let s=0;s<r.length;s++){const t=r[s];t.data().then(n=>{HC(n,t.dtype,e)})}return{kernelName:e,outputs:r,inputs:t,timeMs:i.then(e=>e.kernelMs),extraInfo:i.then(e=>null!=e.getExtraProfileInfo?e.getExtraProfileInfo():"")}}logKernelProfile(e){const{kernelName:t,outputs:n,timeMs:r,inputs:a,extraInfo:i}=e;n.forEach(e=>{Promise.all([e.data(),r,i]).then(n=>{this.logger.logKernelProfile(t,e,n[0],n[1],a,n[2])})})}}function HC(e,t,n){if("float32"!==t)return!1;for(let r=0;r<e.length;r++){const t=e[r];if(isNaN(t)||!isFinite(t))return console.warn("Found ".concat(t," in the result of '").concat(n,"'")),!0}return!1}class GC{logKernelProfile(e,t,n,r,a,i){const o="number"===typeof r?kw("".concat(r,"ms"),9):r.error,s=kw(e,25),c=t.rank,l=t.size,u=kw(t.shape.toString(),14);let h="";for(const d in a){const e=a[d];if(null!=e){const n=e.shape||t.shape,r=n.length;h+="".concat(d,": ").concat(r,"D ").concat(r>0?n:""," ")}}console.log("%c".concat(s,"\t%c").concat(o,"\t%c").concat(c,"D ").concat(u,"\t%c").concat(l,"\t%c").concat(h,"\t%c").concat(i),"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}function qC(e,t,n,r){const a=Pw(t),i=function(e,t,n,r){const a=bw(t),i=r[r.length-1],o=new Array(i).fill(0),s=t.length,c="complex64"===n?$C(e):e;if(s>1)for(let l=0;l<a/i;l++){const e=l*i;for(let t=0;t<i;t++)o[t]=Math.max(o[t],KC(c[e+t],0,n).length)}return o}(e,t,n,a),o=t.length,s=YC(e,t,n,a,i),c=["Tensor"];return r&&(c.push("  dtype: ".concat(n)),c.push("  rank: ".concat(o)),c.push("  shape: [".concat(t,"]")),c.push("  values:")),c.push(s.map(e=>"    "+e).join("\n")),c.join("\n")}function KC(e,t,n){let r;return r=Array.isArray(e)?"".concat(parseFloat(e[0].toFixed(7))," + ")+"".concat(parseFloat(e[1].toFixed(7)),"j"):Rw(e)?"'".concat(e,"'"):"bool"===n?XC(e):parseFloat(e.toFixed(7)).toString(),kw(r,t)}function XC(e){return 0===e?"false":"true"}function YC(e,t,n,r,a){let i=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];const o="complex64"===n?2:1,s=t[0],c=t.length;if(0===c){if("complex64"===n){return[KC($C(e)[0],0,n)]}return"bool"===n?[XC(e[0])]:[e[0].toString()]}if(1===c){if(s>20){const t=3*o;let r=Array.from(e.slice(0,t)),i=Array.from(e.slice((s-3)*o,s*o));return"complex64"===n&&(r=$C(r),i=$C(i)),["["+r.map((e,t)=>KC(e,a[t],n)).join(", ")+", ..., "+i.map((e,t)=>KC(e,a[s-3+t],n)).join(", ")+"]"]}return["["+("complex64"===n?$C(e):Array.from(e)).map((e,t)=>KC(e,a[t],n)).join(", ")+"]"]}const l=t.slice(1),u=r.slice(1),h=r[0]*o,d=[];if(s>20){for(let t=0;t<3;t++){const r=t*h,i=r+h;d.push(...YC(e.slice(r,i),l,n,u,a,!1))}d.push("...");for(let t=s-3;t<s;t++){const r=t*h,i=r+h;d.push(...YC(e.slice(r,i),l,n,u,a,t===s-1))}}else for(let m=0;m<s;m++){const t=m*h,r=t+h;d.push(...YC(e.slice(t,r),l,n,u,a,m===s-1))}const f=2===c?",":"";d[0]="["+(s>0?d[0]+f:"");for(let m=1;m<d.length-1;m++)d[m]=" "+d[m]+f;let p=",\n";for(let m=2;m<c;m++)p+="\n";return d[d.length-1]=" "+d[d.length-1]+"]"+(i?"":p),d}function $C(e){const t=[];for(let n=0;n<e.length;n+=2)t.push([e[n],e[n+1]]);return t}class JC{constructor(e,t,n){if(this.dtype=t,this.shape=e.slice(),this.size=bw(e),null!=n){const e=n.length;mw(e===this.size,()=>"Length of values '".concat(e,"' does not match the size ")+"inferred by the shape '".concat(this.size,"'."))}if("complex64"===t)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||Tw(t,this.size),this.strides=Pw(e)}set(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];0===n.length&&(n=[0]),mw(n.length===this.rank,()=>"The number of provided coordinates (".concat(n.length,") must ")+"match the rank (".concat(this.rank,")"));const a=this.locToIndex(n);this.values[a]=e}get(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];0===t.length&&(t=[0]);let r=0;for(const i of t){if(i<0||i>=this.shape[r]){const e="Requested out of range element at ".concat(t,". ")+"  Buffer shape=".concat(this.shape);throw new Error(e)}r++}let a=t[t.length-1];for(let i=0;i<t.length-1;++i)a+=this.strides[i]*t[i];return this.values[a]}locToIndex(e){if(0===this.rank)return 0;if(1===this.rank)return e[0];let t=e[e.length-1];for(let n=0;n<e.length-1;++n)t+=this.strides[n]*e[n];return t}indexToLoc(e){if(0===this.rank)return[];if(1===this.rank)return[e];const t=new Array(this.shape.length);for(let n=0;n<t.length-1;++n)t[n]=Math.floor(e/this.strides[n]),e-=t[n]*this.strides[n];return t[t.length-1]=e,t}get rank(){return this.shape.length}toTensor(){return QC().makeTensor(this.values,this.shape,this.dtype)}}let QC=null,ZC=null,eE=null;class tE{constructor(e,t,n,r){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=bw(e),this.strides=Pw(e),this.dataId=n,this.id=r,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){const e=await this.data();return ZC.buffer(this.shape,this.dtype,e)}bufferSync(){return ZC.buffer(this.shape,this.dtype,this.dataSync())}async array(){const e=await this.data();return jw(this.shape,e,"complex64"===this.dtype)}arraySync(){return jw(this.shape,this.dataSync(),"complex64"===this.dtype)}async data(){this.throwIfDisposed();const e=QC().read(this.dataId);if("string"===this.dtype){const t=await e;try{return t.map(e=>zC(e))}catch(hu){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return e}dataToGPU(e){return this.throwIfDisposed(),QC().readToGPU(this.dataId,e)}dataSync(){this.throwIfDisposed();const e=QC().readSync(this.dataId);if("string"===this.dtype)try{return e.map(e=>zC(e))}catch(hu){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e}async bytes(){this.throwIfDisposed();const e=await QC().read(this.dataId);return"string"===this.dtype?e:new Uint8Array(e.buffer)}dispose(){this.isDisposed||(this.kerasMask&&this.kerasMask.dispose(),QC().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return ZC.print(this,e)}clone(){return this.throwIfDisposed(),ZC.clone(this)}toString(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return qC(this.dataSync(),this.shape,this.dtype,e)}cast(e){return this.throwIfDisposed(),ZC.cast(this,e)}variable(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;return this.throwIfDisposed(),QC().makeVariable(this,e,t,n)}}function nE(){return Zw("Tensor",()=>tE)}Object.defineProperty(tE,Symbol.hasInstance,{value:e=>!!e&&null!=e.data&&null!=e.dataSync&&null!=e.throwIfDisposed}),nE();class rE extends tE{constructor(e,t,n,r){super(e.shape,e.dtype,e.dataId,r),this.trainable=t,this.name=n}assign(e){if(e.dtype!==this.dtype)throw new Error("dtype of the new value (".concat(e.dtype,") and ")+"previous value (".concat(this.dtype,") must match"));if(!yw(e.shape,this.shape))throw new Error("shape of the new value (".concat(e.shape,") and ")+"previous value (".concat(this.shape,") must match"));QC().disposeTensor(this),this.dataId=e.dataId,QC().incRef(this,null)}dispose(){QC().disposeVariable(this),this.isDisposedInternal=!0}}var aE,iE,oE,sE,cE;Object.defineProperty(rE,Symbol.hasInstance,{value:e=>e instanceof tE&&null!=e.assign&&e.assign instanceof Function}),function(e){e.R0="R0",e.R1="R1",e.R2="R2",e.R3="R3",e.R4="R4",e.R5="R5",e.R6="R6"}(aE||(aE={})),function(e){e.float32="float32",e.int32="int32",e.bool="int32",e.complex64="complex64"}(iE||(iE={})),function(e){e.float32="float32",e.int32="int32",e.bool="bool",e.complex64="complex64"}(oE||(oE={})),function(e){e.float32="float32",e.int32="float32",e.bool="float32",e.complex64="complex64"}(sE||(sE={})),function(e){e.float32="complex64",e.int32="complex64",e.bool="complex64",e.complex64="complex64"}(cE||(cE={}));const lE={float32:sE,int32:iE,bool:oE,complex64:cE};function uE(e,t){if("string"===e||"string"===t){if("string"===e&&"string"===t)return"string";throw new Error("Can not upcast ".concat(e," with ").concat(t))}return lE[e][t]}function hE(e){return uE(e,"int32")}function dE(e){return null!=e&&"object"===typeof e&&"texture"in e&&e.texture instanceof WebGLTexture}function fE(e){return"undefined"!==typeof GPUBuffer&&null!=e&&"object"===typeof e&&"buffer"in e&&e.buffer instanceof GPUBuffer}function pE(e,t){if(e.dtype===t.dtype)return[e,t];const n=uE(e.dtype,t.dtype);return[e.cast(n),t.cast(n)]}function mE(e,t){return t.some(t=>t.id===e.id)}function gE(e){const t=[];return vE(e,t,new Set),t}function vE(e,t,n){if(null==e)return;if(e instanceof tE)return void t.push(e);if(r=e,!Array.isArray(r)&&"object"!==typeof r)return;var r;const a=e;for(const i in a){const e=a[i];n.has(e)||(n.add(e),vE(e,t,n))}}function bE(e){return null!=e.kernelName}class yE{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(e=>e.name)))}}}dispose(){for(const e in this.registeredVariables)this.registeredVariables[e].dispose()}}class xE{constructor(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new yE}async ready(){if(null!=this.pendingBackendInit)return this.pendingBackendInit.then(()=>{});if(null!=this.backendInstance)return;const e=this.getSortedBackends();for(let t=0;t<e.length;t++){const n=e[t];if(await this.initializeBackend(n).success)return void await this.setBackend(n)}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(null!=this.pendingBackendInit)throw new Error("Backend '".concat(this.backendName,"' has not yet been initialized. Make ")+"sure to await tf.ready() or await tf.setBackend() before calling other methods");if(null==this.backendInstance){const{name:e,asyncInit:t}=this.initializeBackendsAndReturnBest();if(t)throw new Error("The highest priority backend '".concat(e,"' has not yet been ")+"initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(e)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(e){if(!(e in this.registry)){if(!(e in this.registryFactory))return null;{const{asyncInit:t}=this.initializeBackend(e);if(t)return null}}return this.registry[e]}findBackendFactory(e){return e in this.registryFactory?this.registryFactory[e].factory:null}registerBackend(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return e in this.registryFactory?(hC("".concat(e," backend was already registered. ")+"Reusing existing backend factory."),!1):(this.registryFactory[e]={factory:t,priority:n},!0)}async setBackend(e){if(null==this.registryFactory[e])throw new Error("Backend name '".concat(e,"' not found in registry"));if(this.backendName=e,null==this.registry[e]){this.backendInstance=null;const{success:t,asyncInit:n}=this.initializeBackend(e);if(!(n?await t:t))return!1}return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new VC(this.backendInstance),!0}setupRegisteredKernels(){vC(this.backendName).forEach(e=>{null!=e.setupFunc&&e.setupFunc(this.backendInstance)})}disposeRegisteredKernels(e){vC(e).forEach(t=>{null!=t.disposeFunc&&t.disposeFunc(this.registry[e])})}initializeBackend(e){const t=this.registryFactory[e];if(null==t)throw new Error("Cannot initialize backend ".concat(e,", no registration found."));try{const n=t.factory();if(!n||n instanceof lw||"function"!==typeof n.then)return this.registry[e]=n,{success:!0,asyncInit:!1};{const t=++this.pendingBackendInitId,r=n.then(n=>!(t<this.pendingBackendInitId)&&(this.registry[e]=n,this.pendingBackendInit=null,!0)).catch(n=>(t<this.pendingBackendInitId||(this.pendingBackendInit=null,hC("Initialization of backend ".concat(e," failed")),hC(n.stack||n.message)),!1));return this.pendingBackendInit=r,{success:r,asyncInit:!0}}}catch(n){return hC("Initialization of backend ".concat(e," failed")),hC(n.stack||n.message),{success:!1,asyncInit:!1}}}removeBackend(e){if(!(e in this.registryFactory))throw new Error("".concat(e," backend not found in registry"));this.backendName===e&&null!=this.pendingBackendInit&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(0===Object.keys(this.registryFactory).length)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((e,t)=>this.registryFactory[t].priority-this.registryFactory[e].priority)}initializeBackendsAndReturnBest(){const e=this.getSortedBackends();for(let t=0;t<e.length;t++){const n=e[t],{success:r,asyncInit:a}=this.initializeBackend(n);if(a||r)return{name:n,asyncInit:a}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(e,t){const n=this.state.tensorInfo.get(t),r=n.backend,a=this.readSync(t),i=r.refCount(t);r.disposeData(t,!0),n.backend=e,e.move(t,a,n.shape,n.dtype,i),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(e,t){let n,r=null;if(null==t){if("function"!==typeof e)throw new Error("Please provide a function to tidy()");t=e}else{if("string"!==typeof e&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!==typeof t)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");r=e}return this.scopedRun(()=>this.startScope(r),()=>this.endScope(n),()=>(n=t(),n instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),n))}scopedRun(e,t,n){e();try{const e=n();return t(),e}catch(r){throw t(),r}}nextTensorId(){return xE.nextTensorId++}nextVariableId(){return xE.nextVariableId++}clone(e){const t=kE.runKernel(mS,{x:e}),n={x:e};return this.addTapeNode(this.state.activeScope.name,n,[t],e=>({x:()=>{const t={x:e},n={dtype:"float32"};return kE.runKernel(Sk,t,n)}}),[],{}),t}runKernel(e,t,n){null==this.backendName&&this.backend;if(!(null!=mC(e,this.backendName)))throw new Error("Kernel '".concat(e,"' not registered for backend '").concat(this.backendName,"'"));return this.runKernelFunc({kernelName:e,inputs:t,attrs:n})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(e,t,n){const r=this.backend.numDataIds();let a=0;n.forEach(e=>{a+="complex64"===e.dtype?3:1});const i=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],o=r-t-a-i;if(o>0)throw new Error("Backend '".concat(this.backendName,"' has an internal memory leak ")+"(".concat(o," data ids) after running '").concat(e,"'"))}runKernelFunc(e){let t,n=[];const r=this.isTapeOn(),a=this.state.numBytes,i=this.state.numTensors;let o,s;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0),null==this.backendName&&this.backend;const c=bE(e)?e.kernelName:null!=this.state.activeScope?this.state.activeScope.name:"";if(bE(e)){const{kernelName:t,inputs:a,attrs:i}=e;null==this.backendName&&this.backend;const c=mC(t,this.backendName);mw(null!=c,()=>"Cannot find registered kernel '".concat(t,"' for backend '").concat(this.backendName,"'")),o=()=>{const e=this.backend.numDataIds();s=c.kernelFunc({inputs:a,attrs:i,backend:this.backend});const o=Array.isArray(s)?s:[s];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(t,e,o);const l=o.map(e=>null!=e.rank?e:this.makeTensorFromTensorInfo(e));if(r){const e=this.getTensorsForGradient(t,a,l);n=this.saveTensorsForBackwardMode(e)}return l}}else{const{forwardFunc:t}=e,a=e=>{r&&(n=e.map(e=>this.keep(this.clone(e))))};o=()=>{const e=this.backend.numDataIds();s=this.tidy(()=>t(this.backend,a));const n=Array.isArray(s)?s:[s];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(c,e,n),n}}const{inputs:l,attrs:u}=e,h=bE(e)?null:e.backwardsFunc;let d;return this.scopedRun(()=>this.state.kernelDepth++,()=>this.state.kernelDepth--,()=>{this.ENV.getBool("DEBUG")||this.state.profiling?(d=this.profiler.profileKernel(c,l,()=>o()),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(d),t=d.outputs):t=o()}),r&&this.addTapeNode(c,l,t,h,n,u),this.state.profiling&&this.state.activeProfile.kernels.push({name:c,bytesAdded:this.state.numBytes-a,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-i,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(l).map(e=>null!=l[e]?l[e].shape:null),outputShapes:t.map(e=>e.shape),kernelTimeMs:d.timeMs,extraInfo:d.extraInfo}),Array.isArray(s)?t:t[0]}saveTensorsForBackwardMode(e){return e.map(e=>this.keep(this.clone(e)))}getTensorsForGradient(e,t,n){const r=gC(e);if(null!=r){const e=r.inputsToSave||[],a=r.outputsToSave||[];let i;r.saveAllInputs?(mw(Array.isArray(t),()=>"saveAllInputs is true, expected inputs to be an array."),i=Object.keys(t).map(e=>t[e])):i=e.map(e=>t[e]);const o=n.filter((e,t)=>a[t]);return i.concat(o)}return[]}makeTensor(e,t,n,r){if(null==e)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",r=r||this.backend;let a=e;"string"===n&&Rw(e[0])&&(a=e.map(e=>BC(e)));const i=r.write(a,t,n),o=new tE(t,n,i,this.nextTensorId());if(this.trackTensor(o,r),"string"===n){const e=this.state.tensorInfo.get(i),t=function(e){if(null==e)return 0;let t=0;return e.forEach(e=>t+=e.length),t}(a);this.state.numBytes+=t-e.bytes,e.bytes=t}return o}makeTensorFromDataId(e,t,n,r){const a={dataId:e,shape:t,dtype:n=n||"float32"};return this.makeTensorFromTensorInfo(a,r)}makeTensorFromTensorInfo(e,t){const{dataId:n,shape:r,dtype:a}=e,i=new tE(r,a,n,this.nextTensorId());return this.trackTensor(i,t),i}makeVariable(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;n=n||this.nextVariableId().toString(),null!=r&&r!==e.dtype&&(e=e.cast(r));const a=new rE(e,t,n,this.nextTensorId());if(null!=this.state.registeredVariables[a.name])throw new Error("Variable with name ".concat(a.name," was already registered"));return this.state.registeredVariables[a.name]=a,this.incRef(a,this.backend),a}trackTensor(e,t){this.state.numTensors++,"string"===e.dtype&&this.state.numStringTensors++;let n=0;"complex64"!==e.dtype&&"string"!==e.dtype&&(n=e.size*Aw(e.dtype)),this.state.numBytes+=n,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:n})),e instanceof rE||this.track(e)}incRef(e,t){this.trackTensor(e,t),this.backend.incRef(e.dataId)}removeDataId(e,t){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===t&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)}disposeTensor(e){if(!this.state.tensorInfo.has(e.dataId))return;const t=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,"string"===e.dtype&&(this.state.numStringTensors--,this.state.numBytes-=t.bytes),"complex64"!==e.dtype&&"string"!==e.dtype){const t=e.size*Aw(e.dtype);this.state.numBytes-=t}t.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,t.backend)}disposeVariables(){for(const e in this.state.registeredVariables){const t=this.state.registeredVariables[e];this.disposeVariable(t)}}disposeVariable(e){this.disposeTensor(e),null!=this.state.registeredVariables[e.name]&&delete this.state.registeredVariables[e.name]}memory(){const e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,null==e.reasons&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}async profile(e){this.state.profiling=!0;const t=this.state.numBytes,n=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map(e=>e.totalBytesSnapshot)),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-n;for(const r of this.state.activeProfile.kernels)r.kernelTimeMs=await r.kernelTimeMs,r.extraInfo=await r.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&0===this.state.kernelDepth}addTapeNode(e,t,n,r,a,i){const o={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:n,saved:a},s=gC(e);null!=s&&(r=s.gradFunc),null!=r&&(o.gradient=e=>(e=e.map((e,t)=>{if(null==e){const e=n[t],r=zw(e.size,e.dtype);return this.makeTensor(r,e.shape,e.dtype)}return e}),r(e.length>1?e:e[0],a,i))),this.state.activeTape.push(o)}keep(e){return e.kept=!0,e}startTape(){0===this.state.gradientDepth&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(e){const t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t}endScope(e){const t=gE(e),n=new Set(t.map(e=>e.id));for(let a=0;a<this.state.activeScope.track.length;a++){const e=this.state.activeScope.track[a];e.kept||n.has(e.id)||e.dispose()}const r=this.state.scopeStack.pop();this.state.activeScope=0===this.state.scopeStack.length?null:this.state.scopeStack[this.state.scopeStack.length-1],t.forEach(e=>{e.kept||e.scopeId!==r.id||this.track(e)})}gradients(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(mw(t.length>0,()=>"gradients() received an empty list of xs."),null!=n&&"float32"!==n.dtype)throw new Error("dy must have 'float32' dtype, but has '".concat(n.dtype,"'"));const a=this.scopedRun(()=>this.startTape(),()=>this.endTape(),()=>this.tidy("forward",e));mw(a instanceof tE,()=>"The result y returned by f() must be a tensor.");const i=function(e,t,n){const r={},a={};for(let c=0;c<t.length;c++)r[t[c].id]=!0;for(let c=0;c<e.length;c++){const n=e[c],i=n.inputs;for(const e in i){const o=i[e];let s=!1;for(let e=0;e<t.length;e++)if(r[o.id]){n.outputs.forEach(e=>r[e.id]=!0),s=!0,a[n.id]=!0;break}if(s)break}}const i={};i[n.id]=!0;const o={};for(let c=e.length-1;c>=0;c--){const t=e[c],n=t.inputs;for(let e=0;e<t.outputs.length;e++)if(i[t.outputs[e].id]){for(const e in n)i[n[e].id]=!0,o[t.id]=!0;break}}const s=[];for(let c=0;c<e.length;c++){const t=e[c];if(a[t.id]&&o[t.id]){const e={};for(const a in t.inputs){const n=t.inputs[a];r[n.id]&&(e[a]=n)}const n=Object.assign({},t);n.inputs=e,n.outputs=t.outputs,s.push(n)}}return s}(this.state.activeTape,t,a);if(!r&&0===i.length&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",()=>{const e={};e[a.id]=null==n?function(e){const t=Bw(bw(e),"float32");return kE.makeTensor(t,e,"float32")}(a.shape):n,function(e,t,n,r){for(let a=t.length-1;a>=0;a--){const i=t[a],o=[];if(i.outputs.forEach(t=>{const n=e[t.id];null!=n?o.push(n):o.push(null)}),null==i.gradient)throw new Error("Cannot compute gradient: gradient function not found "+"for ".concat(i.kernelName,"."));const s=i.gradient(o);for(const t in i.inputs){if(!(t in s))throw new Error("Cannot backprop through input ".concat(t,". ")+"Available gradients found: ".concat(Object.keys(s),"."));const a=n(()=>s[t]());if("float32"!==a.dtype)throw new Error("Error in gradient for op ".concat(i.kernelName,". The gradient of input ")+"".concat(t," must have 'float32' dtype, but has '").concat(a.dtype,"'"));const o=i.inputs[t];if(!yw(a.shape,o.shape))throw new Error("Error in gradient for op ".concat(i.kernelName,". The gradient of input ")+"'".concat(t,"' has shape '").concat(a.shape,"', which does not match ")+"the shape of the input '".concat(o.shape,"'"));if(null==e[o.id])e[o.id]=a;else{const t=e[o.id];e[o.id]=r(t,a),t.dispose()}}}}(e,i,e=>this.tidy(e),SE);const r=t.map(t=>e[t.id]);return 0===this.state.gradientDepth&&(this.state.activeTape.forEach(e=>{for(const t of e.saved)t.dispose()}),this.state.activeTape=null),{value:a,grads:r}})}customGrad(e){var t=this;return mw(Ow(e),()=>"The f passed in customGrad(f) must be a function."),function(){for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];let i;mw(r.every(e=>e instanceof tE),()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors");const o={};r.forEach((e,t)=>{o[t]=e});return t.runKernelFunc({forwardFunc:(t,n)=>(i=e(...r,n),mw(i.value instanceof tE,()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),mw(Ow(i.gradFunc),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),i.value),backwardsFunc:(e,t)=>{const n=i.gradFunc(e,t),a=Array.isArray(n)?n:[n];mw(a.length===r.length,()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),mw(a.every(e=>e instanceof tE),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors.");const o={};return a.forEach((e,t)=>{o[t]=()=>e}),o},inputs:o})}}readSync(e){return this.state.tensorInfo.get(e).backend.readSync(e)}read(e){return this.state.tensorInfo.get(e).backend.read(e)}readToGPU(e,t){return this.state.tensorInfo.get(e).backend.readToGPU(e,t)}async time(e){const t=jC(),n=await this.backend.time(e);return n.wallMs=jC()-t,n}track(e){return null!=this.state.activeScope&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new yE;for(const e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}function wE(){const e=Qw();if(null==e._tfengine){const t=new Kw(e);e._tfengine=new xE(t)}return function(e){Jw=e}(e._tfengine.ENV),function(e){QC=e}(()=>e._tfengine),e._tfengine}xE.nextTensorId=0,xE.nextVariableId=0;const kE=wE();function SE(e,t){const n={a:e,b:t};return kE.runKernel(rk,n)}let NE;function CE(e){if(void 0!==NE)return NE;if(e||"undefined"!==typeof navigator&&null!=navigator){if(e||(e=navigator),"ReactNative"===e.product)return!0;const t=e.userAgent||e.vendor||("undefined"!==typeof window?window.opera:"");if(!t){const t=e;return t.userAgentData&&t.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4))}return!1}function EE(){return"undefined"!==typeof window&&null!=window.document||"undefined"!==typeof WorkerGlobalScope}const IE=Yw();function TE(e,t){let n=e;if(UC(e))return"string"===t?[]:[e.length];if(dE(e)){const t=e.channels||"RGBA";return[e.height,e.width*t.length]}if(fE(e))return[e.buffer.size/(null==t?4:Aw(t))];if(!Array.isArray(e))return[];const r=[];for(;Array.isArray(n)||UC(n)&&"string"!==t;)r.push(n.length),n=n[0];return Array.isArray(e)&&Yw().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&_E(e,r,[]),r}function _E(e,t,n){if(n=n||[],!Array.isArray(e)&&!UC(e))return void mw(0===t.length,()=>"Element arr[".concat(n.join("]["),"] is a primitive, ")+"but should be an array/TypedArray of ".concat(t[0]," elements"));mw(t.length>0,()=>"Element arr[".concat(n.join("]["),"] should be a primitive, ")+"but is an array of ".concat(e.length," elements")),mw(e.length===t[0],()=>"Element arr[".concat(n.join("]["),"] should have ").concat(t[0]," ")+"elements, but has ".concat(e.length," elements"));const r=t.slice(1);for(let a=0;a<e.length;++a)_E(e[a],r,n.concat(a))}function AE(e,t,n,r){if("string_or_numeric"!==e){if(null==e)throw new Error("Expected dtype cannot be null.");if("numeric"!==e&&e!==t||"numeric"===e&&"string"===t)throw new Error("Argument '".concat(n,"' passed to '").concat(r,"' must ")+"be ".concat(e," tensor, but got ").concat(t," tensor"))}}function RE(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"numeric";if(e instanceof nE())return AE(r,e.dtype,t,n),e;let a=Dw(e);if("string"!==a&&["bool","int32","float32"].indexOf(r)>=0&&(a=r),AE(r,a,t,n),null==e||!UC(e)&&!Array.isArray(e)&&"number"!==typeof e&&"boolean"!==typeof e&&"string"!==typeof e){const r=null==e?"null":e.constructor.name;throw new Error("Argument '".concat(t,"' passed to '").concat(n,"' must be a ")+"Tensor or TensorLike, but got '".concat(r,"'"))}const i=TE(e,a);UC(e)||Array.isArray(e)||(e=[e]);const o="string"!==a?MC(e,a):WC(e,[],!0);return kE.makeTensor(o,i,a)}function FE(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"numeric";if(!Array.isArray(e))throw new Error("Argument ".concat(t," passed to ").concat(n," must be a ")+"`Tensor[]` or `TensorLike[]`");return e.map((e,a)=>RE(e,"".concat(t,"[").concat(a,"]"),n,r))}IE.registerFlag("DEBUG",()=>!1,e=>{e&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")}),IE.registerFlag("IS_BROWSER",()=>EE()),IE.registerFlag("IS_NODE",()=>"undefined"!==typeof process&&"undefined"!==typeof process.versions&&"undefined"!==typeof process.versions.node),IE.registerFlag("IS_CHROME",()=>"undefined"!==typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)),IE.registerFlag("IS_SAFARI",()=>"undefined"!==typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Safari/.test(navigator.userAgent)&&/Apple/.test(navigator.vendor)),IE.registerFlag("PROD",()=>!1),IE.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",()=>IE.getBool("DEBUG")),IE.registerFlag("DEPRECATION_WARNINGS_ENABLED",()=>!0),IE.registerFlag("IS_TEST",()=>!1),IE.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",()=>IE.getBool("DEBUG")),IE.registerFlag("WRAP_TO_IMAGEBITMAP",()=>!1),IE.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",()=>!1),IE.registerFlag("USE_SETTIMEOUTCUSTOM",()=>!1);function DE(e){const t=Object.keys(e);if(1!==t.length)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+"".concat(t.length," keys."));let n=t[0];const r=e[n];n.endsWith("_")&&(n=n.substring(0,n.length-1)),n+="__op";const a=function(){kE.startScope(n);try{const e=r(...arguments);return Gw(e)&&console.error("Cannot return a Promise inside of tidy."),kE.endScope(e),e}catch(e){throw kE.endScope(null),e}};return Object.defineProperty(a,"name",{value:n,configurable:!0}),a}const OE=DE({complex_:function(e,t){const n=RE(e,"real","complex"),r=RE(t,"imag","complex");gw(n.shape,r.shape,"real and imag shapes, ".concat(n.shape," and ").concat(r.shape,", ")+"must match in call to tf.complex().");const a={real:n,imag:r};return kE.runKernel(Ek,a)}});function LE(e,t,n,r){if(null==r)r=Dw(e);else if("complex64"===r)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(fE(e)||dE(e)){if("float32"!==r&&"int32"!==r)throw new Error("Creating tensor from GPU data only supports "+"'float32'|'int32' dtype, while the dtype is ".concat(r,"."));return kE.backend.createTensorFromGPUData(e,t||n,r)}if(!UC(e)&&!Array.isArray(e)&&"number"!==typeof e&&"boolean"!==typeof e&&"string"!==typeof e)throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(null!=t){Ww(t);const e=bw(t),r=bw(n);mw(e===r,()=>"Based on the provided shape, [".concat(t,"], the tensor should have ")+"".concat(e," values but has ").concat(r));for(let a=0;a<n.length;++a){const e=n[a],r=a!==n.length-1||e!==bw(t.slice(a));mw(n[a]===t[a]||!r,()=>"Error creating a new Tensor. Inferred shape "+"(".concat(n,") does not match the provided ")+"shape (".concat(t,"). "))}}return UC(e)||Array.isArray(e)||(e=[e]),t=t||n,e="string"!==r?MC(e,r):WC(e,[],!0),kE.makeTensor(e,t,r)}function PE(e,t,n){return LE(e,t,TE(e,n),n)}class ME{static join(e){return new ME(e).slice()}constructor(e){if(this.shards=[],this.previousShardIndex=0,null==e)return;if(e instanceof Array||(e=[e]),0===(e=e.map(e=>UC(e)?e.buffer:e)).length)return;this.bufferUniformSize=e[0].byteLength;let t=0;for(let n=0;n<e.length;n++){const r=e[n];n!==e.length-1&&r.byteLength!==this.bufferUniformSize&&(this.bufferUniformSize=void 0);const a=t+r.byteLength;this.shards.push({buffer:r,start:t,end:a}),t=a}0===this.shards.length&&(this.byteLength=0),this.byteLength=this.shards[this.shards.length-1].end}slice(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.byteLength;if(0===this.shards.length)return new ArrayBuffer(0);if(e=isNaN(Number(e))?0:e,t=isNaN(Number(t))?0:t,e=Math.max(0,e),t=Math.min(this.byteLength,t),t<=e)return new ArrayBuffer(0);const n=this.findShardForByte(e);if(-1===n)throw new Error("Could not find start shard for byte ".concat(e));const r=new ArrayBuffer(t-e),a=new Uint8Array(r);let i=0;for(let o=n;o<this.shards.length;o++){const n=this.shards[o],r=e+i-n.start,s=i,c=Math.min(t,n.end)-n.start,l=new Uint8Array(n.buffer,r,c-r);if(a.set(l,s),i+=l.length,t<n.end)break}return r}findShardForByte(e){if(0===this.shards.length||e<0||e>=this.byteLength)return-1;if(null!=this.bufferUniformSize)return this.previousShardIndex=Math.floor(e/this.bufferUniformSize),this.previousShardIndex;function t(t){return e<t.start?-1:e>=t.end?1:0}if(0===t(this.shards[this.previousShardIndex]))return this.previousShardIndex;const n=function(e,t){let n=0,r=e.length;for(;n<=r;){const a=Math.floor((r-n)/2)+n,i=t(e[a]);if(0===i)return a;i<0?r=a:n=a+1}return-1}(this.shards,t);return-1===n?-1:(this.previousShardIndex=n,this.previousShardIndex)}}function jE(){return kE}function BE(){return kE.memory()}function zE(e,t){return kE.tidy(e,t)}function UE(e){gE(e).forEach(e=>e.dispose())}function WE(e){return kE.keep(e)}function VE(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return kE.registerBackend(e,t,n)}function HE(){return kE.backend}!function(e){eE=e}(function(e){Yw().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(e+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")});async function GE(e,t){const n=[],r=[],a=Array.isArray(e)?e.map(e=>e.name):Object.keys(e);for(let i=0;i<a.length;++i){const o=a[i],s=Array.isArray(e)?e[i].tensor:e[o];if("float32"!==s.dtype&&"int32"!==s.dtype&&"bool"!==s.dtype&&"string"!==s.dtype&&"complex64"!==s.dtype)throw new Error("Unsupported dtype in weight '".concat(o,"': ").concat(s.dtype));const c={name:o,shape:s.shape,dtype:s.dtype};if("string"===s.dtype){const e=new Promise(async e=>{const t=await s.bytes(),n=t.reduce((e,t)=>e+t.length,0)+4*t.length,r=new Uint8Array(n);let a=0;for(let i=0;i<t.length;i++){const e=t[i],n=new Uint8Array(new Uint32Array([e.length]).buffer);r.set(n,a),a+=4,r.set(e,a),a+=e.length}e(r)});r.push(e)}else r.push(s.data());null!=t&&(c.group=t),n.push(c)}return{data:qE(await Promise.all(r)),specs:n}}function qE(e){if(null===e)throw new Error("Invalid input value: ".concat(JSON.stringify(e)));let t=0;const n=[];e.forEach(e=>{if(t+=e.byteLength,n.push(e.byteLength===e.buffer.byteLength?e:new e.constructor(e)),!(e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: ".concat(e.constructor.name))});const r=new Uint8Array(t);let a=0;return n.forEach(e=>{r.set(new Uint8Array(e.buffer),a),a+=e.byteLength}),r.buffer}const KE="undefined"!==typeof Buffer&&("undefined"===typeof Blob||"undefined"===typeof atob||"undefined"===typeof btoa);function XE(e){return KE?Buffer.byteLength(e,"utf8"):new Blob([e]).size}function YE(e,t){const n={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:t};return null!=e.signature&&(n.signature=e.signature),null!=e.userDefinedMetadata&&(n.userDefinedMetadata=e.userDefinedMetadata),null!=e.modelInitializer&&(n.modelInitializer=e.modelInitializer),null!=e.initializerSignature&&(n.initializerSignature=e.initializerSignature),null!=e.trainingConfig&&(n.trainingConfig=e.trainingConfig),n}async function $E(e,t){let n,r;return null!=e.weightsManifest&&([n,r]=await t(e.weightsManifest)),function(e,t,n){const r={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy};if(null!=e.trainingConfig&&(r.trainingConfig=e.trainingConfig),null!=e.weightsManifest){if(!t)throw new Error("modelJSON has weightsManifest but weightSpecs is null");if(!n)throw new Error("modelJSON has weightsManifest but weightData is null");r.weightSpecs=t,r.weightData=n}return null!=e.signature&&(r.signature=e.signature),null!=e.userDefinedMetadata&&(r.userDefinedMetadata=e.userDefinedMetadata),null!=e.modelInitializer&&(r.modelInitializer=e.modelInitializer),null!=e.initializerSignature&&(r.initializerSignature=e.initializerSignature),r}(e,n,r)}function JE(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==e.modelTopology?0:XE(JSON.stringify(e.modelTopology)),weightSpecsBytes:null==e.weightSpecs?0:XE(JSON.stringify(e.weightSpecs)),weightDataBytes:null==e.weightData?0:new ME(e.weightData).byteLength}}function QE(e){const t=[];for(const n of e)t.push(...n.weights);return t}class ZE{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return null==ZE.instance&&(ZE.instance=new ZE),ZE.instance}static registerSaveRouter(e){ZE.getInstance().saveRouters.push(e)}static registerLoadRouter(e){ZE.getInstance().loadRouters.push(e)}static getSaveHandlers(e){return ZE.getHandlers(e,"save")}static getLoadHandlers(e,t){return ZE.getHandlers(e,"load",t)}static getHandlers(e,t,n){const r=[];return("load"===t?ZE.getInstance().loadRouters:ZE.getInstance().saveRouters).forEach(t=>{const a=t(e,n);null!==a&&r.push(a)}),r}}const eI="tensorflowjs",tI="models_store",nI="model_info_store";function rI(){if(!Yw().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");const e="undefined"===typeof window?self:window,t=e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB||e.shimIndexedDB;if(null==t)throw new Error("The current browser does not appear to support IndexedDB.");return t}function aI(e){const t=e.result;t.createObjectStore(tI,{keyPath:"modelPath"}),t.createObjectStore(nI,{keyPath:"modelPath"})}class iI{constructor(e){if(this.indexedDB=rI(),null==e||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,e)}async load(){return this.databaseAction(this.modelPath)}databaseAction(e,t){return new Promise((e,n)=>{const r=this.indexedDB.open(eI,1);r.onupgradeneeded=()=>aI(r),r.onsuccess=()=>{const a=r.result;if(null==t){const t=a.transaction(tI,"readonly"),r=t.objectStore(tI).get(this.modelPath);r.onsuccess=()=>{if(null==r.result)return a.close(),n(new Error("Cannot find model with path '".concat(this.modelPath,"' ")+"in IndexedDB."));e(r.result.modelArtifacts)},r.onerror=e=>(a.close(),n(r.error)),t.oncomplete=()=>a.close()}else{t.weightData=ME.join(t.weightData);const r=JE(t),o=a.transaction(nI,"readwrite");let s,c,l=o.objectStore(nI);try{s=l.put({modelPath:this.modelPath,modelArtifactsInfo:r})}catch(i){return n(i)}s.onsuccess=()=>{c=a.transaction(tI,"readwrite");const s=c.objectStore(tI);let u;try{u=s.put({modelPath:this.modelPath,modelArtifacts:t,modelArtifactsInfo:r})}catch(i){return n(i)}u.onsuccess=()=>e({modelArtifactsInfo:r}),u.onerror=e=>{l=o.objectStore(nI);const t=l.delete(this.modelPath);t.onsuccess=()=>(a.close(),n(u.error)),t.onerror=e=>(a.close(),n(u.error))}},s.onerror=e=>(a.close(),n(s.error)),o.oncomplete=()=>{null==c?a.close():c.oncomplete=()=>a.close()}}},r.onerror=e=>n(r.error)})}}iI.URL_SCHEME="indexeddb://";const oI=e=>{return Yw().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(iI.URL_SCHEME)?(t=e.slice(iI.URL_SCHEME.length),new iI(t)):null;var t};ZE.registerSaveRouter(oI),ZE.registerLoadRouter(oI);class sI{constructor(){this.indexedDB=rI()}async listModels(){return new Promise((e,t)=>{const n=this.indexedDB.open(eI,1);n.onupgradeneeded=()=>aI(n),n.onsuccess=()=>{const r=n.result,a=r.transaction(nI,"readonly"),i=a.objectStore(nI).getAll();i.onsuccess=()=>{const t={};for(const e of i.result)t[e.modelPath]=e.modelArtifactsInfo;e(t)},i.onerror=e=>(r.close(),t(i.error)),a.oncomplete=()=>r.close()},n.onerror=e=>t(n.error)})}async removeModel(e){var t;return e=(t=e).startsWith(iI.URL_SCHEME)?t.slice(iI.URL_SCHEME.length):t,new Promise((t,n)=>{const r=this.indexedDB.open(eI,1);r.onupgradeneeded=()=>aI(r),r.onsuccess=()=>{const a=r.result,i=a.transaction(nI,"readwrite"),o=i.objectStore(nI),s=o.get(e);let c;s.onsuccess=()=>{if(null==s.result)return a.close(),n(new Error("Cannot find model with path '".concat(e,"' ")+"in IndexedDB."));{const r=o.delete(e),i=()=>{c=a.transaction(tI,"readwrite");const r=c.objectStore(tI).delete(e);r.onsuccess=()=>t(s.result.modelArtifactsInfo),r.onerror=e=>n(s.error)};r.onsuccess=i,r.onerror=e=>(i(),a.close(),n(s.error))}},s.onerror=e=>(a.close(),n(s.error)),i.oncomplete=()=>{null==c?a.close():c.oncomplete=()=>a.close()}},r.onerror=e=>n(r.error)})}}const cI="/",lI="tensorflowjs_models",uI="info",hI="model_topology",dI="weight_specs",fI="weight_data",pI="model_metadata";function mI(e){return{info:[lI,e,uI].join(cI),topology:[lI,e,hI].join(cI),weightSpecs:[lI,e,dI].join(cI),weightData:[lI,e,fI].join(cI),modelMetadata:[lI,e,pI].join(cI)}}function gI(e){for(const t of Object.values(e))window.localStorage.removeItem(t)}function vI(e){const t=e.split(cI);if(t.length<3)throw new Error("Invalid key format: ".concat(e));return t.slice(1,t.length-1).join(cI)}class bI{constructor(e){if(!Yw().getBool("IS_BROWSER")||"undefined"===typeof window||"undefined"===typeof window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==e||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=mI(this.modelPath)}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{const n=JSON.stringify(e.modelTopology),r=JSON.stringify(e.weightSpecs),a=JE(e),i=ME.join(e.weightData);try{this.LS.setItem(this.keys.info,JSON.stringify(a)),this.LS.setItem(this.keys.topology,n),this.LS.setItem(this.keys.weightSpecs,r),this.LS.setItem(this.keys.weightData,function(e){if(KE)return Buffer.from(e).toString("base64");const t=new Uint8Array(e);let n="";for(let r=0,a=t.length;r<a;r++)n+=String.fromCharCode(t[r]);return btoa(n)}(i));const t={format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,signature:null!=e.signature?e.signature:void 0,userDefinedMetadata:null!=e.userDefinedMetadata?e.userDefinedMetadata:void 0,modelInitializer:null!=e.modelInitializer?e.modelInitializer:void 0,initializerSignature:null!=e.initializerSignature?e.initializerSignature:void 0,trainingConfig:null!=e.trainingConfig?e.trainingConfig:void 0};return this.LS.setItem(this.keys.modelMetadata,JSON.stringify(t)),{modelArtifactsInfo:a}}catch(t){throw gI(this.keys),new Error("Failed to save model '".concat(this.modelPath,"' to local storage: ")+"size quota being exceeded is a possible cause of this failure: "+"modelTopologyBytes=".concat(a.modelTopologyBytes,", ")+"weightSpecsBytes=".concat(a.weightSpecsBytes,", ")+"weightDataBytes=".concat(a.weightDataBytes,"."))}}}async load(){const e=JSON.parse(this.LS.getItem(this.keys.info));if(null==e)throw new Error("In local storage, there is no model with name '".concat(this.modelPath,"'"));if("JSON"!==e.modelTopologyType)throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");const t={},n=JSON.parse(this.LS.getItem(this.keys.topology));if(null==n)throw new Error("In local storage, the topology of model '".concat(this.modelPath,"' ")+"is missing.");t.modelTopology=n;const r=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(null==r)throw new Error("In local storage, the weight specs of model '".concat(this.modelPath,"' ")+"are missing.");t.weightSpecs=r;const a=this.LS.getItem(this.keys.modelMetadata);if(null!=a){const e=JSON.parse(a);t.format=e.format,t.generatedBy=e.generatedBy,t.convertedBy=e.convertedBy,null!=e.signature&&(t.signature=e.signature),null!=e.userDefinedMetadata&&(t.userDefinedMetadata=e.userDefinedMetadata),null!=e.modelInitializer&&(t.modelInitializer=e.modelInitializer),null!=e.initializerSignature&&(t.initializerSignature=e.initializerSignature),null!=e.trainingConfig&&(t.trainingConfig=e.trainingConfig)}const i=this.LS.getItem(this.keys.weightData);if(null==i)throw new Error("In local storage, the binary weight values of model "+"'".concat(this.modelPath,"' are missing."));return t.weightData=function(e){if(KE){const t=Buffer.from(e,"base64");return t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)}const t=atob(e),n=new Uint8Array(t.length);for(let r=0;r<t.length;++r)n.set([t.charCodeAt(r)],r);return n.buffer}(i),t}}bI.URL_SCHEME="localstorage://";const yI=e=>{return Yw().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(bI.URL_SCHEME)?(t=e.slice(bI.URL_SCHEME.length),new bI(t)):null;var t};ZE.registerSaveRouter(yI),ZE.registerLoadRouter(yI);class xI{constructor(){mw(Yw().getBool("IS_BROWSER"),()=>"Current environment is not a web browser"),mw("undefined"===typeof window||"undefined"!==typeof window.localStorage,()=>"Current browser does not appear to support localStorage"),this.LS=window.localStorage}async listModels(){const e={},t=lI+cI,n=cI+uI;for(let r=0;r<this.LS.length;++r){const a=this.LS.key(r);if(a.startsWith(t)&&a.endsWith(n)){e[vI(a)]=JSON.parse(this.LS.getItem(a))}}return e}async removeModel(e){var t;const n=mI(e=(t=e).startsWith(bI.URL_SCHEME)?t.slice(bI.URL_SCHEME.length):t);if(null==this.LS.getItem(n.info))throw new Error("Cannot find model at path '".concat(e,"'"));const r=JSON.parse(this.LS.getItem(n.info));return gI(n),r}}const wI="://";class kI{constructor(){this.managers={}}static getInstance(){return null==kI.instance&&(kI.instance=new kI),kI.instance}static registerManager(e,t){mw(null!=e,()=>"scheme must not be undefined or null."),e.endsWith(wI)&&(e=e.slice(0,e.indexOf(wI))),mw(e.length>0,()=>"scheme must not be an empty string.");const n=kI.getInstance();mw(null==n.managers[e],()=>"A model store manager is already registered for scheme '".concat(e,"'.")),n.managers[e]=t}static getManager(e){const t=kI.getInstance().managers[e];if(null==t)throw new Error("Cannot find model manager for scheme '".concat(e,"'"));return t}static getSchemes(){return Object.keys(kI.getInstance().managers)}}class SI{constructor(){this.messageName="setTimeoutCustom",this.functionRefs=[],this.handledMessageCount=0,this.hasEventListener=!1}fetch(e,t){return fetch(e,t)}now(){return performance.now()}encode(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Browser's encoder only supports utf-8, but got ".concat(t));return null==this.textEncoder&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)}decode(e,t){return new TextDecoder(t).decode(e)}setTimeoutCustom(e,t){"undefined"!==typeof window&&Yw().getBool("USE_SETTIMEOUTCUSTOM")?(this.functionRefs.push(e),setTimeout(()=>{window.postMessage({name:this.messageName,index:this.functionRefs.length-1},"*")},t),this.hasEventListener||(this.hasEventListener=!0,window.addEventListener("message",e=>{if(e.source===window&&e.data.name===this.messageName){e.stopPropagation();(0,this.functionRefs[e.data.index])(),this.handledMessageCount++,this.handledMessageCount===this.functionRefs.length&&(this.functionRefs=[],this.handledMessageCount=0)}},!0))):setTimeout(e,t)}isTypedArray(e){return wC(e)}}if(Yw().get("IS_BROWSER")){Yw().setPlatform("browser",new SI);try{kI.registerManager(bI.URL_SCHEME,new xI)}catch(Cie){}try{kI.registerManager(iI.URL_SCHEME,new sI)}catch(Cie){}}const NI=()=>n(5817);let CI;class EI{constructor(){this.util=n(8590),this.textEncoder=new this.util.TextEncoder}fetch(e,t){return null!=Yw().global.fetch?Yw().global.fetch(e,t):(null==CI&&(CI=NI()),CI(e,t))}now(){const e=process.hrtime();return 1e3*e[0]+e[1]/1e6}encode(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Node built-in encoder only supports utf-8, but got ".concat(t));return this.textEncoder.encode(e)}decode(e,t){return 0===e.length?"":new this.util.TextDecoder(t).decode(e)}isTypedArray(e){return this.util.types.isFloat32Array(e)||this.util.types.isInt32Array(e)||this.util.types.isUint8Array(e)||this.util.types.isUint8ClampedArray(e)}}function II(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32",n=arguments.length>2?arguments[2]:void 0;return t=t||"float32",Ww(e),new JC(e,t,n)}Yw().get("IS_NODE")&&!Yw().get("IS_BROWSER")&&Yw().setPlatform("node",new EI);const TI=DE({cast_:function(e,t){const n=RE(e,"x","cast");if(!function(e){return"bool"===e||"complex64"===e||"float32"===e||"int32"===e||"string"===e}(t))throw new Error("Failed to cast to unknown dtype ".concat(t));if("string"===t&&"string"!==n.dtype||"string"!==t&&"string"===n.dtype)throw new Error("Only strings can be casted to strings");const r={x:n},a={dtype:t};return kE.runKernel(Sk,r,a)}});const _I=DE({clone_:function(e){const t={x:RE(e,"x","clone","string_or_numeric")};return kE.runKernel(mS,t)}});wE();const AI={buffer:II,cast:TI,clone:_I,print:function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];console.log(e.toString(t))}};ZC=AI;const RI=DE({add_:function(e,t){let n=RE(e,"a","add"),r=RE(t,"b","add");[n,r]=pE(n,r);const a={a:n,b:r};return kE.runKernel(rk,a)}});const FI=DE({floorDiv_:function(e,t){let n=RE(e,"a","floorDiv"),r=RE(t,"b","floorDiv");[n,r]=pE(n,r);const a={a:n,b:r};return kE.runKernel(lS,a)}});const DI=DE({div_:function(e,t){let n=RE(e,"a","div"),r=RE(t,"b","div");if([n,r]=pE(n,r),"int32"===n.dtype&&"int32"===r.dtype)return FI(n,r);const a={a:n,b:r};return kE.runKernel($k,a,{})}});const OI=DE({mul_:function(e,t){let n=RE(e,"a","mul"),r=RE(t,"b","mul");[n,r]=pE(n,r);const a={a:n,b:r};return kE.runKernel(GS,a)}});const LI=DE({sqrt_:function(e){const t={x:RE(e,"x","sqrt","float32")};return kE.runKernel(RN,t)}});const PI=DE({square_:function(e){const t=RE(e,"x","square");return kE.runKernel("Square",{x:t},{})}});const MI=DE({zerosLike_:function(e){const t={x:RE(e,"x","zerosLike")};return kE.runKernel(aC,t)}});function jI(e){return kE.customGrad(e)}function BI(e,t){if((UC(e)&&"string"!==t||Array.isArray(e))&&"complex64"!==t)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if("string"===t&&UC(e)&&!(e instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return LE(e,[],[],t)}const zI=new Map,UI=new Map;class WI{getClassName(){return this.constructor.className}static fromConfig(e,t){return new e(t)}}class VI{constructor(){this.classNameMap={}}static getMap(){return null==VI.instance&&(VI.instance=new VI),VI.instance}static register(e){VI.getMap().classNameMap[e.className]=[e,e.fromConfig]}}function HI(e,t,n){mw(null!=e.className,()=>"Class being registered does not have the static className property defined."),mw("string"===typeof e.className,()=>"className is required to be a string, but got type "+typeof e.className),mw(e.className.length>0,()=>"Class being registered has an empty-string as its className, which is disallowed."),"undefined"===typeof t&&(t="Custom"),"undefined"===typeof n&&(n=e.className);const r=t+">"+n;return VI.register(e),zI.set(r,e),UI.set(e,r),e}class GI extends WI{minimize(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2?arguments[2]:void 0;const{value:r,grads:a}=this.computeGradients(e,n);if(null!=n){const e=n.map(e=>({name:e.name,tensor:a[e.name]}));this.applyGradients(e)}else this.applyGradients(a);return UE(a),t?r:(r.dispose(),null)}get iterations(){return null==this.iterations_&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(e,t){return function(e,t){mw(Ow(e),()=>"The f passed in variableGrads(f) must be a function"),mw(null==t||Array.isArray(t)&&t.every(e=>e instanceof rE),()=>"The varList passed in variableGrads(f, varList) must be an array of variables");const n=null!=t;if(!n){t=[];for(const e in kE.registeredVariables)t.push(kE.registeredVariables[e])}const r=n?t.filter(e=>!e.trainable):null,a=t.length;t=t.filter(e=>e.trainable),mw(t.length>0,()=>"variableGrads() expects at least one of the input variables to "+"be trainable, but none of the ".concat(a," variables is ")+"trainable.");const{value:i,grads:o}=kE.gradients(e,t,null,!0);mw(o.some(e=>null!=e),()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."),mw(0===i.rank,()=>"The f passed in variableGrads(f) must return a scalar, but it "+"returned a rank-".concat(i.rank," tensor"));const s={};return t.forEach((e,t)=>{null!=o[t]&&(s[e.name]=o[t])}),null!=r&&r.forEach(e=>s[e.name]=null),{value:i,grads:s}}(e,t)}dispose(){null!=this.iterations_&&UE(this.iterations_)}async saveIterations(){return null==this.iterations_&&(this.iterations_=0),{name:"iter",tensor:BI(this.iterations_,"int32")}}async getWeights(){throw new Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(e){throw new Error("setWeights() is not implemented for this optimizer class "+"".concat(this.getClassName()))}async extractIterations(e){return this.iterations_=(await e[0].tensor.data())[0],e.slice(1)}}Object.defineProperty(GI,Symbol.hasInstance,{value:e=>null!=e.minimize&&null!=e.computeGradients&&null!=e.applyGradients});class qI extends GI{static get className(){return"Adadelta"}constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;super(),this.learningRate=e,this.rho=t,this.epsilon=n,this.accumulatedGrads=[],this.accumulatedUpdates=[],null==n&&(this.epsilon=kE.backend.epsilon())}applyGradients(e){(Array.isArray(e)?e.map(e=>e.name):Object.keys(e)).forEach((t,n)=>{const r=kE.registeredVariables[t],a=!1;null==this.accumulatedGrads[n]&&(this.accumulatedGrads[n]={originalName:"".concat(t,"/accum_grad"),variable:zE(()=>MI(r).variable(a))}),null==this.accumulatedUpdates[n]&&(this.accumulatedUpdates[n]={originalName:"".concat(t,"/accum_var"),variable:zE(()=>MI(r).variable(a))});const i=Array.isArray(e)?e[n].tensor:e[t];if(null==i)return;const o=this.accumulatedGrads[n].variable,s=this.accumulatedUpdates[n].variable;zE(()=>{const e=RI(OI(o,this.rho),OI(PI(i),1-this.rho)),t=OI(DI(LI(RI(s,this.epsilon)),LI(RI(o,this.epsilon))),i),n=RI(OI(s,this.rho),OI(PI(t),1-this.rho));o.assign(e),s.assign(n);const a=RI(OI(t,-this.learningRate),r);r.assign(a)})}),this.incrementIterations()}dispose(){null!=this.accumulatedUpdates&&(UE(this.accumulatedGrads.map(e=>e.variable)),UE(this.accumulatedUpdates.map(e=>e.variable)))}async getWeights(){const e=[...this.accumulatedGrads,...this.accumulatedUpdates];return[await this.saveIterations()].concat(e.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){const t=(e=await this.extractIterations(e)).length/2,n=!1;this.accumulatedGrads=e.slice(0,t).map(e=>({originalName:e.name,variable:e.tensor.variable(n)})),this.accumulatedUpdates=e.slice(t,2*t).map(e=>({originalName:e.name,variable:e.tensor.variable(n)}))}getConfig(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}static fromConfig(e,t){return new e(t.learningRate,t.rho,t.epsilon)}}function KI(e,t,n){Ww(e);const r={shape:e,value:t,dtype:n=n||Dw(t)};return kE.runKernel(oS,{},r)}class XI extends GI{static get className(){return"Adagrad"}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.1;super(),this.learningRate=e,this.initialAccumulatorValue=t,this.accumulatedGrads=[]}applyGradients(e){(Array.isArray(e)?e.map(e=>e.name):Object.keys(e)).forEach((t,n)=>{const r=kE.registeredVariables[t];if(null==this.accumulatedGrads[n]){const e=!1;this.accumulatedGrads[n]={originalName:"".concat(t,"/accumulator"),variable:zE(()=>KI(r.shape,this.initialAccumulatorValue).variable(e))}}const a=Array.isArray(e)?e[n].tensor:e[t];if(null==a)return;const i=this.accumulatedGrads[n].variable;zE(()=>{const e=RI(i,PI(a));i.assign(e);const t=RI(OI(DI(a,LI(RI(e,kE.backend.epsilon()))),-this.learningRate),r);r.assign(t)})}),this.incrementIterations()}dispose(){null!=this.accumulatedGrads&&UE(this.accumulatedGrads.map(e=>e.variable))}async getWeights(){return[await this.saveIterations()].concat(this.accumulatedGrads.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);this.accumulatedGrads=e.map(e=>({originalName:e.name,variable:e.tensor.variable(false)}))}getConfig(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}static fromConfig(e,t){return new e(t.learningRate,t.initialAccumulatorValue)}}const YI=DE({pow_:function(e,t){let n=RE(e,"base","pow"),r=RE(t,"exp","pow");[n,r]=pE(n,r);const a={a:n,b:r};return kE.runKernel(tN,a)}});const $I=DE({sub_:function(e,t){let n=RE(e,"a","sub"),r=RE(t,"b","sub");[n,r]=pE(n,r);const a={a:n,b:r};return kE.runKernel(XN,a)}});class JI extends GI{static get className(){return"Adam"}constructor(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;super(),this.learningRate=e,this.beta1=t,this.beta2=n,this.epsilon=r,this.accumulatedFirstMoment=[],this.accumulatedSecondMoment=[],zE(()=>{this.accBeta1=BI(t).variable(),this.accBeta2=BI(n).variable()}),null==r&&(this.epsilon=kE.backend.epsilon())}applyGradients(e){const t=Array.isArray(e)?e.map(e=>e.name):Object.keys(e);zE(()=>{const n=$I(1,this.accBeta1),r=$I(1,this.accBeta2);t.forEach((t,a)=>{const i=kE.registeredVariables[t],o=!1;null==this.accumulatedFirstMoment[a]&&(this.accumulatedFirstMoment[a]={originalName:"".concat(t,"/m"),variable:zE(()=>MI(i).variable(o))}),null==this.accumulatedSecondMoment[a]&&(this.accumulatedSecondMoment[a]={originalName:"".concat(t,"/v"),variable:zE(()=>MI(i).variable(o))});const s=Array.isArray(e)?e[a].tensor:e[t];if(null==s)return;const c=this.accumulatedFirstMoment[a].variable,l=this.accumulatedSecondMoment[a].variable,u=RI(OI(c,this.beta1),OI(s,1-this.beta1)),h=RI(OI(l,this.beta2),OI(PI(s),1-this.beta2)),d=DI(u,n),f=DI(h,r);c.assign(u),l.assign(h);const p=RI(OI(DI(d,RI(LI(f),this.epsilon)),-this.learningRate),i);i.assign(p)}),this.accBeta1.assign(OI(this.accBeta1,this.beta1)),this.accBeta2.assign(OI(this.accBeta2,this.beta2))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.accBeta2.dispose(),null!=this.accumulatedFirstMoment&&UE(this.accumulatedFirstMoment.map(e=>e.variable)),null!=this.accumulatedSecondMoment&&UE(this.accumulatedSecondMoment.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedFirstMoment,...this.accumulatedSecondMoment];return[await this.saveIterations()].concat(e.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e),zE(()=>{this.accBeta1.assign(YI(this.beta1,this.iterations_+1)),this.accBeta2.assign(YI(this.beta2,this.iterations_+1))});const t=e.length/2,n=!1;this.accumulatedFirstMoment=e.slice(0,t).map(e=>({originalName:e.name,variable:e.tensor.variable(n)})),this.accumulatedSecondMoment=e.slice(t,2*t).map(e=>({originalName:e.name,variable:e.tensor.variable(n)}))}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}static fromConfig(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon)}}const QI=DE({abs_:function(e){const t=RE(e,"x","abs");if("complex64"===t.dtype){const e={x:t};return kE.runKernel(Ik,e)}{const e={x:t};return kE.runKernel(ek,e)}}});function ZI(e,t){const n=e.length,r=[];for(let a=0;a<n;a++){const i=n-1-a,o=e[i]||1;(t[t.length-1-a]||1)>1&&1===o&&r.unshift(i)}return r}function eT(e,t){const n=[];for(let r=0;r<t.length;r++){const a=e[e.length-r-1],i=t.length-r-1,o=t[i];(null==a||1===a&&o>1)&&n.unshift(i)}return n}function tT(e,t){const n=Math.max(e.length,t.length),r=new Array(n);for(let a=0;a<n;a++){let i=e[e.length-a-1];null==i&&(i=1);let o=t[t.length-a-1];if(null==o&&(o=1),1===i)r[n-a-1]=o;else if(1===o)r[n-a-1]=i;else{if(i!==o){const n="Operands could not be broadcast together with shapes "+"".concat(e," and ").concat(t,".");throw Error(n)}r[n-a-1]=i}}return r}const nT=DE({maximum_:function(e,t){let n=RE(e,"a","maximum"),r=RE(t,"b","maximum");[n,r]=pE(n,r),"bool"===n.dtype&&(n=TI(n,"int32"),r=TI(r,"int32")),tT(n.shape,r.shape);const a={a:n,b:r};return kE.runKernel(DS,a)}});class rT extends GI{static get className(){return"Adamax"}constructor(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;super(),this.learningRate=e,this.beta1=t,this.beta2=n,this.epsilon=r,this.decay=a,this.accumulatedFirstMoment=[],this.accumulatedWeightedInfNorm=[],zE(()=>{this.iteration=BI(0).variable(),this.accBeta1=BI(t).variable()}),null==r&&(this.epsilon=kE.backend.epsilon())}applyGradients(e){const t=Array.isArray(e)?e.map(e=>e.name):Object.keys(e);zE(()=>{const n=$I(1,this.accBeta1),r=DI(-this.learningRate,RI(OI(this.iteration,this.decay),1));t.forEach((t,a)=>{const i=kE.registeredVariables[t],o=!1;null==this.accumulatedFirstMoment[a]&&(this.accumulatedFirstMoment[a]={originalName:"".concat(t,"/m"),variable:MI(i).variable(o)}),null==this.accumulatedWeightedInfNorm[a]&&(this.accumulatedWeightedInfNorm[a]={originalName:"".concat(t,"/v"),variable:MI(i).variable(o)});const s=Array.isArray(e)?e[a].tensor:e[t];if(null==s)return;const c=this.accumulatedFirstMoment[a].variable,l=this.accumulatedWeightedInfNorm[a].variable,u=RI(OI(c,this.beta1),OI(s,1-this.beta1)),h=OI(l,this.beta2),d=QI(s),f=nT(h,d);c.assign(u),l.assign(f);const p=RI(OI(DI(r,n),DI(u,RI(f,this.epsilon))),i);i.assign(p)}),this.iteration.assign(RI(this.iteration,1)),this.accBeta1.assign(OI(this.accBeta1,this.beta1))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.iteration.dispose(),null!=this.accumulatedFirstMoment&&UE(this.accumulatedFirstMoment.map(e=>e.variable)),null!=this.accumulatedWeightedInfNorm&&UE(this.accumulatedWeightedInfNorm.map(e=>e.variable))}async getWeights(){throw new Error("getWeights() is not implemented for Adamax yet.")}async setWeights(e){throw new Error("setWeights() is not implemented for Adamax yet.")}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}static fromConfig(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon,t.decay)}}class aT extends GI{static get className(){return"SGD"}constructor(e){super(),this.learningRate=e,this.setLearningRate(e)}applyGradients(e){const t=Array.isArray(e)?e.map(e=>e.name):Object.keys(e);t.forEach((t,n)=>{const r=Array.isArray(e)?e[n].tensor:e[t];if(null==r)return;const a=kE.registeredVariables[t];zE(()=>{const e=RI(OI(this.c,r),a);a.assign(e)})}),this.incrementIterations()}setLearningRate(e){this.learningRate=e,null!=this.c&&this.c.dispose(),this.c=WE(BI(-e))}dispose(){this.c.dispose()}async getWeights(){return[await this.saveIterations()]}async setWeights(e){if(0!==(e=await this.extractIterations(e)).length)throw new Error("SGD optimizer does not have settable weights.")}getConfig(){return{learningRate:this.learningRate}}static fromConfig(e,t){return new e(t.learningRate)}}class iT extends aT{static get className(){return"Momentum"}constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];super(e),this.learningRate=e,this.momentum=t,this.useNesterov=n,this.accumulations=[],this.m=BI(this.momentum)}applyGradients(e){(Array.isArray(e)?e.map(e=>e.name):Object.keys(e)).forEach((t,n)=>{const r=kE.registeredVariables[t];if(null==this.accumulations[n]){const e=!1;this.accumulations[n]={originalName:"".concat(t,"/momentum"),variable:zE(()=>MI(r).variable(e))}}const a=this.accumulations[n].variable,i=Array.isArray(e)?e[n].tensor:e[t];null!=i&&zE(()=>{let e;const t=RI(OI(this.m,a),i);e=this.useNesterov?RI(OI(this.c,RI(i,OI(t,this.m))),r):RI(OI(this.c,t),r),a.assign(t),r.assign(e)})}),this.incrementIterations()}dispose(){this.m.dispose(),null!=this.accumulations&&UE(this.accumulations.map(e=>e.variable))}setMomentum(e){this.momentum=e}async getWeights(){return[await this.saveIterations()].concat(this.accumulations.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);this.accumulations=e.map(e=>({originalName:e.name,variable:e.tensor.variable(false)}))}getConfig(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}static fromConfig(e,t){return new e(t.learningRate,t.momentum,t.useNesterov)}}class oT extends GI{static get className(){return"RMSProp"}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.9,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(),this.learningRate=e,this.decay=t,this.momentum=n,this.epsilon=r,this.accumulatedMeanSquares=[],this.accumulatedMoments=[],this.accumulatedMeanGrads=[],this.centered=a,null==r&&(this.epsilon=kE.backend.epsilon()),null==e)throw new Error("learningRate for RMSPropOptimizer must be defined.")}applyGradients(e){(Array.isArray(e)?e.map(e=>e.name):Object.keys(e)).forEach((t,n)=>{const r=kE.registeredVariables[t],a=!1;null==this.accumulatedMeanSquares[n]&&(this.accumulatedMeanSquares[n]={originalName:"".concat(t,"/rms"),variable:zE(()=>MI(r).variable(a))}),null==this.accumulatedMoments[n]&&(this.accumulatedMoments[n]={originalName:"".concat(t,"/momentum"),variable:zE(()=>MI(r).variable(a))}),null==this.accumulatedMeanGrads[n]&&this.centered&&(this.accumulatedMeanGrads[n]={originalName:"".concat(t,"/mg"),variable:zE(()=>MI(r).variable(a))});const i=Array.isArray(e)?e[n].tensor:e[t];if(null==i)return;const o=this.accumulatedMeanSquares[n].variable,s=this.accumulatedMoments[n].variable;zE(()=>{const e=RI(OI(o,this.decay),OI(PI(i),1-this.decay));if(this.centered){const t=this.accumulatedMeanGrads[n].variable,a=RI(OI(t,this.decay),OI(i,1-this.decay)),c=DI(OI(i,this.learningRate),LI($I(e,RI(PI(a),this.epsilon)))),l=RI(OI(s,this.momentum),c);o.assign(e),t.assign(a),s.assign(l);const u=$I(r,l);r.assign(u)}else{const e=RI(OI(o,this.decay),OI(PI(i),1-this.decay)),t=RI(OI(s,this.momentum),DI(OI(i,this.learningRate),LI(RI(e,this.epsilon))));o.assign(e),s.assign(t);const n=$I(r,t);r.assign(n)}})}),this.incrementIterations()}dispose(){null!=this.accumulatedMeanSquares&&UE(this.accumulatedMeanSquares.map(e=>e.variable)),null!=this.accumulatedMeanGrads&&this.centered&&UE(this.accumulatedMeanGrads.map(e=>e.variable)),null!=this.accumulatedMoments&&UE(this.accumulatedMoments.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedMeanSquares,...this.accumulatedMoments];return this.centered&&e.push(...this.accumulatedMeanGrads),[await this.saveIterations()].concat(e.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=this.centered?e.length/3:e.length/2,n=!1;this.accumulatedMeanSquares=e.slice(0,t).map(e=>({originalName:e.name,variable:e.tensor.variable(n)})),this.accumulatedMoments=e.slice(t,2*t).map(e=>({originalName:e.name,variable:e.tensor.variable(n)})),this.centered&&(this.accumulatedMeanGrads=e.slice(2*t,3*t).map(e=>({originalName:e.name,variable:e.tensor.variable(n)})))}getConfig(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}static fromConfig(e,t){return new e(t.learningRate,t.decay,t.momentum,t.epsilon,t.centered)}}const sT=[qI,XI,JI,rT,iT,oT,aT];function cT(e){return new Promise(e=>setTimeout(e)).then(e)}class lT{constructor(e){if(!Yw().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(lT.URL_SCHEME)&&(e=e.slice(lT.URL_SCHEME.length)),null!=e&&0!==e.length||(e="model"),this.modelJsonFileName=e+".json",this.weightDataFileName=e+".weights.bin"}async save(e){if("undefined"===typeof document)throw new Error("Browser downloads are not supported in this environment since `document` is not present");const t=ME.join(e.weightData),n=window.URL.createObjectURL(new Blob([t],{type:"application/octet-stream"}));if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");{const t=YE(e,[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}]),r=window.URL.createObjectURL(new Blob([JSON.stringify(t)],{type:"application/json"})),a=null==this.modelJsonAnchor?document.createElement("a"):this.modelJsonAnchor;if(a.download=this.modelJsonFileName,a.href=r,await cT(()=>a.dispatchEvent(new MouseEvent("click"))),null!=e.weightData){const e=null==this.weightDataAnchor?document.createElement("a"):this.weightDataAnchor;e.download=this.weightDataFileName,e.href=n,await cT(()=>e.dispatchEvent(new MouseEvent("click")))}return{modelArtifactsInfo:JE(e)}}}}lT.URL_SCHEME="downloads://";function uT(e,t,n,r){!function(e){mw(null!=e&&Array.isArray(e)&&e.length>0,()=>"promises must be a none empty array")}(e),function(e,t){mw(e>=0&&e<=1,()=>"Progress fraction must be in range [0, 1], but "+"got startFraction ".concat(e)),mw(t>=0&&t<=1,()=>"Progress fraction must be in range [0, 1], but "+"got endFraction ".concat(t)),mw(t>=e,()=>"startFraction must be no more than endFraction, but "+"got startFraction ".concat(e," and endFraction ")+"".concat(t))}(n=null==n?0:n,r=null==r?1:r);let a=0;return Promise.all(e.map(i=>(i.then(i=>{const o=n+ ++a/e.length*(r-n);return t(o),i}),i)))}async function hT(e,t){null==t&&(t={});const n=null==t.fetchFunc?Yw().platform.fetch:t.fetchFunc,r=e.map(e=>n(e,t.requestInit,{isBinary:!0})),a=(null==t.onProgress?await Promise.all(r):await uT(r,t.onProgress,0,.5)).map(e=>e.arrayBuffer());return null==t.onProgress?await Promise.all(a):await uT(a,t.onProgress,.5,1)}ZE.registerSaveRouter(e=>Yw().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(lT.URL_SCHEME)?function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"model";return new lT(e)}(e.slice(lT.URL_SCHEME.length)):null);class dT{constructor(e,t){if(this.DEFAULT_METHOD="POST",null==t&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.weightUrlConverter=t.weightUrlConverter,null!=t.fetchFunc?(mw("function"===typeof t.fetchFunc,()=>"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"),this.fetch=t.fetchFunc):this.fetch=Yw().platform.fetch,mw(null!=e&&e.length>0,()=>"URL path for http must not be null, undefined or empty."),Array.isArray(e)&&mw(2===e.length,()=>"URL paths for http must have a length of 2, "+"(actual length is ".concat(e.length,").")),this.path=e,null!=t.requestInit&&null!=t.requestInit.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{},this.loadOptions=t}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");const t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit);t.body=new FormData;const n=YE(e,[{paths:["./model.weights.bin"],weights:e.weightSpecs}]);if(t.body.append("model.json",new Blob([JSON.stringify(n)],{type:"application/json"}),"model.json"),null!=e.weightData){const n=ME.join(e.weightData);t.body.append("model.weights.bin",new Blob([n],{type:"application/octet-stream"}),"model.weights.bin")}const r=await this.fetch(this.path,t);if(r.ok)return{modelArtifactsInfo:JE(e),responses:[r]};throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+"".concat(r.status,"."))}async loadModelJSON(){const e=await this.fetch(this.path,this.requestInit);if(!e.ok)throw new Error("Request to ".concat(this.path," failed with status code ")+"".concat(e.status,". Please verify this URL points to ")+"the model JSON of the model to load.");let t;try{t=await e.json()}catch(_a){let t="Failed to parse model JSON of response from ".concat(this.path,".");throw this.path.endsWith(".pb")?t+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":t+=" Please make sure the server is serving valid JSON for this request.",new Error(t)}const n=t.modelTopology,r=t.weightsManifest;if(null==n&&null==r)throw new Error("The JSON from HTTP path ".concat(this.path," contains neither model ")+"topology or manifest for weights.");return t}async load(){if(this.loadOptions.streamWeights)return this.loadStream();return $E(await this.loadModelJSON(),e=>this.loadWeights(e))}async loadStream(){const e=await this.loadModelJSON(),t=await this.getWeightUrls(e.weightsManifest),n=QE(e.weightsManifest);return Object.assign(Object.assign({},e),{weightSpecs:n,getWeightStream:()=>function(e,t){var n;const r=null==t.fetchFunc?Yw().platform.fetch:t.fetchFunc;let a,i=0;return null===(n=t.onProgress)||void 0===n||n.call(t,0),new ReadableStream({pull:async n=>{for(var o;i<e.length;){if(!a){const n=(await r(e[i],t.requestInit,{isBinary:!0})).body;a=n.getReader()}const{done:s,value:c}=await a.read();if(!s)return void n.enqueue(c);i++,a=void 0,null===(o=t.onProgress)||void 0===o||o.call(t,i/e.length)}n.close()}})}(t,this.loadOptions)})}async getWeightUrls(e){const t=Array.isArray(this.path)?this.path[1]:this.path,[n,r]=function(e){const t=e.lastIndexOf("/"),n=e.lastIndexOf("?"),r=e.substring(0,t),a=n>t?e.substring(n):"";return[r+"/",a]}(t),a=this.weightPathPrefix||n,i=[],o=[];for(const s of e)for(const e of s.paths)null!=this.weightUrlConverter?o.push(this.weightUrlConverter(e)):i.push(a+e+r);return this.weightUrlConverter&&i.push(...await Promise.all(o)),i}async loadWeights(e){const t=await this.getWeightUrls(e);return[QE(e),await hT(t,this.loadOptions)]}}function fT(e){return null!=e.match(dT.URL_SCHEME_REGEX)}dT.URL_SCHEME_REGEX=/^https?:\/\//;const pT=(e,t)=>{if("undefined"===typeof fetch&&(null==t||null==t.fetchFunc))return null;{let n=!0;if(n=Array.isArray(e)?e.every(e=>fT(e)):fT(e),n)return mT(e,t)}return null};function mT(e,t){return new dT(e,t)}ZE.registerSaveRouter(pT),ZE.registerLoadRouter(pT);const gT=-2,vT=-1;function bT(e,t,n){const r=e.shape.length;mw(r===t.length,()=>"Error in slice".concat(r,"D: Length of begin ").concat(t," must ")+"match the rank of the array (".concat(r,").")),mw(r===n.length,()=>"Error in slice".concat(r,"D: Length of size ").concat(n," must ")+"match the rank of the array (".concat(r,")."));for(let a=0;a<r;++a)mw(t[a]+n[a]<=e.shape[a],()=>"Error in slice".concat(r,"D: begin[").concat(a,"] + size[").concat(a,"] ")+"(".concat(t[a]+n[a],") would overflow input.shape[").concat(a,"] (").concat(e.shape[a],")"))}function yT(e){const t=[];let n=0;for(;e>0;)1&e&&t.push(n),e/=2,n++;return t}function xT(e,t,n){const r=[];for(let a=0;a<e.length;a++)r[a]=Math.ceil((t[a]-e[a])/n[a]);return r}function wT(e,t,n,r){const a=[...e];for(let i=a.length;i<r.length;i++)a.push(1);for(let i=0;i<n;i++)0===i?a[t]=1:(a.splice(t,0,1),a.pop());return a}function kT(e,t,n){return n<=e?n:n-(t-1)}function ST(e,t){const n=[];for(let r=0;r<e;r++)n.push(t+r);return n}function NT(e,t,n,r,a,i,o,s,c){const l=e.length;let u=new Array(l),h=new Array(l),d=new Array(l);if(t.length&&n>0){const c=t[0],l=n+1;u=CT(o,c,l,r,e),h=ET(s,c,l,a,e),d=wT(i,c,l,e)}else for(let f=0;f<l;f++)u[f]=TT(o,r,i,e,f,c),h[f]=_T(s,a,i,e,f,c),d[f]=IT(i,f,c);return{begin:u,end:h,strides:d}}function CT(e,t,n,r,a){const i=[...a],o=ST(n,t);for(let s=0;s<i.length;s++)if(o.indexOf(s)>-1)i[s]=0;else{const a=kT(t,n,s);let o=r[a];e&1<<a&&(o=0),i[s]=o}return i}function ET(e,t,n,r,a){const i=[...a],o=ST(n,t);for(let s=0;s<i.length;s++)if(o.indexOf(s)>-1)i[s]=Number.MAX_SAFE_INTEGER;else{const a=kT(t,n,s);let o=r[a];e&1<<a&&(o=Number.MAX_SAFE_INTEGER),i[s]=o}for(let s=0;s<i.length;s++){const e=a[s];i[s]<0&&(i[s]+=e),i[s]=dw(0,i[s],a[s])}return i}function IT(e,t,n){let r=e[t];return(n&1<<t||null==r)&&(r=1),r}function TT(e,t,n,r,a,i){let o=t[a];const s=n[a]||1;(e&1<<a||i&1<<a||null==o)&&(o=s>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);const c=r[a];return o<0&&(o+=c),o=dw(0,o,c-1),o}function _T(e,t,n,r,a,i){let o=t[a];const s=n[a]||1;(e&1<<a||i&1<<a||null==o)&&(o=s>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);const c=r[a];return o<0&&(o+=c),o=s>0?dw(0,o,c):dw(-1,o,c-1),o}function AT(e,t,n){let r=n.length;for(let a=0;a<n.length;a++)if(n[a]>1){r=a;break}for(let a=r+1;a<n.length;a++)if(t[a]>0||n[a]!==e[a])return!1;return!0}function RT(e,t){let n=e.length>0?e[e.length-1]:1;for(let r=0;r<e.length-1;r++)n+=e[r]*t[r];return n}function FT(e,t,n){let r;const a=e.shape.length;let i;return r="number"===typeof t?[t,...new Array(a-1).fill(0)]:t.length<a?t.concat(new Array(a-t.length).fill(0)):t.slice(),r.forEach(e=>{mw(-1!==e,()=>"slice() does not support negative begin indexing.")}),i=null==n?new Array(a).fill(-1):"number"===typeof n?[n,...new Array(a-1).fill(-1)]:n.length<a?n.concat(new Array(a-n.length).fill(-1)):n,i=i.map((t,n)=>t>=0?t:(mw(-1===t,()=>"Negative size values should be exactly -1 but got "+"".concat(t," for the slice() size at index ").concat(n,".")),e.shape[n]-r[n])),[r,i]}function DT(e,t,n,r,a,i,o,s,c){let l;if(null==r?(l=new Array(t.length),l.fill(1)):l=r,null!=o&&0!==(o&o-1))throw new Error("Multiple ellipses in slice is not allowed.");let u=!1;const h={dims:l.length,numAddAxisAfterEllipsis:0,begin:t.slice(),end:n.slice(),strides:l.slice(),beginMask:a,endMask:i,ellipsisMask:o,newAxisMask:s,shrinkAxisMask:c};for(let y=0;y<h.dims;y++)u&&0!==(1<<y&s)&&h.numAddAxisAfterEllipsis++,1<<y&o&&(u=!0);u||(h.ellipsisMask|=1<<h.dims,h.dims++);const d={dims:e.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};!function(e,t){t.beginMask=0,t.endMask=0,t.shrinkAxisMask=0;let n=0;t.beginValid=null!=e.begin,t.endValid=null!=e.end,t.begin=new Array(t.dims),t.end=new Array(t.dims),t.strides=new Array(t.dims),t.finalShapeGatherIndices=[],t.finalShapeGatherIndicesSparse=[],t.inputShapeGatherIndicesSparse=new Array(t.dims);for(let r=0;r<e.dims;r++)if(1<<r&e.ellipsisMask){const a=Math.min(t.dims-(e.dims-r)+1+e.numAddAxisAfterEllipsis,t.dims);for(;n<a;n++)t.begin[n]=0,t.end[n]=0,t.strides[n]=1,t.beginMask|=1<<n,t.endMask|=1<<n,t.finalShapeGatherIndices.push(n),t.finalShapeGatherIndicesSparse.push(-1),t.inputShapeGatherIndicesSparse[n]=r}else if(1<<r&e.newAxisMask)t.finalShapeGatherIndices.push(gT),t.finalShapeGatherIndicesSparse.push(-1);else{if(n===t.begin.length)throw Error("Index out of range using input dim ".concat(n,"; input ")+"has only ".concat(t.dims," dims, ").concat(t.begin.length,"."));null!=e.begin&&(t.begin[n]=e.begin[r]),null!=e.end&&(t.end[n]=e.end[r]),t.strides[n]=e.strides[r],e.beginMask&1<<r&&(t.beginMask|=1<<n),e.endMask&1<<r&&(t.endMask|=1<<n),e.shrinkAxisMask&1<<r?(t.finalShapeGatherIndices.push(vT),t.finalShapeGatherIndicesSparse.push(-1),t.shrinkAxisMask|=1<<n):(t.finalShapeGatherIndices.push(n),t.finalShapeGatherIndicesSparse.push(r)),t.inputShapeGatherIndicesSparse[n]=r,n++}}(h,d);let f=!0,p=!0,m=!0;const g=[],v=[];for(let y=0;y<e.length;++y){if(0===d.strides[y])throw Error("strides[".concat(y,"] must be non-zero"));const t=!!(d.shrinkAxisMask&1<<y),n=e[y];if(-1===n){g.push(t?1:-1);continue}const r=[d.beginMask&1<<y,d.endMask&1<<y],a=[d.strides[y]>0?0:-1,d.strides[y]>0?n:n-1];if(t&&d.strides[y]<=0)throw Error("only stride 1 allowed on non-range indexing.");m=m&&1===d.strides[y];const i=!!(d.beginMask&1<<y&&d.endMask&1<<y);if(d.beginValid&&d.endValid){if(t){const e=d.begin[y]<0?n+d.begin[y]:d.begin[y];if(d.begin[y]=e,d.end[y]=d.begin[y]+1,e<0||e>=n)throw Error("slice index ".concat(d.begin[y]," of dimension ").concat(y," out of bounds."))}else d.begin[y]=OT(d.begin[y],0,d.strides[y],n,r,a),d.end[y]=OT(d.end[y],1,d.strides[y],n,r,a);const e=1===d.strides[y]&&0===d.begin[y]&&d.end[y]===n;f=f&&e,p=p&&(0===y&&1===d.strides[y]||e)}else f=f&&1===d.strides[y]&&i,p=p&&(0===y&&1===d.strides[y]||i);let o,s=!1;if(d.beginValid&&d.endValid?(o=d.end[y]-d.begin[y],s=!0):t?(o=1,s=!0):i&&n>=0&&(o=d.strides[y]<0?-n:n,s=!0),s){let e;e=0===o||o<0!==d.strides[y]<0?0:Math.trunc(o/d.strides[y])+(o%d.strides[y]!==0?1:0),g.push(e)}else g.push(-1)}for(let y=0;y<d.finalShapeGatherIndices.length;++y){const e=d.finalShapeGatherIndices[y];e>=0?v.push(g[e]):e===gT&&v.push(1)}const b=v.filter((e,t)=>d.finalShapeGatherIndices[t]!==gT);return{finalShapeSparse:b,finalShape:v,isIdentity:f,sliceDim0:p,isSimpleSlice:m,begin:d.begin,end:d.end,strides:d.strides}}function OT(e,t,n,r,a,i){if(a[t])return n>0?i[t]:i[t+1&1];{const t=e<0?r+e:e;return t<i[0]?i[0]:t>i[1]?i[1]:t}}const LT=DE({all_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r={x:RE(e,"x","all","bool")},a={axis:t,keepDims:n};return kE.runKernel(ik,r,a)}});const PT=DE({any_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r={x:RE(e,"x","any","bool")},a={axis:t,keepDims:n};return kE.runKernel(ok,r,a)}});const MT=DE({argMax_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n={x:RE(e,"x","argMax")},r={axis:t};return kE.runKernel(sk,n,r)}});function jT(e,t,n,r){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NHWC",i=arguments.length>5?arguments[5]:void 0;return UT(e,[...t,e[3]],n,i,r,null,null,JT(a))}function BT(e,t,n,r,a,i){let o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"channelsLast";const[s,c]=HT(t);let l;if("channelsLast"===o)l=[s,c,e[3],e[3]];else{if("channelsFirst"!==o)throw new Error("Unknown dataFormat ".concat(o));l=[s,c,e[1],e[1]]}return UT(e,l,n,r,a,i,!1,o)}function zT(e,t,n,r,a,i){let o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"NDHWC";const[s,c,l]=GT(t);let u,h;if("NDHWC"===o)h="channelsLast",u=[s,c,l,e[4],e[4]];else{if("NCDHW"!==o)throw new Error("Unknown dataFormat ".concat(o));h="channelsFirst",u=[s,c,l,e[1],e[1]]}return WT(e,u,n,r,a,!1,h,i)}function UT(e,t,n,r,a,i){let o=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"channelsLast",[c,l,u,h]=[-1,-1,-1,-1];if("channelsLast"===s)[c,l,u,h]=e;else{if("channelsFirst"!==s)throw new Error("Unknown dataFormat ".concat(s));[c,h,l,u]=e}const[d,f,,p]=t,[m,g]=HT(n),[v,b]=HT(r),y=qT(d,v),x=qT(f,b),{padInfo:w,outHeight:k,outWidth:S}=function(e,t,n,r,a,i,o,s,c){let l,u,h;if("number"===typeof e){l={top:e,bottom:e,left:e,right:e,type:0===e?"VALID":"NUMBER"};const a=function(e,t,n,r,a){null==r&&(r=VT(e,t,n));const i=e[0],o=e[1],s=KT((i-t+2*r)/n+1,a),c=KT((o-t+2*r)/n+1,a);return[s,c]}([t,n],i,r,e,s);u=a[0],h=a[1]}else if("same"===e){u=Math.ceil(t/r),h=Math.ceil(n/a);const e=Math.max(0,(u-1)*r+i-t),s=Math.max(0,(h-1)*a+o-n),c=Math.floor(e/2),d=e-c,f=Math.floor(s/2);l={top:c,bottom:d,left:f,right:s-f,type:"SAME"}}else if("valid"===e)l={top:0,bottom:0,left:0,right:0,type:"VALID"},u=Math.ceil((t-i+1)/r),h=Math.ceil((n-o+1)/a);else{if("object"!==typeof e)throw Error("Unknown padding parameter: ".concat(e));{const d="channelsLast"===c?e[1][0]:e[2][0],f="channelsLast"===c?e[1][1]:e[2][1],p="channelsLast"===c?e[2][0]:e[3][0],m="channelsLast"===c?e[2][1]:e[3][1];l={top:d,bottom:f,left:p,right:m,type:0===d&&0===f&&0===p&&0===m?"VALID":"EXPLICIT"},u=KT((t-i+d+f)/r+1,s),h=KT((n-o+p+m)/a+1,s)}}return{padInfo:l,outHeight:u,outWidth:h}}(a,l,u,m,g,y,x,i,s),N=o?p*h:p;let C;return"channelsFirst"===s?C=[c,N,k,S]:"channelsLast"===s&&(C=[c,k,S,N]),{batchSize:c,dataFormat:s,inHeight:l,inWidth:u,inChannels:h,outHeight:k,outWidth:S,outChannels:N,padInfo:w,strideHeight:m,strideWidth:g,filterHeight:d,filterWidth:f,effectiveFilterHeight:y,effectiveFilterWidth:x,dilationHeight:v,dilationWidth:b,inShape:e,outShape:C,filterShape:t}}function WT(e,t,n,r,a){let i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"channelsLast",s=arguments.length>7?arguments[7]:void 0,[c,l,u,h,d]=[-1,-1,-1,-1,-1];if("channelsLast"===o)[c,l,u,h,d]=e;else{if("channelsFirst"!==o)throw new Error("Unknown dataFormat ".concat(o));[c,d,l,u,h]=e}const[f,p,m,,g]=t,[v,b,y]=GT(n),[x,w,k]=GT(r),S=qT(f,x),N=qT(p,w),C=qT(m,k),{padInfo:E,outDepth:I,outHeight:T,outWidth:_}=function(e,t,n,r,a,i,o,s,c,l,u){let h,d,f,p;"valid"===e&&(e=0);if("number"===typeof e){h={top:e,bottom:e,left:e,right:e,front:e,back:e,type:0===e?"VALID":"NUMBER"};const m=function(e,t,n,r,a,i){null==a&&(a=VT(e,t[0],r[0]));const o=[0,0,0,n];for(let s=0;s<3;s++)e[s]+2*a>=t[s]&&(o[s]=KT((e[s]-t[s]+2*a)/r[s]+1,i));return o}([t,n,r,1],[s,c,l],1,[a,i,o],e,u);d=m[0],f=m[1],p=m[2]}else{if("same"!==e)throw Error("Unknown padding parameter: ".concat(e));{d=Math.ceil(t/a),f=Math.ceil(n/i),p=Math.ceil(r/o);const e=(d-1)*a+s-t,u=(f-1)*i+c-n,m=(p-1)*o+l-r,g=Math.floor(e/2),v=e-g,b=Math.floor(u/2),y=u-b,x=Math.floor(m/2);h={top:b,bottom:y,left:x,right:m-x,front:g,back:v,type:"SAME"}}}return{padInfo:h,outDepth:d,outHeight:f,outWidth:p}}(a,l,u,h,v,b,y,S,N,C,s),A=i?g*d:g;let R;return"channelsFirst"===o?R=[c,A,I,T,_]:"channelsLast"===o&&(R=[c,I,T,_,A]),{batchSize:c,dataFormat:o,inDepth:l,inHeight:u,inWidth:h,inChannels:d,outDepth:I,outHeight:T,outWidth:_,outChannels:A,padInfo:E,strideDepth:v,strideHeight:b,strideWidth:y,filterDepth:f,filterHeight:p,filterWidth:m,effectiveFilterDepth:S,effectiveFilterHeight:N,effectiveFilterWidth:C,dilationDepth:x,dilationHeight:w,dilationWidth:k,inShape:e,outShape:R,filterShape:t}}function VT(e,t,n){const r=qT(t,arguments.length>3&&void 0!==arguments[3]?arguments[3]:1);return Math.floor((e[0]*(n-1)-n+r)/2)}function HT(e){return"number"===typeof e?[e,e,e]:2===e.length?[e[0],e[1],1]:e}function GT(e){return"number"===typeof e?[e,e,e]:e}function qT(e,t){return t<=1?e:e+(e-1)*(t-1)}function KT(e,t){if(!t)return Math.trunc(e);switch(t){case"round":return Math.round(e);case"ceil":return Math.ceil(e);case"floor":return Math.floor(e);default:throw new Error("Unknown roundingMode ".concat(t))}}function XT(e){const[t,n,r]=HT(e);return 1===t&&1===n&&1===r}function YT(e,t){return XT(e)||XT(t)}function $T(e){return HT(e).every(e=>e>0)}function JT(e){if("NHWC"===e)return"channelsLast";if("NCHW"===e)return"channelsFirst";throw new Error("Unknown dataFormat ".concat(e))}function QT(e,t,n){if(null!=n){if("string"===typeof t)throw Error("Error in ".concat(e,": pad must be an integer when using ")+"dimRoundingMode ".concat(n," but got pad ").concat(t,"."));if("number"===typeof t)mw(xw(t),()=>"Error in ".concat(e,": pad must be an integer when using ")+"dimRoundingMode ".concat(n," but got pad ").concat(t,"."));else{if("object"!==typeof t)throw Error("Error in ".concat(e,": Unknown padding parameter: ").concat(t));t.forEach(t=>{t.forEach(t=>{mw(xw(t),()=>"Error in ".concat(e,": pad must be an integer when using ")+"dimRoundingMode ".concat(n," but got pad ").concat(t,"."))})})}}}const ZT=DE({reshape_:function(e,t){const n={x:RE(e,"x","reshape","string_or_numeric")},r={shape:t};return kE.runKernel(hN,n,r)}});const e_=DE({avgPool_:function(e,t,n,r,a){const i=RE(e,"x","avgPool","float32");mw(YT(n,1),()=>"Error in avgPool: Either strides or dilations must be 1. "+"Got strides ".concat(n," and dilations '").concat(1,"'"));let o=i,s=!1;3===i.rank&&(s=!0,o=ZT(i,[1,i.shape[0],i.shape[1],i.shape[2]])),mw(4===o.rank,()=>"Error in avgPool: x must be rank 4 but got rank ".concat(o.rank,".")),QT("avgPool",r,a);const c={x:o},l={filterSize:t,strides:n,pad:r,dimRoundingMode:a};let u=kE.runKernel(pk,c,l);return u=TI(u,i.dtype),s?ZT(u,[u.shape[1],u.shape[2],u.shape[3]]):u}});const t_=DE({avgPool3d_:function(e,t,n,r,a){let i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NDHWC";const o=RE(e,"x","avgPool3d","float32");let s=o,c=!1;4===o.rank&&(c=!0,s=ZT(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),mw(5===s.rank,()=>"Error in avgPool3d: x must be rank 5 but got rank ".concat(s.rank,".")),mw("NDHWC"===i,()=>"Error in avgPool3d: Only NDHWC is currently supported, "+"but got dataFormat of ".concat(i)),mw("number"===typeof n&&n>0||Array.isArray(n)&&n[0]>0&&n[1]>0&&n[2]>0,()=>"Error in avgPool3d: Stride must be > 0, but got '".concat(n,"'")),QT("avgPool3d",r,a);const l={x:s},u={filterSize:t,strides:n,pad:r,dimRoundingMode:a,dataFormat:i};let h=kE.runKernel(gk,l,u);return h=TI(h,s.dtype),c?ZT(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}});const n_=DE({batchNorm_:function(e,t,n,r,a,i){null==i&&(i=.001);const o=RE(e,"x","batchNorm"),s=RE(t,"mean","batchNorm"),c=RE(n,"variance","batchNorm");let l,u;null!=a&&(l=RE(a,"scale","batchNorm")),null!=r&&(u=RE(r,"offset","batchNorm")),mw(s.rank===c.rank,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),mw(null==u||s.rank===u.rank,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),mw(null==l||s.rank===l.rank,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");const h=function(e){let t;return t=0===e.rank||1===e.rank?ZT(e,[1,1,1,e.size]):2===e.rank?ZT(e,[1,1,e.shape[0],e.shape[1]]):3===e.rank?ZT(e,[1,e.shape[0],e.shape[1],e.shape[2]]):e,t}(o),d={x:h,scale:l,offset:u,mean:s,variance:c},f={varianceEpsilon:i},p=kE.runKernel(uS,d,f);return ZT(p,o.shape)}});const r_=DE({batchNorm2d_:function(e,t,n,r,a,i){const o=RE(e,"x","batchNorm"),s=RE(t,"mean","batchNorm"),c=RE(n,"variance","batchNorm");let l,u;return null!=a&&(l=RE(a,"scale","batchNorm")),null!=r&&(u=RE(r,"offset","batchNorm")),mw(2===o.rank,()=>"Error in batchNorm2D: x must be rank 2 but got rank "+"".concat(o.rank,".")),mw(2===s.rank||1===s.rank,()=>"Error in batchNorm2D: mean must be rank 2 or rank 1 but "+"got rank ".concat(s.rank,".")),mw(2===c.rank||1===c.rank,()=>"Error in batchNorm2D: variance must be rank 2 or rank 1 "+"but got rank ".concat(c.rank,".")),null!=l&&mw(2===l.rank||1===l.rank,()=>"Error in batchNorm2D: scale must be rank 2 or rank 1 "+"but got rank ".concat(l.rank,".")),null!=u&&mw(2===u.rank||1===u.rank,()=>"Error in batchNorm2D: offset must be rank 2 or rank 1 "+"but got rank ".concat(u.rank,".")),n_(o,s,c,u,l,i)}});const a_=DE({batchNorm3d_:function(e,t,n,r,a,i){const o=RE(e,"x","batchNorm"),s=RE(t,"mean","batchNorm"),c=RE(n,"variance","batchNorm");let l,u;return null!=a&&(l=RE(a,"scale","batchNorm")),null!=r&&(u=RE(r,"offset","batchNorm")),mw(3===o.rank,()=>"Error in batchNorm3D: x must be rank 3 but got rank "+"".concat(o.rank,".")),mw(3===s.rank||1===s.rank,()=>"Error in batchNorm3D: mean must be rank 3 or rank 1 but "+"got rank ".concat(s.rank,".")),mw(3===c.rank||1===c.rank,()=>"Error in batchNorm3D: variance must be rank 3 or rank 1 "+"but got rank ".concat(c.rank,".")),null!=l&&mw(3===l.rank||1===l.rank,()=>"Error in batchNorm3D: scale must be rank 3 or rank 1 "+"but got rank ".concat(l.rank,".")),null!=u&&mw(3===u.rank||1===u.rank,()=>"Error in batchNorm3D: offset must be rank 3 or rank 1 "+"but got rank ".concat(u.rank,".")),n_(o,s,c,u,l,i)}});const i_=DE({batchNorm4d_:function(e,t,n,r,a,i){const o=RE(e,"x","batchNorm"),s=RE(t,"mean","batchNorm"),c=RE(n,"variance","batchNorm");let l,u;return null!=a&&(l=RE(a,"scale","batchNorm")),null!=r&&(u=RE(r,"offset","batchNorm")),mw(4===o.rank,()=>"Error in batchNorm4D: x must be rank 4 but got rank "+"".concat(o.rank,".")),mw(4===s.rank||1===s.rank,()=>"Error in batchNorm4D: mean must be rank 4 or rank 1 but "+"got rank ".concat(s.rank,".")),mw(4===c.rank||1===c.rank,()=>"Error in batchNorm4D: variance must be rank 4 or rank 1 "+"but got rank ".concat(c.rank,".")),null!=l&&mw(4===l.rank||1===l.rank,()=>"Error in batchNorm4D: scale must be rank 4 or rank 1 "+"but got rank ".concat(l.rank,".")),null!=u&&mw(4===u.rank||1===u.rank,()=>"Error in batchNorm4D: offset must be rank 4 or rank 1 "+"but got rank ".concat(u.rank,".")),n_(o,s,c,u,l,i)}});const o_=DE({broadcastTo_:function(e,t){let n=RE(e,"broadcastTo","x");const r=n.shape;if(Ww(t),t.length<n.rank)throw new Error("broadcastTo(): shape.length=".concat(t.length," < input.rank=").concat(n.rank,"."));if(t.length>n.rank){const e=n.shape.slice();for(;e.length<t.length;)e.unshift(1);n=ZT(n,e)}const a=n.shape,i=Array.from(t);for(let l=t.length-1;l>=0;l--)if(a[l]===t[l])i[l]=1;else if(1!==n.shape[l])throw new Error("broadcastTo(): [".concat(r,"] cannot be broadcast to [").concat(t,"]."));const o=i.map((e,t)=>e>1?t:-1).filter(e=>e>=0);if(0===o.length)return _I(n);const s={x:n},c={reps:i};return kE.runKernel(JN,s,c)}});const s_=DE({clipByValue_:function(e,t,n){const r=RE(e,"x","clipByValue");if(mw(t<=n,()=>"Error in clip: min (".concat(t,") must be ")+"less than or equal to max (".concat(n,").")),t===n)return KI(r.shape,t,r.dtype);const a={x:r},i={clipValueMin:t,clipValueMax:n};return kE.runKernel(Ck,a,i)}});const c_=DE({concat_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;mw(e.length>=1,()=>"Pass at least one tensor to concat");const n=FE(e,"tensors","concat","string_or_numeric");if("complex64"===n[0].dtype&&n.forEach(e=>{if("complex64"!==e.dtype)throw new Error("Cannot concatenate complex64 tensors with a tensor\n          with dtype ".concat(e.dtype,". "))}),1===n.length)return _I(n[0]);const r=n,a={axis:t};return kE.runKernel(Tk,r,a)}});const l_=DE({concat1d_:function(e){return c_(e,0)}});const u_=DE({concat2d_:function(e,t){return c_(e,t)}});const h_=DE({concat3d_:function(e,t){return c_(e,t)}});const d_=DE({concat4d_:function(e,t){return c_(e,t)}});const f_=DE({conv2d_:function(e,t,n,r){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NHWC",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],o=arguments.length>6?arguments[6]:void 0;const s=RE(e,"x","conv2d","float32"),c=RE(t,"filter","conv2d","float32");let l=s,u=!1;3===s.rank&&(u=!0,l=ZT(s,[1,s.shape[0],s.shape[1],s.shape[2]])),mw(4===l.rank,()=>"Error in conv2d: input must be rank 4, but got rank ".concat(l.rank,".")),mw(4===c.rank,()=>"Error in conv2d: filter must be rank 4, but got rank "+"".concat(c.rank,".")),QT("conv2d",r,o);const h="NHWC"===a?l.shape[3]:l.shape[1];mw(h===c.shape[2],()=>"Error in conv2d: depth of input (".concat(h,") must match ")+"input depth for filter ".concat(c.shape[2],".")),mw(YT(n,i),()=>"Error in conv2D: Either strides or dilations must be 1. "+"Got strides ".concat(n," and dilations '").concat(i,"'")),mw($T(i),()=>"Error in conv2D: Dilated rates should be larger than 0."),mw($T(n),()=>"Error in conv2D: Strides should be larger than 0.");const d={x:l,filter:c},f={strides:n,pad:r,dataFormat:a,dilations:i,dimRoundingMode:o},p=kE.runKernel(_k,d,f);return u?ZT(p,[p.shape[1],p.shape[2],p.shape[3]]):p}});const p_=DE({conv1d_:function(e,t,n,r){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NWC",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,o=arguments.length>6?arguments[6]:void 0;const s=RE(e,"x","conv1d"),c=RE(t,"filter","conv1d");let l=s,u=!1;2===s.rank&&(u=!0,l=ZT(s,[1,s.shape[0],s.shape[1]])),mw(3===l.rank,()=>"Error in conv1d: input must be rank 3, but got rank ".concat(l.rank,".")),mw(3===c.rank,()=>"Error in conv1d: filter must be rank 3, but got rank "+"".concat(c.rank,".")),QT("conv1d",r,o),mw(l.shape[2]===c.shape[1],()=>"Error in conv1d: depth of input (".concat(l.shape[2],") must match ")+"input depth for filter ".concat(c.shape[1],".")),mw(YT(n,i),()=>"Error in conv1D: Either stride or dilation must be 1. "+"Got stride ".concat(n," and dilation '").concat(i,"'")),mw($T(i),()=>"Error in conv1D: Dilated rates should be larger than 0."),mw($T(n),()=>"Error in conv1D: Stride should be larger than 0."),mw("NWC"===a,()=>"Error in conv1d: got dataFormat of ".concat(a," but only NWC is currently supported."));const h=ZT(c,[1,c.shape[0],c.shape[1],c.shape[2]]),d=ZT(l,[l.shape[0],1,l.shape[1],l.shape[2]]),f=f_(d,h,[1,n],r,"NHWC",[1,i],o);return ZT(f,u?[f.shape[2],f.shape[3]]:[f.shape[0],f.shape[2],f.shape[3]])}});const m_=DE({conv2DBackpropInput_:function(e,t,n,r,a){let i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NHWC",o=arguments.length>6?arguments[6]:void 0;mw(e.length===t.rank,()=>"Length of inShape "+"(".concat(e.length,") and rank of dy (").concat(t.rank,") must match"));let s=e,c=t,l=!1;3===t.rank&&(l=!0,c=ZT(t,[1,t.shape[0],t.shape[1],t.shape[2]]),s=[1,e[0],e[1],e[2]]),mw(4===s.length,()=>"Error in conv2dDerInput: inShape must be length 4, but got length "+"".concat(s.length,".")),mw(4===c.rank,()=>"Error in conv2dDerInput: dy must be rank 4, but got "+"rank ".concat(c.rank)),mw(4===n.rank,()=>"Error in conv2dDerInput: filter must be rank 4, but got "+"rank ".concat(n.rank));const u="NHWC"===i?s[3]:s[1],h="NHWC"===i?c.shape[3]:c.shape[1];mw(u===n.shape[2],()=>"Error in conv2dDerInput: depth of input (".concat(u,") must ")+"match input depth for filter ".concat(n.shape[2],".")),mw(h===n.shape[3],()=>"Error in conv2dDerInput: depth of output (".concat(h,") must ")+"match output depth for filter ".concat(n.shape[3],".")),QT("conv2dDerInput",a,o);const d={dy:c,filter:n},f={strides:r,pad:a,dataFormat:i,dimRoundingMode:o,inputShape:s},p=kE.runKernel(Rk,d,f);return l?ZT(p,[p.shape[1],p.shape[2],p.shape[3]]):p}});const g_=DE({conv2dTranspose_:function(e,t,n,r,a,i){const o=RE(e,"x","conv2dTranspose"),s=RE(t,"filter","conv2dTranspose");return m_(n,o,s,r,a,"NHWC",i)}});const v_=DE({conv3d_:function(e,t,n,r){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NDHWC",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1,1];const o=RE(e,"x","conv3d"),s=RE(t,"filter","conv3d");let c=o,l=!1;4===o.rank&&(l=!0,c=ZT(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),mw(5===c.rank,()=>"Error in conv3d: input must be rank 5, but got rank ".concat(c.rank,".")),mw(5===s.rank,()=>"Error in conv3d: filter must be rank 5, but got rank "+"".concat(s.rank,".")),mw(c.shape[4]===s.shape[3],()=>"Error in conv3d: depth of input (".concat(c.shape[4],") must match ")+"input depth for filter ".concat(s.shape[3],".")),mw(YT(n,i),()=>"Error in conv3D: Either strides or dilations must be 1. "+"Got strides ".concat(n," and dilations '").concat(i,"'")),mw("NDHWC"===a,()=>"Error in conv3d: got dataFormat of ".concat(a," but only NDHWC is currently supported.")),mw($T(i),()=>"Error in conv3D: Dilated rates should be larger than 0."),mw($T(n),()=>"Error in conv3D: Strides should be larger than 0.");const u={x:c,filter:s},h={strides:n,pad:r,dataFormat:a,dilations:i},d=kE.runKernel(Fk,u,h);return l?ZT(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}});const b_=DE({conv3DBackpropInput_:function(e,t,n,r,a){mw(e.length===t.rank,()=>"Length of inShape "+"(".concat(e.length,") and rank of dy (").concat(t.rank,") must match"));let i=e,o=t,s=!1;4===t.rank&&(s=!0,o=ZT(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]]),i=[1,e[0],e[1],e[2],e[3]]);const c=i[4],l=o.shape[4];mw(5===i.length,()=>"Error in conv3dDerInput: inShape must be length 5, but got length "+"".concat(i.length,".")),mw(5===o.rank,()=>"Error in conv3dDerInput: dy must be rank 5, but got "+"rank ".concat(o.rank)),mw(5===n.rank,()=>"Error in conv3dDerInput: filter must be rank 5, but got "+"rank ".concat(n.rank)),mw(c===n.shape[3],()=>"Error in conv3dDerInput: depth of input (".concat(c,") must ")+"match input depth for filter ".concat(n.shape[3],".")),mw(l===n.shape[4],()=>"Error in conv3dDerInput: depth of output (".concat(l,") must ")+"match output depth for filter ".concat(n.shape[4],"."));const u={dy:o,filter:n},h={pad:a,strides:r,inputShape:i},d=kE.runKernel(Ok,u,h);return s?ZT(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}});const y_=DE({conv3dTranspose_:function(e,t,n,r,a){const i=RE(e,"x","conv3dTranspose"),o=RE(t,"filter","conv3dTranspose");return b_(n,i,o,r,a)}});const x_=DE({denseBincount_:function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const a=RE(e,"x","denseBincount"),i=RE(t,"weights","denseBincount");mw("int32"===a.dtype,()=>"Error in denseBincount: input "+"dtype must be int32, but got ".concat(a.dtype)),mw(a.rank<=2,()=>"Error in denseBincount: input must be at most rank 2, but got "+"rank ".concat(a.rank,".")),mw(n>=0,()=>"size must be non-negative, but got ".concat(n,".")),mw(i.size===a.size||0===i.size,()=>"Error in denseBincount: weights must have the same shape as x or "+"0-length, but got x shape: ".concat(a.shape,", weights shape: ")+"".concat(i.shape,"."));const o={x:a,weights:i},s={size:n,binaryOutput:r};return kE.runKernel(zk,o,s)}});const w_=DE({depthwiseConv2d_:function(e,t,n,r){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NHWC",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],o=arguments.length>6?arguments[6]:void 0;const s=RE(e,"x","depthwiseConv2d","float32"),c=RE(t,"filter","depthwiseConv2d","float32");let l=s,u=!1;3===s.rank&&(u=!0,l=ZT(s,[1,s.shape[0],s.shape[1],s.shape[2]])),mw(4===l.rank,()=>"Error in depthwiseConv2d: input must be rank 4, but got "+"rank ".concat(l.rank,".")),mw(4===c.rank,()=>"Error in depthwiseConv2d: filter must be rank 4, but got rank "+"".concat(c.rank,"."));const h="NHWC"===a?l.shape[3]:l.shape[1];mw(h===c.shape[2],()=>"Error in depthwiseConv2d: number of input channels "+"(".concat(h,") must match the inChannels dimension in ")+"filter ".concat(c.shape[2],".")),QT("depthwiseConv2d",r,o);const d={x:l,filter:c},f={strides:n,pad:r,dataFormat:a,dilations:i,dimRoundingMode:o},p=kE.runKernel(Wk,d,f);return u?ZT(p,[p.shape[1],p.shape[2],p.shape[3]]):p}});const k_=DE({elu_:function(e){const t={x:RE(e,"x","elu","float32")};return kE.runKernel(Qk,t)}});const S_=DE({equal_:function(e,t){let n=RE(e,"a","equal","string_or_numeric"),r=RE(t,"b","equal","string_or_numeric");[n,r]=pE(n,r),tT(n.shape,r.shape);const a={a:n,b:r};return kE.runKernel(tS,a)}});const N_=DE({erf_:function(e){let t=RE(e,"x","erf");mw("int32"===t.dtype||"float32"===t.dtype,()=>"Input dtype must be `int32` or `float32`."),"int32"===t.dtype&&(t=TI(t,"float32"));const n={x:t};return kE.runKernel(eS,n)}});const C_=DE({exp_:function(e){const t={x:RE(e,"x","exp")};return kE.runKernel(nS,t)}});const E_=DE({expandDims_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=RE(e,"x","expandDims","string_or_numeric");mw(t<=n.rank,()=>"Axis must be <= rank of the tensor");const r={input:n},a={dim:t};return kE.runKernel(rS,r,a)}});const I_=DE({tile_:function(e,t){const n=RE(e,"x","tile","string_or_numeric");mw(n.rank===t.length,()=>"Error in transpose: rank of input ".concat(n.rank," ")+"must match length of reps ".concat(t,"."));const r={x:n},a={reps:t};return kE.runKernel(JN,r,a)}});const T_=DE({eye_:function(e,t,n){null==t&&(t=e);const r=II([e,t],arguments.length>3&&void 0!==arguments[3]?arguments[3]:"float32"),a=e<=t?e:t;for(let o=0;o<a;++o)r.set(1,o,o);const i=ZT(r.toTensor(),[e,t]);if(null==n)return i;if(1===n.length)return I_(E_(i,0),[n[0],1,1]);if(2===n.length)return I_(E_(E_(i,0),0),[n[0],n[1],1,1]);if(3===n.length)return I_(E_(E_(E_(i,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error("eye() currently supports only 1D and 2D "+"batchShapes, but received ".concat(n.length,"D."))}});const __=DE({floor_:function(e){const t={x:RE(e,"x","floor","float32")};return kE.runKernel(cS,t)}});const A_=DE({gather_:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const a={x:RE(e,"x","gather"),indices:RE(t,"indices","gather","int32")},i={axis:n,batchDims:r};return kE.runKernel(hS,a,i)}});const R_=DE({greater_:function(e,t){let n=RE(e,"a","greater","string_or_numeric"),r=RE(t,"b","greater","string_or_numeric");[n,r]=pE(n,r),tT(n.shape,r.shape);const a={a:n,b:r};return kE.runKernel(fS,a)}});const F_=DE({greaterEqual_:function(e,t){let n=RE(e,"a","greaterEqual","string_or_numeric"),r=RE(t,"b","greaterEqual","string_or_numeric");[n,r]=pE(n,r),tT(n.shape,r.shape);const a={a:n,b:r};return kE.runKernel(pS,a)}});const D_=DE({leakyRelu_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.2;const n={x:RE(e,"x","leakyRelu")},r={alpha:t};return kE.runKernel(wS,n,r)}});const O_=DE({log_:function(e){const t={x:RE(e,"x","log","float32")};return kE.runKernel(CS,t)}});const L_=DE({log1p_:function(e){const t={x:RE(e,"x","log1p")};return kE.runKernel(ES,t)}});const P_=DE({max_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r={x:RE(e,"x","max")},a={reductionIndices:t,keepDims:n};return kE.runKernel(FS,r,a)}});const M_=DE({sum_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=RE(e,"x","sum");"bool"===r.dtype&&(r=TI(r,"int32"));const a={x:r},i={axis:t,keepDims:n};return kE.runKernel(FN,a,i)}});const j_=DE({logSoftmax_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;const n=RE(e,"logits","logSoftmax");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. "+"Logits was rank ".concat(n.rank," and axis was ").concat(t));const r=jI((e,n)=>{const r=P_(e,t,!0),a=$I(e,r),i=$I(TI(a,"float32"),O_(M_(C_(a),t,!0)));n([i]);return{value:i,gradFunc:(e,n)=>{const[r]=n,a=C_(r);return $I(e,OI(M_(e,t,!0),a))}}});return r(n)}});function B_(e,t){for(let n=0;n<e.length;++n)if(e[e.length-n-1]!==t-1-n)return!1;return!0}function z_(e,t,n){const r=e.length+t.length,a=[];let i=0,o=0;for(let s=0;s<r;s++)-1===n.indexOf(s)?a.push(e[i++]):a.push(t[o++]);return a}function U_(e,t){const n=[],r=e.length;for(let a=0;a<r;a++)-1===t.indexOf(a)&&n.push(e[a]);return[n,t.map(t=>e[t])]}function W_(e,t){return z_(e,t.map(e=>1),t)}function V_(e,t,n){mw(B_(t,n),()=>"".concat(e," supports only inner-most axes for now. ")+"Got axes ".concat(t," and rank-").concat(n," input."))}function H_(e,t){if(B_(e,t))return null;const n=[];for(let r=0;r<t;++r)-1===e.indexOf(r)&&n.push(r);return e.forEach(e=>n.push(e)),n}function G_(e){return e.map((e,t)=>[t,e]).sort((e,t)=>e[1]-t[1]).map(e=>e[0])}function q_(e,t){const n=[];for(let r=t-e;r<t;++r)n.push(r);return n}const K_=DE({logSumExp_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=RE(e,"x","logSumExp"),a=Cw(t,r.shape),i=P_(r,a,!0),o=$I(r,i),s=C_(o),c=M_(s,a),l=O_(c),u=RI(ZT(i,l.shape),l);if(n){const e=W_(u.shape,a);return ZT(u,e)}return u}});const X_=DE({logicalAnd_:function(e,t){const n=RE(e,"a","logicalAnd","bool"),r=RE(t,"b","logicalAnd","bool");tT(n.shape,r.shape);const a={a:n,b:r};return kE.runKernel(IS,a)}});const Y_=DE({matMul_:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=RE(e,"a","matMul"),i=RE(t,"b","matMul");[a,i]=pE(a,i);const o={a:a,b:i},s={transposeA:n,transposeB:r};return kE.runKernel(bk,o,s)}});const $_=DE({maxPool_:function(e,t,n,r,a){const i=RE(e,"x","maxPool");let o=i,s=!1;3===i.rank&&(s=!0,o=ZT(i,[1,i.shape[0],i.shape[1],i.shape[2]])),mw(4===o.rank,()=>"Error in maxPool: input must be rank 4 but got rank ".concat(o.rank,".")),mw(YT(n,1),()=>"Error in maxPool: Either strides or dilations must be 1. "+"Got strides ".concat(n," and dilations '").concat(1,"'")),QT("maxPool",r,a);const c={x:o},l={filterSize:t,strides:n,pad:r,dimRoundingMode:a},u=kE.runKernel(OS,c,l);return s?ZT(u,[u.shape[1],u.shape[2],u.shape[3]]):u}});const J_=DE({maxPool3d_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[1,1,1],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NDHWC";const o=RE(e,"x","maxPool3d");let s=o,c=!1;4===o.rank&&(c=!0,s=ZT(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),mw(5===s.rank,()=>"Error in maxPool3d: x must be rank 5 but got rank ".concat(s.rank,".")),mw("NDHWC"===i,()=>"Error in maxPool3d: Only NDHWC is currently supported, "+"but got dataFormat of ".concat(i)),QT("maxPool3d",r,a);const l={x:s},u={filterSize:t,strides:n,pad:r,dimRoundingMode:a,dataFormat:i},h=kE.runKernel(PS,l,u);return c?ZT(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}});const Q_=DE({mean_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r={x:RE(e,"x","mean")},a={axis:t,keepDims:n};return kE.runKernel(BS,r,a)}});const Z_=DE({min_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r={x:RE(e,"x","min")},a={axis:t,keepDims:n};return kE.runKernel(zS,r,a)}});const eA=DE({minimum_:function(e,t){let n=RE(e,"a","minimum"),r=RE(t,"b","minimum");[n,r]=pE(n,r),"bool"===n.dtype&&(n=TI(n,"int32"),r=TI(r,"int32")),tT(n.shape,r.shape);const a={a:n,b:r};return kE.runKernel(US,a)}});const tA=DE({moments_:function(e){let t=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const n=Cw(arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,(e=RE(e,"x","moments")).shape),r=Q_(e,n,t);let a=r.shape;t||(a=W_(r.shape,n));const i=PI($I(TI(e,"float32"),ZT(r,a)));return{mean:r,variance:Q_(i,n,t)}}});const nA=DE({neg_:function(e){const t={x:RE(e,"x","neg")};return kE.runKernel(qS,t)}});const rA=DE({notEqual_:function(e,t){let n=RE(e,"a","notEqual","string_or_numeric"),r=RE(t,"b","notEqual","string_or_numeric");[n,r]=pE(n,r),tT(n.shape,r.shape);const a={a:n,b:r};return kE.runKernel(KS,a)}});const aA=DE({oneHot_:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"int32";if(t<2)throw new Error("Error in oneHot: depth must be >=2, but it is ".concat(t));const i={indices:RE(e,"indices","oneHot","int32")},o={dtype:a,depth:t,onValue:n,offValue:r};return kE.runKernel(QS,i,o)}});function iA(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32";if(Ww(e),"complex64"===t){const t=iA(e,"float32"),n=iA(e,"float32");return OE(t,n)}const n=zw(bw(e),t);return kE.makeTensor(n,e,t)}function oA(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32";if(Ww(e),"complex64"===t){const t=oA(e,"float32"),n=iA(e,"float32");return OE(t,n)}const n=Bw(bw(e),t);return kE.makeTensor(n,e,t)}const sA=DE({onesLike_:function(e){const t={x:RE(e,"x","onesLike")};return kE.runKernel(JS,t)}});const cA=DE({pad_:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const r=RE(e,"x","pad");if(0===r.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");const a={paddings:t,constantValue:n},i={x:r};return kE.runKernel(eN,i,a)}});const lA=DE({prelu_:function(e,t){const n={x:RE(e,"x","prelu"),alpha:RE(t,"alpha","prelu")};return kE.runKernel(nN,n)}});var uA=n(1053);class hA{constructor(e,t,n,r,a){this.mean=e,this.stdDev=t,this.dtype=n,this.nextVal=NaN,this.truncated=r,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);const i=a||Math.random();this.random=uA.alea(i.toString())}nextValue(){if(!isNaN(this.nextVal)){const e=this.nextVal;return this.nextVal=NaN,e}let e,t,n=!1;for(;!n;){let r,a,i;do{r=2*this.random()-1,a=2*this.random()-1,i=r*r+a*a}while(i>=1||0===i);const o=Math.sqrt(-2*Math.log(i)/i);e=this.mean+this.stdDev*r*o,t=this.mean+this.stdDev*a*o,this.truncated&&!this.isValidTruncated(e)||(n=!0)}return this.truncated&&!this.isValidTruncated(t)||(this.nextVal=this.convertValue(t)),this.convertValue(e)}convertValue(e){return null==this.dtype||"float32"===this.dtype?e:Math.round(e)}isValidTruncated(e){return e<=this.upper&&e>=this.lower}}class dA{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;if(this.canReturnFloat=()=>null==this.dtype||"float32"===this.dtype,this.min=e,this.range=t-e,this.dtype=n,null==r&&(r=Math.random()),"number"===typeof r&&(r=r.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between ".concat(e," - ").concat(t," <= 1 and dtype is not float"));this.random=uA.alea(r)}convertValue(e){return this.canReturnFloat()?e:Math.round(e)}nextValue(){return this.convertValue(this.min+this.range*this.random())}}const fA=DE({randomNormal_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0;if(Ww(e),null!=r&&"bool"===r)throw new Error("Unsupported data type ".concat(r));const i=new hA(t,n,r,!1,a),o=II(e,r);for(let s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}});const pA=DE({randomUniform_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"float32",a=arguments.length>4?arguments[4]:void 0;Ww(e);const i=II(e,r),o=new dA(t,n,null,a);for(let s=0;s<i.values.length;s++)i.values[s]=o.nextValue();return i.toTensor()}});function mA(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"float32";if(0===n)throw new Error("Cannot have a step of zero");const a={start:e,stop:t,step:n,dtype:r};return kE.runKernel(sN,{},a)}const gA=DE({relu_:function(e){const t={x:RE(e,"x","relu")};return kE.runKernel(uN,t)}});const vA=DE({reverse_:function(e,t){const n={x:RE(e,"x","reverse")},r={dims:t};return kE.runKernel(vN,n,r)}});const bA=DE({selu_:function(e){const t={x:RE(e,"x","selu")};return kE.runKernel(NN,t)}});const yA=DE({separableConv2d_:function(e,t,n,r,a){let i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"NHWC";const s=RE(e,"x","separableConv2d"),c=RE(t,"depthwiseFilter","separableConv2d"),l=RE(n,"pointwiseFilter","separableConv2d");let u=s,h=!1;if(3===s.rank&&(h=!0,u=ZT(s,[1,s.shape[0],s.shape[1],s.shape[2]])),"NCHW"===o)throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");mw(4===u.rank,()=>"Error in separableConv2d: input must be rank 4, but got "+"rank ".concat(u.rank,".")),mw(4===c.rank,()=>"Error in separableConv2d: depthwise filter must be rank 4, but "+"got rank ".concat(c.rank,".")),mw(4===l.rank,()=>"Error in separableConv2d: pointwise filter must be rank 4, but "+"got rank ".concat(c.rank,".")),mw(1===l.shape[0],()=>"Error in separableConv2d: the first dimension of pointwise filter "+" must be 1, but got ".concat(l.shape[0],".")),mw(1===l.shape[1],()=>"Error in separableConv2d: the second dimension of pointwise "+"filter must be 1, but got ".concat(l.shape[1],"."));const d=c.shape[2],f=c.shape[3];mw(l.shape[2]===d*f,()=>"Error in separableConv2d: the third dimension of pointwise filter "+"must be ".concat(d*f,", ")+"but got ".concat(l.shape[2],"."));const p=w_(u,c,r,a,o,i),m=f_(p,l,1,"valid",o);return h?ZT(m,[m.shape[1],m.shape[2],m.shape[3]]):m}});const xA=DE({sigmoid_:function(e){const t={x:RE(e,"x","sigmoid","float32")};return kE.runKernel(_N,t)}});const wA=DE({slice_:function(e,t,n){const r=RE(e,"x","slice","string_or_numeric");if(0===r.rank)throw new Error("Slicing scalar is not possible");const a={x:r},i={begin:t,size:n};return kE.runKernel(CN,a,i)}});const kA=DE({slice1d_:function(e,t,n){const r=RE(e,"x","slice1d");return mw(1===r.rank,()=>"slice1d expects a rank-1 tensor, but got a rank-".concat(r.rank," tensor")),wA(r,[t],[n])}});const SA=DE({slice2d_:function(e,t,n){const r=RE(e,"x","slice2d");return mw(2===r.rank,()=>"slice2d expects a rank-2 tensor, but got a rank-".concat(r.rank," tensor")),wA(r,t,n)}});const NA=DE({slice3d_:function(e,t,n){const r=RE(e,"x","slice3d");return mw(3===r.rank,()=>"slice3d expects a rank-3 tensor, but got a rank-".concat(r.rank," tensor")),wA(r,t,n)}});const CA=DE({slice4d_:function(e,t,n){const r=RE(e,"x","slice4d");return mw(4===r.rank,()=>"slice4d expects a rank-4 tensor, but got a rank-".concat(r.rank," tensor")),wA(r,t,n)}});const EA=DE({softmax_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;const n=RE(e,"logits","softmax","float32");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. "+"Logits was rank ".concat(n.rank," and dim was ").concat(t));const r={logits:n},a={dim:t};return kE.runKernel(LN,r,a)}});const IA=DE({softplus_:function(e){const t={x:RE(e,"x","softplus")};return kE.runKernel(AN,t)}});const TA=DE({split_:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const r={x:RE(e,"x","split")},a={numOrSizeSplits:t,axis:n};return kE.runKernel(ON,r,a)}});const _A=DE({squeeze_:function(e,t){const n=RE(e,"x","squeeze","string_or_numeric");return ZT(n,Ew(n.shape,t).newShape)}});const AA=DE({stack_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=FE(e,"tensors","stack","string_or_numeric");mw(n.length>=1,()=>"Pass at least one tensor to tf.stack"),n.length>0&&mw(t<=n[0].rank,()=>"Axis must be <= rank of the tensor");const r=n,a={axis:t};return kE.runKernel(ZS,r,a)}});const RA=DE({tanh_:function(e){const t={x:RE(e,"x","tanh","float32")};return kE.runKernel($N,t)}});function FA(e,t){vw(e);const n=TE(e,t);if(1!==n.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");return LE(e,null,n,t)}function DA(e,t,n){if(vw(e),null!=t&&2!==t.length)throw new Error("tensor2d() requires shape to have two numbers");const r=TE(e,n);if(2!==r.length&&1!==r.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return LE(e,t,r,n)}const OA=DE({truncatedNormal_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0;if(Ww(e),null!=r&&"bool"===r)throw new Error("Unsupported data type $ { dtype }");const i=new hA(t,n,r,!0,a),o=II(e,r);for(let s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}});const LA=DE({unstack_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=RE(e,"x","unstack","string_or_numeric");mw(t>=-n.shape.length&&t<n.shape.length,()=>"Axis = ".concat(t," is not in [-").concat(n.shape.length,", ").concat(n.shape.length,")"));const r={value:n},a={axis:t};return kE.runKernel(nC,r,a)}});const PA=DE({where_:function(e,t,n){const r=RE(t,"a","where"),a=RE(n,"b","where"),i=RE(e,"condition","where","bool"),o=tT(tT(i.shape,r.shape),a.shape),s={condition:o_(i,o),t:o_(r,o),e:o_(a,o)};return kE.runKernel(SN,s)}});const MA=DE({imag_:function(e){const t={input:RE(e,"input","imag")};return kE.runKernel(vS,t)}});const jA=DE({real_:function(e){const t={input:RE(e,"input","real")};return kE.runKernel(cN,t)}});const BA=DE({transpose_:function(e,t,n){const r=RE(e,"x","transpose");if(null==t&&(t=r.shape.map((e,t)=>t).reverse()),mw(r.rank===t.length,()=>"Error in transpose: rank of input ".concat(r.rank," ")+"must match length of perm ".concat(t,".")),t.forEach(e=>{mw(e>=0&&e<r.rank,()=>"All entries in 'perm' must be between 0 and ".concat(r.rank-1)+" but got ".concat(t))}),r.rank<=1)return r.clone();const a={x:r},i={perm:t};return"complex64"===r.dtype?zE(()=>{let e=jA(r),t=MA(r);return e=kE.runKernel(eC,{x:e},i),t=kE.runKernel(eC,{x:t},i),n&&(t=nA(t)),OE(e,t)}):kE.runKernel(eC,a,i)}});const zA=DE({dropout_:function(e,t,n,r){const a=RE(e,"x","dropout");if(mw("float32"===a.dtype,()=>"x has to be a floating point tensor since it's going to be "+"scaled, but got a ".concat(a.dtype," tensor instead.")),mw(t>=0&&t<1,()=>"rate must be a float in the range [0, 1), but got ".concat(t,".")),0===t)return e instanceof tE?a.clone():a;const i=function(e,t){if(null==t)return e.shape.slice();if(yw(e.shape,t))return t;if(e.shape.length===t.length){const n=[];for(let r=0;r<e.shape.length;r++)null==t[r]&&null!=e.shape[r]?n.push(e.shape[r]):n.push(t[r]);return n}return t}(a,n),o=1-t,s=DI(__(RI(pA(i,0,1,"float32",r),o)),o);return OI(a,s)}});const UA=DE({fft_:function(e){mw("complex64"===e.dtype,()=>"The dtype for tf.spectral.fft() must be complex64 "+"but got ".concat(e.dtype,"."));const t={input:e};return kE.runKernel(iS,t)}});const WA=DE({rfft_:function(e,t){mw("float32"===e.dtype,()=>"The dtype for rfft() must be real value but got ".concat(e.dtype));let n=e.shape[e.shape.length-1];const r=e.size/n;let a;if(null!=t&&t<n){const r=e.shape.map(e=>0),i=e.shape.map(e=>e);i[e.shape.length-1]=t,a=wA(e,r,i),n=t}else if(null!=t&&t>n){const r=e.shape.map(e=>e);r[e.shape.length-1]=t-n,a=c_([e,iA(r)],e.shape.length-1),n=t}else a=e;const i=MI(a),o=ZT(OE(a,i),[r,n]),s=UA(o),c=Math.floor(n/2)+1,l=jA(s),u=MA(s),h=TA(l,[c,n-c],l.shape.length-1),d=TA(u,[c,n-c],u.shape.length-1),f=a.shape.slice();return f[a.shape.length-1]=c,ZT(OE(h[0],d[0]),f)}});const VA=DE({ifft_:function(e){mw("complex64"===e.dtype,()=>"The dtype for tf.spectral.ifft() must be complex64 "+"but got ".concat(e.dtype,"."));const t={input:e};return kE.runKernel(gS,t)}});const HA=DE({irfft_:function(e){const t=e.shape[e.shape.length-1],n=e.size/t;let r;if(t<=2){const a=ZT(e,[n,t]);r=VA(a)}else{const a=[n,2*(t-1)],i=ZT(jA(e),[n,t]),o=ZT(MA(e),[n,t]),s=vA(wA(i,[0,1],[n,t-2]),1),c=OI(vA(wA(o,[0,1],[n,t-2]),1),BI(-1)),l=c_([i,s],1),u=c_([o,c],1),h=ZT(OE(l,u),[a[0],a[1]]);r=VA(h)}if(r=jA(r),3===e.rank&&0!==e.shape[0]){const t=r,n=e.shape[0];r=ZT(r,[n,r.shape[0]/n,r.shape[1]]),t.dispose()}return r}});const GA=DE({conv2DBackpropFilter_:function(e,t,n,r,a){let i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NHWC",o=arguments.length>6?arguments[6]:void 0,s=e;3===e.rank&&(s=ZT(e,[1,e.shape[0],e.shape[1],e.shape[2]]));let c=t;3===c.rank&&(c=ZT(t,[1,t.shape[0],t.shape[1],t.shape[2]])),mw(4===s.rank,()=>"Error in conv2dDerFilter: input must be rank 4, but got shape "+"".concat(s.shape,".")),mw(4===c.rank,()=>"Error in conv2dDerFilter: dy must be rank 4, but got shape "+"".concat(c.shape,".")),mw(4===n.length,()=>"Error in conv2dDerFilter: filterShape must be length 4, but got "+"".concat(n,"."));const l="NHWC"===i?s.shape[3]:s.shape[1],u="NHWC"===i?c.shape[3]:c.shape[1];mw(l===n[2],()=>"Error in conv2dDerFilter: depth of input ".concat(l,") must ")+"match input depth in filter (".concat(n[2],".")),mw(u===n[3],()=>"Error in conv2dDerFilter: depth of dy (".concat(u,") must ")+"match output depth for filter (".concat(n[3],").")),QT("conv2dDerFilter",a,o);const h={x:s,dy:c},d={strides:r,pad:a,dataFormat:i,dimRoundingMode:o,filterShape:n};return kE.runKernel(Ak,h,d)}});const qA=DE({relu6_:function(e){const t={x:RE(e,"x","relu6")};return kE.runKernel(gN,t)}});const KA=DE({step_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n={x:RE(e,"x","step")},r={alpha:t};return kE.runKernel(iC,n,r)}});function XA(e,t,n){if(null==n||"linear"===n)return e;if("relu"===n)return OI(e,KA(t));throw new Error("Cannot compute gradient for fused activation ".concat(n,"."))}function YA(e,t){let n=t;const r=eT(e.shape,t.shape);return r.length>0&&(n=M_(n,r)),ZT(n,e.shape)}function $A(e,t,n,r){if("linear"===t)return e;if("relu"===t)return gA(e);if("elu"===t)return k_(e);if("relu6"===t)return qA(e);if("prelu"===t)return lA(e,n);if("leakyrelu"===t)return D_(e,r);if("sigmoid"===t)return xA(e);throw new Error("Unknown fused activation ".concat(t,"."))}const JA=(e,t)=>!(e>0)||"linear"===t;const QA=DE({fusedConv2d_:function(e){let{x:t,filter:n,strides:r,pad:a,dataFormat:i="NHWC",dilations:o=[1,1],dimRoundingMode:s,bias:c,activation:l="linear",preluActivationWeights:u,leakyreluAlpha:h}=e;if(l=l||"linear",!1===JA(kE.state.gradientDepth,l)){mw("NHWC"===i,()=>"Error in fused conv2d: got dataFormat of ".concat(i," but ")+"only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear.");let e=f_(t,n,r,a,i,o,s);return null!=c&&(e=RI(e,c)),$A(e,l,u,h)}const d=RE(t,"x","conv2d","float32"),f=RE(n,"filter","conv2d","float32");let p=d,m=!1;3===d.rank&&(m=!0,p=ZT(d,[1,d.shape[0],d.shape[1],d.shape[2]])),mw(4===p.rank,()=>"Error in fused conv2d: input must be rank 4, but got rank "+"".concat(p.rank,".")),mw(4===f.rank,()=>"Error in fused conv2d: filter must be rank 4, but got rank "+"".concat(f.rank,".")),QT("fused conv2d",a,s);const g="NHWC"===i?p.shape[3]:p.shape[1];mw(f.shape[2]===g,()=>"Error in conv2d: depth of input (".concat(g,") must match ")+"input depth for filter ".concat(f.shape[2],".")),mw(YT(r,o),()=>"Error in conv2D: Either strides or dilations must be 1. "+"Got strides ".concat(r," and dilations '").concat(o,"'"));const v=UT(p.shape,f.shape,r,o,a,s);let b,y;if(null!=c&&(b=RE(c,"bias","fused conv2d"),[b]=pE(b,d),"NHWC"===i?tT(v.outShape,b.shape):(mw(b.shape.length<=1,()=>"Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of "+"rank-".concat(b.shape.length,".")),mw(0===b.shape.length||b.shape[0]===v.outChannels||1===b.shape[0],()=>"Error in fused conv2d: bias shape (".concat(b.shape,") is not ")+"compatible with the number of output channels "+"(".concat(v.outChannels,")")))),null!=u){const e=u.shape;if(mw(e.length<=1||3===e.length,()=>"Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of "+"rank-".concat(e.length,".")),1===e.length)mw(1===e[0]||e[0]===v.outChannels,()=>"Error in fused conv2d: PReLU activation weights "+"(".concat(e,") is not compatible with the number of output ")+"channels (".concat(v.outChannels,")."));else if(3===e.length)try{tT(e,v.outShape)}catch(_a){const n="Error in fused conv2d: PReLU activation weights (".concat(e,") ")+"is not compatible with the output shape of the conv2d "+"(".concat(v.outShape,").");throw Error(n)}y=RE(u,"prelu weights","fused conv2d")}const x=(e,t)=>{mw("NHWC"===i,()=>"Error in gradient of fused conv2D: got dataFormat of ".concat(i," but only NHWC is currently supported."));const[n,s,c,u]=t,h=XA(e,c,l);mw(XT(o),()=>"Error in gradient of fused conv2D: dilation rates greater than 1 "+"are not yet supported in gradients. Got dilations '".concat(o,"'"));const d=[m_(s.shape,h,n,r,a),GA(s,h,n.shape,r,a)];if(null!=u){const e=YA(u,h);d.push(e)}return d},w={x:p,filter:f,bias:b,preluActivationWeights:y},k={strides:r,pad:a,dataFormat:i,dilations:o,dimRoundingMode:s,activation:l,leakyreluAlpha:h};if(null==c){const e=jI((e,t,n)=>{let r=kE.runKernel(lC,w,k);return n([t,e,r]),m&&(r=ZT(r,[r.shape[1],r.shape[2],r.shape[3]])),{value:r,gradFunc:x}});return e(p,f)}{const e=jI((e,t,n,r)=>{let a=kE.runKernel(lC,w,k);return r([t,e,a,n]),m&&(a=ZT(a,[a.shape[1],a.shape[2],a.shape[3]])),{value:a,gradFunc:x}});return e(p,f,b)}}});const ZA=DE({depthwiseConv2dNativeBackpropFilter_:function(e,t,n,r,a){let i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],o=arguments.length>6?arguments[6]:void 0,s=e;3===e.rank&&(s=ZT(e,[1,e.shape[0],e.shape[1],e.shape[2]]));let c=t;3===c.rank&&(c=ZT(t,[1,t.shape[0],t.shape[1],t.shape[2]]));const l={x:s,dy:c},u={strides:r,pad:a,dimRoundingMode:o,dilations:i,filterShape:n};return kE.runKernel(Vk,l,u)}});const eR=DE({depthwiseConv2dNativeBackpropInput_:function(e,t,n,r,a){let i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],o=arguments.length>6?arguments[6]:void 0,s=t,c=!1;3===t.rank&&(c=!0,s=ZT(t,[1,t.shape[0],t.shape[1],t.shape[2]]));const l={dy:s,filter:n},u={strides:r,pad:a,dimRoundingMode:o,dilations:i,inputShape:e},h=kE.runKernel(Hk,l,u);return c?ZT(h,[h.shape[1],h.shape[2],h.shape[3]]):h}});const tR=DE({fusedMatMul_:function(e){let{a:t,b:n,transposeA:r=!1,transposeB:a=!1,bias:i,activation:o="linear",preluActivationWeights:s,leakyreluAlpha:c=.2}=e;if(!1===JA(kE.state.gradientDepth,o)){let e=Y_(t,n,r,a);return null!=i&&(e=RI(e,i)),$A(e,o,s,c)}let l=RE(t,"a","fused matMul"),u=RE(n,"b","fused matMul");[l,u]=pE(l,u);const h=r?l.shape[l.rank-2]:l.shape[l.rank-1],d=a?u.shape[u.rank-1]:u.shape[u.rank-2],f=r?l.shape[l.rank-1]:l.shape[l.rank-2],p=a?u.shape[u.rank-2]:u.shape[u.rank-1],m=l.shape.slice(0,-2),g=u.shape.slice(0,-2),v=bw(m),b=bw(g);mw(h===d,()=>"Error in fused matMul: inner shapes (".concat(h,") and (")+"".concat(d,") of Tensors with shapes ").concat(l.shape," and ")+"".concat(u.shape," and transposeA=").concat(r)+" and transposeB=".concat(a," must match."));const y=tT(l.shape.slice(0,-2),u.shape.slice(0,-2)).concat([f,p]),x=ZT(l,r?[v,h,f]:[v,f,h]),w=ZT(u,a?[b,p,d]:[b,d,p]);let k,S;null!=i&&(k=RE(i,"bias","fused matMul"),[k]=pE(k,l),tT(y,k.shape)),null!=s&&(S=RE(s,"prelu weights","fused matMul"));const N=(e,t)=>{const[n,s,c,l]=t,u=XA(ZT(e,c.shape),c,o);let h,d;if(r||a?!r&&a?(h=Y_(u,s,!1,!1),d=Y_(u,n,!0,!1)):r&&!a?(h=Y_(s,u,!1,!0),d=Y_(n,u,!1,!1)):(h=Y_(s,u,!0,!0),d=Y_(u,n,!0,!0)):(h=Y_(u,s,!1,!0),d=Y_(n,u,!0,!1)),null!=i){return[h,d,YA(l,u)]}return[h,d]},C={a:x,b:w,bias:k,preluActivationWeights:S},E={transposeA:r,transposeB:a,activation:o,leakyreluAlpha:c};if(null==i){const e=jI((e,t,n)=>{const r=kE.runKernel(cC,C,E);return n([e,t,r]),{value:ZT(r,y),gradFunc:N}});return e(x,w)}{const e=jI((e,t,n,r)=>{const a=kE.runKernel(cC,C,E);return r([e,t,a,n]),{value:ZT(a,y),gradFunc:N}});return e(x,w,k)}}});const nR=DE({cropAndResize_:function(e,t,n,r){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"bilinear",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;const o=RE(e,"image","cropAndResize"),s=RE(t,"boxes","cropAndResize","float32"),c=RE(n,"boxInd","cropAndResize","int32"),l=s.shape[0];mw(4===o.rank,()=>"Error in cropAndResize: image must be rank 4,"+"but got rank ".concat(o.rank,".")),mw(2===s.rank&&4===s.shape[1],()=>"Error in cropAndResize: boxes must be have size [".concat(l,",4] ")+"but had shape ".concat(s.shape,".")),mw(1===c.rank&&c.shape[0]===l,()=>"Error in cropAndResize: boxInd must be have size [".concat(l,"] ")+"but had shape ".concat(s.shape,".")),mw(2===r.length,()=>"Error in cropAndResize: cropSize must be of length 2, but got "+"length ".concat(r.length,".")),mw(r[0]>=1&&r[1]>=1,()=>"cropSize must be atleast [1,1], but was ".concat(r)),mw("bilinear"===a||"nearest"===a,()=>"method must be bilinear or nearest, but was ".concat(a));const u={image:o,boxes:s,boxInd:c},h={method:a,extrapolationValue:i,cropSize:r};return kE.runKernel(Bk,u,h)}});const rR=DE({flipLeftRight_:function(e){const t=RE(e,"image","flipLeftRight","float32");mw(4===t.rank,()=>"Error in flipLeftRight: image must be rank 4,"+"but got rank ".concat(t.rank,"."));const n={image:t};return kE.runKernel(sS,n,{})}});const aR=DE({grayscaleToRGB_:function(e){const t=RE(e,"image","grayscaleToRGB"),n=t.rank-1,r=t.shape[n];mw(t.rank>=2,()=>"Error in grayscaleToRGB: images must be at least rank 2, "+"but got rank ".concat(t.rank,".")),mw(1===r,()=>"Error in grayscaleToRGB: last dimension of a grayscale image "+"should be size 1, but got size ".concat(r,"."));const a=new Array(t.rank);return a.fill(1,0,n),a[n]=3,I_(t,a)}});const iR=DE({einsum_:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];const a=n.map((e,t)=>RE(e,"tensors".concat(t),"einsum")),i={equation:e};return kE.runKernel(Jk,a,i)}});const oR=DE({rgbToGrayscale_:function(e){const t=RE(e,"image","RGBToGrayscale"),n=t.rank-1,r=t.shape[n];mw(t.rank>=2,()=>"Error in RGBToGrayscale: images must be at least rank 2, "+"but got rank ".concat(t.rank,".")),mw(3===r,()=>"Error in RGBToGrayscale: last dimension of an RGB image "+"should be size 3, but got size ".concat(r,"."));const a=t.dtype,i=TI(t,"float32"),o=FA([.2989,.587,.114]);let s;switch(t.rank){case 2:s=iR("ij,j->i",i,o);break;case 3:s=iR("ijk,k->ij",i,o);break;case 4:s=iR("ijkl,l->ijk",i,o);break;case 5:s=iR("ijklm,m->ijkl",i,o);break;case 6:s=iR("ijklmn,n->ijklm",i,o);break;default:throw new Error("Not a valid tensor rank.")}return s=E_(s,-1),TI(s,a)}});const sR=DE({rotateWithOffset_:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5;const a=RE(e,"image","rotateWithOffset","float32");mw(4===a.rank,()=>"Error in rotateWithOffset: image must be rank 4,"+"but got rank ".concat(a.rank,"."));const i={image:a},o={radians:t,fillValue:n,center:r};return kE.runKernel(sC,i,o)}});function cR(e,t,n,r,a,i){null==r&&(r=.5),null==a&&(a=Number.NEGATIVE_INFINITY),null==i&&(i=0);const o=e.shape[0];return n=Math.min(n,o),mw(0<=r&&r<=1,()=>"iouThreshold must be in [0, 1], but was '".concat(r,"'")),mw(2===e.rank,()=>"boxes must be a 2D tensor, but was of rank '".concat(e.rank,"'")),mw(4===e.shape[1],()=>"boxes must have 4 columns, but 2nd dimension was ".concat(e.shape[1])),mw(1===t.rank,()=>"scores must be a 1D tensor"),mw(t.shape[0]===o,()=>"scores has incompatible shape with boxes. Expected ".concat(o,", ")+"but was ".concat(t.shape[0])),mw(0<=i&&i<=1,()=>"softNmsSigma must be in [0, 1], but was '".concat(i,"'")),{maxOutputSize:n,iouThreshold:r,scoreThreshold:a,softNmsSigma:i}}const lR=DE({nonMaxSuppression_:function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Number.NEGATIVE_INFINITY;const i=RE(e,"boxes","nonMaxSuppression","float32"),o=RE(t,"scores","nonMaxSuppression","float32"),s=cR(i,o,n,r,a);n=s.maxOutputSize,r=s.iouThreshold,a=s.scoreThreshold;const c={maxOutputSize:n,iouThreshold:r,scoreThreshold:a};return kE.runKernel(XS,{boxes:i,scores:o},c)}});function uR(e,t,n){const r=function(e,t,n){return function(e,t,n){let r=0,a=e.length,i=0,o=!1;for(;r<a;){i=r+(a-r>>>1);const s=n(t,e[i]);s>0?r=i+1:(a=i,o=!s)}return o?r:-r-1}(e,t,n||hR)}(e,t,n),a=r<0?-(r+1):r;e.splice(a,0,t)}function hR(e,t){return e>t?1:e<t?-1:0}function dR(e,t,n,r,a){return mR(e,t,n,r,a,0)}function fR(e,t,n,r,a,i){return mR(e,t,n,r,a,0,!1,i,!0)}function pR(e,t,n,r,a,i){return mR(e,t,n,r,a,i,!0)}function mR(e,t,n,r,a,i){let o=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=arguments.length>7&&void 0!==arguments[7]&&arguments[7],c=arguments.length>8&&void 0!==arguments[8]&&arguments[8];const l=[];for(let g=0;g<t.length;g++)t[g]>a&&l.push({score:t[g],boxIndex:g,suppressBeginIndex:0});l.sort(bR);const u=i>0?-.5/i:0,h=[],d=[];for(;h.length<n&&l.length>0;){const t=l.pop(),{score:n,boxIndex:i,suppressBeginIndex:o}=t;if(n<a)break;let s=!1;for(let c=h.length-1;c>=o;--c){const n=gR(e,i,h[c]);if(n>=r){s=!0;break}if(t.score=t.score*vR(r,u,n),t.score<=a)break}t.suppressBeginIndex=h.length,s||(t.score===n?(h.push(i),d.push(t.score)):t.score>a&&uR(l,t,bR))}const f=h.length,p=n-f;s&&p>0&&(h.push(...new Array(p).fill(0)),d.push(...new Array(p).fill(0)));const m={selectedIndices:h};return o&&(m.selectedScores=d),c&&(m.validOutputs=f),m}function gR(e,t,n){const r=e.subarray(4*t,4*t+4),a=e.subarray(4*n,4*n+4),i=Math.min(r[0],r[2]),o=Math.min(r[1],r[3]),s=Math.max(r[0],r[2]),c=Math.max(r[1],r[3]),l=Math.min(a[0],a[2]),u=Math.min(a[1],a[3]),h=Math.max(a[0],a[2]),d=Math.max(a[1],a[3]),f=(s-i)*(c-o),p=(h-l)*(d-u);if(f<=0||p<=0)return 0;const m=Math.max(i,l),g=Math.max(o,u),v=Math.min(s,h),b=Math.min(c,d),y=Math.max(v-m,0)*Math.max(b-g,0);return y/(f+p-y)}function vR(e,t,n){const r=Math.exp(t*n*n);return n<=e?r:0}function bR(e,t){return e.score-t.score||e.score===t.score&&t.boxIndex-e.boxIndex}const yR=async function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Number.NEGATIVE_INFINITY;const i=RE(e,"boxes","nonMaxSuppressionAsync"),o=RE(t,"scores","nonMaxSuppressionAsync"),s=cR(i,o,n,r,a);n=s.maxOutputSize,r=s.iouThreshold,a=s.scoreThreshold;const c=await Promise.all([i.data(),o.data()]),l=c[0],u=c[1],{selectedIndices:h}=dR(l,u,n,r,a);return i!==e&&i.dispose(),o!==t&&o.dispose(),FA(h,"int32")};const xR=DE({nonMaxSuppressionWithScore_:function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Number.NEGATIVE_INFINITY,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;const o=RE(e,"boxes","nonMaxSuppression"),s=RE(t,"scores","nonMaxSuppression"),c=cR(o,s,n,r,a,i);n=c.maxOutputSize,r=c.iouThreshold,a=c.scoreThreshold,i=c.softNmsSigma;const l={boxes:o,scores:s},u={maxOutputSize:n,iouThreshold:r,scoreThreshold:a,softNmsSigma:i},h=kE.runKernel($S,l,u);return{selectedIndices:h[0],selectedScores:h[1]}}});const wR=async function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Number.NEGATIVE_INFINITY,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;const o=RE(e,"boxes","nonMaxSuppressionAsync"),s=RE(t,"scores","nonMaxSuppressionAsync"),c=cR(o,s,n,r,a,i);n=c.maxOutputSize,r=c.iouThreshold,a=c.scoreThreshold,i=c.softNmsSigma;const l=await Promise.all([o.data(),s.data()]),u=l[0],h=l[1],{selectedIndices:d,selectedScores:f}=pR(u,h,n,r,a,i);return o!==e&&o.dispose(),s!==t&&s.dispose(),{selectedIndices:FA(d,"int32"),selectedScores:FA(f)}};const kR=DE({nonMaxSuppressionPadded_:function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Number.NEGATIVE_INFINITY,i=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const o=RE(e,"boxes","nonMaxSuppression"),s=RE(t,"scores","nonMaxSuppression"),c=cR(o,s,n,r,a,null),l={boxes:o,scores:s},u={maxOutputSize:c.maxOutputSize,iouThreshold:c.iouThreshold,scoreThreshold:c.scoreThreshold,padToMaxOutputSize:i},h=kE.runKernel(YS,l,u);return{selectedIndices:h[0],validOutputs:h[1]}}});const SR=async function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Number.NEGATIVE_INFINITY,i=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const o=RE(e,"boxes","nonMaxSuppressionAsync"),s=RE(t,"scores","nonMaxSuppressionAsync"),c=cR(o,s,n,r,a,null),l=c.maxOutputSize,u=c.iouThreshold,h=c.scoreThreshold,[d,f]=await Promise.all([o.data(),s.data()]),{selectedIndices:p,validOutputs:m}=fR(d,f,l,u,h,i);return o!==e&&o.dispose(),s!==t&&s.dispose(),{selectedIndices:FA(p,"int32"),validOutputs:BI(m,"int32")}};const NR=DE({resizeBilinear_:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const a=RE(e,"images","resizeBilinear");mw(3===a.rank||4===a.rank,()=>"Error in resizeBilinear: x must be rank 3 or 4, but got "+"rank ".concat(a.rank,".")),mw(2===t.length,()=>"Error in resizeBilinear: new shape must 2D, but got shape "+"".concat(t,".")),mw(!1===r||!1===n,()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false.");let i=a,o=!1;3===a.rank&&(o=!0,i=ZT(a,[1,a.shape[0],a.shape[1],a.shape[2]]));const[]=t,s={images:i},c={alignCorners:n,halfPixelCenters:r,size:t},l=kE.runKernel(pN,s,c);return o?ZT(l,[l.shape[1],l.shape[2],l.shape[3]]):l}});const CR=DE({resizeNearestNeighbor_:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const a=RE(e,"images","resizeNearestNeighbor");mw(3===a.rank||4===a.rank,()=>"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got "+"rank ".concat(a.rank,".")),mw(2===t.length,()=>"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+"".concat(t,".")),mw("float32"===a.dtype||"int32"===a.dtype,()=>"`images` must have `int32` or `float32` as dtype"),mw(!1===r||!1===n,()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false.");let i=a,o=!1;3===a.rank&&(o=!0,i=ZT(a,[1,a.shape[0],a.shape[1],a.shape[2]]));const[]=t,s={images:i},c={alignCorners:n,halfPixelCenters:r,size:t},l=kE.runKernel(dN,s,c);return o?ZT(l,[l.shape[1],l.shape[2],l.shape[3]]):l}});const ER=DE({bincount_:function(e,t,n){const r=RE(e,"x","bincount"),a=RE(t,"weights","bincount");mw("int32"===r.dtype,()=>"Error in bincount: input "+"dtype must be int32, but got ".concat(r.dtype)),mw(n>=0,()=>"size must be non-negative, but got ".concat(n,".")),mw(a.size===r.size||0===a.size,()=>"Error in bincount: weights must have the same size as input or"+"0-length, but got input shape: ".concat(r.shape,", weights shape: ")+"".concat(a.shape,"."));const i={x:r,weights:a},o={size:n};return kE.runKernel(xk,i,o)}});const IR=DE({lessEqual_:function(e,t){let n=RE(e,"a","lessEqual","string_or_numeric"),r=RE(t,"b","lessEqual","string_or_numeric");[n,r]=pE(n,r),tT(n.shape,r.shape);const a={a:n,b:r};return kE.runKernel(SS,a)}});const TR=DE({round_:function(e){const t={x:RE(e,"x","round")};return kE.runKernel(bN,t)}});const _R=DE({threshold_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"binary",n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5;const a=RE(e,"image","threshold"),i=a.shape[0]*a.shape[1];let o,s,c,l,u=OI(FA([r]),255);if(mw(3===a.rank,()=>"Error in threshold: image must be rank 3,"+"but got rank ".concat(a.rank,".")),mw(3===a.shape[2]||1===a.shape[2],()=>"Error in threshold: image color channel must be equal to 3 or 1"+"but got ".concat(a.shape[2],".")),mw("int32"===a.dtype||"float32"===a.dtype,()=>"Error in dtype: image dtype must be int32 or float32,"+"but got dtype ".concat(a.dtype,".")),mw("otsu"===t||"binary"===t,()=>"Method must be binary or otsu, but was ".concat(t)),3===a.shape[2]){[o,s,c]=TA(a,[1,1,1],-1);const e=OI(o,.2989),t=OI(s,.587),n=OI(c,.114);l=RI(RI(e,t),n)}else l=e;if("otsu"===t){u=function(e,t){let n,r,a,i,o,s,c=FA([-1]),l=FA([0]),u=FA([0]);for(let h=0;h<e.size-1;h++){n=wA(e,0,h+1),r=wA(e,h+1),o=DI(M_(n),t),s=DI(M_(r),t);const d=M_(OI(n,mA(0,n.size)));a=DI(d,M_(n));const f=KI(r.shape,n.size),p=RI(mA(0,r.size),f),m=OI(r,p);i=DI(M_(m),M_(r));const g=$I(a,i),v=$I(a,i),b=OI(o,s);u=OI(OI(b,g),v);const y=R_(u,l);l=PA(y,u,l),c=PA(y,FA([h]),c)}return c}(ER(TI(TR(l),"int32"),PE([]),256),i)}const h=n?IR(l,u):R_(l,u);return TI(OI(h,255),"int32")}});const AR=DE({transform_:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"nearest",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"constant",a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=arguments.length>5?arguments[5]:void 0;const o=RE(e,"image","transform","float32"),s=RE(t,"transforms","transform","float32");mw(4===o.rank,()=>"Error in transform: image must be rank 4,"+"but got rank ".concat(o.rank,".")),mw(2===s.rank&&(s.shape[0]===o.shape[0]||1===s.shape[0])&&8===s.shape[1],()=>"Error in transform: Input transform should be batch x 8 or 1 x 8"),mw(null==i||2===i.length,()=>"Error in transform: outputShape must be [height, width] or null, "+"but got ".concat(i,"."));const c={image:o,transforms:s},l={interpolation:n,fillMode:r,fillValue:a,outputShape:i};return kE.runKernel(ZN,c,l)}});const RR=DE({less_:function(e,t){let n=RE(e,"a","less","string_or_numeric"),r=RE(t,"b","less","string_or_numeric");[n,r]=pE(n,r),tT(n.shape,r.shape);const a={a:n,b:r};return kE.runKernel(kS,a)}});const FR=DE({bandPart_:function(e,t,n){const r=RE(e,"a","bandPart");mw(r.rank>=2,()=>"bandPart(): Rank must be at least 2, got ".concat(r.rank,"."));const a=r.shape,[i,o]=r.shape.slice(-2);let s,c;"number"===typeof t?(mw(t%1===0,()=>"bandPart(): numLower must be an integer, got ".concat(t,".")),mw(t<=i,()=>"bandPart(): numLower (".concat(t,")")+" must not be greater than the number of rows (".concat(i,").")),s=RE(t<0?i:t,"numLower","bandPart")):(mw("int32"===t.dtype,()=>"bandPart(): numLower's dtype must be an int32."),s=PA(RR(t,0),i,eA(t,i))),"number"===typeof n?(mw(n%1===0,()=>"bandPart(): numUpper must be an integer, got ".concat(n,".")),mw(n<=o,()=>"bandPart(): numUpper (".concat(n,")")+" must not be greater than the number of columns (".concat(o,").")),c=RE(n<0?o:n,"numUpper","bandPart")):(mw("int32"===n.dtype,()=>"bandPart(): numUpper's dtype must be an int32."),c=PA(RR(n,0),o,eA(n,o)));const l=ZT(mA(0,i,1,"int32"),[-1,1]),u=mA(0,o,1,"int32"),h=$I(l,u),d=X_(IR(h,s),F_(h,nA(c))),f=iA([i,o],r.dtype);return ZT(AA(LA(ZT(r,[-1,i,o])).map(e=>PA(d,e,f))),a)}});function DR(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(0===e.rank)return QI(e);if(1!==e.rank&&null===n)return DR(ZT(e,[-1]),t,n);if(1===e.rank||"number"===typeof n||Array.isArray(n)&&1===n.length){if(1===t)return M_(QI(e),n);if(t===1/0)return P_(QI(e),n);if(t===-1/0)return Z_(QI(e),n);if("euclidean"===t||2===t)return LI(M_(YI(QI(e),BI(2,"int32")),n));throw new Error("Error in norm: invalid ord value: ".concat(t))}if(Array.isArray(n)&&2===n.length){if(1===t)return P_(M_(QI(e),n[0]),n[1]-1);if(t===1/0)return P_(M_(QI(e),n[1]),n[0]);if(t===-1/0)return Z_(M_(QI(e),n[1]),n[0]);if("fro"===t||"euclidean"===t)return LI(M_(PI(e),n));throw new Error("Error in norm: invalid ord value: ".concat(t))}throw new Error("Error in norm: invalid axis: ".concat(n))}const OR=DE({norm_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"euclidean",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const a=DR(e=RE(e,"x","norm"),t,n);let i=a.shape;if(r){const t=Cw(n,e.shape);i=W_(a.shape,t)}return ZT(a,i)}});const LR=DE({gramSchmidt_:function(e){let t;if(Array.isArray(e)){t=!1,mw(null!=e&&e.length>0,()=>"Gram-Schmidt process: input must not be null, undefined, or empty");const n=e[0].shape[0];for(let t=1;t<e.length;++t)mw(e[t].shape[0]===n,()=>"Gram-Schmidt: Non-unique lengths found in the input vectors: "+"(".concat(e[t].shape[0]," vs. ").concat(n,")"))}else t=!0,e=TA(e,e.shape[0],0).map(e=>_A(e,[0]));mw(e.length<=e[0].shape[0],()=>"Gram-Schmidt: Number of vectors (".concat(e.length,") exceeds ")+"number of dimensions (".concat(e[0].shape[0],")."));const n=[],r=e;for(let a=0;a<e.length;++a)n.push(kE.tidy(()=>{let e=r[a];if(a>0)for(let t=0;t<a;++t){const r=OI(M_(OI(n[t],e)),n[t]);e=$I(e,r)}return DI(e,OR(e,"euclidean"))}));return t?AA(n,0):n}});function PR(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return kE.tidy(()=>{mw(2===e.shape.length,()=>"qr2d() requires a 2D Tensor, but got a ".concat(e.shape.length,"D Tensor."));const n=e.shape[0],r=e.shape[1];let a=T_(n),i=_I(e);const o=DA([[1]],[1,1]);let s=_I(o);const c=n>=r?r:n;for(let e=0;e<c;++e){const t=i,c=s,l=a;[s,i,a]=kE.tidy(()=>{const t=wA(i,[e,e],[n-e,1]),c=OR(t),l=wA(i,[e,e],[1,1]),u=PA(R_(l,0),DA([[-1]]),DA([[1]])),h=$I(l,OI(u,c)),d=DI(t,h);s=1===d.shape[0]?_I(o):c_([o,wA(d,[1,0],[d.shape[0]-1,d.shape[1]])],0);const f=nA(DI(Y_(u,h),c)),p=wA(i,[e,0],[n-e,r]),m=OI(f,s),g=BA(s);if(0===e)i=$I(p,Y_(m,Y_(g,p)));else{const t=$I(p,Y_(m,Y_(g,p)));i=c_([wA(i,[0,0],[e,r]),t],0)}const v=BA(m),b=wA(a,[0,e],[n,a.shape[1]-e]);if(0===e)a=$I(b,Y_(Y_(b,s),v));else{const t=$I(b,Y_(Y_(b,s),v));a=c_([wA(a,[0,0],[n,e]),t],1)}return[s,i,a]}),UE([t,c,l])}return!t&&n>r&&(a=wA(a,[0,0],[n,r]),i=wA(i,[0,0],[r,r])),[a,i]})}const MR=DE({qr_:function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(mw(e.rank>=2,()=>"qr() requires input tensor to have a rank >= 2, but got rank ".concat(e.rank)),2===e.rank)return PR(e,t);{const n=e.shape.slice(0,e.shape.length-2).reduce((e,t)=>e*t),r=LA(ZT(e,[n,e.shape[e.shape.length-2],e.shape[e.shape.length-1]]),0),a=[],i=[];r.forEach(e=>{const[n,r]=PR(e,t);a.push(n),i.push(r)});return[ZT(AA(a,0),e.shape),ZT(AA(i,0),e.shape)]}}});var jR;!function(e){e[e.NONE=0]="NONE",e[e.MEAN=1]="MEAN",e[e.SUM=2]="SUM",e[e.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"}(jR||(jR={}));const BR=DE({squaredDifference_:function(e,t){let n=RE(e,"a","squaredDifference"),r=RE(t,"b","squaredDifference");[n,r]=pE(n,r),tT(n.shape,r.shape);const a={a:n,b:r};return kE.runKernel(UN,a,{})}});const zR={flipLeftRight:rR,grayscaleToRGB:aR,resizeNearestNeighbor:CR,resizeBilinear:NR,rgbToGrayscale:oR,rotateWithOffset:sR,cropAndResize:nR,nonMaxSuppression:lR,nonMaxSuppressionAsync:yR,nonMaxSuppressionWithScore:xR,nonMaxSuppressionWithScoreAsync:wR,nonMaxSuppressionPadded:kR,nonMaxSuppressionPaddedAsync:SR,threshold:_R,transform:AR},UR={bandPart:FR,gramSchmidt:LR,qr:MR};const WR=class{static sgd(e){return new aT(e)}static momentum(e,t){return new iT(e,t,arguments.length>2&&void 0!==arguments[2]&&arguments[2])}static rmsprop(e){return new oT(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:.9,arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}static adam(){return new JI(arguments.length>0&&void 0!==arguments[0]?arguments[0]:.001,arguments.length>1&&void 0!==arguments[1]?arguments[1]:.9,arguments.length>2&&void 0!==arguments[2]?arguments[2]:.999,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}static adadelta(){return new qI(arguments.length>0&&void 0!==arguments[0]?arguments[0]:.001,arguments.length>1&&void 0!==arguments[1]?arguments[1]:.95,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}static adamax(){return new rT(arguments.length>0&&void 0!==arguments[0]?arguments[0]:.002,arguments.length>1&&void 0!==arguments[1]?arguments[1]:.9,arguments.length>2&&void 0!==arguments[2]?arguments[2]:.999,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,arguments.length>4&&void 0!==arguments[4]?arguments[4]:0)}static adagrad(e){return new XI(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:.1)}},VR="undefined"!==typeof requestAnimationFrame?requestAnimationFrame:"undefined"!==typeof setImmediate?setImmediate:e=>e();function HR(){return new Promise(e=>VR(()=>e()))}function GR(e,t){const n=e[0].length;e.forEach((e,t)=>{mw(e.length===n,()=>"Error in concat".concat(n,"D: rank of tensors[").concat(t,"] must be the same ")+"as the rank of the rest (".concat(n,")"))}),mw(t>=0&&t<n,()=>"Error in concat".concat(n,"D: axis must be between 0 and ").concat(n-1,"."));const r=e[0];e.forEach((e,a)=>{for(let i=0;i<n;i++)mw(i===t||e[i]===r[i],()=>"Error in concat".concat(n,"D: Shape of tensors[").concat(a,"] (").concat(e,") ")+"does not match the shape of the rest (".concat(r,") ")+"along the non-concatenated axis ".concat(a,"."))})}function qR(e,t){const n=e[0].slice();for(let r=1;r<e.length;r++)n[t]+=e[r][t];return n}var KR;function XR(e,t,n){let r=new Array;if(null==n&&null==t)return r;if(null==t)for(;r.length<e+n.length;)r.push(-1);else r=t.slice();if(null==n)return r;if(e+n.length!==r.length)throw new Error("rt input.shape and shape=".concat(t," are incompatible: rt input.rank = ").concat(e+n.length,", but shape.rank = ").concat(r.length));for(let a=1;a<n.length;++a){const i=n[a],o=r[r.length-n.length+a],s=r[o];if(i>=0)if(s>=0){if(s!==i)throw new Error("rt input.shape and shape=".concat(t," are incompatible: rt input.shape[").concat(a+e,"] = ").concat(i," but shape[").concat(a+e,"] = ").concat(s))}else r[o]=i}return r}function YR(e){const t={FIRST_DIM_SIZE:KR.FIRST_DIM_SIZE,VALUE_ROWIDS:KR.VALUE_ROWIDS,ROW_LENGTHS:KR.ROW_LENGTHS,ROW_SPLITS:KR.ROW_SPLITS,ROW_LIMITS:KR.ROW_LIMITS,ROW_STARTS:KR.ROW_STARTS},n=[];for(const r of e){if(!(r in t))break;n.push(t[r])}return n}function $R(e){return 0===e.length?0:e[0]===KR.FIRST_DIM_SIZE?e.length-1:e.length}function JR(e,t){if(null==e||null==t)return;const n=e.length,r=t.length;if(n>=r)throw new Error("defaultValue.shape=".concat(e," and ragged tensor flatValues.shape=").concat(t,", are incompatible: defaultValue.rank = ").concat(n," must be less than ragged tensor input flatValues.rank = ").concat(r,")"));for(let a=0;a<Math.min(n,r-1);++a){const n=e[a],r=t[a+1];if(n>=0&&r>=0&&1!==n&&n!==r)throw new Error("defaultValue.shape=".concat(e,", and ragged tensor input flatValues.shape=").concat(t," are incompatible: defaultValue.shape[").concat(a-e.length,"] = ").concat(n," but ragged tensor input.flatValues.shape[").concat(a-e.length,"] = ").concat(r))}}!function(e){e[e.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",e[e.VALUE_ROWIDS=1]="VALUE_ROWIDS",e[e.ROW_LENGTHS=2]="ROW_LENGTHS",e[e.ROW_SPLITS=3]="ROW_SPLITS",e[e.ROW_LIMITS=4]="ROW_LIMITS",e[e.ROW_STARTS=5]="ROW_STARTS"}(KR||(KR={}));const QR=30;function ZR(e){return e<=QR?e:Lw(e,Math.floor(Math.sqrt(e)))}function eF(e,t,n){return[n*("number"===typeof e?e:e[0]),t*("number"===typeof e?e:e[1])]}function tF(e,t,n){let r=[];if(!(arguments.length>3&&void 0!==arguments[3])||arguments[3])r=r.concat(t.slice(0)),r.push(e[0]/n),r=r.concat(e.slice(1));else{r=r.concat(e[0]);const n=t.length;for(let a=0;a<n;++a)r=r.concat([e[a+1]/t[a],t[a]]);r=r.concat(e.slice(n+1))}return r}function nF(e,t){const n=[];if(!(arguments.length>2&&void 0!==arguments[2])||arguments[2]){n.push(t);for(let r=t+1;r<e;++r)r<=2*t?(n.push(r),n.push(r-(t+1))):n.push(r)}else{const r=[],a=[];for(let n=1;n<e;++n)n>=2*t+1||n%2===1?a.push(n):r.push(n);n.push(...r),n.push(0),n.push(...a)}return n}function rF(e,t,n){let r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const a=[];r?a.push(e[0]/n):a.push(e[0]*n);for(let i=1;i<e.length;++i)i<=t.length?r?a.push(t[i-1]*e[i]):a.push(e[i]/t[i-1]):a.push(e[i]);return a}function aF(e,t){const n=[0];for(let r=0;r<t;++r)n.push(e[r][0]);return n}function iF(e,t,n){const r=e.slice(0,1);for(let a=0;a<n;++a)r.push(e[a+1]-t[a][0]-t[a][1]);return r}function oF(e,t){const n=e.shape.length,r=t.shape.length;if(n<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher,"+" but the rank was ".concat(n,"."));if(r<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher,"+" but the rank was ".concat(r,"."));if("int32"!==t.dtype)throw new Error("tf.gatherND() expects the indices to be int32 type,"+" but the dtype was ".concat(t.dtype,"."));if(t.shape[r-1]>n)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+"".concat(t.shape[r-1]," vs. ").concat(n));if(0===bw(e.shape))throw new Error("Requested more than 0 entries, but input is empty."+" Input shape: ".concat(e.shape,"."));const a=t.shape,i=a[a.length-1];let o=1;for(let h=0;h<a.length-1;++h)o*=a[h];const s=e.shape,c=a.slice();c.pop();let l=1;for(let h=i;h<n;++h)l*=s[h],c.push(s[h]);const u=[...Pw(e.shape).map(e=>e/l),1].slice(0,i);return[c,o,l,u]}function sF(e,t,n){const r=t.rank>1?t.shape[t.rank-1]:1,a=t.rank>1?t.rank-1:1,i="Must have updates.shape = indices.shape[:batchDim] + "+"shape[sliceDim:], got updates.shape: ".concat(n.shape)+", indices.shape: ".concat(t.shape,", shape: ").concat(e)+", sliceDim: ".concat(r,", and batchDim: ").concat(a,".");if(n.rank<a)throw new Error(i+" update.rank < ".concat(a,". "));if(e.length<r+(n.rank-a))throw new Error(i+" Output shape length < ".concat(r+(n.rank-a)));if(n.rank!==a+e.length-r)throw new Error(i+" update.rank != ".concat(a+e.length-r));for(let o=0;o<a;++o)if(n.shape[o]!==t.shape[o])throw new Error(i+" updates.shape[".concat(o,"] (").concat(n.shape[o],") != indices.shape[").concat(o,"] (").concat(t.shape[o],")."));for(let o=0;o<n.rank-a;++o)if(n.shape[o+a]!==e[o+r])throw new Error(i+" updates.shape[".concat(o+a,"] (").concat(n.shape[o+a],") != shape[").concat(o+a,"] (").concat(e[o+a],")"))}function cF(e,t,n){if(t.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher,"+" but the rank was ".concat(t.rank,"."));if(e.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher,"+" but the rank was ".concat(e.rank,"."));if("int32"!==t.dtype)throw new Error("The dtype of 'indices' should be int32, but got dtype: ".concat(t.dtype));if(n.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: ".concat(n));if(0===n.length){if(0===t.size)throw new Error("Indices specified for empty output. indices shape: ".concat(t.shape));if(0===e.size)throw new Error("Updates specified for empty output. updates shape: ".concat(e.shape))}sF(n,t,e)}function lF(e,t,n){const r=t.shape.length,a=r>1?t.shape[r-1]:1,i=n.length;let o=1;for(let c=a;c<i;++c)o*=n[c];const s=a<1?1:a;return{sliceRank:a,numUpdates:bw(t.shape)/s,sliceSize:o,strides:[...Pw(n.slice(0,a)),1],outputSize:bw(n)}}const uF=1.7580993408473768,hF=1.0507009873554805,dF=.3275911,fF=.254829592,pF=-.284496736,mF=1.421413741,gF=-1.453152027,vF=1.061405429;function bF(e,t){if(e.length!==t.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+"".concat(e.length,", imag: ").concat(t.length,"."));const n=new Float32Array(2*e.length);for(let r=0;r<n.length;r+=2)n[r]=e[r/2],n[r+1]=t[r/2];return n}function yF(e){const t=new Float32Array(e.length/2),n=new Float32Array(e.length/2);for(let r=0;r<e.length;r+=2)t[r/2]=e[r],n[r/2]=e[r+1];return{real:t,imag:n}}function xF(e){const t=Math.ceil(e.length/4),n=new Float32Array(t),r=new Float32Array(t);for(let a=0;a<e.length;a+=4)n[Math.floor(a/4)]=e[a],r[Math.floor(a/4)]=e[a+1];return{real:n,imag:r}}function wF(e){const t=Math.floor(e.length/4),n=new Float32Array(t),r=new Float32Array(t);for(let a=2;a<e.length;a+=4)n[Math.floor(a/4)]=e[a],r[Math.floor(a/4)]=e[a+1];return{real:n,imag:r}}function kF(e,t){return{real:e[2*t],imag:e[2*t+1]}}function SF(e,t,n,r){e[2*r]=t,e[2*r+1]=n}function NF(e,t){const n=new Float32Array(e/2),r=new Float32Array(e/2);for(let a=0;a<Math.ceil(e/2);a++){const i=(t?2:-2)*Math.PI*(a/e);n[a]=Math.cos(i),r[a]=Math.sin(i)}return{real:n,imag:r}}function CF(e,t,n){const r=(n?2:-2)*Math.PI*(e/t);return{real:Math.cos(r),imag:Math.sin(r)}}const EF="->",IF=/->/g,TF=",",_F="...";function AF(e,t){const n=((e=e.replace(/\s/g,"")).length-e.replace(IF,"").length)/EF.length;if(n<1)throw new Error("Equations without an arrow are not supported.");if(n>1)throw new Error('Equation must contain exactly one arrow ("'.concat(EF,'").'));const[r,a]=e.split(EF);mw(-1===r.indexOf(_F),()=>'The ellipsis notation ("'.concat(_F,'") is not supported yet.'));const i=r.split(TF),o=i.length;if(t!==o)throw new Error("Expected ".concat(o," input tensors, received ").concat(t));if(o>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");const s=[];for(let h=0;h<a.length;++h){const e=a[h];if(!i.some(t=>-1!==t.indexOf(e)))throw new Error("Output subscripts contain the label ".concat(e," ")+"not present in the input subscripts.");-1===s.indexOf(e)&&s.push(e)}for(let h=0;h<r.length;++h){const e=r[h];-1===s.indexOf(e)&&e!==TF&&s.push(e)}const c=new Array(i.length);for(let h=0;h<o;++h){if(new Set(i[h].split("")).size!==i[h].length)throw new Error("Found duplicate axes in input component ".concat(i[h],". ")+"Support for duplicate axes in input is not implemented yet.");c[h]=[];for(let e=0;e<i[h].length;++e)c[h].push(s.indexOf(i[h][e]))}const l=s.length,u=[];for(let h=a.length;h<l;++h)u.push(h);return{allDims:s,summedDims:u,idDims:c}}function RF(e,t){let n=new Array(e);n.fill(-1);for(let a=0;a<t.length;++a)n[t[a]]=a;const r=[];for(let a=0;a<e;++a)-1===n[a]&&r.push(a);return n=n.filter(e=>-1!==e),{permutationIndices:n,expandDims:r}}function FF(e,t,n){const r=new Array(e);for(let a=0;a<n.length;++a){const e=n[a].shape;for(let n=0;n<t[a].length;++n)void 0===r[t[a][n]]?r[t[a][n]]=e[n]:mw(r[t[a][n]]===e[n],()=>"Expected dimension ".concat(r[t[a][n]]," at axis ").concat(n," ")+"of input shaped ".concat(JSON.stringify(e),", ")+"but got dimension ".concat(e[n]))}}function DF(e,t){const n=e,r=[];let a=0;0===e.length&&n.push(-1),a=e.length+1;for(let o=0;o<a;++o)r.push([]);const i=[];for(let o=0;o<n.length;++o){const e=LF(t,n[o]);for(const t of e)-1===i.indexOf(t)&&(r[o].push(t),i.push(t))}return{path:n,steps:r}}function OF(e){return e.every((e,t)=>e===t)}function LF(e,t){const n=[];for(let r=0;r<e.length;++r)0!==e[r].length&&-1===e[r].indexOf(t)&&-1!==t||n.push(r);return n}function PF(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=[];if("number"===typeof t)mw(e.shape[n]%t===0,()=>"Number of splits must evenly divide the axis."),r=new Array(t).fill(e.shape[n]/t);else{const a=t.reduce((e,t)=>(-1===t&&(e+=1),e),0);mw(a<=1,()=>"There should be only one negative value in split array.");const i=t.indexOf(-1);if(-1!==i){const r=t.reduce((e,t)=>t>0?e+t:e);t[i]=e.shape[n]-r}mw(e.shape[n]===t.reduce((e,t)=>e+t),()=>"The sum of sizes must match the size of the axis dimension."),r=t}return r}function MF(e){return"Received SparseTensor with denseShape[0] = 0 but\n  indices.shape[0] = ".concat(e)}function jF(e,t){return"indices(".concat(e,", 0) is invalid: ").concat(t," < 0")}function BF(e,t,n){return"indices(".concat(e,", 0) is invalid: ").concat(t," >= ").concat(n)}function zF(e,t){return"only one output dimension may be -1, not both ".concat(e," and ").concat(t)}function UF(e,t){return"size ".concat(e," must be non-negative, not ").concat(t)}function WF(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"}function VF(e,t){const n=bw(e),r=bw(t);return"Input to reshape is a SparseTensor with ".concat(n,"\n  dense values, but the requested shape requires a multiple of ").concat(r,". inputShape=").concat(e," outputShape= ").concat(t)}function HF(e,t){const n=bw(e),r=bw(t);return"Input to reshape is a tensor with ".concat(n," dense values, but the requested shape has ").concat(r,". inputShape=").concat(e," outputShape=").concat(t)}function GF(){return"segment ids must be >= 0"}function qF(){return"segment ids are not increasing"}function KF(e,t){return"Segment id ".concat(e," out of range [0, ").concat(t,"), possibly because segmentIds input is not sorted.")}function XF(e,t,n){return"Bad: indices[".concat(e,"] == ").concat(t," out of range [0, ").concat(n,")")}function YF(e,t){let n,r=!1;for(e<=QR?(n=e,r=!0):n=Lw(e,Math.floor(Math.sqrt(e)));!r;)n>t||n===e?r=!0:n=Lw(e,n+1);return n}function $F(e,t,n){const r=[],a=e.length;for(let i=0;i<a;i++)i!==t?r.push(e[i]):r.push(n);return r}function JF(e,t,n,r){const a=t.shape.length,i=e.shape.length;if(0!==r&&(r<-a||r>a))throw new Error("Expect batchDims in the range of [-".concat(a,", ").concat(a,"], but got ").concat(r));if(r<0&&(r+=a),r>i)throw new Error("batchDims (".concat(r,") must be less than rank(x) (\n    ").concat(i,")."));if(n<r)throw new Error("batchDims (".concat(r,") must be less than or equal to axis (").concat(n,")."));for(let h=0;h<r;++h)if(e.shape[h]!==t.shape[h])throw new Error("x.shape[".concat(h,"]: ").concat(e.shape[h]," should be equal to indices.shape[").concat(h,"]: ").concat(t.shape[h],"."));const o=e.shape[n],s=[];let c=1,l=1,u=1;for(let h=0;h<r;++h)s.push(e.shape[h]),c*=e.shape[h];for(let h=r;h<n;h++)s.push(e.shape[h]),l*=e.shape[h];for(let h=r;h<a;h++)s.push(t.shape[h]);for(let h=n+1;h<i;h++)s.push(e.shape[h]),u*=e.shape[h];return{batchSize:c,sliceSize:u,outerSize:l,dimSize:o,outputShape:s}}function QF(e){try{return e.map(e=>zC(e))}catch(Cie){throw new Error("Failed to decode encoded string bytes into utf-8, error: ".concat(Cie))}}function ZF(e){return e.map(e=>BC(e))}function eD(e,t){const n=[];for(let i=0;i<t.length;i++)t[i]&&n.push(i);const r=II(e,"int32"),a=II([n.length,e.length],"int32");for(let i=0;i<n.length;i++){const t=r.indexToLoc(n[i]),o=i*e.length;a.values.set(t,o)}return a.toTensor()}!function(){for(const e of sT)HI(e)}();const tD={kernelName:ek,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>OI(e,KA(TI(n,"float32"),-1))}}},nD={kernelName:tk,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>{const t=PI(TI(n,"float32")),r=LI($I(BI(1),t));return nA(DI(e,r))}}}},rD={kernelName:nk,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>{const t=LI($I(PI(TI(n,"float32")),1));return DI(e,t)}}}},aD={kernelName:rk,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t,a=tT(n.shape,r.shape);return{a:()=>{let t=e;const r=eT(n.shape,a);return r.length>0&&(t=M_(t,r)),ZT(t,n.shape)},b:()=>{let t=e;const n=eT(r.shape,a);return n.length>0&&(t=M_(t,n)),ZT(t,r.shape)}}}},iD={kernelName:ak,saveAllInputs:!0,gradFunc:(e,t)=>{const n={};return t.forEach((t,r)=>{n[r]=()=>e.clone()}),n}},oD={kernelName:sk,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>MI(n)}}},sD={kernelName:ck,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>MI(n)}}},cD={kernelName:lk,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>DI(e,LI($I(BI(1),PI(TI(n,"float32")))))}}},lD={kernelName:uk,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>{const t=LI(RI(BI(1),PI(TI(n,"float32"))));return DI(e,t)}}}},uD={kernelName:fk,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t,a=tT(n.shape,r.shape);return{a:()=>{const t=RI(PI(n),PI(r));let i=OI(e,DI(r,t));const o=eT(n.shape,a);return o.length>0&&(i=M_(i,o)),ZT(i,n.shape)},b:()=>{const t=RI(PI(n),PI(r));let i=nA(OI(e,DI(n,t)));const o=eT(r.shape,a);return o.length>0&&(i=M_(i,o)),ZT(i,r.shape)}}}},hD={kernelName:hk,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>DI(e,RI(PI(TI(n,"float32")),1))}}},dD={kernelName:dk,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>DI(e,$I(BI(1),PI(TI(n,"float32"))))}}};const fD=DE({avgPool3dGrad_:function(e,t,n,r,a,i){const o=RE(e,"dy","avgPool3dGrad"),s=RE(t,"input","avgPool3dGrad");let c=o,l=s,u=!1;4===s.rank&&(u=!0,c=ZT(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]]),l=ZT(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]])),mw(5===c.rank,()=>"Error in avgPool3dGrad: dy must be rank 5 but got rank "+"".concat(c.rank,".")),mw(5===l.rank,()=>"Error in avgPool3dGrad: input must be rank 5 but got rank "+"".concat(l.rank,".")),QT("avgPool3dGrad",a,i);const h={dy:c,input:l},d={filterSize:n,strides:r,pad:a,dimRoundingMode:i},f=kE.runKernel(vk,h,d);return u?ZT(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}}),pD={kernelName:gk,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,{filterSize:a,strides:i,pad:o,dimRoundingMode:s}=n;return{x:()=>fD(e,r,a,i,o,s)}}};const mD=DE({avgPoolGrad_:function(e,t,n,r,a){const i=RE(e,"dy","avgPoolGrad"),o=RE(t,"input","avgPoolGrad");mw(o.rank===i.rank,()=>"Rank of input (".concat(o.rank,") does not match rank of dy (").concat(i.rank,")"));let s=o,c=i,l=!1;3===o.rank&&(l=!0,s=ZT(o,[1,o.shape[0],o.shape[1],o.shape[2]]),c=ZT(i,[1,i.shape[0],i.shape[1],i.shape[2]])),mw(4===c.rank,()=>"Error in avgPoolGrad: dy must be rank 4 but got rank "+"".concat(c.rank,".")),mw(4===s.rank,()=>"Error in avgPoolGrad: input must be rank 4 but got rank "+"".concat(s.rank,"."));const u={dy:c,input:s},h={filterSize:n,strides:r,pad:a},d=kE.runKernel(mk,u,h);return l?ZT(d,[d.shape[1],d.shape[2],d.shape[3]]):d}}),gD={kernelName:pk,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,{filterSize:a,strides:i,pad:o}=n;return{x:()=>mD(e,r,a,i,o)}}},vD={kernelName:bk,inputsToSave:["a","b"],gradFunc:(e,t,n)=>{const[r,a]=t,{transposeA:i,transposeB:o}=n;return i||o?!i&&o?{a:()=>Y_(e,a,!1,!1),b:()=>Y_(e,r,!0,!1)}:i&&!o?{a:()=>Y_(a,e,!1,!0),b:()=>Y_(r,e,!1,!1)}:{a:()=>Y_(a,e,!0,!0),b:()=>Y_(e,r,!0,!0)}:{a:()=>Y_(e,a,!1,!0),b:()=>Y_(r,e,!0,!1)}}};const bD=DE({spaceToBatchND_:function(e,t,n){const r=RE(e,"x","spaceToBatchND");mw(r.rank>=1+t.length,()=>"input rank ".concat(r.rank," should be > than [blockShape] ").concat(t.length)),mw(n.length===t.length,()=>"paddings.shape[0] ".concat(n.length," must be equal to [blockShape] ").concat(t.length)),mw(r.shape.reduce((e,r,a)=>a>0&&a<=t.length?e&&(r+n[a-1][0]+n[a-1][1])%t[a-1]===0:e,!0),()=>"input spatial dimensions ".concat(r.shape.slice(1)," with paddings ").concat(n.toString()," must be divisible by blockShapes ").concat(t.toString()));const a={x:r},i={blockShape:t,paddings:n};return kE.runKernel(DN,a,i)}}),yD={kernelName:yk,gradFunc:(e,t,n)=>{const{blockShape:r,crops:a}=n;return{x:()=>bD(e,r,a)}}},xD={kernelName:"BroadcastTo",gradFunc:(e,t,n)=>{const r=n,a=r.inputShape,i=r.shape,o=Array.from(i);for(let c=a.length-1;c>=0;c--)if(a[c]===i[c])o[c]=1;else if(1!==a[c])throw new Error("broadcastTo(): [".concat(a,"] cannot be broadcast to [").concat(i,"]."));const s=[];for(let c=0;c<o.length;c++)o[c]>1&&s.push(c);return{x:()=>M_(e,s,!0)}}},wD={kernelName:Sk,gradFunc:e=>({x:()=>e.clone()})},kD={kernelName:Nk,gradFunc:e=>({x:()=>MI(e)})},SD={kernelName:Ck,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,{clipValueMin:a,clipValueMax:i}=n;return{x:()=>PA(X_(F_(r,a),IR(r,i)),e,MI(e))}}},ND={kernelName:Ik,inputsToSave:["x"],gradFunc:tD.gradFunc},CD={kernelName:Tk,saveAllInputs:!0,gradFunc:(e,t,n)=>{const r=t.map(e=>e.shape),{axis:a}=n,i=Cw(a,t[0].shape)[0],o=r.map(e=>e[i]);return TA(e,o,i).map(e=>()=>e)}},ED={kernelName:_k,inputsToSave:["x","filter"],gradFunc:(e,t,n)=>{const[r,a]=t,{dilations:i,strides:o,pad:s,dataFormat:c}=n;return mw(XT(i),()=>"Error in gradient of conv2D: dilation rates greater than 1 "+"are not yet supported in gradients. Got dilations '".concat(i,"'")),{x:()=>m_(r.shape,e,a,o,s,c),filter:()=>GA(r,e,a.shape,o,s,c)}}},ID={kernelName:Rk,inputsToSave:["dy","filter"],gradFunc:(e,t,n)=>{const[r,a]=t,{strides:i,pad:o,dataFormat:s,dimRoundingMode:c}=n;return{dy:()=>f_(e,a,i,o,s,1,c),filter:()=>GA(e,r,a.shape,i,o,s,c)}}};const TD=DE({conv3DBackpropFilter_:function(e,t,n,r,a){let i=e;4===e.rank&&(i=ZT(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]));let o=t;4===o.rank&&(o=ZT(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]])),mw(5===i.rank,()=>"Error in conv3dDerFilter: input must be rank 5, but got shape "+"".concat(i.shape,".")),mw(5===o.rank,()=>"Error in conv3dDerFilter: dy must be rank 5, but got shape "+"".concat(o.shape,".")),mw(5===n.length,()=>"Error in conv3dDerFilter: filterShape must be length 5, but got "+"".concat(n,".")),mw(i.shape[4]===n[3],()=>"Error in conv3dDerFilter: depth of input ".concat(i.shape[4],") must ")+"match input depth in filter (".concat(n[3],".")),mw(o.shape[4]===n[4],()=>"Error in conv3dDerFilter: depth of dy (".concat(o.shape[4],") must ")+"match output depth for filter (".concat(n[4],")."));const s={x:i,dy:o},c={strides:r,pad:a,filterShape:n};return kE.runKernel(Dk,s,c)}}),_D={kernelName:Fk,inputsToSave:["x","filter"],gradFunc:(e,t,n)=>{const{dilations:r,strides:a,pad:i}=n;mw(XT(r),()=>"Error in gradient of conv3D: dilation rates greater than 1 are "+"not yet supported in gradients. Got dilations '".concat(r,"'"));const[o,s]=t;return{x:()=>b_(o.shape,e,s,a,i),filter:()=>TD(o,e,s.shape,a,i)}}};const AD=DE({sin_:function(e){const t={x:RE(e,"x","sin","float32")};return kE.runKernel(EN,t)}}),RD={kernelName:Lk,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>OI(nA(AD(TI(n,"float32"))),e)}}};const FD=DE({sinh_:function(e){const t={x:RE(e,"x","sinh")};return kE.runKernel(IN,t)}}),DD={kernelName:Pk,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>OI(FD(TI(n,"float32")),e)}}};const OD=DE({cumsum_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const a={x:RE(e,"x","cumsum")},i={axis:t,exclusive:n,reverse:r};return kE.runKernel(jk,a,i)}}),LD={kernelName:jk,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,{axis:a,exclusive:i,reverse:o}=n;return{x:()=>{const t=H_([a],r.rank);let n=OD(e,a,i,!o);return null!=t&&(n=BA(n,t)),n}}}},PD={kernelName:Wk,inputsToSave:["x","filter"],gradFunc:(e,t,n)=>{const{dilations:r,strides:a,pad:i,dimRoundingMode:o}=n,s=null==r?[1,1]:r;mw(XT(s),()=>"Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations "+"'".concat(s,"'"));const[c,l]=t;return mw(4===c.rank,()=>"Error in gradient of depthwiseConv2dNative: input must be "+"rank 4, but got rank ".concat(c.rank,".")),mw(4===l.rank,()=>"Error in gradient of depthwiseConv2dNative: filter must be "+"rank 4, but got rank ".concat(l.rank,".")),mw(c.shape[3]===l.shape[2],()=>"Error in gradient of depthwiseConv2d: number of input "+"channels (".concat(c.shape[3],") must match the inChannels dimension ")+"in filter ".concat(l.shape[2],".")),mw(YT(a,s),()=>"Error in gradient of depthwiseConv2d: Either strides or "+"dilations must be  1. Got strides ".concat(a," and dilations ")+"'".concat(s,"'.")),QT("depthwiseConv2d",i,o),{x:()=>eR(c.shape,e,l,a,i,s,o),filter:()=>ZA(c,e,l.shape,a,i,s,o)}}},MD={kernelName:qk,inputsToSave:["x","filter"],gradFunc:(e,t,n)=>{const[r,a]=t,i={x:r,filter:a,dy:e},o={x:r,filter:a,dy:e};return{x:()=>kE.runKernel(Kk,i,n),filter:()=>kE.runKernel(Xk,o,n)}}},jD={kernelName:Qk,outputsToSave:[!0],gradFunc:(e,t)=>{const[n]=t,r={dy:e,y:n};return{x:()=>kE.runKernel(Zk,r)}}},BD={kernelName:eS,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t,r=OI(C_(nA(PI(n))),2/Math.sqrt(Math.PI));return{x:()=>OI(e,r)}}},zD={kernelName:nS,outputsToSave:[!0],gradFunc:(e,t)=>{const[n]=t;return{x:()=>OI(e,n)}}},UD={kernelName:rS,inputsToSave:["input"],gradFunc:(e,t)=>{const[n]=t;return{input:()=>ZT(e,n.shape)}}},WD={kernelName:aS,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>OI(e,C_(n))}}},VD={kernelName:cS,gradFunc:e=>({x:()=>MI(e)})},HD={kernelName:lS,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t,a=tT(n.shape,r.shape);return{a:()=>{const t=DI(e,TI(r,"float32")),i=eT(n.shape,a);return i.length>0?ZT(M_(t,i),n.shape):t},b:()=>{let t=OI(e,TI(n,"float32"));const i=eT(r.shape,a);i.length>0&&(t=ZT(M_(t,i),r.shape));const o=PI(r);return nA(DI(t,TI(o,"float32")))}}}};const GD=DE({rsqrt_:function(e){const t={x:RE(e,"x","rsqrt","float32")};return kE.runKernel(yN,t)}}),qD={kernelName:uS,inputsToSave:["x","mean","variance","scale"],gradFunc:(e,t,n)=>{const{varianceEpsilon:r}=n,[a,i,o,s]=t,c=null==s?BI(1):s,l=eT(i.shape,a.shape),u=[];if(1===i.rank){for(let e=0;e<a.shape.length-1;++e)u.push(a.shape[e]);u.push(1)}const h=$I(a,i),d=OI(e,c),f=GD(RI(o,BI(r))),p=OI(OI(OI(f,f),f),BI(-.5));return{x:()=>1===i.rank?ZT(OI(OI(e,I_(ZT(f,[1,1,1,i.shape[0]]),u)),c),a.shape):ZT(OI(OI(e,f),c),a.shape),mean:()=>{let e=OI(OI(f,BI(-1)),d);return 1===i.rank&&(e=M_(e,l)),ZT(e,i.shape)},variance:()=>{let e=OI(OI(p,h),d);return 1===i.rank&&(e=M_(e,l)),ZT(e,i.shape)},scale:()=>{const t=OI(h,f);let n=OI(e,t);return 1===i.rank&&(n=M_(n,l)),ZT(n,i.shape)},offset:()=>{let t=e;return 1===i.rank&&(t=M_(t,l)),ZT(t,i.shape)}}}};const KD=DE({unsortedSegmentSum_:function(e,t,n){const r=RE(e,"x","unsortedSegmentSum"),a=RE(t,"segmentIds","unsortedSegmentSum","int32");mw(xw(n),()=>"numSegments must be of dtype int");const i={x:r,segmentIds:a},o={numSegments:n};return kE.runKernel(rC,i,o)}}),XD={kernelName:hS,inputsToSave:["x","indices"],gradFunc:(e,t,n)=>{const[r,a]=t,{axis:i,batchDims:o}=n,s=Cw(i,r.shape)[0],c=(e,t,n)=>()=>{const r=e.shape,a=t.size,o=r.slice(0,s),c=o.length,l=r.slice(i,r.length).slice(1),u=l.length,h=YD(0,c),d=YD(c+1,c+1+u),f=$D([o,[a],l]),p=ZT(n,f),m=ZT(t,[a]),g=$D([[c],h,d]),v=BA(p,g);let b=KD(v,m,e.shape[s]);const y=G_(g);return b=BA(b,y),b};if(1===o){const t=r.shape[0],n=r.split(t,0),i=()=>{const t=AA(n.map((t,n)=>c(t,a.slice(n,1),e.slice(n,1))()));return t.reshape(r.shape)};return{x:i,indices:()=>a}}return{x:c(r,a,e),indices:()=>a}}};function YD(e,t){const n=[];for(let r=e;r<t;++r)n.push(r);return n}function $D(e){const t=[];for(let n=0;n<e.length;++n)for(let r=0;r<e[n].length;++r)t.push(e[n][r]);return t}const JD={kernelName:pS,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t;return{a:()=>MI(n),b:()=>MI(r)}}},QD={kernelName:mS,gradFunc:e=>({x:()=>TI(e,"float32")})},ZD={kernelName:bS,gradFunc:e=>({x:()=>MI(e)})},eO={kernelName:yS,gradFunc:e=>({x:()=>MI(e)})},tO={kernelName:xS,gradFunc:e=>({x:()=>MI(e)})},nO={kernelName:wS,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,{alpha:a}=n,i=R_(r,0);return{x:()=>PA(i,e,OI(e,a))}}},rO={kernelName:ES,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>DI(e,RI(n,1))}}},aO={kernelName:CS,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>DI(e,TI(n,"float32"))}}},iO={kernelName:"LogSoftmax",inputsToSave:[],outputsToSave:[!0],gradFunc:(e,t,n)=>{const[r]=t,{axis:a}=n;return{logits:()=>{const t=C_(r);return $I(e,OI(M_(e,a,!0),t))}}}};const oO=DE({localResponseNormalizationBackprop_:function(e,t,n){const r={x:e,y:t,dy:n},a={depthRadius:arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,bias:arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,alpha:arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,beta:arguments.length>6&&void 0!==arguments[6]?arguments[6]:.5};return kE.runKernel(RS,r,a)}}),sO={kernelName:AS,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(e,t,n)=>{const[r,a]=t,{depthRadius:i,bias:o,alpha:s,beta:c}=n;return{x:()=>oO(r,a,e,i,o,s,c)}}};function cO(e,t,n,r){return t.rank<n.rank&&(t=ZT(t,W_(t.shape,r))),e.rank<n.rank&&(e=ZT(e,W_(e.shape,r))),{x:()=>OI(e,TI(S_(n,t),e.dtype))}}const lO={kernelName:FS,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(e,t,n)=>{const r=n,{reductionIndices:a}=r,i=t[0],o=cO(e,t[1],i,Cw(a,i.shape));return{x:()=>o.x()}}},uO={kernelName:DS,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t;return{a:()=>OI(e,TI(F_(n,r),"float32")),b:()=>OI(e,TI(RR(n,r),"float32"))}}};const hO=DE({maxPool3dGrad_:function(e,t,n,r,a,i,o){const s=RE(e,"dy","maxPool3dGrad"),c=RE(t,"input","maxPool3dGrad"),l=RE(n,"output","maxPool3dGrad");let u=s,h=c,d=l,f=!1;4===c.rank&&(f=!0,u=ZT(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]]),h=ZT(c,[1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]]),d=ZT(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]])),mw(5===u.rank,()=>"Error in maxPool3dGrad: dy must be rank 5 but got rank "+"".concat(u.rank,".")),mw(5===h.rank,()=>"Error in maxPool3dGrad: input must be rank 5 but got rank "+"".concat(h.rank,".")),mw(5===d.rank,()=>"Error in maxPool3dGrad: output must be rank 5 but got rank "+"".concat(d.rank,".")),QT("maxPool3dGrad",i,o);const p={dy:u,input:h,output:d},m={filterSize:r,strides:a,pad:i,dimRoundingMode:o},g=kE.runKernel(MS,p,m);return f?ZT(g,[g.shape[1],g.shape[2],g.shape[3],g.shape[4]]):g}}),dO={kernelName:PS,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(e,t,n)=>{const[r,a]=t,{filterSize:i,strides:o,pad:s,dimRoundingMode:c}=n;return{x:()=>hO(e,r,a,i,o,s,c)}}};const fO=DE({maxPoolGrad_:function(e,t,n,r,a,i,o){const s=RE(e,"dy","maxPoolGrad"),c=RE(t,"input","maxPoolGrad"),l=RE(n,"output","maxPoolGrad");mw(c.rank===s.rank,()=>"Rank of input (".concat(c.rank,") does not match rank of dy ")+"(".concat(s.rank,")")),mw(4===s.rank,()=>"Error in maxPoolGrad: dy must be rank 4 but got rank "+"".concat(s.rank,".")),mw(4===c.rank,()=>"Error in maxPoolGrad: input must be rank 4 but got rank "+"".concat(c.rank,".")),QT("maxPoolGrad",i,o);const u={dy:s,input:c,output:l},h={filterSize:r,strides:a,pad:i,dimRoundingMode:o};return kE.runKernel(LS,u,h)}}),pO={kernelName:OS,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(e,t,n)=>{const[r,a]=t,{filterSize:i,strides:o,pad:s}=n;return{x:()=>fO(e,r,a,i,o,s)}}},mO={kernelName:BS,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,{axis:a}=n,i=Cw(a,r.shape),o=bw(U_(r.shape,i)[1]);return{x:()=>{const t=r.shape.slice();i.forEach(e=>{t[e]=1});const n=ZT(e,t);return DI(OI(n,oA(r.shape,"float32")),o)}}}},gO={kernelName:zS,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(e,t,n)=>{const r=n,{axis:a}=r,[i,o]=t,s=cO(e,o,i,Cw(a,i.shape));return{x:()=>s.x()}}},vO={kernelName:US,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t;return{a:()=>OI(e,TI(IR(n,r),"float32")),b:()=>OI(e,TI(R_(n,r),"float32"))}}},bO={kernelName:WS,inputsToSave:["x"],gradFunc:(e,t,n)=>{const r=t[0],{paddings:a}=n,i=a.map(e=>e[0]);return{x:()=>wA(e,i,r.shape)}}},yO={kernelName:VS,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t,a=tT(n.shape,r.shape);return{a:()=>{const t=eT(n.shape,a);return t.length>0?ZT(M_(e,t),n.shape):e},b:()=>{const t=OI(e,nA(__(DI(n,r)))),i=eT(r.shape,a);return i.length>0?ZT(M_(t,i),r.shape):t}}}},xO={kernelName:GS,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t,a=tT(n.shape,r.shape);return{a:()=>{const t=OI(e,TI(r,"float32")),i=eT(n.shape,a);return i.length>0?ZT(M_(t,i),n.shape):t},b:()=>{const t=OI(e,TI(n,"float32")),i=eT(r.shape,a);return i.length>0?ZT(M_(t,i),r.shape):t}}}},wO={kernelName:qS,gradFunc:e=>({x:()=>nA(e)})},kO={kernelName:QS,inputsToSave:["indices"],gradFunc:(e,t)=>{const n=t[0];return{indices:()=>iA(n.shape,"float32")}}},SO={kernelName:JS,gradFunc:e=>({x:()=>MI(e)})},NO={kernelName:ZS,saveAllInputs:!0,gradFunc:(e,t,n)=>{const{axis:r}=n;return LA(e,r).map(e=>()=>e)}},CO={kernelName:eN,inputsToSave:["x"],gradFunc:(e,t,n)=>{const r=t[0],{paddings:a}=n,i=a.map(e=>e[0]);return{x:()=>wA(e,i,r.shape)}}},EO={kernelName:tN,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:(e,t)=>{const[n,r,a]=t,i=n,o=r,s=tT(i.shape,o.shape);return{a:()=>{const t=TI(o,"float32");let n=OI(e,OI(t,YI(i,$I(t,BI(1)))));const r=eT(i.shape,s);return r.length>0&&(n=M_(n,r)),ZT(n,i.shape)},b:()=>{const t=R_(i,0),n=PA(t,O_(i),MI(i));let r=OI(e,OI(a,n));const c=eT(o.shape,s);return c.length>0&&(r=M_(r,c)),ZT(r,o.shape)}}}},IO={kernelName:nN,inputsToSave:["x","alpha"],gradFunc:(e,t)=>{const[n,r]=t,a=R_(n,0);return{x:()=>PA(a,e,OI(e,r)),alpha:()=>{let t=PA(a,MI(e),OI(e,n));const i=eT(r.shape,e.shape);return i.length>0&&(t=M_(t,i)),ZT(t,r.shape)}}}};const TO=DE({cumprod_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const a={x:RE(e,"x","cumprod")},i={axis:t,exclusive:n,reverse:r};return kE.runKernel(Mk,a,i)}});function _O(e,t,n){const r=e.shape.length,a=r-n.length,i=H_(n,r);let o=e;null!=i&&(o=BA(e,i));const s=o.shape.slice(),c=s.splice(r-n.length,n.length).reduce((e,t)=>e*t,1);s.push(c);let l=function(e,t,n){const r=e.shape.slice();r[n]=1;const a=ZT(t,r),i=TO(e,n,!0,!1),o=TO(e,n,!0,!0),s=OI(i,o);return OI(a,s)}(o.reshape(s),t,a);if(l=l.reshape(o.shape),null!=i){const e=G_(i);l=BA(l,e)}return l}const AO={kernelName:rN,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,{axis:a}=n;let i=[];return i=void 0===a||null===a?r.shape.map((e,t)=>t):"number"===typeof a?[a]:a,{x:()=>_O(r,e,i)}}},RO={kernelName:$k,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t,a=tT(n.shape,r.shape);return{a:()=>{const t=DI(e,TI(r,"float32")),i=eT(n.shape,a);return i.length>0?ZT(M_(t,i),n.shape):t},b:()=>{let t=OI(e,TI(n,"float32"));const i=eT(r.shape,a);i.length>0&&(t=ZT(M_(t,i),r.shape));const o=PI(r);return nA(DI(t,TI(o,"float32")))}}}},FO={kernelName:lN,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>DI(e,nA(PI(n)))}}},DO={kernelName:gN,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t,r=OI(IR(n,6),KA(n));return{x:()=>OI(e,TI(r,"float32"))}}},OO={kernelName:uN,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>OI(e,TI(KA(n),"float32"))}}},LO={kernelName:hN,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>ZT(e,n.shape)}}},PO={kernelName:pN,inputsToSave:["images"],gradFunc:(e,t,n)=>{const[r]=t,a={dy:e,images:r};return{images:()=>kE.runKernel(mN,a,n)}}},MO={kernelName:dN,inputsToSave:["images"],gradFunc:(e,t,n)=>{const[r]=t,a={dy:e,images:r};return{images:()=>kE.runKernel(fN,a,n)}}},jO={kernelName:vN,gradFunc:(e,t,n)=>{const{dims:r}=n,a=Cw(r,e.shape);return{x:()=>vA(e,a)}}},BO={kernelName:bN,gradFunc:e=>({x:()=>MI(e)})},zO={kernelName:yN,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>nA(DI(e,OI(YI(n,1.5),2)))}}};const UO=DE({logicalNot_:function(e){const t={x:RE(e,"x","logicalNot","bool")};return kE.runKernel(TS,t)}}),WO={kernelName:SN,inputsToSave:["condition"],gradFunc:(e,t)=>{const[n]=t;return{condition:()=>TI(MI(n),"float32"),t:()=>OI(e,TI(n,e.dtype)),e:()=>OI(e,TI(UO(n),e.dtype))}}},VO={kernelName:NN,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>{const t=R_(n,BI(0)),r=BI(uF),a=BI(hF),i=OI(e,a),o=OI(OI(e,r),C_(TI(n,"float32")));return PA(t,i,o)}}}},HO={kernelName:_N,outputsToSave:[!0],gradFunc:(e,t)=>{const[n]=t;return{x:()=>OI(e,OI(n,$I(BI(1),n)))}}},GO={kernelName:TN,gradFunc:e=>({x:()=>MI(e)})};const qO=DE({cos_:function(e){const t={x:RE(e,"x","cos","float32")};return kE.runKernel(Lk,t)}}),KO={kernelName:EN,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>OI(qO(TI(n,"float32")),e)}}};const XO=DE({cosh_:function(e){const t={x:RE(e,"x","cosh","float32")};return kE.runKernel(Pk,t)}}),YO={kernelName:IN,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>OI(XO(TI(n,"float32")),e)}}},$O={kernelName:CN,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,{begin:a,size:i}=n,o=r.shape,[s,c]=FT(r,a,i),l=[];for(let u=0;u<e.rank;u++)l.push([s[u],o[u]-s[u]-c[u]]);return{x:()=>cA(e,l)}}},JO={kernelName:LN,outputsToSave:[!0],gradFunc:(e,t,n)=>{const[r]=t,{dim:a}=n,i=OI(e,r);return{logits:()=>$I(i,OI(M_(i,[a],true),r))}}},QO={kernelName:AN,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>OI(e,xA(n))}}};const ZO=DE({batchToSpaceND_:function(e,t,n){const r=RE(e,"x","batchToSpaceND"),a=t.reduce((e,t)=>e*t);mw(r.rank>=1+t.length,()=>"input rank is ".concat(r.rank," but should be > than blockShape.length ").concat(t.length)),mw(n.length===t.length,()=>"crops.length is ".concat(n.length," but should be equal to blockShape.length  ").concat(t.length)),mw(r.shape[0]%a===0,()=>"input tensor batch is ".concat(r.shape[0]," but is not divisible by the product of ")+"the elements of blockShape ".concat(t.join(" * ")," === ").concat(a));const i={x:r},o={blockShape:t,crops:n};return kE.runKernel(yk,i,o)}}),eL={kernelName:DN,gradFunc:(e,t,n)=>{const{blockShape:r,paddings:a}=n;return{x:()=>ZO(e,r,a)}}},tL={kernelName:ON,gradFunc:(e,t,n)=>{const{axis:r}=n;return{x:()=>c_(e,r)}}},nL={kernelName:RN,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>DI(e,OI(LI(TI(n,"float32")),2))}}},rL={kernelName:WN,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>OI(e,OI(TI(n,"float32"),2))}}},aL={kernelName:UN,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t,a=BI(2);return{a:()=>OI(e,OI(a,$I(n,r))),b:()=>OI(e,OI(a,$I(r,n)))}}},iL={kernelName:XN,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t,a=tT(n.shape,r.shape);return{a:()=>{let t=e;const r=eT(n.shape,a);return r.length>0&&(t=M_(t,r)),ZT(t,n.shape)},b:()=>{let t=e;const n=eT(r.shape,a);return n.length>0&&(t=M_(t,n)),ZT(nA(t),r.shape)}}}},oL={kernelName:FN,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,a=r.shape.slice(),{axis:i}=n;Cw(i,r.shape).forEach(e=>{a[e]=1});const o=ZT(e,a),s=OI(o,oA(r.shape,"float32"));return{x:()=>s}}},sL={kernelName:YN,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>DI(e,PI(qO(n)))}}},cL={kernelName:$N,outputsToSave:[!0],gradFunc:(e,t)=>{const[n]=t;return{x:()=>OI($I(BI(1),PI(n)),e)}}},lL={kernelName:JN,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,{reps:a}=n;return{x:()=>{let t=MI(r);if(1===r.rank)for(let n=0;n<a[0];++n)t=RI(t,wA(e,[n*r.shape[0]],[r.shape[0]]));else if(2===r.rank)for(let n=0;n<a[0];++n)for(let i=0;i<a[1];++i)t=RI(t,wA(e,[n*r.shape[0],i*r.shape[1]],[r.shape[0],r.shape[1]]));else if(3===r.rank)for(let n=0;n<a[0];++n)for(let i=0;i<a[1];++i)for(let o=0;o<a[2];++o)t=RI(t,wA(e,[n*r.shape[0],i*r.shape[1],o*r.shape[2]],[r.shape[0],r.shape[1],r.shape[2]]));else{if(4!==r.rank)throw new Error("Gradient for tile operation is not implemented for rank-"+"".concat(r.rank," tensors yet."));for(let n=0;n<a[0];++n)for(let i=0;i<a[1];++i)for(let o=0;o<a[2];++o)for(let s=0;s<a[3];++s)t=RI(t,wA(e,[n*r.shape[0],i*r.shape[1],o*r.shape[2],s*r.shape[3]],[r.shape[0],r.shape[1],r.shape[2],r.shape[3]]))}return t}}}},uL={kernelName:rC,inputsToSave:["segmentIds"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>function(e,t){const n=nT(t,MI(t)),r=A_(e,n);let a=F_(t,BI(0,"int32"));const i=r.rank-a.rank;for(let s=0;s<i;++s)a=E_(a,s+1);a=X_(a,oA(r.shape,"bool"));const o=MI(r);return PA(a,r,o)}(e,n)}}};const hL=[tD,nD,rD,aD,iD,oD,sD,cD,lD,uD,hD,dD,pD,gD,vD,yD,xD,wD,kD,SD,ND,CD,ID,ED,_D,RD,DD,LD,PD,MD,RO,jD,BD,zD,UD,WD,HD,VD,qD,XD,JD,QD,ZD,eO,tO,nO,rO,aO,iO,sO,lO,lO,uO,dO,pO,mO,gO,vO,bO,yO,xO,wO,kO,SO,NO,CO,CO,EO,IO,AO,FO,DO,OO,LO,PO,MO,jO,BO,zO,WO,VO,HO,GO,KO,YO,$O,JO,QO,eL,eL,tL,tL,nL,aL,rL,{kernelName:iC,gradFunc:e=>({x:()=>MI(e)})},iL,oL,sL,cL,lL,{kernelName:eC,gradFunc:(e,t,n)=>{const r=n,{perm:a}=r,i=G_(a);return{x:()=>BA(e,i)}}},{kernelName:nC,gradFunc:(e,t,n)=>{const r=n,{axis:a}=r;return{value:()=>AA(e,a)}}},uL,{kernelName:aC,gradFunc:e=>({x:()=>MI(e)})}];for(const n of hL)yC(n);nE().prototype.abs=function(){return this.throwIfDisposed(),QI(this)};const dL=DE({acos_:function(e){const t={x:RE(e,"x","acos")};return kE.runKernel(tk,t)}});nE().prototype.acos=function(){return this.throwIfDisposed(),dL(this)};const fL=DE({acosh_:function(e){const t={x:RE(e,"x","acosh")};return kE.runKernel(nk,t)}});nE().prototype.acosh=function(){return this.throwIfDisposed(),fL(this)},nE().prototype.add=function(e){return this.throwIfDisposed(),RI(this,e)},nE().prototype.all=function(e,t){return this.throwIfDisposed(),LT(this,e,t)},nE().prototype.any=function(e,t){return this.throwIfDisposed(),PT(this,e,t)},nE().prototype.argMax=function(e){return this.throwIfDisposed(),MT(this,e)};const pL=DE({argMin_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n={x:RE(e,"x","argMin")},r={axis:t};return kE.runKernel(ck,n,r)}});nE().prototype.argMin=function(e){return this.throwIfDisposed(),pL(this,e)},nE().prototype.asScalar=function(){return this.throwIfDisposed(),mw(1===this.size,()=>"The array must have only 1 element."),ZT(this,[])},nE().prototype.asType=function(e){return this.throwIfDisposed(),TI(this,e)},nE().prototype.as1D=function(){return this.throwIfDisposed(),ZT(this,[this.size])},nE().prototype.as2D=function(e,t){return this.throwIfDisposed(),ZT(this,[e,t])},nE().prototype.as3D=function(e,t,n){return this.throwIfDisposed(),ZT(this,[e,t,n])},nE().prototype.as4D=function(e,t,n,r){return this.throwIfDisposed(),ZT(this,[e,t,n,r])},nE().prototype.as5D=function(e,t,n,r,a){return this.throwIfDisposed(),ZT(this,[e,t,n,r,a])};const mL=DE({asin_:function(e){const t={x:RE(e,"x","asin")};return kE.runKernel(lk,t)}});nE().prototype.asin=function(){return this.throwIfDisposed(),mL(this)};const gL=DE({asinh_:function(e){const t={x:RE(e,"x","asinh")};return kE.runKernel(uk,t)}});nE().prototype.asinh=function(){return this.throwIfDisposed(),gL(this)};const vL=DE({atan_:function(e){const t={x:RE(e,"x","atan")};return kE.runKernel(hk,t)}});nE().prototype.atan=function(){return this.throwIfDisposed(),vL(this)};const bL=DE({atan2_:function(e,t){let n=RE(e,"a","atan2"),r=RE(t,"b","atan2");[n,r]=pE(n,r);const a={a:n,b:r};return kE.runKernel(fk,a)}});nE().prototype.atan2=function(e){return this.throwIfDisposed(),bL(this,e)};const yL=DE({atanh_:function(e){const t={x:RE(e,"x","atanh")};return kE.runKernel(dk,t)}});nE().prototype.atanh=function(){return this.throwIfDisposed(),yL(this)},nE().prototype.avgPool=function(e,t,n,r){return this.throwIfDisposed(),e_(this,e,t,n,r)},nE().prototype.batchToSpaceND=function(e,t){return this.throwIfDisposed(),ZO(this,e,t)},nE().prototype.batchNorm=function(e,t,n,r,a){return this.throwIfDisposed(),n_(this,e,t,n,r,a)},nE().prototype.broadcastTo=function(e){return this.throwIfDisposed(),o_(this,e)},nE().prototype.cast=function(e){return this.throwIfDisposed(),TI(this,e)};const xL=DE({ceil_:function(e){const t={x:RE(e,"x","ceil","float32")};return kE.runKernel(Nk,t)}});nE().prototype.ceil=function(){return this.throwIfDisposed(),xL(this)},nE().prototype.clipByValue=function(e,t){return this.throwIfDisposed(),s_(this,e,t)},nE().prototype.concat=function(e,t){return this.throwIfDisposed(),e instanceof tE&&(e=[e]),c_([this,...e],t)},nE().prototype.conv1d=function(e,t,n,r,a,i){return this.throwIfDisposed(),p_(this,e,t,n,r,a,i)},nE().prototype.conv2dTranspose=function(e,t,n,r,a){return this.throwIfDisposed(),g_(this,e,t,n,r,a)},nE().prototype.conv2d=function(e,t,n,r,a,i){return this.throwIfDisposed(),f_(this,e,t,n,r,a,i)},nE().prototype.cos=function(){return this.throwIfDisposed(),qO(this)},nE().prototype.cosh=function(){return this.throwIfDisposed(),XO(this)},nE().prototype.cumprod=function(e,t,n){return this.throwIfDisposed(),TO(this,e,t,n)},nE().prototype.cumsum=function(e,t,n){return this.throwIfDisposed(),OD(this,e,t,n)};const wL=DE({depthToSpace_:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"NHWC";const r=RE(e,"x","depthToSpace","float32"),a="NHWC"===n?r.shape[1]:r.shape[2],i="NHWC"===n?r.shape[2]:r.shape[3],o="NHWC"===n?r.shape[3]:r.shape[1];mw(t>1,()=>"blockSize should be > 1 for depthToSpace, but was: ".concat(t)),mw(a*t>=0,()=>"Negative dimension size caused by overflow when multiplying\n    ".concat(a," and ").concat(t,"  for depthToSpace with input shape\n    ").concat(r.shape)),mw(i*t>=0,()=>"Negative dimension size caused by overflow when multiplying\n    ".concat(i," and ").concat(t," for depthToSpace with input shape\n        ").concat(r.shape)),mw(o%(t*t)===0,()=>"Dimension size must be evenly divisible by ".concat(t*t," but is ").concat(o," for depthToSpace with input shape ").concat(r.shape));const s={x:r},c={blockSize:t,dataFormat:n};return kE.runKernel(Uk,s,c)}});nE().prototype.depthToSpace=function(e,t){return this.throwIfDisposed(),wL(this,e,t)},nE().prototype.depthwiseConv2d=function(e,t,n,r,a,i){return this.throwIfDisposed(),w_(this,e,t,n,r,a,i)};const kL=DE({dilation2d_:function(e,t,n,r){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[1,1],i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NHWC";const o=RE(e,"x","dilation2d"),s=RE(t,"filter","dilation2d");mw(3===o.rank||4===o.rank,()=>"Error in dilation2d: input must be rank 3 or 4, but got rank "+"".concat(o.rank,".")),mw(3===s.rank,()=>"Error in dilation2d: filter must be rank 3, but got rank "+"".concat(s.rank,".")),mw("NHWC"===i,()=>"Error in dilation2d: Only NHWC is currently supported, "+"but got dataFormat of ".concat(i));let c=o,l=!1;3===o.rank&&(c=ZT(o,[1,o.shape[0],o.shape[1],o.shape[2]]),l=!0),mw(c.shape[3]===s.shape[2],()=>"Error in dilation2d:  input and filter must have the same depth: ".concat(c.shape[3]," vs ").concat(s.shape[2]));const u={x:c,filter:s},h={strides:n,pad:r,dilations:a},d=kE.runKernel(qk,u,h);return l?ZT(d,[d.shape[1],d.shape[2],d.shape[3]]):d}});nE().prototype.dilation2d=function(e,t,n,r,a){return this.throwIfDisposed(),kL(this,e,t,n,r,a)};const SL=DE({divNoNan_:function(e,t){let n=RE(e,"a","div"),r=RE(t,"b","div");[n,r]=pE(n,r);const a=DI(n,r),i=MI(a),o=S_(r,i);return PA(o,i,a)}});nE().prototype.divNoNan=function(e){return this.throwIfDisposed(),SL(this,e)},nE().prototype.div=function(e){return this.throwIfDisposed(),DI(this,e)};const NL=DE({dot_:function(e,t){const n=RE(e,"t1","dot"),r=RE(t,"t2","dot");mw((1===n.rank||2===n.rank)&&(1===r.rank||2===r.rank),()=>"Error in dot: inputs must all be rank 1 or 2, but got ranks "+"".concat(n.rank," and ").concat(r.rank,"."));const a=1===n.rank?n.size:n.shape[1],i=1===r.rank?r.size:r.shape[0];if(mw(a===i,()=>"Error in dot: inner dimensions of inputs must match, but got "+"".concat(a," and ").concat(i,".")),1===n.rank&&1===r.rank){const e=ZT(n,[1,-1]),t=ZT(r,[-1,1]),a=Y_(e,t);return ZT(a,[])}if(1===n.rank&&2===r.rank){const e=ZT(n,[1,-1]),t=ZT(r,[r.shape[0],r.shape[1]]),a=Y_(e,t);return ZT(a,[a.size])}if(2===n.rank&&1===r.rank){const e=ZT(r,[-1,1]),t=Y_(n,e);return ZT(t,[t.size])}{const e=ZT(r,[r.shape[0],r.shape[1]]);return Y_(n,e)}}});nE().prototype.dot=function(e){return this.throwIfDisposed(),NL(this,e)},nE().prototype.elu=function(){return this.throwIfDisposed(),k_(this)},nE().prototype.equal=function(e){return this.throwIfDisposed(),S_(this,e)},nE().prototype.erf=function(){return this.throwIfDisposed(),N_(this)};const CL=DE({euclideanNorm_:function(e){return OR(e,"euclidean",arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,arguments.length>2&&void 0!==arguments[2]&&arguments[2])}});nE().prototype.euclideanNorm=function(e,t){return this.throwIfDisposed(),CL(this,e,t)},nE().prototype.exp=function(){return this.throwIfDisposed(),C_(this)},nE().prototype.expandDims=function(e){return this.throwIfDisposed(),E_(this,e)};const EL=DE({expm1_:function(e){const t={x:RE(e,"x","expm1")};return kE.runKernel(aS,t)}});nE().prototype.expm1=function(){return this.throwIfDisposed(),EL(this)},nE().prototype.fft=function(){return this.throwIfDisposed(),UA(this)},nE().prototype.flatten=function(){return this.throwIfDisposed(),ZT(this,[this.size])},nE().prototype.floor=function(){return this.throwIfDisposed(),__(this)},nE().prototype.floorDiv=function(e){return this.throwIfDisposed(),FI(this,e)},nE().prototype.gather=function(e,t,n){return this.throwIfDisposed(),A_(this,e,t,n)},nE().prototype.greaterEqual=function(e){return this.throwIfDisposed(),F_(this,e)},nE().prototype.greater=function(e){return this.throwIfDisposed(),R_(this,e)},nE().prototype.ifft=function(){return this.throwIfDisposed(),VA(this)},nE().prototype.irfft=function(){return this.throwIfDisposed(),HA(this)};const IL=DE({isFinite_:function(e){const t={x:RE(e,"x","isFinite")};return kE.runKernel(bS,t)}});nE().prototype.isFinite=function(){return this.throwIfDisposed(),IL(this)};const TL=DE({isInf_:function(e){const t={x:RE(e,"x","isInf")};return kE.runKernel(yS,t)}});nE().prototype.isInf=function(){return this.throwIfDisposed(),TL(this)};const _L=DE({isNaN_:function(e){const t={x:RE(e,"x","isNaN")};return kE.runKernel(xS,t)}});nE().prototype.isNaN=function(){return this.throwIfDisposed(),_L(this)},nE().prototype.leakyRelu=function(e){return this.throwIfDisposed(),D_(this,e)},nE().prototype.lessEqual=function(e){return this.throwIfDisposed(),IR(this,e)},nE().prototype.less=function(e){return this.throwIfDisposed(),RR(this,e)};const AL=DE({localResponseNormalization_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.5;const i=RE(e,"x","localResponseNormalization");mw(4===i.rank||3===i.rank,()=>"Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank ".concat(i.rank,".")),mw(xw(t),()=>"Error in localResponseNormalization: depthRadius must be an "+"integer but got depthRadius ".concat(t,"."));let o=i,s=!1;3===i.rank&&(s=!0,o=ZT(i,[1,i.shape[0],i.shape[1],i.shape[2]]));const c={x:o},l={depthRadius:t,bias:n,alpha:r,beta:a},u=kE.runKernel(AS,c,l);return s?ZT(u,[u.shape[1],u.shape[2],u.shape[3]]):u}});nE().prototype.localResponseNormalization=function(e,t,n,r){return this.throwIfDisposed(),AL(this,e,t,n,r)};const RL=DE({logSigmoid_:function(e){const t=RE(e,"x","logSigmoid"),n=jI(e=>({value:nA(IA(nA(e))),gradFunc:t=>OI(t,xA(nA(e)))}));return n(t)}});nE().prototype.logSigmoid=function(){return this.throwIfDisposed(),RL(this)},nE().prototype.logSoftmax=function(e){return this.throwIfDisposed(),j_(this,e)},nE().prototype.logSumExp=function(e,t){return this.throwIfDisposed(),K_(this,e,t)},nE().prototype.log=function(){return this.throwIfDisposed(),O_(this)},nE().prototype.log1p=function(){return this.throwIfDisposed(),L_(this)},nE().prototype.logicalAnd=function(e){return this.throwIfDisposed(),X_(this,e)},nE().prototype.logicalNot=function(){return this.throwIfDisposed(),UO(this)};const FL=DE({logicalOr_:function(e,t){const n=RE(e,"a","logicalOr","bool"),r=RE(t,"b","logicalOr","bool");tT(n.shape,r.shape);const a={a:n,b:r};return kE.runKernel(_S,a)}});nE().prototype.logicalOr=function(e){return this.throwIfDisposed(),FL(this,e)};const DL=DE({logicalXor_:function(e,t){const n=RE(e,"a","logicalXor","bool"),r=RE(t,"b","logicalXor","bool");return tT(n.shape,r.shape),X_(FL(e,t),UO(X_(e,t)))}});nE().prototype.logicalXor=function(e){return this.throwIfDisposed(),DL(this,e)},nE().prototype.matMul=function(e,t,n){return this.throwIfDisposed(),Y_(this,e,t,n)},nE().prototype.maxPool=function(e,t,n,r){return this.throwIfDisposed(),$_(this,e,t,n,r)},nE().prototype.max=function(e,t){return this.throwIfDisposed(),P_(this,e,t)},nE().prototype.maximum=function(e){return this.throwIfDisposed(),nT(this,e)},nE().prototype.mean=function(e,t){return this.throwIfDisposed(),Q_(this,e,t)},nE().prototype.min=function(e,t){return this.throwIfDisposed(),Z_(this,e,t)},nE().prototype.minimum=function(e){return this.throwIfDisposed(),eA(this,e)};const OL=DE({mirrorPad_:function(e,t,n){mw("reflect"===n||"symmetric"===n,()=>"Invalid mode. Mode must be either reflect or symmetric. "+"Got ".concat(n,"."));const r=RE(e,"x","mirrorPad");if(0===r.rank)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");mw(t.length===r.rank,()=>"Padding doesn't match input. Must be ".concat(r.rank,". ")+"Got ".concat(t.length,"."));const a="reflect"===n?1:0;for(let s=0;s<r.rank;s++)mw(2===t[s].length,()=>"Invalid number of paddings. Must be length of 2 each."),mw(t[s][0]>=0&&t[s][0]<=r.shape[s]-a&&t[s][1]>=0&&t[s][1]<=r.shape[s]-a,()=>"Padding in dimension ".concat(s," cannot be greater than or equal ")+"to ".concat(r.shape[s]-a," or less than 0 for input of ")+"shape ".concat(r.shape));const i={paddings:t,mode:n},o={x:r};return kE.runKernel(WS,o,i)}});nE().prototype.mirrorPad=function(e,t){return this.throwIfDisposed(),OL(this,e,t)};const LL=DE({mod_:function(e,t){let n=RE(e,"a","mod"),r=RE(t,"b","mod");[n,r]=pE(n,r);const a={a:n,b:r};return kE.runKernel(VS,a)}});nE().prototype.mod=function(e){return this.throwIfDisposed(),LL(this,e)},nE().prototype.mul=function(e){return this.throwIfDisposed(),OI(this,e)},nE().prototype.neg=function(){return this.throwIfDisposed(),nA(this)},nE().prototype.norm=function(e,t,n){return this.throwIfDisposed(),OR(this,e,t,n)},nE().prototype.notEqual=function(e){return this.throwIfDisposed(),rA(this,e)},nE().prototype.oneHot=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.throwIfDisposed(),aA(this,e,t,n)},nE().prototype.onesLike=function(){return this.throwIfDisposed(),sA(this)},nE().prototype.pad=function(e,t){return this.throwIfDisposed(),cA(this,e,t)};const PL=DE({pool_:function(e,t,n,r,a,i,o){null==a&&(a=[1,1]),null==i&&(i=1),0===r&&(r="valid");const s=RE(e,"x","maxPool");let c=s,l=!1;3===s.rank&&(l=!0,c=ZT(s,[1,s.shape[0],s.shape[1],s.shape[2]])),mw(YT(i,a),()=>"Error in pool: Either strides or dilations must be 1. "+"Got strides ".concat(i," and dilations '").concat(a,"'"));const u=BT(c.shape,t,i,a,r),h=[u.dilationHeight,u.dilationWidth];let d;d="same"===r?function(e,t){const n=e.map((e,n)=>e+(e-1)*(t[n]-1)),r=n.map(e=>e-1),a=r.map(e=>Math.floor(e/2)),i=r.map((e,t)=>e-a[t]);return r.map((e,t)=>[a[t],i[t]])}([u.filterHeight,u.filterWidth],h):[[0,0],[0,0]];const f=1===h[0]&&1===h[1],[p,m]=function(e,t,n){const r=n.map(e=>e[0]),a=n.map(e=>e[1]),i=e.concat(r,a),o=t.map((e,t)=>(e-i[t]%e)%e),s=a.map((e,t)=>e+o[t]),c=t.map((e,t)=>[r[t],s[t]]),l=t.map((e,t)=>[0,o[t]]);return[c,l]}([u.inHeight,u.inWidth],h,d),g=f?r:"valid",v=f?c:bD(c,h,p),b=("avg"===n?()=>e_(v,t,i,g,o):()=>$_(v,t,i,g,o))(),y=f?b:ZO(b,h,m);return l?ZT(y,[y.shape[1],y.shape[2],y.shape[3]]):y}});nE().prototype.pool=function(e,t,n,r,a,i){return this.throwIfDisposed(),PL(this,e,t,n,r,a,i)},nE().prototype.pow=function(e){return this.throwIfDisposed(),YI(this,e)},nE().prototype.prelu=function(e){return this.throwIfDisposed(),lA(this,e)};const ML=DE({prod_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=RE(e,"x","prod");"bool"===r.dtype&&(r=TI(r,"int32"));const a={x:r},i={axis:t,keepDims:n};return kE.runKernel(rN,a,i)}});nE().prototype.prod=function(e,t){return this.throwIfDisposed(),ML(this,e,t)};const jL=DE({reciprocal_:function(e){const t={x:RE(e,"x","reciprocal")};return kE.runKernel(lN,t)}});nE().prototype.reciprocal=function(){return this.throwIfDisposed(),jL(this)},nE().prototype.relu=function(){return this.throwIfDisposed(),gA(this)},nE().prototype.relu6=function(){return this.throwIfDisposed(),qA(this)},nE().prototype.reshapeAs=function(e){return this.throwIfDisposed(),ZT(this,e.shape)},nE().prototype.reshape=function(e){return this.throwIfDisposed(),ZT(this,e)},nE().prototype.resizeBilinear=function(e,t,n){return this.throwIfDisposed(),NR(this,e,t,n)},nE().prototype.resizeNearestNeighbor=function(e,t,n){return this.throwIfDisposed(),CR(this,e,t,n)},nE().prototype.reverse=function(e){return this.throwIfDisposed(),vA(this,e)},nE().prototype.rfft=function(){return this.throwIfDisposed(),WA(this)},nE().prototype.round=function(){return this.throwIfDisposed(),TR(this)},nE().prototype.rsqrt=function(){return this.throwIfDisposed(),GD(this)},nE().prototype.selu=function(){return this.throwIfDisposed(),bA(this)},nE().prototype.separableConv2d=function(e,t,n,r,a,i){return this.throwIfDisposed(),yA(this,e,t,n,r,a,i)},nE().prototype.sigmoid=function(){return this.throwIfDisposed(),xA(this)};const BL=DE({sign_:function(e){const t={x:RE(e,"x","sign")};return kE.runKernel(TN,t)}});nE().prototype.sign=function(){return this.throwIfDisposed(),BL(this)},nE().prototype.sin=function(){return this.throwIfDisposed(),AD(this)},nE().prototype.sinh=function(){return this.throwIfDisposed(),FD(this)},nE().prototype.slice=function(e,t){return this.throwIfDisposed(),wA(this,e,t)},nE().prototype.softmax=function(e){return this.throwIfDisposed(),EA(this,e)},nE().prototype.softplus=function(){return this.throwIfDisposed(),IA(this)},nE().prototype.spaceToBatchND=function(e,t){return this.throwIfDisposed(),bD(this,e,t)},nE().prototype.split=function(e,t){return this.throwIfDisposed(),TA(this,e,t)},nE().prototype.sqrt=function(){return this.throwIfDisposed(),LI(this)},nE().prototype.square=function(){return this.throwIfDisposed(),PI(this)},nE().prototype.squaredDifference=function(e){return this.throwIfDisposed(),BR(this,e)},nE().prototype.squeeze=function(e){return this.throwIfDisposed(),_A(this,e)},nE().prototype.stack=function(e,t){this.throwIfDisposed();const n=e instanceof tE?[this,e]:[this,...e];return AA(n,t)},nE().prototype.step=function(e){return this.throwIfDisposed(),KA(this,e)};const zL=DE({stridedSlice_:function(e,t,n,r){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,c=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0;const l={x:RE(e,"x","stridedSlice","string_or_numeric")},u={begin:t,end:n,strides:r,beginMask:a,endMask:i,ellipsisMask:o,newAxisMask:s,shrinkAxisMask:c};return kE.runKernel(HN,l,u)}});nE().prototype.stridedSlice=function(e,t,n,r,a,i,o,s){return this.throwIfDisposed(),zL(this,e,t,n,r,a,i,o,s)},nE().prototype.sub=function(e){return this.throwIfDisposed(),$I(this,e)},nE().prototype.sum=function(e,t){return this.throwIfDisposed(),M_(this,e,t)};const UL=DE({tan_:function(e){const t={x:RE(e,"x","tan","float32")};return kE.runKernel(YN,t)}});nE().prototype.tan=function(){return this.throwIfDisposed(),UL(this)},nE().prototype.tanh=function(){return this.throwIfDisposed(),RA(this)},nE().prototype.tile=function(e){return this.throwIfDisposed(),I_(this,e)},nE().prototype.toBool=function(){return this.throwIfDisposed(),TI(this,"bool")},nE().prototype.toFloat=function(){return this.throwIfDisposed(),TI(this,"float32")},nE().prototype.toInt=function(){return this.throwIfDisposed(),TI(this,"int32")};const WL=DE({topk_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const r=RE(e,"x","topk");if(0===r.rank)throw new Error("topk() expects the input to be of rank 1 or higher");const a=r.shape[r.shape.length-1];if(t<0)throw new Error("'k' passed to topk() must be >= 0 but got ".concat(t));if(t>a)throw new Error("'k' passed to topk() must be <= the last dimension (".concat(a,") ")+"but got ".concat(t));const i={x:r},o={k:t,sorted:n},[s,c]=kE.runKernel(QN,i,o);return{values:s,indices:c}}});nE().prototype.topk=function(e,t){return this.throwIfDisposed(),WL(this,e,t)},nE().prototype.transpose=function(e){return this.throwIfDisposed(),BA(this,e)};const VL=DE({unique_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=RE(e,"x","unique","string_or_numeric");mw(n.rank>0,()=>"The input tensor must be at least 1D");const r={x:n},a={axis:t},[i,o]=kE.runKernel(tC,r,a);return{values:i,indices:o}}});nE().prototype.unique=function(e){return this.throwIfDisposed(),VL(this,e)},nE().prototype.unsortedSegmentSum=function(e,t){return this.throwIfDisposed(),KD(this,e,t)},nE().prototype.unstack=function(e){return this.throwIfDisposed(),LA(this,e)},nE().prototype.where=function(e,t){return this.throwIfDisposed(),PA(e,this,t)},nE().prototype.zerosLike=function(){return this.throwIfDisposed(),MI(this)};class HL extends Error{constructor(e){super(e),Object.setPrototypeOf(this,HL.prototype)}}class GL extends Error{constructor(e){super(e),Object.setPrototypeOf(this,GL.prototype)}}class qL extends Error{constructor(e){super(e),Object.setPrototypeOf(this,qL.prototype)}}class KL extends Error{constructor(e){super(e),Object.setPrototypeOf(this,KL.prototype)}}class XL extends Error{constructor(e){super(e),Object.setPrototypeOf(this,XL.prototype)}}Error;class YL{constructor(e){this.maxEntries=e||100,this.cache=new Map}get(e){let t;return this.cache.has(e)&&(t=this.cache.get(e),this.cache.delete(e),this.cache.set(e,t)),t}put(e,t){if(this.cache.has(e))this.cache.delete(e);else if(this.cache.size>=this.maxEntries){const e=this.cache.keys().next().value;this.cache.delete(e)}this.cache.set(e,t)}getMaxEntries(){return this.maxEntries}setMaxEntries(e){if(e<0)throw new Error("The maxEntries of LRU caches must be at least 0, but got ".concat(e,"."));if(this.maxEntries>e)for(let t=0;t<this.maxEntries-e;t++){const e=this.cache.keys().next().value;this.cache.delete(e)}this.maxEntries=e}}function $L(e,t){if(Array.isArray(e)){let n=[];for(let r=0;r<t;r++)n=n.concat(e);return n}{const n=new Array(t);return n.fill(e),n}}function JL(e,t){if(!e)throw new XL(t)}function QL(e,t){let n=0;for(const r of e)r===t&&n++;return n}function ZL(e){return 1===e.length?e[0]:e}function eP(e){return Array.isArray(e)?e:[e]}function tP(e){const t=e.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return"_"!==t[0]?t:"private"+t}function nP(e){return e.length<=1||-1===e.indexOf("_")?e:e.replace(/[_]+(\w|$)/g,(e,t)=>t.toUpperCase())}let rP={};function aP(e){if(null===e||void 0===e)return null;const t={};return t.className=e.getClassName(),t.config=e.getConfig(),t}function iP(e){if(null!=e&&"object"===typeof e)if(Array.isArray(e))e.forEach(e=>iP(e));else{const t=Object.keys(e);for(const n of t){const t=e[n];null!=t&&"object"===typeof t&&(Array.isArray(t)||"ndarray"!==t.type||"number"!==typeof t.value?iP(t):e[n]=t.value)}}}function oP(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"object",a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if("string"===typeof e){const a=e;let i;if(a in n)i=n[a];else if(a in rP)i=rP[a];else if(i=t[a],null==i)throw new qL("Unknown ".concat(r,": ").concat(e,". ")+"This may be due to one of the following reasons:\n"+"1. The ".concat(r," is defined in Python, in which ")+"case it needs to be ported to TensorFlow.js or your JavaScript code.\n"+"2. The custom ".concat(r," is defined in JavaScript, ")+"but is not registered properly with tf.serialization.registerClass().");return i}{const i=e;if(null==i.className||null==i.config)throw new qL("".concat(r,": Improper config format: ")+"".concat(JSON.stringify(i),".\n")+"'className' and 'config' must set.");const o=i.className;let s,c;if(o in n?[s,c]=n[o]:o in rP?[s,c]=rP.className:o in t&&([s,c]=t[o]),null==s)throw new qL("Unknown ".concat(r,": ").concat(o,". ")+"This may be due to one of the following reasons:\n"+"1. The ".concat(r," is defined in Python, in which ")+"case it needs to be ported to TensorFlow.js or your JavaScript code.\n"+"2. The custom ".concat(r," is defined in JavaScript, ")+"but is not registered properly with tf.serialization.registerClass().");if(null!=c){const e={};for(const n of Object.keys(rP))e[n]=rP[n];for(const a of Object.keys(n))e[a]=n[a];i.config.customObjects=e;const t=Object.assign({},rP);for(const a of Object.keys(n))rP[a]=n[a];iP(i.config);const r=c(s,i.config,n,a);return rP=Object.assign({},t),r}{const e=Object.assign({},rP);for(const r of Object.keys(n))rP[r]=n[r];const t=new s(i.config);return rP=Object.assign({},e),t}}}function sP(e,t){return-1*function(e,t){return e<t?-1:e>t?1:0}(e,t)}function cP(e){if(null==e)return e;const t=[];for(const n of e)-1===t.indexOf(n)&&t.push(n);return t}function lP(e){if(null==e)throw new qL("Invalid value in obj: ".concat(JSON.stringify(e)));for(const t in e)if(e.hasOwnProperty(t))return!1;return!0}function uP(e,t,n){if(null!=n&&e.indexOf(n)<0)throw new qL("".concat(n," is not a valid ").concat(t,".  Valid values are ").concat(e," or null/undefined."))}function hP(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0;return JL(n>=0),JL(r>=n),Array.isArray(e)&&e.length>=n&&e.length<=r&&e.every(e=>typeof e===t)}function dP(e,t){Array.isArray(e)?(mw(e.length>0,()=>"".concat(t," is unexpectedly an empty array.")),e.forEach((e,n)=>dP(e,"element ".concat(n+1," of ").concat(t)))):mw(Number.isInteger(e)&&e>0,()=>"Expected ".concat(t," to be a positive integer, but got ")+"".concat(fP(e),"."))}function fP(e){return null===e?"null":Array.isArray(e)?"["+e.map(e=>fP(e)).join(",")+"]":"string"===typeof e?'"'.concat(e,'"'):"".concat(e)}function pP(e){return"relu"===e?"relu":"linear"===e?"linear":"elu"===e?"elu":null}let mP=0;function gP(){return mP++}const vP={};function bP(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e in vP||(vP[e]=0),vP[e]+=1,e+vP[e].toString()}const yP=["channelsFirst","channelsLast"],xP=["nearest","bilinear"],wP=["valid","same","causal"],kP=["max","avg"],SP=["sum","mul","concat","ave"],NP=new Map;function CP(e){uP(yP,"DataFormat",e)}function EP(e){uP(wP,"PaddingMode",e)}function IP(e){uP(kP,"PoolMode",e)}const TP=[];function _P(e,t){TP.push(e);try{const e=t();return TP.pop(),e}catch(_a){throw TP.pop(),_a}}function AP(e){if(!DP(e))throw new Error("Not a valid tensor name: '"+e+"'");return(0===TP.length?"":TP.join("/")+"/")+e}function RP(e){if(!DP(e))throw new Error("Not a valid tensor name: '"+e+"'");NP.has(e)||NP.set(e,0);const t=NP.get(e);if(NP.set(e,NP.get(e)+1),t>0){const n="".concat(e,"_").concat(t);return NP.set(n,1),n}return e}const FP=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function DP(e){return!!e.match(FP)}function OP(e){return e===parseInt(e.toString(),10)}function LP(e,t,n){null==t&&(t=0),null==n&&(n=e.length);let r=1;for(let a=t;a<n;++a)r*=e[a];return r}function PP(e){if(0===e.length)return Number.NaN;let t=Number.POSITIVE_INFINITY;for(let n=0;n<e.length;n++){const r=e[n];r<t&&(t=r)}return t}function MP(e){if(0===e.length)return Number.NaN;let t=Number.NEGATIVE_INFINITY;for(let n=0;n<e.length;n++){const r=e[n];r>t&&(t=r)}return t}function jP(e,t){if(t<e)throw new qL("end (".concat(t,") < begin (").concat(e,") is forbidden."));const n=[];for(let r=e;r<t;++r)n.push(r);return n}let BP;function zP(){return null==BP&&(BP=HE().epsilon()),BP}function UP(e,t){return TI(e,t)}function WP(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;const n=e.shape.slice();return t<0&&(t=n.length+t+1),n.splice(t,0,1),ZT(e,n)}function VP(e,t,n){return zE(()=>{switch(e.rank){case 1:return kA(e,t,n);case 2:return SA(e,[t,0],[n,e.shape[1]]);case 3:return NA(e,[t,0,0],[n,e.shape[1],e.shape[2]]);case 4:return CA(e,[t,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3]]);case 5:return wA(e,[t,0,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3],e.shape[4]]);case 6:return wA(e,[t,0,0,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3],e.shape[4],e.shape[5]]);default:throw new qL("sliceAlongFirstAxis() received an unsupported tensor rank: "+"".concat(e.rank))}})}function HP(e,t,n){return zE(()=>{switch(e.rank){case 1:return kA(e,t,n);case 2:return SA(e,[0,t],[e.shape[0],n]);case 3:return NA(e,[0,0,t],[e.shape[0],e.shape[1],n]);case 4:return CA(e,[0,0,0,t],[e.shape[0],e.shape[1],e.shape[2],n]);default:throw new qL("sliceAlongLastAxis() received an unsupported tensor rank: "+"".concat(e.rank))}})}function GP(e,t,n,r){return zE(()=>{switch(e.rank){case 1:return kA(e,t,n);case 2:switch(r){case 1:return VP(e,t,n);case 2:return HP(e,t,n);default:throw new qL("The axis is not within the rank of the tensor "+"".concat(r))}case 3:switch(r){case 1:return VP(e,t,n);case 2:return NA(e,[0,t,0],[e.shape[0],n,e.shape[2]]);case 3:return HP(e,t,n);default:throw new qL("The axis is not within the rank of the tensor "+"".concat(r))}case 4:switch(r){case 1:return VP(e,t,n);case 2:return CA(e,[0,t,0,0],[e.shape[0],n,e.shape[2],e.shape[3]]);case 3:return CA(e,[0,0,t,0],[e.shape[0],e.shape[1],n,e.shape[3]]);case 4:return HP(e,t,n);default:throw new qL("The axis is not within the rank of the tensor "+"".concat(r))}default:throw new qL("sliceAlongLastAxis() received an unsupported tensor rank: "+"".concat(e.rank))}})}function qP(e){let t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;return n<0&&(t=e[0].rank,n=0!==t?t:0),n===e[0].rank&&(n=-1),c_(e,n)}function KP(e,t){switch(e.rank){case 1:return l_([e,t]);case 2:return u_([e,t],0);case 3:return h_([e,t],0);case 4:return d_([e,t],0);default:throw new qL("concatAlongFirstAxis() received an unsupported "+"tensor rank: ".concat(e.rank))}}function XP(e,t){if(Array.isArray(t)||(t=[t]),e.rank!==t.length)throw new qL("The length of input n (".concat(t.length,") does not match ")+"the number of dimensions in input x (".concat(e.rank,")"));return I_(e,t)}function YP(e){return fA(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3?arguments[3]:void 0,arguments.length>4?arguments[4]:void 0)}function $P(e,t,n,r){if(e.rank<2||t.rank<2)throw new KL("dot requires both inputs to be rank >= 2"+" but got x shape = ".concat(e.shape," and y shape = ").concat(t.shape));if(t.rank>=3){if(e.shape.slice(-1)[0]!==t.shape.slice(-2)[0])throw new KL("If rank y >= 3, then the second last dim"+" of y must equal the last dim of x but got x shape = ".concat(e.shape," and ")+" y shape = ".concat(t.shape))}if(2===e.rank&&2===t.rank){return tR({a:e,b:t,transposeA:!1,transposeB:!1,bias:r?ZP(e.rank,r,"channelsLast"):null,activation:n})}{const a=e.shape.slice(),i=a.pop();e=ZT(e,[-1,i]);const o=t.shape.slice(),s=o.pop(),c=o.pop(),l=[...o,s],u=Array.from({length:t.rank},(e,n)=>0===n?t.rank-2:n<=t.rank-2?n-1:n);t=ZT(BA(t,u),[c,-1]);const h=[...a,...l];return ZT(tR({a:e,b:t,transposeA:!1,transposeB:!1,bias:r?ZP(e.rank,r,"channelsLast"):null,activation:n}),h)}}function JP(e,t,n){return zE(()=>(t=Array.isArray(t)?FA(t,"int32"):TI(t,"int32"),A_(e,t,n)))}function QP(e){return OI(e,e)}function ZP(e,t,n){const r=t.shape;if(1!==t.rank&&t.rank!==e)throw new qL("Unexpected bias dimensions: ".concat(t.rank)+"; expected it to be 1 or ".concat(e));if(5===e){if("channelsFirst"===n)return 1===r.length?ZT(t,[1,r[0],1,1,1]):ZT(t,[1,r[3],r[0],r[1],r[2]]);if("channelsLast"===n)return 1===r.length?ZT(t,[1,1,1,1,r[0]]):ZT(t,[1].concat(r))}else if(4===e){if("channelsFirst"===n)return 1===r.length?ZT(t,[1,r[0],1,1]):ZT(t,[1,r[2],r[0],r[1]]);if("channelsLast"===n)return 1===r.length?ZT(t,[1,1,1,r[0]]):ZT(t,[1].concat(r))}else if(3===e){if("channelsFirst"===n)return 1===r.length?ZT(t,[1,r[0],1]):ZT(t,[1,r[1],r[0]]);if("channelsLast"===n)return 1===r.length?ZT(t,[1,1,r[0]]):ZT(t,[1].concat(r))}else if(e<3)return t;throw new qL("Unsupported input rank by biasAdd: ".concat(t.rank))}function eM(e,t,n){return zE(()=>(null==n&&(n="channelsLast"),CP(n),RI(e,ZP(e.rank,t,n))))}function tM(e,t,n,r){return zE(()=>zA(e,t,n,r))}function nM(e,t){return arguments.length>2&&void 0!==arguments[2]&&arguments[2]?e():t()}const rM=["fanIn","fanOut","fanAvg"],aM=["normal","uniform","truncatedNormal"];class iM extends WI{fromConfigUsesCustomObjects(){return!1}getConfig(){return{}}}class oM extends iM{apply(e,t){return iA(e,t)}}oM.className="Zeros",HI(oM);class sM extends iM{apply(e,t){return oA(e,t)}}sM.className="Ones",HI(sM);class cM extends iM{constructor(e){if(super(),"object"!==typeof e)throw new qL("Expected argument of type ConstantConfig but got ".concat(e));if(void 0===e.value)throw new qL("config must have value set but got ".concat(e));this.value=e.value}apply(e,t){return zE(()=>OI(BI(this.value),oA(e,t)))}getConfig(){return{value:this.value}}}cM.className="Constant",HI(cM);class lM extends iM{constructor(e){super(),this.DEFAULT_MINVAL=-.05,this.DEFAULT_MAXVAL=.05,this.minval=e.minval||this.DEFAULT_MINVAL,this.maxval=e.maxval||this.DEFAULT_MAXVAL,this.seed=e.seed}apply(e,t){return pA(e,this.minval,this.maxval,t,this.seed)}getConfig(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}}lM.className="RandomUniform",HI(lM);class uM extends iM{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,t){if("float32"!==(t=t||"float32")&&"int32"!==t)throw new KL("randomNormal does not support dType ".concat(t,"."));return YP(e,this.mean,this.stddev,t,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}uM.className="RandomNormal",HI(uM);class hM extends iM{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,t){if("float32"!==(t=t||"float32")&&"int32"!==t)throw new KL("truncatedNormal does not support dType ".concat(t,"."));return OA(e,this.mean,this.stddev,t,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}hM.className="TruncatedNormal",HI(hM);class dM extends iM{constructor(e){super(),this.gain=null!=e.gain?e.gain:1}apply(e,t){return zE(()=>{if(2!==e.length||e[0]!==e[1])throw new qL("Identity matrix initializer can only be used for 2D square matrices.");return OI(this.gain,T_(e[0]))})}getConfig(){return{gain:this.gain}}}dM.className="Identity",HI(dM);class fM extends iM{constructor(e){if(super(),e.scale<0)throw new qL("scale must be a positive float. Got: ".concat(e.scale));this.scale=null==e.scale?1:e.scale,this.mode=null==e.mode?"fanIn":e.mode,function(e){uP(rM,"FanMode",e)}(this.mode),this.distribution=null==e.distribution?"normal":e.distribution,function(e){uP(aM,"Distribution",e)}(this.distribution),this.seed=e.seed}apply(e,t){const n=function(e){let t,n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"channelsLast";if(CP(r),2===e.length)t=e[0],n=e[1];else if(-1!==[3,4,5].indexOf(e.length)){if("channelsFirst"===r){const r=LP(e,2);t=e[1]*r,n=e[0]*r}else if("channelsLast"===r){const r=LP(e,0,e.length-2);t=e[e.length-2]*r,n=e[e.length-1]*r}}else{const r=LP(e);t=Math.sqrt(r),n=Math.sqrt(r)}return[t,n]}(e),r=n[0],a=n[1];let i=this.scale;if("fanIn"===this.mode?i/=Math.max(1,r):"fanOut"===this.mode?i/=Math.max(1,a):i/=Math.max(1,(r+a)/2),"normal"===this.distribution){const n=Math.sqrt(i);if("float32"!==(t=t||"float32")&&"int32"!==t)throw new KL("".concat(this.getClassName()," does not support dType ").concat(t,"."));return OA(e,0,n,t,this.seed)}{const n=Math.sqrt(3*i);return pA(e,-n,n,t,this.seed)}}getConfig(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}}fM.className="VarianceScaling",HI(fM);class pM extends fM{constructor(e){super({scale:1,mode:"fanAvg",distribution:"uniform",seed:null==e?null:e.seed})}getClassName(){return fM.className}}pM.className="GlorotUniform",HI(pM);class mM extends fM{constructor(e){super({scale:1,mode:"fanAvg",distribution:"normal",seed:null==e?null:e.seed})}getClassName(){return fM.className}}mM.className="GlorotNormal",HI(mM);class gM extends fM{constructor(e){super({scale:2,mode:"fanIn",distribution:"normal",seed:null==e?null:e.seed})}getClassName(){return fM.className}}gM.className="HeNormal",HI(gM);class vM extends fM{constructor(e){super({scale:2,mode:"fanIn",distribution:"uniform",seed:null==e?null:e.seed})}getClassName(){return fM.className}}vM.className="HeUniform",HI(vM);class bM extends fM{constructor(e){super({scale:1,mode:"fanIn",distribution:"normal",seed:null==e?null:e.seed})}getClassName(){return fM.className}}bM.className="LeCunNormal",HI(bM);class yM extends fM{constructor(e){super({scale:1,mode:"fanIn",distribution:"uniform",seed:null==e?null:e.seed})}getClassName(){return fM.className}}yM.className="LeCunUniform",HI(yM);class xM extends iM{constructor(e){super(),this.DEFAULT_GAIN=1,this.ELEMENTS_WARN_SLOW=2e3,this.gain=null==e.gain?this.DEFAULT_GAIN:e.gain,this.seed=e.seed}apply(e,t){return zE(()=>{if(e.length<2)throw new KL("Shape must be at least 2D.");if("int32"!==t&&"float32"!==t&&void 0!==t)throw new TypeError("Unsupported data type ".concat(t,"."));const n=bw(e.slice(0,-1)),r=e[e.length-1],a=n*r;a>this.ELEMENTS_WARN_SLOW&&console.warn("Orthogonal initializer is being called on a matrix with more "+"than ".concat(this.ELEMENTS_WARN_SLOW," (").concat(a,") elements: ")+"Slowness may result.");const i=YP([Math.max(r,n),Math.min(r,n)],0,1,t,this.seed),o=UR.qr(i,!1);let s=o[0];const c=o[1].flatten().stridedSlice([0],[Math.min(r,n)*Math.min(r,n)],[Math.min(r,n)+1]);return s=OI(s,c.sign()),n<r&&(s=s.transpose()),OI(BI(this.gain),s.reshape(e))})}getConfig(){return{gain:this.gain,seed:this.seed}}}xM.className="Orthogonal",HI(xM);const wM={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function kM(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return oP(e,VI.getMap().classNameMap,t,"initializer")}function SM(e){return aP(e)}function NM(e){if("string"===typeof e){const t=e in wM?wM[e]:e;if("GlorotNormal"===t)return new mM;if("GlorotUniform"===t)return new pM;if("HeNormal"===t)return new gM;if("HeUniform"===t)return new vM;if("LeCunNormal"===t)return new bM;if("LeCunUniform"===t)return new yM;{const e={};return e.className=t,e.config={},kM(e)}}return e instanceof iM?e:kM(e)}function CM(e){return Array.isArray(e)&&Array.isArray(e[0])}function EM(e){return 0===e.length?[]:Array.isArray(e[0])?e:[e]}function IM(e){let t;if(Array.isArray(e)){if(1!==e.length)throw new qL("Expected Tensor length to be 1; got ".concat(e.length));t=e[0]}else t=e;return t}function TM(e){if(Array.isArray(e)&&Array.isArray(e[0])){if(1===e.length)return e[0];throw new qL("Expected exactly 1 Shape; got ".concat(e.length))}return e}function _M(e){let t=0;for(const n of e)0===n.shape.length?t+=1:t+=n.shape.reduce((e,t)=>e*t);return t}const AM="Variable";class RM{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:AM,r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.dtype=null==t?"float32":t,this.shape=e.shape,this.id=gP(),n=null==n?AM:n,this.originalName=AP(n),this.name=RP(this.originalName),this.trainable_=r,this.constraint=a,this.val=function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;return kE.makeVariable(e,t,n,r)}(e,this.trainable_,this.name,this.dtype)}read(){return this.assertNotDisposed(),this.val}write(e){return this.assertNotDisposed(),function(e,t){if(e.shape.toString()!==t.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(e.shape)+" vs. "+JSON.stringify(t.shape))}(this.val,e),this.val.id!==e.id&&(this.val.assign(e),null!=this.constraint&&this.val.assign(this.constraint.apply(this.val))),this}dispose(){this.assertNotDisposed(),this.val.dispose()}assertNotDisposed(){if(this.val.isDisposed)throw new Error("LayersVariable ".concat(this.name," is already disposed."))}get trainable(){return this.trainable_}set trainable(e){this.trainable_=e,this.val.trainable=e}}function FM(e){return e.map(e=>e.read())}function DM(e){e.forEach(e=>{e[0].write(e[1])})}class OM{constructor(e){this.dtype=e.dtype,this.shape=e.shape,null!=e.shape?this.ndim=e.shape.length:this.ndim=e.ndim,this.maxNDim=e.maxNDim,this.minNDim=e.minNDim,this.axes=e.axes||{}}}class LM{constructor(e,t,n,r,a,i,o){this.dtype=e,this.shape=t,this.sourceLayer=n,this.inputs=r,this.callArgs=a,this.outputTensorIndex=o,this.id=gP(),null!=i&&(this.originalName=AP(i),this.name=RP(this.originalName)),this.rank=t.length}}let PM=0;class MM{constructor(e,t){this.callArgs=t,this.id=PM++,this.outboundLayer=e.outboundLayer,this.inboundLayers=e.inboundLayers,this.nodeIndices=e.nodeIndices,this.tensorIndices=e.tensorIndices,this.inputTensors=e.inputTensors,this.outputTensors=e.outputTensors,this.inputMasks=e.inputMasks,this.outputMasks=e.outputMasks,this.inputShapes=e.inputShapes,this.outputShapes=e.outputShapes;for(const n of e.inboundLayers)null!=n&&n.outboundNodes.push(this);e.outboundLayer.inboundNodes.push(this)}getConfig(){const e=[];for(const t of this.inboundLayers)null!=t?e.push(t.name):e.push(null);return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:e,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}}let jM=0;class BM extends WI{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(),this._callHook=null,this._addedWeightNames=[],this._stateful=!1,this.id=jM++,this.activityRegularizer=null,this.inputSpec=null,this.supportsMasking=!1,this._trainableWeights=[],this._nonTrainableWeights=[],this._losses=[],this._updates=[],this._built=!1,this.inboundNodes=[],this.outboundNodes=[];let t=e.name;if(!t){const e=this.getClassName();t=tP(e)+"_"+bP(e)}if(this.name=t,this.trainable_=null==e.trainable||e.trainable,null!=e.inputShape||null!=e.batchInputShape){let t;if(null!=e.batchInputShape)t=e.batchInputShape;else if(null!=e.inputShape){let n=null;null!=e.batchSize&&(n=e.batchSize),t=[n].concat(e.inputShape)}this.batchInputShape=t;let n=e.dtype;null==n&&(n=e.inputDType),null==n&&(n="float32"),this.dtype=n}null!=e.weights?this.initialWeights=e.weights:this.initialWeights=null,this._refCount=null,this.fastWeightInitDuringBuild=!1}static nodeKey(e,t){return e.name+"_ib-"+t.toString()}getNodeAtIndex(e,t){if(0===this.inboundNodes.length)throw new GL("The layer has never been called "+"and thus has no defined ".concat(t,"."));if(this.inboundNodes.length<=e)throw new qL("Asked to get ".concat(t," at node ").concat(e,", ")+"but the layer has only ".concat(this.inboundNodes.length," inbound nodes."));return this.inboundNodes[e]}getInputAt(e){return ZL(this.getNodeAtIndex(e,"input").inputTensors)}getOutputAt(e){return ZL(this.getNodeAtIndex(e,"output").outputTensors)}get input(){if(this.inboundNodes.length>1)throw new HL("Layer ".concat(this.name)+' has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use `getInputAt(nodeIndex)` instead.');if(0===this.inboundNodes.length)throw new HL("Layer ".concat(this.name)+" is not connected, no input to return.");return ZL(this.getNodeAtIndex(0,"input").inputTensors)}get output(){if(0===this.inboundNodes.length)throw new HL("Layer ".concat(this.name)+" has no inbound nodes.");if(this.inboundNodes.length>1)throw new HL("Layer ".concat(this.name)+' has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use `getOutputAt(nodeIndex)` instead.');return ZL(this.getNodeAtIndex(0,"output").outputTensors)}get losses(){return this._losses}calculateLosses(){return this.losses.map(e=>e())}get updates(){return this._updates}get built(){return this._built}set built(e){this._built=e}get trainable(){return this.trainable_}set trainable(e){this._trainableWeights.forEach(t=>t.trainable=e),this.trainable_=e}get trainableWeights(){return this.trainable_?this._trainableWeights.filter(e=>e.trainable):[]}set trainableWeights(e){this._trainableWeights=e}get nonTrainableWeights(){return this.trainable?this._trainableWeights.filter(e=>!e.trainable).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)}set nonTrainableWeights(e){this._nonTrainableWeights=e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}get stateful(){return this._stateful}resetStates(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")}assertInputCompatibility(e){const t=eP(e);if(null==this.inputSpec||0===this.inputSpec.length)return;const n=eP(this.inputSpec);if(t.length!==n.length)throw new qL("Layer ".concat(this.name," expects ").concat(n.length," inputs, ")+"but it received ".concat(t.length," input tensors. ")+"Input received: ".concat(e));for(let r=0;r<t.length;r++){const e=t[r],a=n[r];if(null==a)continue;const i=e.rank;if(null!=a.ndim&&i!==a.ndim)throw new qL("Input ".concat(r," is incompatible with layer ").concat(this.name,": ")+"expected ndim=".concat(a.ndim,", found ndim=").concat(i));if(null!=a.maxNDim&&i>a.maxNDim)throw new qL("Input ".concat(r," is incompatible with layer ").concat(this.name)+": expected max_ndim=".concat(a.maxNDim,", found ndim=").concat(i));if(null!=a.minNDim&&i<a.minNDim)throw new qL("Input ".concat(r," is incompatible with layer ").concat(this.name)+": expected min_ndim=".concat(a.minNDim,", found ndim=").concat(i,"."));if(null!=a.dtype&&e.dtype!==a.dtype)throw new qL("Input ".concat(r," is incompatible with layer ").concat(this.name," ")+": expected dtype=".concat(a.dtype,", found dtype=").concat(e.dtype,"."));if(a.axes){const t=e.shape;for(const e in a.axes){const n=Number(e),i=a.axes[e],o=n>=0?t[n]:t[t.length+n];if(null!=i&&-1===[i,null].indexOf(o))throw new qL("Input ".concat(r," is incompatible with layer ")+"".concat(this.name,": expected axis ").concat(n," of input shape to ")+"have value ".concat(i," but got shape ").concat(t,"."))}}if(null!=a.shape)for(let t=0;t<a.shape.length;++t){const n=a.shape[t],i=e.shape[t];if(null!=n&&null!=i&&n!==i)throw new qL("Input ".concat(r," is incompatible with layer ")+"".concat(this.name,": expected shape=").concat(a.shape,", ")+"found shape=".concat(e.shape,"."))}}}call(e,t){return e}invokeCallHook(e,t){null!=this._callHook&&this._callHook(e,t)}setCallHook(e){this._callHook=e}clearCallHook(){this._callHook=null}apply(e,t){t=t||{},this.assertNotDisposed();const n=eP(e),r=function(e){let t=!0;for(const n of eP(e))if(!(n instanceof LM)){t=!1;break}return t}(e),a=function(e){let t=!0;for(const n of eP(e))if(n instanceof LM){t=!1;break}return t}(e);if(r===a)throw new qL("Arguments to apply() must be all SymbolicTensors or all Tensors");return _P(this.name,()=>{if(!this.built){this.assertInputCompatibility(e);const t=[];for(const n of eP(e))t.push(n.shape);this.build(ZL(t)),this.built=!0,this.initialWeights&&this.setWeights(this.initialWeights),null===this._refCount&&a&&(this._refCount=1)}if(this.assertInputCompatibility(e),a){let r=this.call(e,t);this.supportsMasking&&this.setMaskMetadata(e,r);const a=eP(r),i=[];for(let e of a)-1!==n.indexOf(e)&&(e=e.clone()),i.push(e);if(r=ZL(i),null!=this.activityRegularizer)throw new KL("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return r}{const n=function(e){e=eP(e);const t=[];for(const n of e)t.push(n.shape);return ZL(t)}(e),r=this.computeOutputShape(n);let a;const i="float32";if(this.warnOnIncompatibleInputShape(Array.isArray(e)?n[0]:n),a=null!=r&&r.length>0&&Array.isArray(r[0])?r.map((n,r)=>new LM(i,n,this,eP(e),t,this.name,r)):new LM(i,r,this,eP(e),t,this.name),this.addInboundNode(e,a,null,null,n,r,t),this._refCount++,null!=this.activityRegularizer)throw new KL("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return a}})}warnOnIncompatibleInputShape(e){if(null!=this.batchInputShape)if(e.length!==this.batchInputShape.length)console.warn("The rank of the input tensor provided (shape: "+"".concat(JSON.stringify(e),") does not match that of the ")+"batchInputShape (".concat(JSON.stringify(this.batchInputShape),") ")+"of the layer ".concat(this.name));else{let t=!1;this.batchInputShape.forEach((n,r)=>{null!=n&&null!=e[r]&&e[r]!==n&&(t=!0)}),t&&console.warn("The shape of the input tensor "+"(".concat(JSON.stringify(e),") does not ")+"match the expectation of layer ".concat(this.name,": ")+"".concat(JSON.stringify(this.batchInputShape)))}}get outputShape(){if(null==this.inboundNodes||0===this.inboundNodes.length)throw new HL("The layer ".concat(this.name," has never been called and thus has no ")+"defined output shape.");const e=[];for(const t of this.inboundNodes){const n=JSON.stringify(t.outputShapes);-1===e.indexOf(n)&&e.push(n)}if(1===e.length){const e=this.inboundNodes[0].outputShapes;return Array.isArray(e)&&Array.isArray(e[0])&&1===e.length?e[0]:e}throw new HL("The layer ".concat(this.name," has multiple inbound nodes with different ")+'output shapes. Hence the notion of "output shape" is ill-defined for the layer.')}countParams(){if(!this.built)throw new GL("You tried to call countParams() on ".concat(this.name,", ")+"but the layer is not built yet. Build it first by calling build(batchInputShape).");return _M(this.weights)}build(e){this.built=!0}getWeights(){return FM(arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this.trainableWeights:this.weights)}setWeights(e){zE(()=>{const t=this.weights;if(t.length!==e.length)throw new qL('You called setWeights(weights) on layer "'.concat(this.name,'" ')+"with a weight list of length ".concat(e.length,", ")+"but the layer was expecting ".concat(t.length," weights. ")+"Provided weights: ".concat(e,"..."));if(0===t.length)return;const n=[],r=FM(t);for(let a=0;a<r.length;++a){const i=r[a],o=t[a],s=e[a];if(!yw(i.shape,s.shape))throw new qL("Layer weight shape ".concat(i.shape," ")+"not compatible with provided weight shape ".concat(s.shape));n.push([o,s])}DM(n)})}addWeight(e,t,n,r,a,i,o,s){if(-1!==this._addedWeightNames.indexOf(e))throw new qL("Duplicate weight name ".concat(e," for layer ").concat(this.name));this._addedWeightNames.push(e),null==n&&(n="float32"),this.fastWeightInitDuringBuild&&(r=null!=s?s():NM("zeros"));const c=r.apply(t,n),l=new RM(c,n,e,i,o);return c.dispose(),null!=a&&this.addLoss(()=>a.apply(l.read())),null==i&&(i=!0),i?this._trainableWeights.push(l):this._nonTrainableWeights.push(l),l}setFastWeightInitDuringBuild(e){this.fastWeightInitDuringBuild=e}addLoss(e){null==e||Array.isArray(e)&&0===e.length||(e=eP(e),void 0!==this._losses&&null!==this._losses&&this.losses.push(...e))}computeOutputShape(e){return e}computeMask(e,t){if(!this.supportsMasking){if(null!=t){if(!Array.isArray(t))throw new TypeError("Layer ".concat(this.name," does not support masking, ")+"but was passed an inputMask.");t.forEach(e=>{if(null!=e)throw new TypeError("Layer ".concat(this.name," does not support masking, ")+"but was passed an inputMask.")})}return null}return t}setMaskMetadata(e,t,n){if(!this.supportsMasking)return;const r=this.computeMask(e,n),a=eP(t),i=eP(r);if(a.length!==i.length)throw new Error("".concat(this.name," outputs ").concat(a.length," tensors ")+"but ".concat(a.length," masks for those tensors"));for(let o=0;o<a.length;o++)a[o].kerasMask=i[o]}addInboundNode(e,t,n,r,a,i){let o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;const s=eP(e);t=eP(t),n=eP(n),r=eP(r),a=EM(a),i=EM(i);const c=[],l=[],u=[];for(const h of s)c.push(h.sourceLayer),l.push(h.nodeIndex),u.push(h.tensorIndex);new MM({outboundLayer:this,inboundLayers:c,nodeIndices:l,tensorIndices:u,inputTensors:s,outputTensors:t,inputMasks:n,outputMasks:r,inputShapes:a,outputShapes:i},o);for(let h=0;h<t.length;h++)t[h].sourceLayer=this,t[h].nodeIndex=this.inboundNodes.length-1,t[h].tensorIndex=h}getConfig(){const e={name:this.name,trainable:this.trainable};return null!=this.batchInputShape&&(e.batchInputShape=this.batchInputShape),null!=this.dtype&&(e.dtype=this.dtype),e}disposeWeights(){return this.weights.forEach(e=>e.dispose()),this.weights.length}assertNotDisposed(){if(0===this._refCount)throw new Error("Layer '".concat(this.name,"' is already disposed."))}dispose(){if(!this.built)throw new Error("Cannot dispose Layer ".concat(this.name," because it has not been ")+"built yet.");if(null===this._refCount)throw new Error("Cannot dispose Layer ".concat(this.name," because it has not been used ")+"yet.");this.assertNotDisposed();let e=0;return 0===--this._refCount&&(e=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:e}}}function zM(e,t,n){if((null==t||null!=n&&n>0)&&(t=e.sourceLayer,n=e.nodeIndex),0===t.inboundNodes.length)return[e];{const e=t.inboundNodes[n];if(0===e.inboundLayers.length)return e.inputTensors;{const t=[];for(let n=0;n<e.inboundLayers.length;n++){const r=zM(e.inputTensors[n],e.inboundLayers[n],e.nodeIndices[n]);for(const e of r)-1===t.indexOf(e)&&t.push(e)}return t}}}class UM extends BM{constructor(e){if(super({dtype:e.dtype,name:null!=e.name?e.name:bP("input").toString()}),null==e.batchSize&&(e.batchSize=null),null==e.sparse&&(e.sparse=!1),this.trainable=!1,this.built=!0,this.sparse=e.sparse,null!=e.inputShape&&null!=e.batchInputShape)throw new qL("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");let t=e.batchInputShape;if(null==t){if(null==e.inputShape)throw new qL("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");t=[e.batchSize].concat(e.inputShape)}else if(null!=e.batchSize)throw new qL("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");const n=e.dtype||"float32";this.batchInputShape=t,this.dtype=n,this.inputSpec=[{shape:t}];const r=new LM(this.dtype,this.batchInputShape,this,[],{},this.name);r.nodeIndex=0,r.tensorIndex=0,new MM({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[r],outputTensors:[r],inputMasks:[null],outputMasks:[null],inputShapes:[t],outputShapes:[t]})}apply(e,t){throw new qL("Cannot pass any input to an "+"InputLayer's apply() method. InputLayer name: ".concat(this.name))}dispose(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}getConfig(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}}UM.className="InputLayer",HI(UM);class WM{constructor(e){if(this.id2Value={},this.id2Mask={},this.name2Id={},e instanceof WM)for(const t in e.id2Value)this.id2Value[t]=e.id2Value[t],t in e.id2Mask&&(this.id2Mask[t]=e.id2Mask[t]);else{if(null==e)return;for(const t of e)this.add(t.key,t.value)}}add(e,t,n){if(null!=this.id2Value[e.id])throw new qL("Duplicate key: name=".concat(e.name,", id=").concat(e.id));return this.id2Value[e.id]=function(e,t){if(null==e.dtype||e.dtype===t.dtype)return t;try{return TI(t,e.dtype)}catch(Cie){throw new qL("The dtype of the feed (".concat(t.dtype,") can not be cast to the dtype ")+"of the key '".concat(e.name,"' (").concat(e.dtype,")."))}}(e,t),this.name2Id[e.name]=e.id,null!=n&&(this.id2Mask[e.id]=n),this}addFeed(e){this.add(e.key,e.value)}hasKey(e){return null!=this.id2Value[e.id]}names(){return Object.keys(this.name2Id)}getValue(e){if(e instanceof LM){if(null==this.id2Value[e.id])throw new qL("Nonexistent key: ".concat(e.name));return this.id2Value[e.id]}{const t=this.name2Id[e];if(null==t)throw new qL("Feed dict has no SymbolicTensor name: ".concat(e));return this.id2Value[t]}}getMask(e){if(e instanceof LM){if(null==this.id2Value[e.id])throw new qL("Nonexistent key: ".concat(e.name));return this.id2Mask[e.id]}{const t=this.name2Id[e];if(null==t)throw new qL("Feed dict has no SymbolicTensor name: ".concat(e));return this.id2Mask[t]}}disposeMasks(){null!=this.id2Mask&&UE(this.id2Mask)}}const VM=new YL,HM=new YL;function GM(e,t,n,r){const a=null!=n&&n.training,i=Array.isArray(e),o=i?e:[e],s=o.map(e=>e.name),c=[],l=t.names();for(const p of s)-1!==l.indexOf(p)?c.push(t.getValue(p)):c.push(null);null!=r&&(r.maxNumTensors=-1/0,r.minNumTensors=1/0);const u=s.join(",")+"|"+t.names().sort().join(",");let h,d=VM.get(u);if(null==d){const e=function(e,t){mw(null!=e&&e.length>0,()=>"Expected at least one fetch, got none");let n=[],r={};if(1===e.length){const a=KM(e[0],t);n=a.sorted,r=a.recipientMap}else{const a=new Set;for(const i of e){const{sorted:e,recipientMap:o}=KM(i,t);for(const t of e)a.has(t.name)||(n.push(t),a.add(t.name));for(const t in o)null==r[t]&&(r[t]=new Set),o[t].forEach(e=>r[t].add(e))}}return{sorted:n,recipientCounts:qM(r)}}(o,t);d=e.sorted,h=e.recipientCounts,VM.put(u,d),HM.put(u,h)}h={},a||Object.assign(h,HM.get(u));const f=new WM(t);for(let p=0;p<d.length;++p){if(null!=r){const e=BE().numTensors;e>r.maxNumTensors&&(r.maxNumTensors=e),e<r.minNumTensors&&(r.minNumTensors=e)}const e=d[p],i=e.sourceLayer;if(i instanceof UM)continue;const o=[],l=[],u=[];let m=!1;for(const n of e.inputs){const e=f.getValue(n),r=f.getMask(n);o.push(e),l.push(r),null!=r&&(m=!0),a||(h[n.name]--,0!==h[n.name]||t.hasKey(n)||-1!==s.indexOf(n.name)||e.isDisposed||!0===n.sourceLayer.stateful||u.push(e))}m&&((n=n||{}).mask=l[0]);const g=eP(i.apply(o,n));let v=null;i.supportsMasking&&(v=i.computeMask(o,l));const b=XM(e),y=Array.isArray(b)?b:[b];for(let t=0;t<y.length;++t){f.hasKey(y[t])||f.add(y[t],g[t],Array.isArray(v)?v[0]:v);const e=s.indexOf(y[t].name);-1!==e&&(c[e]=g[t])}a||UE(u)}return f.disposeMasks(),i?c:c[0]}function qM(e){const t={};for(const n in e)t[n]=e[n].size;return t}function KM(e,t){const n=new Set,r=[],a={};for(const s of t.names())n.add(s);const i=[],o=[];for(i.push(e);i.length>0;){const e=i[i.length-1];if(n.has(e.name)){i.pop();continue}const t=o[o.length-1]===i.length-1;if(0===e.inputs.length||t)i.pop(),r.push(e),n.add(e.name),t&&o.pop();else{o.push(i.length-1);for(const t of e.inputs)null==a[t.name]&&(a[t.name]=new Set),a[t.name].add(e.name),n.has(t.name)||i.push(t)}}return{sorted:r,recipientMap:a}}function XM(e){let t;if(1===e.sourceLayer.inboundNodes.length)t=e.sourceLayer.output;else{let n=null;for(let t=0;t<e.sourceLayer.inboundNodes.length;++t)for(const r of e.sourceLayer.inboundNodes[t].outputTensors)if(r.id===e.id){n=t;break}t=e.sourceLayer.getOutputAt(n)}return t}function YM(e,t){return zE(()=>LI(M_(OI(e,e),t,!0)))}Yw().registerFlag("TOPOLOGICAL_SORT_CACHE_MAX_ENTRIES",()=>100,function(e){null!=VM&&VM.setMaxEntries(e),null!=HM&&HM.setMaxEntries(e)});class $M extends WI{getConfig(){return{}}}class JM extends $M{constructor(e){super(),this.defaultMaxValue=2,this.defaultAxis=0,this.maxValue=null!=e.maxValue?e.maxValue:this.defaultMaxValue,this.axis=null!=e.axis?e.axis:this.defaultAxis}apply(e){return zE(()=>{const t=YM(e,this.axis),n=s_(t,0,this.maxValue);return OI(e,DI(n,RI(zP(),t)))})}getConfig(){return{maxValue:this.maxValue,axis:this.axis}}}JM.className="MaxNorm",HI(JM);class QM extends $M{constructor(e){super(),this.defaultAxis=0,this.axis=null!=e.axis?e.axis:this.defaultAxis}apply(e){return zE(()=>DI(e,RI(zP(),YM(e,this.axis))))}getConfig(){return{axis:this.axis}}}QM.className="UnitNorm",HI(QM);class ZM extends $M{apply(e){return gA(e)}}ZM.className="NonNeg",HI(ZM);class ej extends $M{constructor(e){super(),this.defaultMinValue=0,this.defaultMaxValue=1,this.defaultRate=1,this.defaultAxis=0,this.minValue=null!=e.minValue?e.minValue:this.defaultMinValue,this.maxValue=null!=e.maxValue?e.maxValue:this.defaultMaxValue,this.rate=null!=e.rate?e.rate:this.defaultRate,this.axis=null!=e.axis?e.axis:this.defaultAxis}apply(e){return zE(()=>{const t=YM(e,this.axis),n=RI(OI(this.rate,s_(t,this.minValue,this.maxValue)),OI(1-this.rate,t));return OI(e,DI(n,RI(zP(),t)))})}getConfig(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}}ej.className="MinMaxNorm",HI(ej);const tj={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function nj(e){return aP(e)}function rj(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return oP(e,VI.getMap().classNameMap,t,"constraint")}function aj(e){if(null==e)return null;if("string"===typeof e){return rj({className:e in tj?tj[e]:e,config:{}})}return e instanceof $M?e:rj(e)}async function ij(e){if(null==e)return;const t=[],n=[],r=[];for(const a in e){const i=e[a];if("number"!==typeof i){const e=i;t.push(e.data()),n.push(a),r.push(e)}}if(t.length>0){const a=await Promise.all(t);for(let t=0;t<a.length;++t)e[n[t]]=a[t][0];UE(r)}}function oj(e){if(null!=e)for(const t in e){const n=e[t];"number"!==typeof n&&n.dispose()}}var sj;!function(e){e[e.SILENT=0]="SILENT",e[e.VERBOSE=1]="VERBOSE"}(sj||(sj={}));class cj{constructor(){this.validationData=null}setParams(e){this.params=e}async onEpochBegin(e,t){}async onEpochEnd(e,t){}async onBatchBegin(e,t){}async onBatchEnd(e,t){}async onTrainBegin(e){}async onTrainEnd(e){}setModel(e){}}class lj{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;null==e&&(e=[]),this.callbacks=e,this.queueLength=t}append(e){this.callbacks.push(e)}setParams(e){for(const t of this.callbacks)t.setParams(e)}setModel(e){for(const t of this.callbacks)t.setModel(e)}async onEpochBegin(e,t){null==t&&(t={});for(const n of this.callbacks)await n.onEpochBegin(e,t)}async onEpochEnd(e,t){null==t&&(t={});for(const n of this.callbacks)await n.onEpochEnd(e,t)}async onBatchBegin(e,t){null==t&&(t={});for(const n of this.callbacks)await n.onBatchBegin(e,t)}async onBatchEnd(e,t){null==t&&(t={});for(const n of this.callbacks)await n.onBatchEnd(e,t)}async onTrainBegin(e){null==e&&(e={});for(const t of this.callbacks)await t.onTrainBegin(e)}async onTrainEnd(e){null==e&&(e={});for(const t of this.callbacks)await t.onTrainEnd(e)}}class uj extends cj{constructor(){super()}async onEpochBegin(e){this.seen=0,this.totals={}}async onBatchEnd(e,t){null==t&&(t={});const n=null==t.size?0:t.size;this.seen+=n;for(const r in t){const e=t[r];if("number"===typeof e)this.totals.hasOwnProperty(r)||(this.totals[r]=0),this.totals[r]=this.totals[r]+e*n;else{let t;r in this.totals?t=this.totals[r]:this.totals[r]=0;const a=zE(()=>RI(this.totals[r],OI(e,n)));this.totals[r]=a,null!=t&&t.dispose()}}}async onEpochEnd(e,t){if(null!=t)for(const n of this.params.metrics)null!=this.totals[n]&&("number"===typeof this.totals[n]?t[n]=this.totals[n]/this.seen:zE(()=>{const e=OI(DI(1,this.seen),this.totals[n]);t[n]=e,this.totals[n].dispose(),WE(t[n])}))}}class hj extends cj{async onTrainBegin(e){this.epoch=[],this.history={}}async onEpochEnd(e,t){null==t&&(t={}),this.epoch.push(e);for(const n in t)null==this.history[n]&&(this.history[n]=[]),this.history[n].push(t[n])}async syncData(){const e=[],t=[],n=[];for(const a in this.history){const r=this.history[a];for(let i=0;i<r.length;++i)if("number"!==typeof r[i]){const o=r[i];e.push(o.data()),t.push(a),n.push(i)}}const r=await Promise.all(e);for(let a=0;a<r.length;++a){this.history[t[a]][n[a]].dispose(),this.history[t[a]][n[a]]=r[a][0]}}}class dj extends cj{constructor(e,t){if(super(),this.currentEpoch=0,this.nowFunc=e.nowFunc,this.nextFrameFunc=e.nextFrameFunc||HR,this.yieldEvery=t||"auto","auto"===this.yieldEvery&&(this.yieldEvery=125),"never"===this.yieldEvery&&null!=e.onYield)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");Fw(this.yieldEvery)&&(this.maybeWait=function(e,t,n){let r,a=null!=n?n():jC();return function(){const i=null!=n?n():jC();return i-a<t||(a=i,r=e(...arguments)),r}}(this.maybeWait.bind(this),this.yieldEvery,this.nowFunc)),this.trainBegin=e.onTrainBegin,this.trainEnd=e.onTrainEnd,this.epochBegin=e.onEpochBegin,this.epochEnd=e.onEpochEnd,this.batchBegin=e.onBatchBegin,this.batchEnd=e.onBatchEnd,this.yield=e.onYield}async maybeWait(e,t,n){const r=[];null!=this.yield&&(await ij(n),r.push(this.yield(e,t,n))),r.push(this.nextFrameFunc()),await Promise.all(r)}async onEpochBegin(e,t){this.currentEpoch=e,null!=this.epochBegin&&(await ij(t),await this.epochBegin(e,t))}async onEpochEnd(e,t){const n=[];null!=this.epochEnd&&(await ij(t),n.push(this.epochEnd(e,t))),"epoch"===this.yieldEvery&&n.push(this.nextFrameFunc()),await Promise.all(n)}async onBatchBegin(e,t){null!=this.batchBegin&&(await ij(t),await this.batchBegin(e,t))}async onBatchEnd(e,t){const n=[];null!=this.batchEnd&&(await ij(t),n.push(this.batchEnd(e,t))),"batch"===this.yieldEvery?n.push(this.nextFrameFunc()):Fw(this.yieldEvery)&&n.push(this.maybeWait(this.currentEpoch,e,t)),await Promise.all(n)}async onTrainBegin(e){null!=this.trainBegin&&(await ij(e),await this.trainBegin(e))}async onTrainEnd(e){null!=this.trainEnd&&(await ij(e),await this.trainEnd(e))}}function fj(e,t){if(null==e&&(e={}),e instanceof cj)return[e];if(Array.isArray(e)&&e[0]instanceof cj)return e;return eP(e).map(e=>new dj(e,t))}class pj{constructor(){}static registerCallbackConstructor(e,t){mw(e>=0&&Number.isInteger(e),()=>"Verbosity level is expected to be an integer >= 0, "+"but got ".concat(e)),pj.checkForDuplicate(t),null==pj.constructors[e]&&(pj.constructors[e]=[]),pj.constructors[e].push(t)}static checkForDuplicate(e){for(const t in pj.constructors){pj.constructors[+t].forEach(t=>{if(t===e)throw new qL("Duplicate callback constructor.")})}}static clear(){pj.constructors={}}static createCallbacks(e){const t=[];for(const n in pj.constructors){const r=+n;e>=r&&t.push(...pj.constructors[r])}return t.map(e=>new e)}}function mj(e,t,n,r,a,i,o,s,c){const l=new hj,u=[new uj,...pj.createCallbacks(t)];null!=e&&u.push(...e),u.push(l);const h=new lj(u);return h.setParams({epochs:n,initialEpoch:r,samples:a,steps:i,batchSize:o,verbose:t,doValidation:s,metrics:c}),{callbackList:h,history:l}}function gj(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return oP(e,VI.getMap().classNameMap,t,"layer",n)}function vj(e,t){return zE(()=>{"float32"!==e.dtype&&(e=TI(e,"float32"));const n=M_(QP(e),t,!0),r=KI(n.shape,zP()),a=LI(nT(n,r));return DI(e,a)})}function bj(e,t){return zE(()=>Q_(QP($I(t,e)),-1))}function yj(e,t){return zE(()=>Q_(QI($I(t,e)),-1))}function xj(e,t){return zE(()=>{const n=$I(e,t),r=s_(QI(e),zP(),Number.MAX_VALUE),a=QI(DI(n,r));return OI(100,Q_(a,-1))})}function wj(e,t){return zE(()=>{const n=s_(t,zP(),Number.MAX_VALUE),r=O_(RI(1,n)),a=s_(e,zP(),Number.MAX_VALUE),i=O_(RI(1,a));return Q_(QP($I(r,i)),-1)})}function kj(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return zE(()=>{if(n)t=EA(t);else{const e=M_(t,t.shape.length-1,!0);t=DI(t,e)}return t=s_(t,zP(),1-zP()),nA(M_(OI(TI(e,"float32"),O_(t)),t.shape.length-1))})}function Sj(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return zE(()=>{const r=TI(__(function(e){const t=[LP(e.shape)];return ZT(e,t)}(e)),"int32"),a=(t=s_(t,zP(),1-zP())).shape;return kj(ZT(aA(r,a[a.length-1]),a),t,n)})}function Nj(e,t){return zE(()=>{let n;return n=s_(t,zP(),1-zP()),n=O_(DI(n,$I(1,n))),Q_(function(e,t){if(!yw(e.shape,t.shape))throw new qL("logits and labels must have the same shape, but got shapes "+"".concat(JSON.stringify(e.shape)," and ").concat(JSON.stringify(t.shape)));return zE(()=>{const n=gA(t),r=nA(QI(t));return RI($I(n,OI(t,e)),L_(C_(r)))})}(e,n),-1)})}function Cj(e,t){return zE(()=>{const n=s_(e,zP(),1),r=s_(t,zP(),1);return M_(OI(e,O_(DI(n,r))),-1)})}function Ej(e,t){return zE(()=>{const n=vj(e,-1),r=vj(t,-1),a=OI(n,r);return nA(M_(a,-1))})}pj.constructors={};const Ij={meanSquaredError:bj,meanAbsoluteError:yj,meanAbsolutePercentageError:xj,meanSquaredLogarithmicError:wj,squaredHinge:function(e,t){return zE(()=>{const n=nT(0,$I(1,OI(e,t)));return Q_(QP(n),-1)})},hinge:function(e,t){return zE(()=>{const n=nT(0,$I(1,OI(e,t)));return Q_(n,-1)})},categoricalHinge:function(e,t){return zE(()=>{const n=M_(OI(e,t),-1),r=P_(OI($I(1,e),t),-1);return nT(0,RI(1,$I(r,n)))})},logcosh:function(e,t){return zE(()=>{const n=Math.log(2),r=$I(t,e),a=$I(RI(r,IA(OI(-2,r))),n);return Q_(a,-1)})},categoricalCrossentropy:kj,sparseCategoricalCrossentropy:Sj,binaryCrossentropy:Nj,kullbackLeiblerDivergence:Cj,poisson:function(e,t){return zE(()=>{const n=O_(RI(zP(),t));return Q_($I(t,OI(e,n)),-1)})},cosineProximity:Ej};function Tj(e){if("string"===typeof e){if(e in Ij)return Ij[e];let t="Unknown loss ".concat(e);throw e.toLowerCase().includes("softmaxcrossentropy")&&(t="Unknown loss ".concat(e,". ")+'Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy'),new qL(t)}return e}function _j(e,t){return zE(()=>{const n=OI(.5,sA(t)),r=UP(R_(t,n),e.dtype);return Q_(S_(e,r),-1)})}function Aj(e,t){return zE(()=>UP(S_(MT(e,-1),MT(t,-1)),"float32"))}function Rj(e,t){return zE(()=>TI(M_(X_(S_(e,1),S_(t,1))),"float32"))}function Fj(e,t){return Nj(e,t)}function Dj(e,t){return e.rank===t.rank&&(e=_A(e,[e.rank-1])),(t=MT(t,-1)).dtype!==e.dtype&&(t=TI(t,e.dtype)),TI(S_(e,t),"float32")}const Oj=kj,Lj=Sj,Pj={binaryAccuracy:_j,categoricalAccuracy:Aj,precision:function(e,t){return zE(()=>{const n=Rj(e,t),r=function(e,t){return zE(()=>TI(M_(X_(S_(e,0),S_(t,1))),"float32"))}(e,t),a=RI(n,r);return TI(PA(R_(a,0),DI(n,a),0),"float32")})},categoricalCrossentropy:Oj,sparseCategoricalCrossentropy:Lj,mse:bj,MSE:bj,mae:yj,MAE:yj,mape:xj,MAPE:xj,cosine:Ej};function Mj(e){if("string"===typeof e&&e in Pj)return Pj[e];if("string"!==typeof e&&null!=e)return e;throw new qL("Unknown metric ".concat(e))}function jj(e){if(JL(null!==e,"Unknown LossOrMetricFn ".concat(e)),"string"===typeof e)return e;{let t;for(const n of Object.keys(Ij))if(Ij[n]===e){t=n;break}if(void 0!==t)return t;for(const n of Object.keys(Pj))if(Pj[n]===e){t=n;break}return void 0!==t?t:e.name}}const Bj=1048576;function zj(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(null==e||"object"!==typeof e||Object.getPrototypeOf(e)!==Object.prototype||!Uj(e))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(n){const n=JSON.stringify(e);n.length>Bj&&console.warn('User-defined metadata of model "'.concat(t,'" is too large in ')+"size (length=".concat(n.length," when serialized). It is not ")+"recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= "+"".concat(Bj,"."))}}function Uj(e){if(null===e)return!0;if("object"===typeof e){if(Object.getPrototypeOf(e)===Object.prototype){const t=Object.keys(e);for(const n of t){if("string"!==typeof n)return!1;if(!Uj(e[n]))return!1}return!0}if(Array.isArray(e)){for(const t of e)if(!Uj(t))return!1;return!0}return!1}{const t=typeof e;return"string"===t||"number"===t||"boolean"===t}}function Wj(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:console.log;const a=function(e){let t=!0;const n=[],r=[];for(const a in e.nodesByDepth)n.push(e.nodesByDepth[a]);for(const a of n){if(a.length>1||1===a.length&&a[0].inboundLayers.length>1){t=!1;break}r.push(...a)}if(t)for(const a of e.layers){let e=!1;for(const n of a.inboundNodes)if(-1!==r.indexOf(n)){if(e){t=!1;break}e=!0}if(!t)break}return t}(e),i=["Layer (type)","Input Shape","Output shape","Param #"];let o;if(a?(t=t||90,n=n||[.32,.61,.89,1]):(t=t||115,n=n||[.24,.48,.7,.8,1]),n[n.length-1]<=1&&(n=n.map(e=>Math.floor(t*e))),!a){i.push("Receives inputs"),o=[];for(const t in e.nodesByDepth)o.push(...e.nodesByDepth[t])}r("_".repeat(t)),Vj(i,n,r),r("=".repeat(t));const s=e.layers;for(let u=0;u<s.length;++u)a?Hj(s[u],n,r):Gj(s[u],n,o,r),r((u===s.length-1?"=":"_").repeat(t));e.checkTrainableWeightsConsistency();const c=function(e){let t;t=null!=e.collectedTrainableWeights?_M(e.collectedTrainableWeights):_M(e.trainableWeights);return t}(e),l=_M(e.nonTrainableWeights);r("Total params: ".concat(c+l)),r("Trainable params: ".concat(c)),r("Non-trainable params: ".concat(l)),r("_".repeat(t))}function Vj(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:console.log,r="";for(let a=0;a<e.length;++a)a>0&&(r=r.slice(0,r.length-1)+" "),r+=e[a],r=r.slice(0,t[a]),r+=" ".repeat(t[a]-r.length);n(r)}function Hj(e,t,n){let r,a;try{a=e.inboundNodes.map(e=>JSON.stringify(e.inputShapes)).join(",")}catch(Cie){a="multiple"}try{r=JSON.stringify(e.outputShape)}catch(Cie){r="multiple"}const i=e.name,o=e.getClassName();Vj(["".concat(i," (").concat(o,")"),a,r,e.countParams().toString()],t,n)}function Gj(e,t,n,r){let a,i;try{i=e.inboundNodes.map(e=>JSON.stringify(e.inputShapes)).join(",")}catch(Cie){i="multiple"}try{a=JSON.stringify(e.outputShape)}catch(Cie){a="multiple"}const o=[];for(const u of e.inboundNodes)if(!(null!=n&&n.length>0&&-1===n.indexOf(u)))for(let e=0;e<u.inboundLayers.length;++e){const t=u.inboundLayers[e].name,n=u.nodeIndices[e],r=u.tensorIndices[e];o.push("".concat(t,"[").concat(n,"][").concat(r,"]"))}const s=e.name,c=e.getClassName(),l=0===o.length?"":o[0];Vj(["".concat(s," (").concat(c,")"),i,a,e.countParams().toString(),l],t,r);for(let u=1;u<o.length;++u)Vj(["","","","",o[u]],t,r)}function qj(e,t,n){return("inboundNodes"===e||"outputLayers"===e||"inputLayers"===e)&&0===t&&"string"===typeof n}function Kj(e,t){if(null===e)return null;if("string"===typeof e)return nP(e);if("number"===typeof e||"boolean"===typeof e)return e;if(e instanceof Array){const n=[],r=e.length;for(let a=0;a<r;++a){const r=e[a];qj(t,a,r)?n.push(r):n.push(Kj(r,t))}return n}{const t={};for(const n of Object.keys(e)){const r=e[n];if("name"===n&&"string"===typeof r)t[n]=r;else{const e=nP(n);t[e]=Kj(r,e)}}return t}}function Xj(e,t){if(null===e||void 0===e)return null;if("string"===typeof e)return tP(e);if("number"===typeof e||"boolean"===typeof e)return e;if(e instanceof Array){const n=[],r=e.length;for(let a=0;a<r;++a){const r=e[a];qj(t,a,r)?n.push(r):n.push(Xj(r,t))}return n}{const t={};for(const n of Object.keys(e)){const r=e[n],a=tP(n);t[a]="name"!==n&&"className"!==n||"string"!==typeof r?Xj(r,n):r}return t}}const Yj="4.22.0";class $j extends BM{constructor(e){if(super({}),this.containerNodes=new Set,this.name=e.name,null==this.name){const e=this.getClassName().toLowerCase();this.name=bP(e)}if(this.supportsMasking=!1,this.trainable_=!0,Array.isArray(e.inputs)?this.inputs=e.inputs.slice():this.inputs=[e.inputs],Array.isArray(e.outputs)?this.outputs=e.outputs.slice():this.outputs=[e.outputs],cP(this.inputs).length!==this.inputs.length)throw new qL("The list of inputs passed to the model is redundant. All inputs should only appear once. Found: "+"".concat(this.inputs.map(e=>e.name)));cP(this.outputs).length!==this.outputs.length&&console.warn("The list of outputs passed to the model is redundant. All outputs should only appear once. Found: "+"".concat(this.outputs.map(e=>e.name))),this.inputLayers=[],this.inputLayersNodeIndices=[],this.inputLayersTensorIndices=[],this.outputLayers=[],this.outputLayersNodeIndices=[],this.outputLayersTensorIndices=[],this.layers=[],this.internalContainerRefs=[];for(const v of this.outputs){const e=v.sourceLayer,t=v.nodeIndex,n=v.tensorIndex;this.outputLayers.push(e),this.outputLayersNodeIndices.push(t),this.outputLayersTensorIndices.push(n)}for(const v of this.inputs){const e=v.sourceLayer,t=v.nodeIndex,n=v.tensorIndex;JL(0===t,"input layer has >1 nodes"),JL(0===n,"input layer has >1 tensors"),this.inputLayers.push(e),this.inputLayersNodeIndices.push(t),this.inputLayersTensorIndices.push(n)}this.inputNames=[],this.outputNames=[],this.feedInputShapes=[],this.feedInputNames=[],this.feedOutputNames=[];for(let v=0;v<this.inputLayers.length;v++){const t=this.inputLayers[v];if(!(t instanceof UM))throw new TypeError("Input layers to a LayersModel must be InputLayer objects. "+"Received inputs: ".concat(e.inputs,". ")+"Input ".concat(v," (0-based) originates ")+"from layer type ".concat(t.getClassName(),"."));this.inputNames.push(t.name),this.feedInputShapes.push(t.batchInputShape),this.feedInputNames.push(t.name)}for(const v of this.outputLayers)this.outputNames.push(v.name);this.internalInputShapes=this.inputs.map(e=>e.shape),this.internalOutputShapes=this.outputs.map(e=>e.shape);const t={},n={},r={},a={},i={},o=[],s=(e,t,n,r,a,c)=>{null!=r&&null!=a&&null!=c||(r=e.sourceLayer,a=e.nodeIndex,c=e.tensorIndex);const l=r.inboundNodes[a];if(-1!==n.indexOf(l))throw new GL("The tensor ".concat(e.name,' at layer "').concat(r.name,'" ')+"is part of a cycle.");if(-1!==t.indexOf(l))return;this.containerNodes.add($j.nodeKey(r,a)),r.id in i||(i[r.id]=Object.keys(i).length),-1===n.indexOf(l)&&n.push(l);const u=l.inboundLayers.length;for(let i=0;i<u;i++){const e=l.inputTensors[i],r=l.inboundLayers[i],a=l.nodeIndices[i],o=l.tensorIndices[i];s(e,t,n,r,a,o)}for(t.push(l);n.indexOf(l)>=0;)n.splice(n.indexOf(l),1);o.push(l)},c=[],l=[];for(const v of this.outputs)s(v,c,l);const u=o.slice().reverse();for(const v of u){n[v.id]=v,v.id in t||(t[v.id]=0);let e=t[v.id];const i=null==r[v.outboundLayer.id]?0:r[v.outboundLayer.id];e=Math.max(e,i),r[v.outboundLayer.id]=e,a[v.outboundLayer.id]=v.outboundLayer,t[v.id]=e;for(let r=0;r<v.inboundLayers.length;r++){const a=v.inboundLayers[r],i=v.nodeIndices[r],o=a.inboundNodes[i],s=null==t[o.id]?0:t[o.id];t[o.id]=Math.max(e+1,s),n[o.id]=o}}const h={};for(const v in t){const e=t[v];e in h||(h[e]=[]),h[e].push(n[v])}const d={};for(const v in r){const e=r[v];e in d||(d[e]=[]),d[e].push(a[v])}let f=Object.keys(d).map(e=>parseInt(e,10)).sort(sP);this.layers=[];for(const v of f){const e=d[v];e.sort((e,t)=>{const n=i[e.id],r=i[t.id];return n<r?-1:n>r?1:0});for(const t of e)t instanceof $j&&this.internalContainerRefs.push(t),this.layers.push(t)}this.layersByDepth=d,f=Object.keys(h).map(e=>parseInt(e,10)).sort(sP);const p=this.inputs.slice(),m=[];for(const v of f)for(const e of h[v]){const t=e.outboundLayer;if(null!=t){for(const n of e.inputTensors)if(-1===p.indexOf(n))throw new GL("Graph disconnected: cannot obtain value for tensor ".concat(n)+' at layer "'.concat(t.name,'". ')+"The following previous layers were accessed without "+"issue: ".concat(m));for(const t of e.outputTensors)p.push(t);m.push(t.name)}}this.nodesByDepth=h;const g=this.layers.map(e=>e.name);for(const v of g){const e=g.filter(e=>e===v).length;if(1!==e)throw new GL('The name "'.concat(v,'" is used ').concat(e," times ")+"in the model. All layer names should be unique. Layer names: "+JSON.stringify(g))}this.outboundNodes=[],this.inboundNodes=[],new MM({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:this.inputs.map(e=>null),outputMasks:this.outputs.map(e=>null),inputShapes:this.inputs.map(e=>e.shape),outputShapes:this.outputs.map(e=>e.shape)}),this.built=!0,this._refCount=1}assertNotDisposed(){if(0===this._refCount)throw new Error("Container '".concat(this.name,"' is already disposed."))}dispose(){this.assertNotDisposed();const e={refCountAfterDispose:null,numDisposedVariables:0};if(0===--this._refCount){for(const t of this.layers)e.numDisposedVariables+=t.dispose().numDisposedVariables;for(const t of this.internalContainerRefs)e.numDisposedVariables+=t.dispose().numDisposedVariables}return e.refCountAfterDispose=this._refCount,e}get trainable(){return this.trainable_}set trainable(e){this.layers.forEach(t=>{t._trainableWeights.forEach(t=>t.trainable=e)}),this.trainable_=e}get trainableWeights(){if(this._trainableWeights.length>0)throw new qL("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];let e=[];for(const t of this.layers)e=e.concat(t.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const t of this.layers)e.push(...t.nonTrainableWeights);if(!this.trainable){const t=[];for(const e of this.layers)t.push(...e.trainableWeights);return t.concat(e)}return e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}loadWeights(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const n={};let r=0;const a=(e=>{const t=Object.keys(e);if(0===t.length)return!1;const n=t[0].split("/");return!isNaN(parseInt(n[n.length-1],10))})(e);a&&this.parseWeights(e);for(const o of this.layers)for(const[e,t]of o.weights.entries()){const i=a?"".concat(t.name.split("/").slice(0,-1).join("/")+"/").concat(e):t.originalName;if(null!=n[i])throw new qL("Duplicate weight name: ".concat(i));n[i]=t,r++}const i=[];for(const o in e){let r=o;if(null==n[o]){const e=o.split("/");r=e.slice(0,-2).concat([e[e.length-1]]).join("/")}if(null!=n[r])i.push([n[r],e[o]]);else if(t)throw new qL("Provided weight data has no target variable: ".concat(o));delete n[r]}if(t){const e=[];for(const t in n)e.push(t);if(e.length>0)throw new qL("".concat(e.length," of ").concat(r," weights are not set: ")+"".concat(e))}DM(i)}parseWeights(e){for(const t in Object.keys(e)){const n=t.split("/"),r=["vars","layer_checkpoint_dependencies"],a=n.map(e=>e.startsWith("_")?e.slice(1):e).filter(e=>!r.includes(e)).join("/");a!==t&&(e[a]=e[t],delete e[t])}}updatedConfig(){const e=this.getConfig(),t={};return t.className=this.getClassName(),t.config=e,t.kerasVersion="tfjs-layers ".concat(Yj),t.backend="TensorFlow.js",t}toJSON(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const n=Xj(this.updatedConfig());return t?JSON.stringify(n):n}call(e,t){return zE(()=>{e=eP(e);const n=new WM;for(let t=0;t<this.inputs.length;++t)n.add(this.inputs[t],e[t]);return GM(this.outputs,n,t)})}computeMask(e,t){return zE(()=>{let n;return e=eP(e),n=null==t?$L(null,e.length):eP(t),this.runInternalGraph(e,n)[1]})}computeOutputShape(e){const t=EM(e);if(t.length!==this.inputLayers.length)throw new qL("Invalid inputShape argument ".concat(e,": ")+"model has ".concat(this.inputLayers.length," tensor inputs."));const n={};for(let o=0;o<t.length;o++){const e=this.inputLayers[o],r=t[o];n[e.name+"_0_0"]=r}const r=Object.keys(this.nodesByDepth).map(e=>parseInt(e,10)).sort(sP);if(r.length>1)for(const o of r){const e=this.nodesByDepth[o];for(const t of e){const e=t.outboundLayer;if(-1!==this.inputLayers.map(e=>e.id).indexOf(e.id))continue;const r=[];for(let o=0;o<t.inboundLayers.length;o++){const e=t.inboundLayers[o],a=t.nodeIndices[o],i=t.tensorIndices[o],s=n["".concat(e.name,"_").concat(a,"_").concat(i)];r.push(s)}const a=EM(e.computeOutputShape(ZL(r))),i=e.inboundNodes.indexOf(t);for(let t=0;t<a.length;t++){n["".concat(e.name,"_").concat(i,"_").concat(t)]=a[t]}}}const a=[],i=[];for(let o=0;o<this.outputLayers.length;o++){const e=this.outputLayers[o],t=this.outputLayersNodeIndices[o],n=this.outputLayersTensorIndices[o],r="".concat(e.name,"_").concat(t,"_").concat(n);i.push(r)}for(let o=0;o<i.length;o++){const e=i[o];JL(e in n),a.push(n[e])}return ZL(a)}runInternalGraph(e,t){null==t&&(t=$L(null,e.length));const n={};for(let s=0;s<this.inputs.length;++s){const r=this.inputs[s],a=e[s],i=t[s];n[r.id]=[a,i]}const r=Object.keys(this.nodesByDepth).map(e=>parseInt(e,10)).sort(sP);for(const s of r){const e=this.nodesByDepth[s];for(const t of e){const e=t.outboundLayer,r=t.inputTensors,a=t.outputTensors,i=new Array;for(const t of r)t.id in n&&i.push(n[t.id]);if(i.length===r.length){let r,o,s,c,l={};if(null!=t.callArgs&&(l=t.callArgs),1===i.length){const[t,n]=i[0];null==l.mask&&(l.mask=n),s=eP(e.call(t,l)),c=eP(e.computeMask(t,n)),r=[t],o=[n]}else r=i.map(e=>e[0]),o=i.map(e=>e[1]),null==l.mask&&(l.mask=o),s=eP(e.call(r,l)),c=eP(e.computeMask(r,o));if(e.activityRegularizer)throw new KL("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(let e=0;e<a.length;++e){const t=a[e],r=s[e],i=c[e];n[t.id]=[r,i]}}}}const a=[],i=[],o=[];for(const s of this.outputs){JL(s.id in n,"Could not compute output ".concat(s.name," : ").concat(s.id));const[e,t]=n[s.id];o.push(e.shape),a.push(e),i.push(t)}return[a,i,o]}buildNodeConversionMap(e){const t={};let n;for(const r of this.layers){n=r instanceof $j?1:0;for(let e=0;e<r.inboundNodes.length;e++){const a=$j.nodeKey(r,e);this.containerNodes.has(a)&&(t[a]=n,n+=1)}}return t}getLayer(e,t){if(null!=t)return this.findLayer(t);if(null==e)throw new qL("Provide either a layer name or layer index");if("number"===typeof e)return this.findLayer(e);for(const n of this.layers)if(n.name===e)return n;throw new qL("No such layer: ".concat(e))}findLayer(e){if(this.layers.length<=e)throw new qL("Was asked to retrieve layer at index ".concat(e,", but model only ")+"has ".concat(this.layers.length," layer(s)."));return this.layers[e]}calculateLosses(){return zE(()=>{const e=[];for(const t of this.layers)for(let n=0;n<t.inboundNodes.length;++n){const r=$j.nodeKey(t,n);this.containerNodes.has(r)&&e.push(...t.calculateLosses())}return e})}getConfig(){const e={name:this.name},t=this.buildNodeConversionMap(this.layers),n=[];for(const i of this.layers){const e=i.getClassName(),r=i.getConfig(),a=[];for(let n=0;n<i.inboundNodes.length;n++){const e=i.inboundNodes[n],r=$j.nodeKey(i,n);let o={};if(this.containerNodes.has(r)){if(e.callArgs)try{JSON.stringify(e.callArgs),o=e.callArgs}catch(Cie){console.warn("Layer ".concat(i.name," was passed ")+"non-serializable keyword arguments: "+"".concat(e.callArgs,". They will not be included ")+"in the serialized model (and thus will be missing at deserialization time)."),o={}}if(e.inboundLayers.length>0){const n=[];for(let r=0;r<e.inboundLayers.length;r++){const a=e.inboundLayers[r],i=e.nodeIndices[r],s=e.tensorIndices[r];let c=t[$j.nodeKey(a,i)];null==c&&(c=0),n.push([a.name,c,s,o])}a.push(n)}}}const o={};o.name=i.name,o.className=e,o.config=r,o.inboundNodes=a,n.push(o)}e.layers=n;const r=[];for(let i=0;i<this.inputLayers.length;i++){const e=this.inputLayers[i],n=this.inputLayersNodeIndices[i],a=$j.nodeKey(e,n);if(!this.containerNodes.has(a))continue;let o=t[a];null!==o&&void 0!==o||(o=0);const s=this.inputLayersTensorIndices[i];r.push([e.name,o,s])}e.inputLayers=r;const a=[];for(let i=0;i<this.outputLayers.length;i++){const e=this.outputLayers[i],n=this.outputLayersNodeIndices[i],r=$j.nodeKey(e,n);if(!this.containerNodes.has(r))continue;let o=t[r];null!==o&&void 0!==o||(o=0);const s=this.outputLayersTensorIndices[i];a.push([e.name,o,s])}return e.outputLayers=a,e}static fromConfig(e,t){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const r={},a={};function i(e,t){e.name in a?a[e.name].push(t):a[e.name]=[t]}function o(e,t){const n=[];let a;for(const o of t){const s=o[0],c=o[1],l=o[2];if(a=null==o[3]?{}:o[3],!(s in r))return void i(e,t);const u=r[s];if(u.inboundNodes.length<=c)return void i(e,t);const h=u.inboundNodes[c];n.push(h.outputTensors[l])}n.length>0&&e.apply(ZL(n),a)}function s(e){const a=e.name,o=gj(e,null!=t.customObjects?t.customObjects:{});o.setFastWeightInitDuringBuild(n),r[a]=o;e.inboundNodes.forEach(e=>{if(!(e instanceof Array))throw new qL("Corrupted configuration, expected array for nodeData: ".concat(e));i(o,e)})}const c=t.name,l=t.layers;for(const p of l)s(p);for(;!lP(a);)for(const e of l){const t=r[e.name];if(t.name in a){const e=a[t.name];delete a[t.name];for(const n of e)o(t,n)}}const u=[],h=[],d=t.inputLayers;for(const p of d){const e=p[0],t=p[1],n=p[2];JL(e in r);const a=r[e].inboundNodes[t].outputTensors;u.push(a[n])}const f=t.outputLayers;for(const p of f){const e=p[0],t=p[1],n=p[2];JL(e in r);const a=r[e].inboundNodes[t].outputTensors;h.push(a[n])}return new e({inputs:u,outputs:h,name:c})}get stateful(){if(this._stateful)throw new qL("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(const e of this.layers)if(e.stateful)return!0;return!1}resetStates(){zE(()=>{this.layers.forEach(e=>{e.stateful&&e.resetStates()})})}}function Jj(e,t,n){const r=t.length;if(null==e||Array.isArray(e)&&0===e.length)return t.map(e=>null);if(1===r)return Array.isArray(e)&&1===e.length?e:"object"===typeof e&&t[0]in e?[e[t[0]]]:[e];if(Array.isArray(e)){if(e.length!==r)throw new Error("Provided ".concat(n," is an array of ").concat(e.length," ")+"element(s), but the model has ".concat(r," outputs. ")+"Make sure a set of weights is provided for each model output.");return e}if("object"===typeof e&&Object.keys(e).length>0&&"object"===typeof e[Object.keys(e)[0]]){const n=[];return t.forEach(t=>{t in e?n.push(e[t]):n.push(null)}),n}throw new Error("The model has multiple (".concat(r,") outputs, ")+"so ".concat(n," must be either an array with ")+"".concat(r," elements or an object with ").concat(t," keys. ")+"Provided ".concat(n," not understood: ").concat(JSON.stringify(e)))}function Qj(e,t){return Jj(e,t,"classWeight")}async function Zj(e,t,n,r){if(null!=t||null!=r)throw new Error("Support sampleWeight is not implemented yet");if(null!=n){const t=zE(()=>{if(1===e.shape.length)return _I(e);if(2===e.shape.length){if(e.shape[1]>1){return MT(e,1)}if(1===e.shape[1])return ZT(e,[e.shape[0]]);throw new Error("Encountered unexpected last-dimension size (".concat(e.shape[1],") ")+"during handling of class weights. The size is expected to be >= 1.")}throw new Error("Unexpected rank of target (y) tensor (".concat(e.rank,") during ")+"handling of class weights. The rank is expected to be 1 or 2.")}),r=Array.from(await t.data());UE(t);const a=[];return r.forEach(e=>{if(null==n[e])throw new Error("classWeight must contain all classes in the training data. "+"The class ".concat(e," exists in the data but not in ")+"classWeight");a.push(n[e])}),FA(a,"float32")}return null}function eB(e,t){return OI(e,t)}function tB(e,t){let n,r;const a=t;n=a.xs,r=a.ys,mw(null!=n&&null!=r,()=>"A Dataset iterator for fitDataset() is expected to generate objects of the form `{xs: xVal, ys: yVal}`, where the two values may be `tf.Tensor`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates "+"".concat(t));const i=nB("input",e.inputNames,n),o=nB("output",e.outputNames,r),s=i[0].shape[0];mw(i.length===e.inputs.length,()=>"LayersModel has ".concat(e.inputs.length," inputs, but the dataset ")+"provides ".concat(i.length," inputs.  (Expected input keys: ")+"".concat(JSON.stringify(e.inputNames),")")),mw(o.length===e.outputs.length,()=>"LayersModel has ".concat(e.outputs.length," outputs, but the dataset ")+"provides ".concat(o.length," outputs.  (Expected output keys: ")+"".concat(JSON.stringify(e.outputNames),")"));for(let c=0;c<i.length;c++)mw(i[c].shape[0]===s,()=>"Batch size mismatch: input "+"".concat(e.inputNames[c]," has ").concat(i[c].shape[0],"; ")+"expected  ".concat(s," based on input ").concat(e.inputNames[0],"."));for(let c=0;c<o.length;c++)mw(o[c].shape[0]===s,()=>"Batch size mismatch: output "+"".concat(e.outputNames[c]," has ").concat(o[c].shape[0],"; ")+"expected  ".concat(s," based on input ").concat(e.inputNames[0],"."));return{xs:i,ys:o}}function nB(e,t,n){if(n instanceof tE)return[n];if(Array.isArray(n))return mw(n.length===t.length,()=>"Received an array of ".concat(n.length," Tensors, but expected ").concat(t.length," to match the ").concat(e," keys ").concat(t,".")),n;{const r=[];for(const a of t){if(null==n[a])throw new qL("The feature data generated by the dataset lacks the required "+"".concat(e," key '").concat(a,"'."));r.push(n[a])}return r}}async function rB(e,t,n){const r=null!=n.batchesPerEpoch;if(mw(null!=e.optimizer,()=>"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."),mw(null!=n,()=>"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."),mw(null!=n.epochs&&n.epochs>0&&Number.isInteger(n.epochs),()=>"For fitDataset(), config.epochs is expected to be a positive "+"integer, but got ".concat(n.epochs)),mw(!r||n.batchesPerEpoch>0&&Number.isInteger(n.batchesPerEpoch),()=>"For fitDataset(), config.batchesPerEpoch is expected to be a "+"positive integer if specified, but got ".concat(n.batchesPerEpoch)),mw(null==n.validationSplit,()=>"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."),e.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");e.isTraining=!0;try{const a=null!=n.validationData;let i,o;if(a)if(aB(n.validationData))mw(null==n.validationBatches||n.validationBatches>0&&Number.isInteger(n.validationBatches),()=>"For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, "+"but got ".concat(n.validationBatches));else{const e=function(e){if(3===e.length)throw new KL("Validation with sample weights is not implemented yet.");return{xs:e[0],ys:e[1]}}(n.validationData);i=e.xs,o=e.ys}const s=e.makeTrainFunction(),c=e.getDedupedMetricsNames();let l;l=a?c.slice().concat(c.map(e=>"val_"+e)):c.slice();const u=fj(n.callbacks,n.yieldEvery),h=null==n.verbose?1:n.verbose,{callbackList:d,history:f}=mj(u,h,n.epochs,null,null,function(e,t){let n=null;null!=t.batchesPerEpoch?n=t.batchesPerEpoch:Number.isFinite(e.size)&&(n=e.size);return n}(t,n),null,a,l);d.setModel(e),e.history=f,await d.onTrainBegin(),e.stopTraining_=!1;let p=null==n.initialEpoch?0:n.initialEpoch,m=await t.iterator();for(;p<n.epochs;){const l={};await d.onEpochBegin(p);let u=0,h=0;for(r||(m=await t.iterator());!r||u<n.batchesPerEpoch;){const t=await m.next();if(r&&t.done){console.warn("You provided `batchesPerEpoch` as "+"".concat(n.batchesPerEpoch,", ")+"but your dataset iterator ran out of data after "+"".concat(u," batches; ")+"interrupting training. Make sure that your dataset can generate at least `batchesPerEpoch * epochs` batches (in this case, "+"".concat(n.batchesPerEpoch*n.epochs," batches). ")+"You may need to use the repeat() function when building your dataset.");break}if(null!=t.value){const{xs:r,ys:a}=tB(e,t.value),i={};i.batch=h,i.size=r[0].shape[0],await d.onBatchBegin(h,i);const o=[];if(null!=n.classWeight){const t=Qj(n.classWeight,e.outputNames);for(let e=0;e<t.length;++e)o.push(await Zj(a[e],null,t[e]))}const l=r.concat(a).concat(o),f=s(l);UE(l);for(let e=0;e<c.length;++e){const t=c[e],n=f[e];i[t]=n,WE(n)}await d.onBatchEnd(h,i),oj(i),h++,u++}if(r?u>=n.batchesPerEpoch:t.done){if(a){let t;t=aB(n.validationData)?eP(await e.evaluateDataset(n.validationData,{batches:n.validationBatches})):eP(e.evaluate(i,o,{batchSize:null==n.validationBatchSize?32:n.validationBatchSize,verbose:0}));for(let n=0;n<e.metricsNames.length;++n)l["val_".concat(e.metricsNames[n])]=t[n]}break}if(e.stopTraining_)break}if(await d.onEpochEnd(p,l),p++,e.stopTraining_)break}return await d.onTrainEnd(),await e.history.syncData(),e.history}finally{e.isTraining=!1}}function aB(e){return"function"===typeof e.iterator}function iB(e){mw(e>0&&Number.isInteger(e),()=>"batchSize is required to be a positive integer, but got ".concat(e))}function oB(e,t,n){return null==e?[null]:Array.isArray(e)?e.map(e=>VP(e,t,n-t)):VP(e,t,n-t)}function sB(e,t){return zE(()=>null==e?null:Array.isArray(e)?e.map(e=>sB(e,t)):JP(e,"int32"===t.dtype?t:TI(t,"int32")))}function cB(e,t){const n=[];let r=0,a=null;for(;r<e;)a=r+t,a>=e&&(a=e),n.push([r,a]),r=a;return n}function lB(e){const t=[];e instanceof tE&&(e=[e]);for(let n=0;n<e.length;++n){const r=e[n];if(1===r.rank)t.push(WP(r,1));else{if(0===r.rank)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");t.push(r)}}return t}function uB(e,t){if(null==e)return;const n=[];if(t instanceof tE)n.push(t.id);else if(Array.isArray(t))t.forEach(e=>n.push(e.id));else if(null!=t)for(const a in t){const e=t[a];n.push(e.id)}const r=[];if(e instanceof tE)-1===n.indexOf(e.id)&&r.push(e);else if(Array.isArray(e))e.forEach(e=>{-1===n.indexOf(e.id)&&r.push(e)});else if(null!=e)for(const a in e){const t=e[a];-1===n.indexOf(t.id)&&r.push(t)}r.forEach(e=>{e.isDisposed||e.dispose()})}function hB(e){return Array.isArray(e)}function dB(e){return!function(e){return e instanceof tE}(e)&&!hB(e)}function fB(e,t,n){let r,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";if(null==t||0===t.length){if(null!=e){let t=!1;if(hB(e)&&e.length>0)t=!0;else if(dB(e)){for(const n in e)if(e.hasOwnProperty(n)){t=!0;break}}else t=!0;if(t)throw new qL("Error when checking model ".concat(i," expected no data, ")+"but got ".concat(e))}return[]}if(null==e)return t.map(e=>null);if(dB(e)){r=[];for(const n of t){if(null==e[n])throw new qL('No data provided for "'.concat(n,'". Need data for each key in: ')+"".concat(t));r.push(e[n])}}else if(hB(e)){if(e.length!==t.length)throw new qL("Error when checking model ".concat(i,": the Array of ")+"Tensors that you are passing to your model is not the size the "+"model expected. Expected to see ".concat(t.length," Tensor(s), but ")+"instead got the following list of Tensor(s): ".concat(e));r=e}else{if(t.length>1)throw new qL("The model ".concat(i," expects ").concat(t.length," Tensor(s), ")+"but only received one Tensor. Found: Tensor with shape ".concat(e.shape));r=[e]}if(r=lB(r),null!=n)for(let o=0;o<t.length;++o){if(null==n[o])continue;const e=r[o];if(e.shape.length!==n[o].length)throw new qL("Error when checking ".concat(i,": expected ").concat(t[o]," ")+"to have ".concat(n[o].length," dimension(s). but got array with ")+"shape ".concat(e.shape));for(let t=0;t<n[o].length;++t){if(0===t&&!a)continue;const r=e.shape[t],s=n[o][t];if(null!=s&&s>=0&&r!==s)throw new qL("".concat(i," expected a batch of elements where each ")+"example has shape [".concat(n[o].slice(1,n[o].length),"] ")+"(i.e.,tensor shape [*,".concat(n[o].slice(1,n[o].length),"])")+" but the ".concat(i," received an input with ").concat(e.shape[0])+" examples, each with shape [".concat(e.shape.slice(1,e.shape.length),"]")+" (tensor shape [".concat(e.shape,"])"))}}return r}function pB(e,t,n){let r,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";if(Array.isArray(e)){if(e.length!==t.length)throw new qL("Error when checking model ".concat(i,": the Array of ")+"Tensors that you are passing to your model is not the size the "+"the model expected. Expected to see ".concat(t.length," Tensor(s),")+" but instead got ".concat(e.length," Tensors(s)."));r=e}else{if(t.length>1)throw new qL("The model expects ".concat(t.length," ").concat(i," Tensors, ")+"but only received one Tensor. Found: array with shape "+"".concat(JSON.stringify(e.shape),"."));r=[e]}if(null!=n)for(let o=0;o<t.length;++o){if(null==n[o])continue;const e=r[o];if(e.shape.length!==n[o].length)throw new qL("Error when checking ".concat(i,": expected ").concat(t[o]," ")+"to have ".concat(n[o].length," dimension(s), but got array with ")+"shape ".concat(JSON.stringify(e.shape)));for(let r=0;r<n[o].length;++r){if(0===r&&!a)continue;const s=e.shape[r],c=n[o][r];if(null!=c&&c!==s)throw new qL("Error when checking ".concat(i,": expected ")+"".concat(t[o]," to have shape ").concat(JSON.stringify(n[o])," but ")+"got array with shape ".concat(JSON.stringify(e.shape),"."))}}}class mB extends $j{constructor(e){super(e),this.isTraining=!1}summary(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:console.log;if(!this.built)throw new qL("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");Wj(this,e,t,n)}compile(e){if(null==e.loss&&(e.loss=[]),this.loss=e.loss,"string"===typeof e.optimizer)this.optimizer_=function(e){const t={Adagrad:()=>WR.adagrad(.01),Adadelta:()=>WR.adadelta(1,.95,zP()),Adam:()=>WR.adam(.001,.9,.999,zP()),Adamax:()=>WR.adamax(.002,.9,.999,zP(),0),RMSProp:()=>WR.rmsprop(.001,.9,0,zP()),SGD:()=>WR.sgd(.01)};if(t.adagrad=t.Adagrad,t.adadelta=t.Adadelta,t.adam=t.Adam,t.adamax=t.Adamax,t.rmsprop=t.RMSProp,t.sgd=t.SGD,e in t)return t[e]();throw new qL("Unknown Optimizer ".concat(e))}(e.optimizer),this.isOptimizerOwned=!0;else{if(!(e.optimizer instanceof GI))throw new qL("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=e.optimizer,this.isOptimizerOwned=!1}let t=[];if(Array.isArray(e.loss)||"string"===typeof e.loss||"function"===typeof e.loss)if(Array.isArray(e.loss)){if(e.loss.length!==this.outputs.length)throw new qL("When passing an Array as loss, it should have one entry per "+"model output. The model has ".concat(this.outputs.length," output(s), ")+"but you passed loss=".concat(e.loss,"."));const n=e.loss;t=n.map(e=>Tj(e))}else{const n=Tj(e.loss);this.outputs.forEach(e=>{t.push(n)})}else{e.loss=e.loss;for(const t in e.loss)if(-1===this.outputNames.indexOf(t))throw new qL('Unknown entry in loss dictionary: "'.concat(t,'". ')+"Only expected the following keys: ".concat(this.outputNames));for(const n of this.outputNames)null==e.loss[n]&&console.warn('Output "'.concat(n,'" is missing from loss dictionary. We assume ')+"this was done on purpose, and we will not be expecting data "+"to be passed to ".concat(n," during training")),t.push(Tj(e.loss[n]))}this.lossFunctions=t,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(let i=0;i<this.outputs.length;++i){const e=this.internalOutputShapes[i],t=this.outputNames[i];this.feedOutputNames.push(t),this.feedOutputShapes.push(e),this.feedLossFns.push(this.lossFunctions[i])}const n=[];this.metrics=e.metrics,this.metricsNames=["loss"],this.metricsTensors=[],_P("loss",()=>{for(let e=0;e<this.outputs.length;++e){if(-1!==n.indexOf(e))continue;const t=this.lossFunctions[e];this.outputs.length>1&&(this.metricsTensors.push([t,e]),this.metricsNames.push(this.outputNames[e]+"_loss"))}});const r=function(e,t){if(null==e||Array.isArray(e)&&0===e.length)return t.map(e=>[]);let n;if("string"===typeof e||"function"===typeof e)n=[e];else{if(!Array.isArray(e)&&"object"!==typeof e)throw new TypeError("Type of metrics argument not understood. Expected an string,"+"function, Array, or Object, found: ".concat(e));n=e}if(Array.isArray(n))return t.map(e=>n);{const e=[];for(const r of t){let t=n.hasOwnProperty(r)?n[r]:[];Array.isArray(t)||(t=[t]),e.push(t)}return e}}(e.metrics,this.outputNames),a=(e,t,n)=>{this.outputNames.length>1&&(t=this.outputNames[e]+"_"+t),this.metricsNames.push(t),this.metricsTensors.push([n,e])};_P("metric",()=>{for(let e=0;e<this.outputs.length;++e){if(-1!==n.indexOf(e))continue;(t=>{let n,r,i;for(const o of t){if("string"===typeof o&&-1!==["accuracy","acc","crossentropy","ce"].indexOf(o)){const t=this.internalOutputShapes[e];let a;1===t[t.length-1]||this.lossFunctions[e]===Nj?-1!==["accuracy","acc"].indexOf(o)?r=_j:-1!==["crossentropy","ce"].indexOf(o)&&(r=Fj):this.lossFunctions[e]===Sj?-1!==["accuracy","acc"].indexOf(o)?r=Dj:-1!==["crossentropy","ce"].indexOf(o)&&(r=Lj):-1!==["accuracy","acc"].indexOf(o)?r=Aj:-1!==["crossentropy","ce"].indexOf(o)&&(r=Oj),-1!==["accuracy","acc"].indexOf(o)?a="acc":-1!==["crossentropy","ce"].indexOf(o)&&(a="ce"),i=r,n=""+a}else{const e=Mj(o);i=e,n=""+jj(o)}let t;_P(n,()=>{t=i}),a(e,n,t)}})(r[e])}}),this.collectedTrainableWeights=this.trainableWeights}checkTrainableWeightsConsistency(){null!=this.collectedTrainableWeights&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")}evaluate(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=null==n.batchSize?32:n.batchSize;iB(r);const a=this.standardizeUserDataXY(e,t,!0,r);try{const e=a[0].concat(a[1]);this.makeTestFunction();const t=this.testFunction;return ZL(this.testLoop(t,e,r,n.verbose,n.steps))}finally{uB(a[0],e),uB(a[1],t)}}async evaluateDataset(e,t){return this.makeTestFunction(),async function(e,t,n){const r=null!=(n=n||{}).batches,a=e.testFunction;let i=[];if(n.verbose>0)throw new KL("Verbose mode is not implemented yet.");mw(!r||n.batches>0&&Number.isInteger(n.batches),()=>"Test loop expects `batches` to be a positive integer, but "+"received ".concat(JSON.stringify(n.batches)));const o=function(e){return"function"===typeof e.next}(t)?t:await t.iterator();let s=0,c=0;for(;!r||c<n.batches;){const t=await o.next();if(i=zE(()=>{if(t.value){const{xs:n,ys:r}=tB(e,t.value),o=n.concat(r),l=zE(()=>a(o));if(UE(o),0===c)for(let e=0;e<l.length;++e)i.push(BI(0));const u=o[0].shape[0];for(let e=0;e<l.length;++e){const t=l[e],n=i[e];i[e]=zE(()=>RI(i[e],OI(u,t))),c>0&&UE(n)}UE(l),s+=u,++c}return i}),t.done){r&&console.warn("Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least `batches` "+"batches (in this case, ".concat(n.batches," batches). ")+"You may need to use the repeat() function when building your dataset.");break}}for(let l=0;l<i.length;++l){const e=i[l];i[l]=DI(i[l],s),UE(e)}return ZL(i)}(this,e,t)}checkNumSamples(e,t,n){let r,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"steps";if(null!=n){if(r=null,null!=t)throw new qL("If ".concat(a," is set, batchSize must be null or undefined.")+"Got batchSize = ".concat(t))}else{if(null==e)throw new qL("Either the input data should have a defined shape, or "+"".concat(a," shoud be specified."));r=Array.isArray(e)?e[0].shape[0]:e.shape[0]}return r}execute(e,t){if(Array.isArray(t)&&0===t.length)throw new qL("`outputs` is an empty Array, which is not allowed.");const n=Array.isArray(t),r=n?t:[t],a=this.retrieveSymbolicTensors(r),i=new WM;if(e instanceof tE&&(e=[e]),Array.isArray(e)){if(e.length!==this.inputs.length)throw new qL("The number of inputs provided (".concat(e.length,") ")+"does not match the number of inputs of this model "+"(".concat(this.inputs.length,")."));for(let t=0;t<this.inputs.length;++t)i.add(this.inputs[t],e[t])}else for(const s of this.inputs){const t=e[s.name];if(null==t)throw new qL("No value is provided for the model's input ".concat(s.name));i.add(s,t)}const o=GM(a,i);return n?o:o[0]}retrieveSymbolicTensors(e){const t=$L(null,e.length);let n=e.length;for(const r of this.layers){const a=Array.isArray(r.output)?r.output:[r.output],i=a.map(e=>e.name);for(let r=0;r<e.length;++r){const o=i.indexOf(e[r]);if(-1!==o&&(t[r]=a[o],n--),0===n)break}if(0===n)break}if(n>0){const n=[];throw t.forEach((t,r)=>{null==t&&n.push(e[r])}),new qL("Cannot find SymbolicTensors for output name(s): "+"".concat(JSON.stringify(n)))}return t}predictLoop(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return zE(()=>{const r=this.checkNumSamples(e);if(n)throw new KL("Verbose predictLoop() is not implemented yet.");const a=cB(r,t),i=this.outputs.map(e=>[]);for(let t=0;t<a.length;++t){const n=zE(()=>{const n=a[t][0],r=a[t][1],i=oB(e,n,r),o=[];if(Array.isArray(i))for(let e=0;e<i.length;++e)o.push({key:this.inputs[e],value:i[e]});else o.push({key:this.inputs[0],value:i});const s=new WM(o);return GM(this.outputs,s)});n.forEach((e,t)=>i[t].push(e))}return ZL(i.map(e=>c_(e,0)))})}predict(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=lB(e);pB(n,this.inputNames,this.feedInputShapes,!1);try{const e=null==t.batchSize?32:t.batchSize;return iB(e),this.predictLoop(n,e)}finally{uB(n,e)}}predictOnBatch(e){pB(e,this.inputNames,this.feedInputShapes,!0);const t=(Array.isArray(e)?e[0]:e).shape[0];return this.predictLoop(e,t)}standardizeUserDataXY(e,t){let n=arguments.length>3?arguments[3]:void 0;if(null==this.optimizer_)throw new GL("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");const r=[];for(let a=0;a<this.feedOutputShapes.length;++a){const e=this.feedOutputShapes[a];this.feedLossFns[a]===Sj?r.push(e.slice(0,e.length-1).concat([1])):r.push(e)}if(function(e,t){const n=cP(e.map(e=>e.shape[0]));n.sort();const r=cP(t.map(e=>e.shape[0]));if(r.sort(),n.length>1)throw new qL("All input Tensors (x) should have the same number of samples. Got array shapes: "+"".concat(JSON.stringify(e.map(e=>e.shape))));if(r.length>1)throw new qL("All target Tensors (y) should have the same number of samples. Got array shapes: "+"".concat(JSON.stringify(t.map(e=>e.shape))));if(n.length>0&&r.length>0&&!yw(n,r))throw new qL("Input Tensors should have the same number of samples as target "+"Tensors. Found ".concat(n[0]," input sample(s) and ").concat(r[0]," target ")+"sample(s).")}(e=fB(e,this.feedInputNames,this.feedInputShapes,!1,"input"),t=fB(t,this.feedOutputNames,r,!1,"target")),function(e,t,n){const r=[bj,Nj,kj];for(let a=0;a<e.length;++a){const i=e[a],o=t[a],s=n[a];if(null!=o){if(o===kj&&1===i.shape[i.shape.length-1])throw new qL("You are passing a target array of shape ".concat(i.shape," while using ")+"a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].");if(-1!==r.indexOf(o)){const e=i.shape.slice(1),t=s.slice(1);for(let n=0;n<e.length;++n){const r=e[n],a=t[n];if(null!=a&&r!==a)throw new qL("A target Tensor with shape ".concat(i.shape," was passed for an ")+"output of shape ".concat(s,", while using a loss function that ")+"expects targets to have the same shape as the output.")}}}}}(t,this.feedLossFns,this.feedOutputShapes),this.stateful&&null!=n&&n>0&&e[0].shape[0]%n!==0)throw new qL("In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size "+"".concat(n,". Found: ").concat(e[0].shape[0]," sample(s)."));return[e,t]}async standardizeUserData(e,t,n,r){let a=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],i=arguments.length>5?arguments[5]:void 0;const[o,s]=this.standardizeUserDataXY(e,t,a,i);if(null!=n)throw new Error("sample weight is not supported yet.");let c=null;if(null!=r){const e=Qj(r,this.outputNames);c=[];for(let t=0;t<e.length;++t)c.push(await Zj(s[t],null,e[t]))}return[o,s,c]}testLoop(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4?arguments[4]:void 0;return zE(()=>{const i=this.checkNumSamples(t,n,a,"steps"),o=[];if(r>0)throw new KL("Verbose mode is not implemented yet.");if(null!=a)throw new KL("steps mode in testLoop() is not implemented yet");{const r=cB(i,n),a=FA(jP(0,i));for(let n=0;n<r.length;++n){const i=r[n][0],s=r[n][1],c=VP(a,i,s-i),l=sB(t,c),u=e(l);if(0===n)for(let e=0;e<u.length;++e)o.push(BI(0));for(let e=0;e<u.length;++e){const t=u[e];o[e]=RI(o[e],OI(s-i,t))}}for(let e=0;e<o.length;++e)o[e]=DI(o[e],i)}return o})}getDedupedMetricsNames(){const e=this.metricsNames,t=[];for(let n=0;n<e.length;++n){const r=e[n];let a=r;if(QL(e,r)>1){const t=QL(e.slice(0,n),r);a+="_".concat(t)}t.push(a)}return t}makeTrainFunction(){return e=>{const t=[],n=e.slice(0,this.inputs.length),r=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),a=e.slice(this.inputs.length+this.outputs.length,this.inputs.length+2*this.outputs.length),i=[],o=this.collectedTrainableWeights.map(e=>e.read()),s=this.optimizer_.minimize(()=>{const e=[];for(let t=0;t<this.inputs.length;++t)e.push({key:this.inputs[t],value:n[t]});const o=new WM(e),s=GM(this.outputs,o,{training:!0});let c;for(let n=0;n<this.lossFunctions.length;++n){let e=(0,this.lossFunctions[n])(r[n],s[n]);null!=a[n]&&(e=eB(e,a[n]));const i=Q_(e);t.push(i),c=0===n?e:RI(c,e)}for(let n=0;n<this.metricsTensors.length;++n){let e;if(this.outputs.length>1&&n<this.outputs.length)e=t[n];else{const t=this.metricsTensors[n][0],a=this.metricsTensors[n][1];e=Q_(t(r[a],s[a]))}WE(e),i.push(e)}return c=Q_(c),this.calculateLosses().forEach(e=>{c=RI(c,e)}),c},!0,o);return[s].concat(i)}}makeTestFunction(){this.testFunction=e=>zE(()=>{const t=[];let n;const r=e.slice(0,this.inputs.length),a=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),i=[];for(let e=0;e<this.inputs.length;++e)i.push({key:this.inputs[e],value:r[e]});const o=new WM(i),s=GM(this.outputs,o);for(let e=0;e<this.lossFunctions.length;++e){const r=this.lossFunctions[e],i=Q_(r(a[e],s[e]));n=0===e?i:RI(n,i),t.push(n)}for(let e=0;e<this.metricsTensors.length;++e){const n=this.metricsTensors[e][0],r=this.metricsTensors[e][1],i=Q_(n(a[r],s[r]));t.push(i)}return t})}async fit(e,t){let n,r,a,i,o,s,c,l,u,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(this.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");this.isTraining=!0;try{const d=null==h.batchSize?32:h.batchSize;iB(d);const f=!1,p=await this.standardizeUserData(e,t,h.sampleWeight,h.classWeight,f,d);n=p[0],r=p[1],u=p[2];let m,g=!1;if(null!=h.validationData&&h.validationData.length>0){if(g=!0,2!==h.validationData.length)throw 3===h.validationData.length?new KL("validationData including sample weights is not supported yet."):new qL("When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; "+"".concat(h.validationData," is invalid."));o=h.validationData[0],s=h.validationData[1];const e=!0,t=await this.standardizeUserData(o,s,null,null,e,d);c=t[0],l=t[1],m=c.concat(l)}else if(null!=h.validationSplit&&h.validationSplit>0&&h.validationSplit<1){g=!0;const e=Math.floor(n[0].shape[0]*(1-h.validationSplit)),t=n[0].shape[0];c=oB(n,e,t),a=n,n=oB(n,0,e),l=oB(r,e,t),i=r,r=oB(r,0,e),m=c.concat(l)}else null!=h.validationSteps&&(g=!0);const v=n.concat(r).concat(u);this.checkTrainableWeightsConsistency();const b=this.makeTrainFunction(),y=this.getDedupedMetricsNames();let x,w;g?(this.makeTestFunction(),x=this.testFunction,w=y.slice().concat(y.map(e=>"val_"+e))):(x=null,m=[],w=y.slice());const k=fj(h.callbacks,h.yieldEvery);return await this.fitLoop(b,v,y,d,h.epochs,h.verbose,k,x,m,h.shuffle,w,h.initialEpoch,null,null)}finally{this.isTraining=!1,uB(n,e),uB(r,t),uB(a,e),uB(i,t),uB(c,o),uB(l,s),null!=u&&UE(u)}}async fitLoop(e,t,n,r,a,i,o,s,c,l,u,h,d,f){null==r&&(r=32),null==a&&(a=1),null==l&&(l=!0),null==h&&(h=0);let p=!1;if(null!=s&&null!=c&&(p=!0),null!=f&&(p=!0,null==d))throw new qL("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");const m=this.checkNumSamples(t,r,d,"steps_per_epoch");let g;null!=m&&(g=jP(0,m)),null==i&&(i=1);const{callbackList:v,history:b}=mj(o,i,a,h,m,d,r,p,u);v.setModel(this),this.history=b,await v.onTrainBegin(),this.stopTraining_=!1;for(let y=h;y<a;++y){await v.onEpochBegin(y);const a={};if(null!=d)throw new KL("stepsPerEpoch mode is not implemented yet.");{if("batch"===l)throw new KL("batch shuffling is not implemneted yet");l&&hw(g);const i=FA(g),o=cB(m,r);for(let l=0;l<o.length;++l){const u={};if(await v.onBatchBegin(l,u),zE(()=>{const h=o[l][0],d=o[l][1],f=VP(i,h,d-h);u.batch=l,u.size=d-h;const m=sB(t,f),g=e(m);for(let e=0;e<n.length;++e){const t=n[e],r=g[e];u[t]=r,WE(r)}if(l===o.length-1&&p){const e=this.testLoop(s,c,r);for(let t=0;t<n.length;++t){const r=n[t],i=e[t];WE(i),a["val_"+r]=i}}}),await v.onBatchEnd(l,u),oj(u),this.stopTraining_)break}i.dispose()}if(await v.onEpochEnd(y,a),this.stopTraining_)break}return await v.onTrainEnd(),await this.history.syncData(),this.history}async fitDataset(e,t){return rB(this,e,t)}async trainOnBatch(e,t){const n=await this.standardizeUserData(e,t),r=n[0],a=n[1],i=this.makeTrainFunction()(r.concat(a)),o=[];for(const s of i){const e=await s.data();o.push(e[0])}return UE(i),uB(n[0],e),uB(n[1],t),ZL(o)}getNamedWeights(e){const t=[],n=null!=e&&e.trainableOnly,r=n?this.trainableWeights:this.weights,a=this.getWeights(n);for(let i=0;i<r.length;++i)n&&!r[i].trainable||t.push({name:r[i].originalName,tensor:a[i]});return t}set stopTraining(e){this.stopTraining_=e}get stopTraining(){return this.stopTraining_}get optimizer(){return this.optimizer_}set optimizer(e){this.optimizer_!==e&&(this.optimizer_=e,this.isOptimizerOwned=!1)}dispose(){const e=super.dispose();if(0===e.refCountAfterDispose&&null!=this.optimizer&&this.isOptimizerOwned){const t=BE().numTensors;this.optimizer_.dispose(),e.numDisposedVariables+=t-BE().numTensors}return e}getLossIdentifiers(){let e;if("string"===typeof this.loss)e=tP(this.loss);else if(Array.isArray(this.loss)){for(const e of this.loss)if("string"!==typeof e)throw new Error("Serialization of non-string loss is not supported.");e=this.loss.map(e=>tP(e))}else{const t=Object.keys(this.loss);e={};const n=this.loss;for(const r of t){if("string"!==typeof n[r])throw new Error("Serialization of non-string loss is not supported.");e[r]=tP(n[r])}}return e}getMetricIdentifiers(){if("string"===typeof this.metrics||"function"===typeof this.metrics)return[tP(jj(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map(e=>tP(jj(e)));{const e={};for(const t in this.metrics)e[t]=tP(jj(this.metrics[t]));return e}}getTrainingConfig(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}loadTrainingConfig(e){if(null!=e.weighted_metrics)throw new Error("Loading weight_metrics is not supported yet.");if(null!=e.loss_weights)throw new Error("Loading loss_weights is not supported yet.");if(null!=e.sample_weight_mode)throw new Error("Loading sample_weight_mode is not supported yet.");const t=gj(Kj(e.optimizer_config));let n,r;if("string"===typeof e.loss)n=nP(e.loss);else if(Array.isArray(e.loss))n=e.loss.map(e=>nP(e));else if(null!=e.loss){n={};for(const t in e.loss)n[t]=nP(e.loss[t])}if(Array.isArray(e.metrics))r=e.metrics.map(e=>nP(e));else if(null!=e.metrics){r={};for(const t in e.metrics)r[t]=nP(e.metrics[t])}this.compile({loss:n,metrics:r,optimizer:t})}async save(e,t){if("string"===typeof e){const t=(e=>ZE.getSaveHandlers(e))(e);if(0===t.length)throw new qL("Cannot find any save handlers for URL '".concat(e,"'"));if(t.length>1)throw new qL("Found more than one (".concat(t.length,") save handlers for ")+"URL '".concat(e,"'"));e=t[0]}if(null==e.save)throw new qL("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");const n=await GE(this.getNamedWeights(t)),r={modelTopology:this.toJSON(null,!1),format:"layers-model",generatedBy:"TensorFlow.js tfjs-layers v".concat(Yj),convertedBy:null};if(null!=t&&t.includeOptimizer&&null!=this.optimizer){r.trainingConfig=this.getTrainingConfig();const e="optimizer",{data:t,specs:i}=await GE(await this.optimizer.getWeights(),e);n.specs.push(...i),n.data=(a=[n.data,t],ME.join(a))}var a;if(null!=this.userDefinedMetadata){const e=!0;zj(this.userDefinedMetadata,this.name,e),r.userDefinedMetadata=this.userDefinedMetadata}return r.weightData=n.data,r.weightSpecs=n.specs,e.save(r)}setUserDefinedMetadata(e){zj(e,this.name),this.userDefinedMetadata=e}getUserDefinedMetadata(){return this.userDefinedMetadata}}mB.className="Model",HI(mB);class gB extends mB{}gB.className="Functional",HI(gB);class vB extends mB{constructor(e){if(super({inputs:[],outputs:[]}),e=e||{},this.trainable=!0,this.built=!1,this.name=null!=e.name?e.name:bP("sequential_"),null!=e.layers)for(const t of e.layers)this.add(t)}checkShape(e){if(e.inboundNodes[0].outputTensors[0].shape.some(e=>e<0))throw new qL("Negative dimension size caused by adding layer "+"".concat(e.name," with input shape [")+"".concat(e.inboundNodes[0].inputTensors[0].shape,"]"))}add(e){const t=e instanceof vB||e instanceof mB;let n;if(t){if(n=e,1!==n.outputs.length)throw new qL("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(1!==n.inputs.length)throw new qL("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(0===this.outputs.length){if(0===e.inboundNodes.length){if(null==e.batchInputShape)throw new qL("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");const t=function(e){if(null==e.batchShape&&null==e.shape)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(null!=e.batchShape&&null!=e.shape)throw new qL("Please provide either a `shape` or `batchShape` argument to Input, but not both.");let t=e.batchShape;null!=e.shape&&null==t&&(t=[null].concat(e.shape));let n=e.dtype;return null==n&&(n="float32"),new UM({batchInputShape:t,name:e.name,dtype:n,sparse:e.sparse}).inboundNodes[0].outputTensors[0]}({batchShape:e.batchInputShape,dtype:e.dtype,name:e.name+"_input"});e.apply(t)}if(t)this.outputs=n.outputs,this.inputs=n.inputs;else{if(1!==e.inboundNodes.length)throw new qL("A layer added to a Sequential model must not already be "+"connected somewhere else. LayersModel received layer ".concat(e.name," ")+"which has ".concat(e.inboundNodes.length," pre-existing inbound ")+"connections.");if(1!==e.inboundNodes[0].outputTensors.length)throw new qL("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[e.inboundNodes[0].outputTensors[0]],this.inputs=zM(this.outputs[0])}this.inboundNodes=[],new MM({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:$L(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map(e=>e.shape),outputShapes:this.outputs[0].shape})}else{const t=e.apply(this.outputs[0]);if(Array.isArray(t))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[t],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(e),this.built=!1}pop(){if(0===this.layers.length)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),0===this.layers.length)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{const e=this.layers.length-1;this.layers[e].outboundNodes=[],this.outputs=[this.layers[e].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}call(e,t){return null==this.model&&this.build(),this.model.call(e,t)}build(e){if(TM(e),0===this.inputs.length||0===this.outputs.length)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new mB({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}countParams(){return this.built||this.build(),super.countParams()}summary(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:console.log;this.built||this.build(),super.summary(e,t,n)}setWeights(e){null==this.model&&this.build(),this.model.setWeights(e)}evaluate(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!this.built)throw new GL("The model needs to be compiled before being used.");return this.model.evaluate(e,t,n)}async evaluateDataset(e,t){if(!this.built)throw new GL("The model needs to be compiled before being used.");return this.model.evaluateDataset(e,t)}predict(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return null==this.model&&this.build(),this.model.predict(e,t)}predictOnBatch(e){return null==this.model&&this.build(),this.model.predictOnBatch(e)}compile(e){this.build(),this.model.compile(e),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}get optimizer(){return null==this.model?void 0:this.model.optimizer}set optimizer(e){this.model.optimizer=e}async fit(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!this.built)throw new GL("The model needs to be compiled before being used.");return this.model.fit(e,t,n)}async fitDataset(e,t){if(!this.built)throw new GL("The model needs to be compiled before being used.");return this.model.fitDataset(e,t)}async trainOnBatch(e,t){return this.model.trainOnBatch(e,t)}static fromConfig(e,t){let n,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a={};if(t instanceof Array){if(null==t[0].className||"Merge"===t[0].className)throw new qL("Legacy serialization format not supported yet.");n=t}else mw(null!=t.layers,()=>"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."),n=t.layers,delete t.layers,a=t;const i=new e(a);if(!(i instanceof vB))throw new KL("Sequential.fromConfig called on non-Sequential input: ".concat(i));for(const o of n){const e=gj(o,void 0,r);r&&e.setFastWeightInitDuringBuild(!0),i.add(e)}return i}set stopTraining(e){if(null==this.model)throw new qL("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=e}get stopTraining(){if(null==this.model)throw new qL("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining}getConfig(){const e=[];for(const t of this.layers){const n={};n.className=t.getClassName(),n.config=t.getConfig(),e.push(n)}return{name:this.name,layers:e}}}vB.className="Sequential",HI(vB);class bB extends WI{getConfig(){return{}}}class yB extends bB{apply(e){return function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(1!==t)throw new KL("Support for alpha values other than 1 (".concat(t,") is not implemented ")+"yet.");return k_(e)}(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}}yB.className="elu",HI(yB);class xB extends bB{apply(e){return bA(e)}}xB.className="selu",HI(xB);class wB extends bB{apply(e){return gA(e)}}wB.className="relu",HI(wB);class kB extends bB{apply(e){return zE(()=>eA(6,gA(e)))}}kB.className="relu6",HI(kB);class SB extends bB{apply(e){return e}}SB.className="linear",HI(SB);class NB extends bB{apply(e){return xA(e)}}NB.className="sigmoid",HI(NB);class CB extends bB{apply(e){return function(e){return zE(()=>{const t=RI(.5,OI(.2,e));return s_(t,0,1)})}(e)}}CB.className="hardSigmoid",HI(CB);class EB extends bB{apply(e){return IA(e)}}EB.className="softplus",HI(EB);class IB extends bB{apply(e){return function(e){return zE(()=>DI(e,RI(QI(e),1)))}(e)}}IB.className="softsign",HI(IB);class TB extends bB{apply(e){return RA(e)}}TB.className="tanh",HI(TB);class _B extends bB{apply(e){return EA(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1)}}_B.className="softmax",HI(_B);class AB extends bB{apply(e){return j_(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1)}}AB.className="logSoftmax",HI(AB);class RB extends bB{apply(e){return zE(()=>zE(()=>{const t=Math.sqrt(2),n=OI(.5,RI(1,N_(DI(e,t))));return OI(e,n)}))}}RB.className="gelu",HI(RB);class FB extends bB{apply(e){return zE(()=>OI(.5,OI(e,RI(1,RA(OI(LI(DI(2,Math.PI)),RI(e,OI(.044715,YI(e,3)))))))))}}FB.className="gelu_new",HI(FB);class DB extends bB{apply(e){return zE(()=>OI(e,RA(IA(e))))}}DB.className="mish",HI(DB);class OB extends bB{apply(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return zE(()=>OI(xA(OI(e,t)),e))}}function LB(e){return e.getClassName()}function PB(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return oP(e,VI.getMap().classNameMap,t,"activation")}function MB(e){if(null==e){const e={className:"linear",config:{}};return PB(e)}if("string"===typeof e){const t={};return t.className=e,t.config={},PB(t)}return e instanceof bB?e:PB(e)}function jB(e){if(null!=e&&"object"!==typeof e)throw new Error("Argument to L1L2 regularizer's constructor is expected to be an "+"object, but received: ".concat(e))}OB.className="swish",HI(OB);class BB extends WI{}class zB extends BB{constructor(e){super(),jB(e),this.l1=null==e||null==e.l1?.01:e.l1,this.l2=null==e||null==e.l2?.01:e.l2,this.hasL1=0!==this.l1,this.hasL2=0!==this.l2}apply(e){return zE(()=>{let t=iA([1]);return this.hasL1&&(t=RI(t,M_(OI(this.l1,QI(e))))),this.hasL2&&(t=RI(t,M_(OI(this.l2,QP(e))))),ZT(t,[])})}getConfig(){return{l1:this.l1,l2:this.l2}}static fromConfig(e,t){return new e({l1:t.l1,l2:t.l2})}}zB.className="L1L2",HI(zB);const UB={l1l2:"L1L2"};function WB(e){return aP(e)}function VB(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return oP(e,VI.getMap().classNameMap,t,"regularizer")}function HB(e){if(null==e)return null;if("string"===typeof e){return VB({className:e in UB?UB[e]:e,config:{}})}return e instanceof BB?e:VB(e)}class GB extends BM{constructor(e){super(null==e?{}:e),this.supportsMasking=!0,null!=e&&(this.maxValue=e.maxValue)}call(e,t){e=IM(e);let n=gA(e);return null!=this.maxValue&&(n=s_(n,0,this.maxValue)),n}computeOutputShape(e){return e}getConfig(){const e={maxValue:this.maxValue},t=super.getConfig();return Object.assign(e,t),e}}GB.className="ReLU",HI(GB);class qB extends BM{constructor(e){super(null==e?{}:e),this.DEFAULT_ALPHA=.3,null==e&&(e={}),this.alpha=null==e.alpha?this.DEFAULT_ALPHA:e.alpha}call(e,t){const n=IM(e);return D_(n,this.alpha)}computeOutputShape(e){return e}getConfig(){const e={alpha:this.alpha},t=super.getConfig();return Object.assign(e,t),e}}qB.className="LeakyReLU",HI(qB);class KB extends BM{constructor(e){if(super(null==e?{}:e),this.DEFAULT_ALPHA_INITIALIZER="zeros",null==e&&(e={}),this.supportsMasking=!0,this.alphaInitializer=NM(e.alphaInitializer||this.DEFAULT_ALPHA_INITIALIZER),this.alphaRegularizer=HB(e.alphaRegularizer),this.alphaConstraint=aj(e.alphaConstraint),null==e.sharedAxes)this.sharedAxes=null;else if(Array.isArray(e.sharedAxes))this.sharedAxes=e.sharedAxes;else{if("number"!==typeof e.sharedAxes)throw new qL("Expected sharedAxes to be a number or an array of numbers, "+"but got ".concat(e.sharedAxes));this.sharedAxes=[e.sharedAxes]}}build(e){const t=(e=TM(e)).slice(1);if(null!=this.sharedAxes)for(const r of this.sharedAxes)t[r-1]=1;this.alpha=this.addWeight("alpha",t,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);const n={};if(null!=this.sharedAxes)for(let r=1;r<e.length;++r)n[r]=e[r];this.inputSpec=[new OM({ndim:e.length,axes:n})],this.built=!0}call(e,t){return e=IM(e),lA(e,this.alpha.read())}getConfig(){const e={alphaInitializer:SM(this.alphaInitializer),alphaRegularizer:WB(this.alphaRegularizer),alphaConstraint:nj(this.alphaConstraint),sharedAxes:this.sharedAxes},t=super.getConfig();return Object.assign(e,t),e}}KB.className="PReLU",HI(KB);class XB extends BM{constructor(e){if(super(null==e?{}:e),this.DEFAULT_ALPHA=1,null==e&&(e={}),null!=e.alpha&&e.alpha!==this.DEFAULT_ALPHA)throw new KL("Non-default alpha value (".concat(e.alpha,") is not supported by the ")+"ELU layer yet.");this.alpha=null==e.alpha?this.DEFAULT_ALPHA:e.alpha}call(e,t){const n=IM(e);return k_(n)}computeOutputShape(e){return e}getConfig(){const e={alpha:this.alpha},t=super.getConfig();return Object.assign(e,t),e}}XB.className="ELU",HI(XB);class YB extends BM{constructor(e){super(null==e?{}:e),this.DEFAULT_THETA=1,null==e&&(e={}),this.theta=null==e.theta?this.DEFAULT_THETA:e.theta}call(e,t){const n=IM(e);return OI(n,TI(R_(n,this.theta),"float32"))}computeOutputShape(e){return e}getConfig(){const e={theta:this.theta},t=super.getConfig();return Object.assign(e,t),e}}YB.className="ThresholdedReLU",HI(YB);class $B extends BM{constructor(e){super(null==e?{}:e),this.DEFAULT_AXIS=1,null==e&&(e={}),this.softmax=(new _B).apply,this.axis=null==e.axis?this.DEFAULT_AXIS:e.axis}call(e,t){return zE(()=>{let n=IM(e);const r=t.mask;if(null!=r){const e=OI($I(oA(n.shape),TI(r,n.dtype)),BI(-1e9));n=RI(n,e)}return this.axis instanceof Array?this.axis.length>1?C_($I(n,K_(n,this.axis,!0))):this.softmax(n,this.axis[0]):this.softmax(n,this.axis)})}computeOutputShape(e){return e}getConfig(){const e={axis:this.axis},t=super.getConfig();return Object.assign(e,t),e}}function JB(e,t,n){if("number"===typeof e)return $L(e,t);if(e.length!==t)throw new qL("The ".concat(n," argument must be an integer or tuple of ").concat(t," integers.")+" Received: ".concat(e.length," elements."));for(let r=0;r<t;++r){const a=e[r];if(!OP(a))throw new qL("The ".concat(n," argument must be an integer or tuple of ").concat(t)+" integers. Received: ".concat(JSON.stringify(e)," including a")+" non-integer number ".concat(a))}return e}function QB(e,t,n,r){if(null==e)return e;let a;return a="same"===n?e:e-(t+(t-1)*((arguments.length>4&&void 0!==arguments[4]?arguments[4]:1)-1))+1,Math.floor((a+r-1)/r)}function ZB(e,t,n,r){if(null==e)return null;if("valid"===r)e=e*t+MP([n-t,0]);else{if("same"!==r)throw new qL("Unsupport padding mode: ".concat(r,"."));e*=t}return e}function ez(e,t){return zE(()=>(CP(t),"channelsFirst"===t?BA(e,[0,2,3,1]):e))}function tz(e,t){return zE(()=>(CP(t),"channelsFirst"===t?BA(e,[0,2,3,4,1]):e))}function nz(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"valid",i=arguments.length>5?arguments[5]:void 0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1;return zE(()=>{if(null==i&&(i="channelsLast"),CP(i),3!==e.shape.length)throw new qL("The input of a conv1dWithBias operation should be 3, but is "+"".concat(e.shape.length," instead."));if(3!==t.shape.length)throw new qL("The kernel for a conv1dWithBias operation should be 3, but is "+"".concat(t.shape.length," instead"));if(null!=n&&1!==n.shape.length)throw new qL("The bias for a conv1dWithBias operation should be 1, but is "+"".concat(n.shape.length," instead"));if("channelsFirst"===i&&(e=BA(e,[0,2,1])),"causal"===a)throw new KL("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");let s=p_(e,t,r,"same"===a?"same":"valid","NWC",o);return null!=n&&(s=eM(s,n)),s})}function rz(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"valid",i=arguments.length>5?arguments[5]:void 0,o=arguments.length>6?arguments[6]:void 0,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;return zE(()=>{if(null==i&&(i="channelsLast"),CP(i),3!==e.rank&&4!==e.rank)throw new qL("conv2dWithBiasActivation expects input to be of rank 3 or 4, "+"but received ".concat(e.rank,"."));if(3!==t.rank&&4!==t.rank)throw new qL("conv2dWithBiasActivation expects kernel to be of rank 3 or 4, "+"but received ".concat(e.rank,"."));let c=ez(e,i);if("causal"===a)throw new KL("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return c=QA({x:c,filter:t,strides:r,pad:"same"===a?"same":"valid",dilations:o,dataFormat:"NHWC",bias:n,activation:s}),"channelsFirst"===i&&(c=BA(c,[0,3,1,2])),c})}function az(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"valid",i=arguments.length>5?arguments[5]:void 0,o=arguments.length>6?arguments[6]:void 0;return zE(()=>{if(null==i&&(i="channelsLast"),CP(i),4!==e.rank&&5!==e.rank)throw new qL("conv3dWithBias expects input to be of rank 4 or 5, but received "+"".concat(e.rank,"."));if(4!==t.rank&&5!==t.rank)throw new qL("conv3dWithBias expects kernel to be of rank 4 or 5, but received "+"".concat(e.rank,"."));let s=tz(e,i);if("causal"===a)throw new KL("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return s=v_(s,t,r,"same"===a?"same":"valid","NDHWC",o),null!=n&&(s=eM(s,n)),"channelsFirst"===i&&(s=BA(s,[0,4,1,2,3])),s})}$B.className="Softmax",HI($B);class iz extends BM{constructor(e,t){if(super(t),this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",iz.verifyArgs(t),this.rank=e,dP(this.rank,"rank"),1!==this.rank&&2!==this.rank&&3!==this.rank)throw new KL("Convolution layer for rank other than 1, 2, or 3 (".concat(this.rank,") is ")+"not implemented yet.");if(this.kernelSize=JB(t.kernelSize,e,"kernelSize"),this.strides=JB(null==t.strides?1:t.strides,e,"strides"),this.padding=null==t.padding?"valid":t.padding,EP(this.padding),this.dataFormat=null==t.dataFormat?"channelsLast":t.dataFormat,CP(this.dataFormat),this.activation=MB(t.activation),this.useBias=null==t.useBias||t.useBias,this.biasInitializer=NM(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.biasConstraint=aj(t.biasConstraint),this.biasRegularizer=HB(t.biasRegularizer),this.activityRegularizer=HB(t.activityRegularizer),this.dilationRate=JB(null==t.dilationRate?1:t.dilationRate,e,"dilationRate"),1===this.rank&&Array.isArray(this.dilationRate)&&1!==this.dilationRate.length)throw new qL("dilationRate must be a number or an array of a single number for 1D convolution, but received "+"".concat(JSON.stringify(this.dilationRate)));if(2===this.rank){if("number"===typeof this.dilationRate)this.dilationRate=[this.dilationRate,this.dilationRate];else if(2!==this.dilationRate.length)throw new qL("dilationRate must be a number or array of two numbers for 2D "+"convolution, but received ".concat(JSON.stringify(this.dilationRate)))}else if(3===this.rank)if("number"===typeof this.dilationRate)this.dilationRate=[this.dilationRate,this.dilationRate,this.dilationRate];else if(3!==this.dilationRate.length)throw new qL("dilationRate must be a number or array of three numbers for 3D "+"convolution, but received ".concat(JSON.stringify(this.dilationRate)))}static verifyArgs(e){if(JL("kernelSize"in e,"required key 'kernelSize' not in config"),"number"!==typeof e.kernelSize&&!hP(e.kernelSize,"number",1,3))throw new qL("BaseConv expects config.kernelSize to be number or number[] with "+"length 1, 2, or 3, but received ".concat(JSON.stringify(e.kernelSize),"."))}getConfig(){const e={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:LB(this.activation),useBias:this.useBias,biasInitializer:SM(this.biasInitializer),biasRegularizer:WB(this.biasRegularizer),activityRegularizer:WB(this.activityRegularizer),biasConstraint:nj(this.biasConstraint)},t=super.getConfig();return Object.assign(e,t),e}}class oz extends iz{constructor(e,t){super(e,t),this.kernel=null,oz.verifyArgs(t),this.filters=t.filters,dP(this.filters,"filters"),this.kernelInitializer=NM(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.kernelConstraint=aj(t.kernelConstraint),this.kernelRegularizer=HB(t.kernelRegularizer)}build(e){e=TM(e);const t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t])throw new qL("The channel dimension of the input should be defined. "+"Found ".concat(e[t]));const n=e[t],r=this.kernelSize.concat([n,this.filters]);this.kernel=this.addWeight("kernel",r,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:{[t]:n}}],this.built=!0}call(e,t){return zE(()=>{let t;e=IM(e);const n=null==this.bias?null:this.bias.read(),r=pP(this.activation.getClassName());if(null!=r&&2===this.rank)t=rz(e,this.kernel.read(),n,this.strides,this.padding,this.dataFormat,this.dilationRate,r);else{if(1===this.rank)t=nz(e,this.kernel.read(),n,this.strides[0],this.padding,this.dataFormat,this.dilationRate[0]);else if(2===this.rank)t=rz(e,this.kernel.read(),n,this.strides,this.padding,this.dataFormat,this.dilationRate);else{if(3!==this.rank)throw new KL("convolutions greater than 3D are not implemented yet.");t=az(e,this.kernel.read(),n,this.strides,this.padding,this.dataFormat,this.dilationRate)}null!=this.activation&&(t=this.activation.apply(t))}return t})}computeOutputShape(e){e=TM(e);const t=[],n="channelsLast"===this.dataFormat?e.slice(1,e.length-1):e.slice(2);for(let a=0;a<n.length;++a){const e=QB(n[a],this.kernelSize[a],this.padding,this.strides[a],"number"===typeof this.dilationRate?this.dilationRate:this.dilationRate[a]);t.push(e)}let r=[e[0]];return"channelsLast"===this.dataFormat?(r=r.concat(t),r.push(this.filters)):(r.push(this.filters),r=r.concat(t)),r}getConfig(){const e={filters:this.filters,kernelInitializer:SM(this.kernelInitializer),kernelRegularizer:WB(this.kernelRegularizer),kernelConstraint:nj(this.kernelConstraint)},t=super.getConfig();return Object.assign(e,t),e}static verifyArgs(e){if(!("filters"in e)||"number"!==typeof e.filters||e.filters<1)throw new qL("Convolution layer expected config.filters to be a 'number' > 0 "+"but got ".concat(JSON.stringify(e.filters)))}}class sz extends oz{constructor(e){super(2,e),sz.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if("number"!==typeof e.kernelSize&&!hP(e.kernelSize,"number",1,2))throw new qL("Conv2D expects config.kernelSize to be number or number[] with "+"length 1 or 2, but received ".concat(JSON.stringify(e.kernelSize),"."))}}sz.className="Conv2D",HI(sz);class cz extends oz{constructor(e){super(3,e),cz.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if("number"!==typeof e.kernelSize&&(!Array.isArray(e.kernelSize)||1!==e.kernelSize.length&&3!==e.kernelSize.length))throw new qL("Conv3D expects config.kernelSize to be number or"+" [number, number, number], but received ".concat(JSON.stringify(e.kernelSize),"."))}}cz.className="Conv3D",HI(cz);class lz extends sz{constructor(e){if(super(e),this.inputSpec=[new OM({ndim:4})],"same"!==this.padding&&"valid"!==this.padding)throw new qL("Conv2DTranspose currently supports only padding modes 'same' "+"and 'valid', but received padding mode ".concat(this.padding))}build(e){if(4!==(e=TM(e)).length)throw new qL("Input should have rank 4; Received input shape: "+JSON.stringify(e));const t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t])throw new qL("The channel dimension of the inputs should be defined. Found `None`.");const n=e[t],r=this.kernelSize.concat([this.filters,n]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new OM({ndim:4,axes:{[t]:n}})],this.built=!0}call(e,t){return zE(()=>{let t=IM(e);if(4!==t.shape.length)throw new qL("Conv2DTranspose.call() expects input tensor to be rank-4, but "+"received a tensor of rank-".concat(t.shape.length));const n=t.shape,r=n[0];let a,i;"channelsFirst"===this.dataFormat?(a=2,i=3):(a=1,i=2);const o=n[a],s=n[i],c=this.kernelSize[0],l=this.kernelSize[1],u=this.strides[0],h=this.strides[1],d=[r,ZB(o,u,c,this.padding),ZB(s,h,l,this.padding),this.filters];"channelsLast"!==this.dataFormat&&(t=BA(t,[0,2,3,1]));let f=g_(t,this.kernel.read(),d,this.strides,this.padding);return"channelsLast"!==this.dataFormat&&(f=BA(f,[0,3,1,2])),null!=this.bias&&(f=eM(f,this.bias.read(),this.dataFormat)),null!=this.activation&&(f=this.activation.apply(f)),f})}computeOutputShape(e){const t=(e=TM(e)).slice();let n,r,a;"channelsFirst"===this.dataFormat?(n=1,r=2,a=3):(n=3,r=1,a=2);const i=this.kernelSize[0],o=this.kernelSize[1],s=this.strides[0],c=this.strides[1];return t[n]=this.filters,t[r]=ZB(t[r],s,i,this.padding),t[a]=ZB(t[a],c,o,this.padding),t}getConfig(){const e=super.getConfig();return delete e.dilationRate,e}}lz.className="Conv2DTranspose",HI(lz);class uz extends cz{constructor(e){if(super(e),this.inputSpec=[new OM({ndim:5})],"same"!==this.padding&&"valid"!==this.padding)throw new qL("Conv3DTranspose currently supports only padding modes 'same' "+"and 'valid', but received padding mode ".concat(this.padding))}build(e){if(5!==(e=TM(e)).length)throw new qL("Input should have rank 5; Received input shape: "+JSON.stringify(e));const t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t])throw new qL("The channel dimension of the inputs should be defined. Found `None`.");const n=e[t],r=this.kernelSize.concat([this.filters,n]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new OM({ndim:5,axes:{[t]:n}})],this.built=!0}call(e,t){return zE(()=>{let t=IM(e);if(5!==t.shape.length)throw new qL("Conv3DTranspose.call() expects input tensor to be rank-4, but "+"received a tensor of rank-".concat(t.shape.length));const n=t.shape,r=n[0];let a,i,o;"channelsFirst"===this.dataFormat?(o=2,a=3,i=4):(o=1,a=2,i=3);const s=n[o],c=n[a],l=n[i],u=this.kernelSize[0],h=this.kernelSize[1],d=this.kernelSize[2],f=this.strides[0],p=this.strides[1],m=this.strides[2],g=[r,ZB(s,f,u,this.padding),ZB(c,p,h,this.padding),ZB(l,m,d,this.padding),this.filters];"channelsLast"!==this.dataFormat&&(t=BA(t,[0,2,3,4,1]));let v=y_(t,this.kernel.read(),g,this.strides,this.padding);return"channelsLast"!==this.dataFormat&&(v=BA(v,[0,4,1,2,3])),null!==this.bias&&(v=eM(v,this.bias.read(),this.dataFormat)),null!==this.activation&&(v=this.activation.apply(v)),v})}computeOutputShape(e){const t=(e=TM(e)).slice();let n,r,a,i;"channelsFirst"===this.dataFormat?(n=1,r=2,a=3,i=4):(n=4,r=1,a=2,i=3);const o=this.kernelSize[0],s=this.kernelSize[1],c=this.kernelSize[2],l=this.strides[0],u=this.strides[1],h=this.strides[2];return t[n]=this.filters,t[r]=ZB(t[r],l,o,this.padding),t[a]=ZB(t[a],u,s,this.padding),t[i]=ZB(t[i],h,c,this.padding),t}getConfig(){const e=super.getConfig();return delete e.dilationRate,e}}uz.className="Conv3DTranspose",HI(uz);class hz extends oz{constructor(e,t){if(super(e,t),this.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",this.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",this.depthwiseKernel=null,this.pointwiseKernel=null,null==t.filters)throw new qL("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(null!=t.kernelInitializer||null!=t.kernelRegularizer||null!=t.kernelConstraint)throw new qL("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(null!=t.padding&&"same"!==t.padding&&"valid"!==t.padding)throw new qL("SeparableConv".concat(this.rank,"D supports only padding modes: ")+"'same' and 'valid', but received ".concat(JSON.stringify(t.padding)));this.depthMultiplier=null==t.depthMultiplier?1:t.depthMultiplier,this.depthwiseInitializer=NM(t.depthwiseInitializer||this.DEFAULT_DEPTHWISE_INITIALIZER),this.depthwiseRegularizer=HB(t.depthwiseRegularizer),this.depthwiseConstraint=aj(t.depthwiseConstraint),this.pointwiseInitializer=NM(t.depthwiseInitializer||this.DEFAULT_POINTWISE_INITIALIZER),this.pointwiseRegularizer=HB(t.pointwiseRegularizer),this.pointwiseConstraint=aj(t.pointwiseConstraint)}build(e){if((e=TM(e)).length<this.rank+2)throw new qL("Inputs to SeparableConv".concat(this.rank,"D should have rank ")+"".concat(this.rank+2,", but received input shape: ")+"".concat(JSON.stringify(e)));const t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t]||e[t]<0)throw new qL("The channel dimension of the inputs should be defined, "+"but found ".concat(JSON.stringify(e[t])));const n=e[t],r=this.kernelSize.concat([n,this.depthMultiplier]),a=[];for(let o=0;o<this.rank;++o)a.push(1);a.push(n*this.depthMultiplier,this.filters);const i=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",r,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,i,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",a,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,i,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,i,this.biasConstraint):this.bias=null,this.inputSpec=[new OM({ndim:this.rank+2,axes:{[t]:n}})],this.built=!0}call(e,t){return zE(()=>{let t;if(e=IM(e),1===this.rank)throw new KL("1D separable convolution is not implemented yet.");return 2===this.rank&&("channelsFirst"===this.dataFormat&&(e=BA(e,[0,2,3,1])),t=yA(e,this.depthwiseKernel.read(),this.pointwiseKernel.read(),this.strides,this.padding,this.dilationRate,"NHWC")),this.useBias&&(t=eM(t,this.bias.read(),this.dataFormat)),null!=this.activation&&(t=this.activation.apply(t)),"channelsFirst"===this.dataFormat&&(t=BA(t,[0,3,1,2])),t})}getConfig(){const e=super.getConfig();return delete e.rank,delete e.kernelInitializer,delete e.kernelRegularizer,delete e.kernelConstraint,e.depthwiseInitializer=SM(this.depthwiseInitializer),e.pointwiseInitializer=SM(this.pointwiseInitializer),e.depthwiseRegularizer=WB(this.depthwiseRegularizer),e.pointwiseRegularizer=WB(this.pointwiseRegularizer),e.depthwiseConstraint=nj(this.depthwiseConstraint),e.pointwiseConstraint=nj(this.pointwiseConstraint),e}}hz.className="SeparableConv";class dz extends hz{constructor(e){super(2,e)}}dz.className="SeparableConv2D",HI(dz);class fz extends oz{constructor(e){super(1,e),fz.verifyArgs(e),this.inputSpec=[{ndim:3}]}getConfig(){const e=super.getConfig();return delete e.rank,delete e.dataFormat,e}static verifyArgs(e){if("number"!==typeof e.kernelSize&&!hP(e.kernelSize,"number",1,1))throw new qL("Conv1D expects config.kernelSize to be number or number[] with "+"length 1, but received ".concat(JSON.stringify(e.kernelSize),"."))}}fz.className="Conv1D",HI(fz);class pz extends BM{constructor(e){super(e),"number"===typeof e.cropping?this.cropping=[[e.cropping,e.cropping],[e.cropping,e.cropping]]:"number"===typeof e.cropping[0]?this.cropping=[[e.cropping[0],e.cropping[0]],[e.cropping[1],e.cropping[1]]]:this.cropping=e.cropping,this.dataFormat=void 0===e.dataFormat?"channelsLast":e.dataFormat,this.inputSpec=[{ndim:4}]}computeOutputShape(e){return"channelsFirst"===this.dataFormat?[e[0],e[1],e[2]-this.cropping[0][0]-this.cropping[0][1],e[3]-this.cropping[1][0]-this.cropping[1][1]]:[e[0],e[1]-this.cropping[0][0]-this.cropping[0][1],e[2]-this.cropping[1][0]-this.cropping[1][1],e[3]]}call(e,t){return zE(()=>{if(e=IM(e),"channelsLast"===this.dataFormat){const t=GP(e,this.cropping[0][0],e.shape[1]-this.cropping[0][0]-this.cropping[0][1],2);return GP(t,this.cropping[1][0],e.shape[2]-this.cropping[1][1]-this.cropping[1][0],3)}{const t=GP(e,this.cropping[0][0],e.shape[2]-this.cropping[0][0]-this.cropping[0][1],3);return GP(t,this.cropping[1][0],e.shape[3]-this.cropping[1][1]-this.cropping[1][0],4)}})}getConfig(){const e={cropping:this.cropping,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}pz.className="Cropping2D",HI(pz);class mz extends BM{constructor(e){super(e),this.DEFAULT_SIZE=[2,2],this.inputSpec=[{ndim:4}],this.size=null==e.size?this.DEFAULT_SIZE:e.size,this.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,CP(this.dataFormat),this.interpolation=null==e.interpolation?"nearest":e.interpolation,function(e){uP(xP,"InterpolationFormat",e)}(this.interpolation)}computeOutputShape(e){if("channelsFirst"===this.dataFormat){const t=null==e[2]?null:this.size[0]*e[2],n=null==e[3]?null:this.size[1]*e[3];return[e[0],e[1],t,n]}{const t=null==e[1]?null:this.size[0]*e[1],n=null==e[2]?null:this.size[1]*e[2];return[e[0],t,n,e[3]]}}call(e,t){return zE(()=>{let t=IM(e);const n=t.shape;if("channelsFirst"===this.dataFormat){t=BA(t,[0,2,3,1]);const e=this.size[0]*n[2],r=this.size[1]*n[3],a="nearest"===this.interpolation?zR.resizeNearestNeighbor(t,[e,r]):zR.resizeBilinear(t,[e,r]);return BA(a,[0,3,1,2])}{const e=this.size[0]*n[1],r=this.size[1]*n[2];return"nearest"===this.interpolation?zR.resizeNearestNeighbor(t,[e,r]):zR.resizeBilinear(t,[e,r])}})}getConfig(){const e={size:this.size,dataFormat:this.dataFormat,interpolation:this.interpolation},t=super.getConfig();return Object.assign(e,t),e}}mz.className="UpSampling2D",HI(mz);class gz extends iz{constructor(e){super(2,e),this.depthwiseKernel=null,this.depthMultiplier=null==e.depthMultiplier?1:e.depthMultiplier,this.depthwiseInitializer=NM(e.depthwiseInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.depthwiseConstraint=aj(e.depthwiseConstraint),this.depthwiseRegularizer=HB(e.depthwiseRegularizer)}build(e){if((e=TM(e)).length<4)throw new qL("Inputs to DepthwiseConv2D should have rank 4. "+"Received input shape: ".concat(JSON.stringify(e),"."));const t="channelsFirst"===this.dataFormat?1:3;if(null==e[t]||e[t]<0)throw new qL("The channel dimension of the inputs to DepthwiseConv2D should "+"be defined, but is not (".concat(e[t],")."));const n=e[t],r=[this.kernelSize[0],this.kernelSize[1],n,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",r,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[n*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return zE(()=>{let t=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[1,1],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"valid",a=arguments.length>4?arguments[4]:void 0,i=arguments.length>5?arguments[5]:void 0;return zE(()=>{null==a&&(a="channelsLast"),CP(a);let o=ez(e,a);if(4!==e.rank)throw new qL("Input for depthwiseConv2d is required to be 4-D, but is instead "+"".concat(e.rank,"-D"));if(4!==t.rank)throw new qL("depthwiseKernel is required to be 4-D, but is instead "+"".concat(t.rank,"-D"));return o=w_(o,t,n,"same"===r?"same":"valid","NHWC",i),"channelsFirst"===a&&(o=BA(o,[0,3,1,2])),o})}(e=IM(e),this.depthwiseKernel.read(),this.strides,this.padding,this.dataFormat,null);return this.useBias&&(t=eM(t,this.bias.read(),this.dataFormat)),null!=this.activation&&(t=this.activation.apply(t)),t})}computeOutputShape(e){e=TM(e);const t="channelsFirst"===this.dataFormat?e[2]:e[1],n="channelsFirst"===this.dataFormat?e[3]:e[2],r="channelsFirst"===this.dataFormat?e[1]*this.depthMultiplier:e[3]*this.depthMultiplier,a=QB(t,this.kernelSize[0],this.padding,this.strides[0]),i=QB(n,this.kernelSize[1],this.padding,this.strides[1]);return"channelsFirst"===this.dataFormat?[e[0],r,a,i]:[e[0],a,i,r]}getConfig(){const e=super.getConfig();return e.depthMultiplier=this.depthMultiplier,e.depthwiseInitializer=SM(this.depthwiseInitializer),e.depthwiseRegularizer=WB(this.depthwiseRegularizer),e.depthwiseConstraint=nj(this.depthwiseRegularizer),e}}function vz(e,t,n,r){if(Array.isArray(e)){if(null!=t||null!=n)throw new qL("When inputs is an array, neither initialState or constants should be provided");null!=r&&(n=e.slice(e.length-r,e.length),e=e.slice(0,e.length-r)),e.length>1&&(t=e.slice(1,e.length)),e=e[0]}function a(e){return null==e||Array.isArray(e)?e:[e]}return{inputs:e,initialState:t=a(t),constants:n=a(n)}}function bz(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4?arguments[4]:void 0,i=arguments.length>5?arguments[5]:void 0,o=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=arguments.length>7&&void 0!==arguments[7]&&arguments[7];return zE(()=>{const c=t.shape.length;if(c<3)throw new qL("Input should be at least 3D, but is ".concat(c,"D."));const l=[1,0].concat(jP(2,c));if(t=BA(t,l),null!=i)throw new KL("The rnn() functoin of the deeplearn.js backend does not support constants yet.");o&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),null!=a&&(a=TI(TI(a,"bool"),"float32"),a.rank===c-1&&(a=E_(a,-1)),a=BA(a,l)),r&&(t=vA(t,0),null!=a&&(a=vA(a,0)));const u=[];let h,d=n;const f=t.shape[0],p=LA(t);let m,g;null!=a&&(m=LA(a));for(let t=0;t<f;++t){const n=p[t],r=zE(()=>e(n,d));if(null==a)h=r[0],d=r[1];else{const e=zE(()=>{const e=m[t],n=$I(sA(e),e),a=RI(OI(r[0],e),OI(d[0],n)),i=d.map((t,a)=>RI(OI(r[1][a],e),OI(t,n)));return{output:a,newStates:i}});h=e.output,d=e.newStates}s&&u.push(h)}if(s){g=AA(u,1)}return[h,g,d]})}gz.className="DepthwiseConv2D",HI(gz);class yz extends BM{constructor(e){let t;if(super(e),null==e.cell)throw new qL("cell property is missing for the constructor of RNN.");if(t=Array.isArray(e.cell)?new Iz({cells:e.cell}):e.cell,null==t.stateSize)throw new qL("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");this.cell=t,this.returnSequences=null!=e.returnSequences&&e.returnSequences,this.returnState=null!=e.returnState&&e.returnState,this.goBackwards=null!=e.goBackwards&&e.goBackwards,this._stateful=null!=e.stateful&&e.stateful,this.unroll=null!=e.unroll&&e.unroll,this.supportsMasking=!0,this.inputSpec=[new OM({ndim:3})],this.stateSpec=null,this.states_=null,this.numConstants=null,this.keptStates=[]}getStates(){if(null==this.states_){return jP(0,Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1).map(e=>null)}return this.states_}setStates(e){this.states_=e}computeOutputShape(e){CM(e)&&(e=e[0]);let t=this.cell.stateSize;Array.isArray(t)||(t=[t]);const n=t[0];let r;if(r=this.returnSequences?[e[0],e[1],n]:[e[0],n],this.returnState){const n=[];for(const r of t)n.push([e[0],r]);return[r].concat(n)}return r}computeMask(e,t){return zE(()=>{Array.isArray(t)&&(t=t[0]);const e=this.returnSequences?t:null;if(this.returnState){const t=this.states.map(e=>null);return[e].concat(t)}return e})}get states(){if(null==this.states_){const e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,t=[];for(let n=0;n<e;++n)t.push(null);return t}return this.states_}set states(e){this.states_=e}build(e){if(null!=this.numConstants)throw new KL("Constants support is not implemented in RNN yet.");CM(e)&&(e=e[0]);const t=this.stateful?e[0]:null,n=e.slice(2);this.inputSpec[0]=new OM({shape:[t,null,...n]});const r=[e[0]].concat(e.slice(2));let a;if(this.cell.build(r),a=Array.isArray(this.cell.stateSize)?this.cell.stateSize:[this.cell.stateSize],null!=this.stateSpec){if(!yw(this.stateSpec.map(e=>e.shape[e.shape.length-1]),a))throw new qL("An initialState was passed that is not compatible with "+"cell.stateSize. Received stateSpec=".concat(this.stateSpec,"; ")+"However cell.stateSize is ".concat(this.cell.stateSize))}else this.stateSpec=a.map(e=>new OM({shape:[null,e]}));this.stateful&&this.resetStates()}resetStates(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];zE(()=>{if(!this.stateful)throw new HL("Cannot call resetStates() on an RNN Layer that is not stateful.");const n=this.inputSpec[0].shape[0];if(null==n)throw new qL("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(null==this.states_)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(e=>iA([n,e])):this.states_=[iA([n,this.cell.stateSize])];else if(null==e)UE(this.states_),null!=this.keptStates&&(UE(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(e=>iA([n,e])):this.states_[0]=iA([n,this.cell.stateSize]);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new qL("Layer ".concat(this.name," expects ").concat(this.states_.length," state(s), ")+"but it received ".concat(e.length," state value(s). Input ")+"received: ".concat(e));!0===t?this.keptStates.push(this.states_.slice()):UE(this.states_);for(let t=0;t<this.states_.length;++t){const r=e[t],a=Array.isArray(this.cell.stateSize)?this.cell.stateSize[t]:this.cell.stateSize,i=[n,a];if(!yw(r.shape,i))throw new qL("State ".concat(t," is incompatible with layer ").concat(this.name,": ")+"expected shape=".concat(i,", received shape=").concat(r.shape));this.states_[t]=r}}this.states_=this.states_.map(e=>WE(e.clone()))})}apply(e,t){let n=null==t?null:t.initialState,r=null==t?null:t.constants;null==t&&(t={});const a=vz(e,n,r,this.numConstants);e=a.inputs,n=a.initialState,r=a.constants;let i=[],o=[];if(null!=n){t.initialState=n,i=i.concat(n),this.stateSpec=[];for(const e of n)this.stateSpec.push(new OM({shape:e.shape}));o=o.concat(this.stateSpec)}null!=r&&(t.constants=r,i=i.concat(r),this.numConstants=r.length);if(i[0]instanceof LM){const n=[e].concat(i),r=this.inputSpec.concat(o),a=this.inputSpec;this.inputSpec=r;const s=super.apply(n,t);return this.inputSpec=a,s}return super.apply(e,t)}call(e,t){return zE(()=>{const n=null==t?null:t.mask,r=null==t?null:t.training;let a=null==t?null:t.initialState;e=IM(e),null==a&&(a=this.stateful?this.states_:this.getInitialState(e));const i=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;if(a.length!==i)throw new qL("RNN Layer has ".concat(i," state(s) but was passed ")+"".concat(a.length," initial state(s)."));this.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");const o={training:r},s=bz((e,t)=>{const n=this.cell.call([e].concat(t),o);return[n[0],n.slice(1)]},e,a,this.goBackwards,n,null,this.unroll,this.returnSequences),c=s[0],l=s[1],u=s[2];this.stateful&&this.resetStates(u,r);const h=this.returnSequences?l:c;return this.returnState?[h].concat(u):h})}getInitialState(e){return zE(()=>{let t=iA(e.shape);return t=M_(t,[1,2]),t=WP(t),Array.isArray(this.cell.stateSize)?this.cell.stateSize.map(e=>e>1?XP(t,[1,e]):t):this.cell.stateSize>1?[XP(t,[1,this.cell.stateSize])]:[t]})}get trainableWeights(){return this.trainable?this.cell.trainableWeights:[]}get nonTrainableWeights(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),null!=this.cell&&this.cell.setFastWeightInitDuringBuild(e)}getConfig(){const e=super.getConfig(),t={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};null!=this.numConstants&&(t.numConstants=this.numConstants);const n=this.cell.getConfig();return this.getClassName()===yz.className&&(t.cell={className:this.cell.getClassName(),config:n}),Object.assign(Object.assign(Object.assign({},n),e),t)}static fromConfig(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=gj(t.cell,n);return new e(Object.assign(t,{cell:r}))}}yz.className="RNN",HI(yz);class xz extends BM{}class wz extends xz{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,dP(this.units,"units"),this.activation=MB(null==e.activation?this.DEFAULT_ACTIVATION:e.activation),this.useBias=null==e.useBias||e.useBias,this.kernelInitializer=NM(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=NM(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=NM(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=HB(e.kernelRegularizer),this.recurrentRegularizer=HB(e.recurrentRegularizer),this.biasRegularizer=HB(e.biasRegularizer),this.kernelConstraint=aj(e.kernelConstraint),this.recurrentConstraint=aj(e.recurrentConstraint),this.biasConstraint=aj(e.biasConstraint),this.dropout=PP([1,MP([0,null==e.dropout?0:e.dropout])]),this.recurrentDropout=PP([1,MP([0,null==e.recurrentDropout?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=TM(e),this.kernel=this.addWeight("kernel",[e[e.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return zE(()=>{if(2!==e.length)throw new qL("SimpleRNNCell expects 2 input Tensors, got ".concat(e.length,"."));let n=e[1];e=e[0];const r=null!=t.training&&t.training;let a;0<this.dropout&&this.dropout<1&&null==this.dropoutMask&&(this.dropoutMask=Tz({ones:()=>sA(e),rate:this.dropout,training:r,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&null==this.recurrentDropoutMask&&(this.recurrentDropoutMask=Tz({ones:()=>sA(n),rate:this.recurrentDropout,training:r,dropoutFunc:this.dropoutFunc}));const i=this.dropoutMask,o=this.recurrentDropoutMask;a=$P(null!=i?OI(e,i):e,this.kernel.read()),null!=this.bias&&(a=eM(a,this.bias.read())),null!=o&&(n=OI(n,o));let s=RI(a,$P(n,this.recurrentKernel.read()));return null!=this.activation&&(s=this.activation.apply(s)),[s,s]})}getConfig(){const e=super.getConfig(),t={units:this.units,activation:LB(this.activation),useBias:this.useBias,kernelInitializer:SM(this.kernelInitializer),recurrentInitializer:SM(this.recurrentInitializer),biasInitializer:SM(this.biasInitializer),kernelRegularizer:WB(this.kernelRegularizer),recurrentRegularizer:WB(this.recurrentRegularizer),biasRegularizer:WB(this.biasRegularizer),activityRegularizer:WB(this.activityRegularizer),kernelConstraint:nj(this.kernelConstraint),recurrentConstraint:nj(this.recurrentConstraint),biasConstraint:nj(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign(Object.assign({},e),t)}}wz.className="SimpleRNNCell",HI(wz);class kz extends yz{constructor(e){e.cell=new wz(e),super(e)}call(e,t){return zE(()=>{null!=this.cell.dropoutMask&&(UE(this.cell.dropoutMask),this.cell.dropoutMask=null),null!=this.cell.recurrentDropoutMask&&(UE(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const n=null==t?null:t.mask,r=null==t?null:t.training,a=null==t?null:t.initialState;return super.call(e,{mask:n,training:r,initialState:a})})}static fromConfig(e,t){return new e(t)}}kz.className="SimpleRNN",HI(kz);class Sz extends xz{constructor(e){if(super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.resetAfter)throw new qL("GRUCell does not support reset_after parameter set to true.");this.units=e.units,dP(this.units,"units"),this.activation=MB(void 0===e.activation?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=MB(void 0===e.recurrentActivation?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=null==e.useBias||e.useBias,this.kernelInitializer=NM(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=NM(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=NM(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=HB(e.kernelRegularizer),this.recurrentRegularizer=HB(e.recurrentRegularizer),this.biasRegularizer=HB(e.biasRegularizer),this.kernelConstraint=aj(e.kernelConstraint),this.recurrentConstraint=aj(e.recurrentConstraint),this.biasConstraint=aj(e.biasConstraint),this.dropout=PP([1,MP([0,null==e.dropout?0:e.dropout])]),this.recurrentDropout=PP([1,MP([0,null==e.recurrentDropout?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){const t=(e=TM(e))[e.length-1];this.kernel=this.addWeight("kernel",[t,3*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,3*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[3*this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return zE(()=>{if(2!==e.length)throw new qL("GRUCell expects 2 input Tensors (inputs, h, c), got "+"".concat(e.length,"."));const n=null!=t.training&&t.training;let r=e[1];e=e[0],0<this.dropout&&this.dropout<1&&null==this.dropoutMask&&(this.dropoutMask=Tz({ones:()=>sA(e),rate:this.dropout,training:n,count:3,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&null==this.recurrentDropoutMask&&(this.recurrentDropoutMask=Tz({ones:()=>sA(r),rate:this.recurrentDropout,training:n,count:3,dropoutFunc:this.dropoutFunc}));const a=this.dropoutMask,i=this.recurrentDropoutMask;let o,s,c;0<this.dropout&&this.dropout<1&&(e=OI(e,a[0]));let l=$P(e,this.kernel.read());this.useBias&&(l=eM(l,this.bias.read())),0<this.recurrentDropout&&this.recurrentDropout<1&&(r=OI(r,i[0]));const u=this.recurrentKernel.read(),[h,d]=TA(u,[2*this.units,this.units],u.rank-1),f=$P(r,h),[p,m,g]=TA(l,3,l.rank-1),[v,b]=TA(f,2,f.rank-1);o=this.recurrentActivation.apply(RI(p,v)),s=this.recurrentActivation.apply(RI(m,b));const y=$P(OI(s,r),d);c=this.activation.apply(RI(g,y));const x=RI(OI(o,r),OI(RI(1,nA(o)),c));return[x,x]})}getConfig(){const e=super.getConfig(),t={units:this.units,activation:LB(this.activation),recurrentActivation:LB(this.recurrentActivation),useBias:this.useBias,kernelInitializer:SM(this.kernelInitializer),recurrentInitializer:SM(this.recurrentInitializer),biasInitializer:SM(this.biasInitializer),kernelRegularizer:WB(this.kernelRegularizer),recurrentRegularizer:WB(this.recurrentRegularizer),biasRegularizer:WB(this.biasRegularizer),activityRegularizer:WB(this.activityRegularizer),kernelConstraint:nj(this.kernelConstraint),recurrentConstraint:nj(this.recurrentConstraint),biasConstraint:nj(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign(Object.assign({},e),t)}}Sz.className="GRUCell",HI(Sz);class Nz extends yz{constructor(e){0===e.implementation&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new Sz(e),super(e)}call(e,t){return zE(()=>{null!=this.cell.dropoutMask&&(UE(this.cell.dropoutMask),this.cell.dropoutMask=null),null!=this.cell.recurrentDropoutMask&&(UE(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const n=null==t?null:t.mask,r=null==t?null:t.training,a=null==t?null:t.initialState;return super.call(e,{mask:n,training:r,initialState:a})})}static fromConfig(e,t){return 0===t.implmentation&&(t.implementation=1),new e(t)}}Nz.className="GRU",HI(Nz);class Cz extends xz{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,dP(this.units,"units"),this.activation=MB(void 0===e.activation?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=MB(void 0===e.recurrentActivation?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=null==e.useBias||e.useBias,this.kernelInitializer=NM(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=NM(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=NM(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.unitForgetBias=e.unitForgetBias,this.kernelRegularizer=HB(e.kernelRegularizer),this.recurrentRegularizer=HB(e.recurrentRegularizer),this.biasRegularizer=HB(e.biasRegularizer),this.kernelConstraint=aj(e.kernelConstraint),this.recurrentConstraint=aj(e.recurrentConstraint),this.biasConstraint=aj(e.biasConstraint),this.dropout=PP([1,MP([0,null==e.dropout?0:e.dropout])]),this.recurrentDropout=PP([1,MP([0,null==e.recurrentDropout?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=[this.units,this.units],this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){var t;const n=(e=TM(e))[e.length-1];let r;if(this.kernel=this.addWeight("kernel",[n,4*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,4*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){if(this.unitForgetBias){const e=this.biasInitializer,n=this.units;r=new((t=class extends iM{apply(t,r){const a=e.apply([n]),i=(new sM).apply([n]),o=e.apply([2*n]);return KP(KP(a,i),o)}}).className="CustomInit",t)}else r=this.biasInitializer;this.bias=this.addWeight("bias",[4*this.units],null,r,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}call(e,t){return zE(()=>{const n=null!=t.training&&t.training;if(3!==e.length)throw new qL("LSTMCell expects 3 input Tensors (inputs, h, c), got "+"".concat(e.length,"."));let r=e[1];const a=e[2];e=e[0],0<this.dropout&&this.dropout<1&&null==this.dropoutMask&&(this.dropoutMask=Tz({ones:()=>sA(e),rate:this.dropout,training:n,count:4,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&null==this.recurrentDropoutMask&&(this.recurrentDropoutMask=Tz({ones:()=>sA(r),rate:this.recurrentDropout,training:n,count:4,dropoutFunc:this.dropoutFunc}));const i=this.dropoutMask,o=this.recurrentDropoutMask;let s,c,l,u;0<this.dropout&&this.dropout<1&&(e=OI(e,i[0]));let h=$P(e,this.kernel.read());0<this.recurrentDropout&&this.recurrentDropout<1&&(r=OI(r,o[0])),h=RI(h,$P(r,this.recurrentKernel.read())),this.useBias&&(h=eM(h,this.bias.read()));const[d,f,p,m]=TA(h,4,h.rank-1);s=this.recurrentActivation.apply(d),c=this.recurrentActivation.apply(f),l=RI(OI(c,a),OI(s,this.activation.apply(p))),u=this.recurrentActivation.apply(m);const g=OI(u,this.activation.apply(l));return[g,g,l]})}getConfig(){const e=super.getConfig(),t={units:this.units,activation:LB(this.activation),recurrentActivation:LB(this.recurrentActivation),useBias:this.useBias,kernelInitializer:SM(this.kernelInitializer),recurrentInitializer:SM(this.recurrentInitializer),biasInitializer:SM(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:WB(this.kernelRegularizer),recurrentRegularizer:WB(this.recurrentRegularizer),biasRegularizer:WB(this.biasRegularizer),activityRegularizer:WB(this.activityRegularizer),kernelConstraint:nj(this.kernelConstraint),recurrentConstraint:nj(this.recurrentConstraint),biasConstraint:nj(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign(Object.assign({},e),t)}}Cz.className="LSTMCell",HI(Cz);class Ez extends yz{constructor(e){0===e.implementation&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new Cz(e),super(e)}call(e,t){return zE(()=>{null!=this.cell.dropoutMask&&(UE(this.cell.dropoutMask),this.cell.dropoutMask=null),null!=this.cell.recurrentDropoutMask&&(UE(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const n=null==t?null:t.mask,r=null==t?null:t.training,a=null==t?null:t.initialState;return super.call(e,{mask:n,training:r,initialState:a})})}static fromConfig(e,t){return 0===t.implmentation&&(t.implementation=1),new e(t)}}Ez.className="LSTM",HI(Ez);class Iz extends xz{constructor(e){super(e),this.cells=e.cells}get stateSize(){const e=[];for(const t of this.cells.slice().reverse())Array.isArray(t.stateSize)?e.push(...t.stateSize):e.push(t.stateSize);return e}call(e,t){return zE(()=>{let n=e.slice(1);const r=[];for(const e of this.cells.slice().reverse())Array.isArray(e.stateSize)?r.push(n.splice(0,e.stateSize.length)):r.push(n.splice(0,1));r.reverse();const a=[];let i;for(let o=0;o<this.cells.length;++o){const s=this.cells[o];n=r[o],i=0===o?[e[0]].concat(n):[i[0]].concat(n),i=s.call(i,t),a.push(i.slice(1))}n=[];for(const e of a.slice().reverse())n.push(...e);return[i[0]].concat(n)})}build(e){let t;CM(e)&&(e=e[0]),this.cells.forEach((n,r)=>{_P("RNNCell_".concat(r),()=>{n.build(e),t=Array.isArray(n.stateSize)?n.stateSize[0]:n.stateSize,e=[e[0],t]})}),this.built=!0}getConfig(){const e=super.getConfig(),t={cells:this.cells.map(e=>({className:e.getClassName(),config:e.getConfig()}))};return Object.assign(Object.assign({},e),t)}static fromConfig(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=[];for(const a of t.cells)r.push(gj(a,n));return new e({cells:r})}get trainableWeights(){if(!this.trainable)return[];const e=[];for(const t of this.cells)e.push(...t.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const t of this.cells)e.push(...t.nonTrainableWeights);if(!this.trainable){const t=[];for(const e of this.cells)t.push(...e.trainableWeights);return t.concat(e)}return e}getWeights(){const e=[];for(const t of this.cells)e.push(...t.weights);return FM(e)}setWeights(e){const t=[];for(const n of this.cells){const r=n.weights.length,a=e.splice(r);for(let e=0;e<n.weights.length;++e)t.push([n.weights[e],a[e]])}DM(t)}}function Tz(e){const{ones:t,rate:n,training:r=!1,count:a=1,dropoutFunc:i}=e,o=()=>null!=i?i(t(),n):tM(t(),n),s=()=>nM(o,t,r);if(!a||a<=1)return WE(s().clone());return Array(a).fill(void 0).map(s).map(e=>WE(e.clone()))}Iz.className="StackedRNNCells",HI(Iz);var _z=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(n[r[a]]=e[r[a]])}return n};class Az extends yz{constructor(e){if(e.unroll)throw new KL("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(e.cell))throw new KL("It is not possible at the moment to stack convolutional cells.");super(e),this.inputSpec=[new OM({ndim:5})]}call(e,t){return zE(()=>{if(null!=this.cell.dropoutMask&&(UE(this.cell.dropoutMask),this.cell.dropoutMask=null),null!=this.cell.recurrentDropoutMask&&(UE(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null),t&&t.constants)throw new qL("ConvRNN2D cell does not support constants");const n=null==t?null:t.mask,r=null==t?null:t.training,a=null==t?null:t.initialState;return super.call(e,{mask:n,training:r,initialState:a})})}computeOutputShape(e){let t=this.computeSingleOutputShape(e);return this.returnSequences||(t=[t[0],...t.slice(2)]),this.returnState&&(t=[t,...Array(2).fill([e[0],...t.slice(-3)])]),t}getInitialState(e){return zE(()=>{const{stateSize:t}=this.cell,n=e.shape,r=this.computeSingleOutputShape(n),a=iA([r[0],...r.slice(2)]);return Array.isArray(t)?Array(t.length).fill(a):[a]})}resetStates(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];zE(()=>{if(!this.stateful)throw new HL("Cannot call resetStates() on an RNN Layer that is not stateful.");const n=this.inputSpec[0].shape,r=this.computeSingleOutputShape(n),a=[r[0],...r.slice(2)];if(null==n[0])throw new qL("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(null==this.getStates())Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>iA(a)):this.states_=[iA(a)];else if(null==e)UE(this.states_),null!=this.keptStates&&(UE(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>iA(a)):this.states_[0]=iA(a);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new qL("Layer ".concat(this.name," expects ").concat(this.states_.length," state(s), ")+"but it received ".concat(e.length," state value(s). Input ")+"received: ".concat(e));t?this.keptStates.push(this.states_.slice()):UE(this.states_);for(let t=0;t<this.states_.length;++t){const n=e[t],r=a;if(!yw(n.shape,r))throw new qL("State ".concat(t," is incompatible with layer ").concat(this.name,": ")+"expected shape=".concat(r,", received shape=").concat(n.shape));this.states_[t]=n}}this.states_=this.states_.map(e=>WE(e.clone()))})}computeSingleOutputShape(e){const{dataFormat:t,filters:n,kernelSize:r,padding:a,strides:i,dilationRate:o}=this.cell,s="channelsFirst"===t,c=e[s?3:2],l=e[s?4:3],u=QB(c,r[0],a,i[0],o[0]),h=QB(l,r[1],a,i[1],o[1]);return[...e.slice(0,2),...s?[n,u,h]:[u,h,n]]}}Az.className="ConvRNN2D";class Rz extends Cz{constructor(e){const{filters:t,kernelSize:n,strides:r,padding:a,dataFormat:i,dilationRate:o}=e;super(Object.assign(Object.assign({},e),{units:t})),this.filters=t,dP(this.filters,"filters"),this.kernelSize=JB(n,2,"kernelSize"),this.kernelSize.forEach(e=>dP(e,"kernelSize")),this.strides=JB(r||1,2,"strides"),this.strides.forEach(e=>dP(e,"strides")),this.padding=a||"valid",EP(this.padding),this.dataFormat=i||"channelsLast",CP(this.dataFormat),this.dilationRate=JB(o||1,2,"dilationRate"),this.dilationRate.forEach(e=>dP(e,"dilationRate"))}build(e){var t;e=TM(e);const n="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[n])throw new qL("The channel dimension of the input should be defined. "+"Found ".concat(e[n]));const r=e[n],a=this.kernelSize.concat([r,4*this.filters]);this.kernel=this.addWeight("kernel",a,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);const i=this.kernelSize.concat([this.filters,4*this.filters]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",i,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){let e;if(this.unitForgetBias){const n=this.biasInitializer,r=this.filters;e=new((t=class extends iM{apply(e,t){return qP([n.apply([r]),oA([r]),n.apply([2*r])])}}).className="CustomInit",t)}else e=this.biasInitializer;this.bias=this.addWeight("bias",[4*this.filters],null,e,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0}call(e,t){return zE(()=>{if(3!==e.length)throw new qL("ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got "+"".concat(e.length,"."));const n=t.training||!1,r=e[0],a=e[1],i=e[2];0<this.dropout&&this.dropout<1&&null==this.dropoutMask&&(this.dropoutMask=Tz({ones:()=>sA(r),rate:this.dropout,training:n,count:4,dropoutFunc:this.dropoutFunc}));const o=this.dropoutMask,s=(e,t,n)=>t&&t[n]?OI(t[n],e):e;let c=s(r,o,0),l=s(r,o,1),u=s(r,o,2),h=s(r,o,3);0<this.recurrentDropout&&this.recurrentDropout<1&&null==this.recurrentDropoutMask&&(this.recurrentDropoutMask=Tz({ones:()=>sA(a),rate:this.recurrentDropout,training:n,count:4,dropoutFunc:this.dropoutFunc}));const d=this.recurrentDropoutMask;let f=s(a,d,0),p=s(a,d,1),m=s(a,d,2),g=s(a,d,3);const[v,b,y,x]=TA(this.kernel.read(),4,3),[w,k,S,N]=this.useBias?TA(this.bias.read(),4):[null,null,null,null];c=this.inputConv(c,v,w,this.padding),l=this.inputConv(l,b,k,this.padding),u=this.inputConv(u,y,S,this.padding),h=this.inputConv(h,x,N,this.padding);const[C,E,I,T]=TA(this.recurrentKernel.read(),4,3);f=this.recurrentConv(f,C),p=this.recurrentConv(p,E),m=this.recurrentConv(m,I),g=this.recurrentConv(g,T);const _=this.recurrentActivation.apply(RI(c,f)),A=this.recurrentActivation.apply(RI(l,p)),R=RI(OI(A,i),OI(_,this.activation.apply(RI(u,m)))),F=OI(this.recurrentActivation.apply(RI(h,g)),this.activation.apply(R));return[F,F,R]})}getConfig(){const e=super.getConfig(),{units:t}=e,n=_z(e,["units"]),r={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign(Object.assign({},n),r)}inputConv(e,t,n,r){const a=f_(e,t,this.strides,r||"valid","channelsFirst"===this.dataFormat?"NCHW":"NHWC",this.dilationRate);return n?eM(a,n,this.dataFormat):a}recurrentConv(e,t){return f_(e,t,1,"same","channelsFirst"===this.dataFormat?"NCHW":"NHWC")}}Rz.className="ConvLSTM2DCell",HI(Rz);class Fz extends Az{constructor(e){const t=new Rz(e);super(Object.assign(Object.assign({},e),{cell:t}))}static fromConfig(e,t){return new e(t)}}Fz.className="ConvLSTM2D",HI(Fz);class Dz extends BM{constructor(e){super(e),this.rate=Math.max(Math.min(e.rate,1),0),this.noiseShape=e.noiseShape,this.seed=e.seed,this.supportsMasking=!0}getNoiseShape(e){if(null==this.noiseShape)return this.noiseShape;const t=e.shape,n=[];for(let r=0;r<this.noiseShape.length;++r)n.push(null==this.noiseShape[r]?t[r]:this.noiseShape[r]);return n}call(e,t){return zE(()=>{this.invokeCallHook(e,t);const n=IM(e);if(0<this.rate&&this.rate<1){const e=null!=t.training&&t.training,r=this.getNoiseShape(n);return nM(()=>tM(n,this.rate,r,this.seed),()=>n,e)}return e})}getConfig(){const e={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},t=super.getConfig();return Object.assign(e,t),e}dispose(){return super.dispose()}}Dz.className="Dropout",HI(Dz);class Oz extends Dz{constructor(e){super(e),this.inputSpec=[{ndim:3}]}getNoiseShape(e){const t=e.shape;return[t[0],1,t[2]]}}Oz.className="SpatialDropout1D",HI(Oz);class Lz extends BM{constructor(e){if(super(e),this.activation=null,this.useBias=!0,this.kernel=null,this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",null==e.batchInputShape&&null==e.inputShape&&null!=e.inputDim){let t=null;null!=e.batchSize&&(t=e.batchSize),this.batchInputShape=[t,e.inputDim]}this.units=e.units,dP(this.units,"units"),this.activation=MB(e.activation),null!=e.useBias&&(this.useBias=e.useBias),this.kernelInitializer=NM(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.biasInitializer=NM(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelConstraint=aj(e.kernelConstraint),this.biasConstraint=aj(e.biasConstraint),this.kernelRegularizer=HB(e.kernelRegularizer),this.biasRegularizer=HB(e.biasRegularizer),this.activityRegularizer=HB(e.activityRegularizer),this.supportsMasking=!0,this.inputSpec=[{minNDim:2}]}build(e){const t=(e=TM(e))[e.length-1];null==this.kernel&&(this.kernel=this.addWeight("kernel",[t,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:{[-1]:t}}],this.built=!0}computeOutputShape(e){const t=(e=TM(e)).slice();return t[t.length-1]=this.units,t}call(e,t){return zE(()=>{this.invokeCallHook(e,t);const n=IM(e),r=pP(this.activation.getClassName());let a;return null!=r?a=$P(n,this.kernel.read(),r,this.bias?this.bias.read():null):(a=$P(n,this.kernel.read()),null!=this.bias&&(a=eM(a,this.bias.read())),null!=this.activation&&(a=this.activation.apply(a))),a})}getConfig(){const e={units:this.units,activation:LB(this.activation),useBias:this.useBias,kernelInitializer:SM(this.kernelInitializer),biasInitializer:SM(this.biasInitializer),kernelRegularizer:WB(this.kernelRegularizer),biasRegularizer:WB(this.biasRegularizer),activityRegularizer:WB(this.activityRegularizer),kernelConstraint:nj(this.kernelConstraint),biasConstraint:nj(this.biasConstraint)},t=super.getConfig();return Object.assign(e,t),e}}Lz.className="Dense",HI(Lz);class Pz extends BM{constructor(e){super(e=e||{}),this.inputSpec=[{minNDim:3}],this.dataFormat=e.dataFormat}computeOutputShape(e){e=TM(e);for(const t of e.slice(1))if(null==t)throw new qL('The shape of the input to "Flatten" is not fully defined '+"(got ".concat(e.slice(1),"). Make sure to pass a complete ")+'"input_shape" or "batch_input_shape" argument to the first layer in your model.');return[e[0],LP(e,1)]}call(e,t){return zE(()=>{this.invokeCallHook(e,t);let n=IM(e);if("channelsFirst"===this.dataFormat&&n.rank>1){const e=[0];for(let t=2;t<n.rank;++t)e.push(t);e.push(1),n=BA(n,e)}return function(e){if(e.rank<=1)throw new qL("batchFlatten requires a minimum rank of 2. Got rank: ".concat(e.rank,"."));const t=[e.shape[0],LP(e.shape,1)];return ZT(e,t)}(n)})}getConfig(){const e={};null!=this.dataFormat&&(e.dataFormat=this.dataFormat);const t=super.getConfig();return Object.assign(e,t),e}}Pz.className="Flatten",HI(Pz);class Mz extends BM{constructor(e){super(e),this.supportsMasking=!0,this.activation=MB(e.activation)}call(e,t){return zE(()=>{this.invokeCallHook(e,t);const n=IM(e);return this.activation.apply(n)})}getConfig(){const e={activation:LB(this.activation)},t=super.getConfig();return Object.assign(e,t),e}}Mz.className="Activation",HI(Mz);class jz extends BM{constructor(e){super(e),this.n=e.n,this.inputSpec=[{ndim:2}]}computeOutputShape(e){return[e[0],this.n,e[1]]}call(e,t){return zE(()=>function(e,t){return zE(()=>{if(2!==e.shape.length)throw new qL("repeat() expects a rank-2 tensor, but received a "+"rank-".concat(e.shape.length," tensor."));return XP(WP(e,1),[1,t,1])})}(e=IM(e),this.n))}getConfig(){const e={n:this.n},t=super.getConfig();return Object.assign(e,t),e}}jz.className="RepeatVector",HI(jz);class Bz extends BM{constructor(e){super(e),this.targetShape=e.targetShape;for(let t=0;t<this.targetShape.length;++t)this.isUnknown(this.targetShape[t])&&(this.targetShape[t]=null)}isUnknown(e){return e<0||null==e}fixUnknownDimension(e,t){const n="Total size of new array must be unchanged.",r=t.slice();let a=1,i=null;for(let s=0;s<r.length;++s){const e=r[s];if(this.isUnknown(e)){if(null!==i)throw new qL("Can only specifiy one unknown dimension.");i=s}else a*=e}const o=LP(e);if(null!==i){if(0===a||o%a!==0)throw new qL(n);r[i]=o/a}else if(o!==a)throw new qL(n);return r}computeOutputShape(e){let t=!1;for(let n=0;n<e.length;++n)if(this.isUnknown(e[n])){t=!0;break}return t?e.slice(0,1).concat(this.targetShape):e.slice(0,1).concat(this.fixUnknownDimension(e.slice(1),this.targetShape))}call(e,t){return zE(()=>{this.invokeCallHook(e,t);const n=IM(e),r=n.shape,a=r.slice(0,1).concat(this.fixUnknownDimension(r.slice(1),this.targetShape));return ZT(n,a)})}getConfig(){const e={targetShape:this.targetShape},t=super.getConfig();return Object.assign(e,t),e}}Bz.className="Reshape",HI(Bz);class zz extends BM{constructor(e){if(super(e),null==e.dims)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(e.dims))throw new Error("Permute constructor requires `dims` to be an Array, but received "+"".concat(e.dims," instead."));const t=jP(1,e.dims.length+1);if(!yw(e.dims.slice().sort(),t))throw new Error("Invalid permutation `dims`: "+JSON.stringify(e.dims)+" `dims` must contain consecutive integers starting from 1.");this.dims=e.dims,this.dimsIncludingBatch=[0].concat(this.dims),this.inputSpec=[new OM({ndim:this.dims.length+1})]}computeOutputShape(e){const t=(e=TM(e)).slice();return this.dims.forEach((n,r)=>{t[r+1]=e[n]}),t}call(e,t){return BA(IM(e),this.dimsIncludingBatch)}getConfig(){const e={dims:this.dims},t=super.getConfig();return Object.assign(e,t),e}}zz.className="Permute",HI(zz);class Uz extends BM{constructor(e){super(null==e?{}:e),this.supportsMasking=!0,this.maskValue=null!=e?null==e.maskValue?0:e.maskValue:0}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={maskValue:this.maskValue};return Object.assign(t,e),t}computeMask(e,t){const n=IM(e);return PT(rA(n,this.maskValue),-1)}call(e,t){return zE(()=>{this.invokeCallHook(e,t);const n=IM(e),r=PT(rA(n,this.maskValue),-1,!0);return OI(n,TI(r,n.dtype))})}}Uz.className="Masking",HI(Uz);class Wz extends BM{constructor(e){if(super(e),this.embeddings=null,this.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",null==e.batchInputShape&&null==e.inputShape){let t=null;null!=e.batchSize&&(t=e.batchSize),null==e.inputLength?this.batchInputShape=[t,null]:this.batchInputShape=[t].concat(eP(e.inputLength))}this.inputDim=e.inputDim,dP(this.inputDim,"inputDim"),this.outputDim=e.outputDim,dP(this.outputDim,"outputDim"),this.embeddingsInitializer=NM(e.embeddingsInitializer||this.DEFAULT_EMBEDDINGS_INITIALIZER),this.embeddingsRegularizer=HB(e.embeddingsRegularizer),this.activityRegularizer=HB(e.activityRegularizer),this.embeddingsConstraint=aj(e.embeddingsConstraint),this.maskZero=e.maskZero,this.supportsMasking=e.maskZero,this.inputLength=e.inputLength}build(e){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}warnOnIncompatibleInputShape(e){}computeMask(e,t){return zE(()=>this.maskZero?(e=IM(e),rA(e,MI(e))):null)}computeOutputShape(e){if(e=TM(e),null==this.inputLength)return[...e,this.outputDim];const t=eP(this.inputLength);if(t.length!==e.length-1)throw new qL('"inputLength" is '.concat(this.inputLength,", but received ")+"input shape has shape ".concat(e));{let n=0;for(let r=0;r<t.length;++r){const a=t[r],i=e[r+1];if(null!=a&&null!=i&&a!==i)throw new qL('"inputLength" is '.concat(this.inputLength,", but received ")+"input shape has shape ".concat(e));null==a&&(t[n]=i),n++}}return[e[0],...t,this.outputDim]}call(e,t){return zE(()=>{this.invokeCallHook(e,t);let n=IM(e);"int32"!==n.dtype&&(n=UP(n,"int32"));const r=JP(this.embeddings.read(),ZT(n,[n.size]));return ZT(r,TM(this.computeOutputShape(n.shape)))})}getConfig(){const e={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:SM(this.embeddingsInitializer),embeddingsRegularizer:WB(this.embeddingsRegularizer),activityRegularizer:WB(this.activityRegularizer),embeddingsConstraint:nj(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},t=super.getConfig();return Object.assign(e,t),e}}Wz.className="Embedding",HI(Wz);class Vz extends BM{constructor(e){super(e||{}),this.supportsMasking=!0}mergeFunction(e){throw new KL}computeElementwiseOpOutputShape(e,t){if(null==e||null==t)return null;if(e.length<t.length)return this.computeElementwiseOpOutputShape(t,e);if(0===t.length)return e;const n=e.slice(0,e.length-t.length);for(let r=0;r<t.length;++r){const a=e[e.length-t.length+r],i=t[r];if(null==a||null==i||a<0||i<0)n.push(null);else if(1===a)n.push(i);else if(1===i)n.push(a);else{if(a!==i)throw new qL("Operands could not be broadcast together with shapes "+JSON.stringify(e)+" "+JSON.stringify(t));n.push(a)}}return n}build(e){if(Array.isArray(e)&&!Array.isArray(e[0])&&(e=[TM(e)]),e.length<2)throw new qL("A merge layer should be called on an Array of at least 2 inputs."+" Got ".concat(e.length," input(s)."));let t=[];for(const a of e)null!=a&&null!==a[0]&&t.push(a[0]);if(t=cP(t),t.length>1)throw new qL("Can not merge tensors with different batch sizes. "+"Got tensors with shapes: ".concat(JSON.stringify(e),"."));let n=null==e[0]?null:e[0].slice(1);for(let a=1;a<e.length;++a){const t=null==e[a]?null:e[a].slice(1);n=this.computeElementwiseOpOutputShape(n,t)}const r=e.map(e=>e.length);-1===e.indexOf(null)&&1===cP(r).length?this.reshapeRequired=!1:this.reshapeRequired=!0}call(e,t){return zE(()=>{if(this.reshapeRequired){const t=[],n=e.map(e=>e.rank);if(-1===n.indexOf(null)){const r=MP(n);for(let n of e){const e=n.rank;for(let t=0;t<r-e;++t)n=WP(n,1);t.push(n)}return this.mergeFunction(t)}{let n=!1;for(const i of e){const e=i.rank;if(null==e){const e=i.shape,r=e[0],a=e.slice(1).concat([r]);let o=ZT(i,[r].concat(LP(e.slice(1))));o=BA(o,[1,0]),o=ZT(o,a),t.push(o),n=!0}else if(e>1){const r=jP(1,e).concat([0]);t.push(BA(i,r)),n=!0}else t.push(i)}let r=this.mergeFunction(t);const a=r.rank;if(n)if(null==a){const e=r.shape,t=e[e.length-1],n=[t].concat(e.slice(0,e.length-1));r=ZT(BA(ZT(r,[-1,t]),[1,0]),n)}else if(a>1){const e=[a-1].concat(jP(0,a-1));r=BA(r,e)}return r}}return this.mergeFunction(e)})}computeOutputShape(e){let t;t=null==e[0]?null:e[0].slice(1);for(let r=1;r<e.length;++r){const n=null==e[r]?null:e[r].slice(1);t=this.computeElementwiseOpOutputShape(t,n)}let n=[];for(const r of e)null!=r&&null!==r[0]&&n.push(r[0]);return n=cP(n),t=1===n.length?n.concat(t):[null].concat(t),t}computeMask(e,t){return zE(()=>{if(null==t)return null;if(!Array.isArray(t))throw new qL("`mask` should be an Array");if(!Array.isArray(e))throw new qL("`inputs` should be an Array");if(t.length!==e.length)throw new qL("The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths "+"(".concat(e.length," vs ").concat(t.length,")"));if(t.every(e=>null==e))return null;t=t.map(e=>null==e?e:E_(e,0));let n=t[0];for(let e=1;e<t.length-1;++e)n=X_(n,t[e]);return n})}}class Hz extends Vz{constructor(e){super(e)}mergeFunction(e){return zE(()=>{let t=e[0].clone();for(let n=1;n<e.length;++n)t=RI(t,e[n]);return t})}}Hz.className="Add",HI(Hz);class Gz extends Vz{constructor(e){super(e)}mergeFunction(e){return zE(()=>{let t=e[0].clone();for(let n=1;n<e.length;++n)t=OI(t,e[n]);return t})}}Gz.className="Multiply",HI(Gz);class qz extends Vz{constructor(e){super(e)}mergeFunction(e){return zE(()=>{let t=e[0].clone();for(let n=1;n<e.length;++n)t=RI(t,e[n]);return OI(1/e.length,t)})}}qz.className="Average",HI(qz);class Kz extends Vz{constructor(e){super(e)}mergeFunction(e){return zE(()=>{let t=e[0];for(let n=1;n<e.length;++n)t=nT(t,e[n]);return t})}}Kz.className="Maximum",HI(Kz);class Xz extends Vz{constructor(e){super(e)}mergeFunction(e){return zE(()=>{let t=e[0];for(let n=1;n<e.length;++n)t=eA(t,e[n]);return t})}}Xz.className="Minimum",HI(Xz);class Yz extends Vz{constructor(e){super(e),this.DEFAULT_AXIS=-1,null==e&&(e={}),this.axis=null==e.axis?this.DEFAULT_AXIS:e.axis,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){if(!Array.isArray(e)||!Array.isArray(e[0])||1===e.length)throw new qL("A `Concatenate` layer should be called on a list of at least 2 inputs");let t=!0;for(const r of e)if(null!=r){t=!1;break}if(t)return;const n=[];for(let r=0;r<e.length;++r){const t=e[r].slice();t.splice(this.axis,1);let a=!1;for(const e of n)if(yw(e,t)){a=!0;break}a||n.push(t)}if(n.length>1)throw new qL("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(e))}mergeFunction(e){return zE(()=>qP(e,this.axis))}computeOutputShape(e){if(!Array.isArray(e)||!Array.isArray(e[0]))throw new qL("A `Concatenate` layer should be called on a list of inputs.");const t=e,n=t[0].slice(),r=this.axis<0?n.length+this.axis:this.axis;for(const a of t.slice(1)){if(null==n[r]||null==a[r]){n[r]=null;break}n[r]+=a[r]}return n}computeMask(e,t){if(null==t)return null;if(!Array.isArray(t))throw new qL("`mask` should be an array for Concatenate");if(!Array.isArray(e))throw new qL("`inputs` should be an array for Concatenate");if(t.length!==e.length)throw new qL("Mismatch in the length of mask (".concat(t.length,") ")+"and the legnth of inputs (".concat(e.length,")"));return zE(()=>{let n=!0;if(t.forEach(e=>{null==e||(n=!1)}),n)return null;const r=[];for(let i=0;i<e.length;++i)null==t[i]?r.push(TI(sA(e[i]),"bool")):t[i].rank<e[i].rank?r.push(E_(t[i],-1)):r.push(t[i]);const a=c_(r,this.axis);return LT(a,-1,!1)})}getConfig(){const e={axis:this.axis},t=super.getConfig();return Object.assign(e,t),e}}function $z(e,t){for(;e<0;)e+=t;return e}Yz.className="Concatenate",HI(Yz);class Jz extends Vz{constructor(e){super(e),this.axes=e.axes,this.normalize=null!=e.normalize&&e.normalize,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){mw(Array.isArray(e)&&2===e.length&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const t=e[0],n=e[1];if(t.length>3||n.length>3)throw new KL("Dot layer does not support tensors of 4D or higher rank yet.");const r=this.interpretAxes(t,n);if(t[r[0]]!==n[r[1]])throw new qL("Dimension incompatibility: "+"".concat(t[r[0]]," !== ").concat(n[r[1]]))}mergeFunction(e){if(2!==e.length)throw new qL("A `Dot` layer must be called on exactly 2 inputs, "+"but received ".concat(e.length," input(s)."));let t,n=e[0],r=e[1];return t=Array.isArray(this.axes)?this.axes.map((t,n)=>$z(t,e[n].shape.length)):[$z(this.axes,n.shape.length),$z(this.axes,r.shape.length)],this.normalize&&(n=vj(n,t[0]),r=vj(r,t[1])),function(e,t,n){if(e.shape.length>3||t.shape.length>3)throw new KL("batchDot is not implemented for tensors of 4D or higher rank yet");if(mw(e.shape.length>=2,()=>"batchDot requires the rank of x to be >= 2, "+"but got ".concat(e.shape.length)),mw(e.shape.length>=2,()=>"batchDot requires the rank of y to be >= 2, "+"but got ".concat(t.shape.length)),"number"===typeof n&&(n=[n,n]),"complex64"===e.dtype||"complex64"===t.dtype)throw new KL("batchDot is not implemented for complex64-type Tensors yet.");const r=e.shape.length,a=t.shape.length;null==n&&(n=[r-1,a-2]);const i=n;return zE(()=>{let n,o;if(r>a){n=r-a;const e=[];for(let t=0;t<n;++t)e.push(1);t=ZT(t,t.shape.concat(e))}else if(a>r){n=a-r;const t=[];for(let e=0;e<n;++e)t.push(1);e=ZT(e,e.shape.concat(t))}else n=0;if(2===e.shape.length&&2===t.shape.length)o=i[0]===i[1]?M_(OI(e,t),i[0]):M_(OI(BA(e,[1,0]),t),i[1]);else{const n=i[0]!==e.shape.length-1,r=i[1]===t.shape.length-1;o=Y_(e,t,n,r)}if(n>0){let e;e=r>a?r+a-3:r-1;const t=[];for(let r=e;r<e+n;++r)t.push(r);o=_A(o,t)}return 1===o.shape.length&&(o=E_(o,1)),o})}(n,r,t)}interpretAxes(e,t){let n;return n=Array.isArray(this.axes)?this.axes:[$z(this.axes,e.length),$z(this.axes,t.length)],n}computeOutputShape(e){mw(Array.isArray(e)&&2===e.length&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const t=e[0].slice(),n=e[1].slice();if(t.length>3||n.length>3)throw new KL("Dot layer does not support tensors of 4D or higher rank yet.");const r=this.interpretAxes(t,n);t.splice(r[0],1),n.splice(r[1],1),n.splice(0,1);const a=t.concat(n);return 1===a.length&&a.push(1),a}computeMask(e,t){return null}getConfig(){const e={axes:this.axes,normalize:this.normalize},t=super.getConfig();return Object.assign(e,t),e}}Jz.className="Dot",HI(Jz);class Qz extends BM{constructor(e){super(e),this.supportsMasking=!0,this.stddev=e.stddev}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={stddev:this.stddev};return Object.assign(t,e),t}call(e,t){return zE(()=>{this.invokeCallHook(e,t);const n=IM(e);return nM(()=>RI(YP(n.shape,0,this.stddev),n),()=>n,t.training||!1)})}}Qz.className="GaussianNoise",HI(Qz);class Zz extends BM{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={rate:this.rate};return Object.assign(t,e),t}call(e,t){return zE(()=>{this.invokeCallHook(e,t);const n=IM(e);if(this.rate>0&&this.rate<1){return nM(()=>{const e=Math.sqrt(this.rate/(1-this.rate));return OI(n,YP(n.shape,1,e))},()=>n,t.training||!1)}return n})}}Zz.className="GaussianDropout",HI(Zz);class eU extends BM{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate,this.noiseShape=e.noiseShape}_getNoiseShape(e){return this.noiseShape||IM(e).shape}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={rate:this.rate};return Object.assign(t,e),t}call(e,t){return zE(()=>{if(this.rate<1&&this.rate>0){const n=this._getNoiseShape(e),r=()=>{const t=IM(e),r=-1.7580993408473766;let a=F_(pA(n),this.rate);a=UP(a,"float32");const i=((1-this.rate)*(1+this.rate*r**2))**-.5,o=-i*r*this.rate,s=RI(OI(t,a),OI(RI(a,-1),r));return RI(OI(s,i),o)};return nM(r,()=>IM(e),t.training||!1)}return e})}}function tU(e,t,n,r,a){let i,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.001;if(2===e.rank)i=r_(e,t,n,r,a,o);else if(3===e.rank)i=a_(e,t,n,r,a,o);else{if(4!==e.rank)throw new KL("batchNormalization is not implemented for array of rank ".concat(e.rank," ")+"yet");i=i_(e,t,n,r,a,o)}return i}function nU(e,t,n,r){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.001;return yw(r.slice().sort(),jP(0,e.rank-1))?function(e,t,n,r){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.001;return zE(()=>{const i=tA(e,r),o=i.mean,s=i.variance;return[tU(e,o,s,n,t,a),o,s]})}(e,t,n,r,a):function(e,t,n,r){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.001;return zE(()=>{const i=tA(e,r),o=i.mean,s=i.variance,c=[];for(const t of jP(0,e.rank))-1!==r.indexOf(t)?c.push(1):c.push(e.shape[t]);const l=ZT(o,c),u=ZT(s,c),h=null==t?null:ZT(t,c),d=null==n?null:ZT(n,c);return[tU(e,l,u,d,h,a),o,s]})}(e,t,n,r,a)}eU.className="AlphaDropout",HI(eU);class rU extends BM{constructor(e){null==e&&(e={}),super(e),this.supportsMasking=!0,this.axis=null==e.axis?-1:e.axis,this.momentum=null==e.momentum?.99:e.momentum,this.epsilon=null==e.epsilon?.001:e.epsilon,this.center=null==e.center||e.center,this.scale=null==e.scale||e.scale,this.betaInitializer=NM(e.betaInitializer||"zeros"),this.gammaInitializer=NM(e.gammaInitializer||"ones"),this.movingMeanInitializer=NM(e.movingMeanInitializer||"zeros"),this.movingVarianceInitializer=NM(e.movingVarianceInitializer||"ones"),this.betaConstraint=aj(e.betaConstraint),this.gammaConstraint=aj(e.gammaConstraint),this.betaRegularizer=HB(e.betaRegularizer),this.gammaRegularizer=HB(e.gammaRegularizer)}build(e){e=TM(e);const t=this.axis>=0?this.axis:this.axis+e.length,n=e[t];if(null==n)throw new qL("Axis ".concat(t," of input tensor should have a defined dimension but ")+"the layer received an input with shape "+"".concat(JSON.stringify(e),"."));this.inputSpec=[new OM({ndim:e.length,axes:{[t]:n}})];const r=[n];this.scale&&(this.gamma=this.addWeight("gamma",r,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",r,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",r,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",r,null,this.movingVarianceInitializer,null,!1),this.built=!0}call(e,t){return zE(()=>{const n=null!=t.training&&t.training,r=IM(e),a=r.shape,i=a.length,o=jP(0,i),s=this.axis>=0?this.axis:this.axis+i;o.splice(s,1);const c=$L(1,i);c[s]=a[s];const l=o.slice();l.sort();const u=!yw(l,jP(0,i).slice(0,i-1));if(!n)return(()=>{if(u){const e=ZT(this.movingMean.read(),c),t=ZT(this.movingVariance.read(),c),n=this.center?ZT(this.beta.read(),c):null,a=this.scale?ZT(this.gamma.read(),c):null;return tU(r,e,t,n,a,this.epsilon)}return tU(r,this.movingMean.read(),this.movingVariance.read(),null==this.beta?null:this.beta.read(),null==this.gamma?null:this.gamma.read(),this.epsilon)})();const[h,d,f]=nU(r,this.gamma.read(),this.beta.read(),o,this.epsilon),p=(e,t,n)=>{zE(()=>{const r=1-n,a=e.read(),i=OI($I(a,t),r);e.write($I(a,i))})};return(()=>{p(this.movingMean,d,this.momentum),p(this.movingVariance,f,this.momentum)})(),h})}getConfig(){const e={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:SM(this.betaInitializer),gammaInitializer:SM(this.gammaInitializer),movingMeanInitializer:SM(this.movingMeanInitializer),movingVarianceInitializer:SM(this.movingVarianceInitializer),betaRegularizer:WB(this.betaRegularizer),gammaRegularizer:WB(this.gammaRegularizer),betaConstraint:nj(this.betaConstraint),gammaConstraint:nj(this.gammaConstraint)},t=super.getConfig();return Object.assign(e,t),e}}rU.className="BatchNormalization",HI(rU);class aU extends BM{constructor(e){if(null==e&&(e={}),super(e),this.axis=null==e.axis?-1:e.axis,"number"===typeof this.axis){if(!Number.isInteger(this.axis))throw new Error("Expected axis to be an integer, but received ".concat(this.axis))}else{if(!Array.isArray(this.axis))throw new Error("Expected axis to be an integer or an array of integers, "+"but received ".concat(JSON.stringify(this.axis)));for(const e of this.axis)if(!Number.isInteger(e))throw new Error("Expected axis to be an array of integers, "+"but received ".concat(JSON.stringify(this.axis)))}this.epsilon=null==e.epsilon?.001:e.epsilon,this.center=null==e.center||e.center,this.scale=null==e.scale||e.scale,this.betaInitializer=NM(e.betaInitializer||"zeros"),this.gammaInitializer=NM(e.gammaInitializer||"ones"),this.betaRegularizer=HB(e.betaRegularizer),this.gammaRegularizer=HB(e.gammaRegularizer),this.supportsMasking=!0}build(e){const t=(e=TM(e)).length;"number"===typeof this.axis&&(this.axis=[this.axis]);for(let a=0;a<this.axis.length;++a)this.axis[a]<0&&(this.axis[a]+=t);for(const a of this.axis)if(a<0||a>=t)throw new Error("Invalid axis: ".concat(a));if(this.axis.length!==cP(this.axis).length)throw new Error("Found duplicate axes in: ".concat(this.axis));const n=this.axis.map(t=>e[t]),r=!0;this.scale?this.gamma=this.addWeight("gamma",n,"float32",this.gammaInitializer,this.gammaRegularizer,r):this.gamma=null,this.center?this.beta=this.addWeight("beta",n,"float32",this.betaInitializer,this.betaRegularizer,r):this.beta=null,this.built=!0}call(e,t){const n=IM(e),r=n.shape,a=r.length;return zE(()=>{let{mean:e,variance:t}=tA(n,this.axis,!0);const i=$L(1,a);for(const n of this.axis)i[n]=r[n];const o=e=>null!=e&&e.shape.length!==a?ZT(e,i):e;let s=this.scale?o(this.gamma.read()):null,c=this.center?o(this.beta.read()):null;const l=[],u=[];for(let n=0;n<a;++n)-1!==this.axis.indexOf(n)?(l.push(r[n]),u.push(1)):(l.push(1),u.push(r[n]));return e=I_(e,l),t=I_(t,l),null!=s&&(s=I_(s,u)),null!=c&&(c=I_(c,u)),tU(n,e,t,c,s,this.epsilon)})}getConfig(){const e={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:SM(this.betaInitializer),gammaInitializer:SM(this.gammaInitializer),betaRegularizer:WB(this.betaRegularizer),gammaRegularizer:WB(this.gammaRegularizer)},t=super.getConfig();return Object.assign(e,t),e}}aU.className="LayerNormalization",HI(aU);class iU extends BM{constructor(e){if(null==e&&(e={}),super(e),this.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,null==e.padding)this.padding=[[1,1],[1,1]];else if("number"===typeof e.padding)this.padding=[[e.padding,e.padding],[e.padding,e.padding]];else{if(e.padding=e.padding,2!==e.padding.length)throw new qL("ZeroPadding2D expects padding to be a length-2 array, but "+"received a length-".concat(e.padding.length," array."));let t,n;if("number"===typeof e.padding[0])t=[e.padding[0],e.padding[0]],n=[e.padding[1],e.padding[1]];else{if(e.padding=e.padding,2!==e.padding[0].length)throw new qL("ZeroPadding2D expects height padding to be a length-2 array, "+"but received a length-".concat(e.padding[0].length," array."));if(t=e.padding[0],2!==e.padding[1].length)throw new qL("ZeroPadding2D expects width padding to be a length-2 array, "+"but received a length-".concat(e.padding[1].length," array."));n=e.padding[1]}this.padding=[t,n]}this.inputSpec=[new OM({ndim:4})]}computeOutputShape(e){let t,n;return e=TM(e),"channelsFirst"===this.dataFormat?(t=null!=e[2]&&e[2]>=0?e[2]+this.padding[0][0]+this.padding[0][1]:null,n=null!=e[3]&&e[3]>=0?e[3]+this.padding[1][0]+this.padding[1][1]:null,[e[0],e[1],t,n]):(t=null!=e[1]&&e[1]>=0?e[1]+this.padding[0][0]+this.padding[0][1]:null,n=null!=e[2]&&e[2]>=0?e[2]+this.padding[1][0]+this.padding[1][1]:null,[e[0],t,n,e[3]])}call(e,t){return zE(()=>function(e,t,n){return zE(()=>{if(4!==e.rank)throw new qL("temporalPadding expects input tensor to be 4-D, but received a "+"".concat(e.rank,"-D tensor."));if(null==t&&(t=[[1,1],[1,1]]),2!==t.length||2!==t[0].length||2!==t[1].length)throw new qL("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(null==n&&(n="channelsLast"),"channelsLast"!==n&&"channelsFirst"!==n)throw new qL("Unknown data format: ".concat(n,". ")+"Supported data formats are 'channelsLast' and 'channelsFirst.");let r;return r="channelsFirst"===n?[[0,0],[0,0],t[0],t[1]]:[[0,0],t[0],t[1],[0,0]],cA(e,r)})}(IM(e),this.padding,this.dataFormat))}getConfig(){const e={padding:this.padding,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}function oU(e,t,n,r,a,i){return zE(()=>{let o;CP(a),IP(i),EP(r),null==n&&(n=[1,1]),null==r&&(r="valid"),null==a&&(a="channelsLast"),null==i&&(i="max"),e=ez(e,a);const s="same"===r?"same":"valid";return o="max"===i?$_(e,t,n,s):e_(e,t,n,s),"channelsFirst"===a&&(o=BA(o,[0,3,1,2])),o})}function sU(e,t,n,r,a,i){return zE(()=>{let o;CP(a),IP(i),EP(r),null==n&&(n=[1,1,1]),null==r&&(r="valid"),null==a&&(a="channelsLast"),null==i&&(i="max"),e=tz(e,a);const s="same"===r?"same":"valid";return o="max"===i?J_(e,t,n,s):t_(e,t,n,s),"channelsFirst"===a&&(o=BA(o,[0,4,1,2,3])),o})}iU.className="ZeroPadding2D",HI(iU);class cU extends BM{constructor(e){if(null==e.poolSize&&(e.poolSize=2),super(e),"number"===typeof e.poolSize)this.poolSize=[e.poolSize];else{if(!Array.isArray(e.poolSize)||1!==e.poolSize.length||"number"!==typeof e.poolSize[0])throw new qL("poolSize for 1D convolutional layer must be a number or an Array of a single number, but received "+"".concat(JSON.stringify(e.poolSize)));this.poolSize=e.poolSize}if(dP(this.poolSize,"poolSize"),null==e.strides)this.strides=this.poolSize;else if("number"===typeof e.strides)this.strides=[e.strides];else{if(!Array.isArray(e.strides)||1!==e.strides.length||"number"!==typeof e.strides[0])throw new qL("strides for 1D convolutional layer must be a number or an Array of a single number, but received "+"".concat(JSON.stringify(e.strides)));this.strides=e.strides}dP(this.strides,"strides"),this.padding=null==e.padding?"valid":e.padding,EP(this.padding),this.inputSpec=[new OM({ndim:3})]}computeOutputShape(e){const t=QB((e=TM(e))[1],this.poolSize[0],this.padding,this.strides[0]);return[e[0],t,e[2]]}call(e,t){return zE(()=>{this.invokeCallHook(e,t),e=WP(IM(e),2);const n=this.poolingFunction(IM(e),[this.poolSize[0],1],[this.strides[0],1],this.padding,"channelsLast");return _A(n,[2])})}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides},t=super.getConfig();return Object.assign(e,t),e}}class lU extends cU{constructor(e){super(e)}poolingFunction(e,t,n,r,a){return CP(a),EP(r),oU(e,t,n,r,a,"max")}}lU.className="MaxPooling1D",HI(lU);class uU extends cU{constructor(e){super(e)}poolingFunction(e,t,n,r,a){return CP(a),EP(r),oU(e,t,n,r,a,"avg")}}uU.className="AveragePooling1D",HI(uU);class hU extends BM{constructor(e){if(null==e.poolSize&&(e.poolSize=[2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize],null==e.strides)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(2!==e.strides.length)throw new qL("If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length "+"".concat(e.strides.length,"."));this.strides=e.strides}else this.strides=[e.strides,e.strides];dP(this.poolSize,"poolSize"),dP(this.strides,"strides"),this.padding=null==e.padding?"valid":e.padding,this.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,CP(this.dataFormat),EP(this.padding),this.inputSpec=[new OM({ndim:4})]}computeOutputShape(e){e=TM(e);let t="channelsFirst"===this.dataFormat?e[2]:e[1],n="channelsFirst"===this.dataFormat?e[3]:e[2];return t=QB(t,this.poolSize[0],this.padding,this.strides[0]),n=QB(n,this.poolSize[1],this.padding,this.strides[1]),"channelsFirst"===this.dataFormat?[e[0],e[1],t,n]:[e[0],t,n,e[3]]}call(e,t){return zE(()=>(this.invokeCallHook(e,t),this.poolingFunction(IM(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class dU extends hU{constructor(e){super(e)}poolingFunction(e,t,n,r,a){return CP(a),EP(r),oU(e,t,n,r,a,"max")}}dU.className="MaxPooling2D",HI(dU);class fU extends hU{constructor(e){super(e)}poolingFunction(e,t,n,r,a){return CP(a),EP(r),oU(e,t,n,r,a,"avg")}}fU.className="AveragePooling2D",HI(fU);class pU extends BM{constructor(e){if(null==e.poolSize&&(e.poolSize=[2,2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize,e.poolSize],null==e.strides)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(3!==e.strides.length)throw new qL("If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length "+"".concat(e.strides.length,"."));this.strides=e.strides}else this.strides=[e.strides,e.strides,e.strides];dP(this.poolSize,"poolSize"),dP(this.strides,"strides"),this.padding=null==e.padding?"valid":e.padding,this.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,CP(this.dataFormat),EP(this.padding),this.inputSpec=[new OM({ndim:5})]}computeOutputShape(e){e=TM(e);let t="channelsFirst"===this.dataFormat?e[2]:e[1],n="channelsFirst"===this.dataFormat?e[3]:e[2],r="channelsFirst"===this.dataFormat?e[4]:e[3];return t=QB(t,this.poolSize[0],this.padding,this.strides[0]),n=QB(n,this.poolSize[1],this.padding,this.strides[1]),r=QB(r,this.poolSize[2],this.padding,this.strides[2]),"channelsFirst"===this.dataFormat?[e[0],e[1],t,n,r]:[e[0],t,n,r,e[4]]}call(e,t){return zE(()=>(this.invokeCallHook(e,t),this.poolingFunction(IM(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class mU extends pU{constructor(e){super(e)}poolingFunction(e,t,n,r,a){return CP(a),EP(r),sU(e,t,n,r,a,"max")}}mU.className="MaxPooling3D",HI(mU);class gU extends pU{constructor(e){super(e)}poolingFunction(e,t,n,r,a){return CP(a),EP(r),sU(e,t,n,r,a,"avg")}}gU.className="AveragePooling3D",HI(gU);class vU extends BM{constructor(e){super(e),this.inputSpec=[new OM({ndim:3})]}computeOutputShape(e){return[e[0],e[2]]}call(e,t){throw new KL}}class bU extends vU{constructor(e){super(e||{})}call(e,t){return zE(()=>{const t=IM(e);return Q_(t,1)})}}bU.className="GlobalAveragePooling1D",HI(bU);class yU extends vU{constructor(e){super(e||{})}call(e,t){return zE(()=>{const t=IM(e);return P_(t,1)})}}yU.className="GlobalMaxPooling1D",HI(yU);class xU extends BM{constructor(e){super(e),this.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,CP(this.dataFormat),this.inputSpec=[new OM({ndim:4})]}computeOutputShape(e){return"channelsLast"===this.dataFormat?[e[0],e[3]]:[e[0],e[1]]}call(e,t){throw new KL}getConfig(){const e={dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class wU extends xU{call(e,t){return zE(()=>{const t=IM(e);return"channelsLast"===this.dataFormat?Q_(t,[1,2]):Q_(t,[2,3])})}}wU.className="GlobalAveragePooling2D",HI(wU);class kU extends xU{call(e,t){return zE(()=>{const t=IM(e);return"channelsLast"===this.dataFormat?P_(t,[1,2]):P_(t,[2,3])})}}kU.className="GlobalMaxPooling2D",HI(kU);class SU extends BM{constructor(e){super(e),this.layer=e.layer}build(e){this.built=!0}get trainable(){return null!=this.layer&&this.layer.trainable}set trainable(e){null!=this.layer&&(this.layer.trainable=e)}get trainableWeights(){return this.layer.trainableWeights}get nonTrainableWeights(){return this.layer.nonTrainableWeights}get updates(){return this.layer._updates}get losses(){return this.layer.losses}getWeights(){return this.layer.getWeights()}setWeights(e){this.layer.setWeights(e)}getConfig(){const e={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},t=super.getConfig();return Object.assign(e,t),e}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),null!=this.layer&&this.layer.setFastWeightInitDuringBuild(e)}static fromConfig(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=gj(t.layer,n);delete t.layer;const a={layer:r};return Object.assign(a,t),new e(a)}}class NU extends SU{constructor(e){super(e),this.supportsMasking=!0}build(e){if((e=TM(e)).length<3)throw new qL("TimeDistributed layer expects an input shape >= 3D, but received "+"input shape ".concat(JSON.stringify(e)));this.inputSpec=[{shape:e}];const t=[e[0]].concat(e.slice(2));this.layer.built||(this.layer.build(t),this.layer.built=!0),super.build(e)}computeOutputShape(e){const t=[(e=TM(e))[0]].concat(e.slice(2)),n=this.layer.computeOutputShape(t),r=e[1];return[n[0],r].concat(n.slice(1))}call(e,t){return zE(()=>bz((e,n)=>[IM(this.layer.call(e,t)),[]],e=IM(e),[],!1,null,null,!1,!0)[1])}}NU.className="TimeDistributed",HI(NU);class CU extends SU{constructor(e){super(e);const t=e.layer.getConfig(),n={};n.className=e.layer.getClassName(),n.config=t,this.forwardLayer=gj(n),t.goBackwards=!0!==t.goBackwards;const r={};if(r.className=e.layer.getClassName(),r.config=t,this.backwardLayer=gj(r),this.forwardLayer.name="forward_"+this.forwardLayer.name,this.backwardLayer.name="backward_"+this.backwardLayer.name,this.mergeMode=void 0===e.mergeMode?"concat":e.mergeMode,function(e){uP(SP,"BidirectionalMergeMode",e)}(this.mergeMode),e.weights)throw new KL("weights support is not implemented for Bidirectional layer yet.");this._stateful=e.layer.stateful,this.returnSequences=e.layer.returnSequences,this.returnState=e.layer.returnState,this.supportsMasking=!0,this._trainable=!0,this.inputSpec=e.layer.inputSpec,this.numConstants=null}get trainable(){return this._trainable}set trainable(e){this._trainable=e,null!=this.forwardLayer&&(this.forwardLayer.trainable=e),null!=this.backwardLayer&&(this.backwardLayer.trainable=e)}getWeights(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}setWeights(e){const t=e.length,n=Math.floor(t/2);this.forwardLayer.setWeights(e.slice(0,n)),this.backwardLayer.setWeights(e.slice(n))}computeOutputShape(e){let t,n,r,a=this.forwardLayer.computeOutputShape(e);return Array.isArray(a)&&Array.isArray(a[0])||(a=[a]),this.returnState?(r=a.slice(1),t=a[0]):t=a[0],"concat"===this.mergeMode?(t[t.length-1]*=2,n=[t]):n=null==this.mergeMode?[t,t.slice()]:[t],this.returnState?null==this.mergeMode?n.concat(r).concat(r.slice()):[t].concat(r).concat(r.slice()):ZL(n)}apply(e,t){let n=null==t?null:t.initialState,r=null==t?null:t.constants;null==t&&(t={});const a=vz(e,n,r,this.numConstants);if(e=a.inputs,n=a.initialState,r=a.constants,Array.isArray(e)&&(n=e.slice(1),e=e[0]),(null==n||0===n.length)&&null==r)return super.apply(e,t);const i=[],o=[];if(null!=n){const e=n.length;if(e%2>0)throw new qL("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");t.initialState=n,i.push(...n);const r=n.map(e=>new OM({shape:e.shape}));this.forwardLayer.stateSpec=r.slice(0,e/2),this.backwardLayer.stateSpec=r.slice(e/2),o.push(...r)}if(null!=r)throw new KL("Support for constants in Bidirectional layers is not implemented yet.");const s=i[0]instanceof LM;for(const c of i)if(c instanceof LM!==s)throw new qL("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors");if(s){const n=[e].concat(i),r=this.inputSpec.concat(o),a=this.inputSpec;this.inputSpec=r;const s=super.apply(n,t);return this.inputSpec=a,s}return super.apply(e,t)}call(e,t){return zE(()=>{const n=t.initialState;let r,a,i,o;if(null==n)r=this.forwardLayer.call(e,t),a=this.backwardLayer.call(e,t);else{const i=n.slice(0,n.length/2),o=n.slice(n.length/2);r=this.forwardLayer.call(e,Object.assign(t,{initialState:i})),a=this.backwardLayer.call(e,Object.assign(t,{initialState:o}))}return this.returnState&&(Array.isArray(r)&&(i=r.slice(1).concat(a.slice(1))),r=r[0],a=a[0]),this.returnSequences&&(a=vA(a,1)),"concat"===this.mergeMode?o=qP([r,a]):"sum"===this.mergeMode?o=RI(r,a):"ave"===this.mergeMode?o=OI(.5,RI(r,a)):"mul"===this.mergeMode?o=OI(r,a):null==this.mergeMode&&(o=[r,a]),this.returnState?null==this.mergeMode?o.concat(i):[o].concat(i):o})}resetStates(e){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}build(e){_P(this.forwardLayer.name,()=>{this.forwardLayer.build(e)}),_P(this.backwardLayer.name,()=>{this.backwardLayer.build(e)}),this.built=!0}computeMask(e,t){let n;if(Array.isArray(t)&&(t=t[0]),n=this.returnSequences?null==this.mergeMode?[t,t]:t:null==this.mergeMode?[null,null]:null,this.returnState){const e=this.forwardLayer.states.map(e=>null);return Array.isArray(n)?n.concat(e).concat(e):[n].concat(e).concat(e)}return n}get trainableWeights(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}get nonTrainableWeights(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),null!=this.forwardLayer&&this.forwardLayer.setFastWeightInitDuringBuild(e),null!=this.backwardLayer&&this.backwardLayer.setFastWeightInitDuringBuild(e)}getConfig(){const e={mergeMode:this.mergeMode},t=super.getConfig();return Object.assign(e,t),e}static fromConfig(e,t){const n=gj(t.layer);if(delete t.layer,null!=t.numConstants)throw new KL("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");const r=t;return r.layer=n,new e(r)}}CU.className="Bidirectional",HI(CU);class EU extends BM{constructor(e){super(e),this.scale=e.scale,e.offset?this.offset=e.offset:this.offset=0}getConfig(){const e={scale:this.scale,offset:this.offset},t=super.getConfig();return Object.assign(e,t),e}call(e,t){return zE(()=>("float32"!==(e=IM(e)).dtype&&(e=UP(e,"float32")),RI(OI(e,this.scale),this.offset)))}}EU.className="Rescaling",HI(EU);const{resizeBilinear:IU,cropAndResize:TU}=zR;class _U extends BM{constructor(e){super(e),this.height=e.height,this.width=e.width}centerCrop(e,t,n,r,a,i,o,s){return zE(()=>{let c,l=!1;const u=[t/i,n/o,(r+t)/i,(a+n)/o],h=[];3===e.rank?(l=!0,c=AA([e])):c=e;for(let e=0;e<c.shape[0];e++)h.push(u);const d=PE(h,[h.length,4]),f=mA(0,h.length,1,"int32"),p=TU(c,d,f,[r,a],"nearest");return UP(l?IM(LA(p)):p,s)})}upsize(e,t,n,r){return zE(()=>UP(IU(e,[t,n]),r))}call(e,t){return zE(()=>{const t=IM(e),n=t.dtype,r=t.shape,a=r[r.length-3],i=r[r.length-2];let o=0;a!==this.height&&(o=Math.floor((a-this.height)/2));let s=0;return i!==this.width&&(s=Math.floor((i-this.width)/2),0===s&&(s=1)),o>=0&&s>=0?this.centerCrop(t,o,s,this.height,this.width,a,i,n):this.upsize(e,this.height,this.width,n)})}getConfig(){const e={height:this.height,width:this.width},t=super.getConfig();return Object.assign(e,t),e}computeOutputShape(e){const t=(e=TM(e)).length-3,n=e.length-2;return e[t]=this.height,e[n]=this.width,e}}_U.className="CenterCrop",HI(_U);class AU extends BM{constructor(e){super(e),this.numTokens=e.numTokens,e.outputMode?this.outputMode=e.outputMode:this.outputMode="multiHot"}getConfig(){const e={numTokens:this.numTokens,outputMode:this.outputMode},t=super.getConfig();return Object.assign(e,t),e}computeOutputShape(e){return null==(e=TM(e))?[this.numTokens]:"oneHot"===this.outputMode&&1!==e[e.length-1]?(e.push(this.numTokens),e):(e[e.length-1]=this.numTokens,e)}call(e,t){return zE(()=>{let n;if("int32"!==(e=IM(e)).dtype&&(e=UP(e,"int32")),"undefined"!==typeof t.countWeights){if("count"!==this.outputMode)throw new qL("countWeights is not used when outputMode !== count.\n              Received countWeights=".concat(t.countWeights));n=IM(t.countWeights)}const r=P_(e),a=Z_(e),i=R_(this.numTokens,r).bufferSync().get(0),o=F_(a,0).bufferSync().get(0);if(!i||!o)throw new qL("Input values must be between 0 < values <="+" numTokens with numTokens=".concat(this.numTokens));return function(e,t,n,r){let a=IM(e);if("int32"!==a.dtype&&(a=UP(a,"int32")),"int"===t)return a;const i=a.shape;if(0===a.rank&&(a=E_(a,-1)),"oneHot"===t&&1!==a.shape[a.shape.length-1]&&(a=E_(a,-1)),a.rank>2)throw new qL("When outputMode is not int, maximum output rank is 2"+" Received outputMode ".concat(t," and input shape ").concat(i)+" which would result in output rank ".concat(a.rank,"."));const o=["multiHot","oneHot"].includes(t),s=a;let c;if(c=x_(s,"undefined"!==typeof r&&"count"===t?r:[],n,o),"tfIdf"!==t)return c;if(r)return OI(c,r);throw new qL("When outputMode is 'tfIdf', weights must be provided.")}(e,this.outputMode,this.numTokens,n)})}}AU.className="CategoryEncoding",HI(AU);const RU=new Set(["bilinear","nearest"]);class FU extends BM{constructor(e){if(super(e),this.height=e.height,this.width=e.width,e.interpolation){if(!RU.has(e.interpolation))throw new qL("Invalid interpolation parameter: ".concat(e.interpolation," is not implemented"));this.interpolation=e.interpolation}else this.interpolation="bilinear";this.cropToAspectRatio=Boolean(e.cropToAspectRatio)}computeOutputShape(e){const t=(e=TM(e))[2];return[this.height,this.width,t]}getConfig(){const e={height:this.height,width:this.width,interpolation:this.interpolation,cropToAspectRatio:this.cropToAspectRatio},t=super.getConfig();return Object.assign(e,t),e}call(e,t){return zE(()=>{const t=[this.height,this.width];if("bilinear"===this.interpolation)return zR.resizeBilinear(e,t,!this.cropToAspectRatio);if("nearest"===this.interpolation)return zR.resizeNearestNeighbor(e,t,!this.cropToAspectRatio);throw new Error("Interpolation is ".concat(this.interpolation," but only ").concat([...RU]," are supported"))})}}FU.className="Resizing",HI(FU);class DU{constructor(e){this.seed=e}next(){if(void 0!==this.seed)return this.seed++}}DU.className="RandomSeed";class OU extends BM{constructor(e){super(e),this.randomGenerator=new DU(e.seed)}getConfig(){const e={seed:this.randomGenerator.seed},t=super.getConfig();return Object.assign(e,t),e}}OU.className="BaseRandomLayer";const LU=new Set(["bilinear","nearest"]);class PU extends OU{constructor(e){super(e);const{factor:t,interpolation:n="bilinear"}=e;if(this.factor=t,Array.isArray(this.factor)&&2===this.factor.length)this.widthLower=this.factor[0],this.widthUpper=this.factor[1];else{if(Array.isArray(this.factor)||!(this.factor>0))throw new qL("Invalid factor: ".concat(this.factor,". Must be positive number or tuple of 2 numbers"));this.widthLower=-this.factor,this.widthUpper=this.factor}if(this.widthLower<-1||this.widthUpper<-1)throw new qL("factor must have values larger than -1. Got: ".concat(this.factor));if(this.widthUpper<this.widthLower)throw new qL("factor cannot have upper bound less than lower bound.\n        Got upper bound: ".concat(this.widthUpper,".\n        Got lower bound: ").concat(this.widthLower,"\n      "));if(n){if(!LU.has(n))throw new qL("Invalid interpolation parameter: ".concat(n," is not implemented"));this.interpolation=n}}getConfig(){const e={factor:this.factor,interpolation:this.interpolation},t=super.getConfig();return Object.assign(e,t),e}computeOutputShape(e){const t=(e=TM(e))[2];return[this.imgHeight,-1,t]}call(e,t){return zE(()=>{const t=IM(e);this.imgHeight=t.shape[t.shape.length-3];const n=t.shape[t.shape.length-2];this.widthFactor=pA([1],1+this.widthLower,1+this.widthUpper,"float32",this.randomGenerator.next());let r=this.widthFactor.dataSync()[0]*n;r=Math.round(r);const a=[this.imgHeight,r];switch(this.interpolation){case"bilinear":return zR.resizeBilinear(e,a);case"nearest":return zR.resizeNearestNeighbor(e,a);default:throw new Error("Interpolation is ".concat(this.interpolation,"\n          but only ").concat([...LU]," are supported"))}})}}PU.className="RandomWidth",HI(PU);var MU,jU;Yw().registerFlag("KEEP_INTERMEDIATE_TENSORS",()=>!1,e=>{e&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")}),function(e){e[e.DT_INVALID=0]="DT_INVALID",e[e.DT_FLOAT=1]="DT_FLOAT",e[e.DT_DOUBLE=2]="DT_DOUBLE",e[e.DT_INT32=3]="DT_INT32",e[e.DT_UINT8=4]="DT_UINT8",e[e.DT_INT16=5]="DT_INT16",e[e.DT_INT8=6]="DT_INT8",e[e.DT_STRING=7]="DT_STRING",e[e.DT_COMPLEX64=8]="DT_COMPLEX64",e[e.DT_INT64=9]="DT_INT64",e[e.DT_BOOL=10]="DT_BOOL",e[e.DT_QINT8=11]="DT_QINT8",e[e.DT_QUINT8=12]="DT_QUINT8",e[e.DT_QINT32=13]="DT_QINT32",e[e.DT_BFLOAT16=14]="DT_BFLOAT16",e[e.DT_QINT16=15]="DT_QINT16",e[e.DT_QUINT16=16]="DT_QUINT16",e[e.DT_UINT16=17]="DT_UINT16",e[e.DT_COMPLEX128=18]="DT_COMPLEX128",e[e.DT_HALF=19]="DT_HALF",e[e.DT_RESOURCE=20]="DT_RESOURCE",e[e.DT_VARIANT=21]="DT_VARIANT",e[e.DT_UINT32=22]="DT_UINT32",e[e.DT_UINT64=23]="DT_UINT64",e[e.DT_FLOAT_REF=101]="DT_FLOAT_REF",e[e.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",e[e.DT_INT32_REF=103]="DT_INT32_REF",e[e.DT_UINT8_REF=104]="DT_UINT8_REF",e[e.DT_INT16_REF=105]="DT_INT16_REF",e[e.DT_INT8_REF=106]="DT_INT8_REF",e[e.DT_STRING_REF=107]="DT_STRING_REF",e[e.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",e[e.DT_INT64_REF=109]="DT_INT64_REF",e[e.DT_BOOL_REF=110]="DT_BOOL_REF",e[e.DT_QINT8_REF=111]="DT_QINT8_REF",e[e.DT_QUINT8_REF=112]="DT_QUINT8_REF",e[e.DT_QINT32_REF=113]="DT_QINT32_REF",e[e.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",e[e.DT_QINT16_REF=115]="DT_QINT16_REF",e[e.DT_QUINT16_REF=116]="DT_QUINT16_REF",e[e.DT_UINT16_REF=117]="DT_UINT16_REF",e[e.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",e[e.DT_HALF_REF=119]="DT_HALF_REF",e[e.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",e[e.DT_VARIANT_REF=121]="DT_VARIANT_REF",e[e.DT_UINT32_REF=122]="DT_UINT32_REF",e[e.DT_UINT64_REF=123]="DT_UINT64_REF"}(MU||(MU={})),function(e){let t;!function(e){e[e.LEGACY=0]="LEGACY",e[e.V1=1]="V1",e[e.V2=2]="V2"}(t=e.CheckpointFormatVersion||(e.CheckpointFormatVersion={}))}(jU||(jU={}));Error;new Set(["Switch","Merge","Enter","Exit","NextIteration","StatelessIf","StatelessWhile","if","While"]),new Set(["NonMaxSuppressionV2","NonMaxSuppressionV3","NonMaxSuppressionV5","Where"]),new Set(["HashTable","HashTableV2","LookupTableImport","LookupTableImportV2","LookupTableFind","LookupTableFindV2","LookupTableSize","LookupTableSizeV2"]);function BU(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Map,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Set;if(null==e)return null;if("function"===typeof Blob&&e instanceof Blob)return e.slice();if(r.has(e))throw new Error("Circular references are not supported.");if(n.has(e))return n.get(e);const a=t(e);if(a.recurse&&null!==a.value)throw new Error("A deep map function may not return both a value and recurse=true.");if(a.recurse){if(VU(e)){const a=Array.isArray(e)?[]:{};r.add(e);for(const i in e){const o=BU(e[i],t,n,r);a[i]=o}return r.delete(e),e.__proto__&&(a.__proto__=e.__proto__),a}throw new Error("Can't recurse into non-iterable type: ".concat(e))}return n.set(e,a.value),a.value}function zU(e){return UU(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:WU)}function UU(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Set;const r=e[0];if(n.has(r))throw new Error("Circular references are not supported.");const a=t(e);if(a.recurse&&null!==a.value)throw new Error("A deep zip function may not return both a value and recurse=true.");if(a.recurse){if(VU(r)){const a=Array.isArray(r)?[]:{};n.add(r);for(const i in r){const r=e.map(e=>e[i]),o=UU(r,t,n);a[i]=o}return n.delete(r),a}throw new Error("Can't recurse into non-iterable type: ".concat(r))}return a.value}function WU(e){return null===e?null:VU(e[0])?{value:null,recurse:!0}:{value:e,recurse:!1}}function VU(e){let t=!1;if(Yw().get("IS_BROWSER"))t=e instanceof TextDecoder;else{const{StringDecoder:r}=n(551);t=e instanceof r}return null!=e&&!ArrayBuffer.isView(e)&&(Array.isArray(e)||"object"===typeof e&&!(e instanceof tE)&&!(e instanceof Promise)&&!t)}function HU(e){return function(e,t){return BU(e,t)}(e,GU)}function GU(e){return e instanceof tE?{value:e.clone(),recurse:!1}:VU(e)?{value:null,recurse:!0}:{value:e,recurse:!1}}class qU{constructor(e){if(this.capacity=e,this.begin=0,this.end=0,null==e)throw new RangeError("Can't create a ring buffer of unknown capacity.");if(e<1)throw new RangeError("Can't create ring buffer of capacity < 1.");this.data=new Array(e),this.doubledCapacity=2*e}wrap(e){for(;e<0;)e+=this.doubledCapacity;return e%this.doubledCapacity}get(e){if(e<0)throw new RangeError("Can't get item at a negative index.");return this.data[e%this.capacity]}set(e,t){if(e<0)throw new RangeError("Can't set item at a negative index.");this.data[e%this.capacity]=t}length(){let e=this.end-this.begin;return e<0&&(e=this.doubledCapacity+e),e}isFull(){return this.length()===this.capacity}isEmpty(){return 0===this.length()}push(e){if(this.isFull())throw new RangeError("Ring buffer is full.");this.set(this.end,e),this.end=this.wrap(this.end+1)}pushAll(e){for(const t of e)this.push(t)}pop(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");this.end=this.wrap(this.end-1);const e=this.get(this.end);return this.set(this.end,void 0),e}unshift(e){if(this.isFull())throw new RangeError("Ring buffer is full.");this.begin=this.wrap(this.begin-1),this.set(this.begin,e)}shift(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");const e=this.get(this.begin);return this.set(this.begin,void 0),this.begin=this.wrap(this.begin+1),e}shuffleExcise(e){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");const t=this.wrap(this.begin+e),n=this.get(t);return this.set(t,this.pop()),n}}class KU extends qU{constructor(){super(KU.INITIAL_CAPACITY)}isFull(){return!1}push(e){super.isFull()&&this.expand(),super.push(e)}unshift(e){super.isFull()&&this.expand(),super.unshift(e)}expand(){const e=2*this.capacity,t=new Array(e),n=this.length();for(let r=0;r<n;r++)t[r]=this.get(this.wrap(this.begin+r));this.data=t,this.capacity=e,this.doubledCapacity=2*this.capacity,this.begin=0,this.end=n}}function XU(e){return new QU(e)}function YU(e,t){return new lW(e,t)}KU.INITIAL_CAPACITY=32;class $U{async toArray(){const e=[];let t=await this.next();for(;!t.done;)e.push(t.value),t=await this.next();return e}async toArrayForTest(){const e=this.prefetch(100),t=[];let n=await e.next();for(;!n.done;)t.push(n.value),n=await e.next();return t}async resolveFully(){let e=await this.next();for(;!e.done;)e=await this.next()}async resolveWhile(e){let t=await this.next(),n=e(t.value);for(;!t.done&&n;)t=await this.next(),n=e(t.value)}handleErrors(e){return new iW(this,e)}filter(e){return new rW(this,e)}map(e){return new aW(this,e)}mapAsync(e){return new oW(this,e)}serialMapAsync(e){return new oW(this,e).serial()}flatmap(e){return new cW(this,e)}async forEachAsync(e){return this.map(e).resolveFully()}async serialForEach(e){return this.serialMapAsync(e).resolveWhile(e=>!0===e)}rowMajorBatch(e){return new nW(this,e,!(arguments.length>1&&void 0!==arguments[1])||arguments[1])}columnMajorBatch(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:WU;return this.rowMajorBatch(e,t).map(e=>zU(e,n))}concatenate(e,t){return new lW(new JU([this,e]),t)}take(e){return e<0||null==e?this:new tW(this,e)}skip(e){return e<0||null==e?this:new eW(this,e)}prefetch(e){return new hW(this,e)}shuffle(e,t){return new dW(this,e,t)}serial(){return new ZU(this)}}class JU extends $U{constructor(e){super(),this.items=e,this.trav=0}summary(){return"Array of ".concat(this.items.length," items")}async next(){if(this.trav>=this.items.length)return{value:null,done:!0};const e=this.items[this.trav];return this.trav++,{value:HU(e),done:!1}}}class QU extends $U{constructor(e){super(),this.nextFn=e}summary(){return"Function call"}async next(){try{return this.nextFn()}catch(_a){throw _a.message="Error thrown while iterating through a dataset: ".concat(_a.message),_a}}}class ZU extends $U{constructor(e){super(),this.upstream=e,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return"".concat(this.upstream.summary()," -> Serial")}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){return this.upstream.next()}}class eW extends $U{constructor(e,t){super(),this.upstream=e,this.maxCount=t,this.count=0,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return"".concat(this.upstream.summary()," -> Skip")}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){for(;this.count++<this.maxCount;){const e=await this.upstream.next();if(e.done)return e;UE(e.value)}return this.upstream.next()}}class tW extends $U{constructor(e,t){super(),this.upstream=e,this.maxCount=t,this.count=0}summary(){return"".concat(this.upstream.summary()," -> Take")}async next(){return this.count++>=this.maxCount?{value:null,done:!0}:this.upstream.next()}}class nW extends $U{constructor(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(),this.upstream=e,this.batchSize=t,this.enableSmallLastBatch=n,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return"".concat(this.upstream.summary()," -> RowMajorBatch")}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){const e=[];for(;e.length<this.batchSize;){const t=await this.upstream.next();if(t.done)return this.enableSmallLastBatch&&e.length>0?{value:e,done:!1}:{value:null,done:!0};e.push(t.value)}return{value:e,done:!1}}}class rW extends $U{constructor(e,t){super(),this.upstream=e,this.predicate=t,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return"".concat(this.upstream.summary()," -> Filter")}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){for(;;){const e=await this.upstream.next();if(e.done||this.predicate(e.value))return e;UE(e.value)}}}class aW extends $U{constructor(e,t){super(),this.upstream=e,this.transform=t}summary(){return"".concat(this.upstream.summary()," -> Map")}async next(){const e=await this.upstream.next();if(e.done)return{value:null,done:!0};const t=gE(e.value),n=this.transform(e.value),r=gE(n);for(const a of t)mE(a,r)||a.dispose();return{value:n,done:!1}}}class iW extends $U{constructor(e,t){super(),this.upstream=e,this.handler=t,this.count=0,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return"".concat(this.upstream.summary()," -> handleErrors")}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){for(;;)try{return await this.upstream.next()}catch(_a){if(!this.handler(_a))return{value:null,done:!0}}}}class oW extends $U{constructor(e,t){super(),this.upstream=e,this.transform=t}summary(){return"".concat(this.upstream.summary()," -> AsyncMap")}async next(){const e=await this.upstream.next();if(e.done)return{value:null,done:!0};const t=gE(e.value),n=await this.transform(e.value),r=gE(n);for(const a of t)mE(a,r)||a.dispose();return{value:n,done:!1}}}class sW extends $U{constructor(){super(),this.outputQueue=new KU,this.lastRead=Promise.resolve({value:null,done:!1})}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){for(;0===this.outputQueue.length();)if(!await this.pump())return{value:null,done:!0};return{value:this.outputQueue.shift(),done:!1}}}class cW extends sW{constructor(e,t){super(),this.upstream=e,this.transform=t}summary(){return"".concat(this.upstream.summary()," -> Flatmap")}async pump(){const e=await this.upstream.next();if(e.done)return!1;const t=gE(e.value),n=this.transform(e.value),r=gE(n);this.outputQueue.pushAll(n);for(const a of t)mE(a,r)||a.dispose();return!0}}class lW extends $U{constructor(e,t){super(),this.baseErrorHandler=t,this.lastRead=null,this.iterator=null,this.moreIterators=e}summary(){return"".concat("TODO: fill in upstream of chained summaries"," -> Chained")}async next(){return this.lastRead=this.readFromChain(this.lastRead),this.lastRead}async readFromChain(e){if(await e,null==this.iterator){const e=await this.moreIterators.next();if(e.done)return{value:null,done:!0};this.iterator=e.value,null!=this.baseErrorHandler&&(this.iterator=this.iterator.handleErrors(this.baseErrorHandler))}const t=await this.iterator.next();return t.done?(this.iterator=null,this.readFromChain(e)):t}}var uW;!function(e){e[e.FAIL=0]="FAIL",e[e.SHORTEST=1]="SHORTEST",e[e.LONGEST=2]="LONGEST"}(uW||(uW={}));class hW extends $U{constructor(e,t){super(),this.upstream=e,this.bufferSize=t,this.buffer=new qU(t)}summary(){return"".concat(this.upstream.summary()," -> Prefetch")}refill(){for(;!this.buffer.isFull();){const e=this.upstream.next();this.buffer.push(e)}}next(){return this.refill(),this.buffer.shift()}}class dW extends hW{constructor(e,t,n){super(e,t),this.upstream=e,this.windowSize=t,this.upstreamExhausted=!1,this.random=uA.alea(n||jC().toString()),this.lastRead=Promise.resolve({value:null,done:!1})}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}randomInt(e){return Math.floor(this.random()*e)}chooseIndex(){return this.randomInt(this.buffer.length())}async serialNext(){for(this.upstreamExhausted||this.refill();!this.buffer.isEmpty();){const e=this.chooseIndex(),t=await this.buffer.shuffleExcise(e);if(!t.done)return this.refill(),t;this.upstreamExhausted=!0}return{value:null,done:!0}}}class fW{constructor(){this.size=null}batch(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const n=this;let r;return mw(e>0,()=>"batchSize needs to be positive, but it is\n      ".concat(e)),r=this.size===1/0||null==this.size?this.size:t?Math.ceil(this.size/e):Math.floor(this.size/e),pW(async()=>(await n.iterator()).columnMajorBatch(e,t,mW),r)}concatenate(e){const t=this;let n;return n=this.size===1/0||e.size===1/0?1/0:null!=this.size&&null!=e.size?this.size+e.size:null,pW(async()=>(await t.iterator()).concatenate(await e.iterator()),n)}filter(e){const t=this;let n;return n=this.size===1/0?1/0:null,pW(async()=>(await t.iterator()).filter(t=>zE(()=>e(t))),n)}async forEachAsync(e){return(await this.iterator()).forEachAsync(e)}map(e){const t=this;return pW(async()=>(await t.iterator()).map(t=>zE(()=>e(t))),this.size)}mapAsync(e){const t=this;return pW(async()=>(await t.iterator()).mapAsync(e),this.size)}prefetch(e){if(null==e)throw new RangeError("`Dataset.prefetch()` requires bufferSize to be specified.");const t=this;return pW(async()=>(await t.iterator()).prefetch(e),this.size)}repeat(e){const t=this;let n;return n=null!=this.size&&e>0?this.size*e:0===e?0:null!=this.size&&(void 0===e||e<0)?1/0:null,pW(async()=>YU(XU(async()=>({value:await t.iterator(),done:!1})).take(e)),n)}skip(e){const t=this;let n;return n=null!=this.size&&e>=0&&this.size>=e?this.size-e:null!=this.size&&(this.size<e||void 0===e||e<0)?0:null,pW(async()=>(await t.iterator()).skip(e),n)}shuffle(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(null==e||e<0)throw null==this.size?new RangeError("`Dataset.shuffle()` requires bufferSize to be specified."):new RangeError("`Dataset.shuffle()` requires bufferSize to be specified.  If your data fits in main memory (for regular JS objects), and/or GPU memory (for `tf.Tensor`s), consider setting "+"bufferSize to the dataset size (".concat(this.size," elements)"));const r=this,a=uA.alea(t||jC().toString());return pW(async()=>{let t=a.int32();return n&&(t+=a.int32()),(await r.iterator()).shuffle(e,t.toString())},this.size)}take(e){const t=this;let n;return n=null!=this.size&&this.size>e?e:null!=this.size&&this.size<=e?this.size:null,pW(async()=>(await t.iterator()).take(e),n)}async toArray(){if(this.size===1/0)throw new Error("Can not convert infinite data stream to array.");return(await this.iterator()).toArray()}async toArrayForTest(){if(this.size===1/0)throw new Error("Can not convert infinite data stream to array.");return(await this.iterator()).toArrayForTest()}}function pW(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return new class extends fW{constructor(){super(...arguments),this.size=t}async iterator(){return e()}}}function mW(e){if(null===e)return null;const t=e[0];if(null==(n=t)||function(e){return null===e||"object"!==typeof e&&"function"!==typeof e}(n)||Array.isArray(n)||"object"===typeof n&&n instanceof tE||UC(n)){return{value:function(e){if(0===e.length)throw new Error("Can't make a batch of zero elements.");return e[0]instanceof tE?AA(e):PE(e)}(e),recurse:!1}}var n;return{value:null,recurse:!0}}fW.MAX_BUFFER_SIZE=1e4;Symbol("out"),Symbol("field"),Symbol("quote"),Symbol("quoteafterquote"),Symbol("quoteinquote");function gW(e,t){Array.isArray(e)||(e=[e]),e.forEach(e=>{null!=e&&mw("complex64"!==e.dtype,()=>"".concat(t," does not support complex64 tensors in the CPU backend."))})}const vW=eD;class bW extends lw{nextDataId(){return bW.nextDataId++}constructor(){super(),this.blockSize=48,this.firstUse=!0,this.data=new cw(this,jE())}write(e,t,n){this.firstUse&&(this.firstUse=!1,Yw().get("IS_NODE")&&hC("\n============================\nHi, looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, visit https://github.com/tensorflow/tfjs-node for more details. \n============================"));const r={id:this.nextDataId()};return this.data.set(r,{values:e,dtype:n,refCount:1}),r}makeTensorInfo(e,t,n){let r;if("string"===t&&null!=n&&n.length>0&&Rw(n[0])){const a=n.map(e=>BC(e));r=this.write(a,e,t)}else r=this.write(n,e,t);return{dataId:r,shape:e,dtype:t}}refCount(e){if(this.data.has(e)){return this.data.get(e).refCount}return 0}incRef(e){this.data.get(e).refCount++}decRef(e){if(this.data.has(e)){this.data.get(e).refCount--}}move(e,t,n,r,a){this.data.set(e,{values:t,dtype:r,refCount:a})}numDataIds(){return this.data.numDataIds()}async read(e){return this.readSync(e)}readSync(e){const{dtype:t,complexTensorInfos:n}=this.data.get(e);if("complex64"===t){return bF(this.readSync(n.real.dataId),this.readSync(n.imag.dataId))}return function(e,t){if(Array.isArray(e))return e;if("float32"===t)return e instanceof Float32Array?e:new Float32Array(e);if("int32"===t)return e instanceof Int32Array?e:new Int32Array(e);if("bool"===t||"string"===t)return Uint8Array.from(new Int32Array(e));throw new Error("Unknown dtype ".concat(t))}(this.data.get(e).values,t)}bufferSync(e){const t=this.readSync(e.dataId);if("string"===e.dtype)try{const n=t.map(e=>zC(e));return II(e.shape,e.dtype,n)}catch(hu){throw new Error("Failed to decode encoded string bytes into utf-8")}return II(e.shape,e.dtype,t)}makeOutput(e,t,n){return jE().makeTensorFromTensorInfo(this.makeTensorInfo(t,n,e),this)}disposeData(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.data.has(e)){if(this.data.get(e).refCount--,!t&&this.data.get(e).refCount>0)return!1;const{complexTensorInfos:n}=this.data.get(e);null!=n&&(this.disposeData(n.real.dataId,!0),this.disposeData(n.imag.dataId,!0)),this.data.delete(e)}return!0}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}async time(e){const t=jC();e();return{kernelMs:jC()-t}}memory(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}where(e){gW([e],"where");const t=this.readSync(e.dataId);return vW(e.shape,t)}dispose(){}floatPrecision(){return 32}epsilon(){return super.epsilon()}}bW.nextDataId=0;function yW(e){return(t,n,r)=>{const a=Tw(n,t.length);for(let i=0;i<t.length;++i)a[i]=e(t[i],r);return a}}function xW(e,t,n){return wW(e,yW(t),n)}function wW(e,t,n){return r=>{let{inputs:a,attrs:i,backend:o}=r;const{x:s}=a;gW(s,e);const c=o,l=c.data.get(s.dataId).values;let u;if("string"===s.dtype){if(!Array.isArray(l))throw new Error("String tensor's value was not an instance of Array");u=QF(l)}else u=l;const h=n||s.dtype,d=t(u,h,i);return c.makeTensorInfo(s.shape,h,d)}}VE("cpu",()=>new bW,1);const kW=xW(Qk,e=>e>=0?e:Math.exp(e)-1),SW={kernelName:Qk,backendName:"cpu",kernelFunc:kW};function NW(e){const{inputs:t,backend:n}=e,{x:r}=t;return n.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}const CW={kernelName:mS,backendName:"cpu",kernelFunc:NW};function EW(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{alpha:i}=r;gW([a],"leakyRelu");const o=bw(a.shape),s=n.data.get(a.dataId).values,c=Iw("float32",o);for(let l=0;l<s.length;l++)c[l]=s[l]<0?i*s[l]:s[l];return n.makeTensorInfo(a.shape,"float32",c)}const IW={kernelName:wS,backendName:"cpu",kernelFunc:EW};function TW(e){return(t,n,r,a,i)=>{const o=tT(t,n),s=o.length,c=Pw(o),l=Iw(i,bw(o)),u=t.length,h=n.length,d=Pw(t),f=Pw(n),p=ZI(t,o),m=ZI(n,o);if(p.length+m.length===0)for(let g=0;g<l.length;++g)l[g]=e(r[g%r.length],a[g%a.length]);else for(let g=0;g<l.length;++g){const t=Hw(g,s,c),n=t.slice(-u);p.forEach(e=>n[e]=0);const i=Vw(n,u,d),o=t.slice(-h);m.forEach(e=>o[e]=0);const v=Vw(o,h,f);l[g]=e(r[i],a[v])}return[l,o]}}const _W=TW((e,t)=>e<0?t*e:e);function AW(e){const{inputs:t,backend:n}=e,{x:r,alpha:a}=t;gW([r,a],"prelu");const i=n.data.get(r.dataId).values,o=n.data.get(a.dataId).values,[s,c]=_W(r.shape,a.shape,i,o,"float32");return n.makeTensorInfo(c,"float32",s)}const RW={kernelName:nN,backendName:"cpu",kernelFunc:AW},FW=xW(uN,e=>Math.max(0,e)),DW={kernelName:uN,backendName:"cpu",kernelFunc:FW},OW=xW(gN,e=>Math.min(Math.max(0,e),6)),LW={kernelName:gN,backendName:"cpu",kernelFunc:OW},PW=yW(e=>1/(1+Math.exp(-e))),MW=xW(_N,e=>1/(1+Math.exp(-e))),jW={kernelName:_N,backendName:"cpu",kernelFunc:MW};function BW(e,t,n,r,a){if("linear"===n)return NW({inputs:{x:t},backend:e});if("relu"===n)return FW({inputs:{x:t},backend:e});if("elu"===n)return kW({inputs:{x:t},backend:e});if("relu6"===n)return OW({inputs:{x:t},backend:e});if("prelu"===n)return AW({inputs:{x:t,alpha:r},backend:e});if("leakyrelu"===n)return EW({inputs:{x:t},backend:e,attrs:{alpha:a}});if("sigmoid"===n)return MW({inputs:{x:t},backend:e});throw new Error("Activation ".concat(n," has not been implemented for the CPU backend."))}function zW(e){const{inputs:t,backend:n}=e,{real:r,imag:a}=t,i=n.data.get(r.dataId).values,o=n.data.get(a.dataId).values,s=n.makeTensorInfo(r.shape,"complex64");return n.data.get(s.dataId).complexTensorInfos={real:n.makeTensorInfo(r.shape,"float32",i),imag:n.makeTensorInfo(a.shape,"float32",o)},s}const UW={kernelName:Ek,backendName:"cpu",kernelFunc:zW};function WW(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"float32";if("complex64"===n){return zW({inputs:{real:WW(e,t,"float32"),imag:WW(e,t,"float32")},backend:e})}const r=zw(bw(t),n);return e.makeTensorInfo(t,n,r)}function VW(e){const{inputs:t,backend:n}=e,{input:r}=t,a=n.data.get(r.dataId).complexTensorInfos.real,i=n.data.get(a.dataId).values;return n.makeTensorInfo(a.shape,a.dtype,i)}const HW={kernelName:cN,backendName:"cpu",kernelFunc:VW};function GW(e,t,n,r){if("int32"===r){return[t,"int32",Int32Array.from(e)]}if("bool"===r){const r=MC([0],n),[a,i]=TW((e,t)=>e!==t?1:0)(t,[],e,r,"bool");return[i,"bool",a]}throw new Error("Error in Cast: failed to cast ".concat(n," to ").concat(r))}function qW(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{dtype:i}=r;if("complex64"===i){if("complex64"===a.dtype)return NW({inputs:{x:a},backend:n});const e=WW(n,a.shape,a.dtype),t=qW({inputs:{x:a},backend:n,attrs:{dtype:"float32"}}),r=zW({inputs:{real:t,imag:e},backend:n});return n.disposeIntermediateTensorInfo(e),n.disposeIntermediateTensorInfo(t),r}if("complex64"===a.dtype){const e=VW({inputs:{input:a},backend:n}),t=qW({inputs:{x:e},backend:n,attrs:{dtype:i}});return n.disposeIntermediateTensorInfo(e),t}if(!_w(a.dtype,i)){const e=NW({inputs:{x:a},backend:n});return{dataId:e.dataId,shape:e.shape,dtype:i}}const o=n.data.get(a.dataId).values,[s,c,l]=GW(o,a.shape,a.dtype,i);return n.makeTensorInfo(s,c,l)}const KW={kernelName:Sk,backendName:"cpu",kernelFunc:qW};function XW(e,t,n,r){return null==n?n=>{let{inputs:a,backend:i}=n;const{a:o,b:s}=a,c=i;gW([o,s],e);const l=c.data.get(o.dataId).values,u=c.data.get(s.dataId).values,h="string"===o.dtype?QF(l):l,d="string"===o.dtype?QF(u):u,f=r||o.dtype,[p,m]=t(o.shape,s.shape,h,d,f);return c.makeTensorInfo(m,f,p)}:e=>{let{inputs:a,backend:i}=e;const{a:o,b:s}=a,c=i;if("complex64"===o.dtype||"complex64"===s.dtype){const e=qW({inputs:{x:o},backend:c,attrs:{dtype:"complex64"}}),t=c.data.get(e.dataId),r=t.complexTensorInfos.real,a=t.complexTensorInfos.imag,i=c.data.get(r.dataId).values,l=c.data.get(a.dataId).values,u=qW({inputs:{x:s},backend:c,attrs:{dtype:"complex64"}}),h=c.data.get(u.dataId),d=h.complexTensorInfos.real,f=h.complexTensorInfos.imag,p=c.data.get(d.dataId).values,m=c.data.get(f.dataId).values,[g,v,b]=n(o.shape,s.shape,i,l,p,m),y=c.makeTensorInfo(b,"float32",g),x=c.makeTensorInfo(b,"float32",v),w=zW({inputs:{real:y,imag:x},backend:c});return c.disposeIntermediateTensorInfo(e),c.disposeIntermediateTensorInfo(u),c.disposeIntermediateTensorInfo(y),c.disposeIntermediateTensorInfo(x),w}{const e=c.data.get(o.dataId).values,n=c.data.get(s.dataId).values,a=r||o.dtype,[i,l]=t(o.shape,s.shape,e,n,a);return c.makeTensorInfo(l,a,i)}}}function YW(e){return(t,n,r,a,i,o)=>{const s=tT(t,n),c=bw(s),l=s.length,u=Pw(s),h=Iw("float32",c),d=Iw("float32",c),f=ZI(t,s),p=ZI(n,s),m=bF(r,a),g=bF(i,o),v=t.length,b=Pw(t),y=n.length,x=Pw(n);if(f.length+p.length===0)for(let w=0;w<h.length;w++){const t=w%m.length,n=w%g.length,r=e(m[2*t],m[2*t+1],g[2*n],g[2*n+1]);h[w]=r.real,d[w]=r.imag}else for(let w=0;w<h.length;w++){const t=Hw(w,l,u),n=t.slice(-v);f.forEach(e=>n[e]=0);const r=Vw(n,v,b),a=t.slice(-y);p.forEach(e=>a[e]=0);const i=Vw(a,y,x),o=e(m[2*r],m[2*r+1],g[2*i],g[2*i+1]);h[w]=o.real,d[w]=o.imag}return[h,d,s]}}const $W=TW((e,t)=>e+t),JW=YW((e,t,n,r)=>({real:e+n,imag:t+r})),QW=XW(rk,$W,JW),ZW={kernelName:rk,backendName:"cpu",kernelFunc:QW};function eV(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{shape:i}=r,o=bw(a.shape),s=Nw(i,o),c=bw(s);mw(o===c,()=>"The new shape (".concat(s,") has ").concat(c," elements and the old ")+"shape (".concat(a.shape,") has ").concat(o," elements. The new shape and old ")+"shape must have the same number of elements."),n.incRef(a.dataId);const l=n.data.get(a.dataId);if(null!=l.complexTensorInfos){const e=l.complexTensorInfos.real,t=l.complexTensorInfos.imag;e.shape=s,t.shape=s}return{dataId:a.dataId,shape:s,dtype:a.dtype}}const tV={kernelName:hN,backendName:"cpu",kernelFunc:eV};function nV(e){const{inputs:t,backend:n,attrs:r}=e,{a:a,b:i}=t,{transposeA:o,transposeB:s}=r;gW([a,i],"matMul");const c=a.shape.length,l=i.shape.length,u=o?a.shape[c-2]:a.shape[c-1],h=s?i.shape[l-1]:i.shape[l-2],d=o?a.shape[c-1]:a.shape[c-2],f=s?i.shape[l-2]:i.shape[l-1],p=a.shape.slice(0,-2),m=i.shape.slice(0,-2),g=bw(p),v=bw(m),b=tT(a.shape.slice(0,-2),i.shape.slice(0,-2)).concat([d,f]);mw(u===h,()=>"Error in matMul: inner shapes (".concat(u,") and (")+"".concat(h,") of Tensors with shapes ").concat(a.shape," and ")+"".concat(i.shape," and transposeA=").concat(o)+" and transposeB=".concat(s," must match."));const y=s?[v,f,h]:[v,h,f],x=eV({inputs:{x:a},backend:n,attrs:{shape:o?[g,u,d]:[g,d,u]}}),w=eV({inputs:{x:i},backend:n,attrs:{shape:y}}),k=o?x.shape[1]:x.shape[2],S=o?x.shape[2]:x.shape[1],N=s?w.shape[1]:w.shape[2],C=Math.max(g,v),E=n.data.get(x.dataId).values,I=n.data.get(w.dataId).values,T=Pw(x.shape),_=Pw(w.shape),[A,R,F]=o?[T[0],1,T[1]]:[T[0],T[1],1],[D,O,L]=s?[1,_[1],_[0]]:[_[1],1,_[0]],P=S*N,M=II([C,S,N],x.dtype),j=M.values,B=n.blockSize;for(let z=0;z<C;z++){const e=z%g,t=z%v;for(let n=0;n<S;n+=B){const r=Math.min(n+B,S);for(let a=0;a<N;a+=B){const i=Math.min(a+B,N);for(let o=0;o<k;o+=B){const s=Math.min(o+B,k);for(let c=n;c<r;c++)for(let n=a;n<i;n++){let r=0;for(let a=o;a<s;a++){r+=E[e*A+c*R+a*F]*I[a*D+n*O+t*L]}j[z*P+(c*N+n)]+=r}}}}}return n.disposeIntermediateTensorInfo(x),n.disposeIntermediateTensorInfo(w),n.makeTensorInfo(b,M.dtype,M.values)}const rV={kernelName:bk,backendName:"cpu",kernelFunc:nV};const aV={kernelName:cC,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{a:a,b:i,bias:o,preluActivationWeights:s}=t,{transposeA:c,transposeB:l,activation:u,leakyreluAlpha:h}=r;let d,f,p;const m=[];d=nV({inputs:{a:a,b:i},attrs:{transposeA:c,transposeB:l},backend:n}),o&&(f=QW({inputs:{a:d,b:o},backend:n}),m.push(d),d=f),u&&(p=BW(n,d,u,s,h),m.push(d),d=p);for(const g of m)n.disposeIntermediateTensorInfo(g);return d}};function iV(e){const t=new Float32Array(e.length);for(let n=0;n<e.length;++n)t[n]=Math.abs(e[n]);return t}const oV={kernelName:ek,backendName:"cpu",kernelFunc:e=>{const{x:t}=e.inputs,n=e.backend;gW(t,"abs");let r=new Float32Array(bw(t.shape));return r=iV(n.data.get(t.dataId).values),n.makeOutput(r,t.shape,t.dtype)}},sV=xW(tk,e=>Math.acos(e)),cV={kernelName:tk,backendName:"cpu",kernelFunc:sV},lV=xW(nk,e=>Math.acosh(e)),uV={kernelName:nk,backendName:"cpu",kernelFunc:lV};const hV={kernelName:ak,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,r=t;gW(t,"addN");const a=r.map(e=>n.data.get(e.dataId).values),i=II(r[0].shape,r[0].dtype),o=i.values;for(let s=0;s<r.length;s++){const e=a[s];for(let t=0;t<o.length;t++)o[t]+=e[t]}return n.makeTensorInfo(i.shape,i.dtype,i.values)}};function dV(e,t,n,r,a){const i=t.length,o=bw(t),s=Pw(t),c=Pw(a),l=Iw(n,bw(a));for(let u=0;u<o;++u){const t=Hw(u,i,s),n=new Array(t.length);for(let e=0;e<n.length;e++)n[e]=t[r[e]];l[Vw(n,i,c)]=e[u]}return l}function fV(e){const{inputs:t,attrs:n,backend:r}=e,{x:a}=t,{perm:i}=n;gW(a,"transpose");const o=a.shape.length,s=new Array(o);for(let l=0;l<s.length;l++)s[l]=a.shape[i[l]];const c=dV(r.data.get(a.dataId).values,a.shape,a.dtype,i,s);return{dataId:r.write(c,s,a.dtype),shape:s,dtype:a.dtype}}const pV={kernelName:eC,backendName:"cpu",kernelFunc:fV};const mV={kernelName:ik,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:i,keepDims:o}=r;gW(a,"all");const s=Cw(i,a.shape);let c=s;const l=H_(c,a.shape.length);let u=a;null!=l&&(u=fV({inputs:{x:a},backend:n,attrs:{perm:l}}),c=q_(c.length,a.shape.length)),V_("all",c,u.shape.length);const[h,d]=U_(u.shape,c),f=bw(d),p=zw(bw(h),u.dtype),m=n.data.get(u.dataId).values;for(let v=0;v<p.length;++v){const e=v*f;let t=m[e];for(let n=0;n<f;++n){const r=m[e+n];t=t&&r}p[v]=t}null!=l&&n.disposeIntermediateTensorInfo(u);const g=n.makeTensorInfo(h,u.dtype,p);if(o){const e=eV({inputs:{x:g},backend:n,attrs:{shape:W_(h,s)}});return n.disposeIntermediateTensorInfo(g),e}return g}};const gV={kernelName:ok,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:i,keepDims:o}=r;gW(a,"any");const s=Cw(i,a.shape);let c=s;const l=H_(c,a.shape.length);let u=a;null!=l&&(u=fV({inputs:{x:a},backend:n,attrs:{perm:l}}),c=q_(c.length,a.shape.length)),V_("any",c,u.shape.length);const[h,d]=U_(u.shape,c),f=bw(d),p=zw(bw(h),u.dtype),m=n.data.get(u.dataId).values;for(let v=0;v<p.length;++v){const e=v*f;let t=m[e];for(let n=0;n<f;++n){const r=m[e+n];t=t||r}p[v]=t}null!=l&&n.disposeIntermediateTensorInfo(u);const g=n.makeTensorInfo(h,u.dtype,p);if(o){const e=eV({inputs:{x:g},backend:n,attrs:{shape:W_(h,s)}});return n.disposeIntermediateTensorInfo(g),e}return g}};const vV={kernelName:sk,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:i}=r;gW(a,"argMax");let o=Cw(i,a.shape);const s=H_(o,a.shape.length);let c=a;const l=[];null!=s&&(c=fV({inputs:{x:a},backend:n,attrs:{perm:s}}),l.push(c),o=q_(o.length,c.shape.length)),o=[o[0]],V_("argMax",o,c.shape.length);const[u,h]=U_(c.shape,o),d=zw(bw(u),"int32"),f=bw(h),p=n.data.get(c.dataId).values;for(let m=0;m<d.length;++m){const e=m*f;let t=p[e],n=0;for(let r=0;r<f;++r){const a=p[e+r];a>t&&(t=a,n=r)}d[m]=n}return l.forEach(e=>n.disposeIntermediateTensorInfo(e)),n.makeTensorInfo(u,"int32",d)}};const bV={kernelName:ck,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:i}=r;gW(a,"argMin");let o=Cw(i,a.shape);const s=H_(o,a.shape.length);let c=a;const l=[];null!=s&&(c=fV({inputs:{x:a},backend:n,attrs:{perm:s}}),l.push(c),o=q_(o.length,c.shape.length)),o=[o[0]],V_("argMin",o,c.shape.length);const[u,h]=U_(c.shape,o),d=zw(bw(u),"int32"),f=bw(h),p=n.data.get(c.dataId).values;for(let m=0;m<d.length;++m){const e=m*f;let t=p[e],n=0;for(let r=0;r<f;++r){const a=p[e+r];a<t&&(t=a,n=r)}d[m]=n}return l.forEach(e=>n.disposeIntermediateTensorInfo(e)),n.makeTensorInfo(u,"int32",d)}},yV=xW(lk,e=>Math.asin(e)),xV={kernelName:lk,backendName:"cpu",kernelFunc:yV},wV=xW(uk,e=>Math.asinh(e)),kV={kernelName:uk,backendName:"cpu",kernelFunc:wV},SV=xW(hk,e=>Math.atan(e)),NV={kernelName:hk,backendName:"cpu",kernelFunc:SV},CV=TW((e,t)=>Math.atan2(e,t)),EV=XW(fk,CV),IV={kernelName:fk,backendName:"cpu",kernelFunc:EV},TV=xW(dk,e=>Math.atanh(e)),_V={kernelName:dk,backendName:"cpu",kernelFunc:TV};function AV(e,t,n,r,a,i){const o=a.strideHeight,s=a.strideWidth,c=a.dilationHeight,l=a.dilationWidth,u=a.effectiveFilterHeight,h=a.effectiveFilterWidth,d=a.padInfo.top,f=a.padInfo.left,p="max"===i?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,m=II(a.outShape,n),g=m.values,v=a.outShape[1]*a.outShape[2]*a.outShape[3],b=a.outShape[2]*a.outShape[3],y=a.outShape[3];for(let x=0;x<a.batchSize;++x){const t=x*v,n=x*r[0];for(let m=0;m<a.inChannels;++m)for(let v=0;v<a.outHeight;++v){const x=v*o-d,w=Math.max(0,x),k=Math.min(a.inHeight,u+x),S=t+v*b;for(let t=0;t<a.outWidth;++t){const o=t*s-f,u=Math.max(0,o),d=Math.min(a.inWidth,h+o);let v=p,b=0,x=0;for(let t=w;t<k;t+=c){const a=n+t*r[1];for(let t=u;t<d;t+=l){const n=e[a+t*r[2]+m];"max"===i&&n>v?v=n:"avg"===i&&(b+=n,x++)}if(isNaN(v))break}g[S+t*y+m]="avg"===i?b/x:v}}}return m}function RV(e,t,n,r){let a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const o=II(r.outShape,"int32"),s=r.strideHeight,c=r.strideWidth,l=r.dilationHeight,u=r.dilationWidth,h=r.effectiveFilterHeight,d=r.effectiveFilterWidth,f=r.padInfo.top,p=r.padInfo.left,m=II(t,n,e);for(let g=0;g<r.batchSize;++g)for(let e=0;e<r.inChannels;++e)for(let t=0;t<r.outHeight;++t){const n=t*s-f;let v=n;for(;v<0;)v+=l;const b=Math.min(r.inHeight,h+n);for(let s=0;s<r.outWidth;++s){const h=s*c-p;let f=h;for(;f<0;)f+=u;const y=Math.min(r.inWidth,d+h);let x=Number.NEGATIVE_INFINITY,w=-1;for(let t=v;t<b;t+=l){const o=t-n;for(let n=f;n<y;n+=u){const s=n-h,c=m.get(g,t,n,e);c>x&&(x=c,w=a?i?((g*r.inHeight+t)*r.inWidth+n)*r.inChannels+e:(t*r.inWidth+n)*r.inChannels+e:o*d+s)}}o.set(w,g,t,s,e)}}return o}function FV(e,t,n,r,a,i){const o=a.strideDepth,s=a.strideHeight,c=a.strideWidth,l=a.dilationDepth,u=a.dilationHeight,h=a.dilationWidth,d=a.effectiveFilterDepth,f=a.effectiveFilterHeight,p=a.effectiveFilterWidth,m=a.padInfo.front,g=a.padInfo.top,v=a.padInfo.left,b="max"===i?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,y=II(a.outShape,n),x=y.values,w=a.outShape[1]*a.outShape[2]*a.outShape[3]*a.outShape[4],k=a.outShape[2]*a.outShape[3]*a.outShape[4],S=a.outShape[3]*a.outShape[4],N=a.outShape[4];for(let C=0;C<a.batchSize;++C){const t=C*w,n=C*r[0];for(let y=0;y<a.inChannels;++y)for(let w=0;w<a.outDepth;++w){const C=w*o-m;let E=C;for(;E<0;)E+=l;const I=Math.min(a.inDepth,d+C),T=t+w*k;for(let t=0;t<a.outHeight;++t){const o=t*s-g;let d=o;for(;d<0;)d+=u;const m=Math.min(a.inHeight,f+o),w=T+t*S;for(let t=0;t<a.outWidth;++t){const o=t*c-v;let s=o;for(;s<0;)s+=h;const f=Math.min(a.inWidth,p+o),g=w+t*N;let k=b,S=0,C=0;for(let t=E;t<I;t+=l){const a=n+t*r[1];for(let t=d;t<m;t+=u){const n=a+t*r[2];for(let t=s;t<f;t+=h){const a=e[n+t*r[3]+y];if("max"===i&&a>k?k=a:"avg"===i&&(S+=a,C++),isNaN(k))break}if(isNaN(k))break}if(isNaN(k))break}x[g+y]="avg"===i?S/Math.max(C,1):k}}}}return y}const DV={kernelName:pk,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t;gW(a,"avgPool");const{filterSize:i,strides:o,pad:s,dimRoundingMode:c}=r;mw(YT(o,1),()=>"Error in avgPool: Either strides or dilations must be 1. "+"Got strides ".concat(o," and dilations '").concat(1,"'"));const l=BT(a.shape,i,o,1,s,c);let u;if(1===l.filterWidth&&1===l.filterHeight&&yw(l.inShape,l.outShape))u=NW({inputs:{x:a},backend:n});else{const e=n.data.get(a.dataId).values,t=Pw(a.shape),r=AV(e,a.shape,a.dtype,t,l,"avg");u=n.makeTensorInfo(l.outShape,a.dtype,r.values)}return u}};const OV={kernelName:gk,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{filterSize:i,strides:o,pad:s,dimRoundingMode:c,dataFormat:l}=r;gW(a,"avgPool3d");const u=zT(a.shape,i,o,1,s,c,l),h=FV(n.data.get(a.dataId).values,a.shape,a.dtype,Pw(a.shape),u,"avg");return n.makeTensorInfo(h.shape,"float32",h.values)}};const LV={kernelName:vk,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{dy:a,input:i}=t,{filterSize:o,strides:s,pad:c,dimRoundingMode:l}=r;gW([a,i],"avgPool3DGrad");const u=zT(i.shape,o,s,1,c,l),h=u.strideDepth,d=u.strideHeight,f=u.strideWidth,p=u.filterDepth,m=u.filterHeight,g=u.filterWidth,v=u.dilationDepth,b=u.dilationHeight,y=u.dilationWidth,x=u.effectiveFilterDepth,w=u.effectiveFilterHeight,k=u.effectiveFilterWidth,S=x-1-u.padInfo.front,N=k-1-u.padInfo.left,C=w-1-u.padInfo.top,E=II(i.shape,"float32"),I=1/(p*m*g),T=n.bufferSync(a);for(let _=0;_<u.batchSize;++_)for(let e=0;e<u.inChannels;++e)for(let t=0;t<u.inDepth;++t)for(let n=0;n<u.inHeight;++n)for(let r=0;r<u.inWidth;++r){const a=t-S,i=n-C,o=r-N;let s=0;for(let t=0;t<x;t+=v){const n=(a+t)/h;if(!(n<0||n>=u.outDepth||Math.floor(n)!==n))for(let t=0;t<w;t+=b){const r=(i+t)/d;if(!(r<0||r>=u.outHeight||Math.floor(r)!==r))for(let t=0;t<k;t+=y){const a=(o+t)/f;if(a<0||a>=u.outWidth||Math.floor(a)!==a)continue;s+=T.get(_,n,r,a,e)}}}E.set(s*I,_,t,n,r,e)}return n.makeTensorInfo(E.shape,E.dtype,E.values)}};const PV={kernelName:mk,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{dy:a,input:i}=t,o=i;gW([a,i],"avgPoolGrad");const{filterSize:s,strides:c,pad:l}=r,u=BT(o.shape,s,c,1,l),h=u.strideHeight,d=u.strideWidth,f=u.filterHeight,p=u.filterWidth,m=u.dilationHeight,g=u.dilationWidth,v=u.effectiveFilterHeight,b=u.effectiveFilterWidth,y=b-1-u.padInfo.left,x=v-1-u.padInfo.top,w=II(o.shape,"float32"),k=1/(f*p),S=n.data.get(a.dataId).values,N=II(a.shape,"float32",S);for(let C=0;C<u.batchSize;++C)for(let e=0;e<u.inChannels;++e)for(let t=0;t<u.inHeight;++t)for(let n=0;n<u.inWidth;++n){const r=t-x,a=n-y;let i=0;for(let t=0;t<v;t+=m){const n=(r+t)/h;if(!(n<0||n>=u.outHeight||Math.floor(n)!==n))for(let t=0;t<b;t+=g){const r=(a+t)/d;if(r<0||r>=u.outWidth||Math.floor(r)!==r)continue;i+=N.get(C,n,r,e)}}w.set(i*k,C,t,n,e)}return n.makeTensorInfo(w.shape,w.dtype,w.values)}};const MV={kernelName:uS,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,scale:i,offset:o,mean:s,variance:c}=t;mw(s.shape.length===c.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),mw(null==o||s.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),mw(null==i||s.shape.length===i.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks."),gW([a,s,c,i,o],"batchNorm");let{varianceEpsilon:l}=r;null==l&&(l=.001);const u=n.data.get(a.dataId).values,h=n.data.get(s.dataId).values,d=n.data.get(c.dataId).values,f=i?n.data.get(i.dataId).values:new Float32Array([1]),p=o?n.data.get(o.dataId).values:new Float32Array([0]),m=new Float32Array(u.length),g=p.length,v=f.length,b=d.length,y=h.length;let x=0,w=0,k=0,S=0;for(let N=0;N<u.length;++N)m[N]=p[x++]+(u[N]-h[w++])*f[k++]/Math.sqrt(d[S++]+l),x>=g&&(x=0),w>=y&&(w=0),k>=v&&(k=0),S>=b&&(S=0);return n.makeTensorInfo(a.shape,a.dtype,m)}};function jV(e,t,n,r,a){const i=AT(r,t,n),o=bw(n),s=Pw(r);if(i){const n=RT(t,s);return"string"===a?e.slice(n,n+o):e.subarray(n,n+o)}const c=II(r,a,"string"===a?QF(e):e),l=II(n,a);for(let u=0;u<l.size;++u){const e=l.indexToLoc(u),n=e.map((e,n)=>e+t[n]);l.set(c.get(...n),...e)}return"string"===a?ZF(l.values):l.values}function BV(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{begin:i,size:o}=r;gW(a,"slice");const[s,c]=FT(a,i,o);bT(a,s,c);const l=jV(n.data.get(a.dataId).values,s,c,a.shape,a.dtype);return n.makeTensorInfo(c,a.dtype,l)}const zV={kernelName:CN,backendName:"cpu",kernelFunc:BV};const UV={kernelName:yk,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{blockShape:i,crops:o}=r;gW([a],"batchToSpaceND");const s=i.reduce((e,t)=>e*t),c=tF(a.shape,i,s),l=nF(c.length,i.length),u=rF(a.shape,i,s),h=aF(o,i.length),d=iF(u,o,i.length),f=eV({inputs:{x:a},backend:n,attrs:{shape:c}}),p=fV({inputs:{x:f},backend:n,attrs:{perm:l}}),m=eV({inputs:{x:p},backend:n,attrs:{shape:u}}),g=BV({inputs:{x:m},backend:n,attrs:{begin:h,size:d}});return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(m),g}};function WV(e,t,n,r,a){const i=bw(r),o=zw(a,n);for(let s=0;s<e.length;s++){const n=e[s];if(n<0)throw new Error("Input x must be non-negative!");n>=a||(o[n]+=i>0?t[s]:1)}return o}function VV(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const a=e.shape[0],i=e.shape[1],o=II([a,n],t.dtype);for(let s=0;s<a;s++)for(let a=0;a<i;a++){const i=e.get(s,a);if(i<0)throw new Error("Input x must be non-negative!");i>=n||(r?o.set(1,s,i):t.size>0?o.set(o.get(s,i)+t.get(s,a),s,i):o.set(o.get(s,i)+1,s,i))}return o}const HV={kernelName:xk,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,weights:i}=t,{size:o}=r,s=WV(n.data.get(a.dataId).values,n.data.get(i.dataId).values,i.dtype,i.shape,o);return n.makeTensorInfo([o],i.dtype,s)}},GV=TW((e,t)=>e&t),qV={kernelName:wk,backendName:"cpu",kernelFunc:XW(wk,GV)};const KV={kernelName:kk,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{s0:r,s1:a}=t,i=n.data.get(r.dataId).values,o=n.data.get(a.dataId).values,s=tT(Array.from(i),Array.from(o));return n.makeTensorInfo([s.length],"int32",Int32Array.from(s))}},XV=yW(e=>Math.ceil(e)),YV=wW(Nk,XV),$V={kernelName:Nk,backendName:"cpu",kernelFunc:YV},JV=xW(Ck,(e,t)=>{const n=t;return e>n.clipValueMax?n.clipValueMax:e<n.clipValueMin?n.clipValueMin:e}),QV={kernelName:Ck,backendName:"cpu",kernelFunc:JV},ZV={kernelName:Ik,backendName:"cpu",kernelFunc:e=>{const{x:t}=e.inputs,n=e.backend,r=new Float32Array(bw(t.shape)),a=n.data.get(t.dataId),i=a.complexTensorInfos.real,o=a.complexTensorInfos.imag,s=n.data.get(i.dataId).values,c=n.data.get(o.dataId).values;for(let l=0;l<s.length;l++){const e=s[l],t=c[l];r[l]=Math.hypot(e,t)}return n.makeOutput(r,t.shape,"float32")}};function eH(e,t,n,r){const a=Tw(n,bw(t));if(r&&"string"!==n){let t=0;e.forEach(e=>{const n=bw(e.shape);a.set(e.vals,t),t+=n})}else{let r=0;e.forEach(e=>{const i="string"===n?QF(e.vals):e.vals;let o=0;for(let n=0;n<e.shape[0];++n){const s=n*t[1]+r;for(let t=0;t<e.shape[1];++t)a[s+t]=i[o++]}r+=e.shape[1]})}return a}function tH(e){const{inputs:t,backend:n}=e,{input:r}=t,a=n.data.get(r.dataId).complexTensorInfos.imag,i=n.data.get(a.dataId).values;return n.makeTensorInfo(a.shape,a.dtype,i)}const nH={kernelName:vS,backendName:"cpu",kernelFunc:tH};function rH(e){const{inputs:t,backend:n,attrs:r}=e,{axis:a}=r,i=Cw(a,t[0].shape)[0],o=t.map(e=>e.shape);GR(o,i);let s=qR(t.map(e=>e.shape),i);if(0===bw(s))return n.makeTensorInfo(s,t[0].dtype,[]);const c=t.filter(e=>bw(e.shape)>0);if(1===c.length)return NW({inputs:{x:c[0]},backend:n});if("complex64"===c[0].dtype){const e=c.map(e=>VW({inputs:{input:e},backend:n})),t=c.map(e=>tH({inputs:{input:e},backend:n})),r=rH({inputs:e,backend:n,attrs:{axis:i}}),a=rH({inputs:t,backend:n,attrs:{axis:i}}),o=zW({inputs:{real:r,imag:a},backend:n});return e.forEach(e=>n.disposeIntermediateTensorInfo(e)),t.forEach(e=>n.disposeIntermediateTensorInfo(e)),n.disposeIntermediateTensorInfo(r),n.disposeIntermediateTensorInfo(a),o}const l=c.map(e=>{const t=bw(e.shape.slice(i));return eV({inputs:{x:e},backend:n,attrs:{shape:[-1,t]}})}),u=l.map(e=>({vals:n.data.get(e.dataId).values,shape:e.shape}));s=qR(l.map(e=>e.shape),1);const h=1===l[0].shape[0],d=eH(u,s,t[0].dtype,h),f=qR(c.map(e=>e.shape),i),p=n.makeTensorInfo(f,t[0].dtype,d);return l.forEach(e=>n.disposeIntermediateTensorInfo(e)),p}const aH={kernelName:Tk,backendName:"cpu",kernelFunc:rH};function iH(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,filter:i}=t,{strides:o,pad:s,dataFormat:c,dilations:l,dimRoundingMode:u}=r;gW([a,i],"conv2d");const h=JT(c),d=UT(a.shape,i.shape,o,l,s,u,!1,h),f=d.filterHeight,p=d.filterWidth,m=d.dilationHeight,g=d.dilationWidth,v=d.padInfo.left,b=d.padInfo.top,y="channelsLast"===d.dataFormat,x=new JC(d.outShape,a.dtype),w=Pw(a.shape),k=Pw(i.shape),S=w[0],N=y?w[1]:w[2],C=y?w[2]:1,E=y?1:w[1],I=x.strides[0],T=y?x.strides[1]:x.strides[2],_=y?x.strides[2]:1,A=y?1:x.strides[1],R=n.data.get(a.dataId).values,F=n.data.get(i.dataId).values,D=x.values;for(let O=0;O<d.batchSize;++O){const e=O*S,t=O*I;for(let n=0;n<d.outHeight;++n){const r=t+n*T,a=n*d.strideHeight-b;for(let t=0;t<f;++t){const n=a+t*m;if(n<0||n>=d.inHeight)continue;const i=t*k[0],o=e+n*N;for(let e=0;e<d.outWidth;++e){const t=r+e*_,n=e*d.strideWidth-v;for(let e=0;e<p;++e){const r=n+e*g;if(r<0||r>=d.inWidth)continue;const a=o+r*C;let s=i+e*k[1];for(let e=0;e<d.inChannels;++e){const n=R[a+e*E];for(let e=0;e<d.outChannels;++e)D[t+e*A]+=n*F[s+e];s+=d.outChannels}}}}}}return n.makeTensorInfo(x.shape,x.dtype,D)}const oH={kernelName:_k,backendName:"cpu",kernelFunc:iH};const sH={kernelName:Ak,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,dy:i}=t,{strides:o,pad:s,dataFormat:c,dimRoundingMode:l,filterShape:u}=r;gW([a,i],"conv2dBackpropFilter");const h=JT(c),d=UT(a.shape,u,o,1,s,l,!1,h),{strideHeight:f,strideWidth:p,filterHeight:m,filterWidth:g}=d,v="channelsLast"===d.dataFormat,b=new JC(d.filterShape,"float32"),y=d.padInfo.left,x=d.padInfo.top,w=n.data.get(a.dataId).values,k=n.data.get(i.dataId).values,S=new JC(a.shape,a.dtype,w),N=new JC(i.shape,i.dtype,k);for(let C=0;C<m;++C){const e=Math.max(0,Math.ceil((x-C)/f)),t=Math.min(d.outHeight,(d.inHeight+x-C)/f);for(let n=0;n<g;++n){const r=Math.max(0,Math.ceil((y-n)/p)),a=Math.min(d.outWidth,(d.inWidth+y-n)/p);for(let i=0;i<d.inChannels;++i)for(let o=0;o<d.outChannels;++o){let s=0;for(let c=0;c<d.batchSize;++c)for(let l=e;l<t;++l){const e=C+l*f-x;for(let t=r;t<a;++t){const r=n+t*p-y;s+=v?S.get(c,e,r,i)*N.get(c,l,t,o):S.get(c,i,e,r)*N.get(c,o,l,t)}}b.set(s,C,n,i,o)}}}return n.makeTensorInfo(b.shape,b.dtype,b.values)}};const cH={kernelName:Rk,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{dy:a,filter:i}=t,{inputShape:o,strides:s,pad:c,dataFormat:l,dimRoundingMode:u}=r;gW([a,i],"conv2dBackpropInput");const h=Pw(i.shape),d=Pw(a.shape);let f=JT(l);const p=UT(o,i.shape,s,1,c,u,!1,f),m=new JC(p.inShape,"float32"),g=m.values,v=n.data.get(a.dataId).values,b=n.data.get(i.dataId).values,[y,x,w]=h,{batchSize:k,filterHeight:S,filterWidth:N,inChannels:C,inHeight:E,inWidth:I,outChannels:T,outHeight:_,outWidth:A,strideHeight:R,strideWidth:F}=p;f=p.dataFormat;const D=S-1-p.padInfo.top,O=N-1-p.padInfo.left,L="channelsLast"===f,P=m.strides[0],M=L?m.strides[1]:m.strides[2],j=L?m.strides[2]:1,B=L?1:m.strides[1],z=d[0],U=L?d[1]:d[2],W=L?d[2]:1,V=L?1:d[1];for(let H=0;H<k;++H)for(let e=0;e<C;++e)for(let t=0;t<E;++t){const n=t-D,r=Math.max(0,Math.ceil(n/R)),a=Math.min(_,(S+n)/R);for(let i=0;i<I;++i){const o=i-O,s=Math.max(0,Math.ceil(o/F)),c=Math.min(A,(N+o)/F);let l=0;for(let t=r;t<a;++t){const r=t*R-n;for(let n=s;n<c;++n){const a=z*H+U*t+W*n,i=y*(S-1-r)+x*(N-1-(n*F-o))+w*e;for(let e=0;e<T;++e){l+=v[a+V*e]*b[i+e]}}}g[P*H+M*t+j*i+B*e]=l}}return n.makeTensorInfo(m.shape,m.dtype,m.values)}};const lH={kernelName:Fk,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,filter:i}=t,{strides:o,pad:s,dilations:c}=r;gW([a,i],"conv3d");const l=WT(a.shape,i.shape,o,c,s),{filterDepth:u,filterHeight:h,filterWidth:d,dilationDepth:f,dilationHeight:p,dilationWidth:m,padInfo:g}=l,v=g.front,b=g.left,y=g.top,x=new JC(l.outShape,a.dtype),w=n.data.get(a.dataId).values,k=n.data.get(i.dataId).values,S=x.values,N=Pw(a.shape),C=Pw(i.shape);for(let E=0;E<l.batchSize;++E){const e=E*N[0],t=E*x.strides[0];for(let n=0;n<l.outDepth;++n){const r=t+n*x.strides[1],a=n*l.strideDepth-v;for(let t=0;t<u;++t){const n=a+t*f;if(n<0||n>=l.inDepth)continue;const i=t*C[0],o=e+n*N[1];for(let e=0;e<l.outHeight;++e){const t=r+e*x.strides[2],n=e*l.strideHeight-y;for(let e=0;e<h;++e){const r=n+e*p;if(r<0||r>=l.inHeight)continue;const a=i+e*C[1],s=o+r*N[2];for(let e=0;e<l.outWidth;++e){const n=t+e*l.outChannels,r=e*l.strideWidth-b;for(let e=0;e<d;++e){const t=r+e*m;if(t<0||t>=l.inWidth)continue;const i=a+e*C[2],o=s+t*l.inChannels;let c=i;for(let e=0;e<l.inChannels;++e){const t=w[o+e];for(let e=0;e<l.outChannels;++e)S[n+e]+=t*k[c+e];c+=l.outChannels}}}}}}}}return n.makeTensorInfo(x.shape,x.dtype,x.values)}};const uH={kernelName:Dk,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,dy:i}=t,{strides:o,pad:s,filterShape:c}=r;gW([a,i],"conv3dBackpropFilterV2");const l=Pw(a.shape),u=Pw(i.shape),h=WT(a.shape,c,o,1,s),d=h.strideDepth,f=h.strideHeight,p=h.strideWidth,m=h.filterDepth,g=h.filterHeight,v=h.filterWidth,b=new JC(h.filterShape,"float32"),y=b.values,[x,w,k,S]=b.strides,N=n.data.get(i.dataId).values,[C,E,I,T]=u,_=n.data.get(a.dataId).values,[A,R,F,D]=l,O=h.padInfo.front,L=h.padInfo.left,P=h.padInfo.top;for(let M=0;M<m;++M){const e=Math.max(0,Math.ceil((O-M)/d)),t=Math.min(h.outDepth,(h.inDepth+O-M)/d),n=M*x;for(let r=0;r<g;++r){const a=Math.max(0,Math.ceil((P-r)/f)),i=Math.min(h.outHeight,(h.inHeight+P-r)/f),o=r*w+n;for(let n=0;n<v;++n){const s=Math.max(0,Math.ceil((L-n)/p)),c=Math.min(h.outWidth,(h.inWidth+L-n)/p),l=n*k+o;for(let o=0;o<h.inChannels;++o){const u=o*S+l;for(let l=0;l<h.outChannels;++l){let m=0;for(let u=0;u<h.batchSize;++u){const h=u*A,g=u*C;for(let u=e;u<t;++u){const e=(M+u*d-O)*R+h,t=u*E+g;for(let u=a;u<i;++u){const a=(r+u*f-P)*F+e,i=u*I+t;for(let e=s;e<c;++e){const t=e*T+i;m+=_[(n+e*p-L)*D+a+o]*N[t+l]}}}}y[u+l]=m}}}}}return n.makeTensorInfo(b.shape,b.dtype,b.values)}};const hH={kernelName:Ok,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{dy:a,filter:i}=t,{pad:o,strides:s,inputShape:c}=r;gW([a],"conv3dBackpropInputV2");const l=Pw(a.shape),u=Pw(i.shape),h=WT(c,i.shape,s,1,o),d=new JC(h.inShape,"float32"),f=d.values,[p,m,g,v]=d.strides,b=n.data.get(a.dataId).values,[y,x,w,k]=l,S=n.data.get(i.dataId).values,[N,C,E,I]=u,{batchSize:T,filterDepth:_,filterHeight:A,filterWidth:R,inChannels:F,inDepth:D,inHeight:O,inWidth:L,outChannels:P,outDepth:M,outHeight:j,outWidth:B,strideDepth:z,strideHeight:U,strideWidth:W}=h,V=_-1-h.padInfo.front,H=A-1-h.padInfo.top,G=R-1-h.padInfo.left;for(let q=0;q<T;++q)for(let e=0;e<F;++e)for(let t=0;t<D;++t){const n=t-V,r=Math.max(0,Math.ceil(n/z)),a=Math.min(M,(_+n)/z);for(let i=0;i<O;++i){const o=i-H,s=Math.max(0,Math.ceil(o/U)),c=Math.min(j,(A+o)/U);for(let l=0;l<L;++l){const u=l-G,h=Math.max(0,Math.ceil(u/W)),d=Math.min(B,(R+u)/W);let T=0;for(let t=r;t<a;++t){const r=t*z-n;for(let n=s;n<c;++n){const a=n*U-o;for(let i=h;i<d;++i){const o=y*q+x*t+w*n+k*i,s=N*(_-1-r)+C*(A-1-a)+E*(R-1-(i*W-u))+I*e;for(let e=0;e<P;++e){T+=b[o+e]*S[s+e]}}}}f[p*q+m*t+g*i+v*l+e]=T}}}return n.makeTensorInfo(d.shape,d.dtype,d.values)}},dH=xW(Lk,e=>Math.cos(e)),fH={kernelName:Lk,backendName:"cpu",kernelFunc:dH},pH=xW(Pk,e=>Math.cosh(e)),mH={kernelName:Pk,backendName:"cpu",kernelFunc:pH};const gH={kernelName:Bk,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{image:a,boxes:i,boxInd:o}=t,{cropSize:s,method:c,extrapolationValue:l}=r,[u,h,d,f]=a.shape,p=i.shape[0],[m,g]=s,v=II([p,m,g,f],"float32"),b=n.data.get(i.dataId).values,y=n.data.get(o.dataId).values,x=n.data.get(a.dataId).values,w=Pw(a.shape),k=Pw(v.shape);for(let S=0;S<p;S++){const e=4*S,t=b[e],n=b[e+1],r=b[e+2],a=b[e+3],i=y[S];if(i>=u)continue;const o=m>1?(r-t)*(h-1)/(m-1):0,s=g>1?(a-n)*(d-1)/(g-1):0;for(let u=0;u<m;u++){const e=m>1?t*(h-1)+u*o:.5*(t+r)*(h-1);if(e<0||e>h-1)for(let t=0;t<g;t++)for(let e=0;e<f;e++){const n=e+t*k[2]+u*k[1]+S*k[0];v.values[n]=l}else if("bilinear"===c){const t=Math.floor(e),r=Math.ceil(e),o=e-t;for(let e=0;e<g;e++){const c=g>1?n*(d-1)+e*s:.5*(n+a)*(d-1);if(c<0||c>d-1){for(let t=0;t<f;t++){const n=t+e*k[2]+u*k[1]+S*k[0];v.values[n]=l}continue}const h=Math.floor(c),p=Math.ceil(c),m=c-h;for(let n=0;n<f;n++){let a=n+h*w[2]+t*w[1]+i*w[0];const s=x[a];a=n+p*w[2]+t*w[1]+i*w[0];const c=x[a];a=n+h*w[2]+r*w[1]+i*w[0];const l=x[a];a=n+p*w[2]+r*w[1]+i*w[0];const d=s+(c-s)*m,f=l+(x[a]-l)*m;a=n+e*k[2]+u*k[1]+S*k[0],v.values[a]=d+(f-d)*o}}}else for(let t=0;t<g;++t){const r=g>1?n*(d-1)+t*s:.5*(n+a)*(d-1);if(r<0||r>d-1){for(let e=0;e<f;e++){const n=e+t*k[2]+u*k[1]+S*k[0];v.values[n]=l}continue}const o=Math.round(r),c=Math.round(e);for(let e=0;e<f;e++){const n=e+o*w[2]+c*w[1]+i*w[0],r=e+t*k[2]+u*k[1]+S*k[0];v.values[r]=x[n]}}}}return n.makeTensorInfo(v.shape,v.dtype,v.values)}};const vH={kernelName:Mk,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:i,exclusive:o,reverse:s}=r;gW(a,"cumprod");const c=H_([i],a.shape.length);let l=a;null!=c&&(l=fV({inputs:{x:a},backend:n,attrs:{perm:c}}));const u=q_(1,a.shape.length)[0];if(u!==l.shape.length-1)throw new Error("backend.cumprod in CPU expects an inner-most "+"axis=".concat(l.shape.length-1," but got axis=").concat(u));const h=uE(l.dtype,"int32"),d=Bw(bw(l.shape),h),f=n.data.get(l.dataId).values,p=l.shape[l.shape.length-1],m=s?(e,t)=>e+p-t-1:(e,t)=>e+t;for(let v=0;v<f.length;v+=p)for(let e=0;e<p;e++){const t=m(v,e);if(0===e)d[t]=o?1:f[t];else{const n=m(v,e-1);d[t]=o?f[n]*d[n]:f[t]*d[n]}}const g=n.makeTensorInfo(l.shape,h,d);if(null!=c){const e=fV({inputs:{x:g},backend:n,attrs:{perm:G_(c)}});return n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(l),e}return g}};const bH={kernelName:jk,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:i,exclusive:o,reverse:s}=r;gW(a,"cumsum");const c=H_([i],a.shape.length);let l=a;null!=c&&(l=fV({inputs:{x:a},backend:n,attrs:{perm:c}}));const u=q_(1,a.shape.length)[0];if(u!==l.shape.length-1)throw new Error("backend.cumsum in CPU expects an inner-most "+"axis=".concat(l.shape.length-1," but got axis=").concat(u));const h=uE(l.dtype,"int32"),d=zw(bw(l.shape),h),f=n.data.get(l.dataId).values,p=l.shape[l.shape.length-1],m=s?(e,t)=>e+p-t-1:(e,t)=>e+t;for(let v=0;v<f.length;v+=p)for(let e=0;e<p;e++){const t=m(v,e);if(0===e)d[t]=o?0:f[t];else{const n=m(v,e-1);d[t]=o?f[n]+d[n]:f[t]+d[n]}}const g=n.makeTensorInfo(l.shape,h,d);if(null!=c){const e=fV({inputs:{x:g},backend:n,attrs:{perm:G_(c)}});return n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(l),e}return g}};const yH={kernelName:zk,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,weights:i}=t,{size:o,binaryOutput:s}=r;if(1===a.shape.length){const e=WV(n.data.get(a.dataId).values,n.data.get(i.dataId).values,i.dtype,i.shape,o);return n.makeTensorInfo([o],i.dtype,e)}if(2===a.shape.length){const e=VV(n.bufferSync(a),n.bufferSync(i),o,s);return n.makeTensorInfo(e.shape,i.dtype,e.values)}throw new Error("Error in denseBincount: input must be at most rank 2, but got rank"+"".concat(a.shape.length,"."))}};const xH={kernelName:Uk,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{blockSize:i,dataFormat:o}=r;mw("NHWC"===o,()=>"Only NHWC dataFormat supported on CPU for depthToSpace. Got ".concat(o));const s=a.shape[0],c=a.shape[1],l=a.shape[2],u=a.shape[3],h=c*i,d=l*i,f=u/(i*i),p=n.data.get(a.dataId).values,m=new Float32Array(s*h*d*f);let g=0;for(let v=0;v<s;++v)for(let e=0;e<h;++e){const t=Math.floor(e/i),n=e%i;for(let e=0;e<d;++e){const r=Math.floor(e/i),a=(n*i+e%i)*f;for(let e=0;e<f;++e){const n=e+a+u*(r+l*(t+c*v));m[g++]=p[n]}}}return n.makeTensorInfo([s,h,d,f],a.dtype,m)}};function wH(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,filter:i}=t,{strides:o,pad:s,dilations:c,dimRoundingMode:l}=r;gW([a,i],"depthwiseConv2DNative");const u=Pw(a.shape),h=Pw(i.shape);let d=c;null==d&&(d=[1,1]),mw(YT(o,d),()=>"Error in depthwiseConv2d: Either strides or dilations must be "+"1. Got strides ".concat(o," and dilations '").concat(d,"'"));const f=UT(a.shape,i.shape,o,d,s,l,!0),{filterHeight:p,filterWidth:m,dilationHeight:g,dilationWidth:v,padInfo:b}=f,y=b.left,x=b.top,w=f.outChannels/f.inChannels,k=new JC(f.outShape,a.dtype),S=n.data.get(a.dataId).values,N=n.data.get(i.dataId).values,C=k.values;for(let E=0;E<f.batchSize;++E){const e=E*u[0],t=E*k.strides[0];for(let n=0;n<f.outHeight;++n){const r=t+n*k.strides[1],a=n*f.strideHeight-x;for(let t=0;t<p;++t){const n=a+t*g;if(n<0||n>=f.inHeight)continue;const i=t*h[0],o=e+n*u[1];for(let e=0;e<f.outWidth;++e){const t=r+e*k.strides[2],n=e*f.strideWidth-y;for(let e=0;e<m;++e){const r=n+e*v;if(r<0||r>=f.inWidth)continue;const a=i+e*h[1],s=o+r*f.inChannels;let c=t,l=a;for(let e=0;e<f.inChannels;++e){const t=S[s+e];for(let e=0;e<w;++e)C[c+e]+=t*N[l+e];c+=w,l+=w}}}}}}return n.makeTensorInfo(k.shape,k.dtype,k.values)}const kH={kernelName:Wk,backendName:"cpu",kernelFunc:wH};const SH={kernelName:Vk,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,dy:i}=t,{strides:o,dilations:s,pad:c,dimRoundingMode:l,filterShape:u}=r;gW([a,i],"depthwiseConv2dNativeBackpropFilter");const h=UT(a.shape,u,o,s,c,l,!0),{strideHeight:d,strideWidth:f,filterHeight:p,filterWidth:m}=h,g=new JC(h.filterShape,"float32"),v=h.padInfo.left,b=h.padInfo.top,y=h.outChannels/h.inChannels,x=n.data.get(a.dataId).values,w=new JC(a.shape,a.dtype,x),k=n.data.get(i.dataId).values,S=new JC(i.shape,i.dtype,k);for(let N=0;N<p;++N){const e=Math.max(0,Math.ceil((b-N)/d)),t=Math.min(h.outHeight,(h.inHeight+b-N)/d);for(let n=0;n<m;++n){const r=Math.max(0,Math.ceil((v-n)/f)),a=Math.min(h.outWidth,(h.inWidth+v-n)/f);for(let i=0;i<h.outChannels;++i){const o=Math.trunc(i/y),s=i%y;let c=0;for(let l=0;l<h.batchSize;++l)for(let s=e;s<t;++s){const e=N+s*d-b;for(let t=r;t<a;++t){const r=n+t*f-v;c+=w.get(l,e,r,o)*S.get(l,s,t,i)}}g.set(c,N,n,o,s)}}}return n.makeTensorInfo(g.shape,g.dtype,g.values)}};const NH={kernelName:Hk,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{dy:a,filter:i}=t,{strides:o,dilations:s,pad:c,dimRoundingMode:l,inputShape:u}=r;gW([a,i],"depthwiseConv2DNativeBackpropInput");const h=Pw(a.shape),d=Pw(i.shape),f=UT(u,i.shape,o,s,c,l,!0),p=new JC(f.inShape,"float32"),m=p.values,[g,v,b]=p.strides,y=n.data.get(a.dataId).values,[x,w,k]=h,S=n.data.get(i.dataId).values,[N,C,E]=d,{batchSize:I,filterHeight:T,filterWidth:_,inChannels:A,inHeight:R,inWidth:F,outChannels:D,outHeight:O,outWidth:L,strideHeight:P,strideWidth:M}=f,j=T-1-f.padInfo.top,B=_-1-f.padInfo.left,z=D/A;for(let U=0;U<I;++U)for(let e=0;e<A;++e)for(let t=0;t<R;++t){const n=t-j,r=Math.max(0,Math.ceil(n/P)),a=Math.min(O,(T+n)/P);for(let i=0;i<F;++i){const o=i-B,s=Math.max(0,Math.ceil(o/M)),c=Math.min(L,(_+o)/M);let l=0;for(let t=r;t<a;++t){const r=t*P-n;for(let n=s;n<c;++n){const a=x*U+w*t+k*n,i=N*(T-1-r)+C*(_-1-(n*M-o))+E*e;for(let t=0;t<z;++t){l+=y[a+(e*z+t)]*S[i+t]}}}m[g*U+v*t+b*i+e]=l}}return n.makeTensorInfo(p.shape,p.dtype,p.values)}};const CH={kernelName:Gk,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{x:r}=t,a=bw(r.shape),i=n.data.get(r.dataId).values,o=II([a,a],r.dtype),s=o.values;for(let l=0;l<i.length;l++)s[l*a+l]=i[l];const c=[...r.shape,...r.shape];return n.makeTensorInfo(c,o.dtype,o.values)}},EH={kernelName:qk,backendName:"cpu",kernelFunc:e=>{let{inputs:t,backend:n,attrs:r}=e;const{x:a,filter:i}=t,{strides:o,pad:s,dilations:c}=r,l=n,u=l.data.get(a.dataId).values,h=a.shape.length,d=l.data.get(i.dataId).values,f=i.shape.length,{batchSize:p,inHeight:m,inWidth:g,inChannels:v,outHeight:b,outWidth:y,padInfo:x,strideHeight:w,strideWidth:k,filterHeight:S,filterWidth:N,dilationHeight:C,dilationWidth:E,outShape:I}=jT(a.shape,i.shape,o,s,"NHWC",c),T=bw(I),_=I.length,A=Tw(a.dtype,T);for(let R=0;R<p;++R)for(let e=0;e<b;++e){const t=e*w-x.top;for(let n=0;n<y;++n){const r=n*k-x.left;for(let o=0;o<v;++o){let s=Number.MIN_SAFE_INTEGER;for(let e=0;e<S;++e){const n=t+e*C;if(n>=0&&n<m)for(let t=0;t<N;++t){const c=r+t*E;if(c>=0&&c<g){const r=Vw([R,n,c,o],h,Pw(a.shape)),l=Vw([e,t,o],f,Pw(i.shape)),p=u[r]+d[l];p>s&&(s=p)}}}A[Vw([R,e,n,o],_,Pw(I))]=s}}}return{dataId:l.write(MC(A,a.dtype),I,a.dtype),shape:I,dtype:a.dtype}}},IH={kernelName:Xk,backendName:"cpu",kernelFunc:e=>{let{inputs:t,backend:n,attrs:r}=e;const{x:a,filter:i,dy:o}=t,{strides:s,pad:c,dilations:l}=r,u=n,h=jw(a.shape,u.data.get(a.dataId).values),d=jw(i.shape,u.data.get(i.dataId).values),{batchSize:f,inHeight:p,inWidth:m,inChannels:g,outHeight:v,outWidth:b,padInfo:y,strideHeight:x,strideWidth:w,filterHeight:k,filterWidth:S,dilationHeight:N,dilationWidth:C,outShape:E}=jT(a.shape,i.shape,s,c,"NHWC",l);mw(o.rank===E.length,()=>"Error in ".concat(Xk,", dy ")+"must have the same rank as output ".concat(E.length,", but got ")+"".concat(o.rank));const I=jw(E,u.data.get(o.dataId).values),T=Uw(i.shape,i.dtype);for(let _=0;_<f;++_)for(let e=0;e<v;++e){const t=e*x-y.top;for(let n=0;n<b;++n){const r=n*w-y.left;for(let a=0;a<g;++a){let i=Number.MIN_SAFE_INTEGER,o=0,s=0;for(let e=0;e<k;++e){const n=t+e*N;if(n>=0&&n<p)for(let t=0;t<S;++t){const c=r+t*C;if(c>=0&&c<m){const r=h[_][n][c][a]+d[e][t][a];r>i&&(i=r,o=e,s=t)}}}T[o][s][a]+=I[_][e][n][a]}}}return{dataId:u.write(MC(T,a.dtype),i.shape,i.dtype),shape:i.shape,dtype:i.dtype}}},TH={kernelName:Kk,backendName:"cpu",kernelFunc:e=>{let{inputs:t,backend:n,attrs:r}=e;const{x:a,filter:i,dy:o}=t,{strides:s,pad:c,dilations:l}=r,u=n,h=jw(a.shape,u.data.get(a.dataId).values),d=jw(i.shape,u.data.get(i.dataId).values),{batchSize:f,inHeight:p,inWidth:m,inChannels:g,outHeight:v,outWidth:b,padInfo:y,strideHeight:x,strideWidth:w,filterHeight:k,filterWidth:S,dilationHeight:N,dilationWidth:C,outShape:E}=jT(a.shape,i.shape,s,c,"NHWC",l);mw(o.rank===E.length,()=>"Error in ".concat(Kk,", dy ")+"must have the same rank as output ".concat(E.length,", but got ")+"".concat(o.rank));const I=jw(E,u.data.get(o.dataId).values),T=Uw(a.shape,a.dtype);for(let _=0;_<f;++_)for(let e=0;e<v;++e){const t=e*x-y.top;for(let n=0;n<b;++n){const r=n*w-y.left;for(let a=0;a<g;++a){let i=Number.MIN_SAFE_INTEGER,o=t<0?0:t,s=r<0?0:r;for(let e=0;e<k;++e){const n=t+e*N;if(n>=0&&n<p)for(let t=0;t<S;++t){const c=r+t*C;if(c>=0&&c<m){const r=h[_][n][c][a]+d[e][t][a];r>i&&(i=r,o=n,s=c)}}}T[_][o][s][a]+=I[_][e][n][a]}}}return{dataId:u.write(MC(T,a.dtype),a.shape,a.dtype),shape:a.shape,dtype:a.dtype}}};const _H={kernelName:Yk,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{image:a}=t,{canvas:i,options:o}=r,{contextOptions:s,imageOptions:c}=o||{},l=(null===c||void 0===c?void 0:c.alpha)||1,u=(null===s||void 0===s?void 0:s.contextType)||"2d";if("2d"!==u)throw new Error("Context type ".concat(s.contextType," is not supported by the CPU backend."));const h=i.getContext(u,(null===s||void 0===s?void 0:s.contextAttributes)||{});if(null==h)throw new Error("Could not get the context with ".concat(u," type."));const[d,f]=a.shape.slice(0,2),p=2===a.shape.length?1:a.shape[2],m=n.data.get(a.dataId).values,g="float32"===a.dtype?255:1,v=new Uint8ClampedArray(f*d*4);for(let y=0;y<d*f;++y){const e=[0,0,0,255*l];for(let n=0;n<p;n++){const t=m[y*p+n];if("float32"===a.dtype){if(t<0||t>1)throw new Error("Tensor values for a float32 Tensor must be in the "+"range [0 - 1] but encountered ".concat(t,"."))}else if("int32"===a.dtype&&(t<0||t>255))throw new Error("Tensor values for a int32 Tensor must be in the "+"range [0 - 255] but encountered ".concat(t,"."));1===p?(e[0]=t*g,e[1]=t*g,e[2]=t*g):e[n]=t*g}const t=4*y;v[t+0]=Math.round(e[0]),v[t+1]=Math.round(e[1]),v[t+2]=Math.round(e[2]),v[t+3]=Math.round(e[3])}i.width=f,i.height=d;const b=new ImageData(v,f,d);return h.putImageData(b,0,0),a}},AH=TW((e,t)=>e*t),RH=YW((e,t,n,r)=>({real:e*n-t*r,imag:e*r+t*n})),FH=XW(GS,AH,RH),DH={kernelName:GS,backendName:"cpu",kernelFunc:FH};function OH(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:i,keepDims:o}=r;let s;gW(a,"sum"),s="bool"===a.dtype?qW({inputs:{x:a},backend:n,attrs:{dtype:"int32"}}):NW({inputs:{x:a},backend:n});const c=s.shape.length,l=Cw(i,s.shape),u=H_(l,c);let h=l,d=s;null!=u&&(d=fV({inputs:{x:s},backend:n,attrs:{perm:u}}),h=q_(h.length,c)),V_("sum",h,d.shape.length);const[f,p]=U_(d.shape,h);let m=WW(n,f,uE(d.dtype,"int32"));const g=bw(p),v=n.data.get(m.dataId).values,b=n.data.get(d.dataId).values;for(let y=0;y<v.length;++y){const e=y*g;let t=0;for(let n=0;n<g;++n)t+=b[e+n];v[y]=t}if(o){const e=m;m=eV({inputs:{x:m},backend:n,attrs:{shape:W_(m.shape,l)}}),n.disposeIntermediateTensorInfo(e)}return n.disposeIntermediateTensorInfo(s),null!=u&&n.disposeIntermediateTensorInfo(d),m}const LH={kernelName:FN,backendName:"cpu",kernelFunc:OH};const PH={kernelName:Jk,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{equation:a}=r,i=t,{allDims:o,summedDims:s,idDims:c}=AF(a,i.length);FF(o.length,c,i);const{path:l,steps:u}=DF(s,c),h=u.length;let d=null,f=o.length;const p=[];for(let m=0;m<h;++m){for(const e of u[m]){const{permutationIndices:t,expandDims:r}=RF(f,c[e]);let a;OF(t)?a=i[e]:(a=fV({inputs:{x:i[e]},backend:n,attrs:{perm:t}}),p.push(a));const o=a.shape.slice();for(let e=0;e<r.length;++e)o.splice(r[e],0,1);yw(a.shape,o)||(a=eV({inputs:{x:a},backend:n,attrs:{shape:o}}),p.push(a)),null===d?d=a:(d=FH({inputs:{a:a,b:d},backend:n}),p.push(d))}m<h-1&&(l[m]>=0&&(d=OH({inputs:{x:d},backend:n,attrs:{axis:l[m]-(o.length-f),keepDims:!1}}),p.push(d)),f--)}for(const m of p)m!==d&&n.disposeIntermediateTensorInfo(m);return d}};const MH={kernelName:Zk,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{dy:r,y:a}=t;gW([r,a],"eluGrad");const i=new Float32Array(bw(a.shape)),o=n.data.get(a.dataId).values,s=n.data.get(r.dataId).values;for(let c=0;c<o.length;++c){const e=o[c];i[c]=e>=0?s[c]:s[c]*(e+1)}return n.makeTensorInfo(a.shape,"float32",i)}},jH=TW((e,t)=>e===t?1:0),BH=XW(tS,jH,null,"bool"),zH={kernelName:tS,backendName:"cpu",kernelFunc:BH},UH=dF,WH=fF,VH=pF,HH=mF,GH=gF,qH=vF,KH=xW(eS,e=>{const t=Math.sign(e),n=Math.abs(e),r=1/(1+UH*n);return t*(1-((((qH*r+GH)*r+HH)*r+VH)*r+WH)*r*Math.exp(-n*n))}),XH={kernelName:eS,backendName:"cpu",kernelFunc:KH},YH=yW(e=>Math.exp(e)),$H=wW(nS,YH,"float32"),JH={kernelName:nS,backendName:"cpu",kernelFunc:$H};function QH(e){const{inputs:t,backend:n,attrs:r}=e,{input:a}=t,{dim:i}=r,o=a.shape.length,s=a.shape.slice();let c=i;return i<0&&(mw(-(o+1)<=i,()=>"Axis must be in the interval [".concat(-(o+1),", ").concat(o,"]")),c=o+i+1),s.splice(c,0,1),eV({inputs:{x:a},backend:n,attrs:{shape:s}})}const ZH={kernelName:rS,backendName:"cpu",kernelFunc:QH},eG=yW(e=>Math.expm1(e)),tG=wW(aS,eG),nG={kernelName:aS,backendName:"cpu",kernelFunc:tG},rG=TW((e,t)=>e/t),aG=XW($k,rG),iG={kernelName:$k,backendName:"cpu",kernelFunc:aG},oG=TW((e,t)=>e-t),sG=YW((e,t,n,r)=>({real:e-n,imag:t-r})),cG=XW(XN,oG,sG),lG={kernelName:XN,backendName:"cpu",kernelFunc:cG};function uG(e,t,n){const r=e.shape,a=r[0],i=r[1],o=n.data.get(e.dataId),s=o.complexTensorInfos.real,c=o.complexTensorInfos.imag,l=[a,i],u=bw(l),h=Iw("float32",u),d=Iw("float32",u);for(let g=0;g<a;g++){const e=BV({inputs:{x:s},backend:n,attrs:{begin:[g,0],size:[1,i]}}),r=BV({inputs:{x:c},backend:n,attrs:{begin:[g,0],size:[1,i]}}),a=zW({inputs:{real:e,imag:r},backend:n}),{real:o,imag:l}=hG(a,t,n),u=bF(o,l);for(let t=0;t<i;t++){const e=kF(u,t);h[g*i+t]=e.real,d[g*i+t]=e.imag}n.disposeIntermediateTensorInfo(e),n.disposeIntermediateTensorInfo(r),n.disposeIntermediateTensorInfo(a)}const f=n.makeTensorInfo(l,"float32",h),p=n.makeTensorInfo(l,"float32",d),m=zW({inputs:{real:f,imag:p},backend:n});return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(p),m}function hG(e,t,n){const r=bw(e.shape),a=n.data.get(e.dataId),i=n.data.get(a.complexTensorInfos.real.dataId).values,o=n.data.get(a.complexTensorInfos.imag.dataId).values;if(0===((s=r)&s-1)){const a=dG(i,o,r,t,n),s=[e.shape[0],e.shape[1]];if(t){const e=n.makeTensorInfo(s,"float32",a.real),t=n.makeTensorInfo(s,"float32",a.imag),i=n.makeTensorInfo([],"float32",PC(r,"float32")),o=NW({inputs:{x:i},backend:n}),c=iG.kernelFunc({inputs:{a:e,b:i},backend:n}),l=iG.kernelFunc({inputs:{a:t,b:o},backend:n}),u=n.data.get(c.dataId).values,h=n.data.get(l.dataId).values;return n.disposeIntermediateTensorInfo(e),n.disposeIntermediateTensorInfo(t),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(l),{real:u,imag:h}}return a}{const e=function(e,t,n){const r=new Float32Array(2*t);for(let a=0;a<t;a++){let i=0,o=0;for(let r=0;r<t;r++){const s=CF(a*r,t,n),c=kF(e,r);i+=c.real*s.real-c.imag*s.imag,o+=c.real*s.imag+c.imag*s.real}n&&(i/=t,o/=t),SF(r,i,o,a)}return r}(bF(i,o),r,t);return yF(e)}var s}function dG(e,t,n,r,a){if(1===n)return{real:e,imag:t};const i=bF(e,t),o=n/2,s=xF(i),c=s.real,l=s.imag,u=[c.length],h=a.makeTensorInfo(u,"float32",c),d=a.makeTensorInfo(u,"float32",l),f=zW({inputs:{real:h,imag:d},backend:a}),p=wF(i),m=p.real,g=p.imag,v=[m.length],b=a.makeTensorInfo(v,"float32",m),y=a.makeTensorInfo(v,"float32",g),x=zW({inputs:{real:b,imag:y},backend:a}),w=dG(c,l,o,r,a),k=w.real,S=w.imag,N=[k.length],C=a.makeTensorInfo(N,"float32",k),E=a.makeTensorInfo(N,"float32",S),I=zW({inputs:{real:C,imag:E},backend:a}),T=dG(m,g,o,r,a),_=T.real,A=T.imag,R=[_.length],F=a.makeTensorInfo(R,"float32",_),D=a.makeTensorInfo(R,"float32",A),O=zW({inputs:{real:F,imag:D},backend:a}),L=NF(n,r),P=[L.real.length],M=a.makeTensorInfo(P,"float32",L.real),j=a.makeTensorInfo(P,"float32",L.imag),B=zW({inputs:{real:M,imag:j},backend:a}),z=FH({inputs:{a:B,b:O},backend:a}),U=QW({inputs:{a:I,b:z},backend:a}),W=cG({inputs:{a:I,b:z},backend:a}),V=VW({inputs:{input:U},backend:a}),H=VW({inputs:{input:W},backend:a}),G=tH({inputs:{input:U},backend:a}),q=tH({inputs:{input:W},backend:a}),K=rH({inputs:[V,H],backend:a,attrs:{axis:0}}),X=rH({inputs:[G,q],backend:a,attrs:{axis:0}}),Y=a.data.get(K.dataId).values,$=a.data.get(X.dataId).values;return a.disposeIntermediateTensorInfo(h),a.disposeIntermediateTensorInfo(d),a.disposeIntermediateTensorInfo(f),a.disposeIntermediateTensorInfo(b),a.disposeIntermediateTensorInfo(y),a.disposeIntermediateTensorInfo(x),a.disposeIntermediateTensorInfo(C),a.disposeIntermediateTensorInfo(E),a.disposeIntermediateTensorInfo(I),a.disposeIntermediateTensorInfo(F),a.disposeIntermediateTensorInfo(D),a.disposeIntermediateTensorInfo(O),a.disposeIntermediateTensorInfo(M),a.disposeIntermediateTensorInfo(j),a.disposeIntermediateTensorInfo(B),a.disposeIntermediateTensorInfo(z),a.disposeIntermediateTensorInfo(U),a.disposeIntermediateTensorInfo(W),a.disposeIntermediateTensorInfo(V),a.disposeIntermediateTensorInfo(G),a.disposeIntermediateTensorInfo(H),a.disposeIntermediateTensorInfo(q),a.disposeIntermediateTensorInfo(K),a.disposeIntermediateTensorInfo(X),{real:Y,imag:$}}const fG={kernelName:iS,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{input:r}=t,a=bw(r.shape),i=r.shape[r.shape.length-1],o=eV({inputs:{x:r},backend:n,attrs:{shape:[a/i,i]}}),s=uG(o,!1,n),c=eV({inputs:{x:s},backend:n,attrs:{shape:r.shape}});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(s),c}};function pG(e){const{backend:t,attrs:n}=e,{shape:r,value:a,dtype:i}=n,o=i||Dw(a),s=Tw(o,bw(r));return function(e,t){e.fill(t)}(s,a),t.makeTensorInfo(r,o,s)}const mG={kernelName:oS,backendName:"cpu",kernelFunc:pG};const gG={kernelName:sS,backendName:"cpu",kernelFunc:e=>{let{inputs:t,attrs:n,backend:r}=e;const{image:a}=t,i=r,o=Iw(a.dtype,bw(a.shape)),[s,c,l,u]=a.shape,h=i.data.get(a.dataId).values;for(let d=0;d<s;d++){const e=d*l*c*u;for(let t=0;t<c;t++){const n=t*(l*u);for(let t=0;t<l;t++){const r=t*u;for(let a=0;a<u;a++){const i=Math.round(l-t-1),s=e+n+r+a;let c=h[s];if(i>=0&&i<l){c=h[e+n+i*u+a]}o[s]=c}}}}return{dataId:i.write(o,a.shape,a.dtype),shape:a.shape,dtype:a.dtype}}},vG=yW(e=>Math.floor(e)),bG=wW(cS,vG),yG={kernelName:cS,backendName:"cpu",kernelFunc:bG},xG=TW((e,t)=>Math.floor(e/t)),wG=XW(lS,xG,null,"int32"),kG={kernelName:lS,backendName:"cpu",kernelFunc:wG};const SG={kernelName:lC,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,filter:i,bias:o,preluActivationWeights:s}=t,{strides:c,pad:l,dataFormat:u,dilations:h,dimRoundingMode:d,activation:f,leakyreluAlpha:p}=r;let m=iH({inputs:{x:a,filter:i},backend:n,attrs:{strides:c,pad:l,dataFormat:u,dilations:h,dimRoundingMode:d}});if(o){const e=m;if("NCHW"===u&&1===o.shape.length&&1!==o.shape[0]){const e=eV({inputs:{x:o},backend:n,attrs:{shape:[o.shape[0],1,1]}});m=QW({inputs:{a:m,b:e},backend:n}),n.disposeIntermediateTensorInfo(e)}else m=QW({inputs:{a:m,b:o},backend:n});n.disposeIntermediateTensorInfo(e)}if(f){const e=m;if("NCHW"===u&&"prelu"===f&&1===s.shape.length&&1!==s.shape[0]){const e=eV({inputs:{x:s},backend:n,attrs:{shape:[s.shape[0],1,1]}});m=BW(n,m,f,e,p),n.disposeIntermediateTensorInfo(e)}else m=BW(n,m,f,s,p);n.disposeIntermediateTensorInfo(e)}return m}};const NG={kernelName:uC,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,filter:i,bias:o,preluActivationWeights:s}=t,{strides:c,pad:l,dataFormat:u,dilations:h,dimRoundingMode:d,activation:f,leakyreluAlpha:p}=r;let m=wH({inputs:{x:a,filter:i},backend:n,attrs:{strides:c,pad:l,dataFormat:u,dilations:h,dimRoundingMode:d}});if(o){const e=m;m=QW({inputs:{a:m,b:o},backend:n}),n.disposeIntermediateTensorInfo(e)}if(f){const e=m;m=BW(n,m,f,s,p),n.disposeIntermediateTensorInfo(e)}return m}};function CG(e,t,n,r,a,i,o,s,c){const l=II([r,i],n);for(let u=0;u<r;u++){const n=[];let r=0;for(let t=0;t<a;t++){const i=e[u*a+t];r+=i*o[t],n.push(i)}if(r<0||r>=c/i)throw new Error("Invalid indices: ".concat(n," does not index into ").concat(s));for(let e=0;e<i;e++)l.values[u*i+e]=t.get(...t.indexToLoc(r*i+e))}return l}const EG={kernelName:dS,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{params:r,indices:a}=t,i=bw(r.shape),o=a.shape,s=o[o.length-1],[c,l,u,h]=oF(r,a);if(0===l)return n.makeTensorInfo(c,r.dtype,[]);const d=CG(n.data.get(a.dataId).values,n.bufferSync(r),r.dtype,l,s,u,h,r.shape,i);return n.makeTensorInfo(c,r.dtype,d.values)}};function IG(e,t,n){const r=II(n,e.dtype);for(let a=0;a<r.size;++a){const n=r.indexToLoc(a).slice(),i=n[0],o=n[2],s=t.locToIndex([i,o]);n[2]=t.values[s];const c=e.locToIndex(n);0<=c&&c<e.values.length&&(r.values[a]=e.values[c])}return r}const TG={kernelName:hS,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,indices:i}=t,{axis:o,batchDims:s}=r;gW([a,i],"gatherV2");const c=Cw(o,a.shape)[0],l=n.data.get(i.dataId).values,u=a.shape[c];for(let y=0;y<l.length;++y){const e=l[y];mw(e<=u-1&&e>=0,()=>"GatherV2: the index value ".concat(e," is not in [0, ").concat(u-1,"]"))}let h=s;null==s&&(h=0);const d=bw(i.shape),f=JF(a,i,c,h),p=eV({inputs:{x:a},backend:n,attrs:{shape:[f.batchSize,f.outerSize,f.dimSize,f.sliceSize]}}),m=eV({inputs:{x:i},backend:n,attrs:{shape:[f.batchSize,d/f.batchSize]}}),g=[f.batchSize,f.outerSize,d/f.batchSize,f.sliceSize],v=n.bufferSync(m),b=IG(n.bufferSync(p),v,g);return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(m),n.makeTensorInfo(f.outputShape,b.dtype,b.values)}},_G=TW((e,t)=>e>t?1:0),AG=XW(fS,_G,null,"bool"),RG={kernelName:fS,backendName:"cpu",kernelFunc:AG},FG=TW((e,t)=>e>=t?1:0),DG=XW(pS,FG,null,"bool"),OG={kernelName:pS,backendName:"cpu",kernelFunc:DG};const LG={kernelName:gS,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{input:r}=t,a=bw(r.shape),i=r.shape[r.shape.length-1],o=eV({inputs:{x:r},backend:n,attrs:{shape:[a/i,i]}}),s=uG(o,!0,n),c=eV({inputs:{x:s},backend:n,attrs:{shape:r.shape}});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(s),c}},PG=xW(bS,e=>Number.isFinite(e)?1:0,"bool"),MG={kernelName:bS,backendName:"cpu",kernelFunc:PG},jG=xW(yS,e=>Math.abs(e)===1/0?1:0,"bool"),BG={kernelName:yS,backendName:"cpu",kernelFunc:jG},zG=xW(xS,e=>Number.isNaN(e)?1:0,"bool"),UG={kernelName:xS,backendName:"cpu",kernelFunc:zG},WG=TW((e,t)=>e<t?1:0),VG=XW(kS,WG,null,"bool"),HG={kernelName:kS,backendName:"cpu",kernelFunc:VG},GG=TW((e,t)=>e<=t?1:0),qG=XW(SS,GG,null,"bool"),KG={kernelName:SS,backendName:"cpu",kernelFunc:qG};function XG(e,t,n){const r=(t-e)/(n-1),a=zw(n,"float32");a[0]=e;for(let i=1;i<a.length;i++)a[i]=a[i-1]+r;return a}const YG={kernelName:NS,backendName:"cpu",kernelFunc:function(e){const{backend:t,attrs:n}=e,{start:r,stop:a,num:i}=n,o=XG(r,a,i);return t.makeTensorInfo([o.length],"float32",o)}},$G=yW(e=>Math.log(e)),JG=wW(CS,$G),QG={kernelName:CS,backendName:"cpu",kernelFunc:JG},ZG=xW(ES,e=>Math.log1p(e)),eq={kernelName:ES,backendName:"cpu",kernelFunc:ZG},tq=TW((e,t)=>e&&t),nq=XW(IS,tq,null,"bool"),rq={kernelName:IS,backendName:"cpu",kernelFunc:nq},aq=xW(TS,e=>e?0:1,"bool"),iq={kernelName:TS,backendName:"cpu",kernelFunc:aq},oq=TW((e,t)=>e||t),sq=XW(_S,oq,null,"bool"),cq={kernelName:_S,backendName:"cpu",kernelFunc:sq};const lq={kernelName:AS,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{depthRadius:i,bias:o,alpha:s,beta:c}=r;gW(a,"LRN");const l=a.shape[3],u=l-1,h=n.data.get(a.dataId).values,d=bw(a.shape),f=new Float32Array(d);function p(e){const t=e%l;let n=e-t+Math.max(0,t-i);const r=e-t+Math.min(t+i,u);let a=0;for(;n<=r;n++){const e=h[n];a+=e*e}return a}for(let m=0;m<d;m++){const e=p(m),t=h[m]*Math.pow(o+s*e,-c);f[m]=t}return n.makeTensorInfo(a.shape,a.dtype,f)}};const uq={kernelName:RS,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,y:i,dy:o}=t,{depthRadius:s,bias:c,alpha:l,beta:u}=r;gW(o,"LRNGrad");const h=bw(o.shape),d=o.shape[3],f=n.data.get(o.dataId).values,p=n.data.get(a.dataId).values,m=n.data.get(i.dataId).values,g=new Float32Array(h),v=h;for(let b=0;b<v;b++){const e=b%d,t=b-e+Math.max(0,e-s),n=b-e+Math.min(d,e+s+1);let r=0;for(let a=t;a<n;a++)r+=Math.pow(p[a],2);r=l*r+c;for(let a=t;a<n;a++){let e=-2*l*u*p[a]*m[b]/r;b===a&&(e+=Math.pow(r,-u)),e*=f[b],g[a]+=e}}return n.makeTensorInfo(o.shape,a.dtype,g)}};function hq(e,t,n,r){const a=Iw(r,bw(n));for(let i=0;i<a.length;++i){const n=i*t;let r=e[n];for(let a=0;a<t;++a){const t=e[n+a];(Number.isNaN(t)||t>r)&&(r=t)}a[i]=r}return a}function dq(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{reductionIndices:i,keepDims:o}=r,s=n;let c=a.shape;const l=c.length,u=Cw(i,c);let h=u;const d=H_(h,l);let f=s.data.get(a.dataId).values;if(null!=d){const e=new Array(l);for(let t=0;t<e.length;t++)e[t]=c[d[t]];f=dV(f,c,a.dtype,d,e),h=q_(h.length,l),c=e}gW(a,"max"),V_("max",h,l);const[p,m]=U_(c,h),g=hq(f,bw(m),p,a.dtype),v=s.write(g,p,a.dtype);let b=p;if(o){b=W_(p,u)}return{dataId:v,shape:b,dtype:a.dtype}}const fq={kernelName:FS,backendName:"cpu",kernelFunc:dq},pq=TW((e,t)=>Math.max(e,t)),mq=XW(DS,pq),gq={kernelName:DS,backendName:"cpu",kernelFunc:mq};const vq={kernelName:OS,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t;gW(a,"maxPool");const{filterSize:i,strides:o,pad:s,dimRoundingMode:c}=r;mw(YT(o,1),()=>"Error in maxPool: Either strides or dilations must be 1. "+"Got strides ".concat(o," and dilations '").concat(1,"'"));const l=BT(a.shape,i,o,1,s,c);let u;if(1===l.filterWidth&&1===l.filterHeight&&yw(l.inShape,l.outShape))u=NW({inputs:{x:a},backend:n});else{const e=n.data.get(a.dataId).values,t=Pw(a.shape),r=AV(e,a.shape,a.dtype,t,l,"max");u=n.makeTensorInfo(l.outShape,a.dtype,r.values)}return u}};const bq={kernelName:PS,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{filterSize:i,strides:o,pad:s,dimRoundingMode:c,dataFormat:l}=r;gW(a,"maxPool3d");const u=zT(a.shape,i,o,1,s,c,l),h=FV(n.data.get(a.dataId).values,a.shape,a.dtype,Pw(a.shape),u,"max");return n.makeTensorInfo(h.shape,"float32",h.values)}};const yq={kernelName:MS,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{dy:a,input:i}=t,{filterSize:o,strides:s,pad:c,dimRoundingMode:l}=r;gW([a,i],"maxPool3DGrad");const u=zT(i.shape,o,s,1,c,l),h=function(e,t){const n=II(t.outShape,"int32"),r=t.strideDepth,a=t.strideHeight,i=t.strideWidth,o=t.dilationDepth,s=t.dilationHeight,c=t.dilationWidth,l=t.effectiveFilterDepth,u=t.effectiveFilterHeight,h=t.effectiveFilterWidth,d=t.padInfo.front,f=t.padInfo.top,p=t.padInfo.left;for(let m=0;m<t.batchSize;++m)for(let g=0;g<t.inChannels;++g)for(let v=0;v<t.outDepth;++v){const b=v*r-d;let y=b;for(;y<0;)y+=o;const x=Math.min(t.inDepth,l+b);for(let r=0;r<t.outHeight;++r){const l=r*a-f;let d=l;for(;d<0;)d+=s;const w=Math.min(t.inHeight,u+l);for(let a=0;a<t.outWidth;++a){const f=a*i-p;let k=f;for(;k<0;)k+=c;const S=Math.min(t.inWidth,h+f);let N=Number.NEGATIVE_INFINITY,C=-1;for(let t=y;t<x;t+=o){const n=t-b;for(let r=d;r<w;r+=s){const a=r-l;for(let i=k;i<S;i+=c){const o=i-f,s=e.get(m,t,r,i,g);s>=N&&(N=s,C=n*u*h+a*u+o)}}}n.set(C,m,v,r,a,g)}}}return n}(n.bufferSync(i),u),d=u.strideDepth,f=u.strideHeight,p=u.strideWidth,m=u.dilationDepth,g=u.dilationHeight,v=u.dilationWidth,b=u.effectiveFilterDepth,y=u.effectiveFilterHeight,x=u.effectiveFilterWidth,w=b-1-u.padInfo.front,k=x-1-u.padInfo.left,S=y-1-u.padInfo.top,N=II(i.shape,"float32"),C=n.bufferSync(a);for(let E=0;E<u.batchSize;++E)for(let e=0;e<u.inChannels;++e)for(let t=0;t<u.inDepth;++t)for(let n=0;n<u.inHeight;++n)for(let r=0;r<u.inWidth;++r){const a=t-w,i=n-S,o=r-k;let s=0;for(let t=0;t<b;t+=m){const n=(a+t)/d;if(!(n<0||n>=u.outDepth||Math.floor(n)!==n))for(let r=0;r<y;r+=g){const a=(i+r)/f;if(!(a<0||a>=u.outHeight||Math.floor(a)!==a))for(let i=0;i<x;i+=v){const c=(o+i)/p;if(c<0||c>=u.outWidth||Math.floor(c)!==c)continue;const l=b*y*x-1-h.get(E,n,a,c,e)===t*y*x+r*x+i?1:0;if(0===l)continue;s+=C.get(E,n,a,c,e)*l}}}N.set(s,E,t,n,r,e)}return n.makeTensorInfo(N.shape,N.dtype,N.values)}};const xq={kernelName:LS,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{dy:a,input:i,output:o}=t,s=i;gW([i,o],"maxPoolGrad");const{filterSize:c,strides:l,pad:u,dimRoundingMode:h}=r,d=BT(s.shape,c,l,1,u,h),f=n.data.get(s.dataId).values,p=II(d.outShape,s.dtype,RV(f,s.shape,s.dtype,d).values),m=d.strideHeight,g=d.strideWidth,v=d.dilationHeight,b=d.dilationWidth,y=d.effectiveFilterHeight,x=d.effectiveFilterWidth,w=x-1-d.padInfo.left,k=y-1-d.padInfo.top,S=II(s.shape,"float32"),N=n.data.get(a.dataId).values,C=II(a.shape,"float32",N);for(let E=0;E<d.batchSize;++E)for(let e=0;e<d.inChannels;++e)for(let t=0;t<d.inHeight;++t)for(let n=0;n<d.inWidth;++n){const r=t-k,a=n-w;let i=0;for(let t=0;t<y;t+=v){const n=(r+t)/m;if(!(n<0||n>=d.outHeight||Math.floor(n)!==n))for(let r=0;r<x;r+=b){const o=(a+r)/g;if(o<0||o>=d.outWidth||Math.floor(o)!==o)continue;const s=y*x-1-p.get(E,n,o,e)===t*x+r?1:0;if(0===s)continue;i+=C.get(E,n,o,e)*s}}S.set(i,E,t,n,e)}return n.makeTensorInfo(S.shape,S.dtype,S.values)}};const wq={kernelName:jS,backendName:"cpu",kernelFunc:e=>{let{inputs:t,attrs:n,backend:r}=e;const{x:a}=t,{filterSize:i,strides:o,pad:s,includeBatchInIndex:c}=n,l=r;gW(a,"MaxPoolWithArgmax");const u=l.data.get(a.dataId).values,h=BT(a.shape,i,o,[1,1],s),[d,f]=function(e,t,n,r,a){const i=AV(e,0,n,Pw(t),a,"max"),o=RV(e,t,n,a,!0,r);return[i.values,o.values]}(u,a.shape,a.dtype,c,h),p=l.write(d,h.outShape,a.dtype),m=l.write(f,h.outShape,a.dtype);return[{dataId:p,shape:h.outShape,dtype:a.dtype},{dataId:m,shape:h.outShape,dtype:"int32"}]}};const kq={kernelName:BS,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:i,keepDims:o}=r,s=Cw(i,a.shape),c=bw(U_(a.shape,s)[1]),l=[],u=n.makeTensorInfo([],"float32",new Float32Array([c]));l.push(u);const h=qW({inputs:{x:a},backend:n,attrs:{dtype:"float32"}});l.push(h);const d=aG({inputs:{a:h,b:u},backend:n});l.push(d);const f=OH({inputs:{x:d},backend:n,attrs:{axis:i,keepDims:o}});return l.forEach(e=>n.disposeIntermediateTensorInfo(e)),f}};const Sq={kernelName:zS,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:i,keepDims:o}=r;gW(a,"min");const s=Cw(i,a.shape);let c=s;const l=H_(c,a.shape.length);let u=a;null!=l&&(u=fV({inputs:{x:a},backend:n,attrs:{perm:l}}),c=q_(c.length,a.shape.length)),V_("min",c,u.shape.length);const[h,d]=U_(u.shape,c),f=bw(d),p=zw(bw(h),u.dtype),m=n.data.get(u.dataId).values;for(let v=0;v<p.length;++v){const e=v*f;let t=m[e];for(let n=0;n<f;++n){const r=m[e+n];(Number.isNaN(r)||r<t)&&(t=r)}p[v]=t}null!=l&&n.disposeIntermediateTensorInfo(u);const g=n.makeTensorInfo(h,u.dtype,p);if(o){const e=eV({inputs:{x:g},backend:n,attrs:{shape:W_(h,s)}});return n.disposeIntermediateTensorInfo(g),e}return g}},Nq=TW((e,t)=>Math.min(e,t)),Cq=XW(US,Nq),Eq={kernelName:US,backendName:"cpu",kernelFunc:Cq};const Iq={kernelName:WS,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{paddings:i,mode:o}=r;gW(a,"mirrorPad");const s=i.map((e,t)=>e[0]+a.shape[t]+e[1]),c=i.map(e=>e[0]),l=i.map((e,t)=>e[0]+a.shape[t]),u="reflect"===o?0:1,h=n.data.get(a.dataId).values,d=a.shape.length,f=Pw(a.shape),p=bw(s),m=s.length,g=Pw(s),v=Iw(a.dtype,p);for(let b=0;b<p;b++){let e=Hw(b,m,g);for(let n=0;n<m;n++)e[n]<c[n]?e[n]=2*c[n]-e[n]-u:e[n]>=l[n]&&(e[n]=2*(l[n]-1)-e[n]+u);e=e.map((e,t)=>e-c[t]);const t=Vw(e,d,f);v[b]=h[t]}return{dataId:n.write(v,s,a.dtype),shape:s,dtype:a.dtype}}},Tq=TW((e,t)=>{const n=e%t;return e<0&&t<0||e>=0&&t>=0?n:(n+t)%t}),_q=XW(VS,Tq),Aq={kernelName:VS,backendName:"cpu",kernelFunc:_q};function Rq(e){const{inputs:t,backend:n,attrs:r}=e,{logits:a}=t,{dim:i}=r,o=a.shape.length;let s=i;if(-1===s&&(s=o-1),s!==o-1)throw Error("Softmax along a non-last dimension is not yet supported. "+"Logits was rank ".concat(o," and dim was ").concat(s));const c=Cw([s],a.shape),l=dq({inputs:{x:a},backend:n,attrs:{reductionIndices:c,keepDims:!1}}),u=W_(l.shape,c),h=eV({inputs:{x:l},backend:n,attrs:{shape:u}}),d=cG({inputs:{a:a,b:h},backend:n}),f=$H({inputs:{x:d},backend:n}),p=OH({inputs:{x:f},backend:n,attrs:{axis:c,keepDims:!1}}),m=eV({inputs:{x:p},backend:n,attrs:{shape:u}}),g=aG({inputs:{a:f,b:m},backend:n});return n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(m),g}const Fq={kernelName:LN,backendName:"cpu",kernelFunc:Rq};const Dq={kernelName:HS,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{logits:a}=t,{numSamples:i,seed:o,normalized:s}=r;gW(a,"multinomial");const c=s?a:Rq({inputs:{logits:a},backend:n,attrs:{dim:-1}}),l=c.shape[0],u=c.shape[1],h=n.data.get(c.dataId).values,d=[l,i],f=zw(bw(d),"int32");for(let p=0;p<l;++p){const e=p*u,t=new Float32Array(u-1);t[0]=h[e];for(let a=1;a<t.length;++a)t[a]=t[a-1]+h[e+a];const n=uA.alea(o.toString()),r=p*i;for(let a=0;a<i;++a){const e=n();f[r+a]=t.length;for(let n=0;n<t.length;n++)if(e<t[n]){f[r+a]=n;break}}}return s||n.disposeIntermediateTensorInfo(c),n.makeTensorInfo(d,"int32",f)}};function Oq(e,t,n){const r=PC(-1,n);return AH([],t,r,e,n)}const Lq={kernelName:qS,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{x:r}=t;gW(r,"neg");const a=n.data.get(r.dataId).values,[i,o]=Oq(a,r.shape,r.dtype);return n.makeTensorInfo(o,r.dtype,i)}},Pq=dR;const Mq={kernelName:XS,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{boxes:a,scores:i}=t,{maxOutputSize:o,iouThreshold:s,scoreThreshold:c}=r;gW(a,"NonMaxSuppression");const l=n.data.get(a.dataId).values,u=n.data.get(i.dataId).values,{selectedIndices:h}=Pq(l,u,o,s,c);return n.makeTensorInfo([h.length],"int32",new Int32Array(h))}},jq=fR;const Bq={kernelName:YS,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{boxes:a,scores:i}=t,{maxOutputSize:o,iouThreshold:s,scoreThreshold:c,padToMaxOutputSize:l}=r;gW(a,"NonMaxSuppressionPadded");const u=n.data.get(a.dataId).values,h=n.data.get(i.dataId).values,{selectedIndices:d,validOutputs:f}=jq(u,h,o,s,c,l);return[n.makeTensorInfo([d.length],"int32",new Int32Array(d)),n.makeTensorInfo([],"int32",new Int32Array([f]))]}},zq=pR;const Uq={kernelName:$S,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{boxes:a,scores:i}=t,{maxOutputSize:o,iouThreshold:s,scoreThreshold:c,softNmsSigma:l}=r;gW(a,"NonMaxSuppressionWithScore");const u=n.data.get(a.dataId).values,h=n.data.get(i.dataId).values,d=o,f=s,p=c,m=l,{selectedIndices:g,selectedScores:v}=zq(u,h,d,f,p,m);return[n.makeTensorInfo([g.length],"int32",new Int32Array(g)),n.makeTensorInfo([v.length],"float32",new Float32Array(v))]}},Wq=TW((e,t)=>e!==t?1:0),Vq=XW(KS,Wq,null,"bool"),Hq={kernelName:KS,backendName:"cpu",kernelFunc:Vq};const Gq={kernelName:QS,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{indices:a}=t,{dtype:i,depth:o,onValue:s,offValue:c}=r;gW(a,"oneHot");const l=bw(a.shape),u=new Float32Array(l*o);u.fill(c);const h=n.data.get(a.dataId).values;for(let d=0;d<l;++d)h[d]>=0&&h[d]<o&&(u[d*o+h[d]]=s);return n.makeTensorInfo([...a.shape,o],i,u)}};function qq(e){const{inputs:t,backend:n}=e,{x:r}=t;if("string"===r.dtype)throw new Error("zerosLike is not supported for string tensors");if("complex64"===r.dtype){const e=VW({inputs:{input:r},backend:n}),t=qq({inputs:{x:e},backend:n}),a=tH({inputs:{input:r},backend:n}),i=qq({inputs:{x:a},backend:n}),o=zW({inputs:{real:t,imag:i},backend:n});return n.disposeIntermediateTensorInfo(e),n.disposeIntermediateTensorInfo(t),n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(i),o}return pG({backend:n,attrs:{shape:r.shape,value:0,dtype:r.dtype}})}const Kq={kernelName:aC,backendName:"cpu",kernelFunc:qq};const Xq={kernelName:JS,backendName:"cpu",kernelFunc:function e(t){const{inputs:n,backend:r}=t,{x:a}=n;if("string"===a.dtype)throw new Error("onesLike is not supported for string tensors");if("complex64"===a.dtype){const t=VW({inputs:{input:a},backend:r}),n=e({inputs:{x:t},backend:r}),i=tH({inputs:{input:a},backend:r}),o=qq({inputs:{x:i},backend:r}),s=zW({inputs:{real:n,imag:o},backend:r});return r.disposeIntermediateTensorInfo(t),r.disposeIntermediateTensorInfo(n),r.disposeIntermediateTensorInfo(i),r.disposeIntermediateTensorInfo(o),s}return pG({backend:r,attrs:{shape:a.shape,value:1,dtype:a.dtype}})}};function Yq(e){const{inputs:t,backend:n,attrs:r}=e,{axis:a}=r;if(1===t.length)return QH({inputs:{input:t[0]},backend:n,attrs:{dim:a}});const i=t[0].shape,o=t[0].dtype;t.forEach(e=>{gw(i,e.shape,"All tensors passed to stack must have matching shapes"),mw(o===e.dtype,()=>"All tensors passed to stack must have matching dtypes")});const s=[],c=t.map(e=>{const t=QH({inputs:{input:e},backend:n,attrs:{dim:a}});return s.push(t),t}),l=rH({inputs:c,backend:n,attrs:{axis:a}});return s.forEach(e=>n.disposeIntermediateTensorInfo(e)),l}const $q={kernelName:ZS,backendName:"cpu",kernelFunc:Yq};const Jq={kernelName:eN,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{paddings:i,constantValue:o}=r;gW(a,"pad");const s=i.map((e,t)=>e[0]+a.shape[t]+e[1]),c=i.map(e=>e[0]),l=n.data.get(a.dataId).values,u=bw(a.shape),h=a.shape.length,d=Pw(a.shape),f=bw(s),p=s.length,m=Pw(s),g=Iw(a.dtype,f);0!==o&&g.fill(o);for(let v=0;v<u;v++){const e=Hw(v,h,d).map((e,t)=>e+c[t]);g[Vw(e,p,m)]=l[v]}return{dataId:n.write(g,s,a.dtype),shape:s,dtype:a.dtype}}},Qq=TW((e,t)=>Math.pow(e,t)),Zq=XW(tN,Qq),eK={kernelName:tN,backendName:"cpu",kernelFunc:Zq};function tK(e,t,n,r){const[a,i]=U_(e,r),o=uE(t,"int32"),s=zw(bw(a),o),c=bw(i);for(let l=0;l<s.length;++l){const e=l*c;let t=1;for(let r=0;r<c;++r)t*=n[e+r];s[l]=t}return{outVals:s,outShape:a,outDtype:o}}const nK={kernelName:rN,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:i,keepDims:o}=r;gW(a,"prod");const s=a.shape.length,c=Cw(i,a.shape),l=H_(c,s);let u=c,h=a;const d=[];null!=l&&(h=fV({inputs:{x:a},backend:n,attrs:{perm:l}}),d.push(h),u=q_(u.length,s));const f=n.data.get(h.dataId).values,{outVals:p,outShape:m,outDtype:g}=tK(h.shape,h.dtype,f,u);let v=m;return o&&(v=W_(m,c)),d.forEach(e=>n.disposeIntermediateTensorInfo(e)),n.makeTensorInfo(v,g,p)}};function rK(e,t,n,r){const a=[];let i=0;const o=t.length-1+n.length,s=new Array(o).fill(null).map(()=>[0]);!function(e,t){for(let n=0;n<e.length;++n){const r=e[n],a=n===e.length-1?t:e[n+1].length;if(0===r.length)throw new Error("Ragged splits may not be empty");if(r[0]<0)throw new Error("Ragged splits must be non-negative");if(r[r.length-1]>a)throw new Error("Ragged splits must not point past values");for(let e=1;e<r.length;++e)if(r[e-1]>r[e])throw new Error("Ragged splits must be sorted in ascending order")}}(n,r);let c=1;for(let l=0;l<t.length-1;++l){c*=t[l];const e=t[l+1];for(let t=1;t<c+1;++t)s[l].push(t*e)}for(let l=0;l<e.length;++l){let r=e[l],o=e[l]+1;for(let e=0;e<n.length;++e){const a=n[e],i=e+t.length-1;if(i>=0){const e=s[i],t=e[e.length-1]-a[r];for(let n=r;n<o;++n)s[i].push(a[n+1]+t)}r=a[r],o=a[o]}o!==r&&(a.push([r,o]),i+=o-r)}return{outSplits:s,valueSlices:a,numValues:i}}function aK(e,t){const n=e.slice(0,t);for(;n.length<t;)n.push(1);for(let r=t;r<e.length;r++)n[t-1]*=e[r];return n}function iK(e,t,n,r,a){const i=t.slice();i[0]=a;const o=Tw(n,bw(i)),s=e.length;return function(e,t,n,r,a,i){const o=aK(t,2)[1],s=aK(i,2)[1];let c=0;for(const l of n)for(let t=l[0];t<l[1];++t){for(let n=0;n<r;++n)a[c*s+n]=e[t*o+n];++c}}(e,t,r,0===s?0:s/t[0],o,i),[o,i]}function oK(e,t,n,r,a,i,o,s){if(0===e.length)throw new Error("paramsNestedSplits must be non empty");if(0===t[0].length)throw new Error("Split tensors must not be scalars");if(function(e,t,n){e.forEach((e,r)=>{if(e<0||e>=n){const a=Hw(r,t.length,Pw(t)).join(",");throw new Error("indices[".concat(a,"] = ").concat(e," is not in [0, ").concat(n,")"))}})}(i,o,t[0][0]-1),0===r.length)throw new Error("params.rank must be nonzero");const c=r[0],{outSplits:l,valueSlices:u,numValues:h}=rK(i,o,e,c),d=function(e){const t=[];for(let n=0;n<e.length;++n){const r=Tw("int32",e[n].length);t.push(r),e[n].forEach((e,t)=>r[t]=e)}return t}(l),f=iK(n,r,a,u,h);return[d,f[0],f[1]]}const sK={kernelName:aN,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{paramsNestedSplits:a,paramsDenseValues:i,indices:o}=t,{outputRaggedRank:s}=r,c=a.map(e=>n.data.get(e.dataId).values),l=a.map(e=>e.shape),u=n.data.get(i.dataId).values,h=n.data.get(o.dataId).values,[d,f,p]=oK(c,l,u,i.shape,i.dtype,h,o.shape),m=d.map(e=>n.makeTensorInfo([e.length],"int32",e)),g=n.makeTensorInfo(p,i.dtype,f);return m.concat([g])}},cK=2147483647;function lK(e,t,n,r,a,i,o){if(t.length>1)throw new Error("starts must be a scalar or vector");if(a.length>1)throw new Error("limits must be a scalar or vector");if(o.length>1)throw new Error("deltas must be a scalar or vector");const s=0===t.length,c=0===a.length,l=0===o.length,u=[];s||u.push(t[0]),c||u.push(a[0]),l||u.push(o[0]);for(let m=1;m<u.length;++m)if(u[m]!==u[m-1])throw new Error("starts, limits, and deltas must have the same shape");const h=0===u.length?1:u[0],d=Tw("int32",h+1);d[0]=0;for(let m=0;m<h;++m){const t=s?e[0]:e[m],n=c?r[0]:r[m],a=l?i[0]:i[m];if(0===a)throw new Error("Requires delta != 0");let o;if(a>0&&n<t||a<0&&n>t)o=0;else if(o=Math.ceil(Math.abs((n-t)/a)),o>cK)throw new Error("Requires ((limit - start) / delta) <= ".concat(cK));d[m+1]=d[m]+o}const f=Tw(n,d[h]);let p=0;for(let m=0;m<h;++m){const t=d[m+1]-d[m];let n=s?e[0]:e[m];const r=l?i[0]:i[m];for(let e=0;e<t;++e)f[p++]=n,n+=r}return[d,f]}const uK={kernelName:iN,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{starts:r,limits:a,deltas:i}=t,o=n.data.get(r.dataId).values,s=n.data.get(a.dataId).values,c=n.data.get(i.dataId).values,[l,u]=lK(o,r.shape,r.dtype,s,a.shape,c,i.shape);return[n.makeTensorInfo([l.length],"int32",l),n.makeTensorInfo([u.length],r.dtype,u)]}};var hK=KR;class dK{constructor(e,t,n,r,a,i,o,s,c,l){this.shape=e,this.shapeShape=t,this.values=n,this.valuesShape=r,this.valuesDType=a,this.defaultValue=i,this.defaultValueShape=o,this.rowPartitionValues=s,this.rowPartitionValuesShapes=c,this.rowPartitionTypes=YR(l),this.raggedRank=$R(this.rowPartitionTypes)}getRowPartitionTypeByDimension(e){return this.rowPartitionTypes[0]===hK.FIRST_DIM_SIZE?this.rowPartitionTypes[e+1]:this.rowPartitionTypes[e]}getRowPartitionTensor(e){return this.rowPartitionTypes[0]===hK.FIRST_DIM_SIZE?this.rowPartitionValues[e+1]:this.rowPartitionValues[e]}getMaxWidth(e){const t=this.getRowPartitionTensor(e-1);switch(this.getRowPartitionTypeByDimension(e-1)){case hK.VALUE_ROWIDS:return dK.getMaxWidthValueRowID(t);case hK.ROW_SPLITS:return dK.getMaxWidthRowSplit(t);default:throw new Error("Cannot handle partition type ".concat(hK[this.getRowPartitionTypeByDimension(e-1)]))}}static getMaxWidthRowSplit(e){const t=e.length;if(0===t||1===t)return 0;let n=0;for(let r=0;r<t-1;++r){const t=e[r+1]-e[r];t>n&&(n=t)}return n}static getMaxWidthValueRowID(e){const t=e.length;if(0===t)return 0;let n=0,r=e[0],a=0;for(let i=1;i<t;++i){const t=e[i];t!==r&&(r=t,a=Math.max(i-n,a),n=i)}return Math.max(t-n,a)}tensorShapeFromTensor(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(0===t.length){if(-1===e[0])return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return pK(e,n)}calculateOutputSize(e){const t=this.valuesShape;JR(this.defaultValueShape,t);const n=this.tensorShapeFromTensor(this.shape,this.shapeShape),r=XR(this.raggedRank,n,t);r[0]<0&&(r[0]=e);for(let a=1;a<=this.raggedRank;++a)r[a]<0&&(r[a]=this.getMaxWidth(a));return r}calculateFirstParentOutputIndex(e,t,n){const r=Math.min(e,n),a=[];let i=0;for(let o=0;o<r;++o,i+=t)a.push(i);for(let o=r;o<e;++o)a.push(-1);return mw(a.length===e,()=>"Final length of result must be equal to firstDimension."),a}calculateOutputIndexRowSplit(e,t,n,r){const a=e.length,i=[];for(let o=0;o<a-1;++o){const a=e[o+1]-e[o];let s=Math.min(r,a),c=t[o];-1===c&&(s=0);for(let e=0;e<s;++e)i.push(c),c+=n;for(let e=0;e<a-s;++e)i.push(-1)}if(a>0&&i.length!==e[a-1])throw new Error("Invalid row split size.");return i}calculateOutputIndexValueRowID(e,t,n,r){const a=e.length,i=[];if(0===a)return[];let o=0,s=e[0];if(s>=t.length)throw new Error("Got currentValueRowId=".concat(s,", which is not less than ").concat(t.length));let c=t[s];i.push(c);for(let l=1;l<a;++l){const a=e[l];if(a===s)c>=0&&(++o,o<r?c+=n:c=-1);else{if(o=0,s=a,a>=t.length)throw new Error("Got nextValueRowId=".concat(a," which is not less than ").concat(t.length));c=t[a]}i.push(c)}if(i.length!==e.length)throw new Error("Invalid row ids.");return i}calculateOutputIndex(e,t,n,r){const a=this.getRowPartitionTensor(e),i=this.getRowPartitionTypeByDimension(e);switch(i){case hK.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(a,t,n,r);case hK.ROW_SPLITS:if(a.length-1>t.length)throw new Error("Row partition size is greater than output size: ".concat(a.length-1," > ").concat(t.length));return this.calculateOutputIndexRowSplit(a,t,n,r);default:throw new Error("Unsupported partition type: ".concat(hK[i]))}}getFirstDimensionSize(){const e=this.rowPartitionValues[0];if(0===this.rowPartitionTypes.length)throw new Error("No row_partition_types given.");const t=this.rowPartitionTypes[0];switch(t){case hK.FIRST_DIM_SIZE:return e[0];case hK.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case hK.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error("Cannot handle type ".concat(hK[t]))}}compute(){if(this.rowPartitionValues[0].length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");const e=this.getFirstDimensionSize(),t=this.calculateOutputSize(e),n=new Array(this.raggedRank+1);n[n.length-1]=1;for(let i=n.length-2;i>=0;--i)n[i]=n[i+1]*t[i+1];const r=pK(t,!1),a=Tw(this.valuesDType,bw(r));if(n[0]*t[0]>0){let i=this.calculateFirstParentOutputIndex(e,n[0],t[0]);for(let e=1;e<=this.raggedRank;++e){i=this.calculateOutputIndex(e-1,i,n[e],t[e])}this.setOutput(this.raggedRank,i,a,r)}return[r,a]}setOutput(e,t,n,r){if(0===n.length)return;const a=this.values,i=n;let o=r.slice();o=o.slice(e+1);const s=bw(o),c=t.length;let l=this.defaultValue;if(l.length!==s&&1!==l.length){const e=this.defaultValueShape;zE(()=>{const t=ZT(l,e),n=o_(t,o);l=n.dataSync()})}let u=0,h=0,d=0;for(let f=0;f<=c;++f){let e=f<c?t[f]:-1;if(e!==d){if(h<d){const e=a.subarray(u*s);fK(i.subarray(h*s),e,(d-h)*s)}if(f>=c){const t=n.length;e=Math.floor(t/s)}if(e>d)if(1===this.defaultValue.length)i.subarray(d*s,e*s).fill(this.defaultValue[0]),d=e;else for(;e>d;){fK(i.slice(d*s),l,s),++d}e<0?(u=f+1,h=d):(u=f,h=d,d=h+1)}else++d}}}function fK(e,t,n){for(let r=0;r<n;r++)e[r]=t[r]}function pK(e,t){const n=[];for(let r of e){if(r<0){if(!t)throw new Error("Dimension ".concat(r," must be >= 0"));if(r<-1)throw new Error("Dimension ".concat(r," must be >= -1"));r=-1}n.push(r)}return n}function mK(e,t,n,r,a,i,o,s,c,l){return new dK(e,t,n,r,a,i,o,s,c,l).compute()}const gK={kernelName:oN,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{shape:a,values:i,defaultValue:o,rowPartitionTensors:s}=t,{rowPartitionTypes:c}=r,l=n.data.get(a.dataId).values,u=n.data.get(i.dataId).values,h=n.data.get(o.dataId).values,d=s.map(e=>n.data.get(e.dataId).values),f=s.map(e=>e.shape),[p,m]=mK(l,a.shape,u,i.shape,i.dtype,h,o.shape,d,f,c);return n.makeTensorInfo(p,i.dtype,m)}};function vK(e,t,n,r){if(e===t||e<t&&n<0||t<e&&n>1)return zw(0,r);const a=zw(Math.abs(Math.ceil((t-e)/n)),r);t<e&&1===n&&(n=-1),a[0]=e;for(let i=1;i<a.length;i++)a[i]=a[i-1]+n;return a}const bK={kernelName:sN,backendName:"cpu",kernelFunc:function(e){const{backend:t,attrs:n}=e,{start:r,stop:a,dtype:i,step:o}=n,s=vK(r,a,o,i);return t.makeTensorInfo([s.length],i,s)}},yK=xW(lN,e=>1/e),xK={kernelName:lN,backendName:"cpu",kernelFunc:yK};const wK={kernelName:pN,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{images:a}=t,{alignCorners:i,halfPixelCenters:o,size:s}=r;gW(a,"resizeBilinear");const c=Pw(a.shape),[l,u]=s,[h,d,f,p]=a.shape,m=n.data.get(a.dataId).values,g=new Float32Array(bw([h,l,u,p])),v=[i&&l>1?d-1:d,i&&u>1?f-1:f],b=[i&&l>1?l-1:l,i&&u>1?u-1:u];let y=0;const x=v[0]/b[0],w=v[1]/b[1];for(let k=0;k<h;k++)for(let e=0;e<l;e++){let t;t=o?x*(e+.5)-.5:x*e;const n=Math.max(0,Math.floor(t)),r=t-n,a=Math.min(d-1,Math.ceil(t)),i=k*c[0]+n*c[1],s=k*c[0]+a*c[1];for(let e=0;e<u;e++){let t;t=o?w*(e+.5)-.5:w*e;const n=Math.max(0,Math.floor(t)),a=t-n,l=Math.min(f-1,Math.ceil(t)),u=i+n*c[2],h=s+n*c[2],d=i+l*c[2],v=s+l*c[2];for(let e=0;e<p;e++){const t=m[u+e],n=m[h+e],i=t+(m[d+e]-t)*a,o=i+(n+(m[v+e]-n)*a-i)*r;g[y++]=o}}}return n.makeTensorInfo([h,l,u,p],"float32",g)}};const kK={kernelName:mN,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{images:a,dy:i}=t,{alignCorners:o}=r;gW([i,a],"resizeBilinearGrad");const s=Pw(a.shape),[c,l,u,h]=a.shape,[,d,f]=i.shape,p=new Float32Array(c*l*u*h),m=[o&&d>1?l-1:l,o&&f>1?u-1:u],g=[o&&d>1?d-1:d,o&&f>1?f-1:f],v=m[0]/g[0],b=m[1]/g[1],y=n.data.get(i.dataId).values;let x=0;for(let w=0;w<c;w++){const e=w*s[0];for(let t=0;t<d;t++){const n=t*v,r=Math.floor(n),a=Math.min(Math.ceil(n),l-1),i=e+r*s[1],o=e+a*s[1],c=n-r,d=1-c;for(let e=0;e<f;e++){const t=e*b,n=Math.floor(t),r=Math.min(Math.ceil(t),u-1),a=t-n,l=1-a,f=i+n*s[2],m=i+r*s[2],g=o+n*s[2],v=o+r*s[2],w=d*l,k=d*a,S=c*l,N=c*a;for(let e=0;e<h;e++){const t=y[x++];p[f+e]+=t*w,p[m+e]+=t*k,p[g+e]+=t*S,p[v+e]+=t*N}}}}return n.makeTensorInfo([c,u,l,h],"float32",p)}};const SK={kernelName:dN,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{images:a}=t,{alignCorners:i,halfPixelCenters:o,size:s}=r;gW(a,"resizeNearestNeighbor");const c=Pw(a.shape),[l,u]=s,[h,d,f,p]=a.shape,m=n.data.get(a.dataId).values,g=new Float32Array(h*l*u*p),v=[i&&l>1?d-1:d,i&&u>1?f-1:f],b=[i&&l>1?l-1:l,i&&u>1?u-1:u],y=v[0]/b[0],x=v[1]/b[1];let w=0;for(let k=0;k<h;k++){const e=k*c[0];for(let t=0;t<l;t++){const n=o?y*(t+.5):y*t;let r=Math.min(d-1,i?Math.round(n):Math.floor(n));o&&(r=Math.max(0,r));const a=e+r*c[1];for(let e=0;e<u;e++){const t=o?x*(e+.5):x*e;let n=Math.min(f-1,i?Math.round(t):Math.floor(t));o&&(n=Math.max(0,n));const r=a+n*c[2];for(let e=0;e<p;e++){const t=m[r+e];g[w++]=t}}}}return n.makeTensorInfo([h,l,u,p],a.dtype,g)}};const NK={kernelName:fN,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{images:a,dy:i}=t,{alignCorners:o}=r;gW([i,a],"resizeNearestNeighborGrad");const s=Pw(a.shape),c=Pw(i.shape),[l,u,h,d]=a.shape,[,f,p]=i.shape,m=new Float32Array(l*u*h*d),g=n.data.get(i.dataId).values,v=[o&&f>1?u-1:u,o&&p>1?h-1:h],b=[o&&f>1?f-1:f,o&&p>1?p-1:p],y=v[0]/b[0],x=v[1]/b[1],w=1/y,k=1/x,S=2*Math.ceil(w)+2,N=2*Math.ceil(k)+2;for(let C=0;C<l;C++){const e=C*s[0];for(let t=0;t<u;t++){const n=e+t*s[1],r=Math.floor(t*w),a=Math.floor(r-S/2);for(let i=0;i<h;i++){const r=n+i*s[2],l=Math.floor(i*k),v=Math.floor(l-N/2);for(let n=0;n<d;n++){let s=0;for(let r=0;r<S;r++){const l=r+a;if(l<0||l>=f)continue;const d=e+l*c[1],m=l*y;if(t===Math.min(u-1,o?Math.round(m):Math.floor(m)))for(let e=0;e<N;e++){const t=e+v;if(t<0||t>=p)continue;const r=d+t*c[2],a=t*x;i===Math.min(h-1,o?Math.round(a):Math.floor(a))&&(s+=g[r+n])}}m[r+n]=s}}}}return n.makeTensorInfo(a.shape,a.dtype,m)}};const CK={kernelName:vN,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{dims:i}=r;gW(a,"reverse");const o=a.shape.length,s=Cw(i,a.shape);if(0===o)return NW({inputs:{x:a},backend:n});const c=new JC(a.shape,a.dtype),l=n.bufferSync(a);for(let u=0;u<c.size;u++){const e=c.indexToLoc(u),t=e.slice();s.forEach(e=>t[e]=a.shape[e]-1-t[e]),c.set(l.get(...t),...e)}return n.makeTensorInfo(c.shape,c.dtype,c.values)}},EK={kernelName:sC,backendName:"cpu",kernelFunc:e=>{let{inputs:t,attrs:n,backend:r}=e;const{image:a}=t,{radians:i,fillValue:o,center:s}=n,c=r,l=Iw(a.dtype,bw(a.shape)),[u,h,d,f]=a.shape,[p,m]=eF(s,h,d),g=Math.sin(i),v=Math.cos(i),b=c.data.get(a.dataId).values;for(let y=0;y<u;y++){const e=y*d*h*f;for(let t=0;t<h;t++){const n=t*(d*f);for(let r=0;r<d;r++){const a=r*f;for(let i=0;i<f;i++){const s=[u,t,r,i],c=s[2],y=s[1];let x=(c-p)*v-(y-m)*g,w=(c-p)*g+(y-m)*v;x=Math.round(x+p),w=Math.round(w+m);let k=o;if("number"!==typeof o&&(k=3===i?255:o[i]),x>=0&&x<d&&w>=0&&w<h){k=b[e+w*(d*f)+x*f+i]}l[e+n+a+i]=k}}}}return{dataId:c.write(l,a.shape,a.dtype),shape:a.shape,dtype:a.dtype}}},IK=xW(bN,e=>{const t=Math.floor(e);return e-t<.5?Math.floor(e):e-t>.5?Math.ceil(e):t%2===0?t:t+1}),TK={kernelName:bN,backendName:"cpu",kernelFunc:IK},_K=yW(e=>1/Math.sqrt(e)),AK=wW(yN,_K),RK={kernelName:yN,backendName:"cpu",kernelFunc:AK};function FK(e,t,n,r,a,i,o,s,c,l){const u=[r/a,a],h=e.values,d=t.values;if(0===r)return II(n,t.dtype);const f=c instanceof JC?c:II(u,t.dtype);"string"===typeof c||"number"===typeof c?f.values.fill(c):"boolean"===typeof c&&f.values.fill(+c);for(let p=0;p<i;p++){const e=[];let i=0;for(let t=0;t<o;t++){const n=h[p*o+t];e.push(n),i+=n*s[t]}if(i<0||i>=r/a)throw new Error("Invalid indices: ".concat(e," does not index into ").concat(n));for(let n=0;n<a;n++)l?f.values[i*a+n]+=d[p*a+n]:f.values[i*a+n]=0===t.rank?d[0]:d[p*a+n]}return f}const DK={kernelName:xN,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{indices:a,updates:i}=t,{shape:o}=r,{sliceRank:s,numUpdates:c,sliceSize:l,strides:u,outputSize:h}=lF(0,a,o),d=FK(n.bufferSync(a),n.bufferSync(i),o,h,l,c,s,u,0,!0);return n.makeTensorInfo(o,d.dtype,d.values)}};function OK(e,t){let n=0,r=e.length,a=0;for(;n<r;)a=Math.floor((n+r)/2),e[a]<t?n=a+1:r=a;return r}function LK(e,t){let n=0,r=e.length,a=0;for(;n<r;)a=Math.floor((n+r)/2),e[a]<=t?n=a+1:r=a;return r}const PK={kernelName:kN,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{sortedSequence:a,values:i}=t,{side:o}=r,s=function(e,t,n,r,a,i){const o=Tw("int32",n*a);for(let s=0;s<n;++s){const n=e.slice(s*r,(s+1)*r),c=s*a;for(let e=0;e<a;++e)o[c+e]="left"===i?OK(n,t[e+c]):LK(n,t[e+c])}return o}(n.data.get(a.dataId).values,n.data.get(i.dataId).values,a.shape[0],a.shape[1],i.shape[1],o);return n.makeTensorInfo(i.shape,"int32",s)}};const MK={kernelName:SN,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{condition:r,t:a,e:i}=t;gW([r,a,i],"select");const o=r.shape.length,s=n.data.get(r.dataId).values,c=n.data.get(a.dataId).values,l=n.data.get(i.dataId).values,u=uE(a.dtype,i.dtype),h=zw(bw(a.shape),u);let d=0;const f=0===o||o>1||1===a.shape.length?1:bw(a.shape.slice(1));for(let p=0;p<s.length;p++)for(let e=0;e<f;e++)1===s[p]?h[d++]=c[p]:h[d++]=l[p];return n.makeTensorInfo(a.shape,u,h)}},jK=uF,BK=hF,zK=xW(NN,e=>e>=0?BK*e:jK*(Math.exp(e)-1)),UK={kernelName:NN,backendName:"cpu",kernelFunc:zK},WK=xW(TN,e=>e<0?-1:e>0?1:0),VK={kernelName:TN,backendName:"cpu",kernelFunc:WK},HK=xW(EN,e=>Math.sin(e)),GK={kernelName:EN,backendName:"cpu",kernelFunc:HK},qK=xW(IN,e=>Math.sinh(e)),KK={kernelName:IN,backendName:"cpu",kernelFunc:qK},XK=Math.log(1.1920928955078125e-7)+2,YK=xW(AN,e=>{const t=e>-XK,n=e<XK,r=Math.exp(e);let a;return a=n?r:t?e:Math.log(1+r),a}),$K={kernelName:AN,backendName:"cpu",kernelFunc:YK};const JK={kernelName:DN,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{blockShape:i,paddings:o}=r;gW([a],"spaceToBatchND");const s=bw(i),c=[[0,0]];c.push(...o);for(let g=1+i.length;g<a.shape.length;++g)c.push([0,0]);const l=Jq.kernelFunc({inputs:{x:a},backend:n,attrs:{paddings:c,constantValue:0}}),u=tF(l.shape,i,s,!1),h=nF(u.length,i.length,!1),d=rF(l.shape,i,s,!1),f=eV({inputs:{x:l},backend:n,attrs:{shape:u}}),p=fV({inputs:{x:f},backend:n,attrs:{perm:h}}),m=eV({inputs:{x:p},backend:n,attrs:{shape:d}});return n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(p),m}};function QK(e,t,n,r,a,i,o){const s=t[0],c=i[0],l=new Array(c),u=new Array(s),h=t[1];if(0===c){if(0!==s)throw new Error(MF(s));return[Tw(n,0),[0,h],Tw(a,0),l,u]}let d=!0,f=0;const p=new Array(c).fill(0);for(let g=0;g<s;++g){const t=e[g*h];if(t<0)throw new Error(jF(g,t));if(t>=c)throw new Error(BF(g,t,c));++p[t],d=d&&t>=f,f=t}let m=!0;for(let g=0;g<c;++g){const e=0===p[g];l[g]=e,m=m&&!e,p[g]=Math.max(p[g],1),g>0&&(p[g]+=p[g-1])}if(m&&d){const t=e,n=r;for(let e=0;e<s;++e)u[e]=e;return[t,[s,h],n,l,u]}{const t=p[c-1],i=Tw(n,t*h),d=Tw(a,t),f=new Array(c).fill(0);for(let n=0;n<s;++n){const t=e[n*h],a=f[t],o=(0===t?0:p[t-1])+a;f[t]++;for(let r=0;r<h;++r)i[o*h+r]=e[n*h+r];d[o]=r[n],u[n]=o}for(let e=0;e<c;++e){if(0===f[e]){const t=0===e?0:p[e-1];i[t*h+0]=e;for(let e=1;e<h;++e)i[t*h+e]=0;d[t]=o}}return[i,[t,h],d,l,u]}}const ZK={kernelName:PN,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{indices:r,values:a,denseShape:i,defaultValue:o}=t;if(1!==i.shape.length)throw new Error("Dense shape must be a vector, saw:\n        ".concat(i.shape));if(2!==r.shape.length)throw new Error("Indices must be a matrix, saw:\n        ".concat(r.shape));if(1!==a.shape.length)throw new Error("Values must be a vector, saw:\n        ".concat(a.shape));if(0!==o.shape.length)throw new Error("Default value must be a scalar, saw:\n        ".concat(o.shape));const s=n.data.get(r.dataId).values,c=n.data.get(a.dataId).values,l=n.data.get(i.dataId).values,u=n.data.get(o.dataId).values[0],[h,d,f,p,m]=QK(s,r.shape,r.dtype,c,a.dtype,l,u);return[n.makeTensorInfo(d,r.dtype,h),n.makeTensorInfo([d[0]],a.dtype,f),n.makeTensorInfo([p.length],"bool",new Uint8Array(p.map(e=>Number(e)))),n.makeTensorInfo([m.length],r.dtype,new Int32Array(m))]}};function eX(e,t,n,r,a){const i=bw(r),o=t[0],s=a.length,c=[];let l=1,u=-1;for(let m=0;m<s;++m){const e=a[m];if(-1===e){if(-1!==u)throw new Error(zF(u,m));u=m,c.push(1)}else{if(e<0)throw new Error(UF(m,e));l*=e,c.push(e)}}if(-1!==u){if(l<=0)throw new Error("reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero");const e=Math.trunc(i/l);if(l*e!==i)throw new Error(VF(r,c));c[u]=e}if(bw(c)!==i)throw new Error(HF(r,c));const h=r.length,d=[];if(h>0){d[h-1]=1;for(let e=h-2;e>=0;--e)d[e]=d[e+1]*r[e+1]}const f=[];if(s>0){f[s-1]=1;for(let e=s-2;e>=0;--e)f[e]=f[e+1]*c[e+1]}const p=Tw(n,o*s);for(let m=0;m<o;++m){let t=0;for(let n=0;n<h;++n)t+=e[m*h+n]*d[n];for(let e=0;e<s;++e)p[m*s+e]=Math.trunc(t/f[e]),t%=f[e]}return[p,[o,s],c]}const tX={kernelName:MN,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{inputIndices:r,inputShape:a,newShape:i}=t;if(2!==r.shape.length)throw new Error("Input indices should be a matrix but received shape\n        ".concat(r.shape));if(1!==a.shape.length)throw new Error("Input shape should be a vector but received shape\n        ".concat(a.shape));if(1!==i.shape.length)throw new Error("Target shape should be a vector but received shape ".concat(i.shape));const o=Array.from(n.data.get(a.dataId).values),s=n.data.get(r.dataId).values,c=Array.from(n.data.get(i.dataId).values),[l,u,h]=eX(s,r.shape,r.dtype,o,c);return[n.makeTensorInfo(u,r.dtype,l),n.makeTensorInfo([h.length],i.dtype,new Int32Array(h))]}};function nX(e,t,n,r,a){let i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const s=r.length,c=[t[0],e.length/t[0]],l=c[1],u=s>0?a[s-1]+1:0;if(u<0)throw new Error("segment ids must be >= 0");const h=t.slice();h[0]=u;const d=h.reduce((e,t)=>e*t,1),f=Tw(n,d);if(0===s)return u>0&&f.fill(o),[f,h];if(u<=0)throw new Error("segment ids must be >= 0");let p=0,m=1,g=0,v=a[p];for(;;){let t=0;if(m<s){if(t=a[m],v===t){++m;continue}if(v>=t)throw new Error(qF())}if(v<0||v>=u)throw new Error(KF(v,u));v>g&&f.fill(o,g*l,v*l);for(let n=p;n<m;++n){const t=r[n];if(t<0||t>=c[0])throw new Error(XF(n,r[n],c[0]));for(let n=0;n<l;n++)f[v*l+n]+=e[t*l+n]}if(i)for(let e=0;e<l;e++)f[v*l+e]/=m-p;if(p=m,++m,g=v+1,v=t,m>s)break}return g<u&&f.fill(o,g*l,u*l),[f,h]}const rX={kernelName:jN,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{data:r,indices:a,segmentIds:i}=t;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==a.shape.length)throw new Error("Indices should be a vector but received shape\n          ".concat(a.shape));if(1!==i.shape.length)throw new Error("Segment ids should be a vector but received shape\n          ".concat(i.shape));if(a.shape[0]!==i.shape[0])throw new Error("segmentIds and indices should have same size.");const o=n.data.get(r.dataId).values,s=n.data.get(a.dataId).values,c=n.data.get(i.dataId).values,[l,u]=nX(o,r.shape,r.dtype,s,c,!0);return n.makeTensorInfo(u,r.dtype,l)}};const aX={kernelName:BN,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{data:r,indices:a,segmentIds:i}=t;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==a.shape.length)throw new Error("Indices should be a vector but received shape\n         ".concat(a.shape));if(1!==i.shape.length)throw new Error("Segment ids should be a vector but received shape\n         ".concat(i.shape));if(a.shape[0]!==i.shape[0])throw new Error("segmentIds and indices should have same size.");const o=n.data.get(r.dataId).values,s=n.data.get(a.dataId).values,c=n.data.get(i.dataId).values,[l,u]=nX(o,r.shape,r.dtype,s,c);return n.makeTensorInfo(u,r.dtype,l)}};const iX={kernelName:zN,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{sparseIndices:a,sparseValues:i,defaultValue:o}=t,{outputShape:s}=r,{sliceRank:c,numUpdates:l,sliceSize:u,strides:h,outputSize:d}=lF(0,a,s),f=!1,p=n.bufferSync(a);let m;switch(i.dtype){case"bool":m=FK(p,n.bufferSync(i),s,d,u,l,c,h,Boolean(n.data.get(o.dataId).values[0]),f);break;case"float32":m=FK(p,n.bufferSync(i),s,d,u,l,c,h,n.data.get(o.dataId).values[0],f);break;case"int32":m=FK(p,n.bufferSync(i),s,d,u,l,c,h,n.data.get(o.dataId).values[0],f);break;case"string":m=FK(p,n.bufferSync(i),s,d,u,l,c,h,zC(n.data.get(o.dataId).values[0]),f);break;default:throw new Error("Unsupported type ".concat(i.dtype))}return n.makeTensorInfo(s,m.dtype,m.values)}};const oX={kernelName:ON,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{numOrSizeSplits:i,axis:o}=r,s=Cw(o,a.shape)[0],c=PF(a,i,s),l=new Array(a.shape.length).fill(0),u=a.shape.slice();return c.map(e=>{const t=[...u];t[s]=e;const r=BV({inputs:{x:a},backend:n,attrs:{begin:l,size:t}});return l[s]+=e,r})}},sX=yW(e=>Math.sqrt(e)),cX=xW(RN,e=>Math.sqrt(e)),lX={kernelName:RN,backendName:"cpu",kernelFunc:cX},uX={kernelName:WN,backendName:"cpu",kernelFunc:e=>{let{inputs:t,backend:n}=e;const{x:r}=t,a=n;gW(r,"square");const i=a.data.get(r.dataId).values,o=new Float32Array(i.length);for(let s=0;s<i.length;++s){const e=i[s];o[s]=e*e}return{dataId:a.write(o,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},hX=TW((e,t)=>{const n=e-t;return n*n}),dX=XW(UN,hX),fX={kernelName:UN,backendName:"cpu",kernelFunc:dX},pX=yW((e,t)=>{const{pattern:n,replaceGlobal:r,rewrite:a}=t;return e.replace(new RegExp(n,r?"g":""),a)}),mX=wW(VN,pX),gX={kernelName:VN,backendName:"cpu",kernelFunc:mX},vX=xW(iC,(e,t)=>{const n=t;return isNaN(e)?NaN:e>0?1:n.alpha}),bX={kernelName:iC,backendName:"cpu",kernelFunc:vX};function yX(e,t,n,r){const a=II(e,t.dtype);for(let i=0;i<a.size;i++){const e=a.indexToLoc(i),o=new Array(e.length);for(let t=0;t<o.length;t++)o[t]=e[t]*n[t]+r[t];a.set(t.get(...o),...e)}return a}const xX={kernelName:HN,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{begin:i,end:o,strides:s,beginMask:c,endMask:l,ellipsisMask:u,newAxisMask:h,shrinkAxisMask:d}=r;gW(a,"stridedSlice");const{finalShapeSparse:f,finalShape:p,isIdentity:m,sliceDim0:g,isSimpleSlice:v,begin:b,end:y,strides:x}=DT(a.shape,i,o,s,c,l,u,h,d);let w;if(m)w=eV({inputs:{x:a},backend:n,attrs:{shape:p}});else if(g||v){mw(a.shape.length>=1,()=>"Input must have rank at least 1, got: ".concat(a.shape.length));const e=xT(b,y,x),t=BV({inputs:{x:a},backend:n,attrs:{begin:b,size:e}});w=eV({inputs:{x:t},backend:n,attrs:{shape:p}}),n.disposeIntermediateTensorInfo(t)}else{const e=yX(f,n.bufferSync(a),x,b);w=n.makeTensorInfo(p,e.dtype,e.values)}return w}};class wX{constructor(e,t,n,r,a,i){this.separator=BC(e),this.nGramWidths=t,this.leftPad=BC(n),this.rightPad=BC(r),this.padWidth=a,this.preserveShort=i}getPadWidth(e){return Math.min(this.padWidth<0?e-1:this.padWidth,e-1)}getNumNGrams(e,t){const n=this.getPadWidth(t);return Math.max(0,e+2*n-t+1)}createNGrams(e,t,n,r,a,i){for(let o=0;o<a;++o){const s=this.getPadWidth(i),c=Math.max(0,s-o),l=Math.max(0,s-(a-(o+1))),u=i-(c+l),h=t+(c>0?0:o-s);let d=0;d+=c*this.leftPad.length;for(let t=0;t<u;++t)d+=e[h+t].length;d+=l*this.rightPad.length;d+=(c+l+u-1)*this.separator.length,n[r+o]=new Uint8Array(d);const f=n[r+o];let p=0;const m=e=>e.forEach(e=>f[p++]=e);for(let e=0;e<c;++e)m(this.leftPad),m(this.separator);for(let t=0;t<u-1;++t)m(e[h+t]),m(this.separator);if(u>0){m(e[h+u-1]);for(let e=0;e<l;++e)m(this.separator),m(this.rightPad)}else{for(let e=0;e<l-1;++e)m(this.rightPad),m(this.separator);m(this.rightPad)}}}compute(e,t){const n=e.length,r=t.length;if(r>0){let e=t[0];if(0!==e)throw new Error("First split value must be 0, got ".concat(e));for(let a=1;a<r;++a){let r=t[a]>=e;if(r=r&&t[a]<=n,!r)throw new Error("Invalid split value ".concat(t[a],", must be in [").concat(e,", ").concat(n,"]"));e=t[a]}if(e!==n)throw new Error("Last split value must be data size. Expected ".concat(n,", got ").concat(e))}const a=r-1,i=Tw("int32",r);if(0===n||0===r){const e=new Array(n);for(let t=0;t<=a;++t)i[t]=0;return[e,i]}i[0]=0;for(let s=1;s<=a;++s){const e=t[s]-t[s-1];let n=0;this.nGramWidths.forEach(t=>{n+=this.getNumNGrams(e,t)}),this.preserveShort&&e>0&&0===n&&(n=1),i[s]=i[s-1]+n}const o=new Array(i[a]);for(let s=0;s<a;++s){const n=t[s];let r=i[s];if(this.nGramWidths.forEach(a=>{const i=t[s+1]-t[s],c=this.getNumNGrams(i,a);this.createNGrams(e,n,o,r,c,a),r+=c}),this.preserveShort&&r===i[s]){const a=t[s+1]-t[s];if(0===a)continue;const i=a+2*this.padWidth,c=1;this.createNGrams(e,n,o,r,c,i)}}return[o,i]}}function kX(e,t,n,r,a,i,o,s){return new wX(n,r,a,i,o,s).compute(e,t)}const SX={kernelName:GN,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{separator:a,nGramWidths:i,leftPad:o,rightPad:s,padWidth:c,preserveShortSequences:l}=r,{data:u,dataSplits:h}=t,d=n.data.get(u.dataId).values,f=n.data.get(h.dataId).values,[p,m]=kX(d,f,a,i,o,s,c,l);return[n.makeTensorInfo([p.length],"string",p),n.makeTensorInfo(h.shape,"int32",m)]}};function NX(e,t,n,r){if(!e.length)return;if(0===t.length){for(let t=0;t<e.length;++t)r.push(e.subarray(t,t+1));return}if(1===t.length){const a=t[0];let i=e.indexOf(a);for(;-1!==i;){const t=e.subarray(0,i);n&&0===t.length||r.push(t),i=(e=e.subarray(i+1)).indexOf(a)}return void(n&&0===e.length||r.push(e))}let a=0;for(let i=0;i<e.length+1;i++)if(i===e.length||-1!==t.indexOf(e[i])){const t=e.subarray(a,i);n&&0===t.length||r.push(t),a=i+1}}function CX(e,t,n){const r=e.length,a=[];let i=0,o=0;const s=new Array(r);for(let d=0;d<r;++d){const r=a.length;NX(e[d],t,n,a);const c=a.length-r;s[d]=c,i+=c,o=Math.max(o,c)}const c=Tw("int32",2*i),l=new Array(i),u=[r,o];let h=0;for(let d=0;d<r;++d)for(let e=0;e<s[d];++e)c[2*h]=d,c[2*h+1]=e,l[h]=a[h],++h;return[c,l,u]}const EX={kernelName:qN,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{skipEmpty:a}=r,{input:i,delimiter:o}=t;if("string"!==i.dtype)throw new Error("Input must be of datatype string");if(1!==i.shape.length)throw new Error("Input must be a vector, got shape: ".concat(i.shape));if(0!==o.shape.length)throw new Error("Delimiter must be a scalar, got shape: ".concat(o.shape));const s=n.data.get(i.dataId).values,c=n.data.get(o.dataId).values[0],[l,u,h]=CX(s,c,a),d=u.length;return[n.makeTensorInfo([d,2],"int32",l),n.makeTensorInfo([d],"string",u),n.makeTensorInfo([2],"int32",new Int32Array(h))]}};function IX(e,t){const n=Tw("int32",e.length);for(let r=0;r<e.length;++r)n[r]=LC(e[r]).modulo(t).getLowBitsUnsigned();return n}const TX={kernelName:KN,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{numBuckets:a}=r,{input:i}=t;if("string"!==i.dtype)throw new Error("Input must be of datatype string");if(a<=0)throw new Error("Number of buckets must be at least 1");const o=IX(n.data.get(i.dataId).values,a);return n.makeTensorInfo(i.shape,"int32",o)}},_X=xW(YN,e=>Math.tan(e)),AX={kernelName:YN,backendName:"cpu",kernelFunc:_X},RX=xW($N,e=>Math.tanh(e));const FX={kernelName:wN,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{tensor:r,indices:a,updates:i}=t,{sliceRank:o,numUpdates:s,sliceSize:c,strides:l,outputSize:u}=lF(0,a,r.shape),h=n.bufferSync(a),d=n.bufferSync(i),f=n.bufferSync(r),p=FK(h,d,r.shape,u,c,s,o,l,f,!1);return n.makeTensorInfo(r.shape,p.dtype,p.values)}};function DX(e,t){const n=new Array(e.rank);for(let a=0;a<n.length;a++)n[a]=e.shape[a]*t[a];const r=II(n,e.dtype);for(let a=0;a<r.values.length;++a){const t=r.indexToLoc(a),n=new Array(e.rank);for(let r=0;r<n.length;r++)n[r]=t[r]%e.shape[r];const i=e.locToIndex(n);r.values[a]=e.values[i]}return r}const OX={kernelName:JN,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{reps:i}=r;gW(a,"tile");const o=DX(n.bufferSync(a),i);return n.makeTensorInfo(o.shape,o.dtype,o.values)}},LX=(e,t)=>{const n=t.value-e.value;return 0===n?e.index-t.index:n};function PX(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.length-1;for(;r>n;){if(r-n>600){const a=r-n+1,i=t-n+1,o=Math.log(a),s=.5*Math.exp(2*o/3),c=.5*Math.sqrt(o*s*(a-s)/a)*Math.sign(i-a/2);PX(e,t,Math.max(n,Math.floor(t-i*s/a+c)),Math.min(r,Math.floor(t+(a-i)*s/a+c)))}const a=e[t];let i=n,o=r;for(pw(e,n,t),LX(e[r],a)>0&&pw(e,n,r);i<o;){for(pw(e,i,o),i++,o--;LX(e[i],a)<0;)i+=1;for(;LX(e[o],a)>0;)o-=1}0===LX(e[n],a)?pw(e,n,o):(o+=1,pw(e,o,r)),o<=t&&(n=o+1),t<=o&&(r=o-1)}}function MX(e,t,n,r,a){const i=t[t.length-1],[o,s]=[e.length/i,i],c=Iw(n,o*r),l=Iw("int32",o*r);for(let h=0;h<o;h++){const t=h*s,n=e.subarray(t,t+s);let i=new Array(n.length);n.forEach((e,t)=>i[t]={value:e,index:t}),r<i.length&&(PX(i,r),i=i.slice(0,r)),a&&i.sort(LX);const o=h*r,u=c.subarray(o,o+r),d=l.subarray(o,o+r);for(let e=0;e<r;e++)u[e]=i[e].value,d[e]=i[e].index}const u=t.slice();return u[u.length-1]=r,[II(u,n,c),II(u,"int32",l)]}const jX={kernelName:QN,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{k:i,sorted:o}=r;gW(a,"topk");const s=n.data.get(a.dataId).values,[c,l]=MX(s,a.shape,a.dtype,i,o);return[n.makeTensorInfo(c.shape,c.dtype,c.values),n.makeTensorInfo(l.shape,l.dtype,l.values)]}};const BX={kernelName:ZN,backendName:"cpu",kernelFunc:function(e){const{inputs:t,attrs:n,backend:r}=e,{image:a,transforms:i}=t,{interpolation:o,fillMode:s,fillValue:c,outputShape:l}=n,[u,h,d,f]=a.shape,[p,m]=null!=l?l:[h,d],g=[u,p,m,f],v=Pw(a.shape),b=v[0],y=v[1],x=v[2],w=Pw(g),k=w[0],S=w[1],N=w[2],C=Iw(a.dtype,bw(g));C.fill(c);const E=r.data.get(a.dataId).values,I=r.data.get(i.dataId).values;for(let T=0;T<u;++T){const e=1===i.shape[0]?I:I.subarray(8*T,8*T+8);for(let t=0;t<p;++t)for(let n=0;n<m;++n)for(let r=0;r<f;++r){let a;const i=e[6]*n+e[7]*t+1;if(0===i)continue;const l=(e[0]*n+e[1]*t+e[2])/i,u=(e[3]*n+e[4]*t+e[5])/i,f=zX(l,d,s),p=zX(u,h,s);switch(o){case"nearest":a=WX(E,h,d,b,y,x,T,p,f,r,c);break;case"bilinear":a=VX(E,h,d,b,y,x,T,p,f,r,c);break;default:throw new Error("Error in Transform: Expect 'nearest' or "+"'bilinear', but got ".concat(o))}C[T*k+t*S+n*N+r]=a}return r.makeTensorInfo(g,a.dtype,C)}return{dataId:r.write(C,g,a.dtype),shape:a.shape,dtype:a.dtype}}};function zX(e,t,n){switch(n){case"reflect":return function(e,t){let n=e;if(n<0)if(t<=1)n=0;else{const e=2*t;n<e&&(n=e*Math.trunc(-n/e)+n),n=n<-t?n+e:-n-1}else if(n>t-1)if(t<=1)n=0;else{const e=2*t;n-=e*Math.trunc(n/e),n>=t&&(n=e-n-1)}return dw(0,n,t-1)}(e,t);case"wrap":return function(e,t){let n=e;if(n<0)if(t<=1)n=0;else{const e=t-1;n+=t*(Math.trunc(-n/e)+1)}else if(n>t-1)if(t<=1)n=0;else{const e=t-1;n-=t*Math.trunc(n/e)}return dw(0,n,t-1)}(e,t);case"nearest":return function(e,t){return dw(0,e,t-1)}(e,t);default:return function(e){return e}(e)}}function UX(e,t,n,r,a,i,o,s,c,l,u){return 0<=s&&s<t&&0<=c&&c<n?e[o*r+s*a+c*i+l]:u}function WX(e,t,n,r,a,i,o,s,c,l,u){return UX(e,t,n,r,a,i,o,Math.round(s),Math.round(c),l,u)}function VX(e,t,n,r,a,i,o,s,c,l,u){const h=Math.floor(s),d=Math.floor(c),f=h+1,p=d+1;return(f-s)*((p-c)*UX(e,t,n,r,a,i,o,h,d,l,u)+(c-d)*UX(e,t,n,r,a,i,o,h,p,l,u))+(s-h)*((p-c)*UX(e,t,n,r,a,i,o,f,d,l,u)+(c-d)*UX(e,t,n,r,a,i,o,f,p,l,u))}function HX(e,t,n,r){const a=Cw(t,n)[0],i=[1,n[0],1];for(let p=0;p<a;p++)i[0]*=n[p];i[1]=n[a];for(let p=a+1;p<n.length;p++)i[2]*=n[p];const o=new Map,s=new Int32Array(n[a]),c=new JC(i,r,e),l=[],u=1===i[0]&&1===i[2];for(let p=0;p<n[a];p++){let t;if(u)t=e[p].toString();else{const e=[];for(let t=0;t<i[0];t++)for(let n=0;n<i[2];n++)e.push(c.get(t,p,n));t=e.join(",")}const n=o.get(t);if(null!=n)s[p]=n;else{const e=o.size;o.set(t,e),s[p]=e,l.push(p)}}const h=i.slice();h[1]=o.size;const d=new JC(h,r);l.forEach((e,t)=>{for(let n=0;n<i[0];n++)for(let r=0;r<i[2];r++)d.set(c.get(n,e,r),n,t,r)});const f=n.slice();return f[a]=h[1],{outputValues:d.values,outputShape:f,indices:s}}const GX={kernelName:tC,backendName:"cpu",kernelFunc:function(e){const{inputs:t,attrs:n,backend:r}=e,{axis:a}=n,{x:i}=t;gW(i,"unique");const o=r.data.get(i.dataId).values,{outputValues:s,outputShape:c,indices:l}=HX(o,a,i.shape,i.dtype);return[r.makeTensorInfo(c,i.dtype,s),r.makeTensorInfo([l.length],"int32",l)]}};const qX={kernelName:nC,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{value:a}=t;let{axis:i}=r;i<0&&(i+=a.shape.length);const o=a.shape.length,s=a.shape[i],c=new Array(o-1);let l=0;for(let f=0;f<o;f++)f!==i&&(c[l++]=a.shape[f]);const u=new Array(o).fill(0),h=a.shape.slice();h[i]=1;const d=new Array(s);for(let f=0;f<d.length;f++){u[i]=f;const e=BV({inputs:{x:a},backend:n,attrs:{begin:u,size:h}});d[f]=eV({inputs:{x:e},backend:n,attrs:{shape:c}}),n.disposeIntermediateTensorInfo(e)}return d}};const KX={kernelName:rC,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,segmentIds:i}=t,{numSegments:o}=r;gW(a,"unsortedSegmentSum");const s=[],c=[],l=a.shape.length-i.shape.length;let u=i;for(let d=0;d<l;++d){const e=QH({inputs:{input:u},backend:n,attrs:{dim:d+1}});u=e,c.push(e)}for(let d=0;d<o;++d){const e=PC(d,"int32"),t=n.makeTensorInfo([],"int32",e),r=BH({inputs:{a:t,b:u},backend:n}),i=qW({inputs:{x:r},backend:n,attrs:{dtype:"float32"}}),o=FH({inputs:{a:i,b:a},backend:n}),l=OH({inputs:{x:o},backend:n,attrs:{axis:0,keepDims:!1}});s.push(l),c.push(t),c.push(r),c.push(i),c.push(o),c.push(l)}const h=Yq({inputs:s,backend:n,attrs:{axis:0}});return c.forEach(e=>n.disposeIntermediateTensorInfo(e)),h}},XX=[aV,oV,cV,uV,ZW,hV,mV,gV,vV,bV,xV,kV,NV,IV,_V,DV,OV,LV,PV,rV,MV,UV,HV,qV,KV,KW,$V,QV,UW,ZV,aH,oH,sH,cH,lH,uH,hH,fH,mH,gH,vH,bH,yH,xH,kH,SH,NH,CH,EH,IH,TH,_H,PH,SW,MH,zH,XH,JH,ZH,nG,fG,mG,gG,yG,kG,SG,NG,EG,TG,RG,OG,CW,LG,nH,MG,BG,UG,IW,HG,KG,YG,QG,eq,rq,iq,cq,lq,uq,fq,gq,vq,bq,yq,xq,wq,kq,Sq,Eq,Iq,Aq,Dq,DH,Lq,Mq,Bq,Uq,Hq,Gq,Xq,$q,Jq,eK,RW,nK,sK,uK,gK,bK,HW,iG,xK,DW,LW,tV,wK,kK,SK,NK,CK,EK,TK,RK,DK,PK,MK,UK,jW,VK,GK,KK,zV,Fq,$K,JK,ZK,tX,rX,aX,iX,oX,lX,uX,fX,gX,bX,xX,SX,EX,TX,lG,LH,AX,{kernelName:$N,backendName:"cpu",kernelFunc:RX},FX,OX,jX,BX,pV,GX,qX,KX,Kq];for(const n of XX)bC(n);const YX={},$X={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function JX(e,t){if(!(e in YX)||null!=t){const n=function(e,t){if(1!==e&&2!==e)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");const n=null==t?function(e){if(Yw().getBool("IS_SAFARI")||"undefined"===typeof OffscreenCanvas||2!==e){if("undefined"!==typeof document)return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}return new OffscreenCanvas(300,150)}(e):t;n.addEventListener("webglcontextlost",t=>{t.preventDefault(),delete YX[e]},!1),Yw().getBool("SOFTWARE_WEBGL_ENABLED")&&($X.failIfMajorPerformanceCaveat=!1);if(1===e)return n.getContext("webgl",$X)||n.getContext("experimental-webgl",$X);return n.getContext("webgl2",$X)}(e,t);if(null===n)return console.log("Could not get context for WebGL version",e),null;YX[e]=n}const n=YX[e];return null==n||n.isContextLost()?(delete YX[e],JX(e)):(n.disable(n.DEPTH_TEST),n.disable(n.STENCIL_TEST),n.disable(n.BLEND),n.disable(n.DITHER),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SAMPLE_COVERAGE),n.enable(n.SCISSOR_TEST),n.enable(n.CULL_FACE),n.cullFace(n.BACK),YX[e])}var QX,ZX,eY;function tY(e,t){return[t,e]}function nY(e){const t=bw(e);return ww(Math.ceil(t/4))}function rY(e,t){return[Math.max(1,Math.ceil(t/2)),Math.max(1,Math.ceil(e/2))]}function aY(e,t){const n=e;let r,a,i,o,s,c,l,u,h,d;return 2===Yw().getNumber("WEBGL_VERSION")?(r=n.R32F,a=n.R16F,i=n.RGBA16F,o=n.RGBA32F,s=n.RED,l=4,u=1,h=n.HALF_FLOAT,d=n.FLOAT,c=n.RGBA8):(r=e.RGBA,a=e.RGBA,i=e.RGBA,o=n.RGBA,s=e.RGBA,l=4,u=4,h=null!=t?t.HALF_FLOAT_OES:null,d=e.FLOAT,c=e.RGBA),{internalFormatFloat:r,internalFormatHalfFloat:a,internalFormatPackedHalfFloat:i,internalFormatPackedFloat:o,textureFormatFloat:s,downloadTextureFormat:c,downloadUnpackNumChannels:l,defaultNumChannels:u,textureTypeHalfFloat:h,textureTypeFloat:d}}function iY(e,t){const n=t();return Yw().getBool("DEBUG")&&function(e){const t=e.getError();if(t!==e.NO_ERROR)throw new Error("WebGL Error: "+function(e,t){switch(t){case e.NO_ERROR:return"NO_ERROR";case e.INVALID_ENUM:return"INVALID_ENUM";case e.INVALID_VALUE:return"INVALID_VALUE";case e.INVALID_OPERATION:return"INVALID_OPERATION";case e.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case e.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case e.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code ".concat(t)}}(e,t))}(e),n}!function(e){e[e.DENSE=0]="DENSE",e[e.SHARED_BATCH=1]="SHARED_BATCH"}(QX||(QX={})),function(e){e[e.RENDER=0]="RENDER",e[e.UPLOAD=1]="UPLOAD",e[e.PIXELS=2]="PIXELS",e[e.DOWNLOAD=3]="DOWNLOAD"}(ZX||(ZX={})),function(e){e[e.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",e[e.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",e[e.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",e[e.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",e[e.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(eY||(eY={}));function oY(e){return!!(Yw().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||0===e||5.96e-8<Math.abs(e)&&Math.abs(e)<65504)}function sY(e,t){return gY(e,()=>e.getExtension(t),'Extension "'+t+'" not supported on this browser.')}const cY=/ERROR: [0-9]+:([0-9]+):/g;function lY(e,t){const n=cY.exec(t);if(null==n)return console.log("Couldn't parse line number in error: ".concat(t)),void console.log(e);const r=+n[1],a=e.split("\n"),i=a.length.toString().length+2,o=a.map((e,t)=>kw((t+1).toString(),i)+e);let s=0;for(let h=0;h<o.length;h++)s=Math.max(o[h].length,s);const c=o.slice(0,r-1),l=o.slice(r-1,r),u=o.slice(r);console.log(c.join("\n")),console.log(t.split("\n")[0]),console.log("%c ".concat(kw(l[0],s)),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(u.join("\n"))}function uY(e,t){if(iY(e,()=>e.validateProgram(t)),!1===e.getProgramParameter(t,e.VALIDATE_STATUS))throw console.log(e.getProgramInfoLog(t)),new Error("Shader program validation failed.")}function hY(e,t,n,r,a,i,o){const s=e.getAttribLocation(t,n);return-1!==s&&(iY(e,()=>e.bindBuffer(e.ARRAY_BUFFER,r)),iY(e,()=>e.vertexAttribPointer(s,a,e.FLOAT,!1,i,o)),iY(e,()=>e.enableVertexAttribArray(s)),!0)}function dY(e,t,n,r){iY(e,()=>function(e,t,n){vY(e,n),iY(e,()=>e.activeTexture(e.TEXTURE0+n)),iY(e,()=>e.bindTexture(e.TEXTURE_2D,t))}(e,t,r)),iY(e,()=>e.uniform1i(n,r))}function fY(e,t,n){iY(e,()=>e.bindFramebuffer(e.FRAMEBUFFER,n)),iY(e,()=>e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0))}function pY(e,t){iY(e,()=>e.bindFramebuffer(e.FRAMEBUFFER,t)),iY(e,()=>e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,null,0))}function mY(e){const t=e.checkFramebufferStatus(e.FRAMEBUFFER);if(t!==e.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+function(e,t){switch(t){case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case e.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error ".concat(t)}}(e,t))}function gY(e,t,n){const r=iY(e,()=>t());if(null==r)throw new Error(n);return r}function vY(e,t){const n=e.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=t+e.TEXTURE0;if(r<e.TEXTURE0||r>n){const e="[gl.TEXTURE0, gl.TEXTURE".concat(n,"]");throw new Error("textureUnit must be in ".concat(e,"."))}}function bY(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return bw(e.slice(0,e.length-t))}function yY(e){if(0===e.length)throw Error("Cannot get rows and columns of an empty shape array.");return[e.length>1?e[e.length-2]:1,e[e.length-1]]}function xY(e){let t=[1,1,1];return 0===e.length||1===e.length&&1===e[0]||(t=[bY(e),...yY(e)]),t}function wY(e){return e%2===0}function kY(e,t){if(yw(e=e.slice(-2),t=t.slice(-2)))return!0;if(!e.length||!t.length)return!0;if(0===e[0]||0===e[1]||0===t[0]||0===t[1])return!0;if(e.length!==t.length){const n=e[e.length-1],r=t[t.length-1];if(n===r)return!0;if(wY(n)&&wY(r)&&(1===e[0]||1===t[0]))return!0}return e[1]===t[1]&&wY(e[0])&&wY(t[0])}let SY,NY;function CY(e,t){return null!=e.getExtension(t)}function EY(e){try{if(null!=JX(e))return!0}catch(_a){return console.log("Error when getting WebGL context: ",_a),!1}return!1}function IY(e){if(0===e)return!1;const t=JX(e);if(1!==e){if(CY(t,"EXT_color_buffer_float"))return TY(t);const e="EXT_color_buffer_half_float";if(CY(t,e)){const n=t.getExtension(e);return function(e,t){const n=aY(e,t),r=e.createTexture();e.bindTexture(e.TEXTURE_2D,r);const a=1,i=1;e.texImage2D(e.TEXTURE_2D,0,n.internalFormatHalfFloat,a,i,0,n.textureFormatFloat,n.textureTypeHalfFloat,null);const o=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,o),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,r,0);const s=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(r),e.deleteFramebuffer(o),s}(t,n)}return!1}if(!CY(t,"OES_texture_float"))return!1;if(!CY(t,"WEBGL_color_buffer_float"))return!1;return TY(t)}function TY(e){const t=aY(e),n=e.createTexture();e.bindTexture(e.TEXTURE_2D,n);e.texImage2D(e.TEXTURE_2D,0,t.internalFormatFloat,1,1,0,t.textureFormatFloat,t.textureTypeFloat,null);const r=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,r),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0);const a=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(n),e.deleteFramebuffer(r),a}function _Y(e,t){Array.isArray(e)||(e=[e]),e.forEach(e=>{null!=e&&mw("complex64"!==e.dtype,()=>"".concat(t," does not support complex64 tensors ")+"in the WebGL backend.")})}const AY=Yw();function RY(){let e,t,n,r,a,i,o,s,c,l;return 2===Yw().getNumber("WEBGL_VERSION")?(e="#version 300 es",t="in",n="out",r="in",a="texture",i="outputColor",o="out vec4 outputColor;",s=Yw().getBool("WEBGL2_ISNAN_CUSTOM")?"\n      bool isnan_custom(float val) {\n        uint floatToUint = floatBitsToUint(val);\n        return (floatToUint & 0x7fffffffu) > 0x7f800000u;\n      }\n\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan_custom(val.x),\n          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));\n      }\n\n      #define isnan(value) isnan_custom(value)\n    ":"",c="",l="\n      #define round(value) newRound(value)\n      int newRound(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 newRound(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "):(e="",t="attribute",n="varying",r="varying",a="texture2D",i="gl_FragColor",o="",s="\n      #define isnan(value) isnan_custom(value)\n      bool isnan_custom(float val) {\n        return (val > 0. || val < 1. || val == 0.) ? false : true;\n      }\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));\n      }\n    ",c="\n      uniform float INFINITY;\n\n      bool isinf(float val) {\n        return abs(val) == INFINITY;\n      }\n      bvec4 isinf(vec4 val) {\n        return equal(abs(val), vec4(INFINITY));\n      }\n    ",l="\n      int round(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 round(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "),{version:e,attribute:t,varyingVs:n,varyingFs:r,texture2D:a,output:i,defineOutput:o,defineSpecialNaN:s,defineSpecialInf:c,defineRound:l}}function FY(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"index";const r=Pw(t);return r.map((t,a)=>{const i="int ".concat(e[a]," = ").concat(n," / ").concat(t),o=a===r.length-1?"int ".concat(e[a+1]," = ").concat(n," - ").concat(e[a]," * ").concat(t):"index -= ".concat(e[a]," * ").concat(t);return"".concat(i,"; ").concat(o,";")}).join("")}function DY(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"index";const r=Pw(t);return r.map((t,a)=>{const i="int ".concat(e[a]," = ").concat(n," / outShapeStrides[").concat(a,"]"),o=a===r.length-1?"int ".concat(e[a+1]," = ").concat(n," - ").concat(e[a]," * outShapeStrides[").concat(a,"]"):"index -= ".concat(e[a]," * outShapeStrides[").concat(a,"]");return"".concat(i,"; ").concat(o,";")}).join("")}function OY(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"index";const r=e.map((e,t)=>t),a=function(e,t){const n=e.length,r=e.map(e=>"".concat(t,"[").concat(e,"]")),a=new Array(n-1);a[n-2]=r[n-1];for(let i=n-3;i>=0;--i)a[i]="(".concat(a[i+1]," * ").concat(r[i+1],")");return a}(r,t);return a.map((t,r)=>{const i="int ".concat(e[r]," = ").concat(n," / ").concat(a[r]),o=r===a.length-1?"int ".concat(e[r+1]," = ").concat(n," - ").concat(e[r]," * ").concat(a[r]):"index -= ".concat(e[r]," * ").concat(a[r]);return"".concat(i,"; ").concat(o,";")}).join("")}function LY(e){const t=Pw(e).map(e=>e.toString());return"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * ".concat(t[0]," + coords.y * ").concat(t[1]," + coords.z;\n  }\n")}AY.registerFlag("HAS_WEBGL",()=>AY.getNumber("WEBGL_VERSION")>0),AY.registerFlag("WEBGL_VERSION",()=>EY(2)?2:EY(1)?1:0),AY.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",()=>!1),AY.registerFlag("WEBGL_BUFFER_SUPPORTED",()=>2===AY.get("WEBGL_VERSION")),AY.registerFlag("WEBGL_CPU_FORWARD",()=>!0),AY.registerFlag("WEBGL_FORCE_F16_TEXTURES",()=>!1),AY.registerFlag("WEBGL_PACK",()=>AY.getBool("HAS_WEBGL")),AY.registerFlag("WEBGL_PACK_NORMALIZATION",()=>AY.getBool("WEBGL_PACK")),AY.registerFlag("WEBGL_PACK_CLIP",()=>AY.getBool("WEBGL_PACK")),AY.registerFlag("WEBGL_PACK_DEPTHWISECONV",()=>AY.getBool("WEBGL_PACK")),AY.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",()=>AY.getBool("WEBGL_PACK")),AY.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",()=>AY.getBool("WEBGL_PACK")),AY.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",()=>AY.getBool("WEBGL_PACK")),AY.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",()=>AY.getBool("WEBGL_PACK")),AY.registerFlag("WEBGL_PACK_REDUCE",()=>AY.getBool("WEBGL_PACK")),AY.registerFlag("WEBGL_LAZILY_UNPACK",()=>AY.getBool("WEBGL_PACK")),AY.registerFlag("WEBGL_CONV_IM2COL",()=>AY.getBool("WEBGL_PACK")),AY.registerFlag("WEBGL_PACK_CONV2DTRANSPOSE",()=>AY.getBool("WEBGL_PACK")),AY.registerFlag("WEBGL_MAX_TEXTURE_SIZE",()=>function(e){if(null==SY){const t=JX(e);SY=t.getParameter(t.MAX_TEXTURE_SIZE)}return SY}(AY.getNumber("WEBGL_VERSION"))),AY.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",()=>function(e){if(null==NY){const t=JX(e);NY=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,NY)}(AY.getNumber("WEBGL_VERSION"))),AY.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",()=>{const e=AY.getNumber("WEBGL_VERSION");return 0===e?0:function(e){if(0===e)return 0;let t;const n=JX(e);return t=CY(n,"EXT_disjoint_timer_query_webgl2")&&2===e?2:CY(n,"EXT_disjoint_timer_query")?1:0,t}(e)}),AY.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",()=>AY.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!CE()),AY.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",()=>function(e){if(0===e)return!1;const t=JX(e);if(1===e){if(!CY(t,"OES_texture_float"))return!1}else if(!CY(t,"EXT_color_buffer_float"))return!1;return TY(t)}(AY.getNumber("WEBGL_VERSION"))),AY.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",()=>!AY.getBool("WEBGL_FORCE_F16_TEXTURES")&&AY.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")),AY.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",()=>IY(AY.getNumber("WEBGL_VERSION"))),AY.registerFlag("WEBGL_FENCE_API_ENABLED",()=>{return 2===(e=AY.getNumber("WEBGL_VERSION"))&&null!=JX(e).fenceSync;var e}),AY.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",()=>AY.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0),AY.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",()=>-1,e=>{if("number"!==typeof e)throw new Error("WEBGL_DELETE_TEXTURE_THRESHOLD must be a number but "+"got ".concat(e,"."));if(e<0&&-1!==e)throw new Error("WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never "+"delete) or at least 0, but got ".concat(e,"."))}),AY.registerFlag("WEBGL_FLUSH_THRESHOLD",()=>CE()?1:-1,e=>{if("number"!==typeof e)throw new Error("WEBGL_FLUSH_THRESHOLD must be a number but got "+"".concat(e,"."));if(e<0&&-1!==e)throw new Error("WEBGL_FLUSH_THRESHOLD must be -1 (indicating never "+"manual flush) or at least 0, but got ".concat(e,"."))}),AY.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",()=>128),AY.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",()=>!1),AY.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",()=>1e5),AY.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",()=>128),AY.registerFlag("WEBGL_EXP_CONV",()=>!1),AY.registerFlag("SOFTWARE_WEBGL_ENABLED",()=>AY.getBool("IS_TEST")),AY.registerFlag("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE",()=>1/0),AY.registerFlag("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE",()=>!1),AY.registerFlag("WEBGL2_ISNAN_CUSTOM",()=>!1),AY.registerFlag("ENGINE_COMPILE_ONLY",()=>!1);const PY="\n  const float FLOAT_MAX = 1.70141184e38;\n  const float FLOAT_MIN = 1.17549435e-38;\n\n  lowp vec4 encode_float(highp float v) {\n    if (isnan(v)) {\n      return vec4(255, 255, 255, 255);\n    }\n\n    highp float av = abs(v);\n\n    if(av < FLOAT_MIN) {\n      return vec4(0.0, 0.0, 0.0, 0.0);\n    } else if(v > FLOAT_MAX) {\n      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;\n    } else if(v < -FLOAT_MAX) {\n      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;\n    }\n\n    highp vec4 c = vec4(0,0,0,0);\n\n    highp float e = floor(log2(av));\n    highp float m = exp2(fract(log2(av))) - 1.0;\n\n    c[2] = floor(128.0 * m);\n    m -= c[2] / 128.0;\n    c[1] = floor(32768.0 * m);\n    m -= c[1] / 32768.0;\n    c[0] = floor(8388608.0 * m);\n\n    highp float ebias = e + 127.0;\n    c[3] = floor(ebias / 2.0);\n    ebias -= c[3] * 2.0;\n    c[2] += floor(ebias) * 128.0;\n\n    c[3] += 128.0 * step(0.0, -v);\n\n    return c / 255.0;\n  }\n",{getBroadcastDims:MY}=a;function jY(e,t,n){const r=[];if(e.forEach(e=>{const t=bw(e.shapeInfo.logicalShape);if(e.shapeInfo.isUniform?r.push("uniform float ".concat(e.name).concat(t>1?"[".concat(t,"]"):"",";")):(r.push("uniform sampler2D ".concat(e.name,";")),r.push("uniform int offset".concat(e.name,";"))),n.enableShapeUniforms){const{uniformShape:t}=XY(n.packedInputs,e.shapeInfo.logicalShape,e.shapeInfo.texShape);switch(t.length){case 1:r.push("uniform int ".concat(e.name,"Shape;"));break;case 2:r.push("uniform ivec2 ".concat(e.name,"Shape;"));break;case 3:r.push("uniform ivec3 ".concat(e.name,"Shape;"));break;case 4:r.push("uniform ivec4 ".concat(e.name,"Shape;"))}r.push("uniform ivec2 ".concat(e.name,"TexShape;"))}}),n.enableShapeUniforms){switch(t.logicalShape.length){case 1:r.push("uniform int outShape;");break;case 2:r.push("uniform ivec2 outShape;"),r.push("uniform int outShapeStrides;");break;case 3:r.push("uniform ivec3 outShape;"),r.push("uniform ivec2 outShapeStrides;");break;case 4:r.push("uniform ivec4 outShape;"),r.push("uniform ivec3 outShapeStrides;")}r.push("uniform ivec2 outTexShape;")}n.customUniforms&&n.customUniforms.forEach(e=>{r.push("uniform ".concat(e.type," ").concat(e.name).concat(e.arrayIndex?"[".concat(e.arrayIndex,"]"):"",";"))});const a=r.join("\n"),i=e.map(e=>function(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3?arguments[3]:void 0,a="";a+=n?zY(e,r):BY(e,r);const i=e.shapeInfo.logicalShape,o=t.logicalShape;i.length<=o.length&&(a+=n?function(e,t){const n=e.name,r=n.charAt(0).toUpperCase()+n.slice(1),a="get"+r+"AtOutCoords",i=e.shapeInfo.logicalShape.length,o=t.logicalShape.length,s=MY(e.shapeInfo.logicalShape,t.logicalShape),c=KY(o),l=o-i;let u;const h=["x","y","z","w","u","v"];u=0===i?"":o<2&&s.length>=1?"coords = 0;":s.map(e=>"coords.".concat(h[e+l]," = 0;")).join("\n");let d="";d=o<2&&i>0?"coords":e.shapeInfo.logicalShape.map((e,t)=>"coords.".concat(h[t+l])).join(", ");let f="return outputValue;";const p=1===bw(e.shapeInfo.logicalShape),m=bw(t.logicalShape),g=1===m;if(1!==i||p||g){if(p&&!g)f=1===o?"\n        return vec4(outputValue.x, outputValue.x, 0., 0.);\n      ":"\n        return vec4(outputValue.x);\n      ";else if(s.length){const e=i-2,t=i-1;s.indexOf(e)>-1&&s.indexOf(t)>-1?f="return vec4(outputValue.x);":s.indexOf(e)>-1?f="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":s.indexOf(t)>-1&&(f="return vec4(outputValue.xx, outputValue.zz);")}}else f="\n      return vec4(outputValue.xy, outputValue.xy);\n    ";return"\n    vec4 ".concat(a,"() {\n      ").concat(c," coords = getOutputCoords();\n      ").concat(u,"\n      vec4 outputValue = get").concat(r,"(").concat(d,");\n      ").concat(f,"\n    }\n  ")}(e,t):function(e,t){const n=e.name,r=n.charAt(0).toUpperCase()+n.slice(1),a="get"+r+"AtOutCoords",i=t.texShape,o=e.shapeInfo.texShape,s=e.shapeInfo.logicalShape.length,c=t.logicalShape.length;if(!e.shapeInfo.isUniform&&s===c&&null==e.shapeInfo.flatOffset&&yw(o,i))return"\n      float ".concat(a,"() {\n        return sampleTexture(").concat(n,", resultUV);\n      }\n    ");const l=KY(c),u=MY(e.shapeInfo.logicalShape,t.logicalShape),h=c-s;let d;const f=["x","y","z","w","u","v"];d=0===s?"":c<2&&u.length>=1?"coords = 0;":u.map(e=>"coords.".concat(f[e+h]," = 0;")).join("\n");let p="";p=c<2&&s>0?"coords":e.shapeInfo.logicalShape.map((e,t)=>"coords.".concat(f[t+h])).join(", ");return"\n    float ".concat(a,"() {\n      ").concat(l," coords = getOutputCoords();\n      ").concat(d,"\n      return get").concat(r,"(").concat(p,");\n    }\n  ")}(e,t));return a}(e,t,n.packedInputs,n.enableShapeUniforms)).join("\n"),o=t.texShape,s=RY(),c=function(e){return"\n    float sampleTexture(sampler2D textureSampler, vec2 uv) {\n      return ".concat(e.texture2D,"(textureSampler, uv).r;\n    }\n  ")}(s);let l,u,h=function(e){const t="".concat(e.version,"\n    precision highp float;\n    precision highp int;\n    precision highp sampler2D;\n    ").concat(e.varyingFs," vec2 resultUV;\n    ").concat(e.defineOutput,"\n    const vec2 halfCR = vec2(0.5, 0.5);\n\n    struct ivec5\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n    };\n\n    struct ivec6\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n      int v;\n    };\n\n    uniform float NAN;\n    ").concat(e.defineSpecialNaN,"\n    ").concat(e.defineSpecialInf,"\n    ").concat(e.defineRound,"\n\n    int imod(int x, int y) {\n      return x - y * (x / y);\n    }\n\n    int idiv(int a, int b, float sign) {\n      int res = a / b;\n      int mod = imod(a, b);\n      if (sign < 0. && mod != 0) {\n        res -= 1;\n      }\n      return res;\n    }\n\n    //Based on the work of Dave Hoskins\n    //https://www.shadertoy.com/view/4djSRW\n    #define HASHSCALE1 443.8975\n    float random(float seed){\n      vec2 p = resultUV * seed;\n      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);\n      p3 += dot(p3, p3.yzx + 19.19);\n      return fract((p3.x + p3.y) * p3.z);\n    }\n\n    ").concat(UY,"\n    ").concat(WY,"\n    ").concat(VY,"\n  ");return t}(s);t.isPacked?(l=function(e,t,n){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(e,t,n){const r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];if(1===r[0])return n?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));\n      }\n    ":"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * ".concat(r[1],".0);\n      }\n    ");if(1===r[1])return n?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));\n      }\n    ":"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * ".concat(r[0],".0);\n      }\n    ");if(n)return"\n    int getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);\n    }\n  ";return"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(r[0],", ").concat(r[1],"));\n      return 2 * (resTexRC.x * ").concat(r[1]," + resTexRC.y);\n    }\n  ")}(0,t,n);case 2:return function(e,t,n){const r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];if(yw(e,t))return n?"\n      ivec2 getOutputCoords() {\n        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));\n      }\n    ":"\n      ivec2 getOutputCoords() {\n        return 2 * ivec2(resultUV.yx * vec2(".concat(r[0],", ").concat(r[1],"));\n      }\n    ");const a=Math.ceil(e[1]/2);if(n)return"\n    ivec2 getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n\n      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;\n      int r = 2 * (index / texelsInLogicalRow);\n      int c = imod(index, texelsInLogicalRow) * 2;\n\n      return ivec2(r, c);\n    }\n  ";return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(r[0],", ").concat(r[1],"));\n\n      int index = resTexRC.x * ").concat(r[1]," + resTexRC.y;\n      int r = 2 * (index / ").concat(a,");\n      int c = imod(index, ").concat(a,") * 2;\n\n      return ivec2(r, c);\n    }\n  ")}(e,t,n);case 3:return function(e,t,n){if(n)return"\n    ivec3 getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));\n      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;\n\n      int b = index / texelsInBatch;\n      index -= b * texelsInBatch;\n\n      int r = 2 * (index / texelsInLogicalRow);\n      int c = imod(index, texelsInLogicalRow) * 2;\n\n      return ivec3(b, r, c);\n    }\n  ";const r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],a=Math.ceil(e[2]/2),i=a*Math.ceil(e[1]/2);return"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(r[0],", ").concat(r[1],"));\n      int index = resTexRC.x * ").concat(r[1]," + resTexRC.y;\n\n      int b = index / ").concat(i,";\n      index -= b * ").concat(i,";\n\n      int r = 2 * (index / ").concat(a,");\n      int c = imod(index, ").concat(a,") * 2;\n\n      return ivec3(b, r, c);\n    }\n  ")}(e,t,n);default:return function(e,t,n){if(n)return"\n    ivec4 getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;\n\n      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));\n      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));\n      int texelsInBatchN = texelsInBatch * outShape[1];\n\n      int b2 = index / texelsInBatchN;\n      index -= b2 * texelsInBatchN;\n\n      int b = index / texelsInBatch;\n      index -= b * texelsInBatch;\n\n      int r = 2 * (index / texelsInLogicalRow);\n      int c = imod(index, texelsInLogicalRow) * 2;\n\n      return ivec4(b2, b, r, c);\n    }\n  ";const r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],a=Math.ceil(e[e.length-1]/2),i=a*Math.ceil(e[e.length-2]/2);let o=i,s="",c="b, r, c";for(let l=2;l<e.length-1;l++)o*=e[e.length-l-1],s="\n      int b".concat(l," = index / ").concat(o,";\n      index -= b").concat(l," * ").concat(o,";\n    ")+s,c="b".concat(l,", ")+c;return"\n    ivec".concat(e.length," getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(").concat(r[0],", ").concat(r[1],"));\n      int index = resTexRC.x * ").concat(r[1]," + resTexRC.y;\n\n      ").concat(s,"\n\n      int b = index / ").concat(i,";\n      index -= b * ").concat(i,";\n\n      int r = 2 * (index / ").concat(a,");\n      int c = imod(index, ").concat(a,") * 2;\n\n      return ivec").concat(e.length,"(").concat(c,");\n    }\n  ")}(e,t,n)}}(t.logicalShape,o,n.enableShapeUniforms),u=function(e){return"\n    void setOutput(vec4 val) {\n      ".concat(e.output," = val;\n    }\n  ")}(s)):(l=function(e,t,n){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(e,t,n){if(1===t[0])return n?"\n      int getOutputCoords() {\n        return int(resultUV.x * float(outTexShape[1]));\n      }\n    ":"\n      int getOutputCoords() {\n        return int(resultUV.x * ".concat(t[1],".0);\n      }\n    ");if(1===t[1])return n?"\n      int getOutputCoords() {\n        return int(resultUV.y * float(outTexShape[0]));\n      }\n    ":"\n      int getOutputCoords() {\n        return int(resultUV.y * ".concat(t[0],".0);\n      }\n    ");if(n)return"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(outTexShape[0], outTexShape[1]));\n      return resTexRC.x * outTexShape[1] + resTexRC.y;\n    }\n  ";return"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(t[0],", ").concat(t[1],"));\n      return resTexRC.x * ").concat(t[1]," + resTexRC.y;\n    }\n  ")}(0,t,n);case 2:return function(e,t,n){if(yw(e,t))return n?"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));\n      }\n    ":"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2(".concat(t[0],", ").concat(t[1],"));\n      }\n    ");if(1===e[1])return n?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(outTexShape[0], outTexShape[1]));\n        int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    ":"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(".concat(t[0],", ").concat(t[1],"));\n        int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    ");if(1===e[0])return n?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(outTexShape[0], outTexShape[1]));\n        int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n        return ivec2(0, index);\n      }\n    ":"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(".concat(t[0],", ").concat(t[1],"));\n        int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n        return ivec2(0, index);\n      }\n    ");if(n)return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(outTexShape[0], outTexShape[1]));\n      int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n      int r = index / outShape[1];\n      int c = index - r * outShape[1];\n      return ivec2(r, c);\n    }\n  ";return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n      int r = index / ").concat(e[1],";\n      int c = index - r * ").concat(e[1],";\n      return ivec2(r, c);\n    }\n  ")}(e,t,n);case 3:return function(e,t,n){if(n){const t=DY(["r","c","d"],e);return"\n  ivec3 getOutputCoords() {\n    ivec2 resTexRC = ivec2(resultUV.yx *\n                           vec2(outTexShape[0], outTexShape[1]));\n    int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n    ".concat(t,"\n    return ivec3(r, c, d);\n  }\n")}const r=FY(["r","c","d"],e);return"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n      ").concat(r,"\n      return ivec3(r, c, d);\n    }\n  ")}(e,t,n);case 4:return function(e,t,n){if(n){const t=DY(["r","c","d","d2"],e);return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(outTexShape[0], outTexShape[1]));\n      int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n      ".concat(t,"\n      return ivec4(r, c, d, d2);\n    }\n  ")}const r=FY(["r","c","d","d2"],e);return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n      ").concat(r,"\n      return ivec4(r, c, d, d2);\n    }\n  ")}(e,t,n);case 5:return function(e,t){const n=FY(["r","c","d","d2","d3"],e);return"\n    ivec5 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx * vec2(".concat(t[0],",\n                             ").concat(t[1],"));\n\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n\n      ").concat(n,"\n\n      ivec5 outShape = ivec5(r, c, d, d2, d3);\n      return outShape;\n    }\n  ")}(e,t);case 6:return function(e,t){const n=FY(["r","c","d","d2","d3","d4"],e);return"\n    ivec6 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n\n      ").concat(n,"\n\n      ivec6 result = ivec6(r, c, d, d2, d3, d4);\n      return result;\n    }\n  ")}(e,t);default:throw new Error("".concat(e.length,"-D output sampling is not yet supported"))}}(t.logicalShape,o,n.enableShapeUniforms),u=function(e){return"\n    void setOutput(float val) {\n      ".concat(e.output," = vec4(val, 0, 0, 0);\n    }\n  ")}(s)),n.packedInputs&&(h+=HY);return[h,c,u,a,l,i,n.userCode].join("\n")}function BY(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=e.shapeInfo.logicalShape;switch(n.length){case 0:return function(e,t){const n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1);if(e.shapeInfo.isUniform)return"float ".concat(r,"() {return ").concat(n,";}");const[a,i]=e.shapeInfo.texShape;if(1===a&&1===i)return"\n      float ".concat(r,"() {\n        return sampleTexture(").concat(n,", halfCR);\n      }\n    ");const o=GY(n);if(t)return"\n    float ".concat(r,"() {\n      vec2 uv = uvFromFlat(").concat(n,"TexShape[0], ").concat(n,"TexShape[1], ").concat(o,");\n      return sampleTexture(").concat(n,", uv);\n    }\n  ");const[s,c]=e.shapeInfo.texShape;return"\n    float ".concat(r,"() {\n      vec2 uv = uvFromFlat(").concat(s,", ").concat(c,", ").concat(o,");\n      return sampleTexture(").concat(n,", uv);\n    }\n  ")}(e,t);case 1:return function(e,t){const n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1);if(e.shapeInfo.isUniform)return"\n      float ".concat(r,"(int index) {\n        ").concat(qY(e),"\n      }\n    ");const a=e.shapeInfo.texShape,i=a[0],o=a[1];if(1===o&&1===i)return"\n      float ".concat(r,"(int index) {\n        return sampleTexture(").concat(n,", halfCR);\n      }\n    ");const s=GY(n);if(1===o)return t?"\n      float ".concat(r,"(int index) {\n        vec2 uv = vec2(0.5, (float(index + ").concat(s,") + 0.5) / float(").concat(n,"TexShape[0]));\n        return sampleTexture(").concat(n,", uv);\n      }\n    "):"\n      float ".concat(r,"(int index) {\n        vec2 uv = vec2(0.5, (float(index + ").concat(s,") + 0.5) / ").concat(i,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");if(1===i)return t?"\n      float ".concat(r,"(int index) {\n        vec2 uv = vec2((float(index + ").concat(s,") + 0.5) / float(").concat(n,"TexShape[1]), 0.5);\n        return sampleTexture(").concat(n,", uv);\n      }\n    "):"\n      float ".concat(r,"(int index) {\n        vec2 uv = vec2((float(index + ").concat(s,") + 0.5) / ").concat(o,".0, 0.5);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");if(t)return"\n    float ".concat(r,"(int index) {\n      vec2 uv = uvFromFlat(").concat(n,"TexShape[0], ").concat(n,"TexShape[1], index + ").concat(s,");\n      return sampleTexture(").concat(n,", uv);\n    }\n  ");return"\n    float ".concat(r,"(int index) {\n      vec2 uv = uvFromFlat(").concat(i,", ").concat(o,", index + ").concat(s,");\n      return sampleTexture(").concat(n,", uv);\n    }\n  ")}(e,t);case 2:return function(e,t){const n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=e.shapeInfo.texShape;if(null!=i&&yw(n,i)){if(t)return"\n      float ".concat(a,"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n        return sampleTexture(").concat(r,", uv);\n      }\n    ");const e=i[0],n=i[1];return"\n    float ".concat(a,"(int row, int col) {\n      vec2 uv = (vec2(col, row) + halfCR) / vec2(").concat(n,".0, ").concat(e,".0);\n      return sampleTexture(").concat(r,", uv);\n    }\n  ")}const{newShape:o,keptDims:s}=Ew(n),c=o;if(c.length<n.length){const n=YY(e,c),r=["row","col"];return"\n      ".concat(BY(n,t),"\n      float ").concat(a,"(int row, int col) {\n        return ").concat(a,"(").concat($Y(r,s),");\n      }\n    ")}if(e.shapeInfo.isUniform)return"\n      float ".concat(a,"(int row, int col) {\n        int index = round(dot(vec2(row, col), vec2(").concat(n[1],", 1)));\n        ").concat(qY(e),"\n      }\n    ");const l=i[0],u=i[1],h=GY(r);if(1===u)return t?"\n      float ".concat(a,"(int row, int col) {\n        float index = dot(vec3(row, col, ").concat(h,"), vec3(").concat(r,"Shape[1], 1, 1));\n        vec2 uv = vec2(0.5, (index + 0.5) / float(").concat(r,"TexShape[0]));\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n    float ".concat(a,"(int row, int col) {\n      float index = dot(vec3(row, col, ").concat(h,"), vec3(").concat(n[1],", 1, 1));\n      vec2 uv = vec2(0.5, (index + 0.5) / ").concat(l,".0);\n      return sampleTexture(").concat(r,", uv);\n    }\n  ");if(1===l)return t?"\n      float ".concat(a,"(int row, int col) {\n        float index = dot(vec3(row, col, ").concat(h,"), vec3(").concat(r,"Shape[1], 1, 1));\n        vec2 uv = vec2((index + 0.5) / float(").concat(r,"TexShape[1]), 0.5);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n    float ".concat(a,"(int row, int col) {\n      float index = dot(vec3(row, col, ").concat(h,"), vec3(").concat(n[1],", 1, 1));\n      vec2 uv = vec2((index + 0.5) / ").concat(u,".0, 0.5);\n      return sampleTexture(").concat(r,", uv);\n    }\n  ");if(t)return"\n      float ".concat(a,"(int row, int col) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * ").concat(r,"Shape[1] + col + ").concat(h,";\n        vec2 uv = uvFromFlat(").concat(r,"TexShape[0], ").concat(r,"TexShape[1], index);\n        return sampleTexture(").concat(r,", uv);\n      }\n    ");return"\n  float ".concat(a,"(int row, int col) {\n    // Explicitly use integer operations as dot() only works on floats.\n    int index = row * ").concat(n[1]," + col + ").concat(h,";\n    vec2 uv = uvFromFlat(").concat(l,", ").concat(u,", index);\n    return sampleTexture(").concat(r,", uv);\n  }\n")}(e,t);case 3:return function(e,t){const n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=n[1]*n[2],o=n[2],{newShape:s,keptDims:c}=Ew(n),l=s;if(l.length<n.length){const n=YY(e,l),r=["row","col","depth"];return"\n        ".concat(BY(n,t),"\n        float ").concat(a,"(int row, int col, int depth) {\n          return ").concat(a,"(").concat($Y(r,c),");\n        }\n      ")}if(e.shapeInfo.isUniform)return"\n      float ".concat(a,"(int row, int col, int depth) {\n        int index = round(dot(vec3(row, col, depth),\n                          vec3(").concat(i,", ").concat(o,", 1)));\n        ").concat(qY(e),"\n      }\n    ");const u=e.shapeInfo.texShape,h=u[0],d=u[1],f=e.shapeInfo.flatOffset;if(d===i&&null==f)return t?"\n      float ".concat(a,"(int row, int col, int depth) {\n        int stride1 = ").concat(r,"Shape[2];\n        float texR = float(row);\n        float texC = dot(vec2(col, depth), vec2(stride1, 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n        float ".concat(a,"(int row, int col, int depth) {\n          float texR = float(row);\n          float texC = dot(vec2(col, depth), vec2(").concat(o,", 1));\n          vec2 uv = (vec2(texC, texR) + halfCR) /\n                     vec2(").concat(d,".0, ").concat(h,".0);\n          return sampleTexture(").concat(r,", uv);\n        }\n      ");if(d===o&&null==f)return t?"\n      float ".concat(a,"(int row, int col, int depth) {\n        float texR = dot(vec2(row, col), vec2(").concat(r,"Shape[1], 1));\n        float texC = float(depth);\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n    float ".concat(a,"(int row, int col, int depth) {\n      float texR = dot(vec2(row, col), vec2(").concat(n[1],", 1));\n      float texC = float(depth);\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(").concat(d,".0, ").concat(h,".0);\n      return sampleTexture(").concat(r,", uv);\n    }\n  ");const p=GY(r);if(t)return"\n    float ".concat(a,"(int row, int col, int depth) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int stride0 = ").concat(r,"Shape[1] * ").concat(r,"Shape[2];\n      int stride1 = ").concat(r,"Shape[2];\n      int index = row * stride0 + col * stride1 + depth + ").concat(p,";\n      vec2 uv = uvFromFlat(").concat(r,"TexShape[0], ").concat(r,"TexShape[1], index);\n      return sampleTexture(").concat(r,", uv);\n    }\n    ");return"\n      float ".concat(a,"(int row, int col, int depth) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * ").concat(i," + col * ").concat(o," + depth + ").concat(p,";\n        vec2 uv = uvFromFlat(").concat(h,", ").concat(d,", index);\n        return sampleTexture(").concat(r,", uv);\n      }\n  ")}(e,t);case 4:return function(e,t){const n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=n[3],o=n[2]*i,s=n[1]*o,{newShape:c,keptDims:l}=Ew(n);if(c.length<n.length){const n=YY(e,c),r=["row","col","depth","depth2"];return"\n      ".concat(BY(n,t),"\n      float ").concat(a,"(int row, int col, int depth, int depth2) {\n        return ").concat(a,"(").concat($Y(r,l),");\n      }\n    ")}if(e.shapeInfo.isUniform)return"\n      float ".concat(a,"(int row, int col, int depth, int depth2) {\n        int index = round(dot(vec4(row, col, depth, depth2),\n                          vec4(").concat(s,", ").concat(o,", ").concat(i,", 1)));\n        ").concat(qY(e),"\n      }\n    ");const u=e.shapeInfo.flatOffset,h=e.shapeInfo.texShape,d=h[0],f=h[1],p="int stride2 = ".concat(r,"Shape[3];"),m="int stride1 = ".concat(r,"Shape[2] * stride2;"),g="int stride0 = ".concat(r,"Shape[1] * stride1;");if(f===s&&null==u)return t?"\n      float ".concat(a,"(int row, int col, int depth, int depth2) {\n        ").concat(p,"\n        ").concat(m,"\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3(stride1, stride2, 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n      float ".concat(a,"(int row, int col, int depth, int depth2) {\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3(").concat(o,", ").concat(i,", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(f,".0, ").concat(d,".0);\n        return sampleTexture(").concat(r,", uv);\n      }\n    ");if(f===i&&null==u)return t?"\n      float ".concat(a,"(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3(").concat(r,"Shape[1] * ").concat(r,"Shape[2], ").concat(r,"Shape[2], 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n      float ".concat(a,"(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3(").concat(n[1]*n[2],", ").concat(n[2],", 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(f,".0, ").concat(d,".0);\n        return sampleTexture(").concat(r,", uv);\n      }\n    ");const v=GY(r);if(t)return"\n    float ".concat(a,"(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      ").concat(p,"\n      ").concat(m,"\n      ").concat(g,"\n      int index = row * stride0 + col * stride1 +\n          depth * stride2 + depth2;\n      vec2 uv = uvFromFlat(").concat(r,"TexShape[0], ").concat(r,"TexShape[1], index + ").concat(v,");\n      return sampleTexture(").concat(r,", uv);\n    }\n  ");return"\n    float ".concat(a,"(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ").concat(s," + col * ").concat(o," +\n          depth * ").concat(i," + depth2;\n      vec2 uv = uvFromFlat(").concat(d,", ").concat(f,", index + ").concat(v,");\n      return sampleTexture(").concat(r,", uv);\n    }\n  ")}(e,t);case 5:return function(e){const t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=t[4],i=t[3]*a,o=t[2]*i,s=t[1]*o,{newShape:c,keptDims:l}=Ew(t);if(c.length<t.length){const t=YY(e,c),n=["row","col","depth","depth2","depth3"];return"\n      ".concat(BY(t),"\n      float ").concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n        return ").concat(r,"(").concat($Y(n,l),");\n      }\n    ")}if(e.shapeInfo.isUniform)return"\n      float ".concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n        float index = dot(\n          vec4(row, col, depth, depth2),\n          vec4(").concat(s,", ").concat(o,", ").concat(i,", ").concat(a,")) +\n          depth3;\n        ").concat(qY(e),"\n      }\n    ");const u=e.shapeInfo.flatOffset,h=e.shapeInfo.texShape,d=h[0],f=h[1];if(f===s&&null==u)return"\n      float ".concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n                         vec4(").concat(o,", ").concat(i,", ").concat(a,", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(f,".0, ").concat(d,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");if(f===a&&null==u)return"\n      float ".concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n        float texR = dot(\n          vec4(row, col, depth, depth2),\n          vec4(").concat(t[1]*t[2]*t[3],",\n               ").concat(t[2]*t[3],", ").concat(t[3],", 1));\n        int texC = depth3;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(f,".0, ").concat(d,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");const p=GY(n);return"\n    float ".concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ").concat(s," + col * ").concat(o," + depth * ").concat(i," +\n          depth2 * ").concat(a," + depth3 + ").concat(p,";\n      vec2 uv = uvFromFlat(").concat(d,", ").concat(f,", index);\n      return sampleTexture(").concat(n,", uv);\n    }\n  ")}(e);case 6:return function(e){const t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),{newShape:a,keptDims:i}=Ew(t);if(a.length<t.length){const t=YY(e,a),n=["row","col","depth","depth2","depth3","depth4"];return"\n      ".concat(BY(t),"\n      float ").concat(r,"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        return ").concat(r,"(").concat($Y(n,i),");\n      }\n    ")}const o=t[5],s=t[4]*o,c=t[3]*s,l=t[2]*c,u=t[1]*l;if(e.shapeInfo.isUniform)return"\n      float ".concat(r,"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n        int index = round(dot(\n          vec4(row, col, depth, depth2),\n          vec4(").concat(u,", ").concat(l,", ").concat(c,", ").concat(s,")) +\n          dot(\n            vec2(depth3, depth4),\n            vec2(").concat(o,", 1)));\n        ").concat(qY(e),"\n      }\n    ");const h=e.shapeInfo.flatOffset,d=e.shapeInfo.texShape,f=d[0],p=d[1];if(p===u&&null==h)return"\n      float ".concat(r,"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n          vec4(").concat(l,", ").concat(c,", ").concat(s,", ").concat(o,")) +\n               float(depth4);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(p,".0, ").concat(f,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");if(p===o&&null==h)return"\n      float ".concat(r,"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        float texR = dot(vec4(row, col, depth, depth2),\n          vec4(").concat(t[1]*t[2]*t[3]*t[4],",\n               ").concat(t[2]*t[3]*t[4],",\n               ").concat(t[3]*t[4],",\n               ").concat(t[4],")) + float(depth3);\n        int texC = depth4;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(p,".0, ").concat(f,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");const m=GY(n);return"\n    float ".concat(r,"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ").concat(u," + col * ").concat(l," + depth * ").concat(c," +\n          depth2 * ").concat(s," + depth3 * ").concat(o," + depth4 + ").concat(m,";\n      vec2 uv = uvFromFlat(").concat(f,", ").concat(p,", index);\n      return sampleTexture(").concat(n,", uv);\n    }\n  ")}(e);default:throw new Error("".concat(n.length,"-D input sampling")+" is not yet supported")}}function zY(e,t){switch(e.shapeInfo.logicalShape.length){case 0:return function(e){const t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),r=RY();return"\n    vec4 ".concat(n,"() {\n      return ").concat(r.texture2D,"(").concat(t,", halfCR);\n    }\n  ")}(e);case 1:return function(e,t){const n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=e.shapeInfo.texShape,i=RY();if(t)return"\n    vec4 ".concat(r,"(int index) {\n      ivec2 packedTexShape = ivec2(ceil(float(").concat(n,"TexShape[0]) / 2.0), ceil(float(").concat(n,"TexShape[1]) / 2.0));\n      vec2 uv = packedUVfrom1D(\n        packedTexShape[0], packedTexShape[1], index);\n      return ").concat(i.texture2D,"(").concat(n,", uv);\n    }\n  ");const o=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)];return"\n    vec4 ".concat(r,"(int index) {\n      vec2 uv = packedUVfrom1D(\n        ").concat(o[0],", ").concat(o[1],", index);\n      return ").concat(i.texture2D,"(").concat(n,", uv);\n    }\n  ")}(e,t);case 2:return function(e,t){const n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=e.shapeInfo.texShape,o=i[0],s=i[1],c=RY();if(null!=i&&yw(n,i))return t?"\n      vec4 ".concat(a,"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n\n        return ").concat(c.texture2D,"(").concat(r,", uv);\n      }\n    "):"\n      vec4 ".concat(a,"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(").concat(s,".0, ").concat(o,".0);\n\n        return ").concat(c.texture2D,"(").concat(r,", uv);\n      }\n    ");if(t)return"\n    vec4 ".concat(a,"(int row, int col) {\n      ivec2 packedTexShape = ivec2(ceil(float(").concat(r,"TexShape[0]) / 2.0), ceil(float(").concat(r,"TexShape[1]) / 2.0));\n      int valuesPerRow = int(ceil(float(").concat(r,"Shape[1]) / 2.0));\n      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);\n      return ").concat(c.texture2D,"(").concat(r,", uv);\n    }\n  ");const l=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)],u=Math.ceil(n[1]/2);return"\n    vec4 ".concat(a,"(int row, int col) {\n      vec2 uv = packedUVfrom2D(").concat(u,", ").concat(l[0],", ").concat(l[1],", row, col);\n      return ").concat(c.texture2D,"(").concat(r,", uv);\n    }\n  ")}(e,t);case 3:return function(e,t){const n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=e.shapeInfo.texShape,o=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];if(1===n[0]){const r=[1,2],i=YY(e,n.slice(1)),o=["b","row","col"];return"\n        ".concat(zY(i,t),"\n        vec4 ").concat(a,"(int b, int row, int col) {\n          return ").concat(a,"(").concat($Y(o,r),");\n        }\n      ")}const s=RY();if(t)return"\n    vec4 ".concat(a,"(int b, int row, int col) {\n      ivec2 packedTexShape = ivec2(ceil(float(").concat(r,"TexShape[0]) / 2.0), ceil(float(").concat(r,"TexShape[1]) / 2.0));\n      int valuesPerRow = int(ceil(float(").concat(r,"Shape[2]) / 2.0));\n      int texelsInBatch = valuesPerRow * int(ceil(float(").concat(r,"Shape[1]) / 2.0));\n      vec2 uv = packedUVfrom3D(\n        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);\n      return ").concat(s.texture2D,"(").concat(r,", uv);\n    }\n  ");const c=o[0],l=o[1],u=Math.ceil(n[2]/2),h=u*Math.ceil(n[1]/2);return"\n    vec4 ".concat(a,"(int b, int row, int col) {\n      vec2 uv = packedUVfrom3D(\n        ").concat(c,", ").concat(l,", ").concat(h,", ").concat(u,", b, row, col);\n      return ").concat(s.texture2D,"(").concat(r,", uv);\n    }\n  ")}(e,t);default:return function(e,t){const n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=RY();if(t)return"\n    vec4 ".concat(r,"(int b2, int b, int row, int col) {\n      int valuesPerRow = int(ceil(float(").concat(n,"Shape[3]) / 2.0));\n      int texelsInBatch = valuesPerRow * int(ceil(float(").concat(n,"Shape[2]) / 2.0));\n      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);\n      texelsInBatch *= ").concat(n,"Shape[1];\n      index = b2 * texelsInBatch + index;\n      ivec2 packedTexShape = ivec2(ceil(float(").concat(n,"TexShape[0]) / 2.0), ceil(float(").concat(n,"TexShape[1]) / 2.0));\n      int texR = index / packedTexShape[1];\n      int texC = index - texR * packedTexShape[1];\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return ").concat(a.texture2D,"(").concat(n,", uv);\n    }\n  ");const i=e.shapeInfo.logicalShape,o=i.length,s=e.shapeInfo.texShape,c=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)],l=c[0],u=c[1],h=Math.ceil(i[o-1]/2);let d=h*Math.ceil(i[o-2]/2),f="int b, int row, int col",p="b * ".concat(d," + (row / 2) * ").concat(h," + (col / 2)");for(let m=2;m<o-1;m++)f="int b".concat(m,", ")+f,d*=i[o-m-1],p="b".concat(m," * ").concat(d," + ")+p;return"\n    vec4 ".concat(r,"(").concat(f,") {\n      int index = ").concat(p,";\n      int texR = index / ").concat(u,";\n      int texC = index - texR * ").concat(u,";\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(").concat(u,", ").concat(l,");\n      return ").concat(a.texture2D,"(").concat(n,", uv);\n    }\n  ")}(e,t)}}const UY="\nvec2 uvFromFlat(int texNumR, int texNumC, int index) {\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\nvec2 packedUVfrom1D(int texNumR, int texNumC, int index) {\n  int texelIndex = index / 2;\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",WY="\nvec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,\n  int texNumC, int row, int col) {\n  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",VY="\nvec2 packedUVfrom3D(int texNumR, int texNumC,\n    int texelsInBatch, int texelsInLogicalRow, int b,\n    int row, int col) {\n  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",HY="\n  float getChannel(vec4 frag, vec2 innerDims) {\n    vec2 modCoord = mod(innerDims, 2.);\n    return modCoord.x == 0. ?\n      (modCoord.y == 0. ? frag.r : frag.g) :\n      (modCoord.y == 0. ? frag.b : frag.a);\n  }\n  float getChannel(vec4 frag, int dim) {\n    float modCoord = mod(float(dim), 2.);\n    return modCoord == 0. ? frag.r : frag.g;\n  }\n";function GY(e){return"offset".concat(e)}function qY(e){const t=e.name,n=bw(e.shapeInfo.logicalShape);return n<2?"return ".concat(t,";"):"\n    for (int i = 0; i < ".concat(n,"; i++) {\n      if (i == index) {\n        return ").concat(t,"[i];\n      }\n    }\n  ")}function KY(e){if(e<=1)return"int";if(2===e)return"ivec2";if(3===e)return"ivec3";if(4===e)return"ivec4";if(5===e)return"ivec5";if(6===e)return"ivec6";throw Error("GPU for rank ".concat(e," is not yet supported"))}function XY(e,t,n){const{newShape:r,keptDims:a}=Ew(t),i=t.length,o=e&&3===i&&1===t[0],s=o?t.slice(1):r,c=!e&&i>1&&!yw(t,n)&&r.length<i||o;return{useSqueezeShape:c,uniformShape:c?s:t,keptDims:a}}function YY(e,t){const n=JSON.parse(JSON.stringify(e));return n.shapeInfo.logicalShape=t,n}function $Y(e,t){return t.map(t=>e[t]).join(", ")}function JY(e,t,n,r){const a=n.map((e,n)=>{const r={logicalShape:e.shape,texShape:e.isUniform?null:e.texData.texShape,isUniform:e.isUniform,isPacked:!e.isUniform&&e.texData.isPacked,flatOffset:null};return null!=e.texData&&null!=e.texData.slice&&e.texData.slice.flatOffset>0&&(r.flatOffset=e.texData.slice.flatOffset),{name:t.variableNames[n],shapeInfo:r}}),i=a.map(e=>e.shapeInfo),o={logicalShape:r.shape,texShape:r.texData.texShape,isUniform:!1,isPacked:r.texData.isPacked,flatOffset:null},s=jY(a,o,t),c=function(e,t){const n=gY(e,()=>e.createShader(e.FRAGMENT_SHADER),"Unable to create fragment WebGLShader.");if(iY(e,()=>e.shaderSource(n,t)),iY(e,()=>e.compileShader(n)),Yw().get("ENGINE_COMPILE_ONLY"))return n;if(!1===e.getShaderParameter(n,e.COMPILE_STATUS))throw lY(t,e.getShaderInfoLog(n)),new Error("Failed to compile fragment shader.");return n}(e.gl,s),l=e.createProgram(c);return Yw().get("ENGINE_COMPILE_ONLY")?{program:t,fragmentShader:c,source:s,webGLProgram:l,inShapeInfos:i,outShapeInfo:o,variablesLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:(e.buildVao(l),Object.assign({program:t,fragmentShader:c,source:s,webGLProgram:l,inShapeInfos:i,outShapeInfo:o},QY(e,t,l)))}function QY(e,t,n){const r=[],a=[];let i,o,s,c=null,l=null;l=e.getUniformLocation(n,"NAN",!1),1===Yw().getNumber("WEBGL_VERSION")&&(c=e.getUniformLocation(n,"INFINITY",!1));const u=!1;for(const h of t.variableNames){const a={name:h,uniform:e.getUniformLocation(n,h,u),offset:e.getUniformLocation(n,"offset".concat(h),u)};t.enableShapeUniforms&&(a.shape=e.getUniformLocation(n,"".concat(h,"Shape"),u),a.texShape=e.getUniformLocation(n,"".concat(h,"TexShape"),u)),r.push(a)}if(t.enableShapeUniforms&&(i=e.getUniformLocation(n,"outShape",u),s=e.getUniformLocation(n,"outShapeStrides",u),o=e.getUniformLocation(n,"outTexShape",u)),t.customUniforms)for(const h of t.customUniforms)a.push(e.getUniformLocation(n,h.name,u));return{variablesLocations:r,customUniformLocations:a,infLoc:c,nanLoc:l,outShapeLocation:i,outShapeStridesLocation:s,outTexShapeLocation:o}}function ZY(e,t){if(e.length!==t.length)throw Error("Binary was compiled with ".concat(e.length," inputs, but ")+"was executed with ".concat(t.length," inputs"));e.forEach((e,n)=>{const r=e.logicalShape,a=t[n],i=a.shape;if(!yw(r,i))throw Error("Binary was compiled with different shapes than "+"the current args. Shapes ".concat(r," and ").concat(i," must match"));if(e.isUniform&&a.isUniform)return;const o=e.texShape,s=a.isUniform?null:a.texData.texShape;if(!yw(o,s))throw Error("Binary was compiled with different texture shapes than the"+" current args. Shape ".concat(o," and ").concat(s," must match"))})}function e$(e){return Yw().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&e<=4}class t${constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=QX.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const t=RY();this.outputShape=e,this.enableShapeUniforms=e$(this.outputShape.length),this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        ".concat(this.enableShapeUniforms?DY(["r","c","d"],e):FY(["r","c","d"],e),"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));\n        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getA(rc.x, rc.y, rc.z);\n        }\n\n        ").concat(t.output," = result;\n      }\n    ")}}class n${constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=QX.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const t=RY();this.outputShape=e,this.enableShapeUniforms=e$(this.outputShape.length),this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        ".concat(this.enableShapeUniforms?DY(["r","c","d"],e):FY(["r","c","d"],e),"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));\n        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));\n        }\n\n        ").concat(t.output," = result;\n      }\n    ")}}class r${constructor(e){this.variableNames=["A"],this.outTexUsage=ZX.DOWNLOAD;const t=RY();this.outputShape=e,this.userCode="\n      ".concat(PY,"\n\n      void main() {\n        float x = getAAtOutCoords();\n        ").concat(t.output," = encode_float(x);\n      }\n    ")}}class a${constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=ZX.DOWNLOAD;const t=RY();this.outputShape=e,this.userCode="\n      ".concat(PY,"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));\n        ").concat(t.output," = encode_float(x);\n      }\n    ")}}const i$={R:0,G:1,B:2,A:3};class o${constructor(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"RGBA";this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];const r=RY();this.outputShape=e,this.enableShapeUniforms=e$(this.outputShape.length);let a="result";t&&(a="floor(result * 255. + 0.5)");let i="";for(let o=0;o<n.length;o++){const e=n[o];i+="\n          if(offset == ".concat(o,") {\n            result = values[").concat(i$[e],"];\n          }")}this.userCode="\n      ".concat(this.enableShapeUniforms?"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;\n  }\n":LY(e),"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int flatIndex = getFlatIndex(coords);\n        float result = 0.;\n        int offset = imod(flatIndex, ").concat(n.length,");\n\n        flatIndex = idiv(flatIndex, ").concat(n.length,", 1.);\n\n        int r = flatIndex / texShape[1];\n        if (r < texShape[0]) {\n          int c = imod(flatIndex, texShape[1]);\n          vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);\n          vec4 values = ").concat(r.texture2D,"(A, uv);\n          ").concat(i,"\n        }\n        ").concat(r.output," = vec4(").concat(a,", 0., 0., 0.);\n      }\n    ")}}class s${constructor(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];const n=RY();this.outputShape=e,this.enableShapeUniforms=e$(this.outputShape.length);let r="",a="result";t&&(a="floor(result * 255. + 0.5)");for(let i=0;i<=1;i++)for(let t=0;t<=1;t++){const a=2*i+t;r+="\n          localCoords = coords;\n          if(localCoords[2] + ".concat(t," < ").concat(this.enableShapeUniforms?"outShape[2]":"".concat(e[2]),") {\n          localCoords[2] += ").concat(t,";\n          if (localCoords[1] + ").concat(i," < ").concat(this.enableShapeUniforms?"outShape[1]":"".concat(e[1]),") {\n            localCoords[1] += ").concat(i,";\n\n            flatIndex = getFlatIndex(localCoords);\n            offset = imod(flatIndex, 4);\n\n            flatIndex = idiv(flatIndex, 4, 1.);\n\n            int r = flatIndex / texShape[1];\n            int c = imod(flatIndex, texShape[1]);\n            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);\n            values = ").concat(n.texture2D,"(A, uv);\n\n            if (offset == 0) {\n              result[").concat(a,"] = values[0];\n            } else if (offset == 1) {\n              result[").concat(a,"] = values[1];\n            } else if (offset == 2) {\n              result[").concat(a,"] = values[2];\n            } else {\n              result[").concat(a,"] = values[3];\n            }\n          }\n        }\n        ")}this.userCode="\n        ".concat(this.enableShapeUniforms?"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;\n  }\n":LY(e),"\n\n        void main() {\n          ivec3 coords = getOutputCoords();\n\n          vec4 result = vec4(0.);\n          int flatIndex, r, c, offset;\n          ivec3 localCoords;\n          vec2 uv;\n          vec4 values;\n\n          ").concat(r,"\n\n          ").concat(n.output," = ").concat(a,";\n        }\n    ")}}function c$(e){const t=RY();return function(e,t){const n=gY(e,()=>e.createShader(e.VERTEX_SHADER),"Unable to create vertex WebGLShader.");if(iY(e,()=>e.shaderSource(n,t)),iY(e,()=>e.compileShader(n)),!1===e.getShaderParameter(n,e.COMPILE_STATUS))throw console.log(e.getShaderInfoLog(n)),new Error("Failed to compile vertex shader.");return n}(e,"".concat(t.version,"\n    precision highp float;\n    ").concat(t.attribute," vec3 clipSpacePos;\n    ").concat(t.attribute," vec2 uv;\n    ").concat(t.varyingVs," vec2 resultUV;\n\n    void main() {\n      gl_Position = vec4(clipSpacePos, 1);\n      resultUV = uv;\n    }"))}function l$(e){return function(e,t){const n=gY(e,()=>e.createBuffer(),"Unable to create WebGLBuffer");return iY(e,()=>e.bindBuffer(e.ARRAY_BUFFER,n)),iY(e,()=>e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW)),n}(e,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function u$(e){return function(e,t){const n=gY(e,()=>e.createBuffer(),"Unable to create WebGLBuffer");return iY(e,()=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n)),iY(e,()=>e.bufferData(e.ELEMENT_ARRAY_BUFFER,t,e.STATIC_DRAW)),n}(e,new Uint16Array([0,1,2,2,1,3]))}function h$(e,t,n,r,a,i){!function(e,t){const n=Yw().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e<=0||t<=0){const n="[".concat(e,"x").concat(t,"]");throw new Error("Requested texture size "+n+" is invalid.")}if(e>n||t>n){const r="[".concat(e,"x").concat(t,"]"),a="[".concat(n,"x").concat(n,"]");throw new Error("Requested texture size "+r+" greater than WebGL maximum on this browser / GPU "+a+".")}}(t,n);const o=function(e){return gY(e,()=>e.createTexture(),"Unable to create WebGLTexture.")}(e),s=e.TEXTURE_2D;return iY(e,()=>e.bindTexture(s,o)),iY(e,()=>e.texParameteri(s,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE)),iY(e,()=>e.texParameteri(s,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)),iY(e,()=>e.texParameteri(s,e.TEXTURE_MIN_FILTER,e.NEAREST)),iY(e,()=>e.texParameteri(s,e.TEXTURE_MAG_FILTER,e.NEAREST)),1===Yw().getNumber("WEBGL_VERSION")?iY(e,()=>e.texImage2D(s,0,r,t,n,0,a,i,null)):iY(e,()=>e.texStorage2D(s,1,r,t,n)),iY(e,()=>e.bindTexture(e.TEXTURE_2D,null)),{texture:o,texShape:[n,t]}}function d$(e){return e.internalFormatFloat}function f$(e){return e.internalFormatHalfFloat}function p$(e){return e.downloadTextureFormat}function m$(e){return e.internalFormatPackedFloat}function g$(e){return e.internalFormatPackedHalfFloat}function v$(e,t,n,r,a,i,o,s){const c=e,l=new Float32Array(function(e,t){const[n,r]=rY(e,t);return n*r*4}(i,o));return c.bindBuffer(c.PIXEL_PACK_BUFFER,t),c.getBufferSubData(c.PIXEL_PACK_BUFFER,0,l),c.bindBuffer(c.PIXEL_PACK_BUFFER,null),l}class b${constructor(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.itemsToPoll=[];const t=Yw().getNumber("WEBGL_VERSION");if(null!=e?(this.gl=e,function(e,t){YX[e]=t}(t,e)):this.gl=JX(t),e=this.gl,2===Yw().getNumber("WEBGL_VERSION")){const t=e;this.createVertexArray=()=>iY(t,()=>t.createVertexArray()),this.bindVertexArray=e=>iY(t,()=>t.bindVertexArray(e)),this.deleteVertexArray=e=>iY(t,()=>t.deleteVertexArray(e)),this.getVertexArray=()=>iY(t,()=>t.getParameter(t.VERTEX_ARRAY_BINDING))}else if(null!=e){const t=e.getExtension("OES_vertex_array_object");if(null==t)throw new Error("All WebGL1 implementations are expected to offer OES_vertex_array_object.");this.createVertexArray=()=>iY(e,()=>t.createVertexArrayOES()),this.bindVertexArray=n=>iY(e,()=>t.bindVertexArrayOES(n)),this.deleteVertexArray=n=>iY(e,()=>t.deleteVertexArrayOES(n)),this.getVertexArray=()=>iY(e,()=>e.getParameter(t.VERTEX_ARRAY_BINDING_OES))}let n="WEBGL_color_buffer_float";const r="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),1===Yw().getNumber("WEBGL_VERSION")){const e="OES_texture_float",t="OES_texture_half_float";if(this.textureFloatExtension=sY(this.gl,e),CY(this.gl,t))this.textureHalfFloatExtension=sY(this.gl,t);else if(Yw().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(n),CY(this.gl,r))this.colorBufferHalfFloatExtension=sY(this.gl,r);else if(Yw().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(n="EXT_color_buffer_float",CY(this.gl,n))this.colorBufferFloatExtension=this.gl.getExtension(n);else{if(!CY(this.gl,r))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension(r)}this.vertexBuffer=l$(this.gl),this.indexBuffer=u$(this.gl),this.framebuffer=function(e){return gY(e,()=>e.createFramebuffer(),"Unable to create WebGLFramebuffer.")}(this.gl),this.textureConfig=aY(this.gl,this.textureHalfFloatExtension)}get debug(){return Yw().getBool("DEBUG")}dispose(){if(this.disposed)return;null!=this.program&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),null!=this.outputTexture&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");const e=this.gl;iY(e,()=>e.finish()),iY(e,()=>e.bindFramebuffer(e.FRAMEBUFFER,null)),iY(e,()=>e.deleteFramebuffer(this.framebuffer)),iY(e,()=>e.bindBuffer(e.ARRAY_BUFFER,null)),iY(e,()=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)),iY(e,()=>e.deleteBuffer(this.indexBuffer)),this.disposed=!0}createFloat32MatrixTexture(e,t){return this.throwIfDisposed(),function(e,t,n,r){const[a,i]=tY(t,n);return h$(e,a,i,d$(r),r.textureFormatFloat,e.FLOAT)}(this.gl,e,t,this.textureConfig)}createFloat16MatrixTexture(e,t){return this.throwIfDisposed(),function(e,t,n,r){const[a,i]=tY(t,n);return h$(e,a,i,f$(r),r.textureFormatFloat,r.textureTypeHalfFloat)}(this.gl,e,t,this.textureConfig)}createUnsignedBytesMatrixTexture(e,t){return this.throwIfDisposed(),function(e,t,n,r){const[a,i]=tY(t,n);return h$(e,a,i,p$(r),e.RGBA,e.UNSIGNED_BYTE)}(this.gl,e,t,this.textureConfig)}uploadPixelDataToTexture(e,t){this.throwIfDisposed(),function(e,t,n){iY(e,()=>e.bindTexture(e.TEXTURE_2D,t)),n.data instanceof Uint8Array?2===Yw().getNumber("WEBGL_VERSION")?iY(e,()=>e.texSubImage2D(e.TEXTURE_2D,0,0,0,n.width,n.height,e.RGBA,e.UNSIGNED_BYTE,n.data)):iY(e,()=>e.texImage2D(e.TEXTURE_2D,0,e.RGBA,n.width,n.height,0,e.RGBA,e.UNSIGNED_BYTE,n.data)):2===Yw().getNumber("WEBGL_VERSION")?iY(e,()=>e.texSubImage2D(e.TEXTURE_2D,0,0,0,e.RGBA,e.UNSIGNED_BYTE,n)):iY(e,()=>e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n)),iY(e,()=>e.bindTexture(e.TEXTURE_2D,null))}(this.gl,e,t)}uploadDenseMatrixToTexture(e,t,n,r){this.throwIfDisposed(),function(e,t,n,r,a,i){let o,s,c;iY(e,()=>e.bindTexture(e.TEXTURE_2D,t)),a instanceof Uint8Array?(o=new Uint8Array(n*r*4),s=e.UNSIGNED_BYTE,c=e.RGBA):(o=new Float32Array(n*r*4),s=e.FLOAT,c=i.internalFormatPackedFloat),o.set(a),2===Yw().getNumber("WEBGL_VERSION")?iY(e,()=>e.texSubImage2D(e.TEXTURE_2D,0,0,0,n,r,e.RGBA,s,o)):iY(e,()=>e.texImage2D(e.TEXTURE_2D,0,c,n,r,0,e.RGBA,s,o)),iY(e,()=>e.bindTexture(e.TEXTURE_2D,null))}(this.gl,e,t,n,r,this.textureConfig)}createFloat16PackedMatrixTexture(e,t){return this.throwIfDisposed(),function(e,t,n,r){const[a,i]=rY(t,n);return h$(e,a,i,g$(r),e.RGBA,r.textureTypeHalfFloat)}(this.gl,e,t,this.textureConfig)}createPackedMatrixTexture(e,t){return this.throwIfDisposed(),function(e,t,n,r){const[a,i]=rY(t,n);return h$(e,a,i,m$(r),e.RGBA,e.FLOAT)}(this.gl,e,t,this.textureConfig)}deleteMatrixTexture(e){this.throwIfDisposed(),this.outputTexture===e&&(pY(this.gl,this.framebuffer),this.outputTexture=null),iY(this.gl,()=>this.gl.deleteTexture(e))}downloadByteEncodedFloatMatrixFromOutputTexture(e,t,n){return this.downloadMatrixDriver(e,()=>function(e,t,n,r){const[a,i]=tY(t,n),o=new Uint8Array(t*n*4);return iY(e,()=>e.readPixels(0,0,a,i,r.downloadTextureFormat,e.UNSIGNED_BYTE,o)),new Float32Array(o.buffer)}(this.gl,t,n,this.textureConfig))}downloadPackedMatrixFromBuffer(e,t,n,r,a,i){return v$(this.gl,e,0,0,0,a,i,this.textureConfig)}downloadFloat32MatrixFromBuffer(e,t){return function(e,t,n){const r=e,a=new Float32Array(n);return r.bindBuffer(r.PIXEL_PACK_BUFFER,t),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,a),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),a}(this.gl,e,t)}createBufferFromTexture(e,t,n){this.bindTextureToFrameBuffer(e);const r=function(e,t,n){const r=e.createBuffer();iY(e,()=>e.bindBuffer(e.PIXEL_PACK_BUFFER,r));const a=16*t*n;return iY(e,()=>e.bufferData(e.PIXEL_PACK_BUFFER,a,e.STREAM_READ)),iY(e,()=>e.readPixels(0,0,n,t,e.RGBA,e.FLOAT,0)),iY(e,()=>e.bindBuffer(e.PIXEL_PACK_BUFFER,null)),r}(this.gl,t,n,this.textureConfig);return this.unbindTextureToFrameBuffer(),r}createAndWaitForFence(){const e=this.createFence(this.gl);return this.pollFence(e)}createFence(e){let t,n;if(Yw().getBool("WEBGL_FENCE_API_ENABLED")){const r=e,a=r.fenceSync(r.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),n=()=>{const e=r.clientWaitSync(a,0,0);return e===r.ALREADY_SIGNALED||e===r.CONDITION_SATISFIED},t=a}else Yw().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),n=()=>this.isQueryAvailable(t,Yw().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))):n=()=>!0;return{query:t,isFencePassed:n}}downloadMatrixFromPackedTexture(e,t,n){return this.downloadMatrixDriver(e,()=>function(e,t,n){const r=new Float32Array(t*n*4);return iY(e,()=>e.readPixels(0,0,n,t,e.RGBA,e.FLOAT,r)),r}(this.gl,t,n))}createProgram(e){this.throwIfDisposed();const t=this.gl;null==this.vertexShader&&(this.vertexShader=c$(t));const n=function(e){return gY(e,()=>e.createProgram(),"Unable to create WebGLProgram.")}(t);iY(t,()=>t.attachShader(n,this.vertexShader)),iY(t,()=>t.attachShader(n,e)),function(e,t){if(iY(e,()=>e.linkProgram(t)),!Yw().get("ENGINE_COMPILE_ONLY")&&!1===e.getProgramParameter(t,e.LINK_STATUS))throw console.log(e.getProgramInfoLog(t)),new Error("Failed to link vertex and fragment shaders.")}(t,n);const r=Object.assign(n,{vao:this.createVertexArray()});return this.debug&&uY(t,r),r}buildVao(e){this.setProgram(e),this.bindVertexArray(e.vao);const t=this.gl;iY(t,()=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer)),function(e,t,n){iY(e,()=>e.bindBuffer(e.ARRAY_BUFFER,n)),hY(e,t,"clipSpacePos",n,3,20,0)&&hY(e,t,"uv",n,2,20,12)}(t,e,this.vertexBuffer)}deleteProgram(e){this.throwIfDisposed(),e===this.program&&(this.program=null),null!=e&&(iY(this.gl,()=>this.gl.deleteProgram(e)),this.deleteVertexArray(e.vao))}setProgram(e){this.throwIfDisposed(),this.program=e,null!=this.program&&this.debug&&uY(this.gl,this.program),iY(this.gl,()=>this.gl.useProgram(e))}getUniformLocation(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return this.throwIfDisposed(),n?function(e,t,n){return gY(e,()=>e.getUniformLocation(t,n),'uniform "'+n+'" not present in program.')}(this.gl,e,t):function(e,t,n){return e.getUniformLocation(t,n)}(this.gl,e,t)}getAttributeLocation(e,t){return this.throwIfDisposed(),iY(this.gl,()=>this.gl.getAttribLocation(e,t))}getUniformLocationNoThrow(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)}setInputMatrixTexture(e,t,n){this.throwIfDisposed(),this.throwIfNoProgram(),dY(this.gl,e,t,n)}setOutputMatrixTexture(e,t,n){this.setOutputMatrixTextureDriver(e,n,t)}setOutputPackedMatrixTexture(e,t,n){this.throwIfDisposed();const[r,a]=rY(t,n);this.setOutputMatrixTextureDriver(e,r,a)}setOutputMatrixWriteRegion(e,t,n,r){this.setOutputMatrixWriteRegionDriver(n,e,r,t)}setOutputPackedMatrixWriteRegion(e,t,n,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}debugValidate(){null!=this.program&&uY(this.gl,this.program),mY(this.gl)}executeProgram(){this.throwIfDisposed(),this.throwIfNoProgram();const e=this.gl;if(this.debug){const e=this.getVertexArray();console.assert(e===this.program.vao,"VAO changed between setProgram and executeProgram!"),this.debugValidate()}iY(e,()=>e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0))}blockUntilAllProgramsCompleted(){this.throwIfDisposed(),iY(this.gl,()=>this.gl.finish())}getQueryTimerExtension(){return null==this.disjointQueryTimerExtension&&(this.disjointQueryTimerExtension=sY(this.gl,2===Yw().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}getQueryTimerExtensionWebGL2(){return this.getQueryTimerExtension()}getQueryTimerExtensionWebGL1(){return this.getQueryTimerExtension()}beginQuery(){if(2===Yw().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){const e=this.gl,t=this.getQueryTimerExtensionWebGL2(),n=e.createQuery();return e.beginQuery(t.TIME_ELAPSED_EXT,n),n}const e=this.getQueryTimerExtensionWebGL1(),t=e.createQueryEXT();return e.beginQueryEXT(e.TIME_ELAPSED_EXT,t),t}endQuery(){if(2===Yw().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){const e=this.gl,t=this.getQueryTimerExtensionWebGL2();return void e.endQuery(t.TIME_ELAPSED_EXT)}const e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}async waitForQueryAndGetTime(e){return await Sw(()=>this.disposed||this.isQueryAvailable(e,Yw().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))),this.getQueryTime(e,Yw().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}getQueryTime(e,t){if(0===t)return null;if(2===t){const t=this.gl;return t.getQueryParameter(e,t.QUERY_RESULT)/1e6}{const t=this.getQueryTimerExtensionWebGL1();return t.getQueryObjectEXT(e,t.QUERY_RESULT_EXT)/1e6}}isQueryAvailable(e,t){if(0===t)return!0;if(2===t){const t=this.gl,n=this.getQueryTimerExtensionWebGL2(),r=t.getQueryParameter(e,t.QUERY_RESULT_AVAILABLE);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(n.GPU_DISJOINT_EXT)),r&&!this.disjoint}{const t=this.getQueryTimerExtensionWebGL1(),n=t.getQueryObjectEXT(e,t.QUERY_RESULT_AVAILABLE_EXT);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(t.GPU_DISJOINT_EXT)),n&&!this.disjoint}}pollFence(e){return new Promise(t=>{this.addItemToPoll(()=>e.isFencePassed(),()=>t())})}pollItems(){const e=function(e){let t=0;for(;t<e.length;++t){if(!e[t]())break}return t-1}(this.itemsToPoll.map(e=>e.isDoneFn));for(let t=0;t<=e;++t){const{resolveFn:e}=this.itemsToPoll[t];e()}this.itemsToPoll=this.itemsToPoll.slice(e+1)}addItemToPoll(e,t){if(this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1)return;let n;"setTimeoutCustom"in Yw().platform&&(n=Yw().platform.setTimeoutCustom.bind(Yw().platform)),Sw(()=>(this.pollItems(),0===this.itemsToPoll.length),()=>0,null,n)}bindTextureToFrameBuffer(e){this.throwIfDisposed(),fY(this.gl,e,this.framebuffer),this.debug&&mY(this.gl)}unbindTextureToFrameBuffer(){null!=this.outputTexture?(fY(this.gl,this.outputTexture,this.framebuffer),this.debug&&mY(this.gl)):pY(this.gl,this.framebuffer)}downloadMatrixDriver(e,t){this.bindTextureToFrameBuffer(e);const n=t();return this.unbindTextureToFrameBuffer(),n}setOutputMatrixTextureDriver(e,t,n){this.throwIfDisposed();const r=this.gl;fY(r,e,this.framebuffer),this.debug&&mY(r),this.outputTexture=e,iY(r,()=>r.viewport(0,0,t,n)),iY(r,()=>r.scissor(0,0,t,n))}setOutputMatrixWriteRegionDriver(e,t,n,r){this.throwIfDisposed(),iY(this.gl,()=>this.gl.scissor(e,t,n,r))}throwIfDisposed(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}throwIfNoProgram(){if(null==this.program)throw new Error("No GPU program is currently set.")}}const{mx:y$,XI:x$,Nk:w$,f6:k$,ct:S$,YG:N$,hH:C$,z3:E$,sG:I$,uM:T$,vS:_$,qB:A$,GG:R$,rq:F$,lg:D$,WR:O$,cu:L$,GE:P$,px:M$,jC:j$,He:B$,hE:z$,BF:U$,Dk:W$,cl:V$,_B:H$,ub:G$,_f:q$,Ku:K$,qy:X$,Zy:Y$,bu:$$,zv:J$,dH:Q$,HS:Z$,yH:eJ,l3:tJ,z9:nJ,x6:rJ,_m:aJ,eW:iJ,GK:oJ,SP:sJ,yr:cJ,dl:lJ,Dw:uJ,xT:hJ,_X:dJ,wz:fJ}=i;function pJ(e,t){return["x","y","z","w","u","v"].slice(0,t).map(t=>"".concat(e,".").concat(t))}function mJ(e,t){return 1===t?[e]:pJ(e,t)}class gJ{constructor(e){if(this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.enableShapeUniforms=e$(this.outputShape.length),0===this.rank)this.userCode="\n        void main() {\n          setOutput(vec4(getA(), 0., 0., 0.));\n        }\n      ";else{const e=mJ("rc",this.rank),t=KY(this.rank),n=this.getOutOfBoundsCondition(e),r=this.getSetup(e),a=this.getOutput(e);this.userCode="\n        void main() {\n          ".concat(t," rc = getOutputCoords();\n\n          if(").concat(n,") {\n            setOutput(vec4(0));\n          } else {\n            ").concat(r,"\n\n            setOutput(vec4(").concat(a,"));\n          }\n        }\n      ")}}getSourceCoordsArr(e){const t=[];for(let n=0;n<=1;n++)for(let r=0;r<=1;r++){let a="".concat(0===n?"r":"rp1",", ").concat(0===r?"c":"cp1");for(let t=2;t<this.rank;t++)a="".concat(e[e.length-1-t],",")+a;t.push(a)}return t}getOutOfBoundsCondition(e){if(1===this.rank)return"rc > ".concat(this.enableShapeUniforms?"outShape":this.outputShape[0]);let t="";for(let n=this.rank-2;n<this.rank;n++)t+="".concat(e[n]," >= ").concat(this.enableShapeUniforms?"outShape[".concat(n,"]"):this.outputShape[n]),n<this.rank-1&&(t+="||");return t}getSetup(e){if(1===this.rank)return"";const t=e.slice(-2),n=this.enableShapeUniforms?"outShape[".concat(this.rank," - 1]"):this.outputShape[this.rank-1],r=this.enableShapeUniforms?"outShape[".concat(this.rank," - 2]"):this.outputShape[this.rank-2];return"\n      int r = ".concat(t[0],";\n      int c = ").concat(t[1],";\n      int rp1 = r + 1;\n      int cp1 = c + 1;\n\n      bool cEdge = cp1 >= ").concat(n,";\n      bool rEdge = rp1 >= ").concat(r,";\n    ")}getOutput(e){const t=this.getSourceCoordsArr(e);if(1===this.rank){const e=this.enableShapeUniforms?"outShape":this.outputShape[0];return"getA(rc), (rc + 1 >= ".concat(e," ? 0. : getA(rc + 1)), 0, 0")}return"getA(".concat(t[0],"),\n            cEdge ? 0. : getA(").concat(t[1],"),\n            rEdge ? 0. : getA(").concat(t[2],"),\n            rEdge || cEdge ? 0. : getA(").concat(t[3],")")}}class vJ{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=e,this.enableShapeUniforms=e$(this.outputShape.length);let n="";for(let r=0;r<4;r++){let e="thisRC = rc;";r%2===1&&(e+="thisRC.z += 1;"),r>1&&(e+="thisRC.y += 1;"),n+="\n        ".concat(e,"\n        ").concat(r>0?"if(thisRC.y < rows && thisRC.z < cols){":"","\n          int flatIndex = getFlatIndex(thisRC);\n\n          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);\n          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));\n\n          result[").concat(r,"] =\n            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);\n        ").concat(r>0?"}":"","\n      ")}this.userCode="\n      ".concat(function(e,t){const n=t?OY(["r","c","d"],"inputShape"):FY(["r","c","d"],e);return"\n    ivec3 inputCoordsFromReshapedOutCoords(int index) {\n      ".concat(n,"\n      return ivec3(r, c, d);\n    }\n  ")}(t,this.enableShapeUniforms),"\n      ").concat(this.enableShapeUniforms?"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;\n  }\n":LY(e),"\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0.);\n\n        ivec3 thisRC;\n        int rows = ").concat(this.enableShapeUniforms?"outShape[1]":e[1],";\n        int cols = ").concat(this.enableShapeUniforms?"outShape[2]":e[2],";\n\n        ").concat(n,"\n\n        setOutput(result);\n      }\n    ")}}class bJ{constructor(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.usedTextures={},this.logEnabled=!1}acquireTexture(e,t,n){const r=xJ(t,n),a=wJ(e,r,n);a in this.freeTextures||(this.freeTextures[a]=[]),a in this.usedTextures||(this.usedTextures[a]=[]);const i=yJ(e,r,this.gpgpu.gl,this.gpgpu.textureConfig,n);if(this.freeTextures[a].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=i,this.log();const e=this.freeTextures[a].pop();return this.usedTextures[a].push(e),e}let o;return r===eY.PACKED_2X2_FLOAT32?o=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):r===eY.PACKED_2X2_FLOAT16?o=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):r===eY.UNPACKED_FLOAT32?o=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):r===eY.UNPACKED_FLOAT16?o=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):r===eY.PACKED_4X1_UNSIGNED_BYTE&&(o=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[a].push(o),this.numUsedTextures++,this._numBytesAllocated+=i,this.log(),o}releaseTexture(e,t,n,r){if(null==this.freeTextures)return;const a=xJ(n,r),i=wJ(t,a,r);i in this.freeTextures||(this.freeTextures[i]=[]);const o=yJ(t,a,this.gpgpu.gl,this.gpgpu.textureConfig,r),s=Yw().getNumber("WEBGL_DELETE_TEXTURE_THRESHOLD");-1!==s&&this._numBytesAllocated>s?(this.gpgpu.deleteMatrixTexture(e.texture),this._numBytesAllocated-=o):(this.freeTextures[i].push(e),this.numFreeTextures++,this._numBytesFree+=o),this.numUsedTextures--;const c=this.usedTextures[i],l=c&&c.indexOf(e);if(null==l||l<0)throw new Error("Cannot release a texture that was never provided by this texture manager");c[l]=c[c.length-1],c.pop(),this.log()}log(){if(!this.logEnabled)return;const e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used","".concat(this.numFreeTextures," / ").concat(this.numUsedTextures),"(".concat(e,")"));const t=this._numBytesFree/this._numBytesAllocated;console.log("Bytes allocated: ".concat(this._numBytesAllocated)),console.log("Bytes unused: ".concat(this._numBytesFree," (").concat(Math.round(100*t),"%)"))}get numBytesAllocated(){return this._numBytesAllocated}get numBytesFree(){return this._numBytesFree}getNumUsedTextures(){return this.numUsedTextures}getNumFreeTextures(){return this.numFreeTextures}dispose(){if(null!=this.freeTextures){for(const e in this.freeTextures)this.freeTextures[e].forEach(e=>{this.gpgpu.deleteMatrixTexture(e.texture)});for(const e in this.usedTextures)this.usedTextures[e].forEach(e=>{this.gpgpu.deleteMatrixTexture(e.texture)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}}function yJ(e,t,n,r,a){const i=function(e,t){switch(e){case eY.PACKED_2X2_FLOAT32:return m$(t);case eY.PACKED_2X2_FLOAT16:return g$(t);case eY.UNPACKED_FLOAT32:return d$(t);case eY.UNPACKED_FLOAT16:return f$(t);case eY.PACKED_4X1_UNSIGNED_BYTE:return p$(t);default:throw new Error("Unknown physical texture type ".concat(e))}}(t,r);let o;if(a){const[t,n]=rY(e[0],e[1]);o=t*n}else{const[t,n]=tY(e[0],e[1]);o=t*n}const s=function(e,t){const n=e;if(t===n.R32F)return 4;if(t===n.R16F)return 2;if(t===n.RGBA32F)return 16;if(t===e.RGBA)return 16;if(t===n.RGBA16F)return 8;if(t===n.RGBA8)return 4;throw new Error("Unknown internal format ".concat(t))}(n,i);return o*s}function xJ(e,t){if(e===ZX.UPLOAD)return eY.PACKED_2X2_FLOAT32;if(e===ZX.RENDER||null==e)return function(e){return Yw().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?e?eY.PACKED_2X2_FLOAT32:eY.UNPACKED_FLOAT32:e?eY.PACKED_2X2_FLOAT16:eY.UNPACKED_FLOAT16}(t);if(e===ZX.DOWNLOAD||e===ZX.PIXELS)return eY.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type ".concat(e))}function wJ(e,t,n){return"".concat(e[0],"_").concat(e[1],"_").concat(t,"_").concat(n)}class kJ{constructor(e,t){this.variableNames=["A"],this.outputShape=e,this.enableShapeUniforms=e$(this.outputShape.length),this.userCode="\n      float unaryOperation(float x) {\n        ".concat(t,"\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        float y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    ")}}const SJ="if (isnan(x)) return x;",NJ="return abs(x);";const CJ=SJ+"\n  return (x < 0.0) ? 0.0 : x;\n",EJ=SJ+"\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",IJ="return x;";class TJ{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.enableShapeUniforms=e$(this.outputShape.length),this.userCode="\n      vec4 unaryOperation(vec4 x) {\n        ".concat(t,"\n      }\n\n      void main() {\n        vec4 x = getAAtOutCoords();\n        vec4 y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    ")}}class _J{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=e,this.enableShapeUniforms=e$(this.outputShape.length);const t=e.length,n=mJ("rc",t),r=KY(t),a=function(e,t){if(1===e)return"rc";let n="";for(let r=0;r<e;r++)n+=t[r],r<e-1&&(n+=",");return n}(t,n),i=n.slice(-2),o=t<=1?"rc":"vec2(".concat(i.join(","),")");this.userCode="\n      void main() {\n        ".concat(r," rc = getOutputCoords();\n        vec4 packedInput = getA(").concat(a,");\n\n        setOutput(getChannel(packedInput, ").concat(o,"));\n      }\n    ")}}const AJ=eD,RJ={};const FJ=Yw().getNumber("CPU_HANDOFF_SIZE_THRESHOLD");class DJ extends lw{nextDataId(){return DJ.nextDataId++}constructor(e){if(super(),this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.lastGlFlushTime=0,this.warnedAboutMemory=!1,this.pendingDeletes=0,this.disposed=!1,!Yw().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");let t;if(null!=e){if(e instanceof b$)t=e;else{const n=JX(Yw().getNumber("WEBGL_VERSION"),e);t=new b$(n)}this.binaryCache={},this.gpgpuCreatedLocally=!1}else{const e=JX(Yw().getNumber("WEBGL_VERSION"));t=new b$(e),this.binaryCache=((n=Yw().getNumber("WEBGL_VERSION"))in RJ||(RJ[n]={}),RJ[n]),this.gpgpuCreatedLocally=!0}var n;this.gpgpu=t,this.canvas=this.gpgpu.gl.canvas,this.textureManager=new bJ(this.gpgpu),this.numMBBeforeWarning=null==Yw().global.screen?1024:Yw().global.screen.height*Yw().global.screen.width*window.devicePixelRatio*600/1024/1024,this.texData=new cw(this,jE())}numDataIds(){return this.texData.numDataIds()-this.pendingDeletes}writeTexture(e,t,n,r,a,i){const o=this.makeTensorInfo(t,n),s=this.texData.get(o.dataId);s.isPacked=!1,s.texture={texture:e,texShape:[r,a]},s.texShape=[r,a];const c=xY(t),l=new o$(c,!1,i),u=this.runWebGLProgram(l,[o],n,[[r,a]]);return u.shape=t,s.texture=null,this.disposeIntermediateTensorInfo(o),u.dataId}write(e,t,n){if((Yw().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||Yw().getBool("DEBUG"))&&this.checkNumericalProblems(e),"complex64"===n&&null!=e)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");const r={id:this.nextDataId()};return this.texData.set(r,{shape:t,dtype:n,values:e,usage:ZX.UPLOAD,refCount:1}),r}refCount(e){if(this.texData.has(e)){return this.texData.get(e).refCount}return 0}incRef(e){this.texData.get(e).refCount++}decRef(e){if(this.texData.has(e)){this.texData.get(e).refCount--}}move(e,t,n,r,a){if(Yw().getBool("DEBUG")&&this.checkNumericalProblems(t),"complex64"===r)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:n,dtype:r,values:t,usage:ZX.UPLOAD,refCount:a})}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}readSync(e){const t=this.texData.get(e),{values:n,dtype:r,complexTensorInfos:a,slice:i,shape:o,isPacked:s}=t;if(null!=i){let t;t=s?new TJ(o,IJ):new kJ(o,IJ);const n=this.runWebGLProgram(t,[{dataId:e,shape:o,dtype:r}],r),a=this.readSync(n.dataId);return this.disposeIntermediateTensorInfo(n),a}if(null!=n)return this.convertAndCacheOnCPU(e);if("string"===r)return n;const c=null!=this.activeTimers;let l,u;if(c&&(l=jC()),"complex64"===r){u=bF(this.readSync(a.real.dataId),this.readSync(a.imag.dataId))}else u=this.getValuesFromTexture(e);return c&&(this.downloadWaitMs+=jC()-l),this.convertAndCacheOnCPU(e,u)}async read(e){if(this.pendingRead.has(e)){const t=this.pendingRead.get(e);return new Promise(e=>t.push(e))}const t=this.texData.get(e),{values:n,shape:r,slice:a,dtype:i,complexTensorInfos:o,isPacked:s}=t;if(null!=a){let t;t=s?new TJ(r,IJ):new kJ(r,IJ);const n=this.runWebGLProgram(t,[{dataId:e,shape:r,dtype:i}],i),a=this.read(n.dataId);return this.disposeIntermediateTensorInfo(n),a}if(null!=n)return this.convertAndCacheOnCPU(e);if(Yw().getBool("DEBUG")&&!Yw().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&2===Yw().getNumber("WEBGL_VERSION"))throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");let c,l,u=null;if("complex64"!==i&&Yw().get("WEBGL_BUFFER_SUPPORTED")){c=this.decode(e);const t=this.texData.get(c.dataId);u=this.gpgpu.createBufferFromTexture(t.texture.texture,...nY(r))}if(this.pendingRead.set(e,[]),"complex64"!==i&&await this.gpgpu.createAndWaitForFence(),"complex64"===i){const e=await Promise.all([this.read(o.real.dataId),this.read(o.imag.dataId)]);l=bF(e[0],e[1])}else if(null==u)l=this.getValuesFromTexture(e);else{const e=bw(r);l=this.gpgpu.downloadFloat32MatrixFromBuffer(u,e)}if(null!=c&&this.disposeIntermediateTensorInfo(c),null!=u){const e=this.gpgpu.gl;iY(e,()=>e.deleteBuffer(u))}const h=this.convertAndCacheOnCPU(e,l),d=this.pendingRead.get(e);return this.pendingRead.delete(e),d.forEach(e=>e(h)),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e)&&jE().removeDataId(e,this),this.pendingDeletes--),h}readToGPU(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=this.texData.get(e),{values:r,shape:a,slice:i,dtype:o,isPacked:s,texture:c}=n;if("complex64"===o)throw new Error("Does not support reading texture for complex64 dtype.");if(null!=i){let n;n=s?new TJ(a,IJ):new kJ(a,IJ);const r=this.runWebGLProgram(n,[{dataId:e,shape:a,dtype:o}],o),i=this.readToGPU(r,t);return this.disposeIntermediateTensorInfo(r),i}if(null==c)throw null!=r?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");const l=this.decode(e,t.customTexShape),u=jE().makeTensorFromTensorInfo(l),h=this.texData.get(l.dataId);return Object.assign({tensorRef:u},h.texture)}bufferSync(e){const t=this.readSync(e.dataId);if("string"===e.dtype)try{const n=t.map(e=>zC(e));return II(e.shape,e.dtype,n)}catch(hu){throw new Error("Failed to decode encoded string bytes into utf-8")}return II(e.shape,e.dtype,t)}checkNumericalProblems(e){if(null!=e)for(let t=0;t<e.length;t++){const n=e[t];if(!oY(n)){if(Yw().getBool("WEBGL_RENDER_FLOAT32_CAPABLE"))throw Error("The value ".concat(n," cannot be represented with your ")+"current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'");throw Error("The value ".concat(n," cannot be represented on this device."))}}}getValuesFromTexture(e){const{shape:t,dtype:n,isPacked:r}=this.texData.get(e),a=bw(t);if(Yw().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){const n=this.decode(e),r=this.texData.get(n.dataId),i=this.gpgpu.downloadMatrixFromPackedTexture(r.texture.texture,...nY(t)).subarray(0,a);return this.disposeIntermediateTensorInfo(n),i}const i=Yw().getBool("WEBGL_PACK")&&!0===r,o=i?xY(t):t,s=i?new a$(o):new r$(o),c=this.runWebGLProgram(s,[{shape:o,dtype:n,dataId:e}],"float32"),l=this.texData.get(c.dataId),u=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(l.texture.texture,l.texShape[0],l.texShape[1]).subarray(0,a);return this.disposeIntermediateTensorInfo(c),u}timerAvailable(){return Yw().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}time(e){const t=this.activeTimers,n=[];let r=!1;null==this.programTimersStack?(this.programTimersStack=n,r=!0):this.activeTimers.push(n),this.activeTimers=n,e();const a=WC(this.activeTimers.map(e=>e.query)).filter(e=>null!=e),i=WC(this.activeTimers.map(e=>e.name)).filter(e=>null!=e);this.activeTimers=t,r&&(this.programTimersStack=null);const o={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return(async()=>{if(Yw().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0){const e=await Promise.all(a);o.kernelMs=function(e){let t=0;for(let n=0;n<e.length;n++)t+=e[n];return t}(e),o.getExtraProfileInfo=()=>e.map((e,t)=>({name:i[t],ms:e})).map(e=>"".concat(e.name,": ").concat(e.ms)).join(", ")}else o.kernelMs={error:"WebGL query timers are not supported in this environment."};return this.uploadWaitMs=0,this.downloadWaitMs=0,o})()}memory(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}startTimer(){return Yw().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:jC(),endMs:null}}endTimer(e){return Yw().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=jC(),e)}async getQueryTime(e){if(Yw().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)return this.gpgpu.waitForQueryAndGetTime(e);const t=e;return t.endMs-t.startMs}disposeData(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.pendingDisposal.has(e))return!1;if(!this.texData.has(e))return!0;if(t?this.texData.get(e).refCount=0:this.texData.get(e).refCount--,!t&&this.texData.get(e).refCount>0)return!1;if(this.pendingRead.has(e))return this.pendingDisposal.add(e),this.pendingDeletes++,!1;this.releaseGPUData(e);const{complexTensorInfos:n}=this.texData.get(e);return null!=n&&(this.disposeData(n.real.dataId,t),this.disposeData(n.imag.dataId,t)),this.texData.delete(e),!0}releaseGPUData(e){const{texture:t,dtype:n,texShape:r,usage:a,isPacked:i,slice:o}=this.texData.get(e),s=o&&o.origDataId||e,c=this.dataRefCount.get(s);c>1?this.dataRefCount.set(s,c-1):(this.dataRefCount.delete(s),null!=t&&(this.numBytesInGPU-=this.computeBytes(r,n),this.textureManager.releaseTexture(t,r,a,i)));const l=this.texData.get(e);l.texture=null,l.texShape=null,l.isPacked=!1,l.slice=null}getTexture(e){return this.uploadToGPU(e),this.texData.get(e).texture.texture}getDataInfo(e){return this.texData.get(e)}shouldExecuteOnCPU(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:FJ;return Yw().getBool("WEBGL_CPU_FORWARD")&&e.every(e=>null==this.texData.get(e.dataId).texture&&bw(e.shape)<t)}getGPGPUContext(){return this.gpgpu}where(e){hC("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");const t=e.dataSync();return AJ(e.shape,t)}packedUnaryOp(e,t,n){const r=new TJ(e.shape,t),a=this.compileAndRun(r,[e],n);return jE().makeTensorFromTensorInfo(a)}abs(e){if(this.shouldExecuteOnCPU([e])&&"complex64"!==e.dtype){const t=Q$(this.texData.get(e.dataId).values);return this.makeOutput(e.shape,e.dtype,t)}if(Yw().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,NJ,e.dtype);const t=new kJ(e.shape,NJ),n=this.compileAndRun(t,[e]);return jE().makeTensorFromTensorInfo(n)}makeTensorInfo(e,t,n){let r;if("string"===t&&null!=n&&n.length>0&&Rw(n[0])){const a=n.map(e=>BC(e));r=this.write(a,e,t)}else r=this.write(n,e,t);return this.texData.get(r).usage=null,{dataId:r,shape:e,dtype:t}}makeOutput(e,t,n){return jE().makeTensorFromTensorInfo(this.makeTensorInfo(e,t,n),this)}unpackTensor(e){const t=new _J(e.shape);return this.runWebGLProgram(t,[e],e.dtype)}packTensor(e){const t=new gJ(e.shape);return this.runWebGLProgram(t,[e],e.dtype,null,!0)}packedReshape(e,t){const n=[bY(e.shape),...yY(e.shape)],r={dtype:e.dtype,shape:n,dataId:e.dataId},a=[bY(t),...yY(t)],i=new vJ(a,n),o=[n],s=this.runWebGLProgram(i,[r],e.dtype,o,!0);return{dataId:s.dataId,shape:t,dtype:s.dtype}}decode(e,t){const n=this.texData.get(e),{isPacked:r,shape:a,dtype:i}=n;if(null!=t){mw(bw(a)<=t[0]*t[1]*4,()=>"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data.")}const o=xY(a);let s;s=r?new n$(o):new t$(o);const c=[null!=t?t:nY(o)];return{dtype:i,shape:a,dataId:this.runWebGLProgram(s,[{shape:o,dtype:i,dataId:e}],i,c,!0,t).dataId}}runWebGLProgram(e,t,n,r){let a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=arguments.length>5?arguments[5]:void 0;const o=this.makeTensorInfo(e.outputShape,n),s=this.texData.get(o.dataId);if(e.packedOutput&&(s.isPacked=!0),e.outPackingScheme===QX.DENSE){const t=null!=i?i:nY(e.outputShape);s.texShape=t.map(e=>2*e)}if(null!=e.outTexUsage&&(s.usage=e.outTexUsage),0===bw(o.shape))return s.values=Iw(o.dtype,0),o;const c=[],l=t.map(t=>{if("complex64"===t.dtype)throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");let n=this.texData.get(t.dataId);if(null==n.texture){if(!e.packedInputs&&bw(t.shape)<=Yw().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:t.shape,texData:null,isUniform:!0,uniformValues:n.values};e.packedInputs&&(n.isPacked=!0,n.shape=t.shape)}if(this.uploadToGPU(t.dataId),!!n.isPacked!==!!e.packedInputs)t=n.isPacked?this.unpackTensor(t):this.packTensor(t),c.push(t),n=this.texData.get(t.dataId);else if(n.isPacked&&!kY(n.shape,t.shape)){const e=t,r=t.shape;t.shape=n.shape,t=this.packedReshape(t,r),c.push(t),n=this.texData.get(t.dataId),e.shape=r}return{shape:t.shape,texData:n,isUniform:!1}});this.uploadToGPU(o.dataId);const u={shape:o.shape,texData:s,isUniform:!1},h=function(e,t,n){let r="";t.concat(n).forEach(t=>{const a=null!=t.texData&&null!=t.texData.slice&&t.texData.slice.flatOffset>0;if(e.enableShapeUniforms&&!t.isUniform){const i=t.texData.texShape,{useSqueezeShape:o,uniformShape:s,keptDims:c}=XY(e.packedInputs,t.shape,i);let l="",u="",h="";if(1===s.length&&e.packedInputs){const e=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];l="".concat(e[0]>1,"_").concat(e[1]>1)}else if(2!==s.length||e.packedInputs){if(s.length>2&&!e.packedInputs){const e=Pw(s);h="".concat(e[0]===i[1],"_").concat(e[e.length-1]===i[1])}}else u="".concat(s[0]>1,"_").concat(s[1]>1);const d=t.shape.length,f=2===s.length&&yw(t.shape,i),p=1===bw(t.shape),m=ZI(t.shape,n.shape),g=!e.packedInputs&&d===n.shape.length&&yw(i,n.texData.texShape),v=e.packedInputs||s.length>2?"":"".concat(i[0]>1,"_").concat(i[1]>1);r+="".concat(d,"_").concat(g,"_").concat(o?c:"","_").concat(s.length,"_").concat(p,"_").concat(m,"_").concat(f,"_").concat(l,"_").concat(u,"_").concat(h,"_").concat(v,"_").concat(a)}else{const e=t.isUniform?"uniform":t.texData.texShape;r+="".concat(t.shape,"_").concat(e,"_").concat(a)}});const a=e.userCode;let i=e.constructor.name;return i+="_"+r+"_"+a+"".concat(Yw().getNumber("WEBGL_VERSION")),i}(e,l,u),d=this.getAndSaveBinary(h,()=>JY(this.gpgpu,e,l,u)),f=null!=this.activeTimers;let p;f&&(p=this.startTimer()),Yw().get("ENGINE_COMPILE_ONLY")||function(e,t,n,r,a){t.program.enableShapeUniforms||(ZY(t.inShapeInfos,n),ZY([t.outShapeInfo],[r]));const i=r.texData.texture,o=r.texData.texShape;r.texData.isPacked?e.setOutputPackedMatrixTexture(i.texture,o[0],o[1]):e.setOutputMatrixTexture(i.texture,o[0],o[1]),e.setProgram(t.webGLProgram),e.bindVertexArray(t.webGLProgram.vao),1===Yw().getNumber("WEBGL_VERSION")&&null!==t.infLoc&&e.gl.uniform1f(t.infLoc,1/0),null!==t.nanLoc&&e.gl.uniform1f(t.nanLoc,NaN);for(let c=0;c<n.length;++c){const r=n[c],{uniform:a,offset:i,shape:o,texShape:s}=t.variablesLocations[c];if(o){const{uniformShape:n}=XY(t.program.packedInputs,r.shape,r.texData.texShape);switch(n.length){case 1:e.gl.uniform1iv(o,new Int32Array(n));break;case 2:e.gl.uniform2iv(o,new Int32Array(n));break;case 3:e.gl.uniform3iv(o,new Int32Array(n));break;case 4:e.gl.uniform4iv(o,new Int32Array(n))}}if(s&&e.gl.uniform2i(s,r.texData.texShape[0],r.texData.texShape[1]),null!=a)if(r.isUniform)if(bw(r.shape)<2)e.gl.uniform1f(a,r.uniformValues[0]);else{let t=r.uniformValues;t instanceof Float32Array||(t=new Float32Array(t)),e.gl.uniform1fv(a,t)}else null!=r.texData.slice&&null!=i&&e.gl.uniform1i(i,r.texData.slice.flatOffset),e.setInputMatrixTexture(r.texData.texture.texture,a,c)}const s=t.outShapeLocation;if(s)switch(r.shape.length){case 1:e.gl.uniform1iv(s,new Int32Array(r.shape));break;case 2:e.gl.uniform2iv(s,new Int32Array(r.shape));break;case 3:e.gl.uniform3iv(s,new Int32Array(r.shape));break;case 4:e.gl.uniform4iv(s,new Int32Array(r.shape))}if(t.outShapeStridesLocation){const n=Pw(r.shape);switch(r.shape.length){case 2:e.gl.uniform1iv(t.outShapeStridesLocation,new Int32Array(n));break;case 3:e.gl.uniform2iv(t.outShapeStridesLocation,new Int32Array(n));break;case 4:e.gl.uniform3iv(t.outShapeStridesLocation,new Int32Array(n))}}if(t.outTexShapeLocation&&e.gl.uniform2i(t.outTexShapeLocation,r.texData.texShape[0],r.texData.texShape[1]),t.program.customUniforms&&a)for(let c=0;c<t.program.customUniforms.length;++c){const n=t.program.customUniforms[c],r=t.customUniformLocations[c],i=a[c];if("float"===n.type)e.gl.uniform1fv(r,i);else if("vec2"===n.type)e.gl.uniform2fv(r,i);else if("vec3"===n.type)e.gl.uniform3fv(r,i);else if("vec4"===n.type)e.gl.uniform4fv(r,i);else if("int"===n.type)e.gl.uniform1iv(r,i);else if("ivec2"===n.type)e.gl.uniform2iv(r,i);else if("ivec3"===n.type)e.gl.uniform3iv(r,i);else{if("ivec4"!==n.type)throw Error("uniform type ".concat(n.type," is not supported yet."));e.gl.uniform4iv(r,i)}}e.executeProgram()}(this.gpgpu,d,l,u,r),c.forEach(e=>this.disposeIntermediateTensorInfo(e)),f&&(p=this.endTimer(p),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(p)}));const m=Yw().getNumber("WEBGL_FLUSH_THRESHOLD");if(m>0){const e=jC();e-this.lastGlFlushTime>m&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=e)}if(!Yw().getBool("WEBGL_LAZILY_UNPACK")&&s.isPacked&&!1===a){const e=this.unpackTensor(o);return this.disposeIntermediateTensorInfo(o),e}return o}compileAndRun(e,t,n,r){let a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];n=n||t[0].dtype;return this.runWebGLProgram(e,t,n,r,a)}getAndSaveBinary(e,t){return e in this.binaryCache||(this.binaryCache[e]=t()),this.binaryCache[e]}getTextureManager(){return this.textureManager}dispose(){if(!this.disposed){if(!Yw().getBool("IS_TEST")){Object.keys(this.binaryCache).forEach(e=>{this.gpgpu.deleteProgram(this.binaryCache[e].webGLProgram),delete this.binaryCache[e]})}this.textureManager.dispose(),null!=this.canvas&&"undefined"!==typeof HTMLCanvasElement&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0}}floatPrecision(){return null==this.floatPrecisionValue&&(this.floatPrecisionValue=zE(()=>{if(!Yw().get("WEBGL_RENDER_FLOAT32_ENABLED")){const e=Yw().getBool("DEBUG");Yw().set("DEBUG",!1);const t=this.abs(BI(1e-8)).dataSync()[0];if(Yw().set("DEBUG",e),t>0)return 32}return 16})),this.floatPrecisionValue}epsilon(){return 32===this.floatPrecision()?1e-7:1e-4}uploadToGPU(e){const t=this.texData.get(e),{shape:n,dtype:r,values:a,texture:i,usage:o,isPacked:s}=t;if(null!=i)return;const c=null!=this.activeTimers;let l;c&&(l=jC());let u=t.texShape;if(null==u&&(u=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=Yw().getNumber("WEBGL_MAX_TEXTURE_SIZE"),r=Yw().getNumber("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE");if(r===1/0&&Yw().getBool("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE")&&(r=n/2),t&&(n*=2,r*=2,e=e.map((t,n)=>n>=e.length-2?fw(e[n]):e[n]),1===e.length&&(e=[2,e[0]])),2!==e.length){const t=Ew(e);e=t.newShape}let a=bw(e),i=null;e.length<=1&&a<=n?i=[1,a]:2===e.length&&e[0]<=n&&e[1]<=n?i=e:3===e.length&&e[0]*e[1]<=n&&e[2]<=n?i=[e[0]*e[1],e[2]]:3===e.length&&e[0]<=n&&e[1]*e[2]<=n?i=[e[0],e[1]*e[2]]:4===e.length&&e[0]*e[1]*e[2]<=n&&e[3]<=n?i=[e[0]*e[1]*e[2],e[3]]:4===e.length&&e[0]<=n&&e[1]*e[2]*e[3]<=n&&(i=[e[0],e[1]*e[2]*e[3]]);const o=null!=i&&Math.max(...i)>r&&Math.min(...i)<=(t?2:1)&&Math.min(...i)>0;if(null==i||o)if(t){const t=bY(e);let n=2,r=2;e.length&&([n,r]=yY(e)),a=t*(n/2)*(r/2),i=ww(a).map(e=>2*e)}else i=ww(a);return i}(n,s),t.texShape=u),null!=a){const e=xY(n);let i,o=u[1],h=u[0];const d=a instanceof Uint8Array||a instanceof Uint8ClampedArray;!s&&d||([o,h]=rY(u[0],u[1])),i=s?new s$(e,d):new o$(e,d);const f=d?[h,o]:u,p=this.makeTensorInfo(f,r),m=this.texData.get(p.dataId);m.usage=d?ZX.PIXELS:ZX.UPLOAD,m.texShape=f,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(p.dataId),o,h,a);const g=[[h,o]],v=!0,b=this.runWebGLProgram(i,[p],r,g,v),y=this.texData.get(b.dataId);t.texShape=y.texShape,t.isPacked=y.isPacked,t.usage=y.usage,Yw().get("ENGINE_COMPILE_ONLY")?this.disposeData(b.dataId):(t.texture=y.texture,t.values=null,this.texData.delete(b.dataId)),this.disposeIntermediateTensorInfo(p),c&&(this.uploadWaitMs+=jC()-l)}else{const e=this.acquireTexture(u,o,r,s);t.texture=e}}convertAndCacheOnCPU(e,t){const n=this.texData.get(e),{dtype:r}=n;return null!=t&&(n.values=function(e,t){if("float32"===t||"complex64"===t)return e;if("int32"===t||"bool"===t){const n="int32"===t?new Int32Array(e.length):new Uint8Array(e.length);for(let t=0;t<n.length;++t)n[t]=Math.round(e[t]);return n}throw new Error("Unknown dtype ".concat(t))}(t,r)),n.values}acquireTexture(e,t,n,r){if(this.numBytesInGPU+=this.computeBytes(e,n),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){const e=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: ".concat(e," MB, ")+"most likely due to a memory leak")}return this.textureManager.acquireTexture(e,t,r)}computeBytes(e,t){return e[0]*e[1]*Aw(t)}checkCompileCompletion(){for(const[,e]of Object.entries(this.binaryCache))this.checkCompletion_(e)}async checkCompileCompletionAsync(){const e=[];if(this.gpgpu.parallelCompilationExtension){for(const[,t]of Object.entries(this.binaryCache))e.push(this.checkCompletionAsync_(t));return Promise.all(e)}for(const[,t]of Object.entries(this.binaryCache)){const n=new Promise(e=>{try{this.checkCompletion_(t),e(!0)}catch(n){throw n}});e.push(n)}return Promise.all(e)}async checkCompletionAsync_(e){return this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)?this.checkCompletion_(e):(await HR(),this.checkCompletionAsync_(e))}checkCompletion_(e){if(!1===this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.gl.LINK_STATUS)){if(console.log(this.gpgpu.gl.getProgramInfoLog(e.webGLProgram)),!1===this.gpgpu.gl.getShaderParameter(e.fragmentShader,this.gpgpu.gl.COMPILE_STATUS))throw lY(e.source,this.gpgpu.gl.getShaderInfoLog(e.fragmentShader)),new Error("Failed to compile fragment shader.");throw new Error("Failed to link vertex and fragment shaders.")}return!0}getUniformLocations(){for(const e of Object.values(this.binaryCache)){this.gpgpu.buildVao(e.webGLProgram);const{variablesLocations:t,customUniformLocations:n,infLoc:r,nanLoc:a,outShapeLocation:i,outShapeStridesLocation:o,outTexShapeLocation:s}=QY(this.gpgpu,e.program,e.webGLProgram);e.variablesLocations=t,e.customUniformLocations=n,e.infLoc=r,e.nanLoc=a,e.outShapeLocation=i,e.outShapeStridesLocation=o,e.outTexShapeLocation=s}}createTensorFromGPUData(e,t,n){e.channels=e.channels||"RGBA";const{texture:r,height:a,width:i,channels:o}=e,s=jE().backend;if(!s.gpgpu.gl.isTexture(r))throw new Error("The texture is invalid. Also, please make sure the texture and the TFJS WebGL backend are using the same canvas. If you want to use your own custom canvas, you have to create and use the custom TFJS WebGL backend created from the canvas through 'new tf.MathBackendWebGL(customCanvas)'.");const c=s.writeTexture(r,t,n,a,i,o);return jE().makeTensorFromDataId(c,t,n,s)}}DJ.nextDataId=0;EE()&&VE("webgl",()=>new DJ,2);const OJ="\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n";class LJ{constructor(e,t,n){this.variableNames=["A","B"],this.outputShape=tT(t,n),this.enableShapeUniforms=e$(this.outputShape.length),this.userCode="\n      float binaryOperation(float a, float b) {\n        ".concat(e,"\n      }\n\n      void main() {\n        float a = getAAtOutCoords();\n        float b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    ")}}const PJ="\n  result.r = isNaN.r ? NAN : result.r;\n  result.g = isNaN.g ? NAN : result.g;\n  result.b = isNaN.b ? NAN : result.b;\n  result.a = isNaN.a ? NAN : result.a;\n";class MJ{constructor(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=tT(t,n);const a=this.outputShape.length;this.enableShapeUniforms=e$(a);let i="";if(r)if(0===a||1===bw(this.outputShape))i="\n          result.y = 0.;\n          result.z = 0.;\n          result.w = 0.;\n        ";else{const e=KY(a);if(i="\n          ".concat(e," coords = getOutputCoords();\n        "),1===a)this.enableShapeUniforms?i+="\n            result.y = (coords + 1) >= outShape ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          ":i+="\n            result.y = (coords + 1) >= ".concat(this.outputShape[0]," ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          ");else{const e=mJ("coords",a);this.enableShapeUniforms?i+="\n            bool nextRowOutOfBounds =\n              (".concat(e[a-2]," + 1) >= outShape[").concat(a," - 2];\n            bool nextColOutOfBounds =\n              (").concat(e[a-1]," + 1) >= outShape[").concat(a," - 1];\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          "):i+="\n            bool nextRowOutOfBounds =\n              (".concat(e[a-2]," + 1) >= ").concat(this.outputShape[a-2],";\n            bool nextColOutOfBounds =\n              (").concat(e[a-1]," + 1) >= ").concat(this.outputShape[a-1],";\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          ")}}this.userCode="\n      vec4 binaryOperation(vec4 a, vec4 b) {\n        ".concat(e,"\n      }\n\n      void main() {\n        vec4 a = getAAtOutCoords();\n        vec4 b = getBAtOutCoords();\n\n        vec4 result = binaryOperation(a, b);\n        ").concat(i,"\n\n        setOutput(result);\n      }\n    ")}}function jJ(e){const{inputs:t,backend:n}=e,{x:r}=t;return n.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}const BJ={kernelName:mS,backendName:"webgl",kernelFunc:jJ};function zJ(e){const{inputs:t,backend:n}=e,{real:r,imag:a}=t,i=n.makeTensorInfo(r.shape,"complex64"),o=n.texData.get(i.dataId),s=jJ({inputs:{x:r},backend:n}),c=jJ({inputs:{x:a},backend:n});return o.complexTensorInfos={real:s,imag:c},i}const UJ={kernelName:Ek,backendName:"webgl",kernelFunc:zJ},WJ="return (a < 0.) ? b * a : a;",VJ="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n";const HJ={kernelName:wS,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{alpha:i}=r,o=n.makeTensorInfo([],"float32",PC(i,"float32")),s=Yw().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new MJ(VJ,a.shape,o.shape):new LJ(WJ,a.shape,o.shape),c=n.runWebGLProgram(s,[a,o],"float32");return n.disposeIntermediateTensorInfo(o),c}},GJ="return (a < 0.) ? b * a : a;",qJ="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n";const KJ={kernelName:nN,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{x:r,alpha:a}=t,i=Yw().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new MJ(qJ,r.shape,a.shape):new LJ(GJ,r.shape,a.shape);return n.runWebGLProgram(i,[r,a],"float32")}},XJ="if (isnan(x)) return x;";function YJ(e){let{opSnippet:t,packedOpSnippet:n,cpuKernelImpl:r,dtype:a}=e;return e=>{let{inputs:i,backend:o}=e;const{x:s}=i,c=o,l=a||s.dtype;if(c.shouldExecuteOnCPU([s])&&null!=r){const e=c.texData.get(s.dataId),t=r(e.values,l);return c.makeTensorInfo(s.shape,l,t)}let u;return u=Yw().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&null!=n?new TJ(s.shape,n):new kJ(s.shape,t),c.runWebGLProgram(u,[s],l)}}function $J(e){let{opSnippet:t,packedOpSnippet:n,checkOutOfBounds:r=!1,supportsComplex:a=!1,cpuKernelImpl:i,dtype:o}=e;return e=>{let{inputs:s,backend:c}=e;const{a:l,b:u}=s,h=c;if(a&&"complex64"===l.dtype){const e=h.texData.get(l.dataId),n=h.texData.get(u.dataId),[r,a]=[[e.complexTensorInfos.real,n.complexTensorInfos.real],[e.complexTensorInfos.imag,n.complexTensorInfos.imag]].map(e=>{const[n,r]=e,a={dataId:n.dataId,dtype:n.dtype,shape:l.shape},i={dataId:r.dataId,dtype:r.dtype,shape:u.shape},o=new LJ(t,l.shape,u.shape);return h.runWebGLProgram(o,[a,i],uE(n.dtype,r.dtype))}),i=zJ({inputs:{real:r,imag:a},backend:h});return h.disposeIntermediateTensorInfo(r),h.disposeIntermediateTensorInfo(a),i}const d=o||uE(l.dtype,u.dtype);if(("string"===l.dtype||"string"===u.dtype||h.shouldExecuteOnCPU([l,u]))&&null!=i){const e=h.texData.get(l.dataId).values,t=h.texData.get(u.dataId).values,n="string"===l.dtype?QF(e):e,r="string"===l.dtype?QF(t):t,[a,o]=i(l.shape,u.shape,n,r,d),s=h.makeTensorInfo(o,d);return h.texData.get(s.dataId).values=a,s}let f;return f=Yw().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&null!=n?new MJ(n,l.shape,u.shape,r):new LJ(t,l.shape,u.shape),h.runWebGLProgram(f,[l,u],d)}}function JJ(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if("linear"===e)return"return x;";if("relu"===e)return t?"\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n":CJ;if("elu"===e)return t?"\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n":"return (x >= 0.0) ? x : (exp(x) - 1.0);";if("relu6"===e)return t?"\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n":EJ;if("prelu"===e)return t?qJ:GJ;if("leakyrelu"===e)return t?VJ:WJ;if("sigmoid"===e)return"return 1.0 / (1.0 + exp(-1.0 * x));";throw new Error("Activation ".concat(e," has not been implemented for the WebGL backend."))}class QJ{constructor(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,s=arguments.length>7&&void 0!==arguments[7]&&arguments[7],c=arguments.length>8&&void 0!==arguments[8]&&arguments[8];this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.enableShapeUniforms=e$(this.outputShape.length);const l=r?e[1]:e[2],u=Math.ceil(l/2),h=r?"i * 2, rc.y":"rc.y, i * 2",d=a?"rc.z, i * 2":"i * 2, rc.z",f=r?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],p=a?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"];let m="",g="";o&&(m=s?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          ".concat(o,"\n        }"):c?"vec4 activation(vec4 a) {\n          vec4 b = getLeakyreluAlphaAtOutCoords();\n          ".concat(o,"\n        }"):"vec4 activation(vec4 x) {\n          ".concat(o,"\n        }"),g="result = activation(result);");const v=i?"result += getBiasAtOutCoords();":"";i&&this.variableNames.push("bias"),s&&this.variableNames.push("preluActivationWeights"),c&&this.variableNames.push("leakyreluAlpha");let b="rc.x",y="rc.x";e[0]<t[0]?b="imod(rc.x, ".concat(e[0],")"):t[0]<e[0]&&(y="imod(rc.x, ".concat(t[0],")")),this.userCode="\n      ".concat(m,"\n      // Don't use uniform for sharedDimensionPacked for performance.\n      const float sharedDimension = ").concat(u,".0;\n\n      vec4 dot2x2ARowBCol(ivec3 rc) {\n        vec4 result = vec4(0);\n        int batchA = ").concat(b,";\n        int batchB = ").concat(y,";\n        for (int i = 0; i < ").concat(u,"; i++) {\n          vec4 a = getMatrixA(batchA, ").concat(h,");\n          vec4 b = getMatrixB(batchB, ").concat(d,");\n\n          // These swizzled products need to be separately added.\n          // See: https://github.com/tensorflow/tfjs/issues/1735\n          result += (").concat(f[0]," * ").concat(p[0],");\n          result += (").concat(f[1]," * ").concat(p[1],");\n        }\n        return result;\n      }\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n        vec4 result = dot2x2ARowBCol(rc);\n\n        ").concat(v,"\n\n        ").concat(g,"\n\n        setOutput(result);\n      }\n    ")}}const ZJ="return areal * breal - aimag * bimag;",eQ="return areal * bimag + aimag * breal;";class tQ{constructor(e,t,n){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=tT(t,n),this.userCode="\n      float binaryOpComplex(\n          float areal, float aimag, float breal, float bimag) {\n        ".concat(e,"\n      }\n\n      void main() {\n        float areal = getARealAtOutCoords();\n        float aimag = getAImagAtOutCoords();\n        float breal = getBRealAtOutCoords();\n        float bimag = getBImagAtOutCoords();\n        setOutput(binaryOpComplex(areal, aimag, breal, bimag));\n      }\n    ")}}const nQ="return a * b;";function rQ(e){const{inputs:t,backend:n}=e,{a:r,b:a}=t,i=uE(r.dtype,a.dtype);if("complex64"===r.dtype){const e=n.texData.get(r.dataId),t=n.texData.get(a.dataId),i=new tQ(ZJ,r.shape,a.shape),o=new tQ(eQ,r.shape,a.shape),s=[{dataId:e.complexTensorInfos.real.dataId,dtype:e.complexTensorInfos.real.dtype,shape:r.shape},{dataId:e.complexTensorInfos.imag.dataId,dtype:e.complexTensorInfos.imag.dtype,shape:r.shape},{dataId:t.complexTensorInfos.real.dataId,dtype:t.complexTensorInfos.real.dtype,shape:a.shape},{dataId:t.complexTensorInfos.imag.dataId,dtype:t.complexTensorInfos.imag.dtype,shape:a.shape}],c=n.runWebGLProgram(i,s,"float32"),l=n.runWebGLProgram(o,s,"float32"),u=zJ({inputs:{real:c,imag:l},backend:n});return n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(l),u}if(n.shouldExecuteOnCPU([r,a])){const e=n.texData.get(r.dataId),t=n.texData.get(a.dataId),[o,s]=U$(r.shape,a.shape,e.values,t.values,i),c=n.makeTensorInfo(s,i);return n.texData.get(c.dataId).values=o,c}let o;return o=Yw().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new MJ(nQ,r.shape,a.shape):new LJ(nQ,r.shape,a.shape),n.runWebGLProgram(o,[r,a],i)}const aQ={kernelName:GS,backendName:"webgl",kernelFunc:rQ};function iQ(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{shape:i}=r,o=n,s=bw(a.shape),c=Nw(i,s),l=bw(c);mw(s===l,()=>"The new shape (".concat(c,") has ").concat(l," elements and the old ")+"shape (".concat(a.shape,") has ").concat(s," elements. The new shape and old ")+"shape must have the same number of elements.");const u=o.texData.get(a.dataId);return!u.isPacked||kY(a.shape,c)||null!==u.texture&&kY(u.shape,c)?(o.incRef(a.dataId),{dataId:a.dataId,shape:c,dtype:a.dtype}):function(e,t,n){const r=[bY(e.shape),...yY(e.shape)],a={dtype:e.dtype,shape:r,dataId:e.dataId},i=[bY(t),...yY(t)],o=new vJ(i,r),s=[r],c=n.runWebGLProgram(o,[a],e.dtype,s,!0);return{dataId:c.dataId,shape:t,dtype:c.dtype}}(a,c,o)}const oQ={kernelName:hN,backendName:"webgl",kernelFunc:iQ};class sQ{constructor(e,t){this.variableNames=["x"];const{windowSize:n,batchSize:r,inSize:a,outSize:i}=e;this.outputShape=[r,i];const o=4*Math.floor(n/4),s=n%4;let c="sumValue += dot(values, ones);";if(null!=t){const e=1/t;c="sumValue += dot(values * ".concat(xw(e)?e.toPrecision(2):e,", ones);")}let l="";a%n>0&&(l="\n        if (inIdx < 0 || inIdx >= ".concat(a,") {\n          return 0.0;\n        }\n      ")),this.userCode="\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        ".concat(l,"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ").concat(n,";\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < ").concat(o,"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          ").concat(c,"\n        }\n\n        int inIdx = inOffset + ").concat(o,";\n        if (").concat(1===s,") {\n          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);\n\n          ").concat(c,"\n        } else if (").concat(2===s,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1), 0.0, 0.0);\n\n          ").concat(c,"\n        } else if (").concat(3===s,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2), 0.0);\n\n          ").concat(c,"\n        }\n        setOutput(sumValue);\n      }\n    ")}}class cQ{constructor(e,t){this.variableNames=["x"];const{windowSize:n,batchSize:r,inSize:a,outSize:i}=e;this.outputShape=[r,i];let o="0.0",s="";"prod"===t?o="1.0":"min"===t?(o="1.0 / 1e-20",s="min"):"max"===t&&(o="-1.0 / 1e-20",s="max");let c="".concat(t,"(").concat(t,"(").concat(t,"(")+"minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"sum"===t?c="sumValue":"prod"===t?c="prodValue":"all"===t?c="allValue":"any"===t&&(c="anyValue");const l=4*Math.floor(n/4),u=n%4;let h="\n      if (".concat("sum"===t,") {\n        sumValue += dot(values, ones);\n      } else if (").concat("prod"===t,") {\n        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);\n        prodValue *= tmp[0] * tmp[1];\n      } else {\n        minMaxValue = ").concat(s,"(values, minMaxValue);\n        if (").concat("min"===t," || ").concat("max"===t,") {\n          minMaxValue = ").concat(s,"(values, minMaxValue);\n          bvec4 isNaN = isnan(values);\n          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {\n            minMaxValue = vec4(NAN);\n          }\n        }\n      }\n    "),d="vec4";"all"===t?(o="1.0",h="\n        bool reducedAllValue = all(values);\n        float floatedReducedAllValue = float(reducedAllValue);\n        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);\n      ",d="bvec4"):"any"===t&&(o="0.0",h="\n        bool reducedAnyValue = any(values);\n        float floatedReducedAnyValue = float(reducedAnyValue);\n        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);\n      ",d="bvec4");let f="";a%n>0&&(f="\n        if (inIdx < 0 || inIdx >= ".concat(a,") {\n          return initializationValue;\n        }\n      ")),this.userCode="\n      const float initializationValue = ".concat(o,";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        ").concat(f,"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ").concat(n,";\n\n        vec4 minMaxValue = vec4(").concat(o,");\n        float prodValue = 1.0;\n        float sumValue = 0.0;\n        float allValue = 1.0;\n        float anyValue = 0.0;\n\n        for (int i = 0; i < ").concat(l,"; i += 4) {\n          int inIdx = inOffset + i;\n          ").concat(d," values = ").concat(d,"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          ").concat(h,"\n        }\n\n        int inIdx = inOffset + ").concat(l,";\n        if (").concat(1===u,") {\n          ").concat(d," values = ").concat(d,"(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          ").concat(h,"\n        } else if (").concat(2===u,") {\n          ").concat(d," values = ").concat(d,"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          ").concat(h,"\n        } else if (").concat(3===u,") {\n          ").concat(d," values = ").concat(d,"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          ").concat(h,"\n        }\n        setOutput(").concat(c,");\n      }\n    ")}}function lQ(e,t,n,r){const a=function(e){const t=[];for(;0===t.length||1!==t[t.length-1].outSize;){const n=t.length?t[t.length-1].outSize:e[1],r=ZR(n);t.push({inSize:n,windowSize:r,outSize:Math.ceil(n/r)})}return t}(e.shape);let i=e;for(let o=0;o<a.length;o++){const{inSize:s,windowSize:c,outSize:l}=a[o];let u,h;u="mean"===n?0===o?new sQ({windowSize:c,inSize:s,batchSize:e.shape[0],outSize:l},s):new sQ({windowSize:c,inSize:s,batchSize:e.shape[0],outSize:l}):new cQ({windowSize:c,inSize:s,batchSize:e.shape[0],outSize:l},n),h=i,i=r.runWebGLProgram(u,[i],t),h.dataId!==e.dataId&&r.disposeIntermediateTensorInfo(h)}return i}class uQ{constructor(e,t){this.variableNames=["A"];const n=new Array(e.length);for(let i=0;i<n.length;i++)n[i]=e[t[i]];this.outputShape=n,this.rank=n.length;const r=KY(this.rank),a=function(e){const t=e.length;if(t>6)throw Error("Transpose for rank ".concat(t," is not yet supported"));const n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=new Array(t);for(let a=0;a<e.length;a++)r[e[a]]=n[a];return r.join()}(t);this.userCode="\n    void main() {\n      ".concat(r," resRC = getOutputCoords();\n      setOutput(getA(").concat(a,"));\n    }\n    ")}}class hQ{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;const n=new Array(e.length);for(let l=0;l<n.length;l++)n[l]=e[t[l]];if(this.outputShape=n,this.rank=n.length,this.rank>6)throw Error("Packed transpose for rank ".concat(this.rank," is not yet supported."));const r=KY(this.rank),a=pJ("rc",this.rank),i=new Array(this.rank);for(let l=0;l<t.length;l++)i[t[l]]=a[l];const o="vec2(".concat(i.slice(-2).join(),")"),s="++".concat(a[this.rank-1]," < ").concat(n[this.rank-1]),c="getChannel(getA(".concat(i.join(),"), ").concat(o,")");this.userCode="\n    void main() {\n      ".concat(r," rc = getOutputCoords();\n      vec4 result = vec4(0.);\n      result[0] = ").concat(c,";\n      if(").concat(s,") {\n        result[1] = ").concat(c,";\n      }\n      --").concat(a[this.rank-1],";\n      if(++").concat(a[this.rank-2]," < ").concat(n[this.rank-2],") {\n        result[2] = ").concat(c,";\n        if(").concat(s,") {\n          result[3] = ").concat(c,";\n        }\n      }\n      setOutput(result);\n    }\n    ")}}function dQ(e,t,n){const r=Yw().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new hQ(e.shape,t):new uQ(e.shape,t);return n.runWebGLProgram(r,[e],e.dtype)}function fQ(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:i,keepDims:o}=r;return function(e,t,n,r){const a=t,i=e.shape.length,o=Cw(a,e.shape);let s=o;const c=H_(s,i),l=null!=c;let u=e;l&&(u=dQ(e,c,r),s=q_(s.length,i)),V_("sum",s,i);const[h,d]=U_(u.shape,s);let f=h;n&&(f=W_(h,o));const p=bw(d),m=iQ({inputs:{x:u},attrs:{shape:[bw(e.shape)/p,p]},backend:r}),g=lQ(m,hE(e.dtype),"sum",r),v=iQ({inputs:{x:g},attrs:{shape:f},backend:r});return r.disposeIntermediateTensorInfo(m),r.disposeIntermediateTensorInfo(g),l&&r.disposeIntermediateTensorInfo(u),v}(a,i,o,n)}const pQ={kernelName:FN,backendName:"webgl",kernelFunc:fQ};function mQ(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{perm:i}=r,o=n,s=a.shape.length,c=new Array(s);for(let u=0;u<c.length;u++)c[u]=a.shape[i[u]];let l;if(o.shouldExecuteOnCPU([a])){const e=o.texData.get(a.dataId).values,t=dJ(e,a.shape,a.dtype,i,c);l=o.makeTensorInfo(c,a.dtype);o.texData.get(l.dataId).values=t}else l=dQ(a,i,o);return l}const gQ={kernelName:eC,backendName:"webgl",kernelFunc:mQ};function vQ(e){let{a:t,b:n,transposeA:r,transposeB:a,backend:i,bias:o=null,preluActivationWeights:s=null,leakyreluAlpha:c=0,activation:l=null}=e;const u=t.shape.length,h=n.shape.length,d=r?t.shape[u-2]:t.shape[u-1],f=a?n.shape[h-1]:n.shape[h-2],p=r?t.shape[u-1]:t.shape[u-2],m=a?n.shape[h-2]:n.shape[h-1],g=t.shape.slice(0,-2),v=n.shape.slice(0,-2),b=bw(g),y=bw(v),x=tT(t.shape.slice(0,-2),n.shape.slice(0,-2)).concat([p,m]);mw(d===f,()=>"Error in matMul: inner shapes (".concat(d,") and (")+"".concat(f,") of Tensors with shapes ").concat(t.shape," and ")+"".concat(n.shape," and transposeA=").concat(r)+" and transposeB=".concat(a," must match."));const w=r?[b,d,p]:[b,p,d],k=a?[y,m,f]:[y,f,m],S=iQ({inputs:{x:t},backend:i,attrs:{shape:w}}),N=iQ({inputs:{x:n},backend:i,attrs:{shape:k}}),C=[S,N],E=Math.max(b,y),I=r?S.shape[1]:S.shape[2],T=null!=o,_=null!=s,A="leakyrelu"===l,R=null!=l?JJ(l,!0):null;let F;if((1===p||1===m)&&I>1e3&&!1===(T||_||A||null!=R)){let e=S,t=N;r&&(e=mQ({inputs:{x:S},backend:i,attrs:{perm:[0,2,1]}}),C.push(e)),a&&(t=mQ({inputs:{x:N},backend:i,attrs:{perm:[0,2,1]}}),C.push(t));const n=1===m;let o=e;1!==m&&(o=iQ({inputs:{x:e},backend:i,attrs:{shape:[E,I,1]}}),C.push(o));const s=1===m?2:1;let c=t;n&&(c=iQ({inputs:{x:t},backend:i,attrs:{shape:[E,1,I]}}),C.push(c));const l=rQ({inputs:{a:o,b:c},backend:i});F=fQ({inputs:{x:l},backend:i,attrs:{axis:s,keepDims:!0}}),C.push(l)}else{const e=uE(t.dtype,n.dtype),l=new QJ(w,k,[E,p,m],r,a,T,R,_,A),u=[S,N];if(null!=o&&u.push(o),_&&u.push(s),A){const e=i.makeTensorInfo([],"float32",PC(c,"float32"));u.push(e),C.push(e)}F=i.runWebGLProgram(l,u,e)}const D=iQ({inputs:{x:F},backend:i,attrs:{shape:x}});C.push(F);for(const O of C)i.disposeIntermediateTensorInfo(O);return D}const bQ={kernelName:cC,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{a:a,b:i,bias:o,preluActivationWeights:s}=t,{transposeA:c,transposeB:l,activation:u,leakyreluAlpha:h}=r;return vQ({a:a,b:i,transposeA:c,transposeB:l,backend:n,bias:o,preluActivationWeights:s,leakyreluAlpha:h,activation:u})}},yQ="return abs(x);";const xQ={kernelName:ek,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{x:r}=t;if(n.shouldExecuteOnCPU([r])&&"complex64"!==r.dtype){const e=n.texData.get(r.dataId),t=Q$(e.values);return n.makeTensorInfo(r.shape,r.dtype,t)}let a;return a=Yw().getBool("WEBGL_PACK_UNARY_OPERATIONS")?new TJ(r.shape,yQ):new kJ(r.shape,yQ),n.runWebGLProgram(a,[r],r.dtype)}},wQ=YJ({opSnippet:SJ+"\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return acos(x);\n"}),kQ={kernelName:tk,backendName:"webgl",kernelFunc:wQ},SQ=YJ({opSnippet:SJ+"\n  if (x < 1.0) return NAN;\nreturn log(x + sqrt(x * x - 1.0));"}),NQ={kernelName:nk,backendName:"webgl",kernelFunc:SQ},CQ="return a + b;",EQ=$J({opSnippet:CQ,packedOpSnippet:CQ,supportsComplex:!0,cpuKernelImpl:y$}),IQ={kernelName:rk,backendName:"webgl",kernelFunc:EQ};class TQ{constructor(e,t){this.outputShape=[],this.outputShape=e,this.variableNames=t.map((e,t)=>"T".concat(t));const n=[];this.variableNames.forEach(e=>{n.push("float v".concat(e," = get").concat(e,"AtOutCoords();"))});const r=this.variableNames.map(e=>"v".concat(e)).join(" + ");this.userCode="\n      void main() {\n        ".concat(n.join("\n        "),"\n\n        float result = ").concat(r,";\n        setOutput(result);\n      }\n    ")}}class _Q{constructor(e,t){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.variableNames=t.map((e,t)=>"T".concat(t));const n=[];this.variableNames.forEach(e=>{n.push("vec4 v".concat(e," = get").concat(e,"AtOutCoords();"))});const r=this.variableNames.map(e=>"v".concat(e)).join(" + ");this.userCode="\n      void main() {\n        ".concat(n.join("\n        "),"\n\n        vec4 result = ").concat(r,";\n        setOutput(result);\n      }\n    ")}}const AQ={kernelName:ak,backendName:"webgl",kernelFunc:function e(t){const{inputs:n,backend:r}=t,a=n;if(1===a.length)return jJ({inputs:{x:a[0]},backend:r});if(a.length>Yw().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){const t=Math.floor(a.length/2),n=e({inputs:a.slice(0,t),backend:r}),i=e({inputs:a.slice(t),backend:r});return e({inputs:[n,i],backend:r})}const i=a.map(e=>e.dtype).reduce((e,t)=>uE(e,t)),o=a.map(e=>e.shape),s=Yw().getBool("WEBGL_PACK")?new _Q(a[0].shape,o):new TQ(a[0].shape,o);return r.runWebGLProgram(s,a,i)}};const RQ={kernelName:ik,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:i,keepDims:o}=r,s=a.shape.length,c=Cw(i,a.shape);let l=c;const u=H_(l,s);let h=a;null!=u&&(h=mQ({inputs:{x:a},backend:n,attrs:{perm:u}}),l=q_(l.length,s)),V_("all",l,s);const[d,f]=U_(h.shape,l),p=iQ({inputs:{x:h},backend:n,attrs:{shape:[-1,bw(f)]}}),m=lQ(p,p.dtype,"all",n);let g;if(o){g=iQ({inputs:{x:m},backend:n,attrs:{shape:W_(d,c)}})}else g=iQ({inputs:{x:m},backend:n,attrs:{shape:d}});return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(m),null!=u&&n.disposeIntermediateTensorInfo(h),g}};const FQ={kernelName:ok,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:i,keepDims:o}=r,s=a.shape.length,c=Cw(i,a.shape);let l=c;const u=H_(l,s);let h=a;null!=u&&(h=mQ({inputs:{x:a},backend:n,attrs:{perm:u}}),l=q_(l.length,s)),V_("any",l,s);const[d,f]=U_(h.shape,l),p=iQ({inputs:{x:h},backend:n,attrs:{shape:[-1,bw(f)]}}),m=lQ(p,p.dtype,"any",n);let g;if(o){g=iQ({inputs:{x:m},backend:n,attrs:{shape:W_(d,c)}})}else g=iQ({inputs:{x:m},backend:n,attrs:{shape:d}});return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(m),null!=u&&n.disposeIntermediateTensorInfo(h),g}};class DQ{constructor(e,t,n){this.variableNames=["A"];const{windowSize:r,batchSize:a,outSize:i}=e;n||this.variableNames.push("bestIndicesA"),this.outputShape=[a,i];const o="max"===t?">":"<",s=n?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ".concat(r,";\n\n        int bestIndex = inOffset;\n        float bestValue = getA(batch, bestIndex);\n\n        for (int i = 0; i < ").concat(r,"; i++) {\n          int inIdx = ").concat(s,";\n          float candidate = getA(batch, inIdx);\n          if (candidate ").concat(o," bestValue) {\n            bestValue = candidate;\n            bestIndex = inIdx;\n          }\n        }\n        setOutput(float(bestIndex));\n      }\n    ")}}class OQ{constructor(e,t,n,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,mw(e.length>2,()=>"Packed arg".concat(n.charAt(0).toUpperCase()+n.slice(1)," supports only inputs with rank above 2."));const a=e[e.length-1],i=Math.ceil(a/t);this.outputShape=e.slice(0,-1),i>1&&this.outputShape.push(i),r||this.variableNames.push("bestIndicesA");const o=this.outputShape,s=o.length,c=KY(s),l=mJ("coords",s);let u,h;if(1===i){h=s+1;const e=KY(h);u="\n        ".concat(e," sourceLocR = ").concat(e,"(").concat(l.join(),", 0);\n        ++").concat(l[s-1],";\n        ").concat(e," sourceLocG = ").concat(e,"(").concat(l.join(),", 0);\n        ++").concat(l[s-2],";\n        ").concat(e," sourceLocA = ").concat(e,"(").concat(l.join(),", 0);\n        --").concat(l[s-1],";\n        ").concat(e," sourceLocB = ").concat(e,"(").concat(l.join(),", 0);\n        --").concat(l[s-2],";")}else h=s,u="\n        ".concat(c," sourceLocR = coords;\n        ++").concat(l[s-1],";\n        ").concat(c," sourceLocG = coords;\n        ++").concat(l[s-2],";\n        ").concat(c," sourceLocA = coords;\n        --").concat(l[s-1],";\n        ").concat(c," sourceLocB = coords;\n        --").concat(l[s-2],";");const d=["x","y","z","w","u","v"].slice(0,h),f="."+d[h-1],p=d.map(e=>"int "+e),m=mJ("sourceLocR",h-1).concat("inIdx.r"),g=mJ("sourceLocG",h-1).concat("inIdx.g"),v=mJ("sourceLocB",h-1).concat("inIdx.b"),b=mJ("sourceLocA",h-1).concat("inIdx.a"),y="max"===n?"greaterThan":"lessThan",x=r?"":"\n          inIdx = round(vec4(getBestIndicesAChannel(".concat(m.join(),"),\n                             getBestIndicesAChannel(").concat(g.join(),"),\n                             getBestIndicesAChannel(").concat(v.join(),"),\n                             getBestIndicesAChannel(").concat(b.join(),")));"),w="vec4(\n            getAChannel(".concat(m.join(),"),\n            hasNextCol ? getAChannel(").concat(g.join(),") : 0.,\n            hasNextRow ? getAChannel(").concat(v.join(),") : 0.,\n            hasNextRow && hasNextCol ? getAChannel(").concat(b.join(),") : 0.)"),k=r?"":"\n      float getBestIndicesAChannel(".concat(p.join(),") {\n        return getChannel(getBestIndicesA(").concat(d.join(),"),\n                                          vec2(").concat(d.slice(-2).join(),"));\n      }");this.userCode="\n      float getAChannel(".concat(p.join(),") {\n        return getChannel(getA(").concat(d.join(),"),\n                               vec2(").concat(d.slice(-2).join(),"));\n      }\n      ").concat(k,"\n      void main() {\n        ").concat(c," coords = getOutputCoords();\n        bool hasNextCol = ").concat(l[s-1]," < ").concat(o[s-1]-1,";\n        bool hasNextRow = ").concat(l[s-2]," < ").concat(o[s-2]-1,";\n        ").concat(u,"\n        ivec4 srcIdx = ivec4(sourceLocR").concat(f,", sourceLocG").concat(f,",\n          sourceLocB").concat(f,", sourceLocA").concat(f,") * ").concat(t,";\n        ivec4 inIdx = srcIdx;\n        vec4 bestIndex = vec4(inIdx);\n        vec4 bestValue = ").concat(w,";\n\n        for (int i = 0; i < ").concat(t,"; i++) {\n          inIdx = srcIdx;\n          ").concat(x,"\n          vec4 candidate = ").concat(w,";\n          bvec4 nan = isnan(candidate);\n          bvec4 replace = bvec4(\n            vec4(").concat(y,"(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));\n\n          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,\n                           replace.y  ? candidate.y : bestValue.y,\n                           replace.z  ? candidate.z : bestValue.z,\n                           replace.w  ? candidate.w : bestValue.w);\n          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));\n          srcIdx++;\n        }\n        setOutput(bestIndex);\n      }\n    ")}}function LQ(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=t.shape[0],i=t.shape[1];null!=r&&(a=r.shape[0],i=r.shape[1]);const o=ZR(i),s={windowSize:o,inSize:i,batchSize:a,outSize:Math.ceil(i/o)},c=new DQ(s,n,null==r),l=[t];null!=r&&l.push(r);const u=e.runWebGLProgram(c,l,"int32");if(1===u.shape[1])return u;const h=LQ(e,t,n,u);return e.disposeIntermediateTensorInfo(u),h}function PQ(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const a=null!=r?r.shape:t.shape,i=ZR(a[a.length-1]),o=new OQ(a,i,n,null==r),s=null==r?[t]:[t,r],c=e.runWebGLProgram(o,s,"int32");if(c.shape.length===t.shape.length){const r=PQ(e,t,n,c);return e.disposeIntermediateTensorInfo(c),r}return c}function MQ(e,t,n,r){const a=[n];if(V_("arg"+r.charAt(0).toUpperCase()+r.slice(1),a,t.shape.length),!Yw().getBool("WEBGL_PACK_REDUCE")||t.shape.length<=2){const n=[],i=e.texData.get(t.dataId);let o=t;null!==i&&i.isPacked&&(o=e.unpackTensor(t),n.push(o));const[s,c]=U_(o.shape,a),l=bw(c),u=iQ({inputs:{x:o},backend:e,attrs:{shape:[-1,l]}});n.push(u);const h=LQ(e,u,r);n.push(h);const d=iQ({inputs:{x:h},backend:e,attrs:{shape:s}});return n.forEach(t=>e.disposeIntermediateTensorInfo(t)),d}return PQ(e,t,r)}const jQ={kernelName:sk,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:i}=r;let o=Cw(i,a.shape);const s=H_(o,a.shape.length);let c=a;const l=[];null!=s&&(c=mQ({inputs:{x:a},backend:n,attrs:{perm:s}}),l.push(c),o=q_(o.length,c.shape.length)),V_("argMax",[o[0]],c.shape.length);const u=MQ(n,c,o[0],"max");return l.forEach(e=>n.disposeIntermediateTensorInfo(e)),u}};const BQ={kernelName:ck,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:i}=r;let o=Cw(i,a.shape);const s=H_(o,a.shape.length);let c=a;const l=[];null!=s&&(c=mQ({inputs:{x:a},backend:n,attrs:{perm:s}}),l.push(c),o=q_(o.length,c.shape.length)),V_("argMin",[o[0]],c.shape.length);const u=MQ(n,c,o[0],"min");return l.forEach(e=>n.disposeIntermediateTensorInfo(e)),u}},zQ=YJ({opSnippet:SJ+"\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return asin(x);\n"}),UQ={kernelName:lk,backendName:"webgl",kernelFunc:zQ},WQ=YJ({opSnippet:SJ+"return log(x + sqrt(x * x + 1.0));"}),VQ={kernelName:uk,backendName:"webgl",kernelFunc:WQ},HQ=YJ({opSnippet:SJ+"\n  return atan(x);\n"}),GQ={kernelName:hk,backendName:"webgl",kernelFunc:HQ},qQ=$J({opSnippet:OJ+"\n  return atan(a, b);\n",packedOpSnippet:"\n  vec4 result = atan(a, b);\n  bvec4 isNaNA = isnan(a);\n  bvec4 isNaNB = isnan(b);\n  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);\n  "+PJ+"\n  return result;\n"}),KQ={kernelName:fk,backendName:"webgl",kernelFunc:qQ},XQ=YJ({opSnippet:SJ+"\n  if ((x < -1.0) || (x > 1.0)) return NAN;\nreturn (log(1.0 + x) - log(1.0 - x)) / 2.0;"}),YQ={kernelName:dk,backendName:"webgl",kernelFunc:XQ};class $Q{constructor(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(this.variableNames=["x"],"avg"===t&&n)throw new Error("Cannot compute positions for average pool.");const i=e.filterWidth,o=e.strideHeight,s=e.strideWidth,c=e.dilationHeight,l=e.dilationWidth,u=e.effectiveFilterHeight,h=e.effectiveFilterWidth,d=e.padInfo.top,f=e.padInfo.left;this.outputShape=e.outShape;const p="avg"===t,m="((batch  * ".concat(e.inHeight," + xR) * ").concat(e.inWidth," + xC) * ").concat(e.inChannels," + d"),g="(xR * ".concat(e.inWidth," + xC) * ").concat(e.inChannels," + d");let v="0.0";if(p||(v="-1.0 / 1e-20"),n){const t=">=";return void(this.userCode="\n        const ivec2 strides = ivec2(".concat(o,", ").concat(s,");\n        const ivec2 pads = ivec2(").concat(d,", ").concat(f,");\n\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int batch = coords[0];\n          int d = coords[3];\n\n          ivec2 xRCCorner = coords.yz * strides - pads;\n          int xRCorner = xRCCorner.x;\n          int xCCorner = xRCCorner.y;\n\n          // max/min x(?, ?, d) to get y(yR, yC, d).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n          float avgValue = 0.0;\n\n          for (int wR = 0; wR < ").concat(u,";\n              wR += ").concat(c,") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= ").concat(e.inHeight,") {\n              continue;\n            }\n\n            for (int wC = 0; wC < ").concat(h,";\n                wC += ").concat(l,") {\n              int xC = xCCorner + wC;\n\n              if (xC < 0 || xC >= ").concat(e.inWidth,") {\n                continue;\n              }\n\n              float value = getX(batch, xR, xC, d);\n\n              // If a min / max value has already been found, use it. If not,\n              // use the current value.\n              float currMinMaxValue = mix(\n                  value, minMaxValue, minMaxValueFound);\n              if (value ").concat(t," currMinMaxValue) {\n                minMaxValue = value;\n                minMaxValueFound = 1.0;\n                minMaxPosition = ").concat(r?a?m:g:"wR * ".concat(h," + wC"),";\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      "))}let b="".concat(t,"(").concat(t,"(").concat(t,"(")+"minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===t&&(b="avgValue / max(count, 1.0)");const y=4*Math.floor(i/4),x=i%4,w="\n      if (".concat(p,") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = ").concat("max","(values, minMaxValue);\n      }\n    ");this.userCode="\n      const ivec2 strides = ivec2(".concat(o,", ").concat(s,");\n      const ivec2 pads = ivec2(").concat(d,", ").concat(f,");\n      const float initializationValue = ").concat(v,";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xR, int xC, int d) {\n        if (xC < 0 || xC >= ").concat(e.inWidth,") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xR, xC, d);\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // max/min x(?, ?, d) to get y(yR, yC, d).\n        // ? = to be determined\n        vec4 minMaxValue = vec4(").concat(v,");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wR = 0; wR < ").concat(u,";\n            wR += ").concat(c,") {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= ").concat(e.inHeight,") {\n            continue;\n          }\n\n          for (int wC = 0; wC < ").concat(y,"; wC += 4) {\n            int xC = xCCorner + wC * ").concat(l,";\n\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ").concat(l,", d),\n              getValue(batch, xR, xC + 2 * ").concat(l,", d),\n              getValue(batch, xR, xC + 3 * ").concat(l,", d)\n            );\n\n            ").concat(w,"\n          }\n\n          int xC = xCCorner + ").concat(y,";\n          if (").concat(1===x,") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              initializationValue,\n              initializationValue,\n              initializationValue\n            );\n\n            ").concat(w,"\n          } else if (").concat(2===x,") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ").concat(l,", d),\n              initializationValue,\n              initializationValue\n            );\n\n            ").concat(w,"\n          } else if (").concat(3===x,") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ").concat(l,", d),\n              getValue(batch, xR, xC + 2 * ").concat(l,", d),\n              initializationValue\n            );\n\n            ").concat(w,"\n          }\n        }\n        setOutput(").concat(b,");\n      }\n    ")}}class JQ{constructor(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(this.variableNames=["x"],"avg"===t&&n)throw new Error("Cannot compute positions for average pool.");const i=e.filterWidth,o=e.strideDepth,s=e.strideHeight,c=e.strideWidth,l=e.dilationDepth,u=e.dilationHeight,h=e.dilationWidth,d=e.effectiveFilterDepth,f=e.effectiveFilterHeight,p=e.effectiveFilterWidth,m=e.padInfo.front,g=e.padInfo.top,v=e.padInfo.left;this.outputShape=e.outShape;const b="avg"===t;let y="0.0";if(b||(y="-1.0 / 1e-20"),n){const t=">=";return void(this.userCode="\n        const ivec3 strides =\n            ivec3(".concat(o,", ").concat(s,", ").concat(c,");\n        const ivec3 pads = ivec3(").concat(m,", ").concat(g,", ").concat(v,");\n\n        void main() {\n          ivec5 coords = getOutputCoords();\n          int batch = coords.x;\n          int ch = coords.u;\n\n          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n          int xDCorner = xCorner.x;\n          int xRCorner = xCorner.y;\n          int xCCorner = xCorner.z;\n\n          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n\n          for (int wD = 0; wD < ").concat(d,";\n              wD += ").concat(l,") {\n            int xD = xDCorner + wD;\n\n            if (xD < 0 || xD >= ").concat(e.inDepth,") {\n              continue;\n            }\n\n            for (int wR = 0; wR < ").concat(f,";\n                wR += ").concat(u,") {\n              int xR = xRCorner + wR;\n\n              if (xR < 0 || xR >= ").concat(e.inHeight,") {\n                continue;\n              }\n\n              for (int wC = 0; wC < ").concat(p,";\n                  wC += ").concat(h,") {\n                int xC = xCCorner + wC;\n\n                if (xC < 0 || xC >= ").concat(e.inWidth,") {\n                  continue;\n                }\n\n                float value = getX(batch, xD, xR, xC, ch);\n\n                // If a min / max value has already been found, use it. If not,\n                // use the current value.\n                float currMinMaxValue = mix(\n                    value, minMaxValue, minMaxValueFound);\n                if (value ").concat(t," currMinMaxValue) {\n                  minMaxValue = value;\n                  minMaxValueFound = 1.0;\n                  minMaxPosition = ").concat(r?a?"(((batch * ".concat(e.inDepth," + xD) * ").concat(e.inHeight," + xR) * ").concat(e.inWidth," + xC) * ").concat(e.inChannels," + ch"):"((xD * ".concat(e.inHeight," + xR) * ").concat(e.inWidth," + xC) * ").concat(e.inChannels," + ch"):"wD * ".concat(f," * ").concat(p," +\n                      wR * ").concat(p," + wC"),";\n                }\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      "))}let x="".concat(t,"(").concat(t,"(").concat(t,"(")+"minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===t&&(x="avgValue / max(count, 1.0)");const w=4*Math.floor(i/4),k=i%4,S="\n      if (".concat(b,") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = ").concat("max","(values, minMaxValue);\n      }\n    ");this.userCode="\n      const ivec3 strides =\n        ivec3(".concat(o,", ").concat(s,", ").concat(c,");\n      const ivec3 pads = ivec3(").concat(m,", ").concat(g,", ").concat(v,");\n      const float initializationValue = ").concat(y,";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xD, int xR, int xC, int ch) {\n        if (xC < 0 || xC >= ").concat(e.inWidth,") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xD, xR, xC, ch);\n      }\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xDCorner = xCorner.x;\n        int xRCorner = xCorner.y;\n        int xCCorner = xCorner.z;\n\n        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).\n        // ? = to be determined\n        vec4 minMaxValue = vec4(").concat(y,");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wD = 0; wD < ").concat(d,";\n            wD += ").concat(l,") {\n          int xD = xDCorner + wD;\n\n          if (xD < 0 || xD >= ").concat(e.inDepth,") {\n            continue;\n          }\n\n          for (int wR = 0; wR < ").concat(f,";\n            wR += ").concat(u,") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= ").concat(e.inHeight,") {\n              continue;\n            }\n\n            for (int wC = 0; wC < ").concat(w,"; wC += 4) {\n              int xC = xCCorner + wC * ").concat(h,";\n\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ").concat(h,", ch),\n                getValue(batch, xD, xR, xC + 2 * ").concat(h,", ch),\n                getValue(batch, xD, xR, xC + 3 * ").concat(h,", ch)\n              );\n\n              ").concat(S,"\n            }\n\n            int xC = xCCorner + ").concat(w,";\n            if (").concat(1===k,") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                initializationValue,\n                initializationValue,\n                initializationValue\n              );\n\n              ").concat(S,"\n            } else if (").concat(2===k,") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ").concat(h,", ch),\n                initializationValue,\n                initializationValue\n              );\n\n              ").concat(S,"\n            } else if (").concat(3===k,") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ").concat(h,", ch),\n                getValue(batch, xD, xR, xC + 2 * ").concat(h,", ch),\n                initializationValue\n              );\n\n              ").concat(S,"\n            }\n          }\n        }\n        setOutput(").concat(x,");\n      }\n    ")}}const QQ={kernelName:pk,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t;_Y(a,"avgPool");const{filterSize:i,strides:o,pad:s,dimRoundingMode:c}=r;mw(YT(o,1),()=>"Error in avgPool: Either strides or dilations must be 1. "+"Got strides ".concat(o," and dilations '").concat(1,"'"));const l=BT(a.shape,i,o,1,s,c);if(1===l.filterWidth&&1===l.filterHeight&&yw(l.inShape,l.outShape))return jJ({inputs:{x:a},backend:n});const u=new $Q(l,"avg",!1);return n.runWebGLProgram(u,[a],"float32")}};const ZQ={kernelName:gk,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{filterSize:i,strides:o,pad:s,dimRoundingMode:c,dataFormat:l}=r,u=zT(a.shape,i,o,[1,1,1],s,c,l),h=new JQ(u,"avg",!1);return n.runWebGLProgram(h,[a],"float32")}};class eZ{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,a=e.strideWidth,i=e.dilationHeight,o=e.dilationWidth,s=e.effectiveFilterHeight,c=e.effectiveFilterWidth,l=s-1-e.padInfo.top,u=c-1-e.padInfo.left,h=1/(t*n);this.userCode="\n      const ivec2 pads = ivec2(".concat(l,", ").concat(u,");\n      const float avgMultiplier = float(").concat(h,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(s,";\n            wR += ").concat(i,") {\n          float dyR = float(dyRCorner + wR) / ").concat(r,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(e.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < ").concat(c,";\n            wC+= ").concat(o,") {\n            float dyC = float(dyCCorner + wC) / ").concat(a,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(e.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n\n            dotProd += dyValue * avgMultiplier;\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}}class tZ{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const t=e.filterDepth,n=e.filterHeight,r=e.filterWidth,a=e.strideDepth,i=e.strideHeight,o=e.strideWidth,s=e.dilationDepth,c=e.dilationHeight,l=e.dilationWidth,u=e.effectiveFilterDepth,h=e.effectiveFilterHeight,d=e.effectiveFilterWidth,f=u-1-e.padInfo.front,p=h-1-e.padInfo.top,m=d-1-e.padInfo.left,g=1/(t*n*r);this.userCode="\n      const ivec3 pads = ivec3(".concat(f,", ").concat(p,", ").concat(m,");\n      const float avgMultiplier = float(").concat(g,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < ").concat(u,";\n            wD += ").concat(s,") {\n          float dyD = float(dyDCorner + wD) / ").concat(a,".0;\n\n          if (dyD < 0.0 || dyD >= ").concat(e.outDepth,".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < ").concat(h,";\n              wR += ").concat(c,") {\n            float dyR = float(dyRCorner + wR) / ").concat(i,".0;\n\n            if (dyR < 0.0 || dyR >= ").concat(e.outHeight,".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < ").concat(d,";\n                wC += ").concat(l,") {\n              float dyC = float(dyCCorner + wC) / ").concat(o,".0;\n\n              if (dyC < 0.0 || dyC >= ").concat(e.outWidth,".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n\n              dotProd += dyValue * avgMultiplier;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}}const nZ={kernelName:vk,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{dy:a,input:i}=t,o=i,{filterSize:s,strides:c,pad:l,dimRoundingMode:u}=r,h=zT(o.shape,s,c,[1,1,1],l,u),d=new tZ(h);return n.runWebGLProgram(d,[a],o.dtype)}};const rZ={kernelName:mk,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{dy:a,input:i}=t,o=i;_Y([a,i],"avgPoolGrad");const{filterSize:s,strides:c,pad:l}=r,u=BT(o.shape,s,c,1,l),h=new eZ(u);return n.runWebGLProgram(h,[a],o.dtype)}};const aZ={kernelName:bk,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{a:a,b:i}=t,{transposeA:o,transposeB:s}=r;return vQ({a:a,b:i,transposeA:o,transposeB:s,backend:n})}};class iZ{constructor(e,t,n,r,a,i){this.outputShape=[],this.variableNames=["x","mean","variance"],tT(e,t),tT(e,n);let o="0.0";null!=r&&(tT(e,r),this.variableNames.push("offset"),o="getOffsetAtOutCoords()");let s="1.0";null!=a&&(tT(e,a),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=e,this.userCode="\n      void main() {\n        float x = getXAtOutCoords();\n        float mean = getMeanAtOutCoords();\n        float variance = getVarianceAtOutCoords();\n        float offset = ".concat(o,";\n        float scale = ").concat(s,";\n        float inv = scale * inversesqrt(variance + float(").concat(i,"));\n        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));\n      }\n    ")}}class oZ{constructor(e,t,n,r,a,i){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],tT(e,t),tT(e,n);let o="vec4(0.0)";null!=r&&(tT(e,r),this.variableNames.push("offset"),o="getOffsetAtOutCoords()");let s="vec4(1.0)";null!=a&&(tT(e,a),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=e,this.userCode="\n      void main() {\n        vec4 offset = ".concat(o,";\n        vec4 scale = ").concat(s,";\n\n        vec4 x = getXAtOutCoords();\n        vec4 mean = getMeanAtOutCoords();\n        vec4 variance = getVarianceAtOutCoords();\n\n        vec4 inv = scale * inversesqrt(variance + vec4(").concat(i,"));\n\n        setOutput((x - mean) * inv + offset);\n      }\n    ")}}const sZ={kernelName:uS,backendName:"webgl",kernelFunc:e=>{let{inputs:t,backend:n,attrs:r}=e;const{x:a,mean:i,variance:o,offset:s,scale:c}=t;mw(i.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),mw(null==s||i.shape.length===s.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),mw(null==c||i.shape.length===c.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let{varianceEpsilon:l}=r;null==l&&(l=.001);const u=[a,i,o];let h=null;null!=s&&(h=s.shape,u.push(s));let d=null;null!=c&&(d=c.shape,u.push(c));const f=Yw().getBool("WEBGL_PACK_NORMALIZATION")?new oZ(a.shape,i.shape,o.shape,h,d,l):new iZ(a.shape,i.shape,o.shape,h,d,l);return n.runWebGLProgram(f,u,u[0].dtype)}};class cZ{constructor(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;const t=KY(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const n=function(e){if(1===e)return"sourceLoc";if(e<=6)return lZ.slice(0,e).map(e=>"sourceLoc."+e).join(",");throw Error("Slicing for rank ".concat(e," is not yet supported"))}(this.rank);let r;const a=e.map((e,t)=>"sourceLoc.".concat(lZ[t]," = start[").concat(t,"] + coords.").concat(lZ[t],";"));r="\n        ".concat(t," sourceLoc;\n        ").concat(t," coords = getOutputCoords();\n        ").concat(a.join("\n"),"\n      "),this.userCode="\n      void main() {\n        ".concat(r,"\n        setOutput(getSource(").concat(n,"));\n      }\n    ")}}const lZ=["x","y","z","w","u","v"];class uZ{constructor(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const t=KY(this.rank),n=mJ("coords",this.rank),r=mJ("sourceLoc",this.rank),a=1===this.rank?"sourceLoc":"vec2(".concat(r.slice(-2).join(),")"),i="getChannel(getSource(".concat(r.join(),"), ").concat(a,")"),o="\n      result.x = ".concat(i,";\n      if (++").concat(n[this.rank-1]," < ").concat(e[this.rank-1],") {\n        ++").concat(r[this.rank-1],";\n        result.y = ").concat(i,";\n        --").concat(r[this.rank-1],";\n      }\n    "),s=1===this.rank?"":"\n      --".concat(n[this.rank-1],";\n      if (++").concat(n[this.rank-2]," < ").concat(e[this.rank-2],") {\n        ++").concat(r[this.rank-2],";\n        result.z = ").concat(i,";\n        if (++").concat(n[this.rank-1]," < ").concat(e[this.rank-1],") {\n          ++").concat(r[this.rank-1],";\n          result.w = ").concat(i,";\n        }\n      }\n    "),c=this.rank<=4?"sourceLoc = coords +\n            ".concat(t,"(").concat(e.map((e,t)=>"start[".concat(t,"]")).join(),");"):e.map((e,t)=>"".concat(r[t]," = ").concat(n[t]," + start[").concat(t,"];")).join("\n");this.userCode="\n      void main() {\n        ".concat(t," coords = getOutputCoords();\n        ").concat(t," sourceLoc;\n        ").concat(c,"\n        vec4 result = vec4(0.);\n        ").concat(o,"\n        ").concat(s,"\n        setOutput(result);\n      }\n    ")}}function hZ(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{begin:i,size:o}=r,[s,c]=FT(a,i,o);if(bT(a,s,c),0===bw(c))return n.makeTensorInfo(c,a.dtype,[]);if(n.shouldExecuteOnCPU([a])||"string"===a.dtype){const e=n.texData.get(a.dataId),t=Z$(e.values,s,c,a.shape,a.dtype);return n.makeTensorInfo(c,a.dtype,t)}const{isPacked:l}=n.texData.get(a.dataId),u=AT(a.shape,s,c);if(l||!u){const e=Yw().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new uZ(c):new cZ(c),t=[s];return n.runWebGLProgram(e,[a],a.dtype,t)}return n.uploadToGPU(a.dataId),function(e,t,n,r){const a=r.texData.get(e.dataId),i=r.makeTensorInfo(n,e.dtype),o=r.texData.get(i.dataId);Object.assign(o,a),o.refCount=1,o.shape=n,o.dtype=e.dtype;let s=RT(t,Pw(e.shape));a.slice&&(s+=a.slice.flatOffset),o.slice={flatOffset:s,origDataId:a.slice&&a.slice.origDataId||e.dataId};const c=r.dataRefCount.get(o.slice.origDataId)||1;return r.dataRefCount.set(o.slice.origDataId,c+1),i}(a,s,c,n)}const dZ={kernelName:CN,backendName:"webgl",kernelFunc:hZ},fZ={kernelName:yk,backendName:"webgl",kernelFunc:e=>{const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{blockShape:i,crops:o}=r;mw(a.shape.length<=4,()=>"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet");const s=i.reduce((e,t)=>e*t),c=tF(a.shape,i,s),l=nF(c.length,i.length),u=rF(a.shape,i,s),h=aF(o,i.length),d=iF(u,o,i.length),f=[],p=iQ({inputs:{x:a},backend:n,attrs:{shape:c}}),m=mQ({inputs:{x:p},backend:n,attrs:{perm:l}}),g=iQ({inputs:{x:m},backend:n,attrs:{shape:u}}),v=hZ({inputs:{x:g},backend:n,attrs:{begin:h,size:d}});return f.push(p),f.push(m),f.push(g),f.forEach(e=>n.disposeIntermediateTensorInfo(e)),v}};const pZ={kernelName:xk,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,weights:i}=t,{size:o}=r,s=n.readSync(a.dataId),c=n.readSync(i.dataId),l=x$(s,c,i.dtype,i.shape,o);return n.makeTensorInfo([o],i.dtype,l)}};const mZ={kernelName:wk,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{a:r,b:a}=t,i=Yw().getBool("WEBGL_PACK_BINARY_OPERATIONS"),o=Yw().getNumber("WEBGL_VERSION");if(n.shouldExecuteOnCPU([r,a])||1===o){const e=n.texData.get(r.dataId).values,t=n.texData.get(a.dataId).values,[i,o]=k$(r.shape,a.shape,e,t,r.dtype),s=n.makeTensorInfo(o,r.dtype);return n.texData.get(s.dataId).values=i,s}let s;return s=i?new MJ("\n  int r = int(a.r) & int(b.r);\n  int g = int(a.g) & int(b.g);\n  int rb = int(a.b) & int(b.b);\n  int ra = int(a.a) & int(b.a);\n  return vec4(r, g, rb, ra);\n",r.shape,a.shape,!1):new LJ("\n  return float(int(a.r) & int(b.r));\n",r.shape,a.shape),n.runWebGLProgram(s,[r,a],r.dtype)}};const gZ={kernelName:kk,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{s0:r,s1:a}=t,i=n.readSync(r.dataId),o=n.readSync(a.dataId),s=tT(Array.from(i),Array.from(o));return n.makeTensorInfo([s.length],"int32",Int32Array.from(s))}},vZ=$J({opSnippet:"return float(a != b);",cpuKernelImpl:V$,dtype:"bool"}),bZ={kernelName:KS,backendName:"webgl",kernelFunc:vZ};function yZ(e){const{inputs:t,backend:n}=e,{input:r}=t;return jJ({inputs:{x:n.texData.get(r.dataId).complexTensorInfos.real},backend:n})}const xZ={kernelName:cN,backendName:"webgl",kernelFunc:yZ};const wZ={kernelName:Sk,backendName:"webgl",kernelFunc:function e(t){const{inputs:n,backend:r,attrs:a}=t,{x:i}=n,{dtype:o}=a;if("complex64"===o){if("complex64"===i.dtype)return jJ({inputs:{x:i},backend:r});const t=iA(i.shape),n=e({inputs:{x:i},backend:r,attrs:{dtype:"float32"}}),a=zJ({inputs:{real:n,imag:t},backend:r});return t.dispose(),r.disposeIntermediateTensorInfo(n),a}if("complex64"===i.dtype){const t=yZ({inputs:{input:i},backend:r}),n=e({inputs:{x:t},backend:r,attrs:{dtype:o}});return r.disposeIntermediateTensorInfo(t),n}if(!_w(i.dtype,o)){const e=jJ({inputs:{x:i},backend:r});return{dataId:e.dataId,shape:e.shape,dtype:o}}if(r.shouldExecuteOnCPU([i])){const e=r.texData.get(i.dataId).values,[t,n,a]=S$(e,i.shape,i.dtype,o);return r.makeTensorInfo(t,n,a)}if("int32"===o)return function(e,t){const n=new kJ(e.shape,"return float(int(x));"),r=t.runWebGLProgram(n,[e],"int32");return{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}(i,r);if("bool"===o){const e=r.makeTensorInfo([],"bool",Iw("bool",1)),t=vZ({inputs:{a:i,b:e},backend:r});return r.disposeIntermediateTensorInfo(e),t}throw new Error("Error in Cast: failed to cast ".concat(i.dtype," to ").concat(o))}},kZ="return ceil(x);",SZ=YJ({opSnippet:kZ,packedOpSnippet:kZ,cpuKernelImpl:N$}),NZ={kernelName:Nk,backendName:"webgl",kernelFunc:SZ};class CZ{constructor(e){this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode="\n\n      void main() {\n        float value = getAAtOutCoords();\n        if (isnan(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, minVal, maxVal));\n      }\n    "}}class EZ{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode="\n      void main() {\n        vec4 value = getAAtOutCoords();\n\n        if (any(isnan(value))) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));\n      }\n    "}}const IZ={kernelName:Ck,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{clipValueMin:i,clipValueMax:o}=r;let s;s=Yw().getBool("WEBGL_PACK_CLIP")?new EZ(a.shape):new CZ(a.shape);const c=[[i],[o]];return n.runWebGLProgram(s,[a],a.dtype,c)}};class TZ{constructor(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode="\n      void main() {\n        float re = abs(getRealAtOutCoords());\n        float im = abs(getImagAtOutCoords());\n        float mx = max(re, im);\n\n        // sadly the length function in glsl is not underflow-safe\n        // (at least not on Intel GPUs). So the safe solution is\n        // to ensure underflow-safety in all cases.\n        setOutput(\n          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))\n        );\n      }\n    "}}function _Z(e,t){return{dataId:t.dataId,dtype:t.dtype,shape:e.shape}}const AZ={kernelName:Ik,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{x:r}=t,a=n.texData.get(r.dataId),i=new TZ(r.shape),o=[_Z(r,a.complexTensorInfos.real),_Z(r,a.complexTensorInfos.imag)];return n.runWebGLProgram(i,o,o[0].dtype)}};class RZ{constructor(e){this.outputShape=[],this.outputShape=qR(e,1),this.variableNames=e.map((e,t)=>"T".concat(t));const t=new Array(e.length-1);t[0]=e[0][1];for(let i=1;i<t.length;i++)t[i]=t[i-1]+e[i][1];const n=["if (yC < ".concat(t[0],") setOutput(getT0(yR, yC));")];for(let i=1;i<t.length;i++){const e=t[i-1];n.push("else if (yC < ".concat(t[i],") ")+"setOutput(getT".concat(i,"(yR, yC-").concat(e,"));"))}const r=t.length,a=t[t.length-1];n.push("else setOutput(getT".concat(r,"(yR, yC-").concat(a,"));")),this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int yR = coords.x;\n        int yC = coords.y;\n\n        ".concat(n.join("\n        "),"\n      }\n    ")}}class FZ{constructor(e,t){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=qR(e,t);const n=this.outputShape,r=n.length,a=KY(r),i=mJ("coords",r),o=["x","y","z","w","u","v"].slice(0,r);this.variableNames=e.map((e,t)=>"T".concat(t));const s=new Array(e.length-1);s[0]=e[0][t];for(let p=1;p<s.length;p++)s[p]=s[p-1]+e[p][t];const c=o[t],l=o.slice(-2),u=o.join();let h="if (".concat(c," < ").concat(s[0],") {\n        return getChannel(\n            getT0(").concat(u,"), vec2(").concat(l.join(),"));\n        }");for(let p=1;p<s.length;p++){const e=s[p-1];h+="\n        if (".concat(c," < ").concat(s[p],"  && ").concat(c," >= ").concat(s[p-1],") {\n          return getChannel(\n            getT").concat(p,"(").concat(DZ(o,c,e),"),\n            vec2(").concat(DZ(l,c,e),"));\n        }")}const d=s.length,f=s[s.length-1];h+="\n        return getChannel(\n          getT".concat(d,"(").concat(DZ(o,c,f),"),\n          vec2(").concat(DZ(l,c,f),"));"),this.userCode="\n      float getValue(".concat(o.map(e=>"int "+e),") {\n        ").concat(h,"\n      }\n\n      void main() {\n        ").concat(a," coords = getOutputCoords();\n        vec4 result = vec4(getValue(").concat(i,"), 0., 0., 0.);\n\n        ").concat(i[r-1]," = ").concat(i[r-1]," + 1;\n        if (").concat(i[r-1]," < ").concat(n[r-1],") {\n          result.g = getValue(").concat(i,");\n        }\n\n        ").concat(i[r-2]," = ").concat(i[r-2]," + 1;\n        if (").concat(i[r-2]," < ").concat(n[r-2],") {\n          result.a = getValue(").concat(i,");\n        }\n\n        ").concat(i[r-1]," = ").concat(i[r-1]," - 1;\n        if (").concat(i[r-2]," < ").concat(n[r-2]," &&\n            ").concat(i[r-1]," < ").concat(n[r-1],") {\n          result.b = getValue(").concat(i,");\n        }\n        setOutput(result);\n      }\n    ")}}function DZ(e,t,n){const r=e.indexOf(t),a=e.map((e,t)=>t===r?"".concat(e," - ").concat(n):e);return a.join()}function OZ(e){const{inputs:t,backend:n}=e,{input:r}=t;return jJ({inputs:{x:n.texData.get(r.dataId).complexTensorInfos.imag},backend:n})}const LZ={kernelName:vS,backendName:"webgl",kernelFunc:OZ};function PZ(e,t,n){const r=e[0].dtype;if("complex64"===r){const r=e.map(e=>yZ({inputs:{input:e},backend:n})),a=e.map(e=>OZ({inputs:{input:e},backend:n})),i=PZ(r,t,n),o=PZ(a,t,n),s=zJ({inputs:{real:i,imag:o},backend:n});return r.forEach(e=>n.disposeIntermediateTensorInfo(e)),a.forEach(e=>n.disposeIntermediateTensorInfo(e)),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(o),s}let a=n.shouldExecuteOnCPU(e);if("string"===r&&(a=!0),a){const a=e.map(e=>{const r=bw(e.shape.slice(t));return iQ({inputs:{x:e},backend:n,attrs:{shape:[-1,r]}})}),i=a.map(e=>({vals:n.readSync(e.dataId),shape:e.shape})),o=qR(a.map(e=>e.shape),1),s=1===a[0].shape[0],c=C$(i,o,r,s),l=qR(e.map(e=>e.shape),t),u=n.makeTensorInfo(l,r,c);return a.forEach(e=>n.disposeIntermediateTensorInfo(e)),u}const i=e.filter(e=>bw(e.shape)>0),o=Yw().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&i[0].shape.length>1;if(1===i.length){const t=o?new kJ(e[0].shape,IJ):new TJ(e[0].shape,IJ);return n.runWebGLProgram(t,e,r)}const s=Yw().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER");if(i.length>s){const e=[];for(let a=0;a<i.length;a+=s){const r=i.slice(a,a+s);e.push(PZ(r,t,n))}const r=PZ(e,t,n);for(const t of e)n.disposeIntermediateTensorInfo(t);return r}if(o){const e=new FZ(i.map(e=>e.shape),t);return n.runWebGLProgram(e,i,r)}const{tensors2D:c,outShape:l}=function(e,t,n){const r=qR(e.map(e=>e.shape),t),a=e.map(e=>iQ({inputs:{x:e},attrs:{shape:[-1,bw(e.shape.slice(t))]},backend:n}));return{tensors2D:a,outShape:r}}(i,t,n),u=new RZ(c.map(e=>e.shape)),h=n.runWebGLProgram(u,c,r);c.forEach(e=>n.disposeIntermediateTensorInfo(e));const d=iQ({inputs:{x:h},attrs:{shape:l},backend:n});return n.disposeIntermediateTensorInfo(h),d}function MZ(e){const{inputs:t,backend:n,attrs:r}=e,{axis:a}=r,i=Cw(a,t[0].shape)[0],o=t.map(e=>e.shape);GR(o,i);const s=qR(t.map(e=>e.shape),i);if(0===bw(s))return n.makeTensorInfo(s,t[0].dtype,[]);const c=t.filter(e=>bw(e.shape)>0);return 1===c.length?jJ({inputs:{x:c[0]},backend:n}):PZ(c,i,n)}const jZ={kernelName:Tk,backendName:"webgl",kernelFunc:MZ};class BZ{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this.variableNames=["x","W"],this.outputShape=e.outShape;const i=e.padInfo.top,o=e.padInfo.left,s=e.strideHeight,c=e.strideWidth,l=e.dilationHeight,u=e.dilationWidth,h=e.filterHeight,d=e.filterWidth,f=4*Math.floor(e.inChannels/4),p=e.inChannels%4,m="channelsLast"===e.dataFormat,g=m?1:2,v=m?2:3,b=m?3:1;let y="",x="";n&&(y=r?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          ".concat(n,"\n        }"):a?"float activation(float a) {\n          float b = getLeakyreluAlphaAtOutCoords();\n          ".concat(n,"\n        }"):"\n          float activation(float x) {\n            ".concat(n,"\n          }\n        "),x="result = activation(result);");const w=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),a&&this.variableNames.push("leakyreluAlpha"),this.userCode="\n      ".concat(y,"\n\n      const ivec2 strides = ivec2(").concat(s,", ").concat(c,");\n      const ivec2 pads = ivec2(").concat(i,", ").concat(o,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d2 = coords[").concat(b,"];\n\n        ivec2 xRCCorner =\n            ivec2(coords[").concat(g,"], coords[").concat(v,"]) * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(h,"; wR++) {\n          int xR = xRCorner + wR * ").concat(l,";\n\n          if (xR < 0 || xR >= ").concat(e.inHeight,") {\n            continue;\n          }\n\n          for (int wC = 0; wC < ").concat(d,"; wC++) {\n            int xC = xCCorner + wC * ").concat(u,";\n\n            if (xC < 0 || xC >= ").concat(e.inWidth,") {\n              continue;\n            }\n\n            for (int d1 = 0; d1 < ").concat(f,"; d1 += 4) {\n              vec4 wValues = vec4(\n                getW(wR, wC, d1, d2),\n                getW(wR, wC, d1 + 1, d2),\n                getW(wR, wC, d1 + 2, d2),\n                getW(wR, wC, d1 + 3, d2)\n              );\n\n              if (").concat(m,") {\n                vec4 xValues = vec4(\n                  getX(batch, xR, xC, d1),\n                  getX(batch, xR, xC, d1 + 1),\n                  getX(batch, xR, xC, d1 + 2),\n                  getX(batch, xR, xC, d1 + 3)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec4 xValues = vec4(\n                  getX(batch, d1, xR, xC),\n                  getX(batch, d1 + 1, xR, xC),\n                  getX(batch, d1 + 2, xR, xC),\n                  getX(batch, d1 + 3, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n\n            if (").concat(1===p,") {\n\n              if (").concat(m,") {\n                dotProd +=\n                    getX(batch, xR, xC, ").concat(f,") *\n                    getW(wR, wC, ").concat(f,", d2);\n              } else {\n                dotProd +=\n                    getX(batch, ").concat(f,", xR, xC) *\n                    getW(wR, wC, ").concat(f,", d2);\n              }\n\n            } else if (").concat(2===p,") {\n              vec2 wValues = vec2(\n                getW(wR, wC, ").concat(f,", d2),\n                getW(wR, wC, ").concat(f," + 1, d2)\n              );\n\n              if (").concat(m,") {\n                vec2 xValues = vec2(\n                  getX(batch, xR, xC, ").concat(f,"),\n                  getX(batch, xR, xC, ").concat(f," + 1)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec2 xValues = vec2(\n                  getX(batch, ").concat(f,", xR, xC),\n                  getX(batch, ").concat(f," + 1, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            } else if (").concat(3===p,") {\n              vec3 wValues = vec3(\n                getW(wR, wC, ").concat(f,", d2),\n                getW(wR, wC, ").concat(f," + 1, d2),\n                getW(wR, wC, ").concat(f," + 2, d2)\n              );\n\n              if (").concat(m,") {\n                vec3 xValues = vec3(\n                  getX(batch, xR, xC, ").concat(f,"),\n                  getX(batch, xR, xC, ").concat(f," + 1),\n                  getX(batch, xR, xC, ").concat(f," + 2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec3 xValues = vec3(\n                  getX(batch, ").concat(f,", xR, xC),\n                  getX(batch, ").concat(f," + 1, xR, xC),\n                  getX(batch, ").concat(f," + 2, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            }\n          }\n        }\n\n        float result = dotProd;\n        ").concat(w,"\n        ").concat(x,"\n        setOutput(result);\n      }\n    ")}}class zZ{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const t=e.padInfo.front,n=e.padInfo.top,r=e.padInfo.left,a=e.strideDepth,i=e.strideHeight,o=e.strideWidth,s=e.dilationDepth,c=e.dilationHeight,l=e.dilationWidth,u=e.filterDepth,h=e.filterHeight,d=e.filterWidth,f=4*Math.floor(e.inChannels/4),p=e.inChannels%4;this.userCode="\n      const ivec3 strides = ivec3(".concat(a,", ").concat(i,", ").concat(o,");\n      const ivec3 pads = ivec3(").concat(t,", ").concat(n,", ").concat(r,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d2 = coords.u;\n\n        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xFCorner = xFRCCorner.x;\n        int xRCorner = xFRCCorner.y;\n        int xCCorner = xFRCCorner.z;\n\n        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get\n        // y(yF, yR, yC, d2). ? = to be determined. : = across all\n        // values in that axis.\n        float dotProd = 0.0;\n        for (int wF = 0; wF < ").concat(u,"; wF++) {\n          int xF = xFCorner + wF * ").concat(s,";\n\n          if (xF < 0 || xF >= ").concat(e.inDepth,") {\n            continue;\n          }\n\n          for (int wR = 0; wR < ").concat(h,"; wR++) {\n            int xR = xRCorner + wR * ").concat(c,";\n\n            if (xR < 0 || xR >= ").concat(e.inHeight,") {\n              continue;\n            }\n\n            for (int wC = 0; wC < ").concat(d,"; wC++) {\n              int xC = xCCorner + wC * ").concat(l,";\n\n              if (xC < 0 || xC >= ").concat(e.inWidth,") {\n                continue;\n              }\n\n              for (int d1 = 0; d1 < ").concat(f,"; d1 += 4) {\n                vec4 xValues = vec4(\n                  getX(batch, xF, xR, xC, d1),\n                  getX(batch, xF, xR, xC, d1 + 1),\n                  getX(batch, xF, xR, xC, d1 + 2),\n                  getX(batch, xF, xR, xC, d1 + 3)\n                );\n                vec4 wValues = vec4(\n                  getW(wF, wR, wC, d1, d2),\n                  getW(wF, wR, wC, d1 + 1, d2),\n                  getW(wF, wR, wC, d1 + 2, d2),\n                  getW(wF, wR, wC, d1 + 3, d2)\n                );\n\n                dotProd += dot(xValues, wValues);\n              }\n\n              if (").concat(1===p,") {\n                dotProd +=\n                  getX(batch, xF, xR, xC, ").concat(f,") *\n                  getW(wF, wR, wC, ").concat(f,", d2);\n              } else if (").concat(2===p,") {\n                vec2 xValues = vec2(\n                  getX(batch, xF, xR, xC, ").concat(f,"),\n                  getX(batch, xF, xR, xC, ").concat(f," + 1)\n                );\n                vec2 wValues = vec2(\n                  getW(wF, wR, wC, ").concat(f,", d2),\n                  getW(wF, wR, wC, ").concat(f," + 1, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else if (").concat(3===p,") {\n                vec3 xValues = vec3(\n                  getX(batch, xF, xR, xC, ").concat(f,"),\n                  getX(batch, xF, xR, xC, ").concat(f," + 1),\n                  getX(batch, xF, xR, xC, ").concat(f," + 2)\n                );\n                vec3 wValues = vec3(\n                  getW(wF, wR, wC, ").concat(f,", d2),\n                  getW(wF, wR, wC, ").concat(f," + 1, d2),\n                  getW(wF, wR, wC, ").concat(f," + 2, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}}class UZ{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=e$(this.outputShape.length);const i=e.padInfo.left,o=e.strideWidth,s=e.dilationWidth,c=e.filterHeight,l=e.filterWidth,u=l;let h="\n       int xR; int xC; int xCOffset;\n       vec4 wTexel; vec4 previous; vec4 final;";for(let m=0;m<l;m++)h+="\n           vec4 xTexelC".concat(2*m,";\n           int xTexelC").concat(2*m,"Ready;\n           vec4 xTexelC").concat(2*m+1,";\n           int xTexelC").concat(2*m+1,"Ready;\n           vec4 xC").concat(m,";");h+="\n     for (int r = 0; r < ".concat(c,"; r++) {\n      for (int d1 = 0; d1 < ").concat(e.inChannels,"; d1 += 2) {\n       ");for(let m=0;m<l;m++)h+="\n           xTexelC".concat(2*m," = vec4(0.0);\n           xTexelC").concat(2*m,"Ready = 0;\n           xTexelC").concat(2*m+1," = vec4(0.0);\n           xTexelC").concat(2*m+1,"Ready = 0;\n           xC").concat(m," = vec4(0.0);");h+="\n         xR = xRCorner + r * dilations[0];\n         if (xR >=0 && xR < inDims[0]) {\n       ";for(let m=0;m<(u+1)/2;m++){const t=2*m;if(h+="\n           xC = xCCorner + ".concat(t*s,";\n           "),1===o){if(t<l&&(i%2===1?(h+="\n                 xCOffset = xC + 1;\n                 if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC".concat(t,"Ready == 0) {\n                   xTexelC").concat(t," = getX(batch, xR, xCOffset, d1);\n\n                   // Need to manually clear unused channels in case\n                   // we're reading from recycled texture.\n                   if (xCOffset + 1 >= inDims[1]) {\n                     xTexelC").concat(t,".zw = vec2(0.0);\n                   }\n                   xTexelC").concat(t,"Ready = 1;\n                 }\n               "),h+=1===s&&t>0?"\n                 xC".concat(t," = vec4(xTexelC").concat(t-2,".zw, xTexelC").concat(t,".xy);\n                 "):"\n                   xCOffset = xC + 1 - 2;\n\n                   if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                     previous = getX(batch, xR, xCOffset, d1);\n\n                     // Need to manually clear unused channels in case\n                     // we're reading from recycled texture.\n                     if (xCOffset + 1 >= inDims[1]) {\n                       previous.zw = vec2(0.0);\n                     }\n\n                     xC".concat(t," = vec4(previous.zw, xTexelC").concat(t,".xy);\n                   } else {\n                     xC").concat(t," = vec4(0.0, 0.0, xTexelC").concat(t,".xy);\n                   }\n                   ")):h+="\n                 if (xC >= 0 && xC < inDims[1] && xTexelC".concat(t,"Ready == 0) {\n                   xTexelC").concat(t," = getX(batch, xR, xC, d1);\n                   if (xC + 1 >= inDims[1]) {\n                     xTexelC").concat(t,".zw = vec2(0.0);\n                   }\n                   xTexelC").concat(t,"Ready = 1;\n                 }\n\n                 xC").concat(t," = xTexelC").concat(t,";\n                 "),t+1<l)){const e=i%2===0?fw(s):s;s%2===0&&i%2===1||s%2!==0&&i%2!==1?(h+="\n                   xCOffset = xC + imod(pads[1], 2) + ".concat(e,";\n\n                   if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC").concat(t+1,"Ready == 0) {\n                     xTexelC").concat(t+1," = getX(batch, xR, xCOffset, d1);\n\n                     // Need to manually clear unused channels in case\n                     // we're reading from recycled texture.\n                     if (xCOffset + 1 >= inDims[1]) {\n                       xTexelC").concat(t+1,".zw = vec2(0.0);\n                     }\n                     xTexelC").concat(t+1,"Ready = 1;\n                   }\n                   "),h+=s>1?"\n                     xCOffset -= 2;\n                     if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                      previous = getX(batch, xR, xCOffset, d1);\n                      xC".concat(t+1," = vec4(previous.zw, xTexelC").concat(t+1,".xy);\n                     } else {\n                      xC").concat(t+1," = vec4(0.0, 0.0, xTexelC").concat(t+1,".xy);\n                     }\n                     "):"\n                     xC".concat(t+1," = vec4(xTexelC").concat(t,".zw, xTexelC").concat(t+1,".xy);\n                     ")):h+=1===e?"\n                     xC".concat(t+1," = xTexelC").concat(t,";\n                     "):"\n                     xCOffset = xC + ".concat(e,";\n\n                     if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC").concat(t+1,"Ready == 0) {\n                       xTexelC").concat(t+1," = getX(batch, xR, xCOffset, d1);\n                       if (xCOffset + 1 >= inDims[1]) {\n                         xTexelC").concat(t+1,".zw = vec2(0.0);\n                       }\n                       xTexelC").concat(t+1,"Ready = 1;\n                     }\n\n                     xC").concat(t+1," = xTexelC").concat(t+1,";\n                     ")}}else t<l&&(i%2===1?(h+="\n                 xCOffset = xC + 1 - strides[1];\n                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC".concat(t,"Ready == 0) {\n                   xTexelC").concat(t," = getX(batch, xR, xCOffset, d1);\n                   // Need to manually clear unused channels in case\n                   // we're reading from recycled texture.\n                   if (xCOffset + 1 >= inDims[1]) {\n                     xTexelC").concat(t,".zw = vec2(0.0);\n                   }\n                   xTexelC").concat(t,"Ready = 1;\n                 }\n\n                 if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC").concat(t+1,"Ready == 0) {\n                   xTexelC").concat(t+1," = getX(batch, xR, xC + 1, d1);\n                   // Need to manually clear unused channels in case\n                   // we're reading from recycled texture.\n                   if (xC + 2 >= inDims[1]) {\n                     xTexelC").concat(t+1,".zw = vec2(0.0);\n                   }\n                   xTexelC").concat(t+1,"Ready = 1;\n                 }\n\n                 xC").concat(t," = vec4(xTexelC").concat(t,".zw, xTexelC").concat(t+1,".zw);\n               "),t+1<l&&(h+="\n                   final = vec4(0.0);\n                   xCOffset = xC + 1 + strides[1];\n                   if(xCOffset >= 0 && xCOffset < inDims[1]) {\n                     final = getX(batch, xR, xCOffset, d1);\n                   }\n                   xC".concat(t+1," = vec4(xTexelC").concat(t+1,".xy, final.xy);\n                 "))):(h+="\n                 if(xC >= 0 && xC < inDims[1] && xTexelC".concat(t,"Ready == 0) {\n                   xTexelC").concat(t," = getX(batch, xR, xC, d1);\n                   if (xC + 1 >= inDims[1]) {\n                     xTexelC").concat(t,".zw = vec2(0.0);\n                   }\n                   xTexelC").concat(t,"Ready = 1;\n                 }\n\n                 xCOffset = xC + strides[1];\n                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC").concat(t+1,"Ready == 0) {\n                   xTexelC").concat(t+1," = getX(batch, xR, xCOffset, d1);\n                   if (xCOffset + 1 >= inDims[1]) {\n                     xTexelC").concat(t+1,".zw = vec2(0.);\n                   }\n                   xTexelC").concat(t+1,"Ready = 1;\n                 }\n\n                 xC").concat(t," = vec4(\n                   xTexelC").concat(t,".xy, xTexelC").concat(t+1,".xy);\n               "),t+1<l&&(h+="\n                   xC".concat(t+1," = vec4(xTexelC").concat(t,".zw, xTexelC").concat(t+1,".zw);\n                 "))));t<l&&(h+="\n             wTexel = getW(r, ".concat(t,", d1, d2);\n             dotProd += xC").concat(t,".xxzz * vec4(wTexel.xy, wTexel.xy);\n             if(d1 + 1 < ").concat(e.inChannels,") {\n               dotProd += xC").concat(t,".yyww * vec4(wTexel.zw, wTexel.zw);\n             }\n           "),t+1<l&&(h+="\n               wTexel = getW(r, ".concat(t+1,", d1, d2);\n               dotProd += xC").concat(t+1,".xxzz * vec4(wTexel.xy, wTexel.xy);\n               if(d1 + 1 < ").concat(e.inChannels,") {\n                 dotProd += xC").concat(t+1,".yyww * vec4(wTexel.zw, wTexel.zw);\n               }\n             ")))}h+="\n     }\n   ",h+="\n     }\n   ",h+="\n     }\n   ";let d="",f="";n&&(d=r?"vec4 activation(vec4 a) {\n           vec4 b = getPreluActivationWeightsAtOutCoords();\n           ".concat(n,"\n         }"):a?"vec4 activation(vec4 a) {\n           vec4 b = getLeakyreluAlphaAtOutCoords();\n           ".concat(n,"\n         }"):"vec4 activation(vec4 x) {\n           ".concat(n,"\n         }"),f="result = activation(result);");const p=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),a&&this.variableNames.push("leakyreluAlpha"),this.userCode="\n       ".concat(d,"\n\n       void main() {\n         ivec4 coords = getOutputCoords();\n         int batch = coords.x;\n         ivec2 xRCCorner = coords.yz * strides - pads;\n         int d2 = coords.w;\n         int xRCorner = xRCCorner.x;\n         int xCCorner = xRCCorner.y;\n\n         //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.\n         vec4 dotProd = vec4(0.000000000000001);\n\n         ").concat(h,"\n\n         vec4 result = dotProd - vec4(0.000000000000001);\n         ").concat(p,"\n         ").concat(f,"\n         setOutput(result);\n       }\n     ")}}class WZ{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec4"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=e,this.enableShapeUniforms=e$(this.outputShape.length);const{dataFormat:n}=t,r=RY(),a="channelsLast"===n,i=a?1:2,o=a?2:3,s=this.enableShapeUniforms?"if(blockIndex < outShape[2] && pos < outShape[1]) {":"if(blockIndex < ".concat(e[2]," && pos < ").concat(e[1],") {");let c="";for(let l=0;l<=1;l++)for(let e=0;e<=1;e++)c+="\n          blockIndex = rc.z + ".concat(e,";\n          pos = rc.y + ").concat(l,";\n\n          ").concat(s,"\n            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];\n            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);\n\n            if(d0 < inputShape[").concat(i,"] && d0 >= 0) {\n              // Use custom imod instead mod. On Intel GPU, mod may generate\n              // unexpected value.\n              // https://github.com/tensorflow/tfjs/issues/5447\n              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];\n              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /\n                  inChannels);\n\n              if(d1 < inputShape[").concat(o,"] && d1 >= 0) {\n\n                ch = imod(pos, inChannels);\n\n                if (").concat(a,") {\n                  innerDims = vec2(d1, ch);\n                  result[").concat(2*l+e,"] = getChannel(\n                    getA(rc.x, d0, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                } else {\n                  innerDims = vec2(d0, d1);\n                  result[").concat(2*l+e,"] = getChannel(\n                    getA(rc.x, ch, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                }\n              }\n            }\n          }\n        ");this.userCode="\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0);\n\n        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;\n        vec2 innerDims;\n\n        ".concat(c,"\n\n        ").concat(r.output," = result;\n      }\n    ")}}function VZ(e,t){const n=e.length;return n>=3?t?[...e.slice(0,-3),e[n-3]*e[n-2],e[n-1]]:[...e.slice(0,-3),e[n-3],e[n-2]*e[n-1]]:!t&&1===n&&e[0]>1?[e[0],1]:null}function HZ(e){let{x:t,filter:n,convInfo:r,backend:a,bias:i=null,preluActivationWeights:o=null,leakyreluAlpha:s=0,activation:c=null}=e;const l=t.shape,u=a.texData.get(t.dataId),h=r.inChannels,d=l[0]*l[1]*l[2],f=r.outChannels,p="channelsLast"===r.dataFormat,m=!1;let g;const v=[];if(null!=o){const e=VZ(o.shape,p);null!=e&&(o=iQ({inputs:{x:o},backend:a,attrs:{shape:e}}),v.push(o))}if(null!=i){const e=VZ(i.shape,p);null!=e&&(i=iQ({inputs:{x:i},backend:a,attrs:{shape:e}}),v.push(i))}if(!((1===d||1===f)&&h>1e3)&&u.isPacked&&p&&null!=u.texture&&l[2]%2!==0&&yw(u.shape.slice(-3),l.slice(-3))){const e=l[0]*l[1]*(l[2]+1),h={dataId:t.dataId,shape:[1,e,r.inChannels],dtype:t.dtype},d=u.shape;u.shape=u.shape.slice(),u.shape[u.shape.length-2]++,mw(kY(u.shape,h.shape),()=>"packed reshape ".concat(u.shape," to ").concat(h.shape," isn't free"));const f=iQ({inputs:{x:n},backend:a,attrs:{shape:[1,r.inChannels,r.outChannels]}});v.push(f);const p=vQ({a:h,b:f,backend:a,transposeA:false,transposeB:m,bias:i,activation:c,preluActivationWeights:o,leakyreluAlpha:s}),b=a.texData.get(p.dataId);mw(b.isPacked,()=>"batchMatMul result is expected to be packed"),u.shape=d,b.shape=r.outShape,g=jJ({inputs:{x:p},backend:a}),g.shape=r.outShape,v.push(p)}else{const e=r.outHeight*r.outWidth,l=iQ({inputs:{x:t},backend:a,attrs:{shape:p?[r.batchSize,e,r.inChannels]:[r.batchSize,r.inChannels,e]}}),u=iQ({inputs:{x:n},backend:a,attrs:{shape:[1,r.inChannels,r.outChannels]}}),h=vQ({a:p?l:u,b:p?u:l,transposeA:!p,transposeB:m,backend:a,bias:i,activation:c,preluActivationWeights:o,leakyreluAlpha:s});g=iQ({inputs:{x:h},backend:a,attrs:{shape:r.outShape}}),v.push(l),v.push(u),v.push(h)}for(const b of v)a.disposeIntermediateTensorInfo(b);return g}function GZ(e){let{x:t,filter:n,convInfo:r,backend:a,bias:i=null,preluActivationWeights:o=null,leakyreluAlpha:s=0,activation:c=null}=e;const{filterWidth:l,filterHeight:u,inChannels:h,outWidth:d,outHeight:f,dataFormat:p}=r,m="channelsLast"===p,g=l*u*h,v=f*d,b=[r.batchSize,g,v],y=[];if(null!=o){const e=VZ(o.shape,m);null!=e&&(o=iQ({inputs:{x:o},backend:a,attrs:{shape:e}}),y.push(o))}if(null!=i){const e=VZ(i.shape,m);null!=e&&(i=iQ({inputs:{x:i},backend:a,attrs:{shape:e}}),y.push(i))}const x=iQ({inputs:{x:n},backend:a,attrs:{shape:[1,g,bw(n.shape)/g]}});y.push(x);const w=new WZ(b,r),k=[t.shape,[r.padInfo.top,r.padInfo.left],[r.strideHeight,r.strideWidth],[r.dilationHeight,r.dilationWidth],[r.inChannels],[r.filterWidth*r.inChannels],[r.outWidth]],S=a.runWebGLProgram(w,[t],"float32",k),N=iQ({inputs:{x:S},backend:a,attrs:{shape:b}});y.push(S),y.push(N);const C=null!=i,E=null!=o,I="leakyrelu"===c,T=c?JJ(c,!0):null,_=new QJ(m?N.shape:x.shape,m?x.shape:N.shape,m?[r.batchSize,v,r.outChannels]:[r.batchSize,r.outChannels,v],!0,!1,C,T,E,I),A=m?[N,x]:[x,N];if(i&&A.push(i),E&&A.push(o),I){const e=a.makeTensorInfo([],"float32",PC(s,"float32"));A.push(e),y.push(e)}const R=a.runWebGLProgram(_,A,"float32"),F=iQ({inputs:{x:R},backend:a,attrs:{shape:r.outShape}});y.push(R);for(const D of y)a.disposeIntermediateTensorInfo(D);return F}const qZ={kernelName:_k,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,filter:i}=t,{strides:o,pad:s,dataFormat:c,dilations:l,dimRoundingMode:u}=r,h=JT(c),d=UT(a.shape,i.shape,o,l,s,u,!1,h);let f;if(1!==d.filterHeight||1!==d.filterWidth||1!==d.dilationHeight||1!==d.dilationWidth||1!==d.strideHeight||1!==d.strideWidth||"SAME"!==d.padInfo.type&&"VALID"!==d.padInfo.type)if(d.strideWidth<=2&&"channelsLast"===h&&Yw().getBool("WEBGL_EXP_CONV")){const e=new UZ(d),t=[[d.padInfo.top,d.padInfo.left],[d.strideHeight,d.strideWidth],[d.dilationHeight,d.dilationWidth],[d.inHeight,d.inWidth]];f=n.runWebGLProgram(e,[a,i],"float32",t)}else if(Yw().getBool("WEBGL_CONV_IM2COL"))f=GZ({x:a,filter:i,convInfo:d,backend:n});else{const e=new BZ(d);f=n.runWebGLProgram(e,[a,i],"float32")}else f=HZ({x:a,filter:i,convInfo:d,backend:n});const p=iQ({inputs:{x:f},backend:n,attrs:{shape:d.outShape}});return n.disposeIntermediateTensorInfo(f),p}};class KZ{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideHeight,n=e.strideWidth,r=e.padInfo.top,a=e.padInfo.left,i="channelsLast"===e.dataFormat;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int d2 = coords.w;\n\n        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int b = 0; b < ".concat(e.batchSize,"; b++) {\n          for (int yR = 0; yR < ").concat(e.outHeight,"; yR++) {\n            int xR = wR + yR * ").concat(t," - ").concat(r,";\n\n            if (xR < 0 || xR >= ").concat(e.inHeight,") {\n              continue;\n            }\n\n            for (int yC = 0; yC < ").concat(e.outWidth,"; yC++) {\n              int xC = wC + yC * ").concat(n," - ").concat(a,";\n\n              if (xC < 0 || xC >= ").concat(e.inWidth,") {\n                continue;\n              }\n\n              ").concat(i?"float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);":"float dyValue = getDy(b, d2, yR, yC);\n              float xValue = getX(b, d1, xR, xC);\n              dotProd += (xValue * dyValue);","\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}}class XZ{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,a=e.strideWidth,i="channelsLast"===e.dataFormat,o=t-1-e.padInfo.top,s=n-1-e.padInfo.left,c=i?1:2,l=i?2:3,u=i?3:1;this.userCode="\n      const ivec2 pads = ivec2(".concat(o,", ").concat(s,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[").concat(u,"];\n\n        ivec2 dyCorner = ivec2(coords[").concat(c,"], coords[").concat(l,"]) - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(t,"; wR++) {\n          float dyR = float(dyRCorner + wR) / ").concat(r,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(e.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = ").concat(t," - 1 - wR;\n\n          for (int wC = 0; wC < ").concat(n,"; wC++) {\n            float dyC = float(dyCCorner + wC) / ").concat(a,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(e.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = ").concat(n," - 1 - wC;\n\n            for (int d2 = 0; d2 < ").concat(e.outChannels,"; d2++) {\n\n              if (").concat(i,") {\n                float xValue = getDy(batch, idyR, idyC, d2);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              } else {\n                float xValue = getDy(batch, d2, idyR, idyC);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}}class YZ{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideDepth,n=e.strideHeight,r=e.strideWidth,a=e.padInfo.front,i=e.padInfo.top,o=e.padInfo.left;this.userCode="\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int wF = coords.x;\n        int wR = coords.y;\n        int wC = coords.z;\n        int d1 = coords.w;\n        int d2 = coords.u;\n\n        float dotProd = 0.0;\n\n        for (int b = 0; b < ".concat(e.batchSize,"; b++) {\n          for (int yF = 0; yF < ").concat(e.outDepth,"; yF++) {\n            int xF = wF + yF * ").concat(t," - ").concat(a,";\n\n            if (xF < 0 || xF >= ").concat(e.inDepth,") {\n              continue;\n            }\n\n            for (int yR = 0; yR < ").concat(e.outHeight,"; yR++) {\n              int xR = wR + yR * ").concat(n," - ").concat(i,";\n\n              if (xR < 0 || xR >= ").concat(e.inHeight,") {\n                continue;\n              }\n\n              for (int yC = 0; yC < ").concat(e.outWidth,"; yC++) {\n                int xC = wC + yC * ").concat(r," - ").concat(o,";\n\n                if (xC < 0 || xC >= ").concat(e.inWidth,") {\n                  continue;\n                }\n\n                float dyValue = getDy(b, yF, yR, yC, d2);\n                float xValue = getX(b, xF, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}}class $Z{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterDepth,n=e.filterHeight,r=e.filterWidth,a=e.strideDepth,i=e.strideHeight,o=e.strideWidth,s=t-1-e.padInfo.front,c=n-1-e.padInfo.top,l=r-1-e.padInfo.left;this.userCode="\n      const ivec3 pads = ivec3(".concat(s,", ").concat(c,", ").concat(l,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.u;\n\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyFCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        float dotProd = 0.0;\n        for (int wF = 0; wF < ").concat(t,"; wF++) {\n          float dyF = float(dyFCorner + wF) / ").concat(a,".0;\n\n          if (dyF < 0.0 || dyF >= ").concat(e.outDepth,".0 || fract(dyF) > 0.0) {\n            continue;\n          }\n          int idyF = int(dyF);\n\n          int wFPerm = ").concat(t," - 1 - wF;\n\n          for (int wR = 0; wR < ").concat(n,"; wR++) {\n            float dyR = float(dyRCorner + wR) / ").concat(i,".0;\n\n            if (dyR < 0.0 || dyR >= ").concat(e.outHeight,".0 ||\n              fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            int wRPerm = ").concat(n," - 1 - wR;\n\n            for (int wC = 0; wC < ").concat(r,"; wC++) {\n              float dyC = float(dyCCorner + wC) / ").concat(o,".0;\n\n              if (dyC < 0.0 || dyC >= ").concat(e.outWidth,".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              int wCPerm = ").concat(r," - 1 - wC;\n\n              for (int d2 = 0; d2 < ").concat(e.outChannels,"; d2++) {\n                float xValue = getDy(batch, idyF, idyR, idyC, d2);\n                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}}const JZ={kernelName:Ak,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,dy:i}=t,{strides:o,pad:s,dataFormat:c,dimRoundingMode:l,filterShape:u}=r,h=JT(c),d=UT(a.shape,u,o,1,s,l,!1,h),f=new KZ(d);return n.runWebGLProgram(f,[a,i],"float32")}};class QZ{constructor(e){this.variableNames=["dy","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"strides",type:"vec2"}],this.outputShape=e.inShape,this.enableShapeUniforms=e$(this.outputShape.length);const t=e.filterHeight,n=e.filterWidth,r=t-1-e.padInfo.top,a=n-1-e.padInfo.left;this.userCode="\n      const ivec2 pads = ivec2(".concat(r,", ").concat(a,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n\n        ivec2 dyCorner = ivec2(coords[1], coords[2]) - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        vec4 result = vec4(0.);\n        for (int wR = 0; wR < ").concat(t,"; wR++) {\n          float dyR = float(dyRCorner + wR) / strides[0];\n          if (dyR < 0.0 || dyR >= ").concat(e.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n          int wRPerm = ").concat(t," - 1 - wR;\n\n          for (int wC = 0; wC < ").concat(n,"; wC++) {\n            int wCPerm = ").concat(n," - 1 - wC;\n\n            float dyC = float(dyCCorner + wC) / strides[1];\n            bool idyCVal = (dyC >= 0.0) && (dyC < ").concat(e.outWidth,".0)\n              && (fract(dyC) == 0.0);\n            int idyC = int(dyC);\n\n            float dyC2 = float(dyCCorner + wC + 1) / strides[1];\n            bool idyCVal2 = (dyC2 >= 0.0) && (dyC2 < ").concat(e.outWidth,".0)\n              && (fract(dyC2) == 0.0);\n            int idyC2 = int(dyC2);\n\n            if (idyCVal && idyCVal2) {\n              for (int d2 = 0; d2 < ").concat(e.outChannels,"; d2 += 2) {\n                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);\n                vec4 dySample = getDy(batch, idyR, idyC, d2);\n                vec4 dySample2 = (idyC / 2 == idyC2 / 2) ?\n                  dySample : getDy(batch, idyR, idyC2, d2);\n\n                vec2 dyValue = mod(float(idyC), 2.) == 0. ?\n                  dySample.xy : dySample.zw;\n                result.xy += vec2(dot(dyValue, wValue.xy),\n                  dot(dyValue, wValue.zw));\n\n                dyValue = mod(float(idyC2), 2.) == 0. ?\n                  dySample2.xy : dySample2.zw;\n                result.zw += vec2(dot(dyValue, wValue.xy),\n                  dot(dyValue, wValue.zw));\n              }\n            } else if (idyCVal) {\n              for (int d2 = 0; d2 < ").concat(e.outChannels,"; d2 += 2) {\n                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);\n                vec4 dySample = getDy(batch, idyR, idyC, d2);\n                vec2 dyValue = mod(float(idyC), 2.) == 0. ?\n                  dySample.xy : dySample.zw;\n                result.xy += vec2(dot(dyValue, wValue.xy),\n                  dot(dyValue, wValue.zw));\n              }\n            } else if (idyCVal2) {\n              for (int d2 = 0; d2 < ").concat(e.outChannels,"; d2 += 2) {\n                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);\n                vec4 dySample = getDy(batch, idyR, idyC2, d2);\n                vec2 dyValue = mod(float(idyC2), 2.) == 0. ?\n                  dySample.xy : dySample.zw;\n                result.zw += vec2(dot(dyValue, wValue.xy),\n                  dot(dyValue, wValue.zw));\n              }\n            }\n          }\n        }\n        setOutput(result);\n      }\n    ")}}const ZZ={kernelName:Rk,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{dy:a,filter:i}=t,{inputShape:o,strides:s,pad:c,dataFormat:l,dimRoundingMode:u}=r,h=JT(l),d=UT(o,i.shape,s,1,c,u,!1,h);if(Yw().getBool("WEBGL_PACK_CONV2DTRANSPOSE")&&"channelsLast"===h){const e=[[d.strideHeight,d.strideWidth]],t=new QZ(d);return n.runWebGLProgram(t,[a,i],"float32",e)}{const e=new XZ(d);return n.runWebGLProgram(e,[a,i],"float32")}}};const e0={kernelName:Fk,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,filter:i}=t,{strides:o,pad:s,dilations:c}=r,l=WT(a.shape,i.shape,o,c,s),u=new zZ(l);return n.runWebGLProgram(u,[a,i],"float32")}};const t0={kernelName:Dk,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,dy:i}=t,{strides:o,pad:s,filterShape:c}=r,l=WT(a.shape,c,o,1,s),u=new YZ(l);return n.runWebGLProgram(u,[a,i],"float32")}};const n0={kernelName:Ok,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{dy:a,filter:i}=t,{pad:o,strides:s,inputShape:c}=r,l=WT(c,i.shape,s,1,o),u=new $Z(l);return n.runWebGLProgram(u,[a,i],"float32")}},r0=YJ({opSnippet:XJ+"\n  return cos(x);\n",packedOpSnippet:"\n  vec4 result = cos(x);\n  bvec4 isNaN = isnan(x);\n  ".concat(PJ,"\n  return result;\n")}),a0={kernelName:Lk,backendName:"webgl",kernelFunc:r0},i0=YJ({opSnippet:"\n  float e2x = exp(-x);\n  return (e2x + 1.0 / e2x) / 2.0;\n"}),o0={kernelName:Pk,backendName:"webgl",kernelFunc:i0};class s0{constructor(e,t,n,r,a){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];const[i,o,s,c]=e,[l]=t,[u,h]=n;this.outputShape=[l,u,h,c];const d="bilinear"===r?1:0,[f,p]=["".concat(o-1,".0"),"".concat(s-1,".0")],[m,g,v]=u>1?["".concat((o-1)/(u-1)),"(y2-y1) * height_ratio","y1*".concat(f," + float(y)*(height_scale)")]:["0.0","0.0","0.5 * (y1+y2) * ".concat(f)],[b,y,x]=h>1?["".concat((s-1)/(h-1)),"(x2-x1) * width_ratio","x1*".concat(p," + float(x)*(width_scale)")]:["0.0","0.0","0.5 * (x1+x2) * ".concat(p)];this.userCode="\n      const float height_ratio = float(".concat(m,");\n      const float width_ratio = float(").concat(b,");\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int y = coords[1];\n        int x = coords[2];\n        int d = coords[3];\n\n        // get box vals\n        float y1 = getBoxes(b,0);\n        float x1 = getBoxes(b,1);\n        float y2 = getBoxes(b,2);\n        float x2 = getBoxes(b,3);\n\n        // get image in batch index\n        int bInd = round(getBoxInd(b));\n        if(bInd < 0 || bInd >= ").concat(i,") {\n          return;\n        }\n\n        float height_scale = ").concat(g,";\n        float width_scale = ").concat(y,";\n\n        float in_y = ").concat(v,";\n        if( in_y < 0.0 || in_y > ").concat(f," ) {\n          setOutput(float(").concat(a,"));\n          return;\n        }\n        float in_x = ").concat(x,";\n        if( in_x < 0.0 || in_x > ").concat(p," ) {\n          setOutput(float(").concat(a,"));\n          return;\n        }\n\n        vec2 sourceFracIndexCR = vec2(in_x,in_y);\n        if(").concat(d," == 1) {\n          // Compute the four integer indices.\n          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);\n          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));\n\n          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);\n          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);\n          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);\n          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);\n\n          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);\n\n          float top = topLeft + (topRight - topLeft) * fracCR.x;\n          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;\n          float newValue = top + (bottom - top) * fracCR.y;\n          setOutput(newValue);\n        } else {\n          // Compute the coordinators of nearest neighbor point.\n          ivec2 sourceNearestCR = ivec2(floor(\n            sourceFracIndexCR + vec2(0.5,0.5)));\n          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);\n          setOutput(newValue);\n        }\n      }\n    ")}}const c0={kernelName:Bk,backendName:"webgl",kernelFunc:e=>{const{inputs:t,backend:n,attrs:r}=e,{image:a,boxes:i,boxInd:o}=t,{cropSize:s,method:c,extrapolationValue:l}=r,u=new s0(a.shape,i.shape,s,c,l);return n.runWebGLProgram(u,[a,i,o],"float32")}};var l0;!function(e){e.Prod="*",e.Sum="+"}(l0||(l0={}));class u0{constructor(e,t,n,r){this.op=e,this.outputShape=t,this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}];const a=this.outputShape.length,i=this.op===l0.Prod?"1.0":"0.0",o=n?i:"getX(".concat(h0(a,"coords",this.op),")"),s=this.outputShape[this.outputShape.length-1];let c="",l="";n?(c=r?"end != ".concat(s-1):"end != 0",l=r?"end + 1":"end - 1"):(c=r?"end + pow2 < ".concat(s):"end >= pow2",l=r?"end + pow2":"end - pow2"),this.userCode="\n      void main() {\n        ".concat(KY(a)," coords = getOutputCoords();\n        int end = ").concat(d0(a,"coords",this.op),";\n        float val = ").concat(o,";\n        int pow2 = int(pow(2.0, index));\n        if (").concat(c,") {\n          int idx = ").concat(l,";\n          ").concat(d0(a,"coords",this.op)," = idx;\n          val ").concat(this.op,"= getX(").concat(h0(a,"coords",this.op),");\n        }\n        setOutput(val);\n      }\n    ")}}function h0(e,t,n){if(1===e)return"".concat(t);if(2===e)return"".concat(t,".x, ").concat(t,".y");if(3===e)return"".concat(t,".x, ").concat(t,".y, ").concat(t,".z");if(4===e)return"".concat(t,".x, ").concat(t,".y, ").concat(t,".z, ").concat(t,".w");throw new Error("Cumulative ".concat(n," for rank ").concat(e," is not yet supported"))}function d0(e,t,n){if(1===e)return"".concat(t);if(2===e)return"".concat(t,".y");if(3===e)return"".concat(t,".z");if(4===e)return"".concat(t,".w");throw new Error("Cumulative ".concat(n," for rank ").concat(e," is not yet supported"))}function f0(e,t,n,r,a,i){const o=t.shape.length,s=H_([r],o);let c=t;null!=s&&(c=mQ({inputs:{x:t},backend:n,attrs:{perm:s}}));const l=q_(1,o)[0];if(l!==o-1)throw new Error("WebGL cumprod shader expects an inner-most axis=".concat(t.shape.length-1," ")+"but got axis=".concat(r));const u=c.shape[l];let h=jJ({inputs:{x:c},backend:n});for(let d=0;d<=Math.ceil(Math.log2(u))-1;d++){const t=new u0(e,c.shape,!1,i),r=[[d]],a=h;h=n.runWebGLProgram(t,[h],h.dtype,r),n.disposeIntermediateTensorInfo(a)}if(a){const t=new u0(e,c.shape,a,i),r=h;h=n.runWebGLProgram(t,[h],h.dtype),n.disposeIntermediateTensorInfo(r)}if(null!=s){const e=mQ({inputs:{x:h},backend:n,attrs:{perm:G_(s)}});return n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(c),e}return h}const p0={kernelName:Mk,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:i,exclusive:o,reverse:s}=r;return f0(l0.Prod,a,n,i,o,s)}};const m0={kernelName:jk,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:i,exclusive:o,reverse:s}=r;return f0(l0.Sum,a,n,i,o,s)}};const g0={kernelName:zk,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,weights:i}=t,{size:o,binaryOutput:s}=r;if(1===a.shape.length){const e=n.readSync(a.dataId),t=n.readSync(i.dataId),r=x$(e,t,i.dtype,i.shape,o);return n.makeTensorInfo([o],i.dtype,r)}if(2===a.shape.length){const e=n.bufferSync(a),t=n.bufferSync(i),r=w$(e,t,o,s);return n.makeTensorInfo(r.shape,i.dtype,r.values)}throw new Error("Error in denseBincount: input must be at most rank 2, but got rank"+"".concat(a.shape.length,"."))}};class v0{constructor(e,t,n){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=t,this.dataFormat=n,this.userCode="\n    void main() {\n      ivec4 coords = getOutputCoords();\n      int b = coords[0];\n      int h = ".concat(this.getHeightCoordString(),";\n      int w = ").concat(this.getWidthCoordString(),";\n      int d = ").concat(this.getDepthCoordString(),";\n\n      int in_h = h / ").concat(t,";\n      int offset_h = imod(h, ").concat(t,");\n      int in_w = w / ").concat(t,";\n      int offset_w = imod(w, ").concat(t,");\n      int offset_d = (offset_h * ").concat(t," + offset_w) *\n        ").concat(this.getOutputDepthSize(),";\n      int in_d = d + offset_d;\n\n      float result = ").concat(this.getInputSamplingString(),";\n      setOutput(result);\n    }\n  ")}getHeightCoordString(){return"NHWC"===this.dataFormat?"coords[1]":"coords[2]"}getWidthCoordString(){return"NHWC"===this.dataFormat?"coords[2]":"coords[3]"}getDepthCoordString(){return"NHWC"===this.dataFormat?"coords[3]":"coords[1]"}getOutputDepthSize(){return"NHWC"===this.dataFormat?this.outputShape[3]:this.outputShape[1]}getInputSamplingString(){return"NHWC"===this.dataFormat?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}const b0={kernelName:Uk,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{blockSize:i,dataFormat:o}=r,s=a.shape[0],c=("NHWC"===o?a.shape[1]:a.shape[2])*i,l=("NHWC"===o?a.shape[2]:a.shape[3])*i,u=("NHWC"===o?a.shape[3]:a.shape[1])/(i*i),h=new v0("NHWC"===o?[s,c,l,u]:[s,u,c,l],i,o);return n.runWebGLProgram(h,[a],a.dtype)}};class y0{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=e$(this.outputShape.length);const i=e.filterHeight,o=e.filterWidth,s=e.outChannels/e.inChannels;let c="",l="";n&&(c=r?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          ".concat(n,"\n        }"):a?"float activation(float a) {\n          float b = getLeakyreluAlphaAtOutCoords();\n          ".concat(n,"\n        }"):"\n          float activation(float x) {\n            ".concat(n,"\n          }\n        "),l="result = activation(result);");const u=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),a&&this.variableNames.push("leakyreluAlpha"),this.userCode="\n      ".concat(c,"\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / ").concat(s,";\n        int q = d2 - d1 * ").concat(s,";\n\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.\n        for (int wR = 0; wR < ").concat(i,"; wR++) {\n          int xR = xRCorner + wR * dilations[0];\n\n          if (xR < 0 || xR >= inDims[0]) {\n            continue;\n          }\n\n          for (int wC = 0; wC < ").concat(o,"; wC++) {\n            int xC = xCCorner + wC * dilations[1];\n\n            if (xC < 0 || xC >= inDims[1]) {\n              continue;\n            }\n\n            float xVal = getX(batch, xR, xC, d1);\n            float wVal = getW(wR, wC, d1, q);\n            dotProd += xVal * wVal;\n          }\n        }\n\n        float result = dotProd;\n        ").concat(u,"\n        ").concat(l,"\n        setOutput(result);\n      }\n    ")}}class x0{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=e$(this.outputShape.length);const i=e.outChannels/e.inChannels,o=e.padInfo.left,s=e.strideWidth,c=e.dilationWidth,l=e.filterHeight,u=e.filterWidth,h=u;let d="\n      int xR; int xC; int xCOffset;\n      vec4 wTexel; vec4 previous; vec4 final;";for(let g=0;g<u;g++)d+="\n          vec4 xTexelC".concat(2*g,";\n          int xTexelC").concat(2*g,"Ready;\n          vec4 xTexelC").concat(2*g+1,";\n          int xTexelC").concat(2*g+1,"Ready;\n          vec4 xC").concat(g,";");d+="\n    for (int r = 0; r < ".concat(l,"; r++) {\n      ");for(let g=0;g<u;g++)d+="\n          xTexelC".concat(2*g," = vec4(0.0);\n          xTexelC").concat(2*g,"Ready = 0;\n          xTexelC").concat(2*g+1," = vec4(0.0);\n          xTexelC").concat(2*g+1,"Ready = 0;\n          xC").concat(g," = vec4(0.0);");d+="\n        xR = xRCorner + r * dilations[0];\n        if (xR >=0 && xR < inDims[0]) {\n      ";for(let g=0;g<(h+1)/2;g++){const e=2*g;if(d+="\n          xC = xCCorner + ".concat(e*c,";\n          "),1===s){if(e<u&&(o%2===1?(d+="\n                xCOffset = xC + 1;\n                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC".concat(e,"Ready == 0) {\n                  xTexelC").concat(e," = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if (xCOffset + 1 >= inDims[1]) {\n                    xTexelC").concat(e,".zw = vec2(0.0);\n                  }\n                  xTexelC").concat(e,"Ready = 1;\n                }\n              "),d+=1===c&&e>0?"\n                xC".concat(e," = vec4(xTexelC").concat(e-2,".zw, xTexelC").concat(e,".xy);\n                "):"\n                  xCOffset = xC + 1 - 2;\n\n                  if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                    previous = getX(batch, xR, xCOffset, d1);\n\n                    // Need to manually clear unused channels in case\n                    // we're reading from recycled texture.\n                    if (xCOffset + 1 >= inDims[1]) {\n                      previous.zw = vec2(0.0);\n                    }\n\n                    xC".concat(e," = vec4(previous.zw, xTexelC").concat(e,".xy);\n                  } else {\n                    xC").concat(e," = vec4(0.0, 0.0, xTexelC").concat(e,".xy);\n                  }\n                  ")):d+="\n                if (xC >= 0 && xC < inDims[1] && xTexelC".concat(e,"Ready == 0) {\n                  xTexelC").concat(e," = getX(batch, xR, xC, d1);\n                  if (xC + 1 >= inDims[1]) {\n                    xTexelC").concat(e,".zw = vec2(0.0);\n                  }\n                  xTexelC").concat(e,"Ready = 1;\n                }\n\n                xC").concat(e," = xTexelC").concat(e,";\n                "),e+1<u)){const t=o%2===0?fw(c):c;c%2===0&&o%2===1||c%2!==0&&o%2!==1?(d+="\n                  xCOffset = xC + imod(pads[1], 2) + ".concat(t,";\n\n                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC").concat(e+1,"Ready == 0) {\n                    xTexelC").concat(e+1," = getX(batch, xR, xCOffset, d1);\n\n                    // Need to manually clear unused channels in case\n                    // we're reading from recycled texture.\n                    if (xCOffset + 1 >= inDims[1]) {\n                      xTexelC").concat(e+1,".zw = vec2(0.0);\n                    }\n                    xTexelC").concat(e+1,"Ready = 1;\n                  }\n                  "),d+=c>1?"\n                    xCOffset -= 2;\n                    if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                     previous = getX(batch, xR, xCOffset, d1);\n                     xC".concat(e+1," = vec4(previous.zw, xTexelC").concat(e+1,".xy);\n                    } else {\n                     xC").concat(e+1," = vec4(0.0, 0.0, xTexelC").concat(e+1,".xy);\n                    }\n                    "):"\n                    xC".concat(e+1," = vec4(xTexelC").concat(e,".zw, xTexelC").concat(e+1,".xy);\n                    ")):d+=1===t?"\n                    xC".concat(e+1," = xTexelC").concat(e,";\n                    "):"\n                    xCOffset = xC + ".concat(t,";\n\n                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC").concat(e+1,"Ready == 0) {\n                      xTexelC").concat(e+1," = getX(batch, xR, xCOffset, d1);\n                      if (xCOffset + 1 >= inDims[1]) {\n                        xTexelC").concat(e+1,".zw = vec2(0.0);\n                      }\n                      xTexelC").concat(e+1,"Ready = 1;\n                    }\n\n                    xC").concat(e+1," = xTexelC").concat(e+1,";\n                    ")}}else e<u&&(o%2===1?(d+="\n                xCOffset = xC + 1 - strides[1];\n                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC".concat(e,"Ready == 0) {\n                  xTexelC").concat(e," = getX(batch, xR, xCOffset, d1);\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if (xCOffset + 1 >= inDims[1]) {\n                    xTexelC").concat(e,".zw = vec2(0.0);\n                  }\n                  xTexelC").concat(e,"Ready = 1;\n                }\n\n                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC").concat(e+1,"Ready == 0) {\n                  xTexelC").concat(e+1," = getX(batch, xR, xC + 1, d1);\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if (xC + 2 >= inDims[1]) {\n                    xTexelC").concat(e+1,".zw = vec2(0.0);\n                  }\n                  xTexelC").concat(e+1,"Ready = 1;\n                }\n\n                xC").concat(e," = vec4(xTexelC").concat(e,".zw, xTexelC").concat(e+1,".zw);\n              "),e+1<u&&(d+="\n                  final = vec4(0.0);\n                  xCOffset = xC + 1 + strides[1];\n                  if(xCOffset >= 0 && xCOffset < inDims[1]) {\n                    final = getX(batch, xR, xCOffset, d1);\n                  }\n                  xC".concat(e+1," = vec4(xTexelC").concat(e+1,".xy, final.xy);\n                "))):(d+="\n                if(xC >= 0 && xC < inDims[1] && xTexelC".concat(e,"Ready == 0) {\n                  xTexelC").concat(e," = getX(batch, xR, xC, d1);\n                  if (xC + 1 >= inDims[1]) {\n                    xTexelC").concat(e,".zw = vec2(0.0);\n                  }\n                  xTexelC").concat(e,"Ready = 1;\n                }\n\n                xCOffset = xC + strides[1];\n                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC").concat(e+1,"Ready == 0) {\n                  xTexelC").concat(e+1," = getX(batch, xR, xCOffset, d1);\n                  if (xCOffset + 1 >= inDims[1]) {\n                    xTexelC").concat(e+1,".zw = vec2(0.);\n                  }\n                  xTexelC").concat(e+1,"Ready = 1;\n                }\n\n                xC").concat(e," = vec4(\n                  xTexelC").concat(e,".xy, xTexelC").concat(e+1,".xy);\n              "),e+1<u&&(d+="\n                  xC".concat(e+1," = vec4(xTexelC").concat(e,".zw, xTexelC").concat(e+1,".zw);\n                "))));e<u&&(d+="\n            wTexel = getW(r, ".concat(e,", d1, q);\n            dotProd += xC").concat(e," * vec4(wTexel.xz, wTexel.xz);\n          "),e+1<u&&(d+="\n              wTexel = getW(r, ".concat(e+1,", d1, q);\n              dotProd += xC").concat(e+1," * vec4(wTexel.xz, wTexel.xz);\n            ")))}d+="\n    }\n  ",d+="\n      }\n    ";let f="",p="";n&&(f=r?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          ".concat(n,"\n        }"):a?"vec4 activation(vec4 a) {\n          vec4 b = getLeakyreluAlphaAtOutCoords();\n          ".concat(n,"\n        }"):"vec4 activation(vec4 x) {\n          ".concat(n,"\n        }"),p="result = activation(result);");const m=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),a&&this.variableNames.push("leakyreluAlpha"),this.userCode="\n      ".concat(f,"\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / ").concat(i,";\n        int q = d2 - d1 * ").concat(i,";\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.\n        vec4 dotProd = vec4(0.000000000000001);\n\n        ").concat(d,"\n\n        vec4 result = dotProd - vec4(0.000000000000001);\n        ").concat(m,"\n        ").concat(p,"\n        setOutput(result);\n      }\n    ")}}const w0={kernelName:Wk,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,filter:i}=t,{strides:o,pad:s,dilations:c,dimRoundingMode:l}=r;let u=c;null==u&&(u=[1,1]),mw(YT(o,u),()=>"Error in depthwiseConv2d: Either strides or dilations must be "+"1. Got strides ".concat(o," and dilations '").concat(u,"'"));const h=UT(a.shape,i.shape,o,u,s,l,!0);let d;d=Yw().getBool("WEBGL_PACK_DEPTHWISECONV")&&h.strideWidth<=2&&h.outChannels/h.inChannels===1?new x0(h):new y0(h);const f=[[h.padInfo.top,h.padInfo.left],[h.strideHeight,h.strideWidth],[h.dilationHeight,h.dilationWidth],[h.inHeight,h.inWidth]];return n.runWebGLProgram(d,[a,i],"float32",f)}};class k0{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideHeight,n=e.strideWidth,r=e.padInfo.top,a=e.padInfo.left,i=e.outChannels/e.inChannels;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int dm = coords.w;\n        int d2 = d1 * ".concat(i," + dm;\n\n        float dotProd = 0.0;\n\n        // TO DO: Vec4 over the batch size\n        for (int b = 0; b < ").concat(e.batchSize,"; b++) {\n          for (int yR = 0; yR < ").concat(e.outHeight,"; yR++) {\n            int xR = wR + yR * ").concat(t," - ").concat(r,";\n\n            if (xR < 0 || xR >= ").concat(e.inHeight,") {\n              continue;\n            }\n\n            for (int yC = 0; yC < ").concat(e.outWidth,"; yC++) {\n              int xC = wC + yC * ").concat(n," - ").concat(a,";\n\n              if (xC < 0 || xC >= ").concat(e.inWidth,") {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}}class S0{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,a=e.strideWidth,i=t-1-e.padInfo.top,o=n-1-e.padInfo.left,s=e.outChannels/e.inChannels;this.userCode="\n      const ivec2 pads = ivec2(".concat(i,", ").concat(o,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        float dotProd = 0.0;\n\n        for (int wR = 0; wR < ").concat(t,"; wR++) {\n          float dyR = float(dyRCorner + wR) / ").concat(r,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(e.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = ").concat(t," - 1 - wR;\n\n          for (int wC = 0; wC < ").concat(n,"; wC++) {\n            float dyC = float(dyCCorner + wC) / ").concat(a,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(e.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = ").concat(n," - 1 - wC;\n\n            // TO DO: Vec4 over the channelMul\n            for (int dm = 0; dm < ").concat(s,"; dm++) {\n              int d2 = d1 * ").concat(s," + dm;\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, dm);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}}const N0={kernelName:Vk,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,dy:i}=t,{strides:o,dilations:s,pad:c,dimRoundingMode:l,filterShape:u}=r,h=UT(a.shape,u,o,s,c,l,!0),d=new k0(h);return n.runWebGLProgram(d,[a,i],"float32")}};const C0={kernelName:Hk,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{dy:a,filter:i}=t,{strides:o,dilations:s,pad:c,dimRoundingMode:l,inputShape:u}=r,h=UT(u,i.shape,o,s,c,l,!0),d=new S0(h);return n.runWebGLProgram(d,[a,i],"float32")}};class E0{constructor(e){this.variableNames=["X"],this.outputShape=[e,e],this.userCode="\n      void main() {\n          ivec2 coords = getOutputCoords();\n          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;\n          setOutput(val);\n      }\n    "}}const I0={kernelName:Gk,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{x:r}=t,a=[...r.shape,...r.shape],i=bw(r.shape),o=iQ({inputs:{x:r},backend:n,attrs:{shape:[i]}}),s=new E0(i),c=n.runWebGLProgram(s,[o],o.dtype),l=iQ({inputs:{x:c},backend:n,attrs:{shape:a}});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(c),l}};class T0{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const{inHeight:t,inWidth:n,padInfo:r,strideHeight:a,strideWidth:i,filterHeight:o,filterWidth:s,dilationHeight:c,dilationWidth:l}=e,{top:u,left:h}=r;this.userCode="\n      const ivec2 strides = ivec2(".concat(a,", ").concat(i,");\n      const ivec2 pads = ivec2(").concat(u,", ").concat(h,");\n      const float neg_infinity = -3.4e38;\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.w;\n        ivec2 outTopLeftCorner =\n            coords.yz * strides - pads;\n        int hBeg = outTopLeftCorner.x;\n        int wBeg = outTopLeftCorner.y;\n\n        float curVal = neg_infinity;\n        for (int h = 0; h < ").concat(o,"; h++) {\n          int hIn = hBeg + h * ").concat(c,";\n\n          if (hIn >= 0 && hIn < ").concat(t,") {\n            for (int w = 0; w < ").concat(s,"; w++) {\n              int wIn = wBeg + w * ").concat(l,";\n\n              if (wIn >= 0 && wIn < ").concat(n,") {\n                float xVal = getX(batch, hIn, wIn, d1);\n                float wVal = getW(h, w, d1);\n\n                float val = xVal + wVal;\n                if (val > curVal) {\n                  curVal = val;\n                }\n              }\n            }\n          }\n        }\n\n        float result = curVal;\n        setOutput(result);\n      }\n    ")}}const _0={kernelName:qk,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,filter:i}=t,{strides:o,pad:s,dilations:c}=r,l=jT(a.shape,i.shape,o,s,"NHWC",c);let u;const h=new T0(l);u=n.runWebGLProgram(h,[a,i],"float32");const d=iQ({inputs:{x:u},backend:n,attrs:{shape:l.outShape}});return n.disposeIntermediateTensorInfo(u),d}};const A0={kernelName:Jk,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{equation:a}=r,i=t,{allDims:o,summedDims:s,idDims:c}=AF(a,i.length);FF(o.length,c,i);const{path:l,steps:u}=DF(s,c),h=u.length;let d=null,f=o.length;const p=[];for(let m=0;m<h;++m){for(const e of u[m]){const{permutationIndices:t,expandDims:r}=RF(f,c[e]);let a;OF(t)?a=i[e]:(a=mQ({inputs:{x:i[e]},backend:n,attrs:{perm:t}}),p.push(a));const o=a.shape.slice();for(let e=0;e<r.length;++e)o.splice(r[e],0,1);yw(a.shape,o)||(a=iQ({inputs:{x:a},backend:n,attrs:{shape:o}}),p.push(a)),null===d?d=a:(d=rQ({inputs:{a:a,b:d},backend:n}),p.push(d))}m<h-1&&(l[m]>=0&&(d=fQ({inputs:{x:d},backend:n,attrs:{axis:l[m]-(o.length-f),keepDims:!1}}),p.push(d)),f--)}for(const m of p)m!==d&&n.disposeIntermediateTensorInfo(m);return d}},R0=YJ({opSnippet:"return (x >= 0.0) ? x : (exp(x) - 1.0);",packedOpSnippet:"\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n"}),F0={kernelName:Qk,backendName:"webgl",kernelFunc:R0},D0={kernelName:Zk,backendName:"webgl",kernelFunc:e=>{const{inputs:t,backend:n}=e,{dy:r,y:a}=t,i=Yw().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new MJ("\n  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));\n  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));\n",r.shape,a.shape):new LJ("return (b >= 0.0) ? a : a * (b + 1.0);",r.shape,a.shape);return n.runWebGLProgram(i,[r,a],r.dtype)}},O0=$J({opSnippet:"return float(a == b);",packedOpSnippet:"\n  return vec4(equal(a, b));\n",dtype:"bool",cpuKernelImpl:E$}),L0={kernelName:tS,backendName:"webgl",kernelFunc:O0},P0=YJ({opSnippet:'\n  // Error function is calculated approximately with elementary function.\n  // See "Handbook of Mathematical Functions with Formulas,\n  // Graphs, and Mathematical Tables", Abramowitz and Stegun.\n  float p = '.concat(dF,";\n  float a1 = ").concat(fF,";\n  float a2 = ").concat(pF,";\n  float a3 = ").concat(mF,";\n  float a4 = ").concat(gF,";\n  float a5 = ").concat(vF,";\n\n  float sign = sign(x);\n  x = abs(x);\n  float t = 1.0 / (1.0 + p * x);\n  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));\n")}),M0={kernelName:eS,backendName:"webgl",kernelFunc:P0},j0=YJ({opSnippet:XJ+"\n  return exp(x);\n",packedOpSnippet:"\n  vec4 result = exp(x);\n  bvec4 isNaN = isnan(x);\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",cpuKernelImpl:I$,dtype:"float32"}),B0={kernelName:nS,backendName:"webgl",kernelFunc:j0};function z0(e){const{inputs:t,attrs:n,backend:r}=e,{dim:a}=n,{input:i}=t,o=i.shape.length,s=i.shape.slice();let c=a;return a<0&&(mw(-(o+1)<=a,()=>"Axis must be in the interval [".concat(-(o+1),", ").concat(o,"]")),c=o+a+1),s.splice(c,0,1),iQ({inputs:{x:i},backend:r,attrs:{shape:s}})}const U0={kernelName:rS,backendName:"webgl",kernelFunc:z0},W0="return exp(x) - 1.0;",V0=YJ({opSnippet:W0,packedOpSnippet:W0,cpuKernelImpl:T$}),H0={kernelName:aS,backendName:"webgl",kernelFunc:V0};class G0{constructor(e,t,n){this.variableNames=["real","imag"];const r=t[1];this.outputShape=t;const a=n?"2.0 * ".concat(Math.PI):"-2.0 * ".concat(Math.PI),i=n?"".concat(r,".0"):"1.0";let o;if("real"===e)o="return real * expR - imag * expI;";else{if("imag"!==e)throw new Error('FFT component must be either "real" or "imag", got '.concat(e,"."));o="return real * expI + imag * expR;"}this.userCode="\n      const float exponentMultiplier = ".concat(a,";\n\n      float unaryOpComplex(float real, float expR, float imag, float expI) {\n        ").concat(o,"\n      }\n\n      float mulMatDFT(int batch, int index) {\n        float indexRatio = float(index) / float(").concat(r,");\n        float exponentMultiplierTimesIndexRatio =\n            exponentMultiplier * indexRatio;\n\n        float result = 0.0;\n\n        for (int i = 0; i < ").concat(r,"; i++) {\n          // x = (-2|2 * PI / N) * index * i;\n          float x = exponentMultiplierTimesIndexRatio * float(i);\n          float expR = cos(x);\n          float expI = sin(x);\n          float real = getReal(batch, i);\n          float imag = getImag(batch, i);\n\n          result +=\n              unaryOpComplex(real, expR, imag, expI) / ").concat(i,";\n        }\n\n        return result;\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        setOutput(mulMatDFT(coords[0], coords[1]));\n      }\n    ")}}function q0(e,t,n){const r=n.texData.get(e.dataId),a=bw(e.shape),i=e.shape[e.shape.length-1],o=iQ({inputs:{x:e},backend:n,attrs:{shape:[a/i,i]}}),s=o.shape,c=new G0("real",s,t),l=new G0("imag",s,t),u=[{dataId:r.complexTensorInfos.real.dataId,dtype:r.complexTensorInfos.real.dtype,shape:s},{dataId:r.complexTensorInfos.imag.dataId,dtype:r.complexTensorInfos.imag.dtype,shape:s}],h=n.runWebGLProgram(c,u,"float32"),d=n.runWebGLProgram(l,u,"float32"),f=zJ({inputs:{real:h,imag:d},backend:n});n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(d);const p=iQ({inputs:{x:f},backend:n,attrs:{shape:e.shape}});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(f),p}const K0={kernelName:iS,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{input:r}=t;return q0(r,!1,n)}};class X0{constructor(e,t){this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=e,this.userCode="\n      void main() {\n        // Input can be obtained from uniform value.\n        setOutput(value);\n      }\n    "}}function Y0(e){const{backend:t,attrs:n}=e,{shape:r,value:a}=n;let{dtype:i}=n;if(i=i||Dw(a),"string"===i){const e=Tw(i,bw(r));return e.fill(a),t.makeTensorInfo(r,i,e)}{const e=new X0(r,a),n=[[a]];return t.runWebGLProgram(e,[],i,n)}}const $0={kernelName:oS,backendName:"webgl",kernelFunc:Y0};class J0{constructor(e){this.variableNames=["Image"],this.outputShape=[];const t=e[2];this.outputShape=e,this.userCode="\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int x = coords[2];\n\n          int coordX = ".concat(t," - x - 1;\n          float outputValue;\n          if(coordX >= 0 && coordX < ").concat(t,") {\n            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);\n          } else {\n            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);\n          }\n          setOutput(outputValue);\n        }\n    ")}}const Q0={kernelName:sS,backendName:"webgl",kernelFunc:e=>{let{inputs:t,backend:n}=e;const{image:r}=t,a=n,i=new J0(r.shape);return a.runWebGLProgram(i,[r],r.dtype)}},Z0="return floor(x);",e1=YJ({opSnippet:Z0,packedOpSnippet:Z0,cpuKernelImpl:_$}),t1={kernelName:cS,backendName:"webgl",kernelFunc:e1},n1=$J({opSnippet:"\n  float s = sign(a) * sign(b);\n  int ia = round(a);\n  int ib = round(b);\n  if (ib != 0) {\n    // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n    return float(idiv(ia, ib, s));\n  } else {\n    return NAN;\n  }\n",packedOpSnippet:"\n  ivec4 ia = round(a);\n  ivec4 ib = round(b);\n  bvec4 cond = notEqual(ib, ivec4(0));\n  ivec4 result = ivec4(0);\n  vec4 s = sign(a) * sign(b);\n\n  // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n  if (cond[0]) {\n    result[0] = idiv(ia[0], ib[0], s[0]);\n  }\n  if (cond[1]) {\n    result[1] = idiv(ia[1], ib[1], s[1]);\n  }\n  if (cond[2]) {\n    result[2] = idiv(ia[2], ib[2], s[2]);\n  }\n  if (cond[3]) {\n    result[3] = idiv(ia[3], ib[3], s[3]);\n  }\n  return vec4(result);\n",dtype:"int32"}),r1={kernelName:lS,backendName:"webgl",kernelFunc:n1};class a1{constructor(e){this.variableNames=["A"];const t=RY(),[n,r]=e;this.outputShape=e,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(".concat(r,".0, ").concat(n,".0);\n\n        vec4 values = ").concat(t.texture2D,"(A, uv);\n        float value;\n        if (depth == 0) {\n          value = values.r;\n        } else if (depth == 1) {\n          value = values.g;\n        } else if (depth == 2) {\n          value = values.b;\n        } else if (depth == 3) {\n          value = values.a;\n        }\n\n        setOutput(floor(value * 255.0 + 0.5));\n      }\n    ")}}class i1{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;const t=RY(),[n,r]=e;this.outputShape=e,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n\n        vec4 result = vec4(0.);\n\n        for(int row=0; row<=1; row++) {\n          for(int col=0; col<=1; col++) {\n            texC = coords[1] + row;\n            depth = coords[2] + col;\n\n            vec2 uv = (vec2(texC, texR) + halfCR) /\n                       vec2(".concat(r,".0, ").concat(n,".0);\n            vec4 values = ").concat(t.texture2D,"(A, uv);\n            float value;\n            if (depth == 0) {\n              value = values.r;\n            } else if (depth == 1) {\n              value = values.g;\n            } else if (depth == 2) {\n              value = values.b;\n            } else if (depth == 3) {\n              value = values.a;\n            }\n\n            result[row * 2 + col] = floor(value * 255.0 + 0.5);\n          }\n        }\n\n        ").concat(t.output," = result;\n      }\n    ")}}const o1={kernelName:oC,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e;let{pixels:a}=t;const{numChannels:i}=r,o="undefined"!==typeof HTMLVideoElement&&a instanceof HTMLVideoElement,s="undefined"!==typeof HTMLImageElement&&a instanceof HTMLImageElement,[c,l]=o?[a.videoWidth,a.videoHeight]:[a.width,a.height],u=[l,c],h=[l,c,i];if(s||o){const e=Yw().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");null!=s1&&e===c1||(c1=e,s1=document.createElement("canvas").getContext("2d",{willReadFrequently:c1})),s1.canvas.width=c,s1.canvas.height=l,s1.drawImage(a,0,0,c,l),a=s1.canvas}const d=n.makeTensorInfo(u,"int32");n.texData.get(d.dataId).usage=ZX.PIXELS,n.gpgpu.uploadPixelDataToTexture(n.getTexture(d.dataId),a);const f=Yw().getBool("WEBGL_PACK")?new i1(h):new a1(h),p=n.runWebGLProgram(f,[d],"int32");return n.disposeData(d.dataId),p}};let s1,c1=Yw().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");const l1={kernelName:lC,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,filter:i,bias:o,preluActivationWeights:s}=t,{strides:c,pad:l,dataFormat:u,dilations:h,dimRoundingMode:d,activation:f,leakyreluAlpha:p}=r,m=JT(u),g=UT(a.shape,i.shape,c,h,l,d,!1,m);let v;const b=[],y=null!=o,x=null!=s,w="leakyrelu"===f,k=()=>{const e=[a,i],t=(e,t)=>{if("NCHW"===t&&1===e.shape.length&&1!==e.shape[0]){const t=iQ({inputs:{x:e},backend:n,attrs:{shape:[e.shape[0],1,1]}});return b.push(t),t}return e};if(y&&e.push(t(o,u)),x&&e.push(t(s,u)),w){const t=n.makeTensorInfo([],"float32",PC(p,"float32"));e.push(t),b.push(t)}return e};if(1!==g.filterHeight||1!==g.filterWidth||1!==g.dilationHeight||1!==g.dilationWidth||1!==g.strideHeight||1!==g.strideWidth||"SAME"!==g.padInfo.type&&"VALID"!==g.padInfo.type)if(g.strideWidth<=2&&"channelsLast"===m&&Yw().getBool("WEBGL_EXP_CONV")){const e=f?JJ(f,!0):null,t=new UZ(g,y,e,x,w),r=[[g.padInfo.top,g.padInfo.left],[g.strideHeight,g.strideWidth],[g.dilationHeight,g.dilationWidth],[g.inHeight,g.inWidth]],a=k();v=n.runWebGLProgram(t,a,"float32",r)}else if(Yw().getBool("WEBGL_CONV_IM2COL"))v=GZ({x:a,filter:i,convInfo:g,backend:n,bias:o,activation:f,preluActivationWeights:s,leakyreluAlpha:p});else{const e=f?JJ(f,!1):null,t=new BZ(g,y,e,x,w),r=k();v=n.runWebGLProgram(t,r,"float32")}else v=HZ({x:a,filter:i,convInfo:g,backend:n,bias:o,activation:f,preluActivationWeights:s,leakyreluAlpha:p});const S=iQ({inputs:{x:v},backend:n,attrs:{shape:g.outShape}});return b.push(v),b.forEach(e=>n.disposeIntermediateTensorInfo(e)),S}};const u1={kernelName:uC,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,filter:i,bias:o,preluActivationWeights:s}=t,{strides:c,pad:l,dilations:u,dimRoundingMode:h,activation:d,leakyreluAlpha:f}=r,p=[];let m=u;null==m&&(m=[1,1]),mw(YT(c,m),()=>"Error in depthwiseConv2d: Either strides or dilations must be "+"1. Got strides ".concat(c," and dilations '").concat(m,"'"));const g=UT(a.shape,i.shape,c,m,l,h,!0),v=Yw().getBool("WEBGL_PACK_DEPTHWISECONV")&&g.strideWidth<=2&&g.outChannels/g.inChannels===1,b=d?JJ(d,v):null,y=[a,i],x=null!=o,w=null!=s,k="leakyrelu"===d;if(x&&y.push(o),w&&y.push(s),k){const e=n.makeTensorInfo([],"float32",PC(f,"float32"));y.push(e),p.push(e)}let S;S=v?new x0(g,x,b,w,k):new y0(g,x,b,w,k);const N=[[g.padInfo.top,g.padInfo.left],[g.strideHeight,g.strideWidth],[g.dilationHeight,g.dilationWidth],[g.inHeight,g.inWidth]],C=n.runWebGLProgram(S,y,"float32",N);return p.forEach(e=>n.disposeIntermediateTensorInfo(e)),C}};class h1{constructor(e,t,n,r){this.sliceDim=e,this.strides=t,this.paramsShape=r,this.variableNames=["x","indices"],this.outputShape=n;const a=KY(n.length);let i="\n    int index;";for(let o=0;o<this.sliceDim;o++)i+="\n          index = round(getIndices(coords[0], ".concat(o,"));\n          out_of_bounds = out_of_bounds || index < 0;\n          out_of_bounds = out_of_bounds || index >= ").concat(this.paramsShape[o],";\n          flattenIndex += index * ").concat(this.strides[o],";");this.userCode="\n         void main() {\n          ".concat(a," coords = getOutputCoords();\n          int flattenIndex = 0;\n          bool out_of_bounds = false;\n\n          ").concat(i,"\n\n          setOutput(out_of_bounds ? 0.0 : getX(flattenIndex, coords[1]));\n        }\n      ")}}const d1={kernelName:dS,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{params:r,indices:a}=t,i=a.shape,o=i[i.length-1],s=bw(r.shape),[c,l,u,h]=oF(r,a),d=iQ({inputs:{x:a},backend:n,attrs:{shape:[l,o]}}),f=iQ({inputs:{x:r},backend:n,attrs:{shape:[bw(r.shape)/u,u]}});if(n.shouldExecuteOnCPU([r,a])||"string"===r.dtype){const e=n.readSync(a.dataId),t=n.bufferSync(r),i=A$(e,t,r.dtype,l,o,u,h,r.shape,s);return n.makeTensorInfo(c,r.dtype,i.values)}const p=new h1(o,h,[l,u],r.shape),m=n.runWebGLProgram(p,[f,d],f.dtype),g=iQ({inputs:{x:m},backend:n,attrs:{shape:c}});return n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(m),g}};class f1{constructor(e,t){this.variableNames=["A","indices"],this.outputShape=t,this.rank=t.length;const n=KY(this.rank),r=function(e){const t=["resRC.x","resRC.y","resRC.z","resRC.w"],n=[];for(let r=0;r<e.length;r++)2===r?n.push("index"):n.push("".concat(t[r]));return n.join()}(e);this.userCode="\n      void main() {\n        ".concat(n," resRC = getOutputCoords();\n        int index = int(getIndices(resRC.x, resRC.z));\n        float inBounds = (index >= 0) && (index < ").concat(e[2],") ? 1.0 : 0.0;\n        setOutput(inBounds * getA(").concat(r,"));\n      }\n    ")}}function p1(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,indices:i}=t,{axis:o,batchDims:s}=r,c=Cw(o,a.shape)[0];if(Yw().get("DEBUG")){const e=n.readSync(i.dataId),t=a.shape[c];for(let n=0;n<e.length;++n){const r=e[n];mw(r<=t-1&&r>=0,()=>"GatherV2: the index value ".concat(r," is not in [0, ").concat(t-1,"]"))}}const l=JF(a,i,c,s),u=bw(i.shape),h=[],d=iQ({inputs:{x:a},backend:n,attrs:{shape:[l.batchSize,l.outerSize,l.dimSize,l.sliceSize]}}),f=iQ({inputs:{x:i},backend:n,attrs:{shape:[l.batchSize,u/l.batchSize]}});h.push(d),h.push(f);const p=[l.batchSize,l.outerSize,u/l.batchSize,l.sliceSize];if(n.shouldExecuteOnCPU([a,i])||"string"===a.dtype){const e=n.bufferSync(f),t=n.bufferSync(d),r=R$(t,e,p);return h.forEach(e=>n.disposeIntermediateTensorInfo(e)),n.makeTensorInfo(l.outputShape,r.dtype,r.values)}const m=new f1(d.shape,p),g=n.runWebGLProgram(m,[d,f],d.dtype);h.push(g);const v=iQ({inputs:{x:g},backend:n,attrs:{shape:l.outputShape}});return h.forEach(e=>n.disposeIntermediateTensorInfo(e)),v}const m1={kernelName:hS,backendName:"webgl",kernelFunc:p1},g1=$J({opSnippet:"return float(a > b);",packedOpSnippet:"\n  return vec4(greaterThan(a, b));\n",cpuKernelImpl:F$,dtype:"bool"}),v1={kernelName:fS,backendName:"webgl",kernelFunc:g1},b1=$J({opSnippet:"return float(a >= b);",packedOpSnippet:"\n  return vec4(greaterThanEqual(a, b));\n",dtype:"bool",cpuKernelImpl:D$}),y1={kernelName:pS,backendName:"webgl",kernelFunc:b1};const x1={kernelName:gS,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{input:r}=t;return q0(r,!0,n)}},w1=YJ({opSnippet:"return float(!isnan(x) && !isinf(x));",dtype:"bool"}),k1={kernelName:bS,backendName:"webgl",kernelFunc:w1},S1=YJ({opSnippet:"return float(isinf(x));",dtype:"bool"}),N1={kernelName:yS,backendName:"webgl",kernelFunc:S1},C1=YJ({opSnippet:"return float(isnan(x));",dtype:"bool"}),E1={kernelName:xS,backendName:"webgl",kernelFunc:C1},I1=$J({opSnippet:"return float(a < b);",packedOpSnippet:"\n  return vec4(lessThan(a, b));\n",cpuKernelImpl:O$,dtype:"bool"}),T1={kernelName:kS,backendName:"webgl",kernelFunc:I1},_1=$J({opSnippet:"return float(a <= b);",packedOpSnippet:"\n  return vec4(lessThanEqual(a, b));\n",cpuKernelImpl:L$,dtype:"bool"}),A1={kernelName:SS,backendName:"webgl",kernelFunc:_1};const R1={kernelName:NS,backendName:"webgl",kernelFunc:function(e){const{backend:t,attrs:n}=e,{start:r,stop:a,num:i}=n,o=P$(r,a,i);return t.makeTensorInfo([o.length],"float32",o)}},F1=YJ({opSnippet:XJ+"\n  return x < 0.0 ? 0./0. : log(x);\n",packedOpSnippet:"\n  vec4 result = log(x);\n  bvec4 isNaN = isnan(x);\n  result.r = isNaN.r ? x.r : (x.r < 0.0 ? 0./0. : result.r);\n  result.g = isNaN.g ? x.g : (x.g < 0.0 ? 0./0. : result.g);\n  result.b = isNaN.b ? x.b : (x.b < 0.0 ? 0./0. : result.b);\n  result.a = isNaN.a ? x.a : (x.a < 0.0 ? 0./0. : result.a);\n  return result;\n",cpuKernelImpl:M$}),D1={kernelName:CS,backendName:"webgl",kernelFunc:F1},O1=YJ({opSnippet:XJ+"\n  return log(1.0 + x);\n"}),L1={kernelName:ES,backendName:"webgl",kernelFunc:O1},P1=$J({opSnippet:"return float(a >= 1.0 && b >= 1.0);",packedOpSnippet:"\n  return vec4(\n    vec4(greaterThanEqual(a, vec4(1.0))) *\n    vec4(greaterThanEqual(b, vec4(1.0))));\n",dtype:"bool"}),M1={kernelName:IS,backendName:"webgl",kernelFunc:P1},j1=YJ({opSnippet:"return float(!(x >= 1.0));"}),B1={kernelName:TS,backendName:"webgl",kernelFunc:j1},z1=$J({opSnippet:"return float(a >= 1.0 || b >= 1.0);",packedOpSnippet:"\n  return min(\n    vec4(greaterThanEqual(a, vec4(1.0))) +\n    vec4(greaterThanEqual(b, vec4(1.0))),\n    vec4(1.0));\n",dtype:"bool"}),U1={kernelName:_S,backendName:"webgl",kernelFunc:z1};class W1{constructor(e,t,n,r,a){this.variableNames=["x"],this.outputShape=[];const i=t,o=e[3]-1;let s;this.outputShape=e;const c="float(".concat(n,") + float(").concat(r,") * sum");s=.5===a?"inversesqrt(".concat(c,")"):1===a?"1.0/(".concat(c,")"):"exp(log(".concat(c,") * float(-").concat(a,"));"),this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n        int d = coords[3];\n        float x = getX(b, r, c, d);\n        float sum = 0.0;\n        for (int j = -".concat(i,"; j <= ").concat(i,"; j++) {\n          int idx = d + j;\n          if (idx >= 0 && idx <=  ").concat(o,") {\n            float z = getX(b, r, c, idx);\n            sum += z * z;\n          }\n        }\n        float val = x * ").concat(s,";\n        setOutput(val);\n      }\n    ")}}class V1{constructor(e,t,n,r,a){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;const i=t,o=e[3]-1;let s;this.outputShape=e;const c="float(".concat(n,") + float(").concat(r,") * sum");s=.5===a?"inversesqrt(".concat(c,")"):1===a?"1.0/(".concat(c,")"):"exp(log(".concat(c,") * float(-").concat(a,"));"),this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords.x;\n        int r = coords.y;\n        int c = coords.z;\n        int d = coords.w;\n\n        bool hasNextCol = d < ".concat(this.outputShape[3],";\n        bool hasNextRow = c < ").concat(this.outputShape[2],";\n\n        vec4 sum = vec4(0.);\n        vec4 xFragAtOutputCoords = getX(b, r, c, d);\n\n        vec4 xAtOutputCoords = vec4(\n          getChannel(xFragAtOutputCoords, vec2(c, d)),\n          hasNextCol ?\n            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,\n          hasNextRow ?\n            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0\n        );\n\n        int firstChannel = d - ").concat(i,";\n        vec2 cache = vec2(0.);\n        if(firstChannel >= 0){\n          vec4 firstChannelFrag = getX(b, r, c, firstChannel);\n          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));\n            if(hasNextRow){\n              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));\n            }\n        }\n\n        ivec2 depth = ivec2(d, d + 1);\n        for (int j = - ").concat(i,"; j <= ").concat(i,"; j++) {\n          ivec2 idx = depth + j;\n          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));\n          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(").concat(o,"));\n\n          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;\n          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;\n\n          if(depthInRange || depthPlusOneInRange){\n            vec4 z = vec4(0.);\n            vec4 xFragAtCurrentDepth;\n            z.xz = cache.xy;\n            if(depthPlusOneInRange && hasNextCol){\n              xFragAtCurrentDepth = idx.y != d ?\n                getX(b, r, c, idx.y) : xFragAtOutputCoords;\n              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));\n              if(hasNextRow){\n                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));\n              }\n            }\n            cache.xy = z.yw;\n            sum += z * z;\n          }\n        }\n        vec4 result = xAtOutputCoords * ").concat(s,";\n        setOutput(result);\n      }\n    ")}}const H1={kernelName:AS,backendName:"webgl",kernelFunc:e=>{const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{depthRadius:i,bias:o,alpha:s,beta:c}=r,l=Yw().getBool("WEBGL_PACK_NORMALIZATION")?new V1(a.shape,i,o,s,c):new W1(a.shape,i,o,s,c);return n.runWebGLProgram(l,[a],a.dtype)}};class G1{constructor(e,t,n,r,a){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=t,this.bias=n,this.alpha=r,this.beta=a,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n\n        float result = 0.0;\n        for (int d = 0; d < ".concat(this.depth,"; ++d) {\n          int depthBegin = int(max(0.0, float(d - ").concat(t,")));\n          int depthEnd = int(min(float(").concat(this.depth,"),\n              float(d + ").concat(t," + 1)));\n\n          const int MIN_DEPTH_BEGIN = 0;\n          const int MAX_DEPTH_END = ").concat(this.depth,";\n\n          float norm = 0.0;\n          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd) {\n              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);\n            }\n            else {\n              break;\n            }\n          }\n\n          norm = float(").concat(r,") * norm + float(").concat(n,");\n\n          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd){\n              float dyi = -2.0 * float(").concat(r,")\n                * float(").concat(a,")\n                * getInputImage(b, r, c, k) * getOutputImage(b, r, c, d)\n                / norm;\n              if (k == d) {\n                dyi += pow(norm, -1.0 * ").concat(a,");\n              }\n              if (k == coords[3]) {\n                dyi *= getDy(b, r, c, d);\n                result += dyi;\n              }\n            }\n            else {\n              break;\n            }\n          }\n      }\n      setOutput(result);\n      }\n    ")}}const q1={kernelName:RS,backendName:"webgl",kernelFunc:e=>{const{inputs:t,backend:n,attrs:r}=e,{x:a,y:i,dy:o}=t,{depthRadius:s,bias:c,alpha:l,beta:u}=r,h=new G1(a.shape,s,c,l,u);return n.runWebGLProgram(h,[a,i,o],a.dtype)}};function K1(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{reductionIndices:i,keepDims:o}=r,s=a.shape.length,c=Cw(i,a.shape);let l=c;const u=H_(l,s),h=null!=u,d=n.shouldExecuteOnCPU([a]);let f=a;if(h){if(d){const e=n.texData.get(f.dataId).values,t=new Array(s);for(let n=0;n<t.length;n++)t[n]=a.shape[u[n]];const r=dJ(e,a.shape,a.dtype,u,t);f=n.makeTensorInfo(t,a.dtype);n.texData.get(f.dataId).values=r}else f=dQ(a,u,n);l=q_(l.length,s)}V_("max",l,s);const[p,m]=U_(f.shape,l);let g,v=p;if(o&&(v=W_(p,c)),d){const e=n.texData.get(f.dataId).values,t=j$(e,bw(m),v,a.dtype);g=n.makeTensorInfo(v,a.dtype);n.texData.get(g.dataId).values=t}else g=function(e,t,n,r){const a=bw(t),i=iQ({inputs:{x:e},attrs:{shape:[bw(e.shape)/a,a]},backend:r}),o=lQ(i,e.dtype,"max",r),s=iQ({inputs:{x:o},attrs:{shape:n},backend:r});return r.disposeIntermediateTensorInfo(i),r.disposeIntermediateTensorInfo(o),s}(f,m,v,n);return h&&n.disposeIntermediateTensorInfo(f),g}const X1={kernelName:FS,backendName:"webgl",kernelFunc:K1},Y1=$J({opSnippet:OJ+"\n  return max(a, b);\n",packedOpSnippet:"\n  vec4 result = vec4(max(a, b));\n  bvec4 isNaNA = isnan(a);\n  bvec4 isNaNB = isnan(b);\n  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);\n  "+PJ+"\n  return result;\n",cpuKernelImpl:B$}),$1={kernelName:DS,backendName:"webgl",kernelFunc:Y1};const J1={kernelName:OS,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t;_Y(a,"maxPool");const{filterSize:i,strides:o,pad:s,dimRoundingMode:c}=r;mw(YT(o,1),()=>"Error in maxPool: Either strides or dilations must be 1. "+"Got strides ".concat(o," and dilations '").concat(1,"'"));const l=BT(a.shape,i,o,1,s,c);if(1===l.filterWidth&&1===l.filterHeight&&yw(l.inShape,l.outShape))return jJ({inputs:{x:a},backend:n});const u=new $Q(l,"max",!1);return n.runWebGLProgram(u,[a],a.dtype)}};const Q1={kernelName:PS,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{filterSize:i,strides:o,pad:s,dataFormat:c,dimRoundingMode:l}=r,u=zT(a.shape,i,o,[1,1,1],s,l,c),h=new JQ(u,"max",!1);return n.runWebGLProgram(h,[a],a.dtype)}};class Z1{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const t=e.strideHeight,n=e.strideWidth,r=e.dilationHeight,a=e.effectiveFilterHeight,i=e.effectiveFilterWidth,o=a-1-e.padInfo.top,s=i-1-e.padInfo.left,c=a*i-1;this.userCode="\n      const ivec2 pads = ivec2(".concat(o,", ").concat(s,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(a,";\n          wR += ").concat(r,") {\n          float dyR = float(dyRCorner + wR) / ").concat(t,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(e.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < ").concat(i,"; wC++) {\n            float dyC = float(dyCCorner + wC) / ").concat(n,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(e.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n            int maxPosValue = ").concat(c," - int(getMaxPos(b, idyR, idyC, d));\n\n            // Get the current value, check it against the value from the\n            // position matrix.\n            int curPosValue = wR * ").concat(i," + wC;\n            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n            dotProd += dyValue * mask;\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}}class e2{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const t=e.strideDepth,n=e.strideHeight,r=e.strideWidth,a=e.dilationDepth,i=e.dilationHeight,o=e.dilationWidth,s=e.effectiveFilterDepth,c=e.effectiveFilterHeight,l=e.effectiveFilterWidth,u=s-1-e.padInfo.front,h=c-1-e.padInfo.top,d=l-1-e.padInfo.left,f=s*c*l-1;this.userCode="\n      const ivec3 pads = ivec3(".concat(u,", ").concat(h,", ").concat(d,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < ").concat(s,";\n           wD += ").concat(a,") {\n          float dyD = float(dyDCorner + wD) / ").concat(t,".0;\n\n          if (dyD < 0.0 || dyD >= ").concat(e.outDepth,".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < ").concat(c,";\n              wR += ").concat(i,") {\n            float dyR = float(dyRCorner + wR) / ").concat(n,".0;\n\n            if (dyR < 0.0 || dyR >= ").concat(e.outHeight,".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < ").concat(l,";\n                wC += ").concat(o,") {\n              float dyC = float(dyCCorner + wC) / ").concat(r,".0;\n\n              if (dyC < 0.0 || dyC >= ").concat(e.outWidth,".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n              int maxPosValue = ").concat(f," -\n                  int(getMaxPos(batch, idyD, idyR, idyC, ch));\n\n              // Get the current value, check it against the value from the\n              // position matrix.\n              int curPosValue =\n                  wD * ").concat(c," * ").concat(l," +\n                  wR * ").concat(l," + wC;\n              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n              dotProd += dyValue * mask;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}}const t2={kernelName:MS,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{dy:a,input:i}=t,o=i,{filterSize:s,strides:c,pad:l,dimRoundingMode:u}=r,h=zT(o.shape,s,c,[1,1,1],l,u),d=new JQ(h,"max",!0),f=n.runWebGLProgram(d,[o],o.dtype),p=new e2(h),m=n.runWebGLProgram(p,[a,f],o.dtype);return n.disposeIntermediateTensorInfo(f),m}};const n2={kernelName:LS,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{dy:a,input:i,output:o}=t,s=i;_Y([i,o],"maxPoolGrad");const{filterSize:c,strides:l,pad:u,dimRoundingMode:h}=r,d=BT(s.shape,c,l,1,u,h),f=new $Q(d,"max",!0),p=n.runWebGLProgram(f,[s],s.dtype),m=new Z1(d),g=n.runWebGLProgram(m,[a,p],s.dtype);return n.disposeIntermediateTensorInfo(p),g}};const r2={kernelName:jS,backendName:"webgl",kernelFunc:e=>{let{inputs:t,attrs:n,backend:r}=e;const{x:a}=t,{filterSize:i,strides:o,pad:s,includeBatchInIndex:c}=n,l=r;mw(4===a.shape.length,()=>"Error in maxPool: input must be rank 4 but got rank ".concat(a.shape.length,"."));const u=[1,1];mw(YT(o,u),()=>"Error in maxPool: Either strides or dilations must be 1. "+"Got strides ".concat(o," and dilations '").concat(u,"'"));const h=BT(a.shape,i,o,u,s),[d,f]=function(e,t,n,r){let a=new $Q(n,"max",!1);const i=r.runWebGLProgram(a,[e],"float32");return a=new $Q(n,"max",!0,!0,t),[i,r.runWebGLProgram(a,[e],"float32")]}(a,c,h,l);return[d,f]}};const a2={kernelName:BS,backendName:"webgl",kernelFunc:e=>{let{inputs:t,attrs:n,backend:r}=e;const{x:a}=t,{keepDims:i,axis:o}=n,s=r,c=a.shape.length,l=Cw(o,a.shape);let u=l;const h=H_(u,c),d=null!=h,f=s.shouldExecuteOnCPU([a]),p=[];let m=a;if(d){if(f){const e=s.texData.get(m.dataId).values,t=new Array(c);for(let r=0;r<t.length;r++)t[r]=a.shape[h[r]];const n=dJ(e,a.shape,a.dtype,h,t);m=s.makeTensorInfo(t,a.dtype);s.texData.get(m.dataId).values=n}else m=dQ(a,h,s);p.push(m),u=q_(u.length,c)}V_("sum",u,c);const[g,v]=U_(m.shape,u);let b=g;i&&(b=W_(g,l));const y=function(e,t,n,r){const a=bw(t),i=iQ({inputs:{x:e},attrs:{shape:[bw(e.shape)/a,a]},backend:r}),o=lQ(i,"float32","mean",r),s=iQ({inputs:{x:o},attrs:{shape:n},backend:r});return r.disposeIntermediateTensorInfo(i),r.disposeIntermediateTensorInfo(o),s}(m,v,b,s);for(const x of p)s.disposeIntermediateTensorInfo(x);return y}};const i2={kernelName:zS,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:i,keepDims:o}=r,s=a.shape.length,c=Cw(i,a.shape);let l=c;const u=H_(l,s);let h=a;null!=u&&(h=mQ({inputs:{x:a},backend:n,attrs:{perm:u}}),l=q_(l.length,a.shape.length)),V_("min",l,s);const[d,f]=U_(h.shape,l),p=iQ({inputs:{x:h},backend:n,attrs:{shape:[-1,bw(f)]}}),m=lQ(p,p.dtype,"min",n);let g;if(o){g=iQ({inputs:{x:m},backend:n,attrs:{shape:W_(d,c)}})}else g=iQ({inputs:{x:m},backend:n,attrs:{shape:d}});return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(m),null!=u&&n.disposeIntermediateTensorInfo(h),g}},o2=$J({opSnippet:OJ+"\n  return min(a, b);\n",packedOpSnippet:"\n  vec4 result = vec4(min(a, b));\n  bvec4 isNaNA = isnan(a);\n  bvec4 isNaNB = isnan(b);\n  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);\n  "+PJ+"\n  return result;\n",cpuKernelImpl:z$}),s2={kernelName:US,backendName:"webgl",kernelFunc:o2};class c2{constructor(e,t,n){this.variableNames=["x"],this.outputShape=t.map((t,n)=>t[0]+e[n]+t[1]);const r=e.length,a=KY(r),i=t.map(e=>e[0]).join(","),o=t.map((t,n)=>t[0]+e[n]).join(","),s=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r),c="reflect"===n?0:1;this.userCode=1!==r?"\n      ".concat(a," start = ").concat(a,"(").concat(i,");\n      ").concat(a," end = ").concat(a,"(").concat(o,");\n\n      void main() {\n        ").concat(a," outC = getOutputCoords();\n        for (int i = 0; i < ").concat(r,"; i++) {\n          if (outC[i] < start[i]) {\n            outC[i] = start[i] * 2 - outC[i] - ").concat(c,";\n          } else if(outC[i] >= end[i]) {\n            outC[i] = (end[i] - 1) * 2 - outC[i] + ").concat(c,";\n          }\n        }\n        ").concat(a," coords = outC - start;\n        setOutput(getX(").concat(s,"));\n      }\n    "):"\n        int start = ".concat(i,";\n        int end = ").concat(o,";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start) {\n            outC = start * 2 - outC - ").concat(c,";\n          } else if(outC >= end) {\n            outC = (end - 1) * 2 - outC + ").concat(c,";\n          }\n          setOutput(getX(outC - start));\n        }\n      ")}}class l2{constructor(e,t,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.map((t,n)=>t[0]+e[n]+t[1]);const r=e.length,a=KY(r),i=t.map(e=>e[0]).join(","),o=t.map((t,n)=>t[0]+e[n]).join(","),s=mJ("rc",r),c=mJ("source",r),l="".concat(s[r-1]," < ").concat(this.outputShape[r-1]),u=1===r?"source":"vec2(".concat(c.slice(-2).join(),")"),h="reflect"===n?0:1;let d="";if(1===r){const e="\n        ".concat(a," source = rc;\n        if (source < start) {\n          source = start * 2 - source - ").concat(h,";\n        } else if (source >= end) {\n          source = (end - 1) * 2 - source + ").concat(h,";\n        }\n        source -= start;\n      ");d="\n        ".concat(a," rc = outputLoc;\n        ").concat(e,"\n        result[0] = getChannel(getX(").concat(c.join(),"), ").concat(u,");\n        ").concat(s[r-1]," += 1;\n        if(").concat(l,") {\n          ").concat(e,"\n          result[1] = getChannel(getX(").concat(c.join(),"), ").concat(u,");\n        }\n      ")}else{const e="\n        ".concat(a," source = rc;\n        ").concat(a," lt = ").concat(a,"(lessThan(source, start));\n        ").concat(a," gte = ").concat(a,"(greaterThanEqual(source, end));\n        ").concat(a," orig = 1 - (lt + gte);\n        source = orig * source +\n                lt * (start * 2 - source - ").concat(h,") +\n                gte * ((end - 1) * 2 - source + ").concat(h,");\n        source -= start;\n      ");d="\n        ".concat(a," rc = outputLoc;\n        ").concat(e,"\n        result[0] = getChannel(getX(").concat(c.join(),"), ").concat(u,");\n        ").concat(s[r-1]," += 1;\n        if(").concat(l,") {\n          ").concat(e,"\n          result[1] = getChannel(getX(").concat(c.join(),"), ").concat(u,");\n        }\n        rc = outputLoc;\n        ").concat(s[r-2]," += 1;\n        if(").concat(s[r-2]," < ").concat(this.outputShape[r-2],") {\n          ").concat(e,"\n          result[2] = getChannel(getX(").concat(c.join(),"), ").concat(u,");\n          ").concat(s[r-1]," += 1;\n          if(").concat(l,") {\n            ").concat(e,"\n            result[3] = getChannel(getX(").concat(c.join(),"), ").concat(u,");\n          }\n        }\n      ")}this.userCode="\n      const ".concat(a," start = ").concat(a,"(").concat(i,");\n      const ").concat(a," end = ").concat(a,"(").concat(o,");\n\n      void main() {\n        ").concat(a," outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        ").concat(d,"\n        setOutput(result);\n      }\n    ")}}const u2={kernelName:WS,backendName:"webgl",kernelFunc:e=>{let{inputs:t,backend:n,attrs:r}=e;const{x:a}=t,{paddings:i,mode:o}=r,s=Yw().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new l2(a.shape,i,o):new c2(a.shape,i,o);return n.runWebGLProgram(s,[a],a.dtype)}},h2=$J({opSnippet:"if (b == 0.0) return NAN;\n  return mod(a, b);",packedOpSnippet:"\n  vec4 result = mod(a, b);\n  bvec4 isNaN = equal(b, vec4(0.0));\n  "+PJ+"\n  return result;\n"}),d2={kernelName:VS,backendName:"webgl",kernelFunc:h2};class f2{constructor(e,t,n){this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[e,n],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n\n        float r = random(seed);\n        float cdf = 0.0;\n\n        for (int i = 0; i < ".concat(t-1,"; i++) {\n          cdf += getProbs(batch, i);\n\n          if (r < cdf) {\n            setOutput(float(i));\n            return;\n          }\n        }\n\n        // If no other event happened, last event happened.\n        setOutput(float(").concat(t-1,"));\n      }\n    ")}}const p2=$J({opSnippet:"\nif (a == b) {\n  return 1.0;\n};\nreturn a / b;",packedOpSnippet:"\n  // vec4 one = vec4(equal(a, b));\n  // return one + (vec4(1.0) - one) * a / b;\n  vec4 result = a / b;\n  if(a.x == b.x) {\n    result.x = 1.;\n  }\n  if(a.y == b.y) {\n    result.y = 1.;\n  }\n  if(a.z == b.z) {\n    result.z = 1.;\n  }\n  if(a.w == b.w) {\n    result.w = 1.;\n  }\n\n  return result;\n",checkOutOfBounds:!0}),m2={kernelName:$k,backendName:"webgl",kernelFunc:p2},g2="return a - b;",v2=$J({opSnippet:g2,packedOpSnippet:g2,supportsComplex:!0,cpuKernelImpl:lJ}),b2={kernelName:XN,backendName:"webgl",kernelFunc:v2};function y2(e){const{inputs:t,backend:n,attrs:r}=e,{logits:a}=t,{dim:i}=r,o=Cw([i],a.shape),s=K1({inputs:{x:a},backend:n,attrs:{reductionIndices:o,keepDims:!1}}),c=W_(s.shape,o),l=iQ({inputs:{x:s},backend:n,attrs:{shape:c}}),u=v2({inputs:{a:a,b:l},backend:n}),h=j0({inputs:{x:u},backend:n}),d=fQ({inputs:{x:h},backend:n,attrs:{axis:o,keepDims:!1}}),f=iQ({inputs:{x:d},backend:n,attrs:{shape:c}}),p=p2({inputs:{a:h,b:f},backend:n});return n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(f),p}const x2={kernelName:LN,backendName:"webgl",kernelFunc:y2};const w2={kernelName:HS,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{logits:a}=t,{numSamples:i,seed:o,normalized:s}=r,c=s?a:y2({inputs:{logits:a},backend:n,attrs:{dim:a.shape.length-1}}),l=c.shape[0],u=c.shape[1],h=new f2(l,u,i),d=[[o]],f=n.runWebGLProgram(h,[c],"int32",d);return s||n.disposeIntermediateTensorInfo(c),f}},k2=SJ+"\n  return -x;\n";const S2={kernelName:qS,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{x:r}=t;if(n.shouldExecuteOnCPU([r])){const e=n.texData.get(r.dataId),[t,a]=W$(e.values,r.shape,r.dtype);return n.makeTensorInfo(a,r.dtype,t)}let a;return a=Yw().getBool("WEBGL_PACK_UNARY_OPERATIONS")?new TJ(r.shape,"\n  vec4 result = -x;\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n"):new kJ(r.shape,k2),n.runWebGLProgram(a,[r],r.dtype)}},N2=dR;const C2={kernelName:XS,backendName:"webgl",kernelFunc:function(e){hC("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:t,backend:n,attrs:r}=e,{boxes:a,scores:i}=t,{maxOutputSize:o,iouThreshold:s,scoreThreshold:c}=r,l=n.readSync(a.dataId),u=n.readSync(i.dataId),{selectedIndices:h}=N2(l,u,o,s,c);return n.makeTensorInfo([h.length],"int32",new Int32Array(h))}},E2=fR;const I2={kernelName:YS,backendName:"webgl",kernelFunc:function(e){hC("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:t,backend:n,attrs:r}=e,{boxes:a,scores:i}=t,{maxOutputSize:o,iouThreshold:s,scoreThreshold:c,padToMaxOutputSize:l}=r,u=n.readSync(a.dataId),h=n.readSync(i.dataId),{selectedIndices:d,validOutputs:f}=E2(u,h,o,s,c,l);return[n.makeTensorInfo([d.length],"int32",new Int32Array(d)),n.makeTensorInfo([],"int32",new Int32Array([f]))]}},T2=pR;const _2={kernelName:$S,backendName:"webgl",kernelFunc:function(e){hC("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:t,backend:n,attrs:r}=e,{boxes:a,scores:i}=t,{maxOutputSize:o,iouThreshold:s,scoreThreshold:c,softNmsSigma:l}=r,u=n.readSync(a.dataId),h=n.readSync(i.dataId),d=o,f=s,p=c,m=l,{selectedIndices:g,selectedScores:v}=T2(u,h,d,f,p,m);return[n.makeTensorInfo([g.length],"int32",new Int32Array(g)),n.makeTensorInfo([v.length],"float32",new Float32Array(v))]}};class A2{constructor(e,t,n,r){this.variableNames=["indices"],this.outputShape=[e,t],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int index = round(getIndices(coords.x));\n        setOutput(mix(float(".concat(r,"), float(").concat(n,"),\n                      float(index == coords.y)));\n      }\n    ")}}const R2={kernelName:QS,backendName:"webgl",kernelFunc:e=>{const{inputs:t,backend:n,attrs:r}=e,{indices:a}=t,{dtype:i,depth:o,onValue:s,offValue:c}=r,l=bw(a.shape),u=new A2(l,o,s,c),h=iQ({inputs:{x:a},backend:n,attrs:{shape:[l]}}),d=n.runWebGLProgram(u,[h],i);n.disposeIntermediateTensorInfo(h);const f=iQ({inputs:{x:d},backend:n,attrs:{shape:[...a.shape,o]}});return n.disposeIntermediateTensorInfo(d),f}};function F2(e){const{inputs:t,backend:n}=e,{x:r}=t;if("complex64"===r.dtype){const e=yZ({inputs:{input:r},backend:n}),t=F2({inputs:{x:e},backend:n}),a=OZ({inputs:{input:r},backend:n}),i=F2({inputs:{x:a},backend:n}),o=zJ({inputs:{real:t,imag:i},backend:n});return n.disposeIntermediateTensorInfo(e),n.disposeIntermediateTensorInfo(t),n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(i),o}return Y0({attrs:{shape:r.shape,dtype:r.dtype,value:"string"===r.dtype?"":0},backend:n})}const D2={kernelName:aC,backendName:"webgl",kernelFunc:F2};const O2={kernelName:JS,backendName:"webgl",kernelFunc:function e(t){const{inputs:n,backend:r}=t,{x:a}=n;if("string"===a.dtype)throw new Error("onesLike is not supported under string dtype");if("complex64"===a.dtype){const t=yZ({inputs:{input:a},backend:r}),n=e({inputs:{x:t},backend:r}),i=OZ({inputs:{input:a},backend:r}),o=F2({inputs:{x:i},backend:r}),s=zJ({inputs:{real:n,imag:o},backend:r});return r.disposeIntermediateTensorInfo(t),r.disposeIntermediateTensorInfo(n),r.disposeIntermediateTensorInfo(i),r.disposeIntermediateTensorInfo(o),s}return Y0({attrs:{shape:a.shape,dtype:a.dtype,value:1},backend:r})}};const L2={kernelName:ZS,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{axis:a}=r;if(1===t.length)return z0({inputs:{input:t[0]},backend:n,attrs:{dim:a}});const i=t[0].shape,o=t[0].dtype;t.forEach(e=>{gw(i,e.shape,"All tensors passed to stack must have matching shapes"),mw(o===e.dtype,()=>"All tensors passed to stack must have matching dtypes")});const s=[],c=t.map(e=>{const t=z0({inputs:{input:e},backend:n,attrs:{dim:a}});return s.push(t),t}),l=MZ({inputs:c,backend:n,attrs:{axis:a}});return s.forEach(e=>n.disposeIntermediateTensorInfo(e)),l}};class P2{constructor(e,t,n){this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=t.map((t,n)=>t[0]+e[n]+t[1]);const r=e.length,a=KY(r),i=t.map(e=>e[0]).join(","),o=t.map((t,n)=>t[0]+e[n]).join(","),s=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);this.userCode=1!==r?"\n      ".concat(a," start = ").concat(a,"(").concat(i,");\n      ").concat(a," end = ").concat(a,"(").concat(o,");\n\n      void main() {\n        ").concat(a," outC = getOutputCoords();\n        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {\n          setOutput(value);\n        } else {\n          ").concat(a," coords = outC - start;\n          setOutput(getX(").concat(s,"));\n        }\n      }\n    "):"\n        int start = ".concat(i,";\n        int end = ").concat(o,";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start || outC >= end) {\n            setOutput(value);\n          } else {\n            setOutput(getX(outC - start));\n          }\n        }\n      ")}}class M2{constructor(e,t,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=t.map((t,n)=>t[0]+e[n]+t[1]);const r=e.length,a=KY(r),i=t.map(e=>e[0]).join(","),o=t.map((t,n)=>t[0]+e[n]).join(","),s=mJ("rc",r),c=mJ("source",r),l="".concat(s[r-1]," < ").concat(this.outputShape[r-1]),u=1===r?"source":"vec2(".concat(c.slice(-2).join(),")"),h=["".concat(a," rc = outputLoc;"),"".concat(s[r-1]," += 1;\n       if(").concat(l,") {\n      "),1===r?"":"}\n       rc = outputLoc;\n       ".concat(s[r-2]," += 1;\n       if(").concat(s[r-2]," < ").concat(this.outputShape[r-2],") {"),1===r?"":"  ".concat(s[r-1]," += 1;\n         if(").concat(l,") {")],d=1===r?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))";let f="";for(let p=0,m=1===r?2:4;p<m;p++)f+="\n        ".concat(h[p],"\n        if (").concat(d,") {\n          result[").concat(p,"] = float(value);\n        } else {\n          ").concat(a," source = rc - start;\n          result[").concat(p,"] = getChannel(getX(").concat(c.join(),"), ").concat(u,");\n        }\n      ");f+=1===r?"} ":"}}",this.userCode="\n      const ".concat(a," start = ").concat(a,"(").concat(i,");\n      const ").concat(a," end = ").concat(a,"(").concat(o,");\n\n      void main() {\n        ").concat(a," outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        ").concat(f,"\n        setOutput(result);\n      }\n    ")}}const j2=e=>{const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{paddings:i,constantValue:o}=r;if(0===bw(a.shape)){const e=i.map((e,t)=>e[0]+a.shape[t]+e[1]);return Y0({backend:n,attrs:{shape:e,value:o,dtype:a.dtype}})}const s=Yw().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new M2(a.shape,i,o):new P2(a.shape,i,o),c=[[o]];return n.runWebGLProgram(s,[a],a.dtype,c)},B2={kernelName:eN,backendName:"webgl",kernelFunc:j2},z2=$J({opSnippet:"\n  if(a < 0.0 && floor(b) < b){\n    return NAN;\n  }\n  if (b == 0.0) {\n    return 1.0;\n  }\n  return (round(mod(b, 2.0)) != 1) ?\n      pow(abs(a), b) : sign(a) * pow(abs(a), b);\n",packedOpSnippet:"\n  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.\n  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));\n  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);\n  vec4 result = multiplier * pow(abs(a), b);\n\n  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS\n  bvec4 isExpZero = equal(b, vec4(0.0));\n  result.r = isExpZero.r ? 1.0 : result.r;\n  result.g = isExpZero.g ? 1.0 : result.g;\n  result.b = isExpZero.b ? 1.0 : result.b;\n  result.a = isExpZero.a ? 1.0 : result.a;\n\n  bvec4 isNaN1 = lessThan(a, vec4(0.0));\n  bvec4 isNaN2 = lessThan(floor(b), b);\n  bvec4 isNaN = bvec4(isNaN1.x && isNaN2.x, isNaN1.y && isNaN2.y, isNaN1.z && isNaN2.z, isNaN1.w && isNaN2.w);\n  "+PJ+"\n  return result;\n"}),U2={kernelName:tN,backendName:"webgl",kernelFunc:z2};const W2={kernelName:rN,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:i,keepDims:o}=r,s=a.shape.length,c=[],l=Cw(i,a.shape);let u=l;const h=H_(u,s);let d,f=a;if(null!=h&&(f=mQ({inputs:{x:a},backend:n,attrs:{perm:h}}),u=q_(u.length,s),c.push(f)),V_("prod",u,s),n.shouldExecuteOnCPU([f])){const e=n.texData.get(f.dataId).values,{outVals:t,outShape:r,outDtype:a}=H$(f.shape,f.dtype,e,u);d=n.makeTensorInfo(r,a,t)}else{const[e,t]=U_(f.shape,u),r=bw(t),i=iQ({inputs:{x:f},backend:n,attrs:{shape:[-1,r]}}),o=lQ(i,hE(a.dtype),"prod",n);d=iQ({inputs:{x:o},backend:n,attrs:{shape:e}}),c.push(i),c.push(o)}if(o){c.push(d);const e=W_(d.shape,l);d=iQ({inputs:{x:d},backend:n,attrs:{shape:e}})}return c.forEach(e=>n.disposeIntermediateTensorInfo(e)),d}};const V2={kernelName:aN,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{paramsNestedSplits:a,paramsDenseValues:i,indices:o}=t,{outputRaggedRank:s}=r,c=a.map(e=>n.readSync(e.dataId)),l=a.map(e=>e.shape),u=n.readSync(i.dataId),h=n.readSync(o.dataId),[d,f,p]=G$(c,l,u,i.shape,i.dtype,h,o.shape,s),m=d.map(e=>n.makeTensorInfo([e.length],"int32",e)),g=n.makeTensorInfo(p,i.dtype,f);return m.concat([g])}};const H2={kernelName:iN,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{starts:r,limits:a,deltas:i}=t,o=n.readSync(r.dataId),s=n.readSync(a.dataId),c=n.readSync(i.dataId),[l,u]=q$(o,r.shape,r.dtype,s,a.shape,c,i.shape);return[n.makeTensorInfo([l.length],"int32",l),n.makeTensorInfo([u.length],r.dtype,u)]}};const G2={kernelName:oN,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{shape:a,values:i,defaultValue:o,rowPartitionTensors:s}=t,{rowPartitionTypes:c}=r,l=n.readSync(a.dataId),u=n.readSync(i.dataId),h=n.readSync(o.dataId),d=s.map(e=>n.readSync(e.dataId)),f=s.map(e=>e.shape),[p,m]=K$(l,a.shape,u,i.shape,i.dtype,h,o.shape,d,f,c);return n.makeTensorInfo(p,i.dtype,m)}},q2=e=>{const{backend:t,attrs:n}=e,{start:r,stop:a,step:i,dtype:o}=n,s=X$(r,a,i,o);return t.makeTensorInfo([s.length],o,s)},K2={kernelName:sN,backendName:"webgl",kernelFunc:q2},X2=YJ({opSnippet:"return 1.0 / x;"}),Y2={kernelName:lN,backendName:"webgl",kernelFunc:X2},$2=YJ({opSnippet:SJ+"\n  return (x < 0.0) ? 0.0 : x;\n",packedOpSnippet:"\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n"}),J2={kernelName:uN,backendName:"webgl",kernelFunc:$2},Q2=YJ({opSnippet:SJ+"\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",packedOpSnippet:"\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n"}),Z2={kernelName:gN,backendName:"webgl",kernelFunc:Q2};class e4{constructor(e,t,n,r,a){this.variableNames=["A"],this.outputShape=[];const[i,o,s,c]=e;this.outputShape=[i,t,n,c];const l=[r&&t>1?o-1:o,r&&n>1?s-1:s],u=[r&&t>1?t-1:t,r&&n>1?n-1:n];let h;h=a?"(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":"vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          ".concat(l[0]/u[0],",\n          ").concat(l[1]/u[1],");\n      const vec2 inputShapeRC = vec2(").concat(o,".0, ").concat(s,".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = ").concat(h,";\n\n        // Compute the four integer indices.\n        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));\n        ivec2 sourceCeilRC = ivec2(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);\n        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);\n        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);\n        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n        float top = topLeft + (topRight - topLeft) * fracRC.y;\n        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n        float newValue = top + (bottom - top) * fracRC.x;\n\n        setOutput(newValue);\n      }\n    ")}}class t4{constructor(e,t,n,r,a){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[i,o,s,c]=e;this.outputShape=[i,t,n,c];const l=[r&&t>1?o-1:o,r&&n>1?s-1:s],u=[r&&t>1?t-1:t,r&&n>1?n-1:n];let h;h=a?"(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":"vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode="\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          ".concat(l[0]/u[0],",\n          ").concat(l[1]/u[1],",\n          ").concat(l[1]/u[1],");\n      const vec3 inputShapeRC = vec3(").concat(o,".0, ").concat(s,".0,\n                                     ").concat(s,".0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = ").concat(h,";\n\n        // Compute the four integer indices.\n        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));\n        ivec3 sourceCeilRC = ivec3(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < ").concat(c-1,";\n        bool hasNextRow = coords.z < ").concat(n-1,";\n\n        // In parallel, construct four corners for all four components in\n        // packed 2x2 cell.\n        vec4 topLeft = vec4(\n          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 bottomLeft = vec4(\n          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 topRight = vec4(\n          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec4 bottomRight = vec4(\n          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);\n\n        vec4 top = mix(topLeft, topRight, fracRC.yyzz);\n        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);\n        vec4 newValue = mix(top, bottom, fracRC.x);\n\n        setOutput(newValue);\n      }\n    ")}}const n4={kernelName:pN,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{images:a}=t,{alignCorners:i,halfPixelCenters:o,size:s}=r,[c,l]=s,u=Yw().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new t4(a.shape,c,l,i,o):new e4(a.shape,c,l,i,o);return n.runWebGLProgram(u,[a],"float32")}};class r4{constructor(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;const[,r,a]=t,[,i,o]=e,s=[n&&i>1?r-1:r,n&&o>1?a-1:a],c=[n&&i>1?i-1:i,n&&o>1?o-1:o],l=s[0]/c[0],u=s[1]/c[1],h=1/l,d=1/u,f=2*Math.ceil(h)+2,p=2*Math.ceil(d)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float(".concat(l,");\n        const float widthScale = float(").concat(u,");\n\n        const float invHeightScale = float(").concat(h,");\n        const float invWidthScale = float(").concat(d,");\n\n        const int winHeight = int(").concat(f,");\n        const int winWidth = int(").concat(p,");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(startRLerp - float(winHeight / 2));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(startCLerp - float(winWidth / 2));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= ").concat(i,") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= ").concat(o,") {\n              continue;\n            }\n\n            float dxR = float(dyR) * heightScale;\n            int topDxRIndex = int(floor(dxR));\n            int bottomDxRIndex = int(min(ceil(dxR), ").concat(r-1,".0));\n            float dxRLerp = dxR - float(topDxRIndex);\n            float inverseDxRLerp = 1.0 - dxRLerp;\n\n            float dxC = float(dyC) * widthScale;\n            int leftDxCIndex = int(floor(dxC));\n            int rightDxCIndex = int(min(ceil(dxC), ").concat(a-1,".0));\n            float dxCLerp = dxC - float(leftDxCIndex);\n            float inverseDxCLerp = 1.0 - dxCLerp;\n\n            if (r == topDxRIndex && c == leftDxCIndex) {\n              // topLeft\n              accumulator +=\n                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;\n            }\n\n            if (r == topDxRIndex && c == rightDxCIndex) {\n              // topRight\n              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == leftDxCIndex) {\n              // bottomLeft\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == rightDxCIndex) {\n              // bottomRight\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    ")}}const a4={kernelName:mN,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{images:a,dy:i}=t,{alignCorners:o}=r,s=new r4(i.shape,a.shape,o);return n.runWebGLProgram(s,[i],i.dtype)}};class i4{constructor(e,t,n,r,a){this.variableNames=["A"],this.outputShape=[];const[i,o,s,c]=e;this.outputShape=[i,t,n,c];const l=[r&&t>1?o-1:o,r&&n>1?s-1:s],u=[r&&t>1?t-1:t,r&&n>1?n-1:n],h=r?"0.5":"0.0";let d;d=a?"max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":"vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          ".concat(l[0]/u[0],",\n          ").concat(l[1]/u[1],");\n      const vec2 inputShapeRC = vec2(").concat(o,".0, ").concat(s,".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = ").concat(d,";\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec2 sourceNearestRC = ivec2(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ").concat(h,")));\n        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);\n\n        setOutput(newValue);\n      }\n    ")}}class o4{constructor(e,t,n,r,a){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[i,o,s,c]=e;this.outputShape=[i,t,n,c];const l=[r&&t>1?o-1:o,r&&n>1?s-1:s],u=[r&&t>1?t-1:t,r&&n>1?n-1:n],h=r?"0.5":"0.0";let d;d=a?"max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":"vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode="\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          ".concat(l[0]/u[0],",\n          ").concat(l[1]/u[1],",\n          ").concat(l[1]/u[1],");\n      const vec3 inputShapeRC = vec3(").concat(o,".0, ").concat(s,".0,\n                                     ").concat(s,".0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = ").concat(d,";\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec3 sourceNearestRC = ivec3(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ").concat(h,")));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < ").concat(c-1,";\n        bool hasNextRow = coords.z < ").concat(n-1,";\n\n        vec4 newValue = vec4(\n          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),\n          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);\n\n        setOutput(newValue);\n      }\n    ")}}const s4={kernelName:dN,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{images:a}=t,{alignCorners:i,halfPixelCenters:o,size:s}=r,[c,l]=s,u=Yw().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new o4(a.shape,c,l,i,o):new i4(a.shape,c,l,i,o);return n.runWebGLProgram(u,[a],a.dtype)}};class c4{constructor(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;const[,r,a]=t,[,i,o]=e,s=[n&&i>1?r-1:r,n&&o>1?a-1:a],c=[n&&i>1?i-1:i,n&&o>1?o-1:o],l=s[0]/c[0],u=s[1]/c[1],h=1/l,d=1/u,f=2*Math.ceil(h)+2,p=2*Math.ceil(d)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float(".concat(l,");\n        const float widthScale = float(").concat(u,");\n\n        const float invHeightScale = float(").concat(h,");\n        const float invWidthScale = float(").concat(d,");\n\n        const int winHeight = int(").concat(f,");\n        const int winWidth = int(").concat(p,");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(floor(startRLerp - float(winHeight / 2)));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(floor(startCLerp - float(winWidth / 2)));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= ").concat(i,") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= ").concat(o,") {\n              continue;\n            }\n\n            float sourceFracRow =\n              float(").concat(s[0],") *\n                (float(dyR) / float(").concat(c[0],"));\n\n            float sourceFracCol =\n                float(").concat(s[1],") *\n                  (float(dyC) / float(").concat(c[1],"));\n\n            int sourceNearestRow = int(min(\n                float(int(").concat(r,") - 1),\n                ").concat(n," ? float(round(sourceFracRow)) :\n                                  float(floor(sourceFracRow))));\n\n            int sourceNearestCol = int(min(\n                float(int(").concat(a,") - 1),\n                ").concat(n," ? float(round(sourceFracCol)) :\n                                  float(floor(sourceFracCol))));\n\n            if (r == sourceNearestRow && c == sourceNearestCol) {\n              accumulator += getDy(b, dyR, dyC, d);\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    ")}}const l4={kernelName:fN,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{images:a,dy:i}=t,{alignCorners:o}=r,s=new c4(i.shape,a.shape,o);return n.runWebGLProgram(s,[i],i.dtype)}};class u4{constructor(e,t){this.variableNames=["x"];const n=e.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-".concat(n," tensor is not yet supported"));if(this.outputShape=e,1===n)return void(this.userCode="\n        void main() {\n          int coord = getOutputCoords();\n          setOutput(getX(".concat(e[0]," - coord - 1));\n        }\n      "));const r=e.map((n,r)=>(n=>-1!==t.indexOf(n)&&1!==e[n]?"".concat(e[n]," - coords[").concat(n,"] - 1"):"coords[".concat(n,"]"))(r)).join(","),a=KY(n);this.userCode="\n      void main() {\n        ".concat(a," coords = getOutputCoords();\n        setOutput(getX(").concat(r,"));\n      }\n    ")}}class h4{constructor(e,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;const n=e.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-".concat(n," tensor is not yet supported"));this.outputShape=e;const r=mJ("rc",n),a="".concat(r[n-1]," + 1 < ").concat(this.outputShape[n-1]),i="".concat(r[n-2]," + 1 < ").concat(this.outputShape[n-2]),o=KY(n);function s(n){const r=e.map((r,a)=>function(n,r){return-1!==t.indexOf(n)&&1!==e[n]?"".concat(e[n]," - ").concat(r[n]," - 1"):"".concat(r[n])}(a,n)),a=r.join(","),i=r.slice(-2).join(",");return"getChannel(getX(".concat(a,"), vec2(").concat(i,"))")}this.userCode=1===n?"\n        void main(){\n          int rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = getChannel(getX(".concat(e[0]," - rc - 1),\n            ").concat(e[0]," - rc - 1);\n          if(").concat(a,"){\n              result.g = getChannel(getX(").concat(e[0]," - (rc  + 1) - 1),\n                ").concat(e[0]," - (rc  + 1) - 1);\n          }\n          setOutput(result);\n        }\n      "):"\n        void main() {\n          ".concat(o," rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = ").concat(function(e){return s(e)}(r.slice()),";\n          if(").concat(a,"){\n            result.g = ").concat(function(e){return e[n-1]="("+e[n-1]+" + 1)",s(e)}(r.slice()),";\n          }\n          if(").concat(i,") {\n            result.b = ").concat(function(e){return e[n-2]="("+e[n-2]+" + 1)",s(e)}(r.slice()),";\n            if(").concat(a,") {\n              result.a = ").concat(function(e){return e[n-1]="("+e[n-1]+" + 1)",e[n-2]="("+e[n-2]+" + 1)",s(e)}(r.slice()),";\n            }\n          }\n          setOutput(result);\n        }\n    ")}}const d4={kernelName:vN,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{dims:i}=r,o=a.shape.length,s=Cw(i,a.shape);if(0===o)return jJ({inputs:{x:a},backend:n});const c=Yw().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new h4(a.shape,s):new u4(a.shape,s);return n.runWebGLProgram(c,[a],a.dtype)}};class f4{constructor(e,t){this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];const n=e[1],r=e[2];this.outputShape=e;let a="";a="number"===typeof t?"float outputValue = ".concat(t.toFixed(2),";"):"\n        vec3 fill = vec3(".concat(t.join(","),");\n        float outputValue = fill[coords[3]];"),this.userCode="\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int x = coords[2];\n          int y = coords[1];\n          float coordXFloat = (float(x) - params[0]) * params[3] -\n            (float(y) - params[1]) * params[2];\n          float coordYFloat = (float(x) - params[0]) * params[2] +\n            (float(y) - params[1]) * params[3];\n          int coordX = int(round(coordXFloat + params[0]));\n          int coordY = int(round(coordYFloat + params[1]));\n          ".concat(a,"\n          if(coordX >= 0 && coordX < ").concat(r," && coordY >= 0 && coordY < ").concat(n,") {\n            outputValue = getImage(coords[0], coordY, coordX, coords[3]);\n          }\n          setOutput(outputValue);\n        }\n    ")}}const p4={kernelName:sC,backendName:"webgl",kernelFunc:e=>{let{inputs:t,attrs:n,backend:r}=e;const{image:a}=t,{radians:i,fillValue:o,center:s}=n,c=r,l=new f4(a.shape,o),[u,h]=eF(s,a.shape[1],a.shape[2]),d=[[u,h,Math.sin(i),Math.cos(i)]];return c.runWebGLProgram(l,[a],a.dtype,d)}},m4=YJ({opSnippet:"\n  // OpenGL ES does not support round function.\n  // The algorithm is based on banker's rounding.\n  float base = floor(x);\n  if ((x - base) < 0.5) {\n    return floor(x);\n  } else if ((x - base) > 0.5) {\n    return ceil(x);\n  } else {\n    if (mod(base, 2.0) == 0.0) {\n      return base;\n    } else {\n      return base + 1.0;\n    }\n  }\n"}),g4={kernelName:bN,backendName:"webgl",kernelFunc:m4},v4=YJ({opSnippet:"return inversesqrt(x);",cpuKernelImpl:Y$}),b4={kernelName:yN,backendName:"webgl",kernelFunc:v4};class y4{constructor(e,t,n,r,a,i){let o=arguments.length>7&&void 0!==arguments[7]&&arguments[7];this.variableNames=["updates","indices","defaultValue"],this.outputShape=i;const s=KY(a.length),c=KY(i.length);let l="";1===n?l="i":2===n&&(l="i, j");const u="getIndices(".concat(l,")");let h="";1===r?h="i":2===r&&(h="i, coords[1]");const d="getUpdates(".concat(h,")");let f="";o&&(f="coords[0], coords[1]");const p="getDefaultValue(".concat(f,")"),m=t>1?"strides[j]":"strides";this.userCode="\n        ".concat(s," strides = ").concat(s,"(").concat(a,");\n\n        void main() {\n          ").concat(c," coords = getOutputCoords();\n          float sum = 0.0;\n          bool found = false;\n          for (int i = 0; i < ").concat(e,"; i++) {\n            int flattenedIndex = 0;\n            for (int j = 0; j < ").concat(t,"; j++) {\n              int index = round(").concat(u,");\n              flattenedIndex += index * ").concat(m,";\n            }\n            if (flattenedIndex == coords[0]) {\n              sum += ").concat(d,";\n              found = true;\n            }\n          }\n          setOutput(mix(").concat(p,", sum, float(found)));\n        }\n      ")}}class x4{constructor(e,t,n,r,a,i){let o=arguments.length>7&&void 0!==arguments[7]&&arguments[7];this.variableNames=["updates","indices","defaultValue"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=i;const s=KY(a.length),c=KY(i.length);let l="";1===n?l="i":2===n&&(l="i, j");const u="getIndices(".concat(l,")");let h="";1===r?h="i":2===r&&(h="i, coords[1]");const d="getUpdates(".concat(h,")");let f="";o&&(f="coords[0], coords[1]");const p="getDefaultValue(".concat(f,")"),m=t>1?"strides[j]":"strides",g=t>1?"strides[j + 1]":"strides";this.userCode="\n        ".concat(s," strides = ").concat(s,"(").concat(a,");\n\n        void main() {\n          ").concat(c," coords = getOutputCoords();\n          vec4 sum = vec4(0.);\n          vec4 found = vec4(0.);\n          for (int i = 0; i < ").concat(e,"; i+=2) {\n            ivec2 flattenedIndex = ivec2(0);\n            for (int j = 0; j < ").concat(t,"; j+=2) {\n              ivec4 index = round(").concat(u,");\n              flattenedIndex += index.xz * ").concat(m,";\n              if (j + 1 < ").concat(t,") {\n                flattenedIndex += index.yw * ").concat(g,";\n              }\n            }\n            if (flattenedIndex[0] == coords[0] || flattenedIndex[1] == coords[0] ||\n                flattenedIndex[0] == coords[0] + 1 || flattenedIndex[1] == coords[0] + 1) {\n              vec4 updVals = ").concat(d,";\n              if (flattenedIndex[0] == coords[0]) {\n                sum.xy += updVals.xy;\n                found.xy = vec2(1.);\n              } else if (flattenedIndex[0] == coords[0] + 1) {\n                sum.zw += updVals.xy;\n                found.zw = vec2(1.);\n              }\n              if (flattenedIndex[1] == coords[0]) {\n                sum.xy += updVals.zw;\n                found.xy = vec2(1.);\n              } else if (flattenedIndex[1] == coords[0] + 1) {\n                sum.zw += updVals.zw;\n                found.zw = vec2(1.);\n              }\n            }\n          }\n          setOutput(mix(").concat(p,", sum, found));\n        }\n      ")}}const w4={kernelName:xN,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{indices:a,updates:i}=t,{shape:o}=r,{sliceRank:s,numUpdates:c,sliceSize:l,strides:u,outputSize:h}=lF(0,a,o),d=[h/l,l];if(0===h)return n.makeTensorInfo(o,a.dtype);const f=iQ({inputs:{x:a},backend:n,attrs:{shape:[c,s]}}),p=iQ({inputs:{x:i},backend:n,attrs:{shape:[c,l]}}),m=n.makeTensorInfo([],"float32",new Float32Array([0]));let g;g=Yw().getBool("WEBGL_PACK")?new x4(c,s,f.shape.length,p.shape.length,u,d):new y4(c,s,f.shape.length,p.shape.length,u,d);const v=n.runWebGLProgram(g,[p,f,m],p.dtype),b=iQ({inputs:{x:v},backend:n,attrs:{shape:o}});return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(m),b}};class k4{constructor(e,t,n,r){this.variableNames=["sortedSequence","values"],this.customUniforms=[{name:"numInputs",type:"int"}],this.outputShape=[e,n];const a="for (int i = 0; i < ".concat(Math.ceil(Math.log2(t+1)),"; ++i) { if (left >= right) break;"),i=2===Yw().getNumber("WEBGL_VERSION")?"while (left < right) {":a,o="left"===r?"<":"<=";this.userCode="\n       int findBound(int batch, float value) {\n         int left = 0;\n         int right = numInputs;\n         int mid;\n         ".concat(i,"\n           mid = (left + right) / 2;\n           if (getSortedSequence(batch, mid) ").concat(o," value) {\n             left = mid + 1;\n           } else {\n             right = mid;\n           }\n         }\n         return right;\n       }\n\n       void main() {\n         ivec2 coords = getOutputCoords();\n         int batch = coords[0];\n         int valueIndex = coords[1];\n\n         float value = getValues(batch, valueIndex);\n\n         setOutput(float(findBound(batch, value)));\n       }\n     ")}}const S4={kernelName:kN,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{sortedSequence:a,values:i}=t,{side:o}=r,s=new k4(a.shape[0],a.shape[1],i.shape[1],o),c=[[a.shape[1]]];return n.runWebGLProgram(s,[a,i],"int32",c)}};class N4{constructor(e,t,n){let r,a;if(this.variableNames=["c","a","b"],this.outputShape=t,n>4)throw Error("Where for rank ".concat(n," is not yet supported"));if(1===n)a="resRC",r="resRC";else{const n=["resRC.x","resRC.y","resRC.z","resRC.w"],i=[],o=[];for(let r=0;r<t.length;r++)o.push("".concat(n[r])),r<e&&i.push("".concat(n[r]));r=i.join(),a=o.join()}const i=KY(n);this.userCode="\n      void main() {\n        ".concat(i," resRC = getOutputCoords();\n        float cVal = getC(").concat(r,");\n        if (cVal >= 1.0) {\n          setOutput(getA(").concat(a,"));\n        } else {\n          setOutput(getB(").concat(a,"));\n        }\n      }\n    ")}}const C4={kernelName:SN,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{condition:r,t:a,e:i}=t,o=new N4(r.shape.length,a.shape,a.shape.length);return n.runWebGLProgram(o,[r,a,i],uE(a.dtype,i.dtype))}},E4=YJ({opSnippet:"\n  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.\n  // see: https://arxiv.org/abs/1706.02515\n  float scaleAlpha = ".concat(uF,";\n  float scale = ").concat(hF,";\n  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);\n")}),I4={kernelName:NN,backendName:"webgl",kernelFunc:E4},T4=YJ({opSnippet:XJ+"\n  return 1.0 / (1.0 + exp(-1.0 * x));\n",packedOpSnippet:"\n  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",cpuKernelImpl:J$}),_4={kernelName:_N,backendName:"webgl",kernelFunc:T4},A4=YJ({opSnippet:"\n  if (isnan(x)) { return 0.0; }\n  return sign(x);\n"}),R4={kernelName:TN,backendName:"webgl",kernelFunc:A4},F4=YJ({opSnippet:XJ+"\n  return sin(x);\n",packedOpSnippet:"\n  vec4 result = sin(x);\n  bvec4 isNaN = isnan(x);\n  ".concat(PJ,"\n  return result;\n")}),D4={kernelName:EN,backendName:"webgl",kernelFunc:F4},O4=YJ({opSnippet:"\n  float e2x = exp(x);\n  return (e2x - 1.0 / e2x) / 2.0;\n"}),L4={kernelName:IN,backendName:"webgl",kernelFunc:O4},P4=YJ({opSnippet:"\n  float epsilon = 1.1920928955078125e-7;\n  float threshold = log(epsilon) + 2.0;\n\n  bool too_large = x > -threshold;\n  bool too_small = x < threshold;\n\n  float result;\n  float exp_x = exp(x);\n\n  if (too_large){\n    result = x;\n  }\n  else if (too_small){\n    result = exp_x;\n  }\n  else{\n    result = log(exp_x + 1.0);\n  }\n  return result;\n"}),M4={kernelName:AN,backendName:"webgl",kernelFunc:P4},j4={kernelName:DN,backendName:"webgl",kernelFunc:e=>{const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{blockShape:i,paddings:o}=r;mw(a.shape.length<=4,()=>"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet");const s=i.reduce((e,t)=>e*t),c=[[0,0]];c.push(...o);for(let v=1+i.length;v<a.shape.length;++v)c.push([0,0]);const l=[],u=j2({inputs:{x:a},backend:n,attrs:{paddings:c,constantValue:0}}),h=tF(u.shape,i,s,!1),d=nF(h.length,i.length,!1),f=rF(u.shape,i,s,!1),p=iQ({inputs:{x:u},backend:n,attrs:{shape:h}}),m=mQ({inputs:{x:p},backend:n,attrs:{perm:d}}),g=iQ({inputs:{x:m},backend:n,attrs:{shape:f}});return l.push(u),l.push(p),l.push(m),l.forEach(e=>n.disposeIntermediateTensorInfo(e)),g}};const B4={kernelName:PN,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{indices:r,values:a,denseShape:i,defaultValue:o}=t;if(1!==i.shape.length)throw new Error("Dense shape must be a vector, saw:\n         ".concat(i.shape));if(2!==r.shape.length)throw new Error("Indices must be a matrix, saw:\n         ".concat(r.shape));if(1!==a.shape.length)throw new Error("Values must be a vector, saw:\n         ".concat(a.shape));if(0!==o.shape.length)throw new Error("Default value must be a scalar, saw:\n        ".concat(o.shape));const s=n.readSync(r.dataId),c=n.readSync(a.dataId),l=n.readSync(i.dataId),u=n.readSync(o.dataId)[0],[h,d,f,p,m]=eJ(s,r.shape,r.dtype,c,a.dtype,l,u);return[n.makeTensorInfo(d,r.dtype,h),n.makeTensorInfo([d[0]],a.dtype,f),n.makeTensorInfo([p.length],"bool",new Uint8Array(p.map(e=>Number(e)))),n.makeTensorInfo([m.length],r.dtype,new Int32Array(m))]}};const z4={kernelName:MN,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{inputIndices:r,inputShape:a,newShape:i}=t;if(2!==r.shape.length)throw new Error("Input indices should be a matrix but received shape ".concat(r.shape));if(1!==a.shape.length)throw new Error("Input shape should be a vector but received shape ".concat(a.shape));if(1!==i.shape.length)throw new Error("Target shape should be a vector but received shape ".concat(i.shape));const o=Array.from(n.readSync(a.dataId)),s=n.readSync(r.dataId),c=Array.from(n.readSync(i.dataId)),[l,u,h]=tJ(s,r.shape,r.dtype,o,c);return[n.makeTensorInfo(u,r.dtype,l),n.makeTensorInfo([h.length],i.dtype,new Int32Array(h))]}};const U4={kernelName:jN,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{data:r,indices:a,segmentIds:i}=t;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==a.shape.length)throw new Error("Indices should be a vector but received shape\n              ".concat(a.shape));if(1!==i.shape.length)throw new Error("Segment ids should be a vector but received shape\n              ".concat(i.shape));const o=n.readSync(r.dataId),s=n.readSync(a.dataId),c=n.readSync(i.dataId),[l,u]=nJ(o,r.shape,r.dtype,s,c,!0);return n.makeTensorInfo(u,r.dtype,l)}};const W4={kernelName:BN,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{data:r,indices:a,segmentIds:i}=t;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==a.shape.length)throw new Error("Indices should be a vector but received shape\n             ".concat(a.shape));if(1!==i.shape.length)throw new Error("Segment ids should be a vector but received shape\n             ".concat(i.shape));const o=n.readSync(r.dataId),s=n.readSync(a.dataId),c=n.readSync(i.dataId),[l,u]=nJ(o,r.shape,r.dtype,s,c);return n.makeTensorInfo(u,r.dtype,l)}};const V4={kernelName:zN,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{sparseIndices:a,sparseValues:i,defaultValue:o}=t,{outputShape:s}=r,{sliceRank:c,numUpdates:l,sliceSize:u,strides:h,outputSize:d}=lF(0,a,s),f=!1;if("string"===i.dtype){const e=n.bufferSync(a),t=n.bufferSync(i),r=zC(n.readSync(o.dataId)[0]),p=$$(e,t,s,d,u,l,c,h,r,f);return n.makeTensorInfo(s,p.dtype,p.values)}const p=new y4(l,c,a.shape.length,i.shape.length,h,[d,1],f),m=n.runWebGLProgram(p,[i,a,o],i.dtype),g=iQ({inputs:{x:m},backend:n,attrs:{shape:s}});return n.disposeIntermediateTensorInfo(m),g}};const H4={kernelName:ON,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{numOrSizeSplits:i,axis:o}=r,s=Cw(o,a.shape)[0],c=PF(a,i,s),l=a.shape.length,u=new Array(l).fill(0),h=a.shape.slice();return c.map(e=>{const t=[...h];t[s]=e;const r=hZ({inputs:{x:a},backend:n,attrs:{begin:u,size:t}});return u[s]+=e,r})}},G4="return sqrt(x);",q4=YJ({opSnippet:G4,packedOpSnippet:G4,cpuKernelImpl:rJ}),K4={kernelName:RN,backendName:"webgl",kernelFunc:q4},X4={kernelName:WN,backendName:"webgl",kernelFunc:YJ({opSnippet:"return x * x;"})},Y4="return (a - b) * (a - b);",$4=$J({opSnippet:Y4,packedOpSnippet:Y4}),J4={kernelName:UN,backendName:"webgl",kernelFunc:$4};const Q4={kernelName:VN,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t;if("string"!==a.dtype)throw new Error("Input must be of datatype string");const i=QF(n.readSync(a.dataId)),o=aJ(i,"string",r);return n.makeTensorInfo(a.shape,"string",o)}};const Z4={kernelName:iC,backendName:"webgl",kernelFunc:function(e){let{inputs:t,attrs:n,backend:r}=e;const{x:a}=t,i=SJ+"\n    return x > 0.0 ? 1.0 : float(".concat(n.alpha,");\n  "),o=new kJ(a.shape,i);return r.runWebGLProgram(o,[a],a.dtype)}};class e3{constructor(e,t,n){this.variableNames=["x"],this.outputShape=n;const r=n.length,a=KY(n.length),i=KY(n.length);let o="";if(1===r)o="coords * strides + begin";else{let e=0;o=n.map((t,r)=>(e++,1===n.length?"coords * strides[".concat(r,"] + begin[").concat(r,"]"):"coords[".concat(e-1,"] * strides[").concat(r,"] + begin[").concat(r,"]"))).join(",")}this.userCode="\n      ".concat(a," begin = ").concat(a,"(").concat(e,");\n      ").concat(a," strides = ").concat(a,"(").concat(t,");\n\n      void main() {\n        ").concat(i," coords = getOutputCoords();\n        setOutput(getX(").concat(o,"));\n      }\n    ")}}const t3={kernelName:HN,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{begin:i,end:o,strides:s,beginMask:c,endMask:l,ellipsisMask:u,newAxisMask:h,shrinkAxisMask:d}=r,{finalShapeSparse:f,finalShape:p,isIdentity:m,sliceDim0:g,isSimpleSlice:v,begin:b,end:y,strides:x}=DT(a.shape,i,o,s,c,l,u,h,d);let w;if(m)w=iQ({inputs:{x:a},backend:n,attrs:{shape:p}});else if(g||v){mw(a.shape.length>=1,()=>"Input must have rank at least 1, got: ".concat(a.shape.length));const e=xT(b,y,x),t=hZ({inputs:{x:a},backend:n,attrs:{begin:b,size:e}});w=iQ({inputs:{x:t},backend:n,attrs:{shape:p}}),n.disposeIntermediateTensorInfo(t)}else{if(n.shouldExecuteOnCPU([a])){const e=n.readSync(a.dataId),t=II(a.shape,a.dtype,e),r=iJ(f,t,x,b);w=n.makeTensorInfo(p,a.dtype,r.values)}else{const e=new e3(b,x,f);w=n.runWebGLProgram(e,[a],a.dtype)}}const k=iQ({inputs:{x:w},backend:n,attrs:{shape:p}});return n.disposeIntermediateTensorInfo(w),k}};const n3={kernelName:GN,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{separator:a,nGramWidths:i,leftPad:o,rightPad:s,padWidth:c,preserveShortSequences:l}=r,{data:u,dataSplits:h}=t,d=n.readSync(u.dataId),f=n.readSync(h.dataId),[p,m]=oJ(d,f,a,i,o,s,c,l);return[n.makeTensorInfo([p.length],"string",p),n.makeTensorInfo(h.shape,"int32",m)]}};const r3={kernelName:qN,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{skipEmpty:a}=r,{input:i,delimiter:o}=t;if("string"!==i.dtype)throw new Error("Input must be of datatype string");if(1!==i.shape.length)throw new Error("Input must be a vector, got shape: ".concat(i.shape));if(0!==o.shape.length)throw new Error("Delimiter must be a scalar, got shape: ".concat(o.shape));const s=n.readSync(i.dataId),c=n.readSync(o.dataId)[0],[l,u,h]=sJ(s,c,a),d=u.length;return[n.makeTensorInfo([d,2],"int32",l),n.makeTensorInfo([d],"string",u),n.makeTensorInfo([2],"int32",new Int32Array(h))]}};const a3={kernelName:KN,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{numBuckets:a}=r,{input:i}=t;if("string"!==i.dtype)throw new Error("Input must be of datatype string");if(a<=0)throw new Error("Number of buckets must be at least 1");const o=n.readSync(i.dataId),s=cJ(o,a);return n.makeTensorInfo(i.shape,"int32",s)}},i3=YJ({opSnippet:"return tan(x);"}),o3={kernelName:YN,backendName:"webgl",kernelFunc:i3},s3=YJ({opSnippet:"\n  float e2x = exp(-2.0 * abs(x));\n  return sign(x) * (1.0 - e2x) / (1.0 + e2x);\n"}),c3={kernelName:$N,backendName:"webgl",kernelFunc:s3};const l3={kernelName:wN,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{tensor:a,indices:i,updates:o}=t,{}=r,{sliceRank:s,numUpdates:c,sliceSize:l,strides:u,outputSize:h}=lF(0,i,a.shape),d=[h/l,l];if(0===h)return n.makeTensorInfo(a.shape,i.dtype);const f=iQ({inputs:{x:i},backend:n,attrs:{shape:[c,s]}}),p=iQ({inputs:{x:o},backend:n,attrs:{shape:[c,l]}}),m=iQ({inputs:{x:a},backend:n,attrs:{shape:d}}),g=new y4(c,s,f.shape.length,p.shape.length,u,d,!1,!0),v=n.runWebGLProgram(g,[p,f,m],m.dtype),b=iQ({inputs:{x:v},backend:n,attrs:{shape:a.shape}});return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(v),b}};class u3{constructor(e,t){this.variableNames=["A"];const n=new Array(e.length);for(let i=0;i<n.length;i++)n[i]=e[i]*t[i];this.outputShape=n,this.rank=n.length;const r=KY(this.rank),a=function(e){const t=e.length;if(t>5)throw Error("Tile for rank ".concat(t," is not yet supported"));if(1===t)return"imod(resRC, ".concat(e[0],")");const n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],r=[];for(let a=0;a<e.length;a++)r.push("imod(".concat(n[a],", ").concat(e[a],")"));return r.join()}(e);this.userCode="\n      void main() {\n        ".concat(r," resRC = getOutputCoords();\n        setOutput(getA(").concat(a,"));\n      }\n    ")}}function h3(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{reps:i}=r;if("string"===a.dtype||a.shape.length>5){const e=n.readSync(a.dataId),t="string"===a.dtype?e.map(e=>zC(e)):e,r=II(a.shape,a.dtype,t),o=uJ(r,i);return n.makeTensorInfo(o.shape,o.dtype,o.values)}const o=new u3(a.shape,i);return n.runWebGLProgram(o,[a],a.dtype)}const d3={kernelName:JN,backendName:"webgl",kernelFunc:h3};class f3{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=e,this.userCode="\n       void main() {\n         ivec2 coords = getOutputCoords();\n         int batch = coords[0];\n         int elemIdx = coords[1];\n\n         // We compare elements pair-wise within a group of size 2 * inc.\n         // The comparing rule for each group alternates between ascending\n         // and descending. Within each group, we compare each pair at\n         // positions i and i+inc. To decide whether an element at position i\n         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than\n         // inc, it is in the first half of the group, we denote it as x0,\n         // otherwise we denote it as x1.\n         // For example, as shown in the Bitonic top K paper referenced above,\n         // Figure5(a) shows that element[1] is in the\n         // second half of the group when group size is 2, but it is in the\n         // first half of the group when group size is 4.\n\n         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;\n         int i = isFirstInPair ? elemIdx : elemIdx - inc;\n\n         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));\n         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));\n         float x0 = i0 < n ? getX(batch, i0) : negativeInf;\n         float x1 = i1 < n ? getX(batch, i1) : negativeInf;\n\n         // Denotes which direction indices are in (ascending or descending).\n         bool reverse = imod(elemIdx, 2 * dir) >= dir;\n         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);\n         if (reverse == isGreater) { // Elements in opposite order of direction\n           int iTemp = i0;\n           i0 = i1;\n           i1 = iTemp;\n         }\n         if (isFirstInPair) {\n            setOutput(float(i0));\n         } else {\n            setOutput(float(i1));\n         }\n       }\n     "}}class p3{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=e,this.userCode="\n    void main() {\n         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...\n         ivec2 coords = getOutputCoords();\n         int batch = coords[0];\n         int elemIdx = coords[1];\n\n         // The output size is half of the previous size.\n         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),\n         // we only need to output the indices at positions |, the indices at\n         // positions _ can be thrown away, see Figure5(b) After Phase 2\n         // (Merge phase) in the Bitonic Top K paper referenced above.\n         // For example, the paper shows we only need to output the orange bars.\n         // The output sequence should look like this | | | | | | | |.\n         // Because the sequence is halved, to map the output index back\n         // to the previous sequence to find the corresponding value,\n         // we need to double the index. When we double the index,\n         // we basically interpolate a position, so 2i looks like\n         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position\n         // of each 2k positions by - elemIdx % k. E.g. for output at\n         // index 4,5,6,7, we want to get the corresponding element at\n         // original index 8,9,10,11, for output at index 8,9,10,11,\n         // we want to get the corresponding element at original index\n         // 16,17,18,19, so on and so forth.\n\n         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));\n         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));\n         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));\n\n         float x0 = getX(batch, i0);\n         float x1 = i1 < n ? getX(batch, i1) : x0;\n\n         setOutput(x0 >= x1 ? float(i0) : float(i1));\n       }\n     "}}function m3(e,t){null!==t&&e.disposeIntermediateTensorInfo(t)}function g3(e){let t=1;for(;t<e;)t*=2;return t}const v3={kernelName:QN,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{k:i,sorted:o}=r,s=Yw().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),c=Yw().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),l=a.shape,u=l[l.length-1];if(n.shouldExecuteOnCPU([a])||u<s||i>c){const e=n.readSync(a.dataId),[t,r]=hJ(e,l,a.dtype,i,o);return[n.makeTensorInfo(t.shape,t.dtype,t.values),n.makeTensorInfo(r.shape,r.dtype,r.values)]}if(0===i)return l[l.length-1]=0,[n.makeTensorInfo(l,a.dtype,[]),n.makeTensorInfo(l,"int32",[])];if(1===u)return[a,Y0({attrs:{shape:l,dtype:"int32",value:0},backend:n})];const h=n.texData.get(a.dataId),d=null!==h&&h.isPacked,f=d?n.unpackTensor(a):a,p=bw(l)/u,m=iQ({inputs:{x:f},attrs:{shape:[p,u]},backend:n});d&&m3(n,f);const g=g3(i),v=g3(u);let b=null;const y=()=>null===b?[m,m]:[m,b],x=(e,t,r)=>{const a=y(),i=new f3(r),o=[[u],[null===b?1:0],[Number.NEGATIVE_INFINITY],[e],[t]],s=b;b=n.runWebGLProgram(i,a,"int32",o),m3(n,s)};for(let C=1;C<g;C*=2){const e=2*C;for(let t=C;t>=1;t/=2)x(e,t,[p,v])}for(let C=v;C>g;C/=2){const e=y(),t=new p3([p,C/2]),r=[[u],[null===b?1:0],[g]],a=b;b=n.runWebGLProgram(t,e,"int32",r),m3(n,a);const i=g/2,o=2*i;for(let n=i;n>=1;n/=2)x(o,n,b.shape)}let w=b;b=hZ({inputs:{x:b},backend:n,attrs:{begin:0,size:[p,i]}}),m3(n,w);let k=p1({inputs:{x:m,indices:b},backend:n,attrs:{axis:1,batchDims:1}});m3(n,m);const S=l.slice(0,-1);S.push(i),w=b,b=iQ({inputs:{x:b},attrs:{shape:S},backend:n}),m3(n,w);const N=k;return k=iQ({inputs:{x:k},attrs:{shape:S},backend:n}),m3(n,N),[k,b]}};class b3{constructor(e,t,n,r,a,i){this.variableNames=["Image","Transforms"],this.outputShape=i;const o="nearest"===n?1:2;let s;switch(r){case"constant":default:s=1;break;case"reflect":s=2;break;case"wrap":s=3;break;case"nearest":s=4}this.userCode="\n            float mapCoord(float outCoord, float len) {\n              float inCoord = outCoord;\n              if(".concat(s," == 2) {\n                if (inCoord < 0.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz2 = 2.0 * len;\n                    if (inCoord < sz2) {\n                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +\n                      inCoord;\n                    }\n                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;\n                  }\n                } else if (inCoord > len - 1.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz2 = 2.0 * len;\n                    inCoord -= sz2 * float(int(float(inCoord / sz2)));\n                    if (inCoord >= len) {\n                      inCoord = sz2 - inCoord - 1.0;\n                    }\n                  }\n                }\n                return clamp(inCoord, 0.0, len - 1.0);\n              } else if (").concat(s," == 3) {\n                if (inCoord < 0.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz = len - 1.0;\n                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);\n                  }\n                } else if (inCoord > len - 1.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz = len - 1.0;\n                    inCoord -= len * float(int(float(inCoord / sz)));\n                  }\n                }\n                return clamp(inCoord, 0.0, len - 1.0);\n              } else if (").concat(s," == 4) {\n                return clamp(outCoord, 0.0, len - 1.0);\n              } else {\n                return outCoord;\n              }\n            }\n\n            float readWithFillValue(int batch, int coordY, int coordX,\n              int channel) {\n              float outputValue;\n              if (0 <= coordY && coordY < ").concat(e," && 0 <= coordX && coordX < ").concat(t,") {\n                  outputValue = getImage(batch, coordY, coordX, channel);\n              } else {\n                outputValue = float(").concat(a,");\n              }\n              return outputValue;\n            }\n\n            void main() {\n              ivec4 coords = getOutputCoords();\n              float outputValue;\n              int batch = coords[0];\n              int x = coords[2];\n              int y = coords[1];\n              int channel = coords[3];\n              float xf = float(x);\n              float yf = float(y);\n              float a1 = getTransforms(batch, 0);\n              float a2 = getTransforms(batch, 1);\n              float a3 = getTransforms(batch, 2);\n              float b1 = getTransforms(batch, 3);\n              float b2 = getTransforms(batch, 4);\n              float b3 = getTransforms(batch, 5);\n              float c1 = getTransforms(batch, 6);\n              float c2 = getTransforms(batch, 7);\n              float projection = c1 * xf + c2 * yf + 1.0;\n              if (projection == 0.0) {\n                outputValue = float(").concat(a,");\n              } else {\n                float inX = (a1 * xf + a2 * yf + a3) / projection;\n                float inY = (b1 * xf + b2 * yf + b3) / projection;\n                float mapX = mapCoord(inX, float(").concat(t,"));\n                float mapY = mapCoord(inY, float(").concat(e,"));\n\n                if (").concat(o," == 1) {\n                  int coordY = int(round(mapY));\n                  int coordX = int(round(mapX));\n                  outputValue = readWithFillValue(batch, coordY, coordX,\n                    channel);\n                } else {\n                  float yFloor = floor(mapY);\n                  float xFloor = floor(mapX);\n                  float yCeil = yFloor + 1.0;\n                  float xCeil = xFloor + 1.0;\n                  float valueYFloor = (xCeil - mapX) *\n                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +\n                  (mapX - xFloor) *\n                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);\n                  float valueYCeil = (xCeil - mapX) *\n                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +\n                  (mapX - xFloor) *\n                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);\n                  outputValue = (yCeil - mapY) * valueYFloor +\n                  (mapY - yFloor) * valueYCeil;\n                }\n              }\n              setOutput(outputValue);\n            }\n        ")}}const y3={kernelName:ZN,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{image:a,transforms:i}=t,{interpolation:o,fillMode:s,fillValue:c,outputShape:l}=r,[u,h,d,f]=a.shape,[p,m]=null!=l?l:[h,d],g=new b3(h,d,o,s,c,[u,p,m,f]);return n.runWebGLProgram(g,[a,i],"float32")}};const x3={kernelName:tC,backendName:"webgl",kernelFunc:function(e){const{inputs:t,attrs:n,backend:r}=e,{axis:a}=n,{x:i}=t;_Y(i,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");const o=r.readSync(i.dataId),{outputValues:s,outputShape:c,indices:l}=fJ(o,a,i.shape,i.dtype);return[r.makeTensorInfo(c,i.dtype,s),r.makeTensorInfo([l.length],"int32",l)]}};const w3={kernelName:nC,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{value:a}=t;let{axis:i}=r;i<0&&(i+=a.shape.length);const o=a,s=o.shape.length,c=a.shape[i],l=new Array(s-1);let u=0;for(let m=0;m<s;m++)m!==i&&(l[u++]=o.shape[m]);const h=[],d=new Array(s).fill(0),f=o.shape.slice();f[i]=1;const p=new Array(c);for(let m=0;m<p.length;m++){d[i]=m;const e=hZ({inputs:{x:o},backend:n,attrs:{begin:d,size:f}}),t=iQ({inputs:{x:e},backend:n,attrs:{shape:l}});p[m]=t,h.push(e)}return h.forEach(e=>n.disposeIntermediateTensorInfo(e)),p}};class k3{constructor(e,t){this.variableNames=["x","segmentIds"];const n=e.windowSize,r=e.batchSize,a=e.inSize,i=e.numSegments,o=i*Math.ceil(a/n);this.outputShape=[r,o];const s=4*Math.floor(n/4),c=n%4,l="\n        sumValue += dot(values, segFilter);\n    ";let u="";a%n>0&&(u="\n        if (inIdx < 0 || inIdx >= ".concat(a,") {\n          return initializationValue;\n        }\n      "));let h="";a%n>0&&(h="\n        if (inIdx < 0 || inIdx >= ".concat(a,") {\n          return -1.0;\n        }\n      ")),this.userCode="\n      const float initializationValue = ".concat("0.0",";\n\n      float getValue(int batch, int inIdx) {\n        ").concat(u,"\n        return getX(batch, inIdx);\n      }\n\n      float getSegmentIdAtIndex(int inIdx) {\n        ").concat(h,"\n        return getSegmentIds(inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = int(floor(float(outIdx) / float(\n          ").concat(i,")) * float(").concat(n,"));\n        int currentSeg = int(mod(float(outIdx), float(").concat(i,")));\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < ").concat(s,"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0\n          );\n\n          ").concat(l,"\n        }\n\n        int inIdx = inOffset + ").concat(s,";\n        if (").concat(1===c,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            0,\n            0,\n            0\n          );\n\n          ").concat(l,"\n        } else if (").concat(2===c,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n              0,\n              0\n          );\n\n          ").concat(l,"\n        } else if (").concat(3===c,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            0\n          );\n\n          ").concat(l,"\n        }\n        setOutput(").concat("sumValue",");\n      }\n    ")}}const S3={kernelName:rC,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,segmentIds:i}=t,{numSegments:o}=r,s=a.shape.length,c=[];let l=0;const u=H_([l],s);let h=a;null!=u&&(h=mQ({inputs:{x:a},backend:n,attrs:{perm:u}}),c.push(h),l=q_(1,s)[0]);const d=$F(h.shape,l,o),f=bw([h.shape[l]]),p=iQ({inputs:{x:h},backend:n,attrs:{shape:[-1,f]}});c.push(p);const m=hE(a.dtype),g=(e,t,r,a,i)=>{const o=e.shape[0],s=e.shape[1],l=YF(s,i),u=new k3({windowSize:l,inSize:s,batchSize:o,numSegments:i},t),h=n.compileAndRun(u,[e,r],a);if(c.push(h),h.shape[1]===i)return h;const d=q2({backend:n,attrs:{start:0,stop:i,step:1,dtype:"float32"}}),f=h3({inputs:{x:d},backend:n,attrs:{reps:[s/l]}});c.push(d),c.push(f);return g(h,t,f,a,i)},v=iQ({inputs:{x:g(p,"unsortedSegmentSum",i,m,o)},backend:n,attrs:{shape:d}});let b=v;if(null!=u){c.push(v);const e=G_(u);b=mQ({inputs:{x:b},backend:n,attrs:{perm:e}})}return c.forEach(e=>n.disposeIntermediateTensorInfo(e)),b}},N3=[bQ,xQ,kQ,NQ,IQ,AQ,RQ,FQ,jQ,BQ,UQ,VQ,GQ,KQ,YQ,QQ,ZQ,nZ,rZ,aZ,sZ,fZ,pZ,mZ,gZ,wZ,NZ,IZ,UJ,AZ,jZ,qZ,JZ,ZZ,e0,t0,n0,a0,o0,c0,p0,m0,g0,b0,w0,N0,C0,I0,_0,A0,F0,D0,L0,M0,B0,U0,H0,K0,$0,Q0,t1,r1,o1,l1,u1,d1,m1,v1,y1,BJ,x1,LZ,k1,N1,E1,HJ,T1,A1,R1,D1,L1,M1,B1,U1,H1,q1,X1,$1,J1,Q1,t2,n2,r2,a2,i2,s2,u2,d2,w2,aQ,S2,C2,I2,_2,bZ,R2,O2,L2,B2,U2,KJ,W2,V2,H2,G2,K2,xZ,m2,Y2,J2,Z2,oQ,n4,a4,s4,l4,d4,p4,g4,b4,w4,S4,C4,I4,_4,R4,D4,L4,dZ,x2,M4,j4,B4,z4,U4,W4,V4,H4,K4,X4,J4,Q4,Z4,t3,n3,r3,a3,b2,pQ,o3,c3,l3,d3,v3,y3,gQ,x3,w3,S3,D2];for(const n of N3)bC(n);var C3={version:"0.18.5"},E3=1200,I3=1252,T3=[874,932,936,949,950,1250,1251,1252,1253,1254,1255,1256,1257,1258,1e4],_3={0:1252,1:65001,2:65001,77:1e4,128:932,129:949,130:1361,134:936,136:950,161:1253,162:1254,163:1258,177:1255,178:1256,186:1257,204:1251,222:874,238:1250,255:1252,69:6969},A3=function(e){-1!=T3.indexOf(e)&&(I3=_3[0]=e)};var R3=function(e){E3=e,A3(e)};function F3(){R3(1200),A3(1252)}function D3(e){for(var t=[],n=0;n<e.length>>1;++n)t[n]=String.fromCharCode(e.charCodeAt(2*n+1)+(e.charCodeAt(2*n)<<8));return t.join("")}var O3,L3=function(e){return String.fromCharCode(e)},P3=function(e){return String.fromCharCode(e)};var M3="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function j3(e){for(var t="",n=0,r=0,a=0,i=0,o=0,s=0,c=0,l=0;l<e.length;)i=(n=e.charCodeAt(l++))>>2,o=(3&n)<<4|(r=e.charCodeAt(l++))>>4,s=(15&r)<<2|(a=e.charCodeAt(l++))>>6,c=63&a,isNaN(r)?s=c=64:isNaN(a)&&(c=64),t+=M3.charAt(i)+M3.charAt(o)+M3.charAt(s)+M3.charAt(c);return t}function B3(e){var t="",n=0,r=0,a=0,i=0,o=0,s=0;e=e.replace(/[^\w\+\/\=]/g,"");for(var c=0;c<e.length;)n=M3.indexOf(e.charAt(c++))<<2|(i=M3.indexOf(e.charAt(c++)))>>4,t+=String.fromCharCode(n),r=(15&i)<<4|(o=M3.indexOf(e.charAt(c++)))>>2,64!==o&&(t+=String.fromCharCode(r)),a=(3&o)<<6|(s=M3.indexOf(e.charAt(c++))),64!==s&&(t+=String.fromCharCode(a));return t}var z3=function(){return"undefined"!==typeof Buffer&&"undefined"!==typeof process&&"undefined"!==typeof process.versions&&!!process.versions.node}(),U3=function(){if("undefined"!==typeof Buffer){var e=!Buffer.from;if(!e)try{Buffer.from("foo","utf8")}catch(_a){e=!0}return e?function(e,t){return t?new Buffer(e,t):new Buffer(e)}:Buffer.from.bind(Buffer)}return function(){}}();function W3(e){return z3?Buffer.alloc?Buffer.alloc(e):new Buffer(e):"undefined"!=typeof Uint8Array?new Uint8Array(e):new Array(e)}function V3(e){return z3?Buffer.allocUnsafe?Buffer.allocUnsafe(e):new Buffer(e):"undefined"!=typeof Uint8Array?new Uint8Array(e):new Array(e)}var H3=function(e){return z3?U3(e,"binary"):e.split("").map(function(e){return 255&e.charCodeAt(0)})};function G3(e){if("undefined"===typeof ArrayBuffer)return H3(e);for(var t=new ArrayBuffer(e.length),n=new Uint8Array(t),r=0;r!=e.length;++r)n[r]=255&e.charCodeAt(r);return t}function q3(e){if(Array.isArray(e))return e.map(function(e){return String.fromCharCode(e)}).join("");for(var t=[],n=0;n<e.length;++n)t[n]=String.fromCharCode(e[n]);return t.join("")}var K3=z3?function(e){return Buffer.concat(e.map(function(e){return Buffer.isBuffer(e)?e:U3(e)}))}:function(e){if("undefined"!==typeof Uint8Array){var t=0,n=0;for(t=0;t<e.length;++t)n+=e[t].length;var r=new Uint8Array(n),a=0;for(t=0,n=0;t<e.length;n+=a,++t)if(a=e[t].length,e[t]instanceof Uint8Array)r.set(e[t],n);else{if("string"==typeof e[t])throw"wtf";r.set(new Uint8Array(e[t]),n)}return r}return[].concat.apply([],e.map(function(e){return Array.isArray(e)?e:[].slice.call(e)}))};var X3=/\u0000/g,Y3=/[\u0001-\u0006]/g;function $3(e){for(var t="",n=e.length-1;n>=0;)t+=e.charAt(n--);return t}function J3(e,t){var n=""+e;return n.length>=t?n:l6("0",t-n.length)+n}function Q3(e,t){var n=""+e;return n.length>=t?n:l6(" ",t-n.length)+n}function Z3(e,t){var n=""+e;return n.length>=t?n:n+l6(" ",t-n.length)}var e5=Math.pow(2,32);function t5(e,t){return e>e5||e<-e5?function(e,t){var n=""+Math.round(e);return n.length>=t?n:l6("0",t-n.length)+n}(e,t):function(e,t){var n=""+e;return n.length>=t?n:l6("0",t-n.length)+n}(Math.round(e),t)}function n5(e,t){return t=t||0,e.length>=7+t&&103===(32|e.charCodeAt(t))&&101===(32|e.charCodeAt(t+1))&&110===(32|e.charCodeAt(t+2))&&101===(32|e.charCodeAt(t+3))&&114===(32|e.charCodeAt(t+4))&&97===(32|e.charCodeAt(t+5))&&108===(32|e.charCodeAt(t+6))}var r5=[["Sun","Sunday"],["Mon","Monday"],["Tue","Tuesday"],["Wed","Wednesday"],["Thu","Thursday"],["Fri","Friday"],["Sat","Saturday"]],a5=[["J","Jan","January"],["F","Feb","February"],["M","Mar","March"],["A","Apr","April"],["M","May","May"],["J","Jun","June"],["J","Jul","July"],["A","Aug","August"],["S","Sep","September"],["O","Oct","October"],["N","Nov","November"],["D","Dec","December"]];var i5={0:"General",1:"0",2:"0.00",3:"#,##0",4:"#,##0.00",9:"0%",10:"0.00%",11:"0.00E+00",12:"# ?/?",13:"# ??/??",14:"m/d/yy",15:"d-mmm-yy",16:"d-mmm",17:"mmm-yy",18:"h:mm AM/PM",19:"h:mm:ss AM/PM",20:"h:mm",21:"h:mm:ss",22:"m/d/yy h:mm",37:"#,##0 ;(#,##0)",38:"#,##0 ;[Red](#,##0)",39:"#,##0.00;(#,##0.00)",40:"#,##0.00;[Red](#,##0.00)",45:"mm:ss",46:"[h]:mm:ss",47:"mmss.0",48:"##0.0E+0",49:"@",56:'"\u4e0a\u5348/\u4e0b\u5348 "hh"\u6642"mm"\u5206"ss"\u79d2 "'},o5={5:37,6:38,7:39,8:40,23:0,24:0,25:0,26:0,27:14,28:14,29:14,30:14,31:14,50:14,51:14,52:14,53:14,54:14,55:14,56:14,57:14,58:14,59:1,60:2,61:3,62:4,67:9,68:10,69:12,70:13,71:14,72:14,73:15,74:16,75:17,76:20,77:21,78:22,79:45,80:46,81:47,82:0},s5={5:'"$"#,##0_);\\("$"#,##0\\)',63:'"$"#,##0_);\\("$"#,##0\\)',6:'"$"#,##0_);[Red]\\("$"#,##0\\)',64:'"$"#,##0_);[Red]\\("$"#,##0\\)',7:'"$"#,##0.00_);\\("$"#,##0.00\\)',65:'"$"#,##0.00_);\\("$"#,##0.00\\)',8:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',66:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',41:'_(* #,##0_);_(* \\(#,##0\\);_(* "-"_);_(@_)',42:'_("$"* #,##0_);_("$"* \\(#,##0\\);_("$"* "-"_);_(@_)',43:'_(* #,##0.00_);_(* \\(#,##0.00\\);_(* "-"??_);_(@_)',44:'_("$"* #,##0.00_);_("$"* \\(#,##0.00\\);_("$"* "-"??_);_(@_)'};function c5(e,t,n){for(var r=e<0?-1:1,a=e*r,i=0,o=1,s=0,c=1,l=0,u=0,h=Math.floor(a);l<t&&(s=(h=Math.floor(a))*o+i,u=h*l+c,!(a-h<5e-8));)a=1/(a-h),i=o,o=s,c=l,l=u;if(u>t&&(l>t?(u=c,s=i):(u=l,s=o)),!n)return[0,r*s,u];var d=Math.floor(r*s/u);return[d,r*s-d*u,u]}function l5(e,t,n){if(e>2958465||e<0)return null;var r=0|e,a=Math.floor(86400*(e-r)),i=0,o=[],s={D:r,T:a,u:86400*(e-r)-a,y:0,m:0,d:0,H:0,M:0,S:0,q:0};if(Math.abs(s.u)<1e-6&&(s.u=0),t&&t.date1904&&(r+=1462),s.u>.9999&&(s.u=0,86400==++a&&(s.T=a=0,++r,++s.D)),60===r)o=n?[1317,10,29]:[1900,2,29],i=3;else if(0===r)o=n?[1317,8,29]:[1900,1,0],i=6;else{r>60&&--r;var c=new Date(1900,0,1);c.setDate(c.getDate()+r-1),o=[c.getFullYear(),c.getMonth()+1,c.getDate()],i=c.getDay(),r<60&&(i=(i+6)%7),n&&(i=function(e,t){t[0]-=581;var n=e.getDay();e<60&&(n=(n+6)%7);return n}(c,o))}return s.y=o[0],s.m=o[1],s.d=o[2],s.S=a%60,a=Math.floor(a/60),s.M=a%60,a=Math.floor(a/60),s.H=a,s.q=i,s}var u5=new Date(1899,11,31,0,0,0),h5=u5.getTime(),d5=new Date(1900,2,1,0,0,0);function f5(e,t){var n=e.getTime();return t?n-=1262304e5:e>=d5&&(n+=864e5),(n-(h5+6e4*(e.getTimezoneOffset()-u5.getTimezoneOffset())))/864e5}function p5(e){return-1==e.indexOf(".")?e:e.replace(/(?:\.0*|(\.\d*[1-9])0+)$/,"$1")}function m5(e){var t,n=Math.floor(Math.log(Math.abs(e))*Math.LOG10E);return t=n>=-4&&n<=-1?e.toPrecision(10+n):Math.abs(n)<=9?function(e){var t=e<0?12:11,n=p5(e.toFixed(12));return n.length<=t||(n=e.toPrecision(10)).length<=t?n:e.toExponential(5)}(e):10===n?e.toFixed(10).substr(0,12):function(e){var t=p5(e.toFixed(11));return t.length>(e<0?12:11)||"0"===t||"-0"===t?e.toPrecision(6):t}(e),p5(function(e){return-1==e.indexOf("E")?e:e.replace(/(?:\.0*|(\.\d*[1-9])0+)[Ee]/,"$1E").replace(/(E[+-])(\d)$/,"$10$2")}(t.toUpperCase()))}function g5(e,t){switch(typeof e){case"string":return e;case"boolean":return e?"TRUE":"FALSE";case"number":return(0|e)===e?e.toString(10):m5(e);case"undefined":return"";case"object":if(null==e)return"";if(e instanceof Date)return M5(14,f5(e,t&&t.date1904),t)}throw new Error("unsupported value in General format: "+e)}function v5(e,t,n,r){var a,i="",o=0,s=0,c=n.y,l=0;switch(e){case 98:c=n.y+543;case 121:switch(t.length){case 1:case 2:a=c%100,l=2;break;default:a=c%1e4,l=4}break;case 109:switch(t.length){case 1:case 2:a=n.m,l=t.length;break;case 3:return a5[n.m-1][1];case 5:return a5[n.m-1][0];default:return a5[n.m-1][2]}break;case 100:switch(t.length){case 1:case 2:a=n.d,l=t.length;break;case 3:return r5[n.q][0];default:return r5[n.q][1]}break;case 104:switch(t.length){case 1:case 2:a=1+(n.H+11)%12,l=t.length;break;default:throw"bad hour format: "+t}break;case 72:switch(t.length){case 1:case 2:a=n.H,l=t.length;break;default:throw"bad hour format: "+t}break;case 77:switch(t.length){case 1:case 2:a=n.M,l=t.length;break;default:throw"bad minute format: "+t}break;case 115:if("s"!=t&&"ss"!=t&&".0"!=t&&".00"!=t&&".000"!=t)throw"bad second format: "+t;return 0!==n.u||"s"!=t&&"ss"!=t?(s=r>=2?3===r?1e3:100:1===r?10:1,(o=Math.round(s*(n.S+n.u)))>=60*s&&(o=0),"s"===t?0===o?"0":""+o/s:(i=J3(o,2+r),"ss"===t?i.substr(0,2):"."+i.substr(2,t.length-1))):J3(n.S,t.length);case 90:switch(t){case"[h]":case"[hh]":a=24*n.D+n.H;break;case"[m]":case"[mm]":a=60*(24*n.D+n.H)+n.M;break;case"[s]":case"[ss]":a=60*(60*(24*n.D+n.H)+n.M)+Math.round(n.S+n.u);break;default:throw"bad abstime format: "+t}l=3===t.length?1:2;break;case 101:a=c,l=1}return l>0?J3(a,l):""}function b5(e){if(e.length<=3)return e;for(var t=e.length%3,n=e.substr(0,t);t!=e.length;t+=3)n+=(n.length>0?",":"")+e.substr(t,3);return n}var y5=/%/g;function x5(e,t){var n,r=e.indexOf("E")-e.indexOf(".")-1;if(e.match(/^#+0.0E\+0$/)){if(0==t)return"0.0E+0";if(t<0)return"-"+x5(e,-t);var a=e.indexOf(".");-1===a&&(a=e.indexOf("E"));var i=Math.floor(Math.log(t)*Math.LOG10E)%a;if(i<0&&(i+=a),-1===(n=(t/Math.pow(10,i)).toPrecision(r+1+(a+i)%a)).indexOf("e")){var o=Math.floor(Math.log(t)*Math.LOG10E);for(-1===n.indexOf(".")?n=n.charAt(0)+"."+n.substr(1)+"E+"+(o-n.length+i):n+="E+"+(o-i);"0."===n.substr(0,2);)n=(n=n.charAt(0)+n.substr(2,a)+"."+n.substr(2+a)).replace(/^0+([1-9])/,"$1").replace(/^0+\./,"0.");n=n.replace(/\+-/,"-")}n=n.replace(/^([+-]?)(\d*)\.(\d*)[Ee]/,function(e,t,n,r){return t+n+r.substr(0,(a+i)%a)+"."+r.substr(i)+"E"})}else n=t.toExponential(r);return e.match(/E\+00$/)&&n.match(/e[+-]\d$/)&&(n=n.substr(0,n.length-1)+"0"+n.charAt(n.length-1)),e.match(/E\-/)&&n.match(/e\+/)&&(n=n.replace(/e\+/,"e")),n.replace("e","E")}var w5=/# (\?+)( ?)\/( ?)(\d+)/;var k5=/^#*0*\.([0#]+)/,S5=/\).*[0#]/,N5=/\(###\) ###\\?-####/;function C5(e){for(var t,n="",r=0;r!=e.length;++r)switch(t=e.charCodeAt(r)){case 35:break;case 63:n+=" ";break;case 48:n+="0";break;default:n+=String.fromCharCode(t)}return n}function E5(e,t){var n=Math.pow(10,t);return""+Math.round(e*n)/n}function I5(e,t){var n=e-Math.floor(e),r=Math.pow(10,t);return t<(""+Math.round(n*r)).length?0:Math.round(n*r)}function T5(e,t,n){if(40===e.charCodeAt(0)&&!t.match(S5)){var r=t.replace(/\( */,"").replace(/ \)/,"").replace(/\)/,"");return n>=0?T5("n",r,n):"("+T5("n",r,-n)+")"}if(44===t.charCodeAt(t.length-1))return function(e,t,n){for(var r=t.length-1;44===t.charCodeAt(r-1);)--r;return R5(e,t.substr(0,r),n/Math.pow(10,3*(t.length-r)))}(e,t,n);if(-1!==t.indexOf("%"))return function(e,t,n){var r=t.replace(y5,""),a=t.length-r.length;return R5(e,r,n*Math.pow(10,2*a))+l6("%",a)}(e,t,n);if(-1!==t.indexOf("E"))return x5(t,n);if(36===t.charCodeAt(0))return"$"+T5(e,t.substr(" "==t.charAt(1)?2:1),n);var a,i,o,s,c=Math.abs(n),l=n<0?"-":"";if(t.match(/^00+$/))return l+t5(c,t.length);if(t.match(/^[#?]+$/))return"0"===(a=t5(n,0))&&(a=""),a.length>t.length?a:C5(t.substr(0,t.length-a.length))+a;if(i=t.match(w5))return function(e,t,n){var r=parseInt(e[4],10),a=Math.round(t*r),i=Math.floor(a/r),o=a-i*r,s=r;return n+(0===i?"":""+i)+" "+(0===o?l6(" ",e[1].length+1+e[4].length):Q3(o,e[1].length)+e[2]+"/"+e[3]+J3(s,e[4].length))}(i,c,l);if(t.match(/^#+0+$/))return l+t5(c,t.length-t.indexOf("0"));if(i=t.match(k5))return a=E5(n,i[1].length).replace(/^([^\.]+)$/,"$1."+C5(i[1])).replace(/\.$/,"."+C5(i[1])).replace(/\.(\d*)$/,function(e,t){return"."+t+l6("0",C5(i[1]).length-t.length)}),-1!==t.indexOf("0.")?a:a.replace(/^0\./,".");if(t=t.replace(/^#+([0.])/,"$1"),i=t.match(/^(0*)\.(#*)$/))return l+E5(c,i[2].length).replace(/\.(\d*[1-9])0*$/,".$1").replace(/^(-?\d*)$/,"$1.").replace(/^0\./,i[1].length?"0.":".");if(i=t.match(/^#{1,3},##0(\.?)$/))return l+b5(t5(c,0));if(i=t.match(/^#,##0\.([#0]*0)$/))return n<0?"-"+T5(e,t,-n):b5(""+(Math.floor(n)+function(e,t){return t<(""+Math.round((e-Math.floor(e))*Math.pow(10,t))).length?1:0}(n,i[1].length)))+"."+J3(I5(n,i[1].length),i[1].length);if(i=t.match(/^#,#*,#0/))return T5(e,t.replace(/^#,#*,/,""),n);if(i=t.match(/^([0#]+)(\\?-([0#]+))+$/))return a=$3(T5(e,t.replace(/[\\-]/g,""),n)),o=0,$3($3(t.replace(/\\/g,"")).replace(/[0#]/g,function(e){return o<a.length?a.charAt(o++):"0"===e?"0":""}));if(t.match(N5))return"("+(a=T5(e,"##########",n)).substr(0,3)+") "+a.substr(3,3)+"-"+a.substr(6);var u="";if(i=t.match(/^([#0?]+)( ?)\/( ?)([#0?]+)/))return o=Math.min(i[4].length,7),s=c5(c,Math.pow(10,o)-1,!1),a=""+l," "==(u=R5("n",i[1],s[1])).charAt(u.length-1)&&(u=u.substr(0,u.length-1)+"0"),a+=u+i[2]+"/"+i[3],(u=Z3(s[2],o)).length<i[4].length&&(u=C5(i[4].substr(i[4].length-u.length))+u),a+=u;if(i=t.match(/^# ([#0?]+)( ?)\/( ?)([#0?]+)/))return o=Math.min(Math.max(i[1].length,i[4].length),7),l+((s=c5(c,Math.pow(10,o)-1,!0))[0]||(s[1]?"":"0"))+" "+(s[1]?Q3(s[1],o)+i[2]+"/"+i[3]+Z3(s[2],o):l6(" ",2*o+1+i[2].length+i[3].length));if(i=t.match(/^[#0?]+$/))return a=t5(n,0),t.length<=a.length?a:C5(t.substr(0,t.length-a.length))+a;if(i=t.match(/^([#0?]+)\.([#0]+)$/)){a=""+n.toFixed(Math.min(i[2].length,10)).replace(/([^0])0+$/,"$1"),o=a.indexOf(".");var h=t.indexOf(".")-o,d=t.length-a.length-h;return C5(t.substr(0,h)+a+t.substr(t.length-d))}if(i=t.match(/^00,000\.([#0]*0)$/))return o=I5(n,i[1].length),n<0?"-"+T5(e,t,-n):b5(function(e){return e<2147483647&&e>-2147483648?""+(e>=0?0|e:e-1|0):""+Math.floor(e)}(n)).replace(/^\d,\d{3}$/,"0$&").replace(/^\d*$/,function(e){return"00,"+(e.length<3?J3(0,3-e.length):"")+e})+"."+J3(o,i[1].length);switch(t){case"###,##0.00":return T5(e,"#,##0.00",n);case"###,###":case"##,###":case"#,###":var f=b5(t5(c,0));return"0"!==f?l+f:"";case"###,###.00":return T5(e,"###,##0.00",n).replace(/^0\./,".");case"#,###.00":return T5(e,"#,##0.00",n).replace(/^0\./,".")}throw new Error("unsupported format |"+t+"|")}function _5(e,t){var n,r=e.indexOf("E")-e.indexOf(".")-1;if(e.match(/^#+0.0E\+0$/)){if(0==t)return"0.0E+0";if(t<0)return"-"+_5(e,-t);var a=e.indexOf(".");-1===a&&(a=e.indexOf("E"));var i=Math.floor(Math.log(t)*Math.LOG10E)%a;if(i<0&&(i+=a),!(n=(t/Math.pow(10,i)).toPrecision(r+1+(a+i)%a)).match(/[Ee]/)){var o=Math.floor(Math.log(t)*Math.LOG10E);-1===n.indexOf(".")?n=n.charAt(0)+"."+n.substr(1)+"E+"+(o-n.length+i):n+="E+"+(o-i),n=n.replace(/\+-/,"-")}n=n.replace(/^([+-]?)(\d*)\.(\d*)[Ee]/,function(e,t,n,r){return t+n+r.substr(0,(a+i)%a)+"."+r.substr(i)+"E"})}else n=t.toExponential(r);return e.match(/E\+00$/)&&n.match(/e[+-]\d$/)&&(n=n.substr(0,n.length-1)+"0"+n.charAt(n.length-1)),e.match(/E\-/)&&n.match(/e\+/)&&(n=n.replace(/e\+/,"e")),n.replace("e","E")}function A5(e,t,n){if(40===e.charCodeAt(0)&&!t.match(S5)){var r=t.replace(/\( */,"").replace(/ \)/,"").replace(/\)/,"");return n>=0?A5("n",r,n):"("+A5("n",r,-n)+")"}if(44===t.charCodeAt(t.length-1))return function(e,t,n){for(var r=t.length-1;44===t.charCodeAt(r-1);)--r;return R5(e,t.substr(0,r),n/Math.pow(10,3*(t.length-r)))}(e,t,n);if(-1!==t.indexOf("%"))return function(e,t,n){var r=t.replace(y5,""),a=t.length-r.length;return R5(e,r,n*Math.pow(10,2*a))+l6("%",a)}(e,t,n);if(-1!==t.indexOf("E"))return _5(t,n);if(36===t.charCodeAt(0))return"$"+A5(e,t.substr(" "==t.charAt(1)?2:1),n);var a,i,o,s,c=Math.abs(n),l=n<0?"-":"";if(t.match(/^00+$/))return l+J3(c,t.length);if(t.match(/^[#?]+$/))return a=""+n,0===n&&(a=""),a.length>t.length?a:C5(t.substr(0,t.length-a.length))+a;if(i=t.match(w5))return function(e,t,n){return n+(0===t?"":""+t)+l6(" ",e[1].length+2+e[4].length)}(i,c,l);if(t.match(/^#+0+$/))return l+J3(c,t.length-t.indexOf("0"));if(i=t.match(k5))return a=(a=(""+n).replace(/^([^\.]+)$/,"$1."+C5(i[1])).replace(/\.$/,"."+C5(i[1]))).replace(/\.(\d*)$/,function(e,t){return"."+t+l6("0",C5(i[1]).length-t.length)}),-1!==t.indexOf("0.")?a:a.replace(/^0\./,".");if(t=t.replace(/^#+([0.])/,"$1"),i=t.match(/^(0*)\.(#*)$/))return l+(""+c).replace(/\.(\d*[1-9])0*$/,".$1").replace(/^(-?\d*)$/,"$1.").replace(/^0\./,i[1].length?"0.":".");if(i=t.match(/^#{1,3},##0(\.?)$/))return l+b5(""+c);if(i=t.match(/^#,##0\.([#0]*0)$/))return n<0?"-"+A5(e,t,-n):b5(""+n)+"."+l6("0",i[1].length);if(i=t.match(/^#,#*,#0/))return A5(e,t.replace(/^#,#*,/,""),n);if(i=t.match(/^([0#]+)(\\?-([0#]+))+$/))return a=$3(A5(e,t.replace(/[\\-]/g,""),n)),o=0,$3($3(t.replace(/\\/g,"")).replace(/[0#]/g,function(e){return o<a.length?a.charAt(o++):"0"===e?"0":""}));if(t.match(N5))return"("+(a=A5(e,"##########",n)).substr(0,3)+") "+a.substr(3,3)+"-"+a.substr(6);var u="";if(i=t.match(/^([#0?]+)( ?)\/( ?)([#0?]+)/))return o=Math.min(i[4].length,7),s=c5(c,Math.pow(10,o)-1,!1),a=""+l," "==(u=R5("n",i[1],s[1])).charAt(u.length-1)&&(u=u.substr(0,u.length-1)+"0"),a+=u+i[2]+"/"+i[3],(u=Z3(s[2],o)).length<i[4].length&&(u=C5(i[4].substr(i[4].length-u.length))+u),a+=u;if(i=t.match(/^# ([#0?]+)( ?)\/( ?)([#0?]+)/))return o=Math.min(Math.max(i[1].length,i[4].length),7),l+((s=c5(c,Math.pow(10,o)-1,!0))[0]||(s[1]?"":"0"))+" "+(s[1]?Q3(s[1],o)+i[2]+"/"+i[3]+Z3(s[2],o):l6(" ",2*o+1+i[2].length+i[3].length));if(i=t.match(/^[#0?]+$/))return a=""+n,t.length<=a.length?a:C5(t.substr(0,t.length-a.length))+a;if(i=t.match(/^([#0]+)\.([#0]+)$/)){a=""+n.toFixed(Math.min(i[2].length,10)).replace(/([^0])0+$/,"$1"),o=a.indexOf(".");var h=t.indexOf(".")-o,d=t.length-a.length-h;return C5(t.substr(0,h)+a+t.substr(t.length-d))}if(i=t.match(/^00,000\.([#0]*0)$/))return n<0?"-"+A5(e,t,-n):b5(""+n).replace(/^\d,\d{3}$/,"0$&").replace(/^\d*$/,function(e){return"00,"+(e.length<3?J3(0,3-e.length):"")+e})+"."+J3(0,i[1].length);switch(t){case"###,###":case"##,###":case"#,###":var f=b5(""+c);return"0"!==f?l+f:"";default:if(t.match(/\.[0#?]*$/))return A5(e,t.slice(0,t.lastIndexOf(".")),n)+C5(t.slice(t.lastIndexOf(".")))}throw new Error("unsupported format |"+t+"|")}function R5(e,t,n){return(0|n)===n?A5(e,t,n):T5(e,t,n)}var F5=/\[[HhMmSs\u0E0A\u0E19\u0E17]*\]/;function D5(e){for(var t=0,n="",r="";t<e.length;)switch(n=e.charAt(t)){case"G":n5(e,t)&&(t+=6),t++;break;case'"':for(;34!==e.charCodeAt(++t)&&t<e.length;);++t;break;case"\\":case"_":t+=2;break;case"@":++t;break;case"B":case"b":if("1"===e.charAt(t+1)||"2"===e.charAt(t+1))return!0;case"M":case"D":case"Y":case"H":case"S":case"E":case"m":case"d":case"y":case"h":case"s":case"e":case"g":return!0;case"A":case"a":case"\u4e0a":if("A/P"===e.substr(t,3).toUpperCase())return!0;if("AM/PM"===e.substr(t,5).toUpperCase())return!0;if("\u4e0a\u5348/\u4e0b\u5348"===e.substr(t,5).toUpperCase())return!0;++t;break;case"[":for(r=n;"]"!==e.charAt(t++)&&t<e.length;)r+=e.charAt(t);if(r.match(F5))return!0;break;case".":case"0":case"#":for(;t<e.length&&("0#?.,E+-%".indexOf(n=e.charAt(++t))>-1||"\\"==n&&"-"==e.charAt(t+1)&&"0#".indexOf(e.charAt(t+2))>-1););break;case"?":for(;e.charAt(++t)===n;);break;case"*":++t," "!=e.charAt(t)&&"*"!=e.charAt(t)||++t;break;case"(":case")":++t;break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":for(;t<e.length&&"0123456789".indexOf(e.charAt(++t))>-1;);break;default:++t}return!1}var O5=/\[(=|>[=]?|<[>=]?)(-?\d+(?:\.\d*)?)\]/;function L5(e,t){if(null==t)return!1;var n=parseFloat(t[2]);switch(t[1]){case"=":if(e==n)return!0;break;case">":if(e>n)return!0;break;case"<":if(e<n)return!0;break;case"<>":if(e!=n)return!0;break;case">=":if(e>=n)return!0;break;case"<=":if(e<=n)return!0}return!1}function P5(e,t){var n=function(e){for(var t=[],n=!1,r=0,a=0;r<e.length;++r)switch(e.charCodeAt(r)){case 34:n=!n;break;case 95:case 42:case 92:++r;break;case 59:t[t.length]=e.substr(a,r-a),a=r+1}if(t[t.length]=e.substr(a),!0===n)throw new Error("Format |"+e+"| unterminated string ");return t}(e),r=n.length,a=n[r-1].indexOf("@");if(r<4&&a>-1&&--r,n.length>4)throw new Error("cannot find right format for |"+n.join("|")+"|");if("number"!==typeof t)return[4,4===n.length||a>-1?n[n.length-1]:"@"];switch(n.length){case 1:n=a>-1?["General","General","General",n[0]]:[n[0],n[0],n[0],"@"];break;case 2:n=a>-1?[n[0],n[0],n[0],n[1]]:[n[0],n[1],n[0],"@"];break;case 3:n=a>-1?[n[0],n[1],n[0],n[2]]:[n[0],n[1],n[2],"@"]}var i=t>0?n[0]:t<0?n[1]:n[2];if(-1===n[0].indexOf("[")&&-1===n[1].indexOf("["))return[r,i];if(null!=n[0].match(/\[[=<>]/)||null!=n[1].match(/\[[=<>]/)){var o=n[0].match(O5),s=n[1].match(O5);return L5(t,o)?[r,n[0]]:L5(t,s)?[r,n[1]]:[r,n[null!=o&&null!=s?2:1]]}return[r,i]}function M5(e,t,n){null==n&&(n={});var r="";switch(typeof e){case"string":r="m/d/yy"==e&&n.dateNF?n.dateNF:e;break;case"number":null==(r=14==e&&n.dateNF?n.dateNF:(null!=n.table?n.table:i5)[e])&&(r=n.table&&n.table[o5[e]]||i5[o5[e]]),null==r&&(r=s5[e]||"General")}if(n5(r,0))return g5(t,n);t instanceof Date&&(t=f5(t,n.date1904));var a=P5(r,t);if(n5(a[1]))return g5(t,n);if(!0===t)t="TRUE";else if(!1===t)t="FALSE";else if(""===t||null==t)return"";return function(e,t,n,r){for(var a,i,o,s=[],c="",l=0,u="",h="t",d="H";l<e.length;)switch(u=e.charAt(l)){case"G":if(!n5(e,l))throw new Error("unrecognized character "+u+" in "+e);s[s.length]={t:"G",v:"General"},l+=7;break;case'"':for(c="";34!==(o=e.charCodeAt(++l))&&l<e.length;)c+=String.fromCharCode(o);s[s.length]={t:"t",v:c},++l;break;case"\\":var f=e.charAt(++l),p="("===f||")"===f?f:"t";s[s.length]={t:p,v:f},++l;break;case"_":s[s.length]={t:"t",v:" "},l+=2;break;case"@":s[s.length]={t:"T",v:t},++l;break;case"B":case"b":if("1"===e.charAt(l+1)||"2"===e.charAt(l+1)){if(null==a&&null==(a=l5(t,n,"2"===e.charAt(l+1))))return"";s[s.length]={t:"X",v:e.substr(l,2)},h=u,l+=2;break}case"M":case"D":case"Y":case"H":case"S":case"E":u=u.toLowerCase();case"m":case"d":case"y":case"h":case"s":case"e":case"g":if(t<0)return"";if(null==a&&null==(a=l5(t,n)))return"";for(c=u;++l<e.length&&e.charAt(l).toLowerCase()===u;)c+=u;"m"===u&&"h"===h.toLowerCase()&&(u="M"),"h"===u&&(u=d),s[s.length]={t:u,v:c},h=u;break;case"A":case"a":case"\u4e0a":var m={t:u,v:u};if(null==a&&(a=l5(t,n)),"A/P"===e.substr(l,3).toUpperCase()?(null!=a&&(m.v=a.H>=12?"P":"A"),m.t="T",d="h",l+=3):"AM/PM"===e.substr(l,5).toUpperCase()?(null!=a&&(m.v=a.H>=12?"PM":"AM"),m.t="T",l+=5,d="h"):"\u4e0a\u5348/\u4e0b\u5348"===e.substr(l,5).toUpperCase()?(null!=a&&(m.v=a.H>=12?"\u4e0b\u5348":"\u4e0a\u5348"),m.t="T",l+=5,d="h"):(m.t="t",++l),null==a&&"T"===m.t)return"";s[s.length]=m,h=u;break;case"[":for(c=u;"]"!==e.charAt(l++)&&l<e.length;)c+=e.charAt(l);if("]"!==c.slice(-1))throw'unterminated "[" block: |'+c+"|";if(c.match(F5)){if(null==a&&null==(a=l5(t,n)))return"";s[s.length]={t:"Z",v:c.toLowerCase()},h=c.charAt(1)}else c.indexOf("$")>-1&&(c=(c.match(/\$([^-\[\]]*)/)||[])[1]||"$",D5(e)||(s[s.length]={t:"t",v:c}));break;case".":if(null!=a){for(c=u;++l<e.length&&"0"===(u=e.charAt(l));)c+=u;s[s.length]={t:"s",v:c};break}case"0":case"#":for(c=u;++l<e.length&&"0#?.,E+-%".indexOf(u=e.charAt(l))>-1;)c+=u;s[s.length]={t:"n",v:c};break;case"?":for(c=u;e.charAt(++l)===u;)c+=u;s[s.length]={t:u,v:c},h=u;break;case"*":++l," "!=e.charAt(l)&&"*"!=e.charAt(l)||++l;break;case"(":case")":s[s.length]={t:1===r?"t":u,v:u},++l;break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":for(c=u;l<e.length&&"0123456789".indexOf(e.charAt(++l))>-1;)c+=e.charAt(l);s[s.length]={t:"D",v:c};break;case" ":s[s.length]={t:u,v:u},++l;break;case"$":s[s.length]={t:"t",v:"$"},++l;break;default:if(-1===",$-+/():!^&'~{}<>=\u20acacfijklopqrtuvwxzP".indexOf(u))throw new Error("unrecognized character "+u+" in "+e);s[s.length]={t:"t",v:u},++l}var g,v=0,b=0;for(l=s.length-1,h="t";l>=0;--l)switch(s[l].t){case"h":case"H":s[l].t=d,h="h",v<1&&(v=1);break;case"s":(g=s[l].v.match(/\.0+$/))&&(b=Math.max(b,g[0].length-1)),v<3&&(v=3);case"d":case"y":case"M":case"e":h=s[l].t;break;case"m":"s"===h&&(s[l].t="M",v<2&&(v=2));break;case"X":break;case"Z":v<1&&s[l].v.match(/[Hh]/)&&(v=1),v<2&&s[l].v.match(/[Mm]/)&&(v=2),v<3&&s[l].v.match(/[Ss]/)&&(v=3)}switch(v){case 0:break;case 1:a.u>=.5&&(a.u=0,++a.S),a.S>=60&&(a.S=0,++a.M),a.M>=60&&(a.M=0,++a.H);break;case 2:a.u>=.5&&(a.u=0,++a.S),a.S>=60&&(a.S=0,++a.M)}var y,x="";for(l=0;l<s.length;++l)switch(s[l].t){case"t":case"T":case" ":case"D":break;case"X":s[l].v="",s[l].t=";";break;case"d":case"m":case"y":case"h":case"H":case"M":case"s":case"e":case"b":case"Z":s[l].v=v5(s[l].t.charCodeAt(0),s[l].v,a,b),s[l].t="t";break;case"n":case"?":for(y=l+1;null!=s[y]&&("?"===(u=s[y].t)||"D"===u||(" "===u||"t"===u)&&null!=s[y+1]&&("?"===s[y+1].t||"t"===s[y+1].t&&"/"===s[y+1].v)||"("===s[l].t&&(" "===u||"n"===u||")"===u)||"t"===u&&("/"===s[y].v||" "===s[y].v&&null!=s[y+1]&&"?"==s[y+1].t));)s[l].v+=s[y].v,s[y]={v:"",t:";"},++y;x+=s[l].v,l=y-1;break;case"G":s[l].t="t",s[l].v=g5(t,n)}var w,k,S="";if(x.length>0){40==x.charCodeAt(0)?(w=t<0&&45===x.charCodeAt(0)?-t:t,k=R5("n",x,w)):(k=R5("n",x,w=t<0&&r>1?-t:t),w<0&&s[0]&&"t"==s[0].t&&(k=k.substr(1),s[0].v="-"+s[0].v)),y=k.length-1;var N=s.length;for(l=0;l<s.length;++l)if(null!=s[l]&&"t"!=s[l].t&&s[l].v.indexOf(".")>-1){N=l;break}var C=s.length;if(N===s.length&&-1===k.indexOf("E")){for(l=s.length-1;l>=0;--l)null!=s[l]&&-1!=="n?".indexOf(s[l].t)&&(y>=s[l].v.length-1?(y-=s[l].v.length,s[l].v=k.substr(y+1,s[l].v.length)):y<0?s[l].v="":(s[l].v=k.substr(0,y+1),y=-1),s[l].t="t",C=l);y>=0&&C<s.length&&(s[C].v=k.substr(0,y+1)+s[C].v)}else if(N!==s.length&&-1===k.indexOf("E")){for(y=k.indexOf(".")-1,l=N;l>=0;--l)if(null!=s[l]&&-1!=="n?".indexOf(s[l].t)){for(i=s[l].v.indexOf(".")>-1&&l===N?s[l].v.indexOf(".")-1:s[l].v.length-1,S=s[l].v.substr(i+1);i>=0;--i)y>=0&&("0"===s[l].v.charAt(i)||"#"===s[l].v.charAt(i))&&(S=k.charAt(y--)+S);s[l].v=S,s[l].t="t",C=l}for(y>=0&&C<s.length&&(s[C].v=k.substr(0,y+1)+s[C].v),y=k.indexOf(".")+1,l=N;l<s.length;++l)if(null!=s[l]&&(-1!=="n?(".indexOf(s[l].t)||l===N)){for(i=s[l].v.indexOf(".")>-1&&l===N?s[l].v.indexOf(".")+1:0,S=s[l].v.substr(0,i);i<s[l].v.length;++i)y<k.length&&(S+=k.charAt(y++));s[l].v=S,s[l].t="t",C=l}}}for(l=0;l<s.length;++l)null!=s[l]&&"n?".indexOf(s[l].t)>-1&&(w=r>1&&t<0&&l>0&&"-"===s[l-1].v?-t:t,s[l].v=R5(s[l].t,s[l].v,w),s[l].t="t");var E="";for(l=0;l!==s.length;++l)null!=s[l]&&(E+=s[l].v);return E}(a[1],t,n,a[0])}function j5(e,t){if("number"!=typeof t){t=+t||-1;for(var n=0;n<392;++n)if(void 0!=i5[n]){if(i5[n]==e){t=n;break}}else t<0&&(t=n);t<0&&(t=391)}return i5[t]=e,t}function B5(e){for(var t=0;392!=t;++t)void 0!==e[t]&&j5(e[t],t)}function z5(){i5=function(e){return e||(e={}),e[0]="General",e[1]="0",e[2]="0.00",e[3]="#,##0",e[4]="#,##0.00",e[9]="0%",e[10]="0.00%",e[11]="0.00E+00",e[12]="# ?/?",e[13]="# ??/??",e[14]="m/d/yy",e[15]="d-mmm-yy",e[16]="d-mmm",e[17]="mmm-yy",e[18]="h:mm AM/PM",e[19]="h:mm:ss AM/PM",e[20]="h:mm",e[21]="h:mm:ss",e[22]="m/d/yy h:mm",e[37]="#,##0 ;(#,##0)",e[38]="#,##0 ;[Red](#,##0)",e[39]="#,##0.00;(#,##0.00)",e[40]="#,##0.00;[Red](#,##0.00)",e[45]="mm:ss",e[46]="[h]:mm:ss",e[47]="mmss.0",e[48]="##0.0E+0",e[49]="@",e[56]='"\u4e0a\u5348/\u4e0b\u5348 "hh"\u6642"mm"\u5206"ss"\u79d2 "',e}()}var U5=/[dD]+|[mM]+|[yYeE]+|[Hh]+|[Ss]+/g;var W5=function(){var e={};e.version="1.2.0";var t=function(){for(var e=0,t=new Array(256),n=0;256!=n;++n)e=1&(e=1&(e=1&(e=1&(e=1&(e=1&(e=1&(e=1&(e=n)?-306674912^e>>>1:e>>>1)?-306674912^e>>>1:e>>>1)?-306674912^e>>>1:e>>>1)?-306674912^e>>>1:e>>>1)?-306674912^e>>>1:e>>>1)?-306674912^e>>>1:e>>>1)?-306674912^e>>>1:e>>>1)?-306674912^e>>>1:e>>>1,t[n]=e;return"undefined"!==typeof Int32Array?new Int32Array(t):t}();var n=function(e){var t=0,n=0,r=0,a="undefined"!==typeof Int32Array?new Int32Array(4096):new Array(4096);for(r=0;256!=r;++r)a[r]=e[r];for(r=0;256!=r;++r)for(n=e[r],t=256+r;t<4096;t+=256)n=a[t]=n>>>8^e[255&n];var i=[];for(r=1;16!=r;++r)i[r-1]="undefined"!==typeof Int32Array?a.subarray(256*r,256*r+256):a.slice(256*r,256*r+256);return i}(t),r=n[0],a=n[1],i=n[2],o=n[3],s=n[4],c=n[5],l=n[6],u=n[7],h=n[8],d=n[9],f=n[10],p=n[11],m=n[12],g=n[13],v=n[14];return e.table=t,e.bstr=function(e,n){for(var r=-1^n,a=0,i=e.length;a<i;)r=r>>>8^t[255&(r^e.charCodeAt(a++))];return~r},e.buf=function(e,n){for(var b=-1^n,y=e.length-15,x=0;x<y;)b=v[e[x++]^255&b]^g[e[x++]^b>>8&255]^m[e[x++]^b>>16&255]^p[e[x++]^b>>>24]^f[e[x++]]^d[e[x++]]^h[e[x++]]^u[e[x++]]^l[e[x++]]^c[e[x++]]^s[e[x++]]^o[e[x++]]^i[e[x++]]^a[e[x++]]^r[e[x++]]^t[e[x++]];for(y+=15;x<y;)b=b>>>8^t[255&(b^e[x++])];return~b},e.str=function(e,n){for(var r=-1^n,a=0,i=e.length,o=0,s=0;a<i;)(o=e.charCodeAt(a++))<128?r=r>>>8^t[255&(r^o)]:o<2048?r=(r=r>>>8^t[255&(r^(192|o>>6&31))])>>>8^t[255&(r^(128|63&o))]:o>=55296&&o<57344?(o=64+(1023&o),s=1023&e.charCodeAt(a++),r=(r=(r=(r=r>>>8^t[255&(r^(240|o>>8&7))])>>>8^t[255&(r^(128|o>>2&63))])>>>8^t[255&(r^(128|s>>6&15|(3&o)<<4))])>>>8^t[255&(r^(128|63&s))]):r=(r=(r=r>>>8^t[255&(r^(224|o>>12&15))])>>>8^t[255&(r^(128|o>>6&63))])>>>8^t[255&(r^(128|63&o))];return~r},e}(),V5=function(){var e,t={};function n(e){if("/"==e.charAt(e.length-1))return-1===e.slice(0,-1).indexOf("/")?e:n(e.slice(0,-1));var t=e.lastIndexOf("/");return-1===t?e:e.slice(0,t+1)}function r(e){if("/"==e.charAt(e.length-1))return r(e.slice(0,-1));var t=e.lastIndexOf("/");return-1===t?e:e.slice(t+1)}function a(e,t){"string"===typeof t&&(t=new Date(t));var n=t.getHours();n=(n=n<<6|t.getMinutes())<<5|t.getSeconds()>>>1,e.write_shift(2,n);var r=t.getFullYear()-1980;r=(r=r<<4|t.getMonth()+1)<<5|t.getDate(),e.write_shift(2,r)}function i(e){j8(e,0);for(var t={},n=0;e.l<=e.length-4;){var r=e.read_shift(2),a=e.read_shift(2),i=e.l+a,o={};if(21589===r)1&(n=e.read_shift(1))&&(o.mtime=e.read_shift(4)),a>5&&(2&n&&(o.atime=e.read_shift(4)),4&n&&(o.ctime=e.read_shift(4))),o.mtime&&(o.mt=new Date(1e3*o.mtime));e.l=i,t[r]=o}return t}function o(){return e||(e={})}function s(e,t){if(80==e[0]&&75==e[1])return re(e,t);if(109==(32|e[0])&&105==(32|e[1]))return function(e,t){if("mime-version:"!=k(e.slice(0,13)).toLowerCase())throw new Error("Unsupported MAD header");var n=t&&t.root||"",r=(z3&&Buffer.isBuffer(e)?e.toString("binary"):k(e)).split("\r\n"),a=0,i="";for(a=0;a<r.length;++a)if(i=r[a],/^Content-Location:/i.test(i)&&(i=i.slice(i.indexOf("file")),n||(n=i.slice(0,i.lastIndexOf("/")+1)),i.slice(0,n.length)!=n))for(;n.length>0&&(n=(n=n.slice(0,n.length-1)).slice(0,n.lastIndexOf("/")+1),i.slice(0,n.length)!=n););var o=(r[1]||"").match(/boundary="(.*?)"/);if(!o)throw new Error("MAD cannot find boundary");var s="--"+(o[1]||""),c=[],l=[],u={FileIndex:c,FullPaths:l};d(u);var h,f=0;for(a=0;a<r.length;++a){var p=r[a];p!==s&&p!==s+"--"||(f++&&le(u,r.slice(h,a),n),h=a)}return u}(e,t);if(e.length<512)throw new Error("CFB file size "+e.length+" < 512");var n,r,a,i,o,s,f=512,p=[],m=e.slice(0,512);j8(m,0);var g=function(e){if(80==e[e.l]&&75==e[e.l+1])return[0,0];e.chk(b,"Header Signature: "),e.l+=16;var t=e.read_shift(2,"u");return[e.read_shift(2,"u"),t]}(m);switch(n=g[0]){case 3:f=512;break;case 4:f=4096;break;case 0:if(0==g[1])return re(e,t);default:throw new Error("Major Version: Expected 3 or 4 saw "+n)}512!==f&&j8(m=e.slice(0,f),28);var y=e.slice(0,f);!function(e,t){var n=9;switch(e.l+=2,n=e.read_shift(2)){case 9:if(3!=t)throw new Error("Sector Shift: Expected 9 saw "+n);break;case 12:if(4!=t)throw new Error("Sector Shift: Expected 12 saw "+n);break;default:throw new Error("Sector Shift: Expected 9 or 12 saw "+n)}e.chk("0600","Mini Sector Shift: "),e.chk("000000000000","Reserved: ")}(m,n);var x=m.read_shift(4,"i");if(3===n&&0!==x)throw new Error("# Directory Sectors: Expected 0 saw "+x);m.l+=4,i=m.read_shift(4,"i"),m.l+=4,m.chk("00100000","Mini Stream Cutoff Size: "),o=m.read_shift(4,"i"),r=m.read_shift(4,"i"),s=m.read_shift(4,"i"),a=m.read_shift(4,"i");for(var w=-1,S=0;S<109&&!((w=m.read_shift(4,"i"))<0);++S)p[S]=w;var N=function(e,t){for(var n=Math.ceil(e.length/t)-1,r=[],a=1;a<n;++a)r[a-1]=e.slice(a*t,(a+1)*t);return r[n-1]=e.slice(n*t),r}(e,f);l(s,a,N,f,p);var C=function(e,t,n,r){var a=e.length,i=[],o=[],s=[],c=[],l=r-1,u=0,h=0,d=0,f=0;for(u=0;u<a;++u)if(s=[],(d=u+t)>=a&&(d-=a),!o[d]){c=[];var p=[];for(h=d;h>=0;){p[h]=!0,o[h]=!0,s[s.length]=h,c.push(e[h]);var m=n[Math.floor(4*h/r)];if(r<4+(f=4*h&l))throw new Error("FAT boundary crossed: "+h+" 4 "+r);if(!e[m])break;if(p[h=A8(e[m],f)])break}i[d]={nodes:s,data:i8([c])}}return i}(N,i,p,f);C[i].name="!Directory",r>0&&o!==v&&(C[o].name="!MiniFAT"),C[p[0]].name="!FAT",C.fat_addrs=p,C.ssz=f;var E=[],I=[],T=[];!function(e,t,n,r,a,i,o,s){for(var l,d=0,f=r.length?2:0,p=t[e].data,m=0,g=0;m<p.length;m+=128){var b=p.slice(m,m+128);j8(b,64),g=b.read_shift(2),l=s8(b,0,g-f),r.push(l);var y={name:l,type:b.read_shift(1),color:b.read_shift(1),L:b.read_shift(4,"i"),R:b.read_shift(4,"i"),C:b.read_shift(4,"i"),clsid:b.read_shift(16),state:b.read_shift(4,"i"),start:0,size:0};0!==b.read_shift(2)+b.read_shift(2)+b.read_shift(2)+b.read_shift(2)&&(y.ct=h(b,b.l-8)),0!==b.read_shift(2)+b.read_shift(2)+b.read_shift(2)+b.read_shift(2)&&(y.mt=h(b,b.l-8)),y.start=b.read_shift(4,"i"),y.size=b.read_shift(4,"i"),y.size<0&&y.start<0&&(y.size=y.type=0,y.start=v,y.name=""),5===y.type?(d=y.start,a>0&&d!==v&&(t[d].name="!StreamData")):y.size>=4096?(y.storage="fat",void 0===t[y.start]&&(t[y.start]=u(n,y.start,t.fat_addrs,t.ssz)),t[y.start].name=y.name,y.content=t[y.start].data.slice(0,y.size)):(y.storage="minifat",y.size<0?y.size=0:d!==v&&y.start!==v&&t[d]&&(y.content=c(y,t[d].data,(t[s]||{}).data))),y.content&&j8(y.content,0),i[l]=y,o.push(y)}}(i,C,N,E,r,{},I,o),function(e,t,n){for(var r=0,a=0,i=0,o=0,s=0,c=n.length,l=[],u=[];r<c;++r)l[r]=u[r]=r,t[r]=n[r];for(;s<u.length;++s)a=e[r=u[s]].L,i=e[r].R,o=e[r].C,l[r]===r&&(-1!==a&&l[a]!==a&&(l[r]=l[a]),-1!==i&&l[i]!==i&&(l[r]=l[i])),-1!==o&&(l[o]=r),-1!==a&&r!=l[r]&&(l[a]=l[r],u.lastIndexOf(a)<s&&u.push(a)),-1!==i&&r!=l[r]&&(l[i]=l[r],u.lastIndexOf(i)<s&&u.push(i));for(r=1;r<c;++r)l[r]===r&&(-1!==i&&l[i]!==i?l[r]=l[i]:-1!==a&&l[a]!==a&&(l[r]=l[a]));for(r=1;r<c;++r)if(0!==e[r].type){if((s=r)!=l[s])do{s=l[s],t[r]=t[s]+"/"+t[r]}while(0!==s&&-1!==l[s]&&s!=l[s]);l[r]=-1}for(t[0]+="/",r=1;r<c;++r)2!==e[r].type&&(t[r]+="/")}(I,T,E),E.shift();var _={FileIndex:I,FullPaths:T};return t&&t.raw&&(_.raw={header:y,sectors:N}),_}function c(e,t,n){for(var r=e.start,a=e.size,i=[],o=r;n&&a>0&&o>=0;)i.push(t.slice(o*g,o*g+g)),a-=g,o=A8(n,4*o);return 0===i.length?z8(0):K3(i).slice(0,e.size)}function l(e,t,n,r,a){var i=v;if(e===v){if(0!==t)throw new Error("DIFAT chain shorter than expected")}else if(-1!==e){var o=n[e],s=(r>>>2)-1;if(!o)return;for(var c=0;c<s&&(i=A8(o,4*c))!==v;++c)a.push(i);l(A8(o,r-4),t-1,n,r,a)}}function u(e,t,n,r,a){var i=[],o=[];a||(a=[]);var s=r-1,c=0,l=0;for(c=t;c>=0;){a[c]=!0,i[i.length]=c,o.push(e[c]);var u=n[Math.floor(4*c/r)];if(r<4+(l=4*c&s))throw new Error("FAT boundary crossed: "+c+" 4 "+r);if(!e[u])break;c=A8(e[u],l)}return{nodes:i,data:i8([o])}}function h(e,t){return new Date(1e3*(_8(e,t+4)/1e7*Math.pow(2,32)+_8(e,t)/1e7-11644473600))}function d(e,t){var n=t||{},r=n.root||"Root Entry";if(e.FullPaths||(e.FullPaths=[]),e.FileIndex||(e.FileIndex=[]),e.FullPaths.length!==e.FileIndex.length)throw new Error("inconsistent CFB structure");0===e.FullPaths.length&&(e.FullPaths[0]=r+"/",e.FileIndex[0]={name:r,type:5}),n.CLSID&&(e.FileIndex[0].clsid=n.CLSID),function(e){var t="\x01Sh33tJ5";if(V5.find(e,"/"+t))return;var n=z8(4);n[0]=55,n[1]=n[3]=50,n[2]=54,e.FileIndex.push({name:t,type:2,content:n,size:4,L:69,R:69,C:69}),e.FullPaths.push(e.FullPaths[0]+t),f(e)}(e)}function f(e,t){d(e);for(var a=!1,i=!1,o=e.FullPaths.length-1;o>=0;--o){var s=e.FileIndex[o];switch(s.type){case 0:i?a=!0:(e.FileIndex.pop(),e.FullPaths.pop());break;case 1:case 2:case 5:i=!0,isNaN(s.R*s.L*s.C)&&(a=!0),s.R>-1&&s.L>-1&&s.R==s.L&&(a=!0);break;default:a=!0}}if(a||t){var c=new Date(1987,1,19),l=0,u=Object.create?Object.create(null):{},h=[];for(o=0;o<e.FullPaths.length;++o)u[e.FullPaths[o]]=!0,0!==e.FileIndex[o].type&&h.push([e.FullPaths[o],e.FileIndex[o]]);for(o=0;o<h.length;++o){var f=n(h[o][0]);(i=u[f])||(h.push([f,{name:r(f).replace("/",""),type:1,clsid:x,ct:c,mt:c,content:null}]),u[f]=!0)}for(h.sort(function(e,t){return function(e,t){for(var n=e.split("/"),r=t.split("/"),a=0,i=0,o=Math.min(n.length,r.length);a<o;++a){if(i=n[a].length-r[a].length)return i;if(n[a]!=r[a])return n[a]<r[a]?-1:1}return n.length-r.length}(e[0],t[0])}),e.FullPaths=[],e.FileIndex=[],o=0;o<h.length;++o)e.FullPaths[o]=h[o][0],e.FileIndex[o]=h[o][1];for(o=0;o<h.length;++o){var p=e.FileIndex[o],m=e.FullPaths[o];if(p.name=r(m).replace("/",""),p.L=p.R=p.C=-(p.color=1),p.size=p.content?p.content.length:0,p.start=0,p.clsid=p.clsid||x,0===o)p.C=h.length>1?1:-1,p.size=0,p.type=5;else if("/"==m.slice(-1)){for(l=o+1;l<h.length&&n(e.FullPaths[l])!=m;++l);for(p.C=l>=h.length?-1:l,l=o+1;l<h.length&&n(e.FullPaths[l])!=n(m);++l);p.R=l>=h.length?-1:l,p.type=1}else n(e.FullPaths[o+1]||"")==n(m)&&(p.R=o+1),p.type=2}}}function p(e,t){var n=t||{};if("mad"==n.fileType)return function(e,t){for(var n=t||{},r=n.boundary||"SheetJS",a=["MIME-Version: 1.0",'Content-Type: multipart/related; boundary="'+(r="------="+r).slice(2)+'"',"","",""],i=e.FullPaths[0],o=i,s=e.FileIndex[0],c=1;c<e.FullPaths.length;++c)if(o=e.FullPaths[c].slice(i.length),(s=e.FileIndex[c]).size&&s.content&&"\x01Sh33tJ5"!=o){o=o.replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7E-\xFF]/g,function(e){return"_x"+e.charCodeAt(0).toString(16)+"_"}).replace(/[\u0080-\uFFFF]/g,function(e){return"_u"+e.charCodeAt(0).toString(16)+"_"});for(var l=s.content,u=z3&&Buffer.isBuffer(l)?l.toString("binary"):k(l),h=0,d=Math.min(1024,u.length),f=0,p=0;p<=d;++p)(f=u.charCodeAt(p))>=32&&f<128&&++h;var m=h>=4*d/5;a.push(r),a.push("Content-Location: "+(n.root||"file:///C:/SheetJS/")+o),a.push("Content-Transfer-Encoding: "+(m?"quoted-printable":"base64")),a.push("Content-Type: "+oe(s,o)),a.push(""),a.push(m?ce(u):se(u))}return a.push(r+"--\r\n"),a.join("\r\n")}(e,n);if(f(e),"zip"===n.fileType)return function(e,t){var n=t||{},r=[],i=[],o=z8(1),s=n.compression?8:0,c=0;0;var l=0,u=0,h=0,d=0,f=e.FullPaths[0],p=f,m=e.FileIndex[0],g=[],v=0;for(l=1;l<e.FullPaths.length;++l)if(p=e.FullPaths[l].slice(f.length),(m=e.FileIndex[l]).size&&m.content&&"\x01Sh33tJ5"!=p){var b=h,y=z8(p.length);for(u=0;u<p.length;++u)y.write_shift(1,127&p.charCodeAt(u));y=y.slice(0,y.l),g[d]=W5.buf(m.content,0);var x=m.content;8==s&&(x=S(x)),(o=z8(30)).write_shift(4,67324752),o.write_shift(2,20),o.write_shift(2,c),o.write_shift(2,s),m.mt?a(o,m.mt):o.write_shift(4,0),o.write_shift(-4,8&c?0:g[d]),o.write_shift(4,8&c?0:x.length),o.write_shift(4,8&c?0:m.content.length),o.write_shift(2,y.length),o.write_shift(2,0),h+=o.length,r.push(o),h+=y.length,r.push(y),h+=x.length,r.push(x),8&c&&((o=z8(12)).write_shift(-4,g[d]),o.write_shift(4,x.length),o.write_shift(4,m.content.length),h+=o.l,r.push(o)),(o=z8(46)).write_shift(4,33639248),o.write_shift(2,0),o.write_shift(2,20),o.write_shift(2,c),o.write_shift(2,s),o.write_shift(4,0),o.write_shift(-4,g[d]),o.write_shift(4,x.length),o.write_shift(4,m.content.length),o.write_shift(2,y.length),o.write_shift(2,0),o.write_shift(2,0),o.write_shift(2,0),o.write_shift(2,0),o.write_shift(4,0),o.write_shift(4,b),v+=o.l,i.push(o),v+=y.length,i.push(y),++d}return o=z8(22),o.write_shift(4,101010256),o.write_shift(2,0),o.write_shift(2,0),o.write_shift(2,d),o.write_shift(2,d),o.write_shift(4,v),o.write_shift(4,h),o.write_shift(2,0),K3([K3(r),K3(i),o])}(e,n);var r=function(e){for(var t=0,n=0,r=0;r<e.FileIndex.length;++r){var a=e.FileIndex[r];if(a.content){var i=a.content.length;i>0&&(i<4096?t+=i+63>>6:n+=i+511>>9)}}for(var o=e.FullPaths.length+3>>2,s=t+127>>7,c=(t+7>>3)+n+o+s,l=c+127>>7,u=l<=109?0:Math.ceil((l-109)/127);c+l+u+127>>7>l;)u=++l<=109?0:Math.ceil((l-109)/127);var h=[1,u,l,s,o,n,t,0];return e.FileIndex[0].size=t<<6,h[7]=(e.FileIndex[0].start=h[0]+h[1]+h[2]+h[3]+h[4]+h[5])+(h[6]+7>>3),h}(e),i=z8(r[7]<<9),o=0,s=0;for(o=0;o<8;++o)i.write_shift(1,y[o]);for(o=0;o<8;++o)i.write_shift(2,0);for(i.write_shift(2,62),i.write_shift(2,3),i.write_shift(2,65534),i.write_shift(2,9),i.write_shift(2,6),o=0;o<3;++o)i.write_shift(2,0);for(i.write_shift(4,0),i.write_shift(4,r[2]),i.write_shift(4,r[0]+r[1]+r[2]+r[3]-1),i.write_shift(4,0),i.write_shift(4,4096),i.write_shift(4,r[3]?r[0]+r[1]+r[2]-1:v),i.write_shift(4,r[3]),i.write_shift(-4,r[1]?r[0]-1:v),i.write_shift(4,r[1]),o=0;o<109;++o)i.write_shift(-4,o<r[2]?r[1]+o:-1);if(r[1])for(s=0;s<r[1];++s){for(;o<236+127*s;++o)i.write_shift(-4,o<r[2]?r[1]+o:-1);i.write_shift(-4,s===r[1]-1?v:s+1)}var c=function(e){for(s+=e;o<s-1;++o)i.write_shift(-4,o+1);e&&(++o,i.write_shift(-4,v))};for(s=o=0,s+=r[1];o<s;++o)i.write_shift(-4,w.DIFSECT);for(s+=r[2];o<s;++o)i.write_shift(-4,w.FATSECT);c(r[3]),c(r[4]);for(var l=0,u=0,h=e.FileIndex[0];l<e.FileIndex.length;++l)(h=e.FileIndex[l]).content&&((u=h.content.length)<4096||(h.start=s,c(u+511>>9)));for(c(r[6]+7>>3);511&i.l;)i.write_shift(-4,w.ENDOFCHAIN);for(s=o=0,l=0;l<e.FileIndex.length;++l)(h=e.FileIndex[l]).content&&(!(u=h.content.length)||u>=4096||(h.start=s,c(u+63>>6)));for(;511&i.l;)i.write_shift(-4,w.ENDOFCHAIN);for(o=0;o<r[4]<<2;++o){var d=e.FullPaths[o];if(d&&0!==d.length){h=e.FileIndex[o],0===o&&(h.start=h.size?h.start-1:v);var p=0===o&&n.root||h.name;if(u=2*(p.length+1),i.write_shift(64,p,"utf16le"),i.write_shift(2,u),i.write_shift(1,h.type),i.write_shift(1,h.color),i.write_shift(-4,h.L),i.write_shift(-4,h.R),i.write_shift(-4,h.C),h.clsid)i.write_shift(16,h.clsid,"hex");else for(l=0;l<4;++l)i.write_shift(4,0);i.write_shift(4,h.state||0),i.write_shift(4,0),i.write_shift(4,0),i.write_shift(4,0),i.write_shift(4,0),i.write_shift(4,h.start),i.write_shift(4,h.size),i.write_shift(4,0)}else{for(l=0;l<17;++l)i.write_shift(4,0);for(l=0;l<3;++l)i.write_shift(4,-1);for(l=0;l<12;++l)i.write_shift(4,0)}}for(o=1;o<e.FileIndex.length;++o)if((h=e.FileIndex[o]).size>=4096)if(i.l=h.start+1<<9,z3&&Buffer.isBuffer(h.content))h.content.copy(i,i.l,0,h.size),i.l+=h.size+511&-512;else{for(l=0;l<h.size;++l)i.write_shift(1,h.content[l]);for(;511&l;++l)i.write_shift(1,0)}for(o=1;o<e.FileIndex.length;++o)if((h=e.FileIndex[o]).size>0&&h.size<4096)if(z3&&Buffer.isBuffer(h.content))h.content.copy(i,i.l,0,h.size),i.l+=h.size+63&-64;else{for(l=0;l<h.size;++l)i.write_shift(1,h.content[l]);for(;63&l;++l)i.write_shift(1,0)}if(z3)i.l=i.length;else for(;i.l<i.length;)i.write_shift(1,0);return i}t.version="1.2.1";var m,g=64,v=-2,b="d0cf11e0a1b11ae1",y=[208,207,17,224,161,177,26,225],x="00000000000000000000000000000000",w={MAXREGSECT:-6,DIFSECT:-4,FATSECT:-3,ENDOFCHAIN:v,FREESECT:-1,HEADER_SIGNATURE:b,HEADER_MINOR_VERSION:"3e00",MAXREGSID:-6,NOSTREAM:-1,HEADER_CLSID:x,EntryTypes:["unknown","storage","stream","lockbytes","property","root"]};function k(e){for(var t=new Array(e.length),n=0;n<e.length;++n)t[n]=String.fromCharCode(e[n]);return t.join("")}function S(e){return m?m.deflateRawSync(e):X(e)}var N=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],C=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258],E=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577];function I(e){var t=139536&(e<<1|e<<11)|558144&(e<<5|e<<15);return 255&(t>>16|t>>8|t)}for(var T="undefined"!==typeof Uint8Array,_=T?new Uint8Array(256):[],A=0;A<256;++A)_[A]=I(A);function R(e,t){var n=_[255&e];return t<=8?n>>>8-t:(n=n<<8|_[e>>8&255],t<=16?n>>>16-t:(n=n<<8|_[e>>16&255])>>>24-t)}function F(e,t){var n=7&t,r=t>>>3;return(e[r]|(n<=6?0:e[r+1]<<8))>>>n&3}function D(e,t){var n=7&t,r=t>>>3;return(e[r]|(n<=5?0:e[r+1]<<8))>>>n&7}function O(e,t){var n=7&t,r=t>>>3;return(e[r]|(n<=3?0:e[r+1]<<8))>>>n&31}function L(e,t){var n=7&t,r=t>>>3;return(e[r]|(n<=1?0:e[r+1]<<8))>>>n&127}function P(e,t,n){var r=7&t,a=t>>>3,i=(1<<n)-1,o=e[a]>>>r;return n<8-r?o&i:(o|=e[a+1]<<8-r,n<16-r?o&i:(o|=e[a+2]<<16-r,n<24-r?o&i:(o|=e[a+3]<<24-r)&i))}function M(e,t,n){var r=7&t,a=t>>>3;return r<=5?e[a]|=(7&n)<<r:(e[a]|=n<<r&255,e[a+1]=(7&n)>>8-r),t+3}function j(e,t,n){return n=(1&n)<<(7&t),e[t>>>3]|=n,t+1}function B(e,t,n){var r=t>>>3;return n<<=7&t,e[r]|=255&n,n>>>=8,e[r+1]=n,t+8}function z(e,t,n){var r=t>>>3;return n<<=7&t,e[r]|=255&n,n>>>=8,e[r+1]=255&n,e[r+2]=n>>>8,t+16}function U(e,t){var n=e.length,r=2*n>t?2*n:t+5,a=0;if(n>=t)return e;if(z3){var i=V3(r);if(e.copy)e.copy(i);else for(;a<e.length;++a)i[a]=e[a];return i}if(T){var o=new Uint8Array(r);if(o.set)o.set(e);else for(;a<n;++a)o[a]=e[a];return o}return e.length=r,e}function W(e){for(var t=new Array(e),n=0;n<e;++n)t[n]=0;return t}function V(e,t,n){var r=1,a=0,i=0,o=0,s=0,c=e.length,l=T?new Uint16Array(32):W(32);for(i=0;i<32;++i)l[i]=0;for(i=c;i<n;++i)e[i]=0;c=e.length;var u=T?new Uint16Array(c):W(c);for(i=0;i<c;++i)l[a=e[i]]++,r<a&&(r=a),u[i]=0;for(l[0]=0,i=1;i<=r;++i)l[i+16]=s=s+l[i-1]<<1;for(i=0;i<c;++i)0!=(s=e[i])&&(u[i]=l[s+16]++);var h=0;for(i=0;i<c;++i)if(0!=(h=e[i]))for(s=R(u[i],r)>>r-h,o=(1<<r+4-h)-1;o>=0;--o)t[s|o<<h]=15&h|i<<4;return r}var H=T?new Uint16Array(512):W(512),G=T?new Uint16Array(32):W(32);if(!T){for(var q=0;q<512;++q)H[q]=0;for(q=0;q<32;++q)G[q]=0}!function(){for(var e=[],t=0;t<32;t++)e.push(5);V(e,G,32);var n=[];for(t=0;t<=143;t++)n.push(8);for(;t<=255;t++)n.push(9);for(;t<=279;t++)n.push(7);for(;t<=287;t++)n.push(8);V(n,H,288)}();var K=function(){for(var e=T?new Uint8Array(32768):[],t=0,n=0;t<E.length-1;++t)for(;n<E[t+1];++n)e[n]=t;for(;n<32768;++n)e[n]=29;var r=T?new Uint8Array(259):[];for(t=0,n=0;t<C.length-1;++t)for(;n<C[t+1];++n)r[n]=t;return function(t,n){return t.length<8?function(e,t){for(var n=0;n<e.length;){var r=Math.min(65535,e.length-n),a=n+r==e.length;for(t.write_shift(1,+a),t.write_shift(2,r),t.write_shift(2,65535&~r);r-- >0;)t[t.l++]=e[n++]}return t.l}(t,n):function(t,n){for(var a=0,i=0,o=T?new Uint16Array(32768):[];i<t.length;){var s=Math.min(65535,t.length-i);if(s<10){for(7&(a=M(n,a,+!(i+s!=t.length)))&&(a+=8-(7&a)),n.l=a/8|0,n.write_shift(2,s),n.write_shift(2,65535&~s);s-- >0;)n[n.l++]=t[i++];a=8*n.l}else{a=M(n,a,+!(i+s!=t.length)+2);for(var c=0;s-- >0;){var l=t[i],u=-1,h=0;if((u=o[c=32767&(c<<5^l)])&&((u|=-32768&i)>i&&(u-=32768),u<i))for(;t[u+h]==t[i+h]&&h<250;)++h;if(h>2){(l=r[h])<=22?a=B(n,a,_[l+1]>>1)-1:(B(n,a,3),B(n,a+=5,_[l-23]>>5),a+=3);var d=l<8?0:l-4>>2;d>0&&(z(n,a,h-C[l]),a+=d),l=e[i-u],a=B(n,a,_[l]>>3),a-=3;var f=l<4?0:l-2>>1;f>0&&(z(n,a,i-u-E[l]),a+=f);for(var p=0;p<h;++p)o[c]=32767&i,c=32767&(c<<5^t[i]),++i;s-=h-1}else l<=143?l+=48:a=j(n,a,1),a=B(n,a,_[l]),o[c]=32767&i,++i}a=B(n,a,0)-1}}return n.l=(a+7)/8|0,n.l}(t,n)}}();function X(e){var t=z8(50+Math.floor(1.1*e.length)),n=K(e,t);return t.slice(0,n)}var Y=T?new Uint16Array(32768):W(32768),$=T?new Uint16Array(32768):W(32768),J=T?new Uint16Array(128):W(128),Q=1,Z=1;function ee(e,t){var n=O(e,t)+257,r=O(e,t+=5)+1,a=function(e,t){var n=7&t,r=t>>>3;return(e[r]|(n<=4?0:e[r+1]<<8))>>>n&15}(e,t+=5)+4;t+=4;for(var i=0,o=T?new Uint8Array(19):W(19),s=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],c=1,l=T?new Uint8Array(8):W(8),u=T?new Uint8Array(8):W(8),h=o.length,d=0;d<a;++d)o[N[d]]=i=D(e,t),c<i&&(c=i),l[i]++,t+=3;var f=0;for(l[0]=0,d=1;d<=c;++d)u[d]=f=f+l[d-1]<<1;for(d=0;d<h;++d)0!=(f=o[d])&&(s[d]=u[f]++);var p=0;for(d=0;d<h;++d)if(0!=(p=o[d])){f=_[s[d]]>>8-p;for(var m=(1<<7-p)-1;m>=0;--m)J[f|m<<p]=7&p|d<<3}var g=[];for(c=1;g.length<n+r;)switch(t+=7&(f=J[L(e,t)]),f>>>=3){case 16:for(i=3+F(e,t),t+=2,f=g[g.length-1];i-- >0;)g.push(f);break;case 17:for(i=3+D(e,t),t+=3;i-- >0;)g.push(0);break;case 18:for(i=11+L(e,t),t+=7;i-- >0;)g.push(0);break;default:g.push(f),c<f&&(c=f)}var v=g.slice(0,n),b=g.slice(n);for(d=n;d<286;++d)v[d]=0;for(d=r;d<30;++d)b[d]=0;return Q=V(v,Y,286),Z=V(b,$,30),t}function te(e,t){var n=function(e,t){if(3==e[0]&&!(3&e[1]))return[W3(t),2];for(var n=0,r=0,a=V3(t||1<<18),i=0,o=a.length>>>0,s=0,c=0;0==(1&r);)if(r=D(e,n),n+=3,r>>>1!=0)for(r>>1==1?(s=9,c=5):(n=ee(e,n),s=Q,c=Z);;){!t&&o<i+32767&&(o=(a=U(a,i+32767)).length);var l=P(e,n,s),u=r>>>1==1?H[l]:Y[l];if(n+=15&u,0===((u>>>=4)>>>8&255))a[i++]=u;else{if(256==u)break;var h=(u-=257)<8?0:u-4>>2;h>5&&(h=0);var d=i+C[u];h>0&&(d+=P(e,n,h),n+=h),l=P(e,n,c),n+=15&(u=r>>>1==1?G[l]:$[l]);var f=(u>>>=4)<4?0:u-2>>1,p=E[u];for(f>0&&(p+=P(e,n,f),n+=f),!t&&o<d&&(o=(a=U(a,d+100)).length);i<d;)a[i]=a[i-p],++i}}else{7&n&&(n+=8-(7&n));var m=e[n>>>3]|e[(n>>>3)+1]<<8;if(n+=32,m>0)for(!t&&o<i+m&&(o=(a=U(a,i+m)).length);m-- >0;)a[i++]=e[n>>>3],n+=8}return t?[a,n+7>>>3]:[a.slice(0,i),n+7>>>3]}(e.slice(e.l||0),t);return e.l+=n[1],n[0]}function ne(e,t){if(!e)throw new Error(t);"undefined"!==typeof console&&console.error(t)}function re(e,t){var n=e;j8(n,0);var r={FileIndex:[],FullPaths:[]};d(r,{root:t.root});for(var a=n.length-4;(80!=n[a]||75!=n[a+1]||5!=n[a+2]||6!=n[a+3])&&a>=0;)--a;n.l=a+4,n.l+=4;var o=n.read_shift(2);n.l+=6;var s=n.read_shift(4);for(n.l=s,a=0;a<o;++a){n.l+=20;var c=n.read_shift(4),l=n.read_shift(4),u=n.read_shift(2),h=n.read_shift(2),f=n.read_shift(2);n.l+=8;var p=n.read_shift(4),m=i(n.slice(n.l+u,n.l+u+h));n.l+=u+h+f;var g=n.l;n.l=p+4,ae(n,c,l,r,m),n.l=g}return r}function ae(e,t,n,r,a){e.l+=2;var o=e.read_shift(2),s=e.read_shift(2),c=function(e){var t=65535&e.read_shift(2),n=65535&e.read_shift(2),r=new Date,a=31&n,i=15&(n>>>=5);n>>>=4,r.setMilliseconds(0),r.setFullYear(n+1980),r.setMonth(i-1),r.setDate(a);var o=31&t,s=63&(t>>>=5);return t>>>=6,r.setHours(t),r.setMinutes(s),r.setSeconds(o<<1),r}(e);if(8257&o)throw new Error("Unsupported ZIP encryption");e.read_shift(4);for(var l=e.read_shift(4),u=e.read_shift(4),h=e.read_shift(2),d=e.read_shift(2),f="",p=0;p<h;++p)f+=String.fromCharCode(e[e.l++]);if(d){var g=i(e.slice(e.l,e.l+d));(g[21589]||{}).mt&&(c=g[21589].mt),((a||{})[21589]||{}).mt&&(c=a[21589].mt)}e.l+=d;var v=e.slice(e.l,e.l+l);switch(s){case 8:v=function(e,t){if(!m)return te(e,t);var n=new(0,m.InflateRaw),r=n._processChunk(e.slice(e.l),n._finishFlushFlag);return e.l+=n.bytesRead,r}(e,u);break;case 0:break;default:throw new Error("Unsupported ZIP Compression method "+s)}var b=!1;8&o&&(134695760==e.read_shift(4)&&(e.read_shift(4),b=!0),l=e.read_shift(4),u=e.read_shift(4)),l!=t&&ne(b,"Bad compressed size: "+t+" != "+l),u!=n&&ne(b,"Bad uncompressed size: "+n+" != "+u),ue(r,f,v,{unsafe:!0,mt:c})}var ie={htm:"text/html",xml:"text/xml",gif:"image/gif",jpg:"image/jpeg",png:"image/png",mso:"application/x-mso",thmx:"application/vnd.ms-officetheme",sh33tj5:"application/octet-stream"};function oe(e,t){if(e.ctype)return e.ctype;var n=e.name||"",r=n.match(/\.([^\.]+)$/);return r&&ie[r[1]]||t&&(r=(n=t).match(/[\.\\]([^\.\\])+$/))&&ie[r[1]]?ie[r[1]]:"application/octet-stream"}function se(e){for(var t=j3(e),n=[],r=0;r<t.length;r+=76)n.push(t.slice(r,r+76));return n.join("\r\n")+"\r\n"}function ce(e){var t=e.replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7E-\xFF=]/g,function(e){var t=e.charCodeAt(0).toString(16).toUpperCase();return"="+(1==t.length?"0"+t:t)});"\n"==(t=t.replace(/ $/gm,"=20").replace(/\t$/gm,"=09")).charAt(0)&&(t="=0D"+t.slice(1));for(var n=[],r=(t=t.replace(/\r(?!\n)/gm,"=0D").replace(/\n\n/gm,"\n=0A").replace(/([^\r\n])\n/gm,"$1=0A")).split("\r\n"),a=0;a<r.length;++a){var i=r[a];if(0!=i.length)for(var o=0;o<i.length;){var s=76,c=i.slice(o,o+s);"="==c.charAt(s-1)?s--:"="==c.charAt(s-2)?s-=2:"="==c.charAt(s-3)&&(s-=3),c=i.slice(o,o+s),(o+=s)<i.length&&(c+="="),n.push(c)}else n.push("")}return n.join("\r\n")}function le(e,t,n){for(var r,a="",i="",o="",s=0;s<10;++s){var c=t[s];if(!c||c.match(/^\s*$/))break;var l=c.match(/^(.*?):\s*([^\s].*)$/);if(l)switch(l[1].toLowerCase()){case"content-location":a=l[2].trim();break;case"content-type":o=l[2].trim();break;case"content-transfer-encoding":i=l[2].trim()}}switch(++s,i.toLowerCase()){case"base64":r=H3(B3(t.slice(s).join("")));break;case"quoted-printable":r=function(e){for(var t=[],n=0;n<e.length;++n){for(var r=e[n];n<=e.length&&"="==r.charAt(r.length-1);)r=r.slice(0,r.length-1)+e[++n];t.push(r)}for(var a=0;a<t.length;++a)t[a]=t[a].replace(/[=][0-9A-Fa-f]{2}/g,function(e){return String.fromCharCode(parseInt(e.slice(1),16))});return H3(t.join("\r\n"))}(t.slice(s));break;default:throw new Error("Unsupported Content-Transfer-Encoding "+i)}var u=ue(e,a.slice(n.length),r,{unsafe:!0});o&&(u.ctype=o)}function ue(e,t,n,a){var i=a&&a.unsafe;i||d(e);var o=!i&&V5.find(e,t);if(!o){var s=e.FullPaths[0];t.slice(0,s.length)==s?s=t:("/"!=s.slice(-1)&&(s+="/"),s=(s+t).replace("//","/")),o={name:r(t),type:2},e.FileIndex.push(o),e.FullPaths.push(s),i||V5.utils.cfb_gc(e)}return o.content=n,o.size=n?n.length:0,a&&(a.CLSID&&(o.clsid=a.CLSID),a.mt&&(o.mt=a.mt),a.ct&&(o.ct=a.ct)),o}return t.find=function(e,t){var n=e.FullPaths.map(function(e){return e.toUpperCase()}),r=n.map(function(e){var t=e.split("/");return t[t.length-("/"==e.slice(-1)?2:1)]}),a=!1;47===t.charCodeAt(0)?(a=!0,t=n[0].slice(0,-1)+t):a=-1!==t.indexOf("/");var i=t.toUpperCase(),o=!0===a?n.indexOf(i):r.indexOf(i);if(-1!==o)return e.FileIndex[o];var s=!i.match(Y3);for(i=i.replace(X3,""),s&&(i=i.replace(Y3,"!")),o=0;o<n.length;++o){if((s?n[o].replace(Y3,"!"):n[o]).replace(X3,"")==i)return e.FileIndex[o];if((s?r[o].replace(Y3,"!"):r[o]).replace(X3,"")==i)return e.FileIndex[o]}return null},t.read=function(t,n){var r=n&&n.type;switch(r||z3&&Buffer.isBuffer(t)&&(r="buffer"),r||"base64"){case"file":return function(t,n){return o(),s(e.readFileSync(t),n)}(t,n);case"base64":return s(H3(B3(t)),n);case"binary":return s(H3(t),n)}return s(t,n)},t.parse=s,t.write=function(t,n){var r=p(t,n);switch(n&&n.type||"buffer"){case"file":return o(),e.writeFileSync(n.filename,r),r;case"binary":return"string"==typeof r?r:k(r);case"base64":return j3("string"==typeof r?r:k(r));case"buffer":if(z3)return Buffer.isBuffer(r)?r:U3(r);case"array":return"string"==typeof r?H3(r):r}return r},t.writeFile=function(t,n,r){o();var a=p(t,r);e.writeFileSync(n,a)},t.utils={cfb_new:function(e){var t={};return d(t,e),t},cfb_add:ue,cfb_del:function(e,t){d(e);var n=V5.find(e,t);if(n)for(var r=0;r<e.FileIndex.length;++r)if(e.FileIndex[r]==n)return e.FileIndex.splice(r,1),e.FullPaths.splice(r,1),!0;return!1},cfb_mov:function(e,t,n){d(e);var a=V5.find(e,t);if(a)for(var i=0;i<e.FileIndex.length;++i)if(e.FileIndex[i]==a)return e.FileIndex[i].name=r(n),e.FullPaths[i]=n,!0;return!1},cfb_gc:function(e){f(e,!0)},ReadShift:F8,CheckField:M8,prep_blob:j8,bconcat:K3,use_zlib:function(e){try{var t=new(0,e.InflateRaw);if(t._processChunk(new Uint8Array([3,0]),t._finishFlushFlag),!t.bytesRead)throw new Error("zlib does not expose bytesRead");m=e}catch(_a){console.error("cannot use native zlib: "+(_a.message||_a))}},_deflateRaw:X,_inflateRaw:te,consts:w},t}();let H5;function G5(e){return"string"===typeof e?G3(e):Array.isArray(e)?function(e){if("undefined"===typeof Uint8Array)throw new Error("Unsupported");return new Uint8Array(e)}(e):e}function q5(e,t,n){if("undefined"!==typeof H5&&H5.writeFileSync)return n?H5.writeFileSync(e,t,n):H5.writeFileSync(e,t);if("undefined"!==typeof Deno){if(n&&"string"==typeof t)switch(n){case"utf8":t=new TextEncoder(n).encode(t);break;case"binary":t=G3(t);break;default:throw new Error("Unsupported encoding "+n)}return Deno.writeFileSync(e,t)}var r="utf8"==n?A6(t):t;if("undefined"!==typeof IE_SaveFile)return IE_SaveFile(r,e);if("undefined"!==typeof Blob){var a=new Blob([G5(r)],{type:"application/octet-stream"});if("undefined"!==typeof navigator&&navigator.msSaveBlob)return navigator.msSaveBlob(a,e);if("undefined"!==typeof saveAs)return saveAs(a,e);if("undefined"!==typeof URL&&"undefined"!==typeof document&&document.createElement&&URL.createObjectURL){var i=URL.createObjectURL(a);if("object"===typeof chrome&&"function"==typeof(chrome.downloads||{}).download)return URL.revokeObjectURL&&"undefined"!==typeof setTimeout&&setTimeout(function(){URL.revokeObjectURL(i)},6e4),chrome.downloads.download({url:i,filename:e,saveAs:!0});var o=document.createElement("a");if(null!=o.download)return o.download=e,o.href=i,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL&&"undefined"!==typeof setTimeout&&setTimeout(function(){URL.revokeObjectURL(i)},6e4),i}}if("undefined"!==typeof $&&"undefined"!==typeof File&&"undefined"!==typeof Folder)try{var s=File(e);return s.open("w"),s.encoding="binary",Array.isArray(t)&&(t=q3(t)),s.write(t),s.close(),t}catch(_a){if(!_a.message||!_a.message.match(/onstruct/))throw _a}throw new Error("cannot save file "+e)}function K5(e){for(var t=Object.keys(e),n=[],r=0;r<t.length;++r)Object.prototype.hasOwnProperty.call(e,t[r])&&n.push(t[r]);return n}function X5(e,t){for(var n=[],r=K5(e),a=0;a!==r.length;++a)null==n[e[r[a]][t]]&&(n[e[r[a]][t]]=r[a]);return n}function Y5(e){for(var t=[],n=K5(e),r=0;r!==n.length;++r)t[e[n[r]]]=n[r];return t}function $5(e){for(var t=[],n=K5(e),r=0;r!==n.length;++r)t[e[n[r]]]=parseInt(n[r],10);return t}var J5=new Date(1899,11,30,0,0,0);function Q5(e,t){var n=e.getTime();return t&&(n-=1263168e5),(n-(J5.getTime()+6e4*(e.getTimezoneOffset()-J5.getTimezoneOffset())))/864e5}var Z5=new Date,e6=J5.getTime()+6e4*(Z5.getTimezoneOffset()-J5.getTimezoneOffset()),t6=Z5.getTimezoneOffset();function n6(e){var t=new Date;return t.setTime(24*e*60*60*1e3+e6),t.getTimezoneOffset()!==t6&&t.setTime(t.getTime()+6e4*(t.getTimezoneOffset()-t6)),t}var r6=new Date("2017-02-19T19:06:09.000Z"),a6=isNaN(r6.getFullYear())?new Date("2/19/17"):r6,i6=2017==a6.getFullYear();function o6(e,t){var n=new Date(e);if(i6)return t>0?n.setTime(n.getTime()+60*n.getTimezoneOffset()*1e3):t<0&&n.setTime(n.getTime()-60*n.getTimezoneOffset()*1e3),n;if(e instanceof Date)return e;if(1917==a6.getFullYear()&&!isNaN(n.getFullYear())){var r=n.getFullYear();return e.indexOf(""+r)>-1||n.setFullYear(n.getFullYear()+100),n}var a=e.match(/\d+/g)||["2017","2","19","0","0","0"],i=new Date(+a[0],+a[1]-1,+a[2],+a[3]||0,+a[4]||0,+a[5]||0);return e.indexOf("Z")>-1&&(i=new Date(i.getTime()-60*i.getTimezoneOffset()*1e3)),i}function s6(e,t){if(z3&&Buffer.isBuffer(e)){if(t){if(255==e[0]&&254==e[1])return A6(e.slice(2).toString("utf16le"));if(254==e[1]&&255==e[2])return A6(D3(e.slice(2).toString("binary")))}return e.toString("binary")}if("undefined"!==typeof TextDecoder)try{if(t){if(255==e[0]&&254==e[1])return A6(new TextDecoder("utf-16le").decode(e.slice(2)));if(254==e[0]&&255==e[1])return A6(new TextDecoder("utf-16be").decode(e.slice(2)))}var n={"\u20ac":"\x80","\u201a":"\x82","\u0192":"\x83","\u201e":"\x84","\u2026":"\x85","\u2020":"\x86","\u2021":"\x87","\u02c6":"\x88","\u2030":"\x89","\u0160":"\x8a","\u2039":"\x8b","\u0152":"\x8c","\u017d":"\x8e","\u2018":"\x91","\u2019":"\x92","\u201c":"\x93","\u201d":"\x94","\u2022":"\x95","\u2013":"\x96","\u2014":"\x97","\u02dc":"\x98","\u2122":"\x99","\u0161":"\x9a","\u203a":"\x9b","\u0153":"\x9c","\u017e":"\x9e","\u0178":"\x9f"};return Array.isArray(e)&&(e=new Uint8Array(e)),new TextDecoder("latin1").decode(e).replace(/[\u20ac\u201a\u0192\u201e\u2026\u2020\u2021\u02c6\u2030\u0160\u2039\u0152\u017d\u2018\u2019\u201c\u201d\u2022\u2013\u2014\u02dc\u2122\u0161\u203a\u0153\u017e\u0178]/g,function(e){return n[e]||e})}catch(_a){}for(var r=[],a=0;a!=e.length;++a)r.push(String.fromCharCode(e[a]));return r.join("")}function c6(e){if("undefined"!=typeof JSON&&!Array.isArray(e))return JSON.parse(JSON.stringify(e));if("object"!=typeof e||null==e)return e;if(e instanceof Date)return new Date(e.getTime());var t={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=c6(e[n]));return t}function l6(e,t){for(var n="";n.length<t;)n+=e;return n}function u6(e){var t=Number(e);if(!isNaN(t))return isFinite(t)?t:NaN;if(!/\d/.test(e))return t;var n=1,r=e.replace(/([\d]),([\d])/g,"$1$2").replace(/[$]/g,"").replace(/[%]/g,function(){return n*=100,""});return isNaN(t=Number(r))?(r=r.replace(/[(](.*)[)]/,function(e,t){return n=-n,t}),isNaN(t=Number(r))?t:t/n):t/n}var h6=["january","february","march","april","may","june","july","august","september","october","november","december"];function d6(e){var t=new Date(e),n=new Date(NaN),r=t.getYear(),a=t.getMonth(),i=t.getDate();if(isNaN(i))return n;var o=e.toLowerCase();if(o.match(/jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec/)){if((o=o.replace(/[^a-z]/g,"").replace(/([^a-z]|^)[ap]m?([^a-z]|$)/,"")).length>3&&-1==h6.indexOf(o))return n}else if(o.match(/[a-z]/))return n;return r<0||r>8099?n:(a>0||i>1)&&101!=r?t:e.match(/[^-0-9:,\/\\]/)?n:t}function f6(e,t,n){if(e.FullPaths){var r;if("string"==typeof n)return r=z3?U3(n):function(e){for(var t=[],n=0,r=e.length+250,a=W3(e.length+255),i=0;i<e.length;++i){var o=e.charCodeAt(i);if(o<128)a[n++]=o;else if(o<2048)a[n++]=192|o>>6&31,a[n++]=128|63&o;else if(o>=55296&&o<57344){o=64+(1023&o);var s=1023&e.charCodeAt(++i);a[n++]=240|o>>8&7,a[n++]=128|o>>2&63,a[n++]=128|s>>6&15|(3&o)<<4,a[n++]=128|63&s}else a[n++]=224|o>>12&15,a[n++]=128|o>>6&63,a[n++]=128|63&o;n>r&&(t.push(a.slice(0,n)),n=0,a=W3(65535),r=65530)}return t.push(a.slice(0,n)),K3(t)}(n),V5.utils.cfb_add(e,t,r);V5.utils.cfb_add(e,t,n)}else e.file(t,n)}function p6(){return V5.utils.cfb_new()}var m6='<?xml version="1.0" encoding="UTF-8" standalone="yes"?>\r\n';var g6={"&quot;":'"',"&apos;":"'","&gt;":">","&lt;":"<","&amp;":"&"},v6=Y5(g6),b6=/[&<>'"]/g,y6=/[\u0000-\u0008\u000b-\u001f]/g;function x6(e){return(e+"").replace(b6,function(e){return v6[e]}).replace(y6,function(e){return"_x"+("000"+e.charCodeAt(0).toString(16)).slice(-4)+"_"})}function w6(e){return x6(e).replace(/ /g,"_x0020_")}var k6=/[\u0000-\u001f]/g;function S6(e){return(e+"").replace(b6,function(e){return v6[e]}).replace(/\n/g,"<br/>").replace(k6,function(e){return"&#x"+("000"+e.charCodeAt(0).toString(16)).slice(-4)+";"})}function N6(e){switch(e){case 1:case!0:case"1":case"true":case"TRUE":return!0;default:return!1}}function C6(e){for(var t="",n=0,r=0,a=0,i=0,o=0,s=0;n<e.length;)(r=e.charCodeAt(n++))<128?t+=String.fromCharCode(r):(a=e.charCodeAt(n++),r>191&&r<224?(o=(31&r)<<6,o|=63&a,t+=String.fromCharCode(o)):(i=e.charCodeAt(n++),r<240?t+=String.fromCharCode((15&r)<<12|(63&a)<<6|63&i):(s=((7&r)<<18|(63&a)<<12|(63&i)<<6|63&(o=e.charCodeAt(n++)))-65536,t+=String.fromCharCode(55296+(s>>>10&1023)),t+=String.fromCharCode(56320+(1023&s)))));return t}function E6(e){var t,n,r,a=W3(2*e.length),i=1,o=0,s=0;for(n=0;n<e.length;n+=i)i=1,(r=e.charCodeAt(n))<128?t=r:r<224?(t=64*(31&r)+(63&e.charCodeAt(n+1)),i=2):r<240?(t=4096*(15&r)+64*(63&e.charCodeAt(n+1))+(63&e.charCodeAt(n+2)),i=3):(i=4,t=262144*(7&r)+4096*(63&e.charCodeAt(n+1))+64*(63&e.charCodeAt(n+2))+(63&e.charCodeAt(n+3)),s=55296+((t-=65536)>>>10&1023),t=56320+(1023&t)),0!==s&&(a[o++]=255&s,a[o++]=s>>>8,s=0),a[o++]=t%256,a[o++]=t>>>8;return a.slice(0,o).toString("ucs2")}function I6(e){return U3(e,"binary").toString("utf8")}var T6="foo bar baz\xe2\x98\x83\xf0\x9f\x8d\xa3",_6=z3&&(I6(T6)==C6(T6)&&I6||E6(T6)==C6(T6)&&E6)||C6,A6=z3?function(e){return U3(e,"utf8").toString("binary")}:function(e){for(var t=[],n=0,r=0,a=0;n<e.length;)switch(r=e.charCodeAt(n++),!0){case r<128:t.push(String.fromCharCode(r));break;case r<2048:t.push(String.fromCharCode(192+(r>>6))),t.push(String.fromCharCode(128+(63&r)));break;case r>=55296&&r<57344:r-=55296,a=e.charCodeAt(n++)-56320+(r<<10),t.push(String.fromCharCode(240+(a>>18&7))),t.push(String.fromCharCode(144+(a>>12&63))),t.push(String.fromCharCode(128+(a>>6&63))),t.push(String.fromCharCode(128+(63&a)));break;default:t.push(String.fromCharCode(224+(r>>12))),t.push(String.fromCharCode(128+(r>>6&63))),t.push(String.fromCharCode(128+(63&r)))}return t.join("")},R6=function(){var e=[["nbsp"," "],["middot","\xb7"],["quot",'"'],["apos","'"],["gt",">"],["lt","<"],["amp","&"]].map(function(e){return[new RegExp("&"+e[0]+";","ig"),e[1]]});return function(t){for(var n=t.replace(/^[\t\n\r ]+/,"").replace(/[\t\n\r ]+$/,"").replace(/>\s+/g,">").replace(/\s+</g,"<").replace(/[\t\n\r ]+/g," ").replace(/<\s*[bB][rR]\s*\/?>/g,"\n").replace(/<[^>]*>/g,""),r=0;r<e.length;++r)n=n.replace(e[r][0],e[r][1]);return n}}();var F6=/(^\s|\s$|\n)/;function D6(e,t){return"<"+e+(t.match(F6)?' xml:space="preserve"':"")+">"+t+"</"+e+">"}function O6(e){return K5(e).map(function(t){return" "+t+'="'+e[t]+'"'}).join("")}function L6(e,t,n){return"<"+e+(null!=n?O6(n):"")+(null!=t?(t.match(F6)?' xml:space="preserve"':"")+">"+t+"</"+e:"/")+">"}function P6(e,t){try{return e.toISOString().replace(/\.\d*/,"")}catch(_a){if(t)throw _a}return""}var M6="http://schemas.openxmlformats.org/package/2006/metadata/core-properties",j6="http://schemas.openxmlformats.org/officeDocument/2006/custom-properties",B6="http://schemas.openxmlformats.org/officeDocument/2006/extended-properties",z6="http://schemas.openxmlformats.org/package/2006/content-types",U6="http://schemas.openxmlformats.org/package/2006/relationships",W6="http://schemas.microsoft.com/office/spreadsheetml/2018/threadedcomments",V6="http://purl.org/dc/elements/1.1/",H6="http://purl.org/dc/terms/",G6="http://purl.org/dc/dcmitype/",q6="http://schemas.openxmlformats.org/officeDocument/2006/relationships",K6="http://schemas.openxmlformats.org/officeDocument/2006/docPropsVTypes",X6="http://www.w3.org/2001/XMLSchema-instance",Y6="http://www.w3.org/2001/XMLSchema",$6=["http://schemas.openxmlformats.org/spreadsheetml/2006/main","http://purl.oclc.org/ooxml/spreadsheetml/main","http://schemas.microsoft.com/office/excel/2006/main","http://schemas.microsoft.com/office/excel/2006/2"],J6="urn:schemas-microsoft-com:office:office",Q6="urn:schemas-microsoft-com:office:excel",Z6="urn:schemas-microsoft-com:office:spreadsheet",e8="uuid:C2F41010-65B3-11d1-A29F-00AA00C14882",t8="http://macVmlSchemaUri",n8="urn:schemas-microsoft-com:vml",r8="http://www.w3.org/TR/REC-html40";var a8=function(e){for(var t=[],n=0;n<e[0].length;++n)if(e[0][n])for(var r=0,a=e[0][n].length;r<a;r+=10240)t.push.apply(t,e[0][n].slice(r,r+10240));return t},i8=z3?function(e){return e[0].length>0&&Buffer.isBuffer(e[0][0])?Buffer.concat(e[0].map(function(e){return Buffer.isBuffer(e)?e:U3(e)})):a8(e)}:a8,o8=function(e,t,n){for(var r=[],a=t;a<n;a+=2)r.push(String.fromCharCode(I8(e,a)));return r.join("").replace(X3,"")},s8=z3?function(e,t,n){return Buffer.isBuffer(e)?e.toString("utf16le",t,n).replace(X3,""):o8(e,t,n)}:o8,c8=function(e,t,n){for(var r=[],a=t;a<t+n;++a)r.push(("0"+e[a].toString(16)).slice(-2));return r.join("")},l8=z3?function(e,t,n){return Buffer.isBuffer(e)?e.toString("hex",t,t+n):c8(e,t,n)}:c8,u8=function(e,t,n){for(var r=[],a=t;a<n;a++)r.push(String.fromCharCode(E8(e,a)));return r.join("")},h8=z3?function(e,t,n){return Buffer.isBuffer(e)?e.toString("utf8",t,n):u8(e,t,n)}:u8,d8=function(e,t){var n=_8(e,t);return n>0?h8(e,t+4,t+4+n-1):""},f8=d8,p8=function(e,t){var n=_8(e,t);return n>0?h8(e,t+4,t+4+n-1):""},m8=p8,g8=function(e,t){var n=2*_8(e,t);return n>0?h8(e,t+4,t+4+n-1):""},v8=g8,b8=function(e,t){var n=_8(e,t);return n>0?s8(e,t+4,t+4+n):""},y8=b8,x8=function(e,t){var n=_8(e,t);return n>0?h8(e,t+4,t+4+n):""},w8=x8,k8=function(e,t){return function(e,t){for(var n=1-2*(e[t+7]>>>7),r=((127&e[t+7])<<4)+(e[t+6]>>>4&15),a=15&e[t+6],i=5;i>=0;--i)a=256*a+e[t+i];return 2047==r?0==a?n*(1/0):NaN:(0==r?r=-1022:(r-=1023,a+=Math.pow(2,52)),n*Math.pow(2,r-52)*a)}(e,t)},S8=k8,N8=function(e){return Array.isArray(e)||"undefined"!==typeof Uint8Array&&e instanceof Uint8Array};function C8(){s8=function(e,t,n){return O3.utils.decode(1200,e.slice(t,n)).replace(X3,"")},h8=function(e,t,n){return O3.utils.decode(65001,e.slice(t,n))},f8=function(e,t){var n=_8(e,t);return n>0?O3.utils.decode(I3,e.slice(t+4,t+4+n-1)):""},m8=function(e,t){var n=_8(e,t);return n>0?O3.utils.decode(E3,e.slice(t+4,t+4+n-1)):""},v8=function(e,t){var n=2*_8(e,t);return n>0?O3.utils.decode(1200,e.slice(t+4,t+4+n-1)):""},y8=function(e,t){var n=_8(e,t);return n>0?O3.utils.decode(1200,e.slice(t+4,t+4+n)):""},w8=function(e,t){var n=_8(e,t);return n>0?O3.utils.decode(65001,e.slice(t+4,t+4+n)):""}}z3&&(f8=function(e,t){if(!Buffer.isBuffer(e))return d8(e,t);var n=e.readUInt32LE(t);return n>0?e.toString("utf8",t+4,t+4+n-1):""},m8=function(e,t){if(!Buffer.isBuffer(e))return p8(e,t);var n=e.readUInt32LE(t);return n>0?e.toString("utf8",t+4,t+4+n-1):""},v8=function(e,t){if(!Buffer.isBuffer(e))return g8(e,t);var n=2*e.readUInt32LE(t);return e.toString("utf16le",t+4,t+4+n-1)},y8=function(e,t){if(!Buffer.isBuffer(e))return b8(e,t);var n=e.readUInt32LE(t);return e.toString("utf16le",t+4,t+4+n)},w8=function(e,t){if(!Buffer.isBuffer(e))return x8(e,t);var n=e.readUInt32LE(t);return e.toString("utf8",t+4,t+4+n)},S8=function(e,t){return Buffer.isBuffer(e)?e.readDoubleLE(t):k8(e,t)},N8=function(e){return Buffer.isBuffer(e)||Array.isArray(e)||"undefined"!==typeof Uint8Array&&e instanceof Uint8Array}),"undefined"!==typeof O3&&C8();var E8=function(e,t){return e[t]},I8=function(e,t){return 256*e[t+1]+e[t]},T8=function(e,t){var n=256*e[t+1]+e[t];return n<32768?n:-1*(65535-n+1)},_8=function(e,t){return e[t+3]*(1<<24)+(e[t+2]<<16)+(e[t+1]<<8)+e[t]},A8=function(e,t){return e[t+3]<<24|e[t+2]<<16|e[t+1]<<8|e[t]},R8=function(e,t){return e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3]};function F8(e,t){var n,r,a,i,o,s,c="",l=[];switch(t){case"dbcs":if(s=this.l,z3&&Buffer.isBuffer(this))c=this.slice(this.l,this.l+2*e).toString("utf16le");else for(o=0;o<e;++o)c+=String.fromCharCode(I8(this,s)),s+=2;e*=2;break;case"utf8":c=h8(this,this.l,this.l+e);break;case"utf16le":e*=2,c=s8(this,this.l,this.l+e);break;case"wstr":if("undefined"===typeof O3)return F8.call(this,e,"dbcs");c=O3.utils.decode(E3,this.slice(this.l,this.l+2*e)),e*=2;break;case"lpstr-ansi":c=f8(this,this.l),e=4+_8(this,this.l);break;case"lpstr-cp":c=m8(this,this.l),e=4+_8(this,this.l);break;case"lpwstr":c=v8(this,this.l),e=4+2*_8(this,this.l);break;case"lpp4":e=4+_8(this,this.l),c=y8(this,this.l),2&e&&(e+=2);break;case"8lpp4":e=4+_8(this,this.l),c=w8(this,this.l),3&e&&(e+=4-(3&e));break;case"cstr":for(e=0,c="";0!==(a=E8(this,this.l+e++));)l.push(L3(a));c=l.join("");break;case"_wstr":for(e=0,c="";0!==(a=I8(this,this.l+e));)l.push(L3(a)),e+=2;e+=2,c=l.join("");break;case"dbcs-cont":for(c="",s=this.l,o=0;o<e;++o){if(this.lens&&-1!==this.lens.indexOf(s))return a=E8(this,s),this.l=s+1,i=F8.call(this,e-o,a?"dbcs-cont":"sbcs-cont"),l.join("")+i;l.push(L3(I8(this,s))),s+=2}c=l.join(""),e*=2;break;case"cpstr":if("undefined"!==typeof O3){c=O3.utils.decode(E3,this.slice(this.l,this.l+e));break}case"sbcs-cont":for(c="",s=this.l,o=0;o!=e;++o){if(this.lens&&-1!==this.lens.indexOf(s))return a=E8(this,s),this.l=s+1,i=F8.call(this,e-o,a?"dbcs-cont":"sbcs-cont"),l.join("")+i;l.push(L3(E8(this,s))),s+=1}c=l.join("");break;default:switch(e){case 1:return n=E8(this,this.l),this.l++,n;case 2:return n=("i"===t?T8:I8)(this,this.l),this.l+=2,n;case 4:case-4:return"i"===t||0===(128&this[this.l+3])?(n=(e>0?A8:R8)(this,this.l),this.l+=4,n):(r=_8(this,this.l),this.l+=4,r);case 8:case-8:if("f"===t)return r=8==e?S8(this,this.l):S8([this[this.l+7],this[this.l+6],this[this.l+5],this[this.l+4],this[this.l+3],this[this.l+2],this[this.l+1],this[this.l+0]],0),this.l+=8,r;e=8;case 16:c=l8(this,this.l,e)}}return this.l+=e,c}var D8=function(e,t,n){e[n]=255&t,e[n+1]=t>>>8&255,e[n+2]=t>>>16&255,e[n+3]=t>>>24&255},O8=function(e,t,n){e[n]=255&t,e[n+1]=t>>8&255,e[n+2]=t>>16&255,e[n+3]=t>>24&255},L8=function(e,t,n){e[n]=255&t,e[n+1]=t>>>8&255};function P8(e,t,n){var r=0,a=0;if("dbcs"===n){for(a=0;a!=t.length;++a)L8(this,t.charCodeAt(a),this.l+2*a);r=2*t.length}else if("sbcs"===n){if("undefined"!==typeof O3&&874==I3)for(a=0;a!=t.length;++a){var i=O3.utils.encode(I3,t.charAt(a));this[this.l+a]=i[0]}else for(t=t.replace(/[^\x00-\x7F]/g,"_"),a=0;a!=t.length;++a)this[this.l+a]=255&t.charCodeAt(a);r=t.length}else{if("hex"===n){for(;a<e;++a)this[this.l++]=parseInt(t.slice(2*a,2*a+2),16)||0;return this}if("utf16le"===n){var o=Math.min(this.l+e,this.length);for(a=0;a<Math.min(t.length,e);++a){var s=t.charCodeAt(a);this[this.l++]=255&s,this[this.l++]=s>>8}for(;this.l<o;)this[this.l++]=0;return this}switch(e){case 1:r=1,this[this.l]=255&t;break;case 2:r=2,this[this.l]=255&t,t>>>=8,this[this.l+1]=255&t;break;case 3:r=3,this[this.l]=255&t,t>>>=8,this[this.l+1]=255&t,t>>>=8,this[this.l+2]=255&t;break;case 4:r=4,D8(this,t,this.l);break;case 8:if(r=8,"f"===n){!function(e,t,n){var r=(t<0||1/t==-1/0?1:0)<<7,a=0,i=0,o=r?-t:t;isFinite(o)?0==o?a=i=0:(a=Math.floor(Math.log(o)/Math.LN2),i=o*Math.pow(2,52-a),a<=-1023&&(!isFinite(i)||i<Math.pow(2,52))?a=-1022:(i-=Math.pow(2,52),a+=1023)):(a=2047,i=isNaN(t)?26985:0);for(var s=0;s<=5;++s,i/=256)e[n+s]=255&i;e[n+6]=(15&a)<<4|15&i,e[n+7]=a>>4|r}(this,t,this.l);break}case 16:break;case-4:r=4,O8(this,t,this.l)}}return this.l+=r,this}function M8(e,t){var n=l8(this,this.l,e.length>>1);if(n!==e)throw new Error(t+"Expected "+e+" saw "+n);this.l+=e.length>>1}function j8(e,t){e.l=t,e.read_shift=F8,e.chk=M8,e.write_shift=P8}function B8(e,t){e.l+=t}function z8(e){var t=W3(e);return j8(t,0),t}function U8(){var e=[],t=z3?256:2048,n=function(e){var t=z8(e);return j8(t,0),t},r=n(t),a=function(){r&&(r.length>r.l&&((r=r.slice(0,r.l)).l=r.length),r.length>0&&e.push(r),r=null)},i=function(e){return r&&e<r.length-r.l?r:(a(),r=n(Math.max(e+1,t)))};return{next:i,push:function(e){a(),null==(r=e).l&&(r.l=r.length),i(t)},end:function(){return a(),K3(e)},_bufs:e}}function W8(e,t,n,r){var a,i=+t;if(!isNaN(i)){r||(r=rne[i].p||(n||[]).length||0),a=1+(i>=128?1:0)+1,r>=128&&++a,r>=16384&&++a,r>=2097152&&++a;var o=e.next(a);i<=127?o.write_shift(1,i):(o.write_shift(1,128+(127&i)),o.write_shift(1,i>>7));for(var s=0;4!=s;++s){if(!(r>=128)){o.write_shift(1,r);break}o.write_shift(1,128+(127&r)),r>>=7}r>0&&N8(n)&&e.push(n)}}function V8(e,t,n){var r=c6(e);if(t.s?(r.cRel&&(r.c+=t.s.c),r.rRel&&(r.r+=t.s.r)):(r.cRel&&(r.c+=t.c),r.rRel&&(r.r+=t.r)),!n||n.biff<12){for(;r.c>=256;)r.c-=256;for(;r.r>=65536;)r.r-=65536}return r}function H8(e,t,n){var r=c6(e);return r.s=V8(r.s,t.s,n),r.e=V8(r.e,t.s,n),r}function G8(e,t){if(e.cRel&&e.c<0)for(e=c6(e);e.c<0;)e.c+=t>8?16384:256;if(e.rRel&&e.r<0)for(e=c6(e);e.r<0;)e.r+=t>8?1048576:t>5?65536:16384;var n=Q8(e);return e.cRel||null==e.cRel||(n=n.replace(/^([A-Z])/,"$$$1")),e.rRel||null==e.rRel||(n=function(e){return e.replace(/([A-Z]|^)(\d+)$/,"$1$$$2")}(n)),n}function q8(e,t){return 0!=e.s.r||e.s.rRel||e.e.r!=(t.biff>=12?1048575:t.biff>=8?65536:16384)||e.e.rRel?0!=e.s.c||e.s.cRel||e.e.c!=(t.biff>=12?16383:255)||e.e.cRel?G8(e.s,t.biff)+":"+G8(e.e,t.biff):(e.s.rRel?"":"$")+X8(e.s.r)+":"+(e.e.rRel?"":"$")+X8(e.e.r):(e.s.cRel?"":"$")+$8(e.s.c)+":"+(e.e.cRel?"":"$")+$8(e.e.c)}function K8(e){return parseInt(e.replace(/\$(\d+)$/,"$1"),10)-1}function X8(e){return""+(e+1)}function Y8(e){for(var t=e.replace(/^\$([A-Z])/,"$1"),n=0,r=0;r!==t.length;++r)n=26*n+t.charCodeAt(r)-64;return n-1}function $8(e){if(e<0)throw new Error("invalid column "+e);var t="";for(++e;e;e=Math.floor((e-1)/26))t=String.fromCharCode((e-1)%26+65)+t;return t}function J8(e){for(var t=0,n=0,r=0;r<e.length;++r){var a=e.charCodeAt(r);a>=48&&a<=57?t=10*t+(a-48):a>=65&&a<=90&&(n=26*n+(a-64))}return{c:n-1,r:t-1}}function Q8(e){for(var t=e.c+1,n="";t;t=(t-1)/26|0)n=String.fromCharCode((t-1)%26+65)+n;return n+(e.r+1)}function Z8(e){var t=e.indexOf(":");return-1==t?{s:J8(e),e:J8(e)}:{s:J8(e.slice(0,t)),e:J8(e.slice(t+1))}}function e7(e,t){return"undefined"===typeof t||"number"===typeof t?e7(e.s,e.e):("string"!==typeof e&&(e=Q8(e)),"string"!==typeof t&&(t=Q8(t)),e==t?e:e+":"+t)}function t7(e){var t={s:{c:0,r:0},e:{c:0,r:0}},n=0,r=0,a=0,i=e.length;for(n=0;r<i&&!((a=e.charCodeAt(r)-64)<1||a>26);++r)n=26*n+a;for(t.s.c=--n,n=0;r<i&&!((a=e.charCodeAt(r)-48)<0||a>9);++r)n=10*n+a;if(t.s.r=--n,r===i||10!=a)return t.e.c=t.s.c,t.e.r=t.s.r,t;for(++r,n=0;r!=i&&!((a=e.charCodeAt(r)-64)<1||a>26);++r)n=26*n+a;for(t.e.c=--n,n=0;r!=i&&!((a=e.charCodeAt(r)-48)<0||a>9);++r)n=10*n+a;return t.e.r=--n,t}function n7(e,t){var n="d"==e.t&&t instanceof Date;if(null!=e.z)try{return e.w=M5(e.z,n?Q5(t):t)}catch(_a){}try{return e.w=M5((e.XF||{}).numFmtId||(n?14:0),n?Q5(t):t)}catch(_a){return""+t}}function r7(e,t,n){return null==e||null==e.t||"z"==e.t?"":void 0!==e.w?e.w:("d"==e.t&&!e.z&&n&&n.dateNF&&(e.z=n.dateNF),"e"==e.t?j7[e.v]||e.v:n7(e,void 0==t?e.v:t))}function a7(e,t){var n=t&&t.sheet?t.sheet:"Sheet1",r={};return r[n]=e,{SheetNames:[n],Sheets:r}}function i7(e,t,n){var r=n||{},a=e?Array.isArray(e):r.dense;var i=e||(a?[]:{}),o=0,s=0;if(i&&null!=r.origin){if("number"==typeof r.origin)o=r.origin;else{var c="string"==typeof r.origin?J8(r.origin):r.origin;o=c.r,s=c.c}i["!ref"]||(i["!ref"]="A1:A1")}var l={s:{c:1e7,r:1e7},e:{c:0,r:0}};if(i["!ref"]){var u=t7(i["!ref"]);l.s.c=u.s.c,l.s.r=u.s.r,l.e.c=Math.max(l.e.c,u.e.c),l.e.r=Math.max(l.e.r,u.e.r),-1==o&&(l.e.r=o=u.e.r+1)}for(var h=0;h!=t.length;++h)if(t[h]){if(!Array.isArray(t[h]))throw new Error("aoa_to_sheet expects an array of arrays");for(var d=0;d!=t[h].length;++d)if("undefined"!==typeof t[h][d]){var f={v:t[h][d]},p=o+h,m=s+d;if(l.s.r>p&&(l.s.r=p),l.s.c>m&&(l.s.c=m),l.e.r<p&&(l.e.r=p),l.e.c<m&&(l.e.c=m),!t[h][d]||"object"!==typeof t[h][d]||Array.isArray(t[h][d])||t[h][d]instanceof Date)if(Array.isArray(f.v)&&(f.f=t[h][d][1],f.v=f.v[0]),null===f.v)if(f.f)f.t="n";else if(r.nullError)f.t="e",f.v=0;else{if(!r.sheetStubs)continue;f.t="z"}else"number"===typeof f.v?f.t="n":"boolean"===typeof f.v?f.t="b":f.v instanceof Date?(f.z=r.dateNF||i5[14],r.cellDates?(f.t="d",f.w=M5(f.z,Q5(f.v))):(f.t="n",f.v=Q5(f.v),f.w=M5(f.z,f.v))):f.t="s";else f=t[h][d];if(a)i[p]||(i[p]=[]),i[p][m]&&i[p][m].z&&(f.z=i[p][m].z),i[p][m]=f;else{var g=Q8({c:m,r:p});i[g]&&i[g].z&&(f.z=i[g].z),i[g]=f}}}return l.s.c<1e7&&(i["!ref"]=e7(l)),i}function o7(e,t){return i7(null,e,t)}function s7(e,t){return t||(t=z8(4)),t.write_shift(4,e),t}function c7(e){var t=e.read_shift(4);return 0===t?"":e.read_shift(t,"dbcs")}function l7(e,t){var n=!1;return null==t&&(n=!0,t=z8(4+2*e.length)),t.write_shift(4,e.length),e.length>0&&t.write_shift(0,e,"dbcs"),n?t.slice(0,t.l):t}function u7(e){return{ich:e.read_shift(2),ifnt:e.read_shift(2)}}function h7(e,t){var n=e.l,r=e.read_shift(1),a=c7(e),i=[],o={t:a,h:a};if(0!==(1&r)){for(var s=e.read_shift(4),c=0;c!=s;++c)i.push(u7(e));o.r=i}else o.r=[{ich:0,ifnt:0}];return e.l=n+t,o}var d7=h7;function f7(e,t){var n=!1;return null==t&&(n=!0,t=z8(23+4*e.t.length)),t.write_shift(1,1),l7(e.t,t),t.write_shift(4,1),function(e,t){t||(t=z8(4)),t.write_shift(2,e.ich||0),t.write_shift(2,e.ifnt||0)}({ich:0,ifnt:0},t),n?t.slice(0,t.l):t}function p7(e){var t=e.read_shift(4),n=e.read_shift(2);return n+=e.read_shift(1)<<16,e.l++,{c:t,iStyleRef:n}}function m7(e,t){return null==t&&(t=z8(8)),t.write_shift(-4,e.c),t.write_shift(3,e.iStyleRef||e.s),t.write_shift(1,0),t}function g7(e){var t=e.read_shift(2);return t+=e.read_shift(1)<<16,e.l++,{c:-1,iStyleRef:t}}function v7(e,t){return null==t&&(t=z8(4)),t.write_shift(3,e.iStyleRef||e.s),t.write_shift(1,0),t}var b7=c7,y7=l7;function x7(e){var t=e.read_shift(4);return 0===t||4294967295===t?"":e.read_shift(t,"dbcs")}function w7(e,t){var n=!1;return null==t&&(n=!0,t=z8(127)),t.write_shift(4,e.length>0?e.length:4294967295),e.length>0&&t.write_shift(0,e,"dbcs"),n?t.slice(0,t.l):t}var k7=c7,S7=x7,N7=w7;function C7(e){var t=e.slice(e.l,e.l+4),n=1&t[0],r=2&t[0];e.l+=4;var a=0===r?S8([0,0,0,0,252&t[0],t[1],t[2],t[3]],0):A8(t,0)>>2;return n?a/100:a}function E7(e,t){null==t&&(t=z8(4));var n=0,r=0,a=100*e;if(e==(0|e)&&e>=-(1<<29)&&e<1<<29?r=1:a==(0|a)&&a>=-(1<<29)&&a<1<<29&&(r=1,n=1),!r)throw new Error("unsupported RkNumber "+e);t.write_shift(-4,((n?a:e)<<2)+(n+2))}function I7(e){var t={s:{},e:{}};return t.s.r=e.read_shift(4),t.e.r=e.read_shift(4),t.s.c=e.read_shift(4),t.e.c=e.read_shift(4),t}var T7=I7,_7=function(e,t){return t||(t=z8(16)),t.write_shift(4,e.s.r),t.write_shift(4,e.e.r),t.write_shift(4,e.s.c),t.write_shift(4,e.e.c),t};function A7(e){if(e.length-e.l<8)throw"XLS Xnum Buffer underflow";return e.read_shift(8,"f")}function R7(e,t){return(t||z8(8)).write_shift(8,e,"f")}function F7(e,t){if(t||(t=z8(8)),!e||e.auto)return t.write_shift(4,0),t.write_shift(4,0),t;null!=e.index?(t.write_shift(1,2),t.write_shift(1,e.index)):null!=e.theme?(t.write_shift(1,6),t.write_shift(1,e.theme)):(t.write_shift(1,5),t.write_shift(1,0));var n=e.tint||0;if(n>0?n*=32767:n<0&&(n*=32768),t.write_shift(2,n),e.rgb&&null==e.theme){var r=e.rgb||"FFFFFF";"number"==typeof r&&(r=("000000"+r.toString(16)).slice(-6)),t.write_shift(1,parseInt(r.slice(0,2),16)),t.write_shift(1,parseInt(r.slice(2,4),16)),t.write_shift(1,parseInt(r.slice(4,6),16)),t.write_shift(1,255)}else t.write_shift(2,0),t.write_shift(1,0),t.write_shift(1,0);return t}var D7=80,O7={1:{n:"CodePage",t:2},2:{n:"Category",t:D7},3:{n:"PresentationFormat",t:D7},4:{n:"ByteCount",t:3},5:{n:"LineCount",t:3},6:{n:"ParagraphCount",t:3},7:{n:"SlideCount",t:3},8:{n:"NoteCount",t:3},9:{n:"HiddenCount",t:3},10:{n:"MultimediaClipCount",t:3},11:{n:"ScaleCrop",t:11},12:{n:"HeadingPairs",t:4108},13:{n:"TitlesOfParts",t:4126},14:{n:"Manager",t:D7},15:{n:"Company",t:D7},16:{n:"LinksUpToDate",t:11},17:{n:"CharacterCount",t:3},19:{n:"SharedDoc",t:11},22:{n:"HyperlinksChanged",t:11},23:{n:"AppVersion",t:3,p:"version"},24:{n:"DigSig",t:65},26:{n:"ContentType",t:D7},27:{n:"ContentStatus",t:D7},28:{n:"Language",t:D7},29:{n:"Version",t:D7},255:{},2147483648:{n:"Locale",t:19},2147483651:{n:"Behavior",t:19},1919054434:{}},L7={1:{n:"CodePage",t:2},2:{n:"Title",t:D7},3:{n:"Subject",t:D7},4:{n:"Author",t:D7},5:{n:"Keywords",t:D7},6:{n:"Comments",t:D7},7:{n:"Template",t:D7},8:{n:"LastAuthor",t:D7},9:{n:"RevNumber",t:D7},10:{n:"EditTime",t:64},11:{n:"LastPrinted",t:64},12:{n:"CreatedDate",t:64},13:{n:"ModifiedDate",t:64},14:{n:"PageCount",t:3},15:{n:"WordCount",t:3},16:{n:"CharCount",t:3},17:{n:"Thumbnail",t:71},18:{n:"Application",t:D7},19:{n:"DocSecurity",t:3},255:{},2147483648:{n:"Locale",t:19},2147483651:{n:"Behavior",t:19},1919054434:{}};function P7(e){return e.map(function(e){return[e>>16&255,e>>8&255,255&e]})}var M7=c6(P7([0,16777215,16711680,65280,255,16776960,16711935,65535,0,16777215,16711680,65280,255,16776960,16711935,65535,8388608,32768,128,8421376,8388736,32896,12632256,8421504,10066431,10040166,16777164,13434879,6684774,16744576,26316,13421823,128,16711935,16776960,65535,8388736,8388608,32896,255,52479,13434879,13434828,16777113,10079487,16751052,13408767,16764057,3368703,3394764,10079232,16763904,16750848,16737792,6710937,9868950,13158,3381606,13056,3355392,10040064,10040166,3355545,3355443,16777215,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0])),j7={0:"#NULL!",7:"#DIV/0!",15:"#VALUE!",23:"#REF!",29:"#NAME?",36:"#NUM!",42:"#N/A",43:"#GETTING_DATA",255:"#WTF?"},B7={"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet.main+xml":"workbooks","application/vnd.ms-excel.sheet.macroEnabled.main+xml":"workbooks","application/vnd.ms-excel.sheet.binary.macroEnabled.main":"workbooks","application/vnd.ms-excel.addin.macroEnabled.main+xml":"workbooks","application/vnd.openxmlformats-officedocument.spreadsheetml.template.main+xml":"workbooks","application/vnd.openxmlformats-officedocument.spreadsheetml.worksheet+xml":"sheets","application/vnd.ms-excel.worksheet":"sheets","application/vnd.ms-excel.binIndexWs":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.chartsheet+xml":"charts","application/vnd.ms-excel.chartsheet":"charts","application/vnd.ms-excel.macrosheet+xml":"macros","application/vnd.ms-excel.macrosheet":"macros","application/vnd.ms-excel.intlmacrosheet":"TODO","application/vnd.ms-excel.binIndexMs":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.dialogsheet+xml":"dialogs","application/vnd.ms-excel.dialogsheet":"dialogs","application/vnd.openxmlformats-officedocument.spreadsheetml.sharedStrings+xml":"strs","application/vnd.ms-excel.sharedStrings":"strs","application/vnd.openxmlformats-officedocument.spreadsheetml.styles+xml":"styles","application/vnd.ms-excel.styles":"styles","application/vnd.openxmlformats-package.core-properties+xml":"coreprops","application/vnd.openxmlformats-officedocument.custom-properties+xml":"custprops","application/vnd.openxmlformats-officedocument.extended-properties+xml":"extprops","application/vnd.openxmlformats-officedocument.customXmlProperties+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.customProperty":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.comments+xml":"comments","application/vnd.ms-excel.comments":"comments","application/vnd.ms-excel.threadedcomments+xml":"threadedcomments","application/vnd.ms-excel.person+xml":"people","application/vnd.openxmlformats-officedocument.spreadsheetml.sheetMetadata+xml":"metadata","application/vnd.ms-excel.sheetMetadata":"metadata","application/vnd.ms-excel.pivotTable":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.pivotTable+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.chart+xml":"TODO","application/vnd.ms-office.chartcolorstyle+xml":"TODO","application/vnd.ms-office.chartstyle+xml":"TODO","application/vnd.ms-office.chartex+xml":"TODO","application/vnd.ms-excel.calcChain":"calcchains","application/vnd.openxmlformats-officedocument.spreadsheetml.calcChain+xml":"calcchains","application/vnd.openxmlformats-officedocument.spreadsheetml.printerSettings":"TODO","application/vnd.ms-office.activeX":"TODO","application/vnd.ms-office.activeX+xml":"TODO","application/vnd.ms-excel.attachedToolbars":"TODO","application/vnd.ms-excel.connections":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.connections+xml":"TODO","application/vnd.ms-excel.externalLink":"links","application/vnd.openxmlformats-officedocument.spreadsheetml.externalLink+xml":"links","application/vnd.ms-excel.pivotCacheDefinition":"TODO","application/vnd.ms-excel.pivotCacheRecords":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.pivotCacheDefinition+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.pivotCacheRecords+xml":"TODO","application/vnd.ms-excel.queryTable":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.queryTable+xml":"TODO","application/vnd.ms-excel.userNames":"TODO","application/vnd.ms-excel.revisionHeaders":"TODO","application/vnd.ms-excel.revisionLog":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.revisionHeaders+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.revisionLog+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.userNames+xml":"TODO","application/vnd.ms-excel.tableSingleCells":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.tableSingleCells+xml":"TODO","application/vnd.ms-excel.slicer":"TODO","application/vnd.ms-excel.slicerCache":"TODO","application/vnd.ms-excel.slicer+xml":"TODO","application/vnd.ms-excel.slicerCache+xml":"TODO","application/vnd.ms-excel.wsSortMap":"TODO","application/vnd.ms-excel.table":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.table+xml":"TODO","application/vnd.openxmlformats-officedocument.theme+xml":"themes","application/vnd.openxmlformats-officedocument.themeOverride+xml":"TODO","application/vnd.ms-excel.Timeline+xml":"TODO","application/vnd.ms-excel.TimelineCache+xml":"TODO","application/vnd.ms-office.vbaProject":"vba","application/vnd.ms-office.vbaProjectSignature":"TODO","application/vnd.ms-office.volatileDependencies":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.volatileDependencies+xml":"TODO","application/vnd.ms-excel.controlproperties+xml":"TODO","application/vnd.openxmlformats-officedocument.model+data":"TODO","application/vnd.ms-excel.Survey+xml":"TODO","application/vnd.openxmlformats-officedocument.drawing+xml":"drawings","application/vnd.openxmlformats-officedocument.drawingml.chartshapes+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramColors+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramData+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramLayout+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramStyle+xml":"TODO","application/vnd.openxmlformats-officedocument.vmlDrawing":"TODO","application/vnd.openxmlformats-package.relationships+xml":"rels","application/vnd.openxmlformats-officedocument.oleObject":"TODO","image/png":"TODO",sheet:"js"},z7={workbooks:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet.main+xml",xlsm:"application/vnd.ms-excel.sheet.macroEnabled.main+xml",xlsb:"application/vnd.ms-excel.sheet.binary.macroEnabled.main",xlam:"application/vnd.ms-excel.addin.macroEnabled.main+xml",xltx:"application/vnd.openxmlformats-officedocument.spreadsheetml.template.main+xml"},strs:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sharedStrings+xml",xlsb:"application/vnd.ms-excel.sharedStrings"},comments:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.comments+xml",xlsb:"application/vnd.ms-excel.comments"},sheets:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.worksheet+xml",xlsb:"application/vnd.ms-excel.worksheet"},charts:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.chartsheet+xml",xlsb:"application/vnd.ms-excel.chartsheet"},dialogs:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.dialogsheet+xml",xlsb:"application/vnd.ms-excel.dialogsheet"},macros:{xlsx:"application/vnd.ms-excel.macrosheet+xml",xlsb:"application/vnd.ms-excel.macrosheet"},metadata:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheetMetadata+xml",xlsb:"application/vnd.ms-excel.sheetMetadata"},styles:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.styles+xml",xlsb:"application/vnd.ms-excel.styles"}};function U7(e,t){var n,r=function(e){for(var t=[],n=K5(e),r=0;r!==n.length;++r)null==t[e[n[r]]]&&(t[e[n[r]]]=[]),t[e[n[r]]].push(n[r]);return t}(B7),a=[];a[a.length]=m6,a[a.length]=L6("Types",null,{xmlns:z6,"xmlns:xsd":Y6,"xmlns:xsi":X6}),a=a.concat([["xml","application/xml"],["bin","application/vnd.ms-excel.sheet.binary.macroEnabled.main"],["vml","application/vnd.openxmlformats-officedocument.vmlDrawing"],["data","application/vnd.openxmlformats-officedocument.model+data"],["bmp","image/bmp"],["png","image/png"],["gif","image/gif"],["emf","image/x-emf"],["wmf","image/x-wmf"],["jpg","image/jpeg"],["jpeg","image/jpeg"],["tif","image/tiff"],["tiff","image/tiff"],["pdf","application/pdf"],["rels","application/vnd.openxmlformats-package.relationships+xml"]].map(function(e){return L6("Default",null,{Extension:e[0],ContentType:e[1]})}));var i=function(r){e[r]&&e[r].length>0&&(n=e[r][0],a[a.length]=L6("Override",null,{PartName:("/"==n[0]?"":"/")+n,ContentType:z7[r][t.bookType]||z7[r].xlsx}))},o=function(n){(e[n]||[]).forEach(function(e){a[a.length]=L6("Override",null,{PartName:("/"==e[0]?"":"/")+e,ContentType:z7[n][t.bookType]||z7[n].xlsx})})},s=function(t){(e[t]||[]).forEach(function(e){a[a.length]=L6("Override",null,{PartName:("/"==e[0]?"":"/")+e,ContentType:r[t][0]})})};return i("workbooks"),o("sheets"),o("charts"),s("themes"),["strs","styles"].forEach(i),["coreprops","extprops","custprops"].forEach(s),s("vba"),s("comments"),s("threadedcomments"),s("drawings"),o("metadata"),s("people"),a.length>2&&(a[a.length]="</Types>",a[1]=a[1].replace("/>",">")),a.join("")}var W7={WB:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/officeDocument",SHEET:"http://sheetjs.openxmlformats.org/officeDocument/2006/relationships/officeDocument",HLINK:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/hyperlink",VML:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/vmlDrawing",XPATH:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/externalLinkPath",XMISS:"http://schemas.microsoft.com/office/2006/relationships/xlExternalLinkPath/xlPathMissing",XLINK:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/externalLink",CXML:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/customXml",CXMLP:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/customXmlProps",CMNT:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/comments",CORE_PROPS:"http://schemas.openxmlformats.org/package/2006/relationships/metadata/core-properties",EXT_PROPS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/extended-properties",CUST_PROPS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/custom-properties",SST:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/sharedStrings",STY:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/styles",THEME:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/theme",CHART:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/chart",CHARTEX:"http://schemas.microsoft.com/office/2014/relationships/chartEx",CS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/chartsheet",WS:["http://schemas.openxmlformats.org/officeDocument/2006/relationships/worksheet","http://purl.oclc.org/ooxml/officeDocument/relationships/worksheet"],DS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/dialogsheet",MS:"http://schemas.microsoft.com/office/2006/relationships/xlMacrosheet",IMG:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/image",DRAW:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/drawing",XLMETA:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/sheetMetadata",TCMNT:"http://schemas.microsoft.com/office/2017/10/relationships/threadedComment",PEOPLE:"http://schemas.microsoft.com/office/2017/10/relationships/person",VBA:"http://schemas.microsoft.com/office/2006/relationships/vbaProject"};function V7(e){var t=e.lastIndexOf("/");return e.slice(0,t+1)+"_rels/"+e.slice(t+1)+".rels"}function H7(e){var t=[m6,L6("Relationships",null,{xmlns:U6})];return K5(e["!id"]).forEach(function(n){t[t.length]=L6("Relationship",null,e["!id"][n])}),t.length>2&&(t[t.length]="</Relationships>",t[1]=t[1].replace("/>",">")),t.join("")}function G7(e,t,n,r,a,i){if(a||(a={}),e["!id"]||(e["!id"]={}),e["!idx"]||(e["!idx"]=1),t<0)for(t=e["!idx"];e["!id"]["rId"+t];++t);if(e["!idx"]=t+1,a.Id="rId"+t,a.Type=r,a.Target=n,i?a.TargetMode=i:[W7.HLINK,W7.XPATH,W7.XMISS].indexOf(a.Type)>-1&&(a.TargetMode="External"),e["!id"][a.Id])throw new Error("Cannot rewrite rId "+t);return e["!id"][a.Id]=a,e[("/"+a.Target).replace("//","/")]=a,t}function q7(e,t,n){return['  <rdf:Description rdf:about="'+e+'">\n','    <rdf:type rdf:resource="http://docs.oasis-open.org/ns/office/1.2/meta/'+(n||"odf")+"#"+t+'"/>\n',"  </rdf:Description>\n"].join("")}function K7(e,t){return['  <rdf:Description rdf:about="'+e+'">\n','    <ns0:hasPart xmlns:ns0="http://docs.oasis-open.org/ns/office/1.2/meta/pkg#" rdf:resource="'+t+'"/>\n',"  </rdf:Description>\n"].join("")}function X7(){return'<office:document-meta xmlns:office="urn:oasis:names:tc:opendocument:xmlns:office:1.0" xmlns:meta="urn:oasis:names:tc:opendocument:xmlns:meta:1.0" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:xlink="http://www.w3.org/1999/xlink" office:version="1.2"><office:meta><meta:generator>SheetJS '+C3.version+"</meta:generator></office:meta></office:document-meta>"}var Y7=[["cp:category","Category"],["cp:contentStatus","ContentStatus"],["cp:keywords","Keywords"],["cp:lastModifiedBy","LastAuthor"],["cp:lastPrinted","LastPrinted"],["cp:revision","RevNumber"],["cp:version","Version"],["dc:creator","Author"],["dc:description","Comments"],["dc:identifier","Identifier"],["dc:language","Language"],["dc:subject","Subject"],["dc:title","Title"],["dcterms:created","CreatedDate","date"],["dcterms:modified","ModifiedDate","date"]];function $7(e,t,n,r,a){null==a[e]&&null!=t&&""!==t&&(a[e]=t,t=x6(t),r[r.length]=n?L6(e,t,n):D6(e,t))}function J7(e,t){var n=t||{},r=[m6,L6("cp:coreProperties",null,{"xmlns:cp":M6,"xmlns:dc":V6,"xmlns:dcterms":H6,"xmlns:dcmitype":G6,"xmlns:xsi":X6})],a={};if(!e&&!n.Props)return r.join("");e&&(null!=e.CreatedDate&&$7("dcterms:created","string"===typeof e.CreatedDate?e.CreatedDate:P6(e.CreatedDate,n.WTF),{"xsi:type":"dcterms:W3CDTF"},r,a),null!=e.ModifiedDate&&$7("dcterms:modified","string"===typeof e.ModifiedDate?e.ModifiedDate:P6(e.ModifiedDate,n.WTF),{"xsi:type":"dcterms:W3CDTF"},r,a));for(var i=0;i!=Y7.length;++i){var o=Y7[i],s=n.Props&&null!=n.Props[o[1]]?n.Props[o[1]]:e?e[o[1]]:null;!0===s?s="1":!1===s?s="0":"number"==typeof s&&(s=String(s)),null!=s&&$7(o[0],s,null,r,a)}return r.length>2&&(r[r.length]="</cp:coreProperties>",r[1]=r[1].replace("/>",">")),r.join("")}var Q7=[["Application","Application","string"],["AppVersion","AppVersion","string"],["Company","Company","string"],["DocSecurity","DocSecurity","string"],["Manager","Manager","string"],["HyperlinksChanged","HyperlinksChanged","bool"],["SharedDoc","SharedDoc","bool"],["LinksUpToDate","LinksUpToDate","bool"],["ScaleCrop","ScaleCrop","bool"],["HeadingPairs","HeadingPairs","raw"],["TitlesOfParts","TitlesOfParts","raw"]],Z7=["Worksheets","SheetNames","NamedRanges","DefinedNames","Chartsheets","ChartNames"];function e9(e){var t=[],n=L6;return e||(e={}),e.Application="SheetJS",t[t.length]=m6,t[t.length]=L6("Properties",null,{xmlns:B6,"xmlns:vt":K6}),Q7.forEach(function(r){if(void 0!==e[r[1]]){var a;switch(r[2]){case"string":a=x6(String(e[r[1]]));break;case"bool":a=e[r[1]]?"true":"false"}void 0!==a&&(t[t.length]=n(r[0],a))}}),t[t.length]=n("HeadingPairs",n("vt:vector",n("vt:variant","<vt:lpstr>Worksheets</vt:lpstr>")+n("vt:variant",n("vt:i4",String(e.Worksheets))),{size:2,baseType:"variant"})),t[t.length]=n("TitlesOfParts",n("vt:vector",e.SheetNames.map(function(e){return"<vt:lpstr>"+x6(e)+"</vt:lpstr>"}).join(""),{size:e.Worksheets,baseType:"lpstr"})),t.length>2&&(t[t.length]="</Properties>",t[1]=t[1].replace("/>",">")),t.join("")}function t9(e){var t=[m6,L6("Properties",null,{xmlns:j6,"xmlns:vt":K6})];if(!e)return t.join("");var n=1;return K5(e).forEach(function(r){++n,t[t.length]=L6("property",function(e,t){switch(typeof e){case"string":var n=L6("vt:lpwstr",x6(e));return t&&(n=n.replace(/&quot;/g,"_x0022_")),n;case"number":return L6((0|e)==e?"vt:i4":"vt:r8",x6(String(e)));case"boolean":return L6("vt:bool",e?"true":"false")}if(e instanceof Date)return L6("vt:filetime",P6(e));throw new Error("Unable to serialize "+e)}(e[r],!0),{fmtid:"{D5CDD505-2E9C-101B-9397-08002B2CF9AE}",pid:n,name:x6(r)})}),t.length>2&&(t[t.length]="</Properties>",t[1]=t[1].replace("/>",">")),t.join("")}var n9={Title:"Title",Subject:"Subject",Author:"Author",Keywords:"Keywords",Comments:"Description",LastAuthor:"LastAuthor",RevNumber:"Revision",Application:"AppName",LastPrinted:"LastPrinted",CreatedDate:"Created",ModifiedDate:"LastSaved",Category:"Category",Manager:"Manager",Company:"Company",AppVersion:"Version",ContentStatus:"ContentStatus",Identifier:"Identifier",Language:"Language"};function r9(e,t){var n=z8(4),r=z8(4);switch(n.write_shift(4,80==e?31:e),e){case 3:r.write_shift(-4,t);break;case 5:(r=z8(8)).write_shift(8,t,"f");break;case 11:r.write_shift(4,t?1:0);break;case 64:r=function(e){var t=("string"==typeof e?new Date(Date.parse(e)):e).getTime()/1e3+11644473600,n=t%Math.pow(2,32),r=(t-n)/Math.pow(2,32);r*=1e7;var a=(n*=1e7)/Math.pow(2,32)|0;a>0&&(n%=Math.pow(2,32),r+=a);var i=z8(8);return i.write_shift(4,n),i.write_shift(4,r),i}(t);break;case 31:case 80:for((r=z8(4+2*(t.length+1)+(t.length%2?0:2))).write_shift(4,t.length+1),r.write_shift(0,t,"dbcs");r.l!=r.length;)r.write_shift(1,0);break;default:throw new Error("TypedPropertyValue unrecognized type "+e+" "+t)}return K3([n,r])}var a9=["CodePage","Thumbnail","_PID_LINKBASE","_PID_HLINKS","SystemIdentifier","FMTID"];function i9(e){switch(typeof e){case"boolean":return 11;case"number":return(0|e)==e?3:5;case"string":return 31;case"object":if(e instanceof Date)return 64}return-1}function o9(e,t,n){var r=z8(8),a=[],i=[],o=8,s=0,c=z8(8),l=z8(8);if(c.write_shift(4,2),c.write_shift(4,1200),l.write_shift(4,1),i.push(c),a.push(l),o+=8+c.length,!t){(l=z8(8)).write_shift(4,0),a.unshift(l);var u=[z8(4)];for(u[0].write_shift(4,e.length),s=0;s<e.length;++s){var h=e[s][0];for((c=z8(8+2*(h.length+1)+(h.length%2?0:2))).write_shift(4,s+2),c.write_shift(4,h.length+1),c.write_shift(0,h,"dbcs");c.l!=c.length;)c.write_shift(1,0);u.push(c)}c=K3(u),i.unshift(c),o+=8+c.length}for(s=0;s<e.length;++s)if((!t||t[e[s][0]])&&!(a9.indexOf(e[s][0])>-1||Z7.indexOf(e[s][0])>-1)&&null!=e[s][1]){var d=e[s][1],f=0;if(t){var p=n[f=+t[e[s][0]]];if("version"==p.p&&"string"==typeof d){var m=d.split(".");d=(+m[0]<<16)+(+m[1]||0)}c=r9(p.t,d)}else{var g=i9(d);-1==g&&(g=31,d=String(d)),c=r9(g,d)}i.push(c),(l=z8(8)).write_shift(4,t?f:2+s),a.push(l),o+=8+c.length}var v=8*(i.length+1);for(s=0;s<i.length;++s)a[s].write_shift(4,v),v+=i[s].length;return r.write_shift(4,o),r.write_shift(4,i.length),K3([r].concat(a).concat(i))}function s9(e,t,n,r,a,i){var o=z8(a?68:48),s=[o];o.write_shift(2,65534),o.write_shift(2,0),o.write_shift(4,842412599),o.write_shift(16,V5.utils.consts.HEADER_CLSID,"hex"),o.write_shift(4,a?2:1),o.write_shift(16,t,"hex"),o.write_shift(4,a?68:48);var c=o9(e,n,r);if(s.push(c),a){var l=o9(a,null,null);o.write_shift(16,i,"hex"),o.write_shift(4,68+c.length),s.push(l)}return K3(s)}function c9(e,t){return 1===e.read_shift(t)}function l9(e,t){return t||(t=z8(2)),t.write_shift(2,+!!e),t}function u9(e){return e.read_shift(2,"u")}function h9(e,t){return t||(t=z8(2)),t.write_shift(2,e),t}function d9(e,t,n){return n||(n=z8(2)),n.write_shift(1,"e"==t?+e:+!!e),n.write_shift(1,"e"==t?1:0),n}function f9(e,t,n){var r=e.read_shift(n&&n.biff>=12?2:1),a="sbcs-cont",i=E3;(n&&n.biff>=8&&(E3=1200),n&&8!=n.biff)?12==n.biff&&(a="wstr"):e.read_shift(1)&&(a="dbcs-cont");n.biff>=2&&n.biff<=5&&(a="cpstr");var o=r?e.read_shift(r,a):"";return E3=i,o}function p9(e){var t=e.t||"",n=z8(3);n.write_shift(2,t.length),n.write_shift(1,1);var r=z8(2*t.length);return r.write_shift(2*t.length,t,"utf16le"),K3([n,r])}function m9(e,t,n){if(n){if(n.biff>=2&&n.biff<=5)return e.read_shift(t,"cpstr");if(n.biff>=12)return e.read_shift(t,"dbcs-cont")}return 0===e.read_shift(1)?e.read_shift(t,"sbcs-cont"):e.read_shift(t,"dbcs-cont")}function g9(e,t,n){var r=e.read_shift(n&&2==n.biff?1:2);return 0===r?(e.l++,""):m9(e,r,n)}function v9(e,t,n){if(n.biff>5)return g9(e,0,n);var r=e.read_shift(1);return 0===r?(e.l++,""):e.read_shift(r,n.biff<=4||!e.lens?"cpstr":"sbcs-cont")}function b9(e,t,n){return n||(n=z8(3+2*e.length)),n.write_shift(2,e.length),n.write_shift(1,1),n.write_shift(31,e,"utf16le"),n}function y9(e,t){t||(t=z8(6+2*e.length)),t.write_shift(4,1+e.length);for(var n=0;n<e.length;++n)t.write_shift(2,e.charCodeAt(n));return t.write_shift(2,0),t}function x9(e){var t=z8(512),n=0,r=e.Target;"file://"==r.slice(0,7)&&(r=r.slice(7));var a=r.indexOf("#"),i=a>-1?31:23;switch(r.charAt(0)){case"#":i=28;break;case".":i&=-3}t.write_shift(4,2),t.write_shift(4,i);var o=[8,6815827,6619237,4849780,83];for(n=0;n<o.length;++n)t.write_shift(4,o[n]);if(28==i)y9(r=r.slice(1),t);else if(2&i){for(o="e0 c9 ea 79 f9 ba ce 11 8c 82 00 aa 00 4b a9 0b".split(" "),n=0;n<o.length;++n)t.write_shift(1,parseInt(o[n],16));var s=a>-1?r.slice(0,a):r;for(t.write_shift(4,2*(s.length+1)),n=0;n<s.length;++n)t.write_shift(2,s.charCodeAt(n));t.write_shift(2,0),8&i&&y9(a>-1?r.slice(a+1):"",t)}else{for(o="03 03 00 00 00 00 00 00 c0 00 00 00 00 00 00 46".split(" "),n=0;n<o.length;++n)t.write_shift(1,parseInt(o[n],16));for(var c=0;"../"==r.slice(3*c,3*c+3)||"..\\"==r.slice(3*c,3*c+3);)++c;for(t.write_shift(2,c),t.write_shift(4,r.length-3*c+1),n=0;n<r.length-3*c;++n)t.write_shift(1,255&r.charCodeAt(n+3*c));for(t.write_shift(1,0),t.write_shift(2,65535),t.write_shift(2,57005),n=0;n<6;++n)t.write_shift(4,0)}return t.slice(0,t.l)}function w9(e,t,n,r){return r||(r=z8(6)),r.write_shift(2,e),r.write_shift(2,t),r.write_shift(2,n||0),r}function k9(e,t,n){var r=n.biff>8?4:2;return[e.read_shift(r),e.read_shift(r,"i"),e.read_shift(r,"i")]}function S9(e){var t=e.read_shift(2),n=e.read_shift(2);return{s:{c:e.read_shift(2),r:t},e:{c:e.read_shift(2),r:n}}}function N9(e,t){return t||(t=z8(8)),t.write_shift(2,e.s.r),t.write_shift(2,e.e.r),t.write_shift(2,e.s.c),t.write_shift(2,e.e.c),t}function C9(e,t,n){var r=1536,a=16;switch(n.bookType){case"biff8":case"xla":break;case"biff5":r=1280,a=8;break;case"biff4":r=4,a=6;break;case"biff3":r=3,a=6;break;case"biff2":r=2,a=4;break;default:throw new Error("unsupported BIFF version")}var i=z8(a);return i.write_shift(2,r),i.write_shift(2,t),a>4&&i.write_shift(2,29282),a>6&&i.write_shift(2,1997),a>8&&(i.write_shift(2,49161),i.write_shift(2,1),i.write_shift(2,1798),i.write_shift(2,0)),i}function E9(e,t){var n=!t||t.biff>=8?2:1,r=z8(8+n*e.name.length);r.write_shift(4,e.pos),r.write_shift(1,e.hs||0),r.write_shift(1,e.dt),r.write_shift(1,e.name.length),t.biff>=8&&r.write_shift(1,1),r.write_shift(n*e.name.length,e.name,t.biff<8?"sbcs":"utf16le");var a=r.slice(0,r.l);return a.l=r.l,a}function I9(e,t,n,r){var a=n&&5==n.biff;r||(r=z8(a?3+t.length:5+2*t.length)),r.write_shift(2,e),r.write_shift(a?1:2,t.length),a||r.write_shift(1,1),r.write_shift((a?1:2)*t.length,t,a?"sbcs":"utf16le");var i=r.length>r.l?r.slice(0,r.l):r;return null==i.l&&(i.l=i.length),i}function T9(e,t,n,r){var a=n&&5==n.biff;r||(r=z8(a?16:20)),r.write_shift(2,0),e.style?(r.write_shift(2,e.numFmtId||0),r.write_shift(2,65524)):(r.write_shift(2,e.numFmtId||0),r.write_shift(2,t<<4));var i=0;return e.numFmtId>0&&a&&(i|=1024),r.write_shift(4,i),r.write_shift(4,0),a||r.write_shift(4,0),r.write_shift(2,0),r}function _9(e,t,n){if(n.biff<8)return function(e,t,n){3==e[e.l+1]&&e[e.l]++;var r=f9(e,0,n);return 3==r.charCodeAt(0)?r.slice(1):r}(e,0,n);for(var r=[],a=e.l+t,i=e.read_shift(n.biff>8?4:2);0!==i--;)r.push(k9(e,n.biff,n));if(e.l!=a)throw new Error("Bad ExternSheet: "+e.l+" != "+a);return r}function A9(e){var t=z8(24),n=J8(e[0]);t.write_shift(2,n.r),t.write_shift(2,n.r),t.write_shift(2,n.c),t.write_shift(2,n.c);for(var r="d0 c9 ea 79 f9 ba ce 11 8c 82 00 aa 00 4b a9 0b".split(" "),a=0;a<16;++a)t.write_shift(1,parseInt(r[a],16));return K3([t,x9(e[1])])}function R9(e){var t=e[1].Tooltip,n=z8(10+2*(t.length+1));n.write_shift(2,2048);var r=J8(e[0]);n.write_shift(2,r.r),n.write_shift(2,r.r),n.write_shift(2,r.c),n.write_shift(2,r.c);for(var a=0;a<t.length;++a)n.write_shift(2,t.charCodeAt(a));return n.write_shift(2,0),n}function F9(e,t,n){if(!n.cellStyles)return B8(e,t);var r=n&&n.biff>=12?4:2,a=e.read_shift(r),i=e.read_shift(r),o=e.read_shift(r),s=e.read_shift(r),c=e.read_shift(2);2==r&&(e.l+=2);var l={s:a,e:i,w:o,ixfe:s,flags:c};return(n.biff>=5||!n.biff)&&(l.level=c>>8&7),l}var D9=function(){var e={1:437,2:850,3:1252,4:1e4,100:852,101:866,102:865,103:861,104:895,105:620,106:737,107:857,120:950,121:949,122:936,123:932,124:874,125:1255,126:1256,150:10007,151:10029,152:10006,200:1250,201:1251,202:1254,203:1253,0:20127,8:865,9:437,10:850,11:437,13:437,14:850,15:437,16:850,17:437,18:850,19:932,20:850,21:437,22:850,23:865,24:437,25:437,26:850,27:437,28:863,29:850,31:852,34:852,35:852,36:860,37:850,38:866,55:850,64:852,77:936,78:949,79:950,80:874,87:1252,88:1252,89:1252,108:863,134:737,135:852,136:857,204:1257,255:16969},t=Y5({1:437,2:850,3:1252,4:1e4,100:852,101:866,102:865,103:861,104:895,105:620,106:737,107:857,120:950,121:949,122:936,123:932,124:874,125:1255,126:1256,150:10007,151:10029,152:10006,200:1250,201:1251,202:1254,203:1253,0:20127});function n(t,n){var r=n||{};r.dateNF||(r.dateNF="yyyymmdd");var a=o7(function(t,n){var r=[],a=W3(1);switch(n.type){case"base64":a=H3(B3(t));break;case"binary":a=H3(t);break;case"buffer":case"array":a=t}j8(a,0);var i=a.read_shift(1),o=!!(136&i),s=!1,c=!1;switch(i){case 2:case 3:case 131:case 139:case 245:break;case 48:case 49:s=!0,o=!0;break;case 140:c=!0;break;default:throw new Error("DBF Unsupported Version: "+i.toString(16))}var l=0,u=521;2==i&&(l=a.read_shift(2)),a.l+=3,2!=i&&(l=a.read_shift(4)),l>1048576&&(l=1e6),2!=i&&(u=a.read_shift(2));var h=a.read_shift(2),d=n.codepage||1252;2!=i&&(a.l+=16,a.read_shift(1),0!==a[a.l]&&(d=e[a[a.l]]),a.l+=1,a.l+=2),c&&(a.l+=36);for(var f=[],p={},m=Math.min(a.length,2==i?521:u-10-(s?264:0)),g=c?32:11;a.l<m&&13!=a[a.l];)switch((p={}).name=O3.utils.decode(d,a.slice(a.l,a.l+g)).replace(/[\u0000\r\n].*$/g,""),a.l+=g,p.type=String.fromCharCode(a.read_shift(1)),2==i||c||(p.offset=a.read_shift(4)),p.len=a.read_shift(1),2==i&&(p.offset=a.read_shift(2)),p.dec=a.read_shift(1),p.name.length&&f.push(p),2!=i&&(a.l+=c?13:14),p.type){case"B":s&&8==p.len||!n.WTF||console.log("Skipping "+p.name+":"+p.type);break;case"G":case"P":n.WTF&&console.log("Skipping "+p.name+":"+p.type);break;case"+":case"0":case"@":case"C":case"D":case"F":case"I":case"L":case"M":case"N":case"O":case"T":case"Y":break;default:throw new Error("Unknown Field Type: "+p.type)}if(13!==a[a.l]&&(a.l=u-1),13!==a.read_shift(1))throw new Error("DBF Terminator not found "+a.l+" "+a[a.l]);a.l=u;var v=0,b=0;for(r[0]=[],b=0;b!=f.length;++b)r[0][b]=f[b].name;for(;l-- >0;)if(42!==a[a.l])for(++a.l,r[++v]=[],b=0,b=0;b!=f.length;++b){var y=a.slice(a.l,a.l+f[b].len);a.l+=f[b].len,j8(y,0);var x=O3.utils.decode(d,y);switch(f[b].type){case"C":x.trim().length&&(r[v][b]=x.replace(/\s+$/,""));break;case"D":8===x.length?r[v][b]=new Date(+x.slice(0,4),+x.slice(4,6)-1,+x.slice(6,8)):r[v][b]=x;break;case"F":r[v][b]=parseFloat(x.trim());break;case"+":case"I":r[v][b]=c?2147483648^y.read_shift(-4,"i"):y.read_shift(4,"i");break;case"L":switch(x.trim().toUpperCase()){case"Y":case"T":r[v][b]=!0;break;case"N":case"F":r[v][b]=!1;break;case"":case"?":break;default:throw new Error("DBF Unrecognized L:|"+x+"|")}break;case"M":if(!o)throw new Error("DBF Unexpected MEMO for type "+i.toString(16));r[v][b]="##MEMO##"+(c?parseInt(x.trim(),10):y.read_shift(4));break;case"N":(x=x.replace(/\u0000/g,"").trim())&&"."!=x&&(r[v][b]=+x||0);break;case"@":r[v][b]=new Date(y.read_shift(-8,"f")-621356832e5);break;case"T":r[v][b]=new Date(864e5*(y.read_shift(4)-2440588)+y.read_shift(4));break;case"Y":r[v][b]=y.read_shift(4,"i")/1e4+y.read_shift(4,"i")/1e4*Math.pow(2,32);break;case"O":r[v][b]=-y.read_shift(-8,"f");break;case"B":if(s&&8==f[b].len){r[v][b]=y.read_shift(8,"f");break}case"G":case"P":y.l+=f[b].len;break;case"0":if("_NullFlags"===f[b].name)break;default:throw new Error("DBF Unsupported data type "+f[b].type)}}else a.l+=h;if(2!=i&&a.l<a.length&&26!=a[a.l++])throw new Error("DBF EOF Marker missing "+(a.l-1)+" of "+a.length+" "+a[a.l-1].toString(16));return n&&n.sheetRows&&(r=r.slice(0,n.sheetRows)),n.DBF=f,r}(t,r),r);return a["!cols"]=r.DBF.map(function(e){return{wch:e.len,DBF:e}}),delete r.DBF,a}var r={B:8,C:250,L:1,D:8,"?":0,"":0};return{to_workbook:function(e,t){try{return a7(n(e,t),t)}catch(_a){if(t&&t.WTF)throw _a}return{SheetNames:[],Sheets:{}}},to_sheet:n,from_sheet:function(e,n){var a=n||{};if(+a.codepage>=0&&R3(+a.codepage),"string"==a.type)throw new Error("Cannot write DBF to JS string");var i=U8(),o=ere(e,{header:1,raw:!0,cellDates:!0}),s=o[0],c=o.slice(1),l=e["!cols"]||[],u=0,h=0,d=0,f=1;for(u=0;u<s.length;++u)if(((l[u]||{}).DBF||{}).name)s[u]=l[u].DBF.name,++d;else if(null!=s[u]){if(++d,"number"===typeof s[u]&&(s[u]=s[u].toString(10)),"string"!==typeof s[u])throw new Error("DBF Invalid column name "+s[u]+" |"+typeof s[u]+"|");if(s.indexOf(s[u])!==u)for(h=0;h<1024;++h)if(-1==s.indexOf(s[u]+"_"+h)){s[u]+="_"+h;break}}var p=t7(e["!ref"]),m=[],g=[],v=[];for(u=0;u<=p.e.c-p.s.c;++u){var b="",y="",x=0,w=[];for(h=0;h<c.length;++h)null!=c[h][u]&&w.push(c[h][u]);if(0!=w.length&&null!=s[u]){for(h=0;h<w.length;++h){switch(typeof w[h]){case"number":y="B";break;case"string":default:y="C";break;case"boolean":y="L";break;case"object":y=w[h]instanceof Date?"D":"C"}x=Math.max(x,String(w[h]).length),b=b&&b!=y?"C":y}x>250&&(x=250),"C"==(y=((l[u]||{}).DBF||{}).type)&&l[u].DBF.len>x&&(x=l[u].DBF.len),"B"==b&&"N"==y&&(b="N",v[u]=l[u].DBF.dec,x=l[u].DBF.len),g[u]="C"==b||"N"==y?x:r[b]||0,f+=g[u],m[u]=b}else m[u]="?"}var k=i.next(32);for(k.write_shift(4,318902576),k.write_shift(4,c.length),k.write_shift(2,296+32*d),k.write_shift(2,f),u=0;u<4;++u)k.write_shift(4,0);for(k.write_shift(4,(+t[I3]||3)<<8),u=0,h=0;u<s.length;++u)if(null!=s[u]){var S=i.next(32),N=(s[u].slice(-10)+"\0\0\0\0\0\0\0\0\0\0\0").slice(0,11);S.write_shift(1,N,"sbcs"),S.write_shift(1,"?"==m[u]?"C":m[u],"sbcs"),S.write_shift(4,h),S.write_shift(1,g[u]||r[m[u]]||0),S.write_shift(1,v[u]||0),S.write_shift(1,2),S.write_shift(4,0),S.write_shift(1,0),S.write_shift(4,0),S.write_shift(4,0),h+=g[u]||r[m[u]]||0}var C=i.next(264);for(C.write_shift(4,13),u=0;u<65;++u)C.write_shift(4,0);for(u=0;u<c.length;++u){var E=i.next(f);for(E.write_shift(1,0),h=0;h<s.length;++h)if(null!=s[h])switch(m[h]){case"L":E.write_shift(1,null==c[u][h]?63:c[u][h]?84:70);break;case"B":E.write_shift(8,c[u][h]||0,"f");break;case"N":var I="0";for("number"==typeof c[u][h]&&(I=c[u][h].toFixed(v[h]||0)),d=0;d<g[h]-I.length;++d)E.write_shift(1,32);E.write_shift(1,I,"sbcs");break;case"D":c[u][h]?(E.write_shift(4,("0000"+c[u][h].getFullYear()).slice(-4),"sbcs"),E.write_shift(2,("00"+(c[u][h].getMonth()+1)).slice(-2),"sbcs"),E.write_shift(2,("00"+c[u][h].getDate()).slice(-2),"sbcs")):E.write_shift(8,"00000000","sbcs");break;case"C":var T=String(null!=c[u][h]?c[u][h]:"").slice(0,g[h]);for(E.write_shift(1,T,"sbcs"),d=0;d<g[h]-T.length;++d)E.write_shift(1,32)}}return i.next(1).write_shift(1,26),i.end()}}}(),O9=function(){var e={AA:"\xc0",BA:"\xc1",CA:"\xc2",DA:195,HA:"\xc4",JA:197,AE:"\xc8",BE:"\xc9",CE:"\xca",HE:"\xcb",AI:"\xcc",BI:"\xcd",CI:"\xce",HI:"\xcf",AO:"\xd2",BO:"\xd3",CO:"\xd4",DO:213,HO:"\xd6",AU:"\xd9",BU:"\xda",CU:"\xdb",HU:"\xdc",Aa:"\xe0",Ba:"\xe1",Ca:"\xe2",Da:227,Ha:"\xe4",Ja:229,Ae:"\xe8",Be:"\xe9",Ce:"\xea",He:"\xeb",Ai:"\xec",Bi:"\xed",Ci:"\xee",Hi:"\xef",Ao:"\xf2",Bo:"\xf3",Co:"\xf4",Do:245,Ho:"\xf6",Au:"\xf9",Bu:"\xfa",Cu:"\xfb",Hu:"\xfc",KC:"\xc7",Kc:"\xe7",q:"\xe6",z:"\u0153",a:"\xc6",j:"\u0152",DN:209,Dn:241,Hy:255,S:169,c:170,R:174,"B ":180,0:176,1:177,2:178,3:179,5:181,6:182,7:183,Q:185,k:186,b:208,i:216,l:222,s:240,y:248,"!":161,'"':162,"#":163,"(":164,"%":165,"'":167,"H ":168,"+":171,";":187,"<":188,"=":189,">":190,"?":191,"{":223},t=new RegExp("\x1bN("+K5(e).join("|").replace(/\|\|\|/,"|\\||").replace(/([?()+])/g,"\\$1")+"|\\|)","gm"),n=function(t,n){var r=e[n];return"number"==typeof r?P3(r):r},r=function(e,t,n){var r=t.charCodeAt(0)-32<<4|n.charCodeAt(0)-48;return 59==r?e:P3(r)};function a(e,a){var i,o=e.split(/[\n\r]+/),s=-1,c=-1,l=0,u=0,h=[],d=[],f=null,p={},m=[],g=[],v=[],b=0;for(+a.codepage>=0&&R3(+a.codepage);l!==o.length;++l){b=0;var y,x=o[l].trim().replace(/\x1B([\x20-\x2F])([\x30-\x3F])/g,r).replace(t,n),w=x.replace(/;;/g,"\0").split(";").map(function(e){return e.replace(/\u0000/g,";")}),k=w[0];if(x.length>0)switch(k){case"ID":case"E":case"B":case"O":case"W":break;case"P":"P"==w[1].charAt(0)&&d.push(x.slice(3).replace(/;;/g,";"));break;case"C":var S=!1,N=!1,C=!1,E=!1,I=-1,T=-1;for(u=1;u<w.length;++u)switch(w[u].charAt(0)){case"A":case"G":break;case"X":c=parseInt(w[u].slice(1))-1,N=!0;break;case"Y":for(s=parseInt(w[u].slice(1))-1,N||(c=0),i=h.length;i<=s;++i)h[i]=[];break;case"K":'"'===(y=w[u].slice(1)).charAt(0)?y=y.slice(1,y.length-1):"TRUE"===y?y=!0:"FALSE"===y?y=!1:isNaN(u6(y))?isNaN(d6(y).getDate())||(y=o6(y)):(y=u6(y),null!==f&&D5(f)&&(y=n6(y))),"undefined"!==typeof O3&&"string"==typeof y&&"string"!=(a||{}).type&&(a||{}).codepage&&(y=O3.utils.decode(a.codepage,y)),S=!0;break;case"E":E=!0;var _=Cee(w[u].slice(1),{r:s,c:c});h[s][c]=[h[s][c],_];break;case"S":C=!0,h[s][c]=[h[s][c],"S5S"];break;case"R":I=parseInt(w[u].slice(1))-1;break;case"C":T=parseInt(w[u].slice(1))-1;break;default:if(a&&a.WTF)throw new Error("SYLK bad record "+x)}if(S&&(h[s][c]&&2==h[s][c].length?h[s][c][0]=y:h[s][c]=y,f=null),C){if(E)throw new Error("SYLK shared formula cannot have own formula");var A=I>-1&&h[I][T];if(!A||!A[1])throw new Error("SYLK shared formula cannot find base");h[s][c][1]=Tee(A[1],{r:s-I,c:c-T})}break;case"F":var R=0;for(u=1;u<w.length;++u)switch(w[u].charAt(0)){case"X":c=parseInt(w[u].slice(1))-1,++R;break;case"Y":for(s=parseInt(w[u].slice(1))-1,i=h.length;i<=s;++i)h[i]=[];break;case"M":b=parseInt(w[u].slice(1))/20;break;case"F":case"G":case"S":case"D":case"N":break;case"P":f=d[parseInt(w[u].slice(1))];break;case"W":for(v=w[u].slice(1).split(" "),i=parseInt(v[0],10);i<=parseInt(v[1],10);++i)b=parseInt(v[2],10),g[i-1]=0===b?{hidden:!0}:{wch:b},J9(g[i-1]);break;case"C":g[c=parseInt(w[u].slice(1))-1]||(g[c]={});break;case"R":m[s=parseInt(w[u].slice(1))-1]||(m[s]={}),b>0?(m[s].hpt=b,m[s].hpx=eee(b)):0===b&&(m[s].hidden=!0);break;default:if(a&&a.WTF)throw new Error("SYLK bad record "+x)}R<1&&(f=null);break;default:if(a&&a.WTF)throw new Error("SYLK bad record "+x)}}return m.length>0&&(p["!rows"]=m),g.length>0&&(p["!cols"]=g),a&&a.sheetRows&&(h=h.slice(0,a.sheetRows)),[h,p]}function i(e,t){var n=function(e,t){switch(t.type){case"base64":return a(B3(e),t);case"binary":return a(e,t);case"buffer":return a(z3&&Buffer.isBuffer(e)?e.toString("binary"):q3(e),t);case"array":return a(s6(e),t)}throw new Error("Unrecognized type "+t.type)}(e,t),r=n[0],i=n[1],o=o7(r,t);return K5(i).forEach(function(e){o[e]=i[e]}),o}function o(e,t,n,r){var a="C;Y"+(n+1)+";X"+(r+1)+";K";switch(e.t){case"n":a+=e.v||0,e.f&&!e.F&&(a+=";E"+Iee(e.f,{r:n,c:r}));break;case"b":a+=e.v?"TRUE":"FALSE";break;case"e":a+=e.w||e.v;break;case"d":a+='"'+(e.w||e.v)+'"';break;case"s":a+='"'+e.v.replace(/"/g,"").replace(/;/g,";;")+'"'}return a}return e["|"]=254,{to_workbook:function(e,t){return a7(i(e,t),t)},to_sheet:i,from_sheet:function(e,t){var n,r,a=["ID;PWXL;N;E"],i=[],s=t7(e["!ref"]),c=Array.isArray(e),l="\r\n";a.push("P;PGeneral"),a.push("F;P0;DG0G8;M255"),e["!cols"]&&(r=a,e["!cols"].forEach(function(e,t){var n="F;W"+(t+1)+" "+(t+1)+" ";e.hidden?n+="0":("number"!=typeof e.width||e.wpx||(e.wpx=X9(e.width)),"number"!=typeof e.wpx||e.wch||(e.wch=Y9(e.wpx)),"number"==typeof e.wch&&(n+=Math.round(e.wch)))," "!=n.charAt(n.length-1)&&r.push(n)})),e["!rows"]&&function(e,t){t.forEach(function(t,n){var r="F;";t.hidden?r+="M0;":t.hpt?r+="M"+20*t.hpt+";":t.hpx&&(r+="M"+20*Z9(t.hpx)+";"),r.length>2&&e.push(r+"R"+(n+1))})}(a,e["!rows"]),a.push("B;Y"+(s.e.r-s.s.r+1)+";X"+(s.e.c-s.s.c+1)+";D"+[s.s.c,s.s.r,s.e.c,s.e.r].join(" "));for(var u=s.s.r;u<=s.e.r;++u)for(var h=s.s.c;h<=s.e.c;++h){var d=Q8({r:u,c:h});(n=c?(e[u]||[])[h]:e[d])&&(null!=n.v||n.f&&!n.F)&&i.push(o(n,0,u,h))}return a.join(l)+l+i.join(l)+l+"E"+l}}}(),L9=function(){function e(e,t){for(var n=e.split("\n"),r=-1,a=-1,i=0,o=[];i!==n.length;++i)if("BOT"!==n[i].trim()){if(!(r<0)){for(var s=n[i].trim().split(","),c=s[0],l=s[1],u=n[++i]||"";1&(u.match(/["]/g)||[]).length&&i<n.length-1;)u+="\n"+n[++i];switch(u=u.trim(),+c){case-1:if("BOT"===u){o[++r]=[],a=0;continue}if("EOD"!==u)throw new Error("Unrecognized DIF special command "+u);break;case 0:"TRUE"===u?o[r][a]=!0:"FALSE"===u?o[r][a]=!1:isNaN(u6(l))?isNaN(d6(l).getDate())?o[r][a]=l:o[r][a]=o6(l):o[r][a]=u6(l),++a;break;case 1:(u=(u=u.slice(1,u.length-1)).replace(/""/g,'"'))&&u.match(/^=".*"$/)&&(u=u.slice(2,-1)),o[r][a++]=""!==u?u:null}if("EOD"===u)break}}else o[++r]=[],a=0;return t&&t.sheetRows&&(o=o.slice(0,t.sheetRows)),o}function t(t,n){return o7(function(t,n){switch(n.type){case"base64":return e(B3(t),n);case"binary":return e(t,n);case"buffer":return e(z3&&Buffer.isBuffer(t)?t.toString("binary"):q3(t),n);case"array":return e(s6(t),n)}throw new Error("Unrecognized type "+n.type)}(t,n),n)}var n=function(){var e=function(e,t,n,r,a){e.push(t),e.push(n+","+r),e.push('"'+a.replace(/"/g,'""')+'"')},t=function(e,t,n,r){e.push(t+","+n),e.push(1==t?'"'+r.replace(/"/g,'""')+'"':r)};return function(n){var r,a=[],i=t7(n["!ref"]),o=Array.isArray(n);e(a,"TABLE",0,1,"sheetjs"),e(a,"VECTORS",0,i.e.r-i.s.r+1,""),e(a,"TUPLES",0,i.e.c-i.s.c+1,""),e(a,"DATA",0,0,"");for(var s=i.s.r;s<=i.e.r;++s){t(a,-1,0,"BOT");for(var c=i.s.c;c<=i.e.c;++c){var l=Q8({r:s,c:c});if(r=o?(n[s]||[])[c]:n[l])switch(r.t){case"n":var u=r.w;u||null==r.v||(u=r.v),null==u?r.f&&!r.F?t(a,1,0,"="+r.f):t(a,1,0,""):t(a,0,u,"V");break;case"b":t(a,0,r.v?1:0,r.v?"TRUE":"FALSE");break;case"s":t(a,1,0,isNaN(r.v)?r.v:'="'+r.v+'"');break;case"d":r.w||(r.w=M5(r.z||i5[14],Q5(o6(r.v)))),t(a,0,r.w,"V");break;default:t(a,1,0,"")}else t(a,1,0,"")}}t(a,-1,0,"EOD");return a.join("\r\n")}}();return{to_workbook:function(e,n){return a7(t(e,n),n)},to_sheet:t,from_sheet:n}}(),P9=function(){function e(e){return e.replace(/\\b/g,"\\").replace(/\\c/g,":").replace(/\\n/g,"\n")}function t(e){return e.replace(/\\/g,"\\b").replace(/:/g,"\\c").replace(/\n/g,"\\n")}function n(t,n){return o7(function(t,n){for(var r=t.split("\n"),a=-1,i=-1,o=0,s=[];o!==r.length;++o){var c=r[o].trim().split(":");if("cell"===c[0]){var l=J8(c[1]);if(s.length<=l.r)for(a=s.length;a<=l.r;++a)s[a]||(s[a]=[]);switch(a=l.r,i=l.c,c[2]){case"t":s[a][i]=e(c[3]);break;case"v":s[a][i]=+c[3];break;case"vtf":var u=c[c.length-1];case"vtc":"nl"===c[3]?s[a][i]=!!+c[4]:s[a][i]=+c[4],"vtf"==c[2]&&(s[a][i]=[s[a][i],u])}}}return n&&n.sheetRows&&(s=s.slice(0,n.sheetRows)),s}(t,n),n)}var r=["socialcalc:version:1.5","MIME-Version: 1.0","Content-Type: multipart/mixed; boundary=SocialCalcSpreadsheetControlSave"].join("\n"),a=["--SocialCalcSpreadsheetControlSave","Content-type: text/plain; charset=UTF-8"].join("\n")+"\n",i=["# SocialCalc Spreadsheet Control Save","part:sheet"].join("\n"),o="--SocialCalcSpreadsheetControlSave--";function s(e){if(!e||!e["!ref"])return"";for(var n,r=[],a=[],i="",o=Z8(e["!ref"]),s=Array.isArray(e),c=o.s.r;c<=o.e.r;++c)for(var l=o.s.c;l<=o.e.c;++l)if(i=Q8({r:c,c:l}),(n=s?(e[c]||[])[l]:e[i])&&null!=n.v&&"z"!==n.t){switch(a=["cell",i,"t"],n.t){case"s":case"str":a.push(t(n.v));break;case"n":n.f?(a[2]="vtf",a[3]="n",a[4]=n.v,a[5]=t(n.f)):(a[2]="v",a[3]=n.v);break;case"b":a[2]="vt"+(n.f?"f":"c"),a[3]="nl",a[4]=n.v?"1":"0",a[5]=t(n.f||(n.v?"TRUE":"FALSE"));break;case"d":var u=Q5(o6(n.v));a[2]="vtc",a[3]="nd",a[4]=""+u,a[5]=n.w||M5(n.z||i5[14],u);break;case"e":continue}r.push(a.join(":"))}return r.push("sheet:c:"+(o.e.c-o.s.c+1)+":r:"+(o.e.r-o.s.r+1)+":tvf:1"),r.push("valueformat:1:text-wiki"),r.join("\n")}return{to_workbook:function(e,t){return a7(n(e,t),t)},to_sheet:n,from_sheet:function(e){return[r,a,i,a,s(e),o].join("\n")}}}(),M9=function(){function e(e,t,n,r,a){a.raw?t[n][r]=e:""===e||("TRUE"===e?t[n][r]=!0:"FALSE"===e?t[n][r]=!1:isNaN(u6(e))?isNaN(d6(e).getDate())?t[n][r]=e:t[n][r]=o6(e):t[n][r]=u6(e))}var t={44:",",9:"\t",59:";",124:"|"},n={44:3,9:2,59:1,124:0};function r(e){for(var r={},a=!1,i=0,o=0;i<e.length;++i)34==(o=e.charCodeAt(i))?a=!a:!a&&o in t&&(r[o]=(r[o]||0)+1);for(i in o=[],r)Object.prototype.hasOwnProperty.call(r,i)&&o.push([r[i],i]);if(!o.length)for(i in r=n)Object.prototype.hasOwnProperty.call(r,i)&&o.push([r[i],i]);return o.sort(function(e,t){return e[0]-t[0]||n[e[1]]-n[t[1]]}),t[o.pop()[1]]||44}function a(e,t){var n=t||{},a="";var i=n.dense?[]:{},o={s:{c:0,r:0},e:{c:0,r:0}};"sep="==e.slice(0,4)?13==e.charCodeAt(5)&&10==e.charCodeAt(6)?(a=e.charAt(4),e=e.slice(7)):13==e.charCodeAt(5)||10==e.charCodeAt(5)?(a=e.charAt(4),e=e.slice(6)):a=r(e.slice(0,1024)):a=n&&n.FS?n.FS:r(e.slice(0,1024));var s=0,c=0,l=0,u=0,h=0,d=a.charCodeAt(0),f=!1,p=0,m=e.charCodeAt(0);e=e.replace(/\r\n/gm,"\n");var g=null!=n.dateNF?function(e){var t="number"==typeof e?i5[e]:e;return t=t.replace(U5,"(\\d+)"),new RegExp("^"+t+"$")}(n.dateNF):null;function v(){var t=e.slice(u,h),r={};if('"'==t.charAt(0)&&'"'==t.charAt(t.length-1)&&(t=t.slice(1,-1).replace(/""/g,'"')),0===t.length)r.t="z";else if(n.raw)r.t="s",r.v=t;else if(0===t.trim().length)r.t="s",r.v=t;else if(61==t.charCodeAt(0))34==t.charCodeAt(1)&&34==t.charCodeAt(t.length-1)?(r.t="s",r.v=t.slice(2,-1).replace(/""/g,'"')):!function(e){return 1!=e.length}(t)?(r.t="s",r.v=t):(r.t="n",r.f=t.slice(1));else if("TRUE"==t)r.t="b",r.v=!0;else if("FALSE"==t)r.t="b",r.v=!1;else if(isNaN(l=u6(t)))if(!isNaN(d6(t).getDate())||g&&t.match(g)){r.z=n.dateNF||i5[14];var a=0;g&&t.match(g)&&(t=function(e,t,n){var r=-1,a=-1,i=-1,o=-1,s=-1,c=-1;(t.match(U5)||[]).forEach(function(e,t){var l=parseInt(n[t+1],10);switch(e.toLowerCase().charAt(0)){case"y":r=l;break;case"d":i=l;break;case"h":o=l;break;case"s":c=l;break;case"m":o>=0?s=l:a=l}}),c>=0&&-1==s&&a>=0&&(s=a,a=-1);var l=(""+(r>=0?r:(new Date).getFullYear())).slice(-4)+"-"+("00"+(a>=1?a:1)).slice(-2)+"-"+("00"+(i>=1?i:1)).slice(-2);7==l.length&&(l="0"+l),8==l.length&&(l="20"+l);var u=("00"+(o>=0?o:0)).slice(-2)+":"+("00"+(s>=0?s:0)).slice(-2)+":"+("00"+(c>=0?c:0)).slice(-2);return-1==o&&-1==s&&-1==c?l:-1==r&&-1==a&&-1==i?u:l+"T"+u}(0,n.dateNF,t.match(g)||[]),a=1),n.cellDates?(r.t="d",r.v=o6(t,a)):(r.t="n",r.v=Q5(o6(t,a))),!1!==n.cellText&&(r.w=M5(r.z,r.v instanceof Date?Q5(r.v):r.v)),n.cellNF||delete r.z}else r.t="s",r.v=t;else r.t="n",!1!==n.cellText&&(r.w=t),r.v=l;if("z"==r.t||(n.dense?(i[s]||(i[s]=[]),i[s][c]=r):i[Q8({c:c,r:s})]=r),u=h+1,m=e.charCodeAt(u),o.e.c<c&&(o.e.c=c),o.e.r<s&&(o.e.r=s),p==d)++c;else if(c=0,++s,n.sheetRows&&n.sheetRows<=s)return!0}e:for(;h<e.length;++h)switch(p=e.charCodeAt(h)){case 34:34===m&&(f=!f);break;case d:case 10:case 13:if(!f&&v())break e}return h-u>0&&v(),i["!ref"]=e7(o),i}function i(t,n){return n&&n.PRN?n.FS||"sep="==t.slice(0,4)||t.indexOf("\t")>=0||t.indexOf(",")>=0||t.indexOf(";")>=0?a(t,n):o7(function(t,n){var r=n||{},a=[];if(!t||0===t.length)return a;for(var i=t.split(/[\r\n]/),o=i.length-1;o>=0&&0===i[o].length;)--o;for(var s=10,c=0,l=0;l<=o;++l)-1==(c=i[l].indexOf(" "))?c=i[l].length:c++,s=Math.max(s,c);for(l=0;l<=o;++l){a[l]=[];var u=0;for(e(i[l].slice(0,s).trim(),a,l,u,r),u=1;u<=(i[l].length-s)/10+1;++u)e(i[l].slice(s+10*(u-1),s+10*u).trim(),a,l,u,r)}return r.sheetRows&&(a=a.slice(0,r.sheetRows)),a}(t,n),n):a(t,n)}function o(e,t){var n="",r="string"==t.type?[0,0,0,0]:qne(e,t);switch(t.type){case"base64":n=B3(e);break;case"binary":case"string":n=e;break;case"buffer":n=65001==t.codepage?e.toString("utf8"):t.codepage&&"undefined"!==typeof O3?O3.utils.decode(t.codepage,e):z3&&Buffer.isBuffer(e)?e.toString("binary"):q3(e);break;case"array":n=s6(e);break;default:throw new Error("Unrecognized type "+t.type)}return 239==r[0]&&187==r[1]&&191==r[2]?n=_6(n.slice(3)):"string"!=t.type&&"buffer"!=t.type&&65001==t.codepage?n=_6(n):"binary"==t.type&&"undefined"!==typeof O3&&t.codepage&&(n=O3.utils.decode(t.codepage,O3.utils.encode(28591,n))),"socialcalc:version:"==n.slice(0,19)?P9.to_sheet("string"==t.type?n:_6(n),t):i(n,t)}return{to_workbook:function(e,t){return a7(o(e,t),t)},to_sheet:o,from_sheet:function(e){for(var t,n=[],r=t7(e["!ref"]),a=Array.isArray(e),i=r.s.r;i<=r.e.r;++i){for(var o=[],s=r.s.c;s<=r.e.c;++s){var c=Q8({r:i,c:s});if((t=a?(e[i]||[])[s]:e[c])&&null!=t.v){for(var l=(t.w||(r7(t),t.w)||"").slice(0,10);l.length<10;)l+=" ";o.push(l+(0===s?" ":""))}else o.push("          ")}n.push(o.join(""))}return n.join("\n")}}}();var j9=function(){function e(e,t,n){if(e){j8(e,e.l||0);for(var r=n.Enum||v;e.l<e.length;){var a=e.read_shift(2),i=r[a]||r[65535],o=e.read_shift(2),s=e.l+o,c=i.f&&i.f(e,o,n);if(e.l=s,t(c,i,a))return}}}function t(t,n){if(!t)return t;var r=n||{};var a=r.dense?[]:{},i="Sheet1",o="",s=0,c={},l=[],u=[],h={s:{r:0,c:0},e:{r:0,c:0}},d=r.sheetRows||0;if(0==t[2]&&(8==t[3]||9==t[3])&&t.length>=16&&5==t[14]&&108===t[15])throw new Error("Unsupported Works 3 for Mac file");if(2==t[2])r.Enum=v,e(t,function(e,t,n){switch(n){case 0:r.vers=e,e>=4096&&(r.qpro=!0);break;case 6:h=e;break;case 204:e&&(o=e);break;case 222:o=e;break;case 15:case 51:r.qpro||(e[1].v=e[1].v.slice(1));case 13:case 14:case 16:14==n&&112==(112&e[2])&&(15&e[2])>1&&(15&e[2])<15&&(e[1].z=r.dateNF||i5[14],r.cellDates&&(e[1].t="d",e[1].v=n6(e[1].v))),r.qpro&&e[3]>s&&(a["!ref"]=e7(h),c[i]=a,l.push(i),a=r.dense?[]:{},h={s:{r:0,c:0},e:{r:0,c:0}},s=e[3],i=o||"Sheet"+(s+1),o="");var u=r.dense?(a[e[0].r]||[])[e[0].c]:a[Q8(e[0])];if(u){u.t=e[1].t,u.v=e[1].v,null!=e[1].z&&(u.z=e[1].z),null!=e[1].f&&(u.f=e[1].f);break}r.dense?(a[e[0].r]||(a[e[0].r]=[]),a[e[0].r][e[0].c]=e[1]):a[Q8(e[0])]=e[1]}},r);else{if(26!=t[2]&&14!=t[2])throw new Error("Unrecognized LOTUS BOF "+t[2]);r.Enum=b,14==t[2]&&(r.qpro=!0,t.l=0),e(t,function(e,t,n){switch(n){case 204:i=e;break;case 22:e[1].v=e[1].v.slice(1);case 23:case 24:case 25:case 37:case 39:case 40:if(e[3]>s&&(a["!ref"]=e7(h),c[i]=a,l.push(i),a=r.dense?[]:{},h={s:{r:0,c:0},e:{r:0,c:0}},s=e[3],i="Sheet"+(s+1)),d>0&&e[0].r>=d)break;r.dense?(a[e[0].r]||(a[e[0].r]=[]),a[e[0].r][e[0].c]=e[1]):a[Q8(e[0])]=e[1],h.e.c<e[0].c&&(h.e.c=e[0].c),h.e.r<e[0].r&&(h.e.r=e[0].r);break;case 27:e[14e3]&&(u[e[14e3][0]]=e[14e3][1]);break;case 1537:u[e[0]]=e[1],e[0]==s&&(i=e[1])}},r)}if(a["!ref"]=e7(h),c[o||i]=a,l.push(o||i),!u.length)return{SheetNames:l,Sheets:c};for(var f={},p=[],m=0;m<u.length;++m)c[l[m]]?(p.push(u[m]||l[m]),f[u[m]]=c[u[m]]||c[l[m]]):(p.push(u[m]),f[u[m]]={"!ref":"A1"});return{SheetNames:p,Sheets:f}}function n(e,t,n){var r=[{c:0,r:0},{t:"n",v:0},0,0];return n.qpro&&20768!=n.vers?(r[0].c=e.read_shift(1),r[3]=e.read_shift(1),r[0].r=e.read_shift(2),e.l+=2):(r[2]=e.read_shift(1),r[0].c=e.read_shift(2),r[0].r=e.read_shift(2)),r}function r(e,t,r){var a=e.l+t,i=n(e,0,r);if(i[1].t="s",20768==r.vers){e.l++;var o=e.read_shift(1);return i[1].v=e.read_shift(o,"utf8"),i}return r.qpro&&e.l++,i[1].v=e.read_shift(a-e.l,"cstr"),i}function a(e,t,n){var r=z8(7+n.length);r.write_shift(1,255),r.write_shift(2,t),r.write_shift(2,e),r.write_shift(1,39);for(var a=0;a<r.length;++a){var i=n.charCodeAt(a);r.write_shift(1,i>=128?95:i)}return r.write_shift(1,0),r}function i(e,t,n){var r=z8(7);return r.write_shift(1,255),r.write_shift(2,t),r.write_shift(2,e),r.write_shift(2,n,"i"),r}function o(e,t,n){var r=z8(13);return r.write_shift(1,255),r.write_shift(2,t),r.write_shift(2,e),r.write_shift(8,n,"f"),r}function s(e,t,n){var r=32768&t;return t=(r?e:0)+((t&=-32769)>=8192?t-16384:t),(r?"":"$")+(n?$8(t):X8(t))}var c={51:["FALSE",0],52:["TRUE",0],70:["LEN",1],80:["SUM",69],81:["AVERAGEA",69],82:["COUNTA",69],83:["MINA",69],84:["MAXA",69],111:["T",1]},l=["","","","","","","","","","+","-","*","/","^","=","<>","<=",">=","<",">","","","","","&","","","","","","",""];function u(e){var t=[{c:0,r:0},{t:"n",v:0},0];return t[0].r=e.read_shift(2),t[3]=e[e.l++],t[0].c=e[e.l++],t}function h(e,t,n,r){var a=z8(6+r.length);a.write_shift(2,e),a.write_shift(1,n),a.write_shift(1,t),a.write_shift(1,39);for(var i=0;i<r.length;++i){var o=r.charCodeAt(i);a.write_shift(1,o>=128?95:o)}return a.write_shift(1,0),a}function d(e,t){var n=u(e),r=e.read_shift(4),a=e.read_shift(4),i=e.read_shift(2);if(65535==i)return 0===r&&3221225472===a?(n[1].t="e",n[1].v=15):0===r&&3489660928===a?(n[1].t="e",n[1].v=42):n[1].v=0,n;var o=32768&i;return i=(32767&i)-16446,n[1].v=(1-2*o)*(a*Math.pow(2,i+32)+r*Math.pow(2,i)),n}function f(e,t,n,r){var a=z8(14);if(a.write_shift(2,e),a.write_shift(1,n),a.write_shift(1,t),0==r)return a.write_shift(4,0),a.write_shift(4,0),a.write_shift(2,65535),a;var i,o=0,s=0,c=0;return r<0&&(o=1,r=-r),s=0|Math.log2(r),0==(2147483648&(c=(r/=Math.pow(2,s-31))>>>0))&&(++s,c=(r/=2)>>>0),r-=c,c|=2147483648,c>>>=0,i=(r*=Math.pow(2,32))>>>0,a.write_shift(4,i),a.write_shift(4,c),s+=16383+(o?32768:0),a.write_shift(2,s),a}function p(e,t){var n=u(e),r=e.read_shift(8,"f");return n[1].v=r,n}function m(e,t){return 0==e[e.l+t-1]?e.read_shift(t,"cstr"):""}function g(e,t){var n=z8(5+e.length);n.write_shift(2,14e3),n.write_shift(2,t);for(var r=0;r<e.length;++r){var a=e.charCodeAt(r);n[n.l++]=a>127?95:a}return n[n.l++]=0,n}var v={0:{n:"BOF",f:u9},1:{n:"EOF"},2:{n:"CALCMODE"},3:{n:"CALCORDER"},4:{n:"SPLIT"},5:{n:"SYNC"},6:{n:"RANGE",f:function(e,t,n){var r={s:{c:0,r:0},e:{c:0,r:0}};return 8==t&&n.qpro?(r.s.c=e.read_shift(1),e.l++,r.s.r=e.read_shift(2),r.e.c=e.read_shift(1),e.l++,r.e.r=e.read_shift(2),r):(r.s.c=e.read_shift(2),r.s.r=e.read_shift(2),12==t&&n.qpro&&(e.l+=2),r.e.c=e.read_shift(2),r.e.r=e.read_shift(2),12==t&&n.qpro&&(e.l+=2),65535==r.s.c&&(r.s.c=r.e.c=r.s.r=r.e.r=0),r)}},7:{n:"WINDOW1"},8:{n:"COLW1"},9:{n:"WINTWO"},10:{n:"COLW2"},11:{n:"NAME"},12:{n:"BLANK"},13:{n:"INTEGER",f:function(e,t,r){var a=n(e,0,r);return a[1].v=e.read_shift(2,"i"),a}},14:{n:"NUMBER",f:function(e,t,r){var a=n(e,0,r);return a[1].v=e.read_shift(8,"f"),a}},15:{n:"LABEL",f:r},16:{n:"FORMULA",f:function(e,t,r){var a=e.l+t,i=n(e,0,r);if(i[1].v=e.read_shift(8,"f"),r.qpro)e.l=a;else{var o=e.read_shift(2);!function(e,t){j8(e,0);var n=[],r=0,a="",i="",o="",u="";for(;e.l<e.length;){var h=e[e.l++];switch(h){case 0:n.push(e.read_shift(8,"f"));break;case 1:i=s(t[0].c,e.read_shift(2),!0),a=s(t[0].r,e.read_shift(2),!1),n.push(i+a);break;case 2:var d=s(t[0].c,e.read_shift(2),!0),f=s(t[0].r,e.read_shift(2),!1);i=s(t[0].c,e.read_shift(2),!0),a=s(t[0].r,e.read_shift(2),!1),n.push(d+f+":"+i+a);break;case 3:if(e.l<e.length)return void console.error("WK1 premature formula end");break;case 4:n.push("("+n.pop()+")");break;case 5:n.push(e.read_shift(2));break;case 6:for(var p="";h=e[e.l++];)p+=String.fromCharCode(h);n.push('"'+p.replace(/"/g,'""')+'"');break;case 8:n.push("-"+n.pop());break;case 23:n.push("+"+n.pop());break;case 22:n.push("NOT("+n.pop()+")");break;case 20:case 21:u=n.pop(),o=n.pop(),n.push(["AND","OR"][h-20]+"("+o+","+u+")");break;default:if(h<32&&l[h])u=n.pop(),o=n.pop(),n.push(o+l[h]+u);else{if(!c[h])return h<=7?console.error("WK1 invalid opcode "+h.toString(16)):h<=24?console.error("WK1 unsupported op "+h.toString(16)):h<=30?console.error("WK1 invalid opcode "+h.toString(16)):h<=115?console.error("WK1 unsupported function opcode "+h.toString(16)):console.error("WK1 unrecognized opcode "+h.toString(16));if(69==(r=c[h][1])&&(r=e[e.l++]),r>n.length)return void console.error("WK1 bad formula parse 0x"+h.toString(16)+":|"+n.join("|")+"|");var m=n.slice(-r);n.length-=r,n.push(c[h][0]+"("+m.join(",")+")")}}}1==n.length?t[1].f=""+n[0]:console.error("WK1 bad formula parse |"+n.join("|")+"|")}(e.slice(e.l,e.l+o),i),e.l+=o}return i}},24:{n:"TABLE"},25:{n:"ORANGE"},26:{n:"PRANGE"},27:{n:"SRANGE"},28:{n:"FRANGE"},29:{n:"KRANGE1"},32:{n:"HRANGE"},35:{n:"KRANGE2"},36:{n:"PROTEC"},37:{n:"FOOTER"},38:{n:"HEADER"},39:{n:"SETUP"},40:{n:"MARGINS"},41:{n:"LABELFMT"},42:{n:"TITLES"},43:{n:"SHEETJS"},45:{n:"GRAPH"},46:{n:"NGRAPH"},47:{n:"CALCCOUNT"},48:{n:"UNFORMATTED"},49:{n:"CURSORW12"},50:{n:"WINDOW"},51:{n:"STRING",f:r},55:{n:"PASSWORD"},56:{n:"LOCKED"},60:{n:"QUERY"},61:{n:"QUERYNAME"},62:{n:"PRINT"},63:{n:"PRINTNAME"},64:{n:"GRAPH2"},65:{n:"GRAPHNAME"},66:{n:"ZOOM"},67:{n:"SYMSPLIT"},68:{n:"NSROWS"},69:{n:"NSCOLS"},70:{n:"RULER"},71:{n:"NNAME"},72:{n:"ACOMM"},73:{n:"AMACRO"},74:{n:"PARSE"},102:{n:"PRANGES??"},103:{n:"RRANGES??"},104:{n:"FNAME??"},105:{n:"MRANGES??"},204:{n:"SHEETNAMECS",f:m},222:{n:"SHEETNAMELP",f:function(e,t){var n=e[e.l++];n>t-1&&(n=t-1);for(var r="";r.length<n;)r+=String.fromCharCode(e[e.l++]);return r}},65535:{n:""}},b={0:{n:"BOF"},1:{n:"EOF"},2:{n:"PASSWORD"},3:{n:"CALCSET"},4:{n:"WINDOWSET"},5:{n:"SHEETCELLPTR"},6:{n:"SHEETLAYOUT"},7:{n:"COLUMNWIDTH"},8:{n:"HIDDENCOLUMN"},9:{n:"USERRANGE"},10:{n:"SYSTEMRANGE"},11:{n:"ZEROFORCE"},12:{n:"SORTKEYDIR"},13:{n:"FILESEAL"},14:{n:"DATAFILLNUMS"},15:{n:"PRINTMAIN"},16:{n:"PRINTSTRING"},17:{n:"GRAPHMAIN"},18:{n:"GRAPHSTRING"},19:{n:"??"},20:{n:"ERRCELL"},21:{n:"NACELL"},22:{n:"LABEL16",f:function(e,t){var n=u(e);return n[1].t="s",n[1].v=e.read_shift(t-4,"cstr"),n}},23:{n:"NUMBER17",f:d},24:{n:"NUMBER18",f:function(e,t){var n=u(e);n[1].v=e.read_shift(2);var r=n[1].v>>1;if(1&n[1].v)switch(7&r){case 0:r=5e3*(r>>3);break;case 1:r=500*(r>>3);break;case 2:r=(r>>3)/20;break;case 3:r=(r>>3)/200;break;case 4:r=(r>>3)/2e3;break;case 5:r=(r>>3)/2e4;break;case 6:r=(r>>3)/16;break;case 7:r=(r>>3)/64}return n[1].v=r,n}},25:{n:"FORMULA19",f:function(e,t){var n=d(e);return e.l+=t-14,n}},26:{n:"FORMULA1A"},27:{n:"XFORMAT",f:function(e,t){for(var n={},r=e.l+t;e.l<r;){var a=e.read_shift(2);if(14e3==a){for(n[a]=[0,""],n[a][0]=e.read_shift(2);e[e.l];)n[a][1]+=String.fromCharCode(e[e.l]),e.l++;e.l++}}return n}},28:{n:"DTLABELMISC"},29:{n:"DTLABELCELL"},30:{n:"GRAPHWINDOW"},31:{n:"CPA"},32:{n:"LPLAUTO"},33:{n:"QUERY"},34:{n:"HIDDENSHEET"},35:{n:"??"},37:{n:"NUMBER25",f:function(e,t){var n=u(e),r=e.read_shift(4);return n[1].v=r>>6,n}},38:{n:"??"},39:{n:"NUMBER27",f:p},40:{n:"FORMULA28",f:function(e,t){var n=p(e);return e.l+=t-10,n}},142:{n:"??"},147:{n:"??"},150:{n:"??"},151:{n:"??"},152:{n:"??"},153:{n:"??"},154:{n:"??"},155:{n:"??"},156:{n:"??"},163:{n:"??"},174:{n:"??"},175:{n:"??"},176:{n:"??"},177:{n:"??"},184:{n:"??"},185:{n:"??"},186:{n:"??"},187:{n:"??"},188:{n:"??"},195:{n:"??"},201:{n:"??"},204:{n:"SHEETNAMECS",f:m},205:{n:"??"},206:{n:"??"},207:{n:"??"},208:{n:"??"},256:{n:"??"},259:{n:"??"},260:{n:"??"},261:{n:"??"},262:{n:"??"},263:{n:"??"},265:{n:"??"},266:{n:"??"},267:{n:"??"},268:{n:"??"},270:{n:"??"},271:{n:"??"},384:{n:"??"},389:{n:"??"},390:{n:"??"},393:{n:"??"},396:{n:"??"},512:{n:"??"},514:{n:"??"},513:{n:"??"},516:{n:"??"},517:{n:"??"},640:{n:"??"},641:{n:"??"},642:{n:"??"},643:{n:"??"},644:{n:"??"},645:{n:"??"},646:{n:"??"},647:{n:"??"},648:{n:"??"},658:{n:"??"},659:{n:"??"},660:{n:"??"},661:{n:"??"},662:{n:"??"},665:{n:"??"},666:{n:"??"},768:{n:"??"},772:{n:"??"},1537:{n:"SHEETINFOQP",f:function(e,t,n){if(n.qpro&&!(t<21)){var r=e.read_shift(1);return e.l+=17,e.l+=1,e.l+=2,[r,e.read_shift(t-21,"cstr")]}}},1600:{n:"??"},1602:{n:"??"},1793:{n:"??"},1794:{n:"??"},1795:{n:"??"},1796:{n:"??"},1920:{n:"??"},2048:{n:"??"},2049:{n:"??"},2052:{n:"??"},2688:{n:"??"},10998:{n:"??"},12849:{n:"??"},28233:{n:"??"},28484:{n:"??"},65535:{n:""}};return{sheet_to_wk1:function(e,t){var n=t||{};if(+n.codepage>=0&&R3(+n.codepage),"string"==n.type)throw new Error("Cannot write WK1 to JS string");var r=U8(),s=t7(e["!ref"]),c=Array.isArray(e),l=[];ane(r,0,function(e){var t=z8(2);return t.write_shift(2,e),t}(1030)),ane(r,6,function(e){var t=z8(8);return t.write_shift(2,e.s.c),t.write_shift(2,e.s.r),t.write_shift(2,e.e.c),t.write_shift(2,e.e.r),t}(s));for(var u=Math.min(s.e.r,8191),h=s.s.r;h<=u;++h)for(var d=X8(h),f=s.s.c;f<=s.e.c;++f){h===s.s.r&&(l[f]=$8(f));var p=l[f]+d,m=c?(e[h]||[])[f]:e[p];if(m&&"z"!=m.t)if("n"==m.t)(0|m.v)==m.v&&m.v>=-32768&&m.v<=32767?ane(r,13,i(h,f,m.v)):ane(r,14,o(h,f,m.v));else ane(r,15,a(h,f,r7(m).slice(0,239)))}return ane(r,1),r.end()},book_to_wk3:function(e,t){var n=t||{};if(+n.codepage>=0&&R3(+n.codepage),"string"==n.type)throw new Error("Cannot write WK3 to JS string");var r=U8();ane(r,0,function(e){var t=z8(26);t.write_shift(2,4096),t.write_shift(2,4),t.write_shift(4,0);for(var n=0,r=0,a=0,i=0;i<e.SheetNames.length;++i){var o=e.SheetNames[i],s=e.Sheets[o];if(s&&s["!ref"]){++a;var c=Z8(s["!ref"]);n<c.e.r&&(n=c.e.r),r<c.e.c&&(r=c.e.c)}}n>8191&&(n=8191);return t.write_shift(2,n),t.write_shift(1,a),t.write_shift(1,r),t.write_shift(2,0),t.write_shift(2,0),t.write_shift(1,1),t.write_shift(1,2),t.write_shift(4,0),t.write_shift(4,0),t}(e));for(var a=0,i=0;a<e.SheetNames.length;++a)(e.Sheets[e.SheetNames[a]]||{})["!ref"]&&ane(r,27,g(e.SheetNames[a],i++));var o=0;for(a=0;a<e.SheetNames.length;++a){var s=e.Sheets[e.SheetNames[a]];if(s&&s["!ref"]){for(var c=t7(s["!ref"]),l=Array.isArray(s),u=[],d=Math.min(c.e.r,8191),p=c.s.r;p<=d;++p)for(var m=X8(p),v=c.s.c;v<=c.e.c;++v){p===c.s.r&&(u[v]=$8(v));var b=u[v]+m,y=l?(s[p]||[])[v]:s[b];if(y&&"z"!=y.t)if("n"==y.t)ane(r,23,f(p,v,o,y.v));else ane(r,22,h(p,v,o,r7(y).slice(0,239)))}++o}}return ane(r,1),r.end()},to_workbook:function(e,n){switch(n.type){case"base64":return t(H3(B3(e)),n);case"binary":return t(H3(e),n);case"buffer":case"array":return t(e,n)}throw"Unsupported type "+n.type}}}();var B9=/^\s|\s$|[\t\n\r]/;function z9(e,t){if(!t.bookSST)return"";var n=[m6];n[n.length]=L6("sst",null,{xmlns:$6[0],count:e.Count,uniqueCount:e.Unique});for(var r=0;r!=e.length;++r)if(null!=e[r]){var a=e[r],i="<si>";a.r?i+=a.r:(i+="<t",a.t||(a.t=""),a.t.match(B9)&&(i+=' xml:space="preserve"'),i+=">"+x6(a.t)+"</t>"),i+="</si>",n[n.length]=i}return n.length>2&&(n[n.length]="</sst>",n[1]=n[1].replace("/>",">")),n.join("")}var U9=function(e,t){var n=!1;return null==t&&(n=!0,t=z8(15+4*e.t.length)),t.write_shift(1,0),l7(e.t,t),n?t.slice(0,t.l):t};function W9(e){var t=U8();W8(t,159,function(e,t){return t||(t=z8(8)),t.write_shift(4,e.Count),t.write_shift(4,e.Unique),t}(e));for(var n=0;n<e.length;++n)W8(t,19,U9(e[n]));return W8(t,160),t.end()}function V9(e){if("undefined"!==typeof O3)return O3.utils.encode(I3,e);for(var t=[],n=e.split(""),r=0;r<n.length;++r)t[r]=n[r].charCodeAt(0);return t}function H9(e){var t,n,r=0,a=V9(e),i=a.length+1;for((t=W3(i))[0]=a.length,n=1;n!=i;++n)t[n]=a[n-1];for(n=i-1;n>=0;--n)r=((0===(16384&r)?0:1)|r<<1&32767)^t[n];return 52811^r}var G9=function(){function e(e,n){switch(n.type){case"base64":return t(B3(e),n);case"binary":return t(e,n);case"buffer":return t(z3&&Buffer.isBuffer(e)?e.toString("binary"):q3(e),n);case"array":return t(s6(e),n)}throw new Error("Unrecognized type "+n.type)}function t(e,t){var n=(t||{}).dense?[]:{},r=e.match(/\\trowd.*?\\row\b/g);if(!r.length)throw new Error("RTF missing table");var a={s:{c:0,r:0},e:{c:0,r:r.length-1}};return r.forEach(function(e,t){Array.isArray(n)&&(n[t]=[]);for(var r,i=/\\\w+\b/g,o=0,s=-1;r=i.exec(e);){if("\\cell"===r[0]){var c=e.slice(o,i.lastIndex-r[0].length);if(" "==c[0]&&(c=c.slice(1)),++s,c.length){var l={v:c,t:"s"};Array.isArray(n)?n[t][s]=l:n[Q8({r:t,c:s})]=l}}o=i.lastIndex}s>a.e.c&&(a.e.c=s)}),n["!ref"]=e7(a),n}return{to_workbook:function(t,n){return a7(e(t,n),n)},to_sheet:e,from_sheet:function(e){for(var t,n=["{\\rtf1\\ansi"],r=t7(e["!ref"]),a=Array.isArray(e),i=r.s.r;i<=r.e.r;++i){n.push("\\trowd\\trautofit1");for(var o=r.s.c;o<=r.e.c;++o)n.push("\\cellx"+(o+1));for(n.push("\\pard\\intbl"),o=r.s.c;o<=r.e.c;++o){var s=Q8({r:i,c:o});(t=a?(e[i]||[])[o]:e[s])&&(null!=t.v||t.f&&!t.F)&&(n.push(" "+(t.w||(r7(t),t.w))),n.push("\\cell"))}n.push("\\pard\\intbl\\row")}return n.join("")+"}"}}}();function q9(e){for(var t=0,n=1;3!=t;++t)n=256*n+(e[t]>255?255:e[t]<0?0:e[t]);return n.toString(16).toUpperCase().slice(1)}var K9=6;function X9(e){return Math.floor((e+Math.round(128/K9)/256)*K9)}function Y9(e){return Math.floor((e-5)/K9*100+.5)/100}function $9(e){return Math.round((e*K9+5)/K9*256)/256}function J9(e){e.width?(e.wpx=X9(e.width),e.wch=Y9(e.wpx),e.MDW=K9):e.wpx?(e.wch=Y9(e.wpx),e.width=$9(e.wch),e.MDW=K9):"number"==typeof e.wch&&(e.width=$9(e.wch),e.wpx=X9(e.width),e.MDW=K9),e.customWidth&&delete e.customWidth}var Q9=96;function Z9(e){return 96*e/Q9}function eee(e){return e*Q9/96}function tee(e,t){var n,r=[m6,L6("styleSheet",null,{xmlns:$6[0],"xmlns:vt":K6})];return e.SSF&&null!=(n=function(e){var t=["<numFmts>"];return[[5,8],[23,26],[41,44],[50,392]].forEach(function(n){for(var r=n[0];r<=n[1];++r)null!=e[r]&&(t[t.length]=L6("numFmt",null,{numFmtId:r,formatCode:x6(e[r])}))}),1===t.length?"":(t[t.length]="</numFmts>",t[0]=L6("numFmts",null,{count:t.length-2}).replace("/>",">"),t.join(""))}(e.SSF))&&(r[r.length]=n),r[r.length]='<fonts count="1"><font><sz val="12"/><color theme="1"/><name val="Calibri"/><family val="2"/><scheme val="minor"/></font></fonts>',r[r.length]='<fills count="2"><fill><patternFill patternType="none"/></fill><fill><patternFill patternType="gray125"/></fill></fills>',r[r.length]='<borders count="1"><border><left/><right/><top/><bottom/><diagonal/></border></borders>',r[r.length]='<cellStyleXfs count="1"><xf numFmtId="0" fontId="0" fillId="0" borderId="0"/></cellStyleXfs>',(n=function(e){var t=[];return t[t.length]=L6("cellXfs",null),e.forEach(function(e){t[t.length]=L6("xf",null,e)}),t[t.length]="</cellXfs>",2===t.length?"":(t[0]=L6("cellXfs",null,{count:t.length-2}).replace("/>",">"),t.join(""))}(t.cellXfs))&&(r[r.length]=n),r[r.length]='<cellStyles count="1"><cellStyle name="Normal" xfId="0" builtinId="0"/></cellStyles>',r[r.length]='<dxfs count="0"/>',r[r.length]='<tableStyles count="0" defaultTableStyle="TableStyleMedium9" defaultPivotStyle="PivotStyleMedium4"/>',r.length>2&&(r[r.length]="</styleSheet>",r[1]=r[1].replace("/>",">")),r.join("")}function nee(e,t,n){n||(n=z8(6+4*t.length)),n.write_shift(2,e),l7(t,n);var r=n.length>n.l?n.slice(0,n.l):n;return null==n.l&&(n.l=n.length),r}function ree(e,t){t||(t=z8(153)),t.write_shift(2,20*e.sz),function(e,t){t||(t=z8(2));var n=(e.italic?2:0)|(e.strike?8:0)|(e.outline?16:0)|(e.shadow?32:0)|(e.condense?64:0)|(e.extend?128:0);t.write_shift(1,n),t.write_shift(1,0)}(e,t),t.write_shift(2,e.bold?700:400);var n=0;"superscript"==e.vertAlign?n=1:"subscript"==e.vertAlign&&(n=2),t.write_shift(2,n),t.write_shift(1,e.underline||0),t.write_shift(1,e.family||0),t.write_shift(1,e.charset||0),t.write_shift(1,0),F7(e.color,t);var r=0;return"major"==e.scheme&&(r=1),"minor"==e.scheme&&(r=2),t.write_shift(1,r),l7(e.name,t),t.length>t.l?t.slice(0,t.l):t}var aee,iee=["none","solid","mediumGray","darkGray","lightGray","darkHorizontal","darkVertical","darkDown","darkUp","darkGrid","darkTrellis","lightHorizontal","lightVertical","lightDown","lightUp","lightGrid","lightTrellis","gray125","gray0625"],oee=B8;function see(e,t){t||(t=z8(84)),aee||(aee=Y5(iee));var n=aee[e.patternType];null==n&&(n=40),t.write_shift(4,n);var r=0;if(40!=n)for(F7({auto:1},t),F7({auto:1},t);r<12;++r)t.write_shift(4,0);else{for(;r<4;++r)t.write_shift(4,0);for(;r<12;++r)t.write_shift(4,0)}return t.length>t.l?t.slice(0,t.l):t}function cee(e,t,n){n||(n=z8(16)),n.write_shift(2,t||0),n.write_shift(2,e.numFmtId||0),n.write_shift(2,0),n.write_shift(2,0),n.write_shift(2,0),n.write_shift(1,0),n.write_shift(1,0);return n.write_shift(1,0),n.write_shift(1,0),n.write_shift(1,0),n.write_shift(1,0),n}function lee(e,t){return t||(t=z8(10)),t.write_shift(1,0),t.write_shift(1,0),t.write_shift(4,0),t.write_shift(4,0),t}var uee=B8;function hee(e){W8(e,613,s7(1)),W8(e,46,function(e,t){return t||(t=z8(51)),t.write_shift(1,0),lee(0,t),lee(0,t),lee(0,t),lee(0,t),lee(0,t),t.length>t.l?t.slice(0,t.l):t}()),W8(e,614)}function dee(e){W8(e,619,s7(1)),W8(e,48,function(e,t){return t||(t=z8(52)),t.write_shift(4,e.xfId),t.write_shift(2,1),t.write_shift(1,+e.builtinId),t.write_shift(1,0),w7(e.name||"",t),t.length>t.l?t.slice(0,t.l):t}({xfId:0,builtinId:0,name:"Normal"})),W8(e,620)}function fee(e){W8(e,508,function(e,t,n){var r=z8(2052);return r.write_shift(4,e),w7(t,r),w7(n,r),r.length>r.l?r.slice(0,r.l):r}(0,"TableStyleMedium9","PivotStyleMedium4")),W8(e,509)}function pee(e,t){var n=U8();return W8(n,278),function(e,t){if(t){var n=0;[[5,8],[23,26],[41,44],[50,392]].forEach(function(e){for(var r=e[0];r<=e[1];++r)null!=t[r]&&++n}),0!=n&&(W8(e,615,s7(n)),[[5,8],[23,26],[41,44],[50,392]].forEach(function(n){for(var r=n[0];r<=n[1];++r)null!=t[r]&&W8(e,44,nee(r,t[r]))}),W8(e,616))}}(n,e.SSF),function(e){W8(e,611,s7(1)),W8(e,43,ree({sz:12,color:{theme:1},name:"Calibri",family:2,scheme:"minor"})),W8(e,612)}(n),function(e){W8(e,603,s7(2)),W8(e,45,see({patternType:"none"})),W8(e,45,see({patternType:"gray125"})),W8(e,604)}(n),hee(n),function(e){W8(e,626,s7(1)),W8(e,47,cee({numFmtId:0,fontId:0,fillId:0,borderId:0},65535)),W8(e,627)}(n),function(e,t){W8(e,617,s7(t.length)),t.forEach(function(t){W8(e,47,cee(t,0))}),W8(e,618)}(n,t.cellXfs),dee(n),function(e){W8(e,505,s7(0)),W8(e,506)}(n),fee(n),W8(n,279),n.end()}function mee(e,t){if(t&&t.themeXLSX)return t.themeXLSX;if(e&&"string"==typeof e.raw)return e.raw;var n=[m6];return n[n.length]='<a:theme xmlns:a="http://schemas.openxmlformats.org/drawingml/2006/main" name="Office Theme">',n[n.length]="<a:themeElements>",n[n.length]='<a:clrScheme name="Office">',n[n.length]='<a:dk1><a:sysClr val="windowText" lastClr="000000"/></a:dk1>',n[n.length]='<a:lt1><a:sysClr val="window" lastClr="FFFFFF"/></a:lt1>',n[n.length]='<a:dk2><a:srgbClr val="1F497D"/></a:dk2>',n[n.length]='<a:lt2><a:srgbClr val="EEECE1"/></a:lt2>',n[n.length]='<a:accent1><a:srgbClr val="4F81BD"/></a:accent1>',n[n.length]='<a:accent2><a:srgbClr val="C0504D"/></a:accent2>',n[n.length]='<a:accent3><a:srgbClr val="9BBB59"/></a:accent3>',n[n.length]='<a:accent4><a:srgbClr val="8064A2"/></a:accent4>',n[n.length]='<a:accent5><a:srgbClr val="4BACC6"/></a:accent5>',n[n.length]='<a:accent6><a:srgbClr val="F79646"/></a:accent6>',n[n.length]='<a:hlink><a:srgbClr val="0000FF"/></a:hlink>',n[n.length]='<a:folHlink><a:srgbClr val="800080"/></a:folHlink>',n[n.length]="</a:clrScheme>",n[n.length]='<a:fontScheme name="Office">',n[n.length]="<a:majorFont>",n[n.length]='<a:latin typeface="Cambria"/>',n[n.length]='<a:ea typeface=""/>',n[n.length]='<a:cs typeface=""/>',n[n.length]='<a:font script="Jpan" typeface="\uff2d\uff33 \uff30\u30b4\u30b7\u30c3\u30af"/>',n[n.length]='<a:font script="Hang" typeface="\ub9d1\uc740 \uace0\ub515"/>',n[n.length]='<a:font script="Hans" typeface="\u5b8b\u4f53"/>',n[n.length]='<a:font script="Hant" typeface="\u65b0\u7d30\u660e\u9ad4"/>',n[n.length]='<a:font script="Arab" typeface="Times New Roman"/>',n[n.length]='<a:font script="Hebr" typeface="Times New Roman"/>',n[n.length]='<a:font script="Thai" typeface="Tahoma"/>',n[n.length]='<a:font script="Ethi" typeface="Nyala"/>',n[n.length]='<a:font script="Beng" typeface="Vrinda"/>',n[n.length]='<a:font script="Gujr" typeface="Shruti"/>',n[n.length]='<a:font script="Khmr" typeface="MoolBoran"/>',n[n.length]='<a:font script="Knda" typeface="Tunga"/>',n[n.length]='<a:font script="Guru" typeface="Raavi"/>',n[n.length]='<a:font script="Cans" typeface="Euphemia"/>',n[n.length]='<a:font script="Cher" typeface="Plantagenet Cherokee"/>',n[n.length]='<a:font script="Yiii" typeface="Microsoft Yi Baiti"/>',n[n.length]='<a:font script="Tibt" typeface="Microsoft Himalaya"/>',n[n.length]='<a:font script="Thaa" typeface="MV Boli"/>',n[n.length]='<a:font script="Deva" typeface="Mangal"/>',n[n.length]='<a:font script="Telu" typeface="Gautami"/>',n[n.length]='<a:font script="Taml" typeface="Latha"/>',n[n.length]='<a:font script="Syrc" typeface="Estrangelo Edessa"/>',n[n.length]='<a:font script="Orya" typeface="Kalinga"/>',n[n.length]='<a:font script="Mlym" typeface="Kartika"/>',n[n.length]='<a:font script="Laoo" typeface="DokChampa"/>',n[n.length]='<a:font script="Sinh" typeface="Iskoola Pota"/>',n[n.length]='<a:font script="Mong" typeface="Mongolian Baiti"/>',n[n.length]='<a:font script="Viet" typeface="Times New Roman"/>',n[n.length]='<a:font script="Uigh" typeface="Microsoft Uighur"/>',n[n.length]='<a:font script="Geor" typeface="Sylfaen"/>',n[n.length]="</a:majorFont>",n[n.length]="<a:minorFont>",n[n.length]='<a:latin typeface="Calibri"/>',n[n.length]='<a:ea typeface=""/>',n[n.length]='<a:cs typeface=""/>',n[n.length]='<a:font script="Jpan" typeface="\uff2d\uff33 \uff30\u30b4\u30b7\u30c3\u30af"/>',n[n.length]='<a:font script="Hang" typeface="\ub9d1\uc740 \uace0\ub515"/>',n[n.length]='<a:font script="Hans" typeface="\u5b8b\u4f53"/>',n[n.length]='<a:font script="Hant" typeface="\u65b0\u7d30\u660e\u9ad4"/>',n[n.length]='<a:font script="Arab" typeface="Arial"/>',n[n.length]='<a:font script="Hebr" typeface="Arial"/>',n[n.length]='<a:font script="Thai" typeface="Tahoma"/>',n[n.length]='<a:font script="Ethi" typeface="Nyala"/>',n[n.length]='<a:font script="Beng" typeface="Vrinda"/>',n[n.length]='<a:font script="Gujr" typeface="Shruti"/>',n[n.length]='<a:font script="Khmr" typeface="DaunPenh"/>',n[n.length]='<a:font script="Knda" typeface="Tunga"/>',n[n.length]='<a:font script="Guru" typeface="Raavi"/>',n[n.length]='<a:font script="Cans" typeface="Euphemia"/>',n[n.length]='<a:font script="Cher" typeface="Plantagenet Cherokee"/>',n[n.length]='<a:font script="Yiii" typeface="Microsoft Yi Baiti"/>',n[n.length]='<a:font script="Tibt" typeface="Microsoft Himalaya"/>',n[n.length]='<a:font script="Thaa" typeface="MV Boli"/>',n[n.length]='<a:font script="Deva" typeface="Mangal"/>',n[n.length]='<a:font script="Telu" typeface="Gautami"/>',n[n.length]='<a:font script="Taml" typeface="Latha"/>',n[n.length]='<a:font script="Syrc" typeface="Estrangelo Edessa"/>',n[n.length]='<a:font script="Orya" typeface="Kalinga"/>',n[n.length]='<a:font script="Mlym" typeface="Kartika"/>',n[n.length]='<a:font script="Laoo" typeface="DokChampa"/>',n[n.length]='<a:font script="Sinh" typeface="Iskoola Pota"/>',n[n.length]='<a:font script="Mong" typeface="Mongolian Baiti"/>',n[n.length]='<a:font script="Viet" typeface="Arial"/>',n[n.length]='<a:font script="Uigh" typeface="Microsoft Uighur"/>',n[n.length]='<a:font script="Geor" typeface="Sylfaen"/>',n[n.length]="</a:minorFont>",n[n.length]="</a:fontScheme>",n[n.length]='<a:fmtScheme name="Office">',n[n.length]="<a:fillStyleLst>",n[n.length]='<a:solidFill><a:schemeClr val="phClr"/></a:solidFill>',n[n.length]='<a:gradFill rotWithShape="1">',n[n.length]="<a:gsLst>",n[n.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="50000"/><a:satMod val="300000"/></a:schemeClr></a:gs>',n[n.length]='<a:gs pos="35000"><a:schemeClr val="phClr"><a:tint val="37000"/><a:satMod val="300000"/></a:schemeClr></a:gs>',n[n.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:tint val="15000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',n[n.length]="</a:gsLst>",n[n.length]='<a:lin ang="16200000" scaled="1"/>',n[n.length]="</a:gradFill>",n[n.length]='<a:gradFill rotWithShape="1">',n[n.length]="<a:gsLst>",n[n.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="100000"/><a:shade val="100000"/><a:satMod val="130000"/></a:schemeClr></a:gs>',n[n.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:tint val="50000"/><a:shade val="100000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',n[n.length]="</a:gsLst>",n[n.length]='<a:lin ang="16200000" scaled="0"/>',n[n.length]="</a:gradFill>",n[n.length]="</a:fillStyleLst>",n[n.length]="<a:lnStyleLst>",n[n.length]='<a:ln w="9525" cap="flat" cmpd="sng" algn="ctr"><a:solidFill><a:schemeClr val="phClr"><a:shade val="95000"/><a:satMod val="105000"/></a:schemeClr></a:solidFill><a:prstDash val="solid"/></a:ln>',n[n.length]='<a:ln w="25400" cap="flat" cmpd="sng" algn="ctr"><a:solidFill><a:schemeClr val="phClr"/></a:solidFill><a:prstDash val="solid"/></a:ln>',n[n.length]='<a:ln w="38100" cap="flat" cmpd="sng" algn="ctr"><a:solidFill><a:schemeClr val="phClr"/></a:solidFill><a:prstDash val="solid"/></a:ln>',n[n.length]="</a:lnStyleLst>",n[n.length]="<a:effectStyleLst>",n[n.length]="<a:effectStyle>",n[n.length]="<a:effectLst>",n[n.length]='<a:outerShdw blurRad="40000" dist="20000" dir="5400000" rotWithShape="0"><a:srgbClr val="000000"><a:alpha val="38000"/></a:srgbClr></a:outerShdw>',n[n.length]="</a:effectLst>",n[n.length]="</a:effectStyle>",n[n.length]="<a:effectStyle>",n[n.length]="<a:effectLst>",n[n.length]='<a:outerShdw blurRad="40000" dist="23000" dir="5400000" rotWithShape="0"><a:srgbClr val="000000"><a:alpha val="35000"/></a:srgbClr></a:outerShdw>',n[n.length]="</a:effectLst>",n[n.length]="</a:effectStyle>",n[n.length]="<a:effectStyle>",n[n.length]="<a:effectLst>",n[n.length]='<a:outerShdw blurRad="40000" dist="23000" dir="5400000" rotWithShape="0"><a:srgbClr val="000000"><a:alpha val="35000"/></a:srgbClr></a:outerShdw>',n[n.length]="</a:effectLst>",n[n.length]='<a:scene3d><a:camera prst="orthographicFront"><a:rot lat="0" lon="0" rev="0"/></a:camera><a:lightRig rig="threePt" dir="t"><a:rot lat="0" lon="0" rev="1200000"/></a:lightRig></a:scene3d>',n[n.length]='<a:sp3d><a:bevelT w="63500" h="25400"/></a:sp3d>',n[n.length]="</a:effectStyle>",n[n.length]="</a:effectStyleLst>",n[n.length]="<a:bgFillStyleLst>",n[n.length]='<a:solidFill><a:schemeClr val="phClr"/></a:solidFill>',n[n.length]='<a:gradFill rotWithShape="1">',n[n.length]="<a:gsLst>",n[n.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="40000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',n[n.length]='<a:gs pos="40000"><a:schemeClr val="phClr"><a:tint val="45000"/><a:shade val="99000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',n[n.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:shade val="20000"/><a:satMod val="255000"/></a:schemeClr></a:gs>',n[n.length]="</a:gsLst>",n[n.length]='<a:path path="circle"><a:fillToRect l="50000" t="-80000" r="50000" b="180000"/></a:path>',n[n.length]="</a:gradFill>",n[n.length]='<a:gradFill rotWithShape="1">',n[n.length]="<a:gsLst>",n[n.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="80000"/><a:satMod val="300000"/></a:schemeClr></a:gs>',n[n.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:shade val="30000"/><a:satMod val="200000"/></a:schemeClr></a:gs>',n[n.length]="</a:gsLst>",n[n.length]='<a:path path="circle"><a:fillToRect l="50000" t="50000" r="50000" b="50000"/></a:path>',n[n.length]="</a:gradFill>",n[n.length]="</a:bgFillStyleLst>",n[n.length]="</a:fmtScheme>",n[n.length]="</a:themeElements>",n[n.length]="<a:objectDefaults>",n[n.length]="<a:spDef>",n[n.length]='<a:spPr/><a:bodyPr/><a:lstStyle/><a:style><a:lnRef idx="1"><a:schemeClr val="accent1"/></a:lnRef><a:fillRef idx="3"><a:schemeClr val="accent1"/></a:fillRef><a:effectRef idx="2"><a:schemeClr val="accent1"/></a:effectRef><a:fontRef idx="minor"><a:schemeClr val="lt1"/></a:fontRef></a:style>',n[n.length]="</a:spDef>",n[n.length]="<a:lnDef>",n[n.length]='<a:spPr/><a:bodyPr/><a:lstStyle/><a:style><a:lnRef idx="2"><a:schemeClr val="accent1"/></a:lnRef><a:fillRef idx="0"><a:schemeClr val="accent1"/></a:fillRef><a:effectRef idx="1"><a:schemeClr val="accent1"/></a:effectRef><a:fontRef idx="minor"><a:schemeClr val="tx1"/></a:fontRef></a:style>',n[n.length]="</a:lnDef>",n[n.length]="</a:objectDefaults>",n[n.length]="<a:extraClrSchemeLst/>",n[n.length]="</a:theme>",n.join("")}function gee(){var e=U8();return W8(e,332),W8(e,334,s7(1)),W8(e,335,function(e){var t=z8(12+2*e.name.length);return t.write_shift(4,e.flags),t.write_shift(4,e.version),l7(e.name,t),t.slice(0,t.l)}({name:"XLDAPR",version:12e4,flags:3496657072})),W8(e,336),W8(e,339,function(e,t){var n=z8(8+2*t.length);return n.write_shift(4,e),l7(t,n),n.slice(0,n.l)}(1,"XLDAPR")),W8(e,52),W8(e,35,s7(514)),W8(e,4096,s7(0)),W8(e,4097,h9(1)),W8(e,36),W8(e,53),W8(e,340),W8(e,337,function(e,t){var n=z8(8);return n.write_shift(4,e),n.write_shift(4,t?1:0),n}(1,!0)),W8(e,51,function(e){var t=z8(4+8*e.length);t.write_shift(4,e.length);for(var n=0;n<e.length;++n)t.write_shift(4,e[n][0]),t.write_shift(4,e[n][1]);return t}([[1,0]])),W8(e,338),W8(e,333),e.end()}function vee(){var e=[m6];return e.push('<metadata xmlns="http://schemas.openxmlformats.org/spreadsheetml/2006/main" xmlns:xlrd="http://schemas.microsoft.com/office/spreadsheetml/2017/richdata" xmlns:xda="http://schemas.microsoft.com/office/spreadsheetml/2017/dynamicarray">\n  <metadataTypes count="1">\n    <metadataType name="XLDAPR" minSupportedVersion="120000" copy="1" pasteAll="1" pasteValues="1" merge="1" splitFirst="1" rowColShift="1" clearFormats="1" clearComments="1" assign="1" coerce="1" cellMeta="1"/>\n  </metadataTypes>\n  <futureMetadata name="XLDAPR" count="1">\n    <bk>\n      <extLst>\n        <ext uri="{bdbb8cdc-fa1e-496e-a857-3c3f30c029c3}">\n          <xda:dynamicArrayProperties fDynamic="1" fCollapsed="0"/>\n        </ext>\n      </extLst>\n    </bk>\n  </futureMetadata>\n  <cellMetadata count="1">\n    <bk>\n      <rc t="1" v="0"/>\n    </bk>\n  </cellMetadata>\n</metadata>'),e.join("")}var bee=1024;function yee(e,t){for(var n=[21600,21600],r=["m0,0l0",n[1],n[0],n[1],n[0],"0xe"].join(","),a=[L6("xml",null,{"xmlns:v":n8,"xmlns:o":J6,"xmlns:x":Q6,"xmlns:mv":t8}).replace(/\/>/,">"),L6("o:shapelayout",L6("o:idmap",null,{"v:ext":"edit",data:e}),{"v:ext":"edit"}),L6("v:shapetype",[L6("v:stroke",null,{joinstyle:"miter"}),L6("v:path",null,{gradientshapeok:"t","o:connecttype":"rect"})].join(""),{id:"_x0000_t202","o:spt":202,coordsize:n.join(","),path:r})];bee<1e3*e;)bee+=1e3;return t.forEach(function(e){var t=J8(e[0]),n={color2:"#BEFF82",type:"gradient"};"gradient"==n.type&&(n.angle="-180");var r="gradient"==n.type?L6("o:fill",null,{type:"gradientUnscaled","v:ext":"view"}):null,i=L6("v:fill",r,n);++bee,a=a.concat(["<v:shape"+O6({id:"_x0000_s"+bee,type:"#_x0000_t202",style:"position:absolute; margin-left:80pt;margin-top:5pt;width:104pt;height:64pt;z-index:10"+(e[1].hidden?";visibility:hidden":""),fillcolor:"#ECFAD4",strokecolor:"#edeaa1"})+">",i,L6("v:shadow",null,{on:"t",obscured:"t"}),L6("v:path",null,{"o:connecttype":"none"}),'<v:textbox><div style="text-align:left"></div></v:textbox>','<x:ClientData ObjectType="Note">',"<x:MoveWithCells/>","<x:SizeWithCells/>",D6("x:Anchor",[t.c+1,0,t.r+1,0,t.c+3,20,t.r+5,20].join(",")),D6("x:AutoFill","False"),D6("x:Row",String(t.r)),D6("x:Column",String(t.c)),e[1].hidden?"":"<x:Visible/>","</x:ClientData>","</v:shape>"])}),a.push("</xml>"),a.join("")}function xee(e){var t=[m6,L6("comments",null,{xmlns:$6[0]})],n=[];return t.push("<authors>"),e.forEach(function(e){e[1].forEach(function(e){var r=x6(e.a);-1==n.indexOf(r)&&(n.push(r),t.push("<author>"+r+"</author>")),e.T&&e.ID&&-1==n.indexOf("tc="+e.ID)&&(n.push("tc="+e.ID),t.push("<author>tc="+e.ID+"</author>"))})}),0==n.length&&(n.push("SheetJ5"),t.push("<author>SheetJ5</author>")),t.push("</authors>"),t.push("<commentList>"),e.forEach(function(e){var r=0,a=[];if(e[1][0]&&e[1][0].T&&e[1][0].ID?r=n.indexOf("tc="+e[1][0].ID):e[1].forEach(function(e){e.a&&(r=n.indexOf(x6(e.a))),a.push(e.t||"")}),t.push('<comment ref="'+e[0]+'" authorId="'+r+'"><text>'),a.length<=1)t.push(D6("t",x6(a[0]||"")));else{for(var i="Comment:\n    "+a[0]+"\n",o=1;o<a.length;++o)i+="Reply:\n    "+a[o]+"\n";t.push(D6("t",x6(i)))}t.push("</text></comment>")}),t.push("</commentList>"),t.length>2&&(t[t.length]="</comments>",t[1]=t[1].replace("/>",">")),t.join("")}function wee(e,t,n){var r=[m6,L6("ThreadedComments",null,{xmlns:W6}).replace(/[\/]>/,">")];return e.forEach(function(e){var a="";(e[1]||[]).forEach(function(i,o){if(i.T){i.a&&-1==t.indexOf(i.a)&&t.push(i.a);var s={ref:e[0],id:"{54EE7951-7262-4200-6969-"+("000000000000"+n.tcid++).slice(-12)+"}"};0==o?a=s.id:s.parentId=a,i.ID=s.id,i.a&&(s.personId="{54EE7950-7262-4200-6969-"+("000000000000"+t.indexOf(i.a)).slice(-12)+"}"),r.push(L6("threadedComment",D6("text",i.t||""),s))}else delete i.ID})}),r.push("</ThreadedComments>"),r.join("")}var kee=c7;function See(e){var t=U8(),n=[];return W8(t,628),W8(t,630),e.forEach(function(e){e[1].forEach(function(e){n.indexOf(e.a)>-1||(n.push(e.a.slice(0,54)),W8(t,632,function(e){return l7(e.slice(0,54))}(e.a)))})}),W8(t,631),W8(t,633),e.forEach(function(e){e[1].forEach(function(r){r.iauthor=n.indexOf(r.a);var a={s:J8(e[0]),e:J8(e[0])};W8(t,635,function(e,t){return null==t&&(t=z8(36)),t.write_shift(4,e[1].iauthor),_7(e[0],t),t.write_shift(4,0),t.write_shift(4,0),t.write_shift(4,0),t.write_shift(4,0),t}([a,r])),r.t&&r.t.length>0&&W8(t,637,f7(r)),W8(t,636),delete r.iauthor})}),W8(t,634),W8(t,629),t.end()}var Nee=["xlsb","xlsm","xlam","biff8","xla"];var Cee=function(){var e=/(^|[^A-Za-z_])R(\[?-?\d+\]|[1-9]\d*|)C(\[?-?\d+\]|[1-9]\d*|)(?![A-Za-z0-9_])/g,t={r:0,c:0};function n(e,n,r,a){var i=!1,o=!1;0==r.length?o=!0:"["==r.charAt(0)&&(o=!0,r=r.slice(1,-1)),0==a.length?i=!0:"["==a.charAt(0)&&(i=!0,a=a.slice(1,-1));var s=r.length>0?0|parseInt(r,10):0,c=a.length>0?0|parseInt(a,10):0;return i?c+=t.c:--c,o?s+=t.r:--s,n+(i?"":"$")+$8(c)+(o?"":"$")+X8(s)}return function(r,a){return t=a,r.replace(e,n)}}(),Eee=/(^|[^._A-Z0-9])([$]?)([A-Z]{1,2}|[A-W][A-Z]{2}|X[A-E][A-Z]|XF[A-D])([$]?)(10[0-3]\d{4}|104[0-7]\d{3}|1048[0-4]\d{2}|10485[0-6]\d|104857[0-6]|[1-9]\d{0,5})(?![_.\(A-Za-z0-9])/g,Iee=function(){return function(e,t){return e.replace(Eee,function(e,n,r,a,i,o){var s=Y8(a)-(r?0:t.c),c=K8(o)-(i?0:t.r);return n+"R"+(0==c?"":i?c+1:"["+c+"]")+"C"+(0==s?"":r?s+1:"["+s+"]")})}}();function Tee(e,t){return e.replace(Eee,function(e,n,r,a,i,o){return n+("$"==r?r+a:$8(Y8(a)+t.c))+("$"==i?i+o:X8(K8(o)+t.r))})}function _ee(e){e.l+=1}function Aee(e,t){var n=e.read_shift(1==t?1:2);return[16383&n,n>>14&1,n>>15&1]}function Ree(e,t,n){var r=2;if(n){if(n.biff>=2&&n.biff<=5)return Fee(e);12==n.biff&&(r=4)}var a=e.read_shift(r),i=e.read_shift(r),o=Aee(e,2),s=Aee(e,2);return{s:{r:a,c:o[0],cRel:o[1],rRel:o[2]},e:{r:i,c:s[0],cRel:s[1],rRel:s[2]}}}function Fee(e){var t=Aee(e,2),n=Aee(e,2),r=e.read_shift(1),a=e.read_shift(1);return{s:{r:t[0],c:r,cRel:t[1],rRel:t[2]},e:{r:n[0],c:a,cRel:n[1],rRel:n[2]}}}function Dee(e,t,n){if(n&&n.biff>=2&&n.biff<=5)return function(e){var t=Aee(e,2),n=e.read_shift(1);return{r:t[0],c:n,cRel:t[1],rRel:t[2]}}(e);var r=e.read_shift(n&&12==n.biff?4:2),a=Aee(e,2);return{r:r,c:a[0],cRel:a[1],rRel:a[2]}}function Oee(e){var t=e.read_shift(2),n=e.read_shift(2);return{r:t,c:255&n,fQuoted:!!(16384&n),cRel:n>>15,rRel:n>>15}}function Lee(e){var t=1&e[e.l+1];return e.l+=4,[t,1]}function Pee(e){return[e.read_shift(1),e.read_shift(1)]}function Mee(e,t){var n=[e.read_shift(1)];if(12==t)switch(n[0]){case 2:n[0]=4;break;case 4:n[0]=16;break;case 0:n[0]=1;break;case 1:n[0]=2}switch(n[0]){case 4:n[1]=c9(e,1)?"TRUE":"FALSE",12!=t&&(e.l+=7);break;case 37:case 16:n[1]=j7[e[e.l]],e.l+=12==t?4:8;break;case 0:e.l+=8;break;case 1:n[1]=A7(e);break;case 2:n[1]=v9(e,0,{biff:t>0&&t<8?2:t});break;default:throw new Error("Bad SerAr: "+n[0])}return n}function jee(e,t,n){for(var r=e.read_shift(12==n.biff?4:2),a=[],i=0;i!=r;++i)a.push((12==n.biff?T7:S9)(e,8));return a}function Bee(e,t,n){var r=0,a=0;12==n.biff?(r=e.read_shift(4),a=e.read_shift(4)):(a=1+e.read_shift(1),r=1+e.read_shift(2)),n.biff>=2&&n.biff<8&&(--r,0==--a&&(a=256));for(var i=0,o=[];i!=r&&(o[i]=[]);++i)for(var s=0;s!=a;++s)o[i][s]=Mee(e,n.biff);return o}function zee(e,t,n){return e.l+=2,[Oee(e)]}function Uee(e){return e.l+=6,[]}function Wee(e){return e.l+=2,[u9(e),1&e.read_shift(2)]}var Vee=["Data","All","Headers","??","?Data2","??","?DataHeaders","??","Totals","??","??","??","?DataTotals","??","??","??","?Current"];var Hee={1:{n:"PtgExp",f:function(e,t,n){return e.l++,n&&12==n.biff?[e.read_shift(4,"i"),0]:[e.read_shift(2),e.read_shift(n&&2==n.biff?1:2)]}},2:{n:"PtgTbl",f:B8},3:{n:"PtgAdd",f:_ee},4:{n:"PtgSub",f:_ee},5:{n:"PtgMul",f:_ee},6:{n:"PtgDiv",f:_ee},7:{n:"PtgPower",f:_ee},8:{n:"PtgConcat",f:_ee},9:{n:"PtgLt",f:_ee},10:{n:"PtgLe",f:_ee},11:{n:"PtgEq",f:_ee},12:{n:"PtgGe",f:_ee},13:{n:"PtgGt",f:_ee},14:{n:"PtgNe",f:_ee},15:{n:"PtgIsect",f:_ee},16:{n:"PtgUnion",f:_ee},17:{n:"PtgRange",f:_ee},18:{n:"PtgUplus",f:_ee},19:{n:"PtgUminus",f:_ee},20:{n:"PtgPercent",f:_ee},21:{n:"PtgParen",f:_ee},22:{n:"PtgMissArg",f:_ee},23:{n:"PtgStr",f:function(e,t,n){return e.l++,f9(e,0,n)}},26:{n:"PtgSheet",f:function(e,t,n){return e.l+=5,e.l+=2,e.l+=2==n.biff?1:4,["PTGSHEET"]}},27:{n:"PtgEndSheet",f:function(e,t,n){return e.l+=2==n.biff?4:5,["PTGENDSHEET"]}},28:{n:"PtgErr",f:function(e){return e.l++,j7[e.read_shift(1)]}},29:{n:"PtgBool",f:function(e){return e.l++,0!==e.read_shift(1)}},30:{n:"PtgInt",f:function(e){return e.l++,e.read_shift(2)}},31:{n:"PtgNum",f:function(e){return e.l++,A7(e)}},32:{n:"PtgArray",f:function(e,t,n){var r=(96&e[e.l++])>>5;return e.l+=2==n.biff?6:12==n.biff?14:7,[r]}},33:{n:"PtgFunc",f:function(e,t,n){var r=(96&e[e.l])>>5;e.l+=1;var a=e.read_shift(n&&n.biff<=3?1:2);return[lte[a],cte[a],r]}},34:{n:"PtgFuncVar",f:function(e,t,n){var r=e[e.l++],a=e.read_shift(1),i=n&&n.biff<=3?[88==r?-1:0,e.read_shift(1)]:function(e){return[e[e.l+1]>>7,32767&e.read_shift(2)]}(e);return[a,(0===i[0]?cte:ste)[i[1]]]}},35:{n:"PtgName",f:function(e,t,n){var r=e.read_shift(1)>>>5&3,a=!n||n.biff>=8?4:2,i=e.read_shift(a);switch(n.biff){case 2:e.l+=5;break;case 3:case 4:e.l+=8;break;case 5:e.l+=12}return[r,0,i]}},36:{n:"PtgRef",f:function(e,t,n){var r=(96&e[e.l])>>5;return e.l+=1,[r,Dee(e,0,n)]}},37:{n:"PtgArea",f:function(e,t,n){return[(96&e[e.l++])>>5,Ree(e,n.biff>=2&&n.biff,n)]}},38:{n:"PtgMemArea",f:function(e,t,n){var r=e.read_shift(1)>>>5&3;return e.l+=n&&2==n.biff?3:4,[r,e.read_shift(n&&2==n.biff?1:2)]}},39:{n:"PtgMemErr",f:B8},40:{n:"PtgMemNoMem",f:B8},41:{n:"PtgMemFunc",f:function(e,t,n){return[e.read_shift(1)>>>5&3,e.read_shift(n&&2==n.biff?1:2)]}},42:{n:"PtgRefErr",f:function(e,t,n){var r=e.read_shift(1)>>>5&3;return e.l+=4,n.biff<8&&e.l--,12==n.biff&&(e.l+=2),[r]}},43:{n:"PtgAreaErr",f:function(e,t,n){var r=(96&e[e.l++])>>5;return e.l+=n&&n.biff>8?12:n.biff<8?6:8,[r]}},44:{n:"PtgRefN",f:function(e,t,n){var r=(96&e[e.l])>>5;e.l+=1;var a=function(e,t,n){var r=n&&n.biff?n.biff:8;if(r>=2&&r<=5)return function(e){var t=e.read_shift(2),n=e.read_shift(1),r=(32768&t)>>15,a=(16384&t)>>14;return t&=16383,1==r&&t>=8192&&(t-=16384),1==a&&n>=128&&(n-=256),{r:t,c:n,cRel:a,rRel:r}}(e);var a=e.read_shift(r>=12?4:2),i=e.read_shift(2),o=(16384&i)>>14,s=(32768&i)>>15;if(i&=16383,1==s)for(;a>524287;)a-=1048576;if(1==o)for(;i>8191;)i-=16384;return{r:a,c:i,cRel:o,rRel:s}}(e,0,n);return[r,a]}},45:{n:"PtgAreaN",f:function(e,t,n){var r=(96&e[e.l++])>>5,a=function(e,t,n){if(n.biff<8)return Fee(e);var r=e.read_shift(12==n.biff?4:2),a=e.read_shift(12==n.biff?4:2),i=Aee(e,2),o=Aee(e,2);return{s:{r:r,c:i[0],cRel:i[1],rRel:i[2]},e:{r:a,c:o[0],cRel:o[1],rRel:o[2]}}}(e,0,n);return[r,a]}},46:{n:"PtgMemAreaN",f:function(e){return[e.read_shift(1)>>>5&3,e.read_shift(2)]}},47:{n:"PtgMemNoMemN",f:function(e){return[e.read_shift(1)>>>5&3,e.read_shift(2)]}},57:{n:"PtgNameX",f:function(e,t,n){return 5==n.biff?function(e){var t=e.read_shift(1)>>>5&3,n=e.read_shift(2,"i");e.l+=8;var r=e.read_shift(2);return e.l+=12,[t,n,r]}(e):[e.read_shift(1)>>>5&3,e.read_shift(2),e.read_shift(4)]}},58:{n:"PtgRef3d",f:function(e,t,n){var r=(96&e[e.l])>>5;e.l+=1;var a=e.read_shift(2);return n&&5==n.biff&&(e.l+=12),[r,a,Dee(e,0,n)]}},59:{n:"PtgArea3d",f:function(e,t,n){var r=(96&e[e.l++])>>5,a=e.read_shift(2,"i");if(n)switch(n.biff){case 5:e.l+=12;break;case 12:0}return[r,a,Ree(e,0,n)]}},60:{n:"PtgRefErr3d",f:function(e,t,n){var r=(96&e[e.l++])>>5,a=e.read_shift(2),i=4;if(n)switch(n.biff){case 5:i=15;break;case 12:i=6}return e.l+=i,[r,a]}},61:{n:"PtgAreaErr3d",f:function(e,t,n){var r=(96&e[e.l++])>>5,a=e.read_shift(2),i=8;if(n)switch(n.biff){case 5:e.l+=12,i=6;break;case 12:i=12}return e.l+=i,[r,a]}},255:{}},Gee={64:32,96:32,65:33,97:33,66:34,98:34,67:35,99:35,68:36,100:36,69:37,101:37,70:38,102:38,71:39,103:39,72:40,104:40,73:41,105:41,74:42,106:42,75:43,107:43,76:44,108:44,77:45,109:45,78:46,110:46,79:47,111:47,88:34,120:34,89:57,121:57,90:58,122:58,91:59,123:59,92:60,124:60,93:61,125:61},qee={1:{n:"PtgElfLel",f:Wee},2:{n:"PtgElfRw",f:zee},3:{n:"PtgElfCol",f:zee},6:{n:"PtgElfRwV",f:zee},7:{n:"PtgElfColV",f:zee},10:{n:"PtgElfRadical",f:zee},11:{n:"PtgElfRadicalS",f:Uee},13:{n:"PtgElfColS",f:Uee},15:{n:"PtgElfColSV",f:Uee},16:{n:"PtgElfRadicalLel",f:Wee},25:{n:"PtgList",f:function(e){e.l+=2;var t=e.read_shift(2),n=e.read_shift(2),r=e.read_shift(4),a=e.read_shift(2),i=e.read_shift(2);return{ixti:t,coltype:3&n,rt:Vee[n>>2&31],idx:r,c:a,C:i}}},29:{n:"PtgSxName",f:function(e){return e.l+=2,[e.read_shift(4)]}},255:{}},Kee={0:{n:"PtgAttrNoop",f:function(e){return e.l+=4,[0,0]}},1:{n:"PtgAttrSemi",f:function(e,t,n){var r=255&e[e.l+1]?1:0;return e.l+=n&&2==n.biff?3:4,[r]}},2:{n:"PtgAttrIf",f:function(e,t,n){var r=255&e[e.l+1]?1:0;return e.l+=2,[r,e.read_shift(n&&2==n.biff?1:2)]}},4:{n:"PtgAttrChoose",f:function(e,t,n){e.l+=2;for(var r=e.read_shift(n&&2==n.biff?1:2),a=[],i=0;i<=r;++i)a.push(e.read_shift(n&&2==n.biff?1:2));return a}},8:{n:"PtgAttrGoto",f:function(e,t,n){var r=255&e[e.l+1]?1:0;return e.l+=2,[r,e.read_shift(n&&2==n.biff?1:2)]}},16:{n:"PtgAttrSum",f:function(e,t,n){e.l+=n&&2==n.biff?3:4}},32:{n:"PtgAttrBaxcel",f:Lee},33:{n:"PtgAttrBaxcel",f:Lee},64:{n:"PtgAttrSpace",f:function(e){return e.read_shift(2),Pee(e)}},65:{n:"PtgAttrSpaceSemi",f:function(e){return e.read_shift(2),Pee(e)}},128:{n:"PtgAttrIfError",f:function(e){var t=255&e[e.l+1]?1:0;return e.l+=2,[t,e.read_shift(2)]}},255:{}};function Xee(e,t,n,r){if(r.biff<8)return B8(e,t);for(var a=e.l+t,i=[],o=0;o!==n.length;++o)switch(n[o][0]){case"PtgArray":n[o][1]=Bee(e,0,r),i.push(n[o][1]);break;case"PtgMemArea":n[o][2]=jee(e,n[o][1],r),i.push(n[o][2]);break;case"PtgExp":r&&12==r.biff&&(n[o][1][1]=e.read_shift(4),i.push(n[o][1]));break;case"PtgList":case"PtgElfRadicalS":case"PtgElfColS":case"PtgElfColSV":throw"Unsupported "+n[o][0]}return 0!==(t=a-e.l)&&i.push(B8(e,t)),i}function Yee(e,t,n){for(var r,a,i=e.l+t,o=[];i!=e.l;)t=i-e.l,a=e[e.l],r=Hee[a]||Hee[Gee[a]],24!==a&&25!==a||(r=(24===a?qee:Kee)[e[e.l+1]]),r&&r.f?o.push([r.n,r.f(e,t,n)]):B8(e,t);return o}function $ee(e){for(var t=[],n=0;n<e.length;++n){for(var r=e[n],a=[],i=0;i<r.length;++i){var o=r[i];if(o)if(2===o[0])a.push('"'+o[1].replace(/"/g,'""')+'"');else a.push(o[1]);else a.push("")}t.push(a.join(","))}return t.join(";")}var Jee={PtgAdd:"+",PtgConcat:"&",PtgDiv:"/",PtgEq:"=",PtgGe:">=",PtgGt:">",PtgLe:"<=",PtgLt:"<",PtgMul:"*",PtgNe:"<>",PtgPower:"^",PtgSub:"-"};function Qee(e,t,n){if(!e)return"SH33TJSERR0";if(n.biff>8&&(!e.XTI||!e.XTI[t]))return e.SheetNames[t];if(!e.XTI)return"SH33TJSERR6";var r=e.XTI[t];if(n.biff<8)return t>1e4&&(t-=65536),t<0&&(t=-t),0==t?"":e.XTI[t-1];if(!r)return"SH33TJSERR1";var a="";if(n.biff>8)switch(e[r[0]][0]){case 357:return a=-1==r[1]?"#REF":e.SheetNames[r[1]],r[1]==r[2]?a:a+":"+e.SheetNames[r[2]];case 358:return null!=n.SID?e.SheetNames[n.SID]:"SH33TJSSAME"+e[r[0]][0];default:return"SH33TJSSRC"+e[r[0]][0]}switch(e[r[0]][0][0]){case 1025:return a=-1==r[1]?"#REF":e.SheetNames[r[1]]||"SH33TJSERR3",r[1]==r[2]?a:a+":"+e.SheetNames[r[2]];case 14849:return e[r[0]].slice(1).map(function(e){return e.Name}).join(";;");default:return e[r[0]][0][3]?(a=-1==r[1]?"#REF":e[r[0]][0][3][r[1]]||"SH33TJSERR4",r[1]==r[2]?a:a+":"+e[r[0]][0][3][r[2]]):"SH33TJSERR2"}}function Zee(e,t,n){var r=Qee(e,t,n);return"#REF"==r?r:function(e,t){if(!e&&!(t&&t.biff<=5&&t.biff>=2))throw new Error("empty sheet name");return/[^\w\u4E00-\u9FFF\u3040-\u30FF]/.test(e)?"'"+e+"'":e}(r,n)}function ete(e,t,n,r,a){var i,o,s,c,l=a&&a.biff||8,u={s:{c:0,r:0},e:{c:0,r:0}},h=[],d=0,f=0,p="";if(!e[0]||!e[0][0])return"";for(var m=-1,g="",v=0,b=e[0].length;v<b;++v){var y=e[0][v];switch(y[0]){case"PtgUminus":h.push("-"+h.pop());break;case"PtgUplus":h.push("+"+h.pop());break;case"PtgPercent":h.push(h.pop()+"%");break;case"PtgAdd":case"PtgConcat":case"PtgDiv":case"PtgEq":case"PtgGe":case"PtgGt":case"PtgLe":case"PtgLt":case"PtgMul":case"PtgNe":case"PtgPower":case"PtgSub":if(i=h.pop(),o=h.pop(),m>=0){switch(e[0][m][1][0]){case 0:g=l6(" ",e[0][m][1][1]);break;case 1:g=l6("\r",e[0][m][1][1]);break;default:if(g="",a.WTF)throw new Error("Unexpected PtgAttrSpaceType "+e[0][m][1][0])}o+=g,m=-1}h.push(o+Jee[y[0]]+i);break;case"PtgIsect":i=h.pop(),o=h.pop(),h.push(o+" "+i);break;case"PtgUnion":i=h.pop(),o=h.pop(),h.push(o+","+i);break;case"PtgRange":i=h.pop(),o=h.pop(),h.push(o+":"+i);break;case"PtgAttrChoose":case"PtgAttrGoto":case"PtgAttrIf":case"PtgAttrIfError":case"PtgAttrBaxcel":case"PtgAttrSemi":case"PtgMemArea":case"PtgTbl":case"PtgMemErr":case"PtgMemAreaN":case"PtgMemNoMemN":case"PtgAttrNoop":case"PtgSheet":case"PtgEndSheet":case"PtgMemFunc":case"PtgMemNoMem":break;case"PtgRef":s=V8(y[1][1],u,a),h.push(G8(s,l));break;case"PtgRefN":s=n?V8(y[1][1],n,a):y[1][1],h.push(G8(s,l));break;case"PtgRef3d":d=y[1][1],s=V8(y[1][2],u,a);p=Zee(r,d,a);h.push(p+"!"+G8(s,l));break;case"PtgFunc":case"PtgFuncVar":var x=y[1][0],w=y[1][1];x||(x=0);var k=0==(x&=127)?[]:h.slice(-x);h.length-=x,"User"===w&&(w=k.shift()),h.push(w+"("+k.join(",")+")");break;case"PtgBool":h.push(y[1]?"TRUE":"FALSE");break;case"PtgInt":case"PtgErr":h.push(y[1]);break;case"PtgNum":h.push(String(y[1]));break;case"PtgStr":h.push('"'+y[1].replace(/"/g,'""')+'"');break;case"PtgAreaN":c=H8(y[1][1],n?{s:n}:u,a),h.push(q8(c,a));break;case"PtgArea":c=H8(y[1][1],u,a),h.push(q8(c,a));break;case"PtgArea3d":d=y[1][1],c=y[1][2],p=Zee(r,d,a),h.push(p+"!"+q8(c,a));break;case"PtgAttrSum":h.push("SUM("+h.pop()+")");break;case"PtgName":f=y[1][2];var S=(r.names||[])[f-1]||(r[0]||[])[f],N=S?S.Name:"SH33TJSNAME"+String(f);N&&"_xlfn."==N.slice(0,6)&&!a.xlfn&&(N=N.slice(6)),h.push(N);break;case"PtgNameX":var C,E=y[1][1];if(f=y[1][2],!(a.biff<=5)){var I="";if(14849==((r[E]||[])[0]||[])[0]||(1025==((r[E]||[])[0]||[])[0]?r[E][f]&&r[E][f].itab>0&&(I=r.SheetNames[r[E][f].itab-1]+"!"):I=r.SheetNames[f-1]+"!"),r[E]&&r[E][f])I+=r[E][f].Name;else if(r[0]&&r[0][f])I+=r[0][f].Name;else{var T=(Qee(r,E,a)||"").split(";;");T[f-1]?I=T[f-1]:I+="SH33TJSERRX"}h.push(I);break}E<0&&(E=-E),r[E]&&(C=r[E][f]),C||(C={Name:"SH33TJSERRY"}),h.push(C.Name);break;case"PtgParen":var _="(",A=")";if(m>=0){switch(g="",e[0][m][1][0]){case 2:_=l6(" ",e[0][m][1][1])+_;break;case 3:_=l6("\r",e[0][m][1][1])+_;break;case 4:A=l6(" ",e[0][m][1][1])+A;break;case 5:A=l6("\r",e[0][m][1][1])+A;break;default:if(a.WTF)throw new Error("Unexpected PtgAttrSpaceType "+e[0][m][1][0])}m=-1}h.push(_+h.pop()+A);break;case"PtgRefErr":case"PtgRefErr3d":case"PtgAreaErr":case"PtgAreaErr3d":h.push("#REF!");break;case"PtgExp":s={c:y[1][1],r:y[1][0]};var R={c:n.c,r:n.r};if(r.sharedf[Q8(s)]){var F=r.sharedf[Q8(s)];h.push(ete(F,u,R,r,a))}else{var D=!1;for(i=0;i!=r.arrayf.length;++i)if(o=r.arrayf[i],!(s.c<o[0].s.c||s.c>o[0].e.c)&&!(s.r<o[0].s.r||s.r>o[0].e.r)){h.push(ete(o[1],u,R,r,a)),D=!0;break}D||h.push(y[1])}break;case"PtgArray":h.push("{"+$ee(y[1])+"}");break;case"PtgAttrSpace":case"PtgAttrSpaceSemi":m=v;break;case"PtgMissArg":h.push("");break;case"PtgList":h.push("Table"+y[1].idx+"[#"+y[1].rt+"]");break;case"PtgElfCol":case"PtgElfColS":case"PtgElfColSV":case"PtgElfColV":case"PtgElfLel":case"PtgElfRadical":case"PtgElfRadicalLel":case"PtgElfRadicalS":case"PtgElfRw":case"PtgElfRwV":throw new Error("Unsupported ELFs");default:throw new Error("Unrecognized Formula Token: "+String(y))}if(3!=a.biff&&m>=0&&-1==["PtgAttrSpace","PtgAttrSpaceSemi","PtgAttrGoto"].indexOf(e[0][v][0])){var O=!0;switch((y=e[0][m])[1][0]){case 4:O=!1;case 0:g=l6(" ",y[1][1]);break;case 5:O=!1;case 1:g=l6("\r",y[1][1]);break;default:if(g="",a.WTF)throw new Error("Unexpected PtgAttrSpaceType "+y[1][0])}h.push((O?g:"")+h.pop()+(O?"":g)),m=-1}}if(h.length>1&&a.WTF)throw new Error("bad formula stack");return h[0]}function tte(e,t,n,r,a){var i=w9(t,n,a),o=function(e){if(null==e){var t=z8(8);return t.write_shift(1,3),t.write_shift(1,0),t.write_shift(2,0),t.write_shift(2,0),t.write_shift(2,65535),t}return R7("number"==typeof e?e:0)}(e.v),s=z8(6);s.write_shift(2,33),s.write_shift(4,0);for(var c=z8(e.bf.length),l=0;l<e.bf.length;++l)c[l]=e.bf[l];return K3([i,o,s,c])}function nte(e,t,n){var r=e.read_shift(4),a=Yee(e,r,n),i=e.read_shift(4);return[a,i>0?Xee(e,i,a,n):null]}var rte=nte,ate=nte,ite=nte,ote=nte,ste={0:"BEEP",1:"OPEN",2:"OPEN.LINKS",3:"CLOSE.ALL",4:"SAVE",5:"SAVE.AS",6:"FILE.DELETE",7:"PAGE.SETUP",8:"PRINT",9:"PRINTER.SETUP",10:"QUIT",11:"NEW.WINDOW",12:"ARRANGE.ALL",13:"WINDOW.SIZE",14:"WINDOW.MOVE",15:"FULL",16:"CLOSE",17:"RUN",22:"SET.PRINT.AREA",23:"SET.PRINT.TITLES",24:"SET.PAGE.BREAK",25:"REMOVE.PAGE.BREAK",26:"FONT",27:"DISPLAY",28:"PROTECT.DOCUMENT",29:"PRECISION",30:"A1.R1C1",31:"CALCULATE.NOW",32:"CALCULATION",34:"DATA.FIND",35:"EXTRACT",36:"DATA.DELETE",37:"SET.DATABASE",38:"SET.CRITERIA",39:"SORT",40:"DATA.SERIES",41:"TABLE",42:"FORMAT.NUMBER",43:"ALIGNMENT",44:"STYLE",45:"BORDER",46:"CELL.PROTECTION",47:"COLUMN.WIDTH",48:"UNDO",49:"CUT",50:"COPY",51:"PASTE",52:"CLEAR",53:"PASTE.SPECIAL",54:"EDIT.DELETE",55:"INSERT",56:"FILL.RIGHT",57:"FILL.DOWN",61:"DEFINE.NAME",62:"CREATE.NAMES",63:"FORMULA.GOTO",64:"FORMULA.FIND",65:"SELECT.LAST.CELL",66:"SHOW.ACTIVE.CELL",67:"GALLERY.AREA",68:"GALLERY.BAR",69:"GALLERY.COLUMN",70:"GALLERY.LINE",71:"GALLERY.PIE",72:"GALLERY.SCATTER",73:"COMBINATION",74:"PREFERRED",75:"ADD.OVERLAY",76:"GRIDLINES",77:"SET.PREFERRED",78:"AXES",79:"LEGEND",80:"ATTACH.TEXT",81:"ADD.ARROW",82:"SELECT.CHART",83:"SELECT.PLOT.AREA",84:"PATTERNS",85:"MAIN.CHART",86:"OVERLAY",87:"SCALE",88:"FORMAT.LEGEND",89:"FORMAT.TEXT",90:"EDIT.REPEAT",91:"PARSE",92:"JUSTIFY",93:"HIDE",94:"UNHIDE",95:"WORKSPACE",96:"FORMULA",97:"FORMULA.FILL",98:"FORMULA.ARRAY",99:"DATA.FIND.NEXT",100:"DATA.FIND.PREV",101:"FORMULA.FIND.NEXT",102:"FORMULA.FIND.PREV",103:"ACTIVATE",104:"ACTIVATE.NEXT",105:"ACTIVATE.PREV",106:"UNLOCKED.NEXT",107:"UNLOCKED.PREV",108:"COPY.PICTURE",109:"SELECT",110:"DELETE.NAME",111:"DELETE.FORMAT",112:"VLINE",113:"HLINE",114:"VPAGE",115:"HPAGE",116:"VSCROLL",117:"HSCROLL",118:"ALERT",119:"NEW",120:"CANCEL.COPY",121:"SHOW.CLIPBOARD",122:"MESSAGE",124:"PASTE.LINK",125:"APP.ACTIVATE",126:"DELETE.ARROW",127:"ROW.HEIGHT",128:"FORMAT.MOVE",129:"FORMAT.SIZE",130:"FORMULA.REPLACE",131:"SEND.KEYS",132:"SELECT.SPECIAL",133:"APPLY.NAMES",134:"REPLACE.FONT",135:"FREEZE.PANES",136:"SHOW.INFO",137:"SPLIT",138:"ON.WINDOW",139:"ON.DATA",140:"DISABLE.INPUT",142:"OUTLINE",143:"LIST.NAMES",144:"FILE.CLOSE",145:"SAVE.WORKBOOK",146:"DATA.FORM",147:"COPY.CHART",148:"ON.TIME",149:"WAIT",150:"FORMAT.FONT",151:"FILL.UP",152:"FILL.LEFT",153:"DELETE.OVERLAY",155:"SHORT.MENUS",159:"SET.UPDATE.STATUS",161:"COLOR.PALETTE",162:"DELETE.STYLE",163:"WINDOW.RESTORE",164:"WINDOW.MAXIMIZE",166:"CHANGE.LINK",167:"CALCULATE.DOCUMENT",168:"ON.KEY",169:"APP.RESTORE",170:"APP.MOVE",171:"APP.SIZE",172:"APP.MINIMIZE",173:"APP.MAXIMIZE",174:"BRING.TO.FRONT",175:"SEND.TO.BACK",185:"MAIN.CHART.TYPE",186:"OVERLAY.CHART.TYPE",187:"SELECT.END",188:"OPEN.MAIL",189:"SEND.MAIL",190:"STANDARD.FONT",191:"CONSOLIDATE",192:"SORT.SPECIAL",193:"GALLERY.3D.AREA",194:"GALLERY.3D.COLUMN",195:"GALLERY.3D.LINE",196:"GALLERY.3D.PIE",197:"VIEW.3D",198:"GOAL.SEEK",199:"WORKGROUP",200:"FILL.GROUP",201:"UPDATE.LINK",202:"PROMOTE",203:"DEMOTE",204:"SHOW.DETAIL",206:"UNGROUP",207:"OBJECT.PROPERTIES",208:"SAVE.NEW.OBJECT",209:"SHARE",210:"SHARE.NAME",211:"DUPLICATE",212:"APPLY.STYLE",213:"ASSIGN.TO.OBJECT",214:"OBJECT.PROTECTION",215:"HIDE.OBJECT",216:"SET.EXTRACT",217:"CREATE.PUBLISHER",218:"SUBSCRIBE.TO",219:"ATTRIBUTES",220:"SHOW.TOOLBAR",222:"PRINT.PREVIEW",223:"EDIT.COLOR",224:"SHOW.LEVELS",225:"FORMAT.MAIN",226:"FORMAT.OVERLAY",227:"ON.RECALC",228:"EDIT.SERIES",229:"DEFINE.STYLE",240:"LINE.PRINT",243:"ENTER.DATA",249:"GALLERY.RADAR",250:"MERGE.STYLES",251:"EDITION.OPTIONS",252:"PASTE.PICTURE",253:"PASTE.PICTURE.LINK",254:"SPELLING",256:"ZOOM",259:"INSERT.OBJECT",260:"WINDOW.MINIMIZE",265:"SOUND.NOTE",266:"SOUND.PLAY",267:"FORMAT.SHAPE",268:"EXTEND.POLYGON",269:"FORMAT.AUTO",272:"GALLERY.3D.BAR",273:"GALLERY.3D.SURFACE",274:"FILL.AUTO",276:"CUSTOMIZE.TOOLBAR",277:"ADD.TOOL",278:"EDIT.OBJECT",279:"ON.DOUBLECLICK",280:"ON.ENTRY",281:"WORKBOOK.ADD",282:"WORKBOOK.MOVE",283:"WORKBOOK.COPY",284:"WORKBOOK.OPTIONS",285:"SAVE.WORKSPACE",288:"CHART.WIZARD",289:"DELETE.TOOL",290:"MOVE.TOOL",291:"WORKBOOK.SELECT",292:"WORKBOOK.ACTIVATE",293:"ASSIGN.TO.TOOL",295:"COPY.TOOL",296:"RESET.TOOL",297:"CONSTRAIN.NUMERIC",298:"PASTE.TOOL",302:"WORKBOOK.NEW",305:"SCENARIO.CELLS",306:"SCENARIO.DELETE",307:"SCENARIO.ADD",308:"SCENARIO.EDIT",309:"SCENARIO.SHOW",310:"SCENARIO.SHOW.NEXT",311:"SCENARIO.SUMMARY",312:"PIVOT.TABLE.WIZARD",313:"PIVOT.FIELD.PROPERTIES",314:"PIVOT.FIELD",315:"PIVOT.ITEM",316:"PIVOT.ADD.FIELDS",318:"OPTIONS.CALCULATION",319:"OPTIONS.EDIT",320:"OPTIONS.VIEW",321:"ADDIN.MANAGER",322:"MENU.EDITOR",323:"ATTACH.TOOLBARS",324:"VBAActivate",325:"OPTIONS.CHART",328:"VBA.INSERT.FILE",330:"VBA.PROCEDURE.DEFINITION",336:"ROUTING.SLIP",338:"ROUTE.DOCUMENT",339:"MAIL.LOGON",342:"INSERT.PICTURE",343:"EDIT.TOOL",344:"GALLERY.DOUGHNUT",350:"CHART.TREND",352:"PIVOT.ITEM.PROPERTIES",354:"WORKBOOK.INSERT",355:"OPTIONS.TRANSITION",356:"OPTIONS.GENERAL",370:"FILTER.ADVANCED",373:"MAIL.ADD.MAILER",374:"MAIL.DELETE.MAILER",375:"MAIL.REPLY",376:"MAIL.REPLY.ALL",377:"MAIL.FORWARD",378:"MAIL.NEXT.LETTER",379:"DATA.LABEL",380:"INSERT.TITLE",381:"FONT.PROPERTIES",382:"MACRO.OPTIONS",383:"WORKBOOK.HIDE",384:"WORKBOOK.UNHIDE",385:"WORKBOOK.DELETE",386:"WORKBOOK.NAME",388:"GALLERY.CUSTOM",390:"ADD.CHART.AUTOFORMAT",391:"DELETE.CHART.AUTOFORMAT",392:"CHART.ADD.DATA",393:"AUTO.OUTLINE",394:"TAB.ORDER",395:"SHOW.DIALOG",396:"SELECT.ALL",397:"UNGROUP.SHEETS",398:"SUBTOTAL.CREATE",399:"SUBTOTAL.REMOVE",400:"RENAME.OBJECT",412:"WORKBOOK.SCROLL",413:"WORKBOOK.NEXT",414:"WORKBOOK.PREV",415:"WORKBOOK.TAB.SPLIT",416:"FULL.SCREEN",417:"WORKBOOK.PROTECT",420:"SCROLLBAR.PROPERTIES",421:"PIVOT.SHOW.PAGES",422:"TEXT.TO.COLUMNS",423:"FORMAT.CHARTTYPE",424:"LINK.FORMAT",425:"TRACER.DISPLAY",430:"TRACER.NAVIGATE",431:"TRACER.CLEAR",432:"TRACER.ERROR",433:"PIVOT.FIELD.GROUP",434:"PIVOT.FIELD.UNGROUP",435:"CHECKBOX.PROPERTIES",436:"LABEL.PROPERTIES",437:"LISTBOX.PROPERTIES",438:"EDITBOX.PROPERTIES",439:"PIVOT.REFRESH",440:"LINK.COMBO",441:"OPEN.TEXT",442:"HIDE.DIALOG",443:"SET.DIALOG.FOCUS",444:"ENABLE.OBJECT",445:"PUSHBUTTON.PROPERTIES",446:"SET.DIALOG.DEFAULT",447:"FILTER",448:"FILTER.SHOW.ALL",449:"CLEAR.OUTLINE",450:"FUNCTION.WIZARD",451:"ADD.LIST.ITEM",452:"SET.LIST.ITEM",453:"REMOVE.LIST.ITEM",454:"SELECT.LIST.ITEM",455:"SET.CONTROL.VALUE",456:"SAVE.COPY.AS",458:"OPTIONS.LISTS.ADD",459:"OPTIONS.LISTS.DELETE",460:"SERIES.AXES",461:"SERIES.X",462:"SERIES.Y",463:"ERRORBAR.X",464:"ERRORBAR.Y",465:"FORMAT.CHART",466:"SERIES.ORDER",467:"MAIL.LOGOFF",468:"CLEAR.ROUTING.SLIP",469:"APP.ACTIVATE.MICROSOFT",470:"MAIL.EDIT.MAILER",471:"ON.SHEET",472:"STANDARD.WIDTH",473:"SCENARIO.MERGE",474:"SUMMARY.INFO",475:"FIND.FILE",476:"ACTIVE.CELL.FONT",477:"ENABLE.TIPWIZARD",478:"VBA.MAKE.ADDIN",480:"INSERTDATATABLE",481:"WORKGROUP.OPTIONS",482:"MAIL.SEND.MAILER",485:"AUTOCORRECT",489:"POST.DOCUMENT",491:"PICKLIST",493:"VIEW.SHOW",494:"VIEW.DEFINE",495:"VIEW.DELETE",509:"SHEET.BACKGROUND",510:"INSERT.MAP.OBJECT",511:"OPTIONS.MENONO",517:"MSOCHECKS",518:"NORMAL",519:"LAYOUT",520:"RM.PRINT.AREA",521:"CLEAR.PRINT.AREA",522:"ADD.PRINT.AREA",523:"MOVE.BRK",545:"HIDECURR.NOTE",546:"HIDEALL.NOTES",547:"DELETE.NOTE",548:"TRAVERSE.NOTES",549:"ACTIVATE.NOTES",620:"PROTECT.REVISIONS",621:"UNPROTECT.REVISIONS",647:"OPTIONS.ME",653:"WEB.PUBLISH",667:"NEWWEBQUERY",673:"PIVOT.TABLE.CHART",753:"OPTIONS.SAVE",755:"OPTIONS.SPELL",808:"HIDEALL.INKANNOTS"},cte={0:"COUNT",1:"IF",2:"ISNA",3:"ISERROR",4:"SUM",5:"AVERAGE",6:"MIN",7:"MAX",8:"ROW",9:"COLUMN",10:"NA",11:"NPV",12:"STDEV",13:"DOLLAR",14:"FIXED",15:"SIN",16:"COS",17:"TAN",18:"ATAN",19:"PI",20:"SQRT",21:"EXP",22:"LN",23:"LOG10",24:"ABS",25:"INT",26:"SIGN",27:"ROUND",28:"LOOKUP",29:"INDEX",30:"REPT",31:"MID",32:"LEN",33:"VALUE",34:"TRUE",35:"FALSE",36:"AND",37:"OR",38:"NOT",39:"MOD",40:"DCOUNT",41:"DSUM",42:"DAVERAGE",43:"DMIN",44:"DMAX",45:"DSTDEV",46:"VAR",47:"DVAR",48:"TEXT",49:"LINEST",50:"TREND",51:"LOGEST",52:"GROWTH",53:"GOTO",54:"HALT",55:"RETURN",56:"PV",57:"FV",58:"NPER",59:"PMT",60:"RATE",61:"MIRR",62:"IRR",63:"RAND",64:"MATCH",65:"DATE",66:"TIME",67:"DAY",68:"MONTH",69:"YEAR",70:"WEEKDAY",71:"HOUR",72:"MINUTE",73:"SECOND",74:"NOW",75:"AREAS",76:"ROWS",77:"COLUMNS",78:"OFFSET",79:"ABSREF",80:"RELREF",81:"ARGUMENT",82:"SEARCH",83:"TRANSPOSE",84:"ERROR",85:"STEP",86:"TYPE",87:"ECHO",88:"SET.NAME",89:"CALLER",90:"DEREF",91:"WINDOWS",92:"SERIES",93:"DOCUMENTS",94:"ACTIVE.CELL",95:"SELECTION",96:"RESULT",97:"ATAN2",98:"ASIN",99:"ACOS",100:"CHOOSE",101:"HLOOKUP",102:"VLOOKUP",103:"LINKS",104:"INPUT",105:"ISREF",106:"GET.FORMULA",107:"GET.NAME",108:"SET.VALUE",109:"LOG",110:"EXEC",111:"CHAR",112:"LOWER",113:"UPPER",114:"PROPER",115:"LEFT",116:"RIGHT",117:"EXACT",118:"TRIM",119:"REPLACE",120:"SUBSTITUTE",121:"CODE",122:"NAMES",123:"DIRECTORY",124:"FIND",125:"CELL",126:"ISERR",127:"ISTEXT",128:"ISNUMBER",129:"ISBLANK",130:"T",131:"N",132:"FOPEN",133:"FCLOSE",134:"FSIZE",135:"FREADLN",136:"FREAD",137:"FWRITELN",138:"FWRITE",139:"FPOS",140:"DATEVALUE",141:"TIMEVALUE",142:"SLN",143:"SYD",144:"DDB",145:"GET.DEF",146:"REFTEXT",147:"TEXTREF",148:"INDIRECT",149:"REGISTER",150:"CALL",151:"ADD.BAR",152:"ADD.MENU",153:"ADD.COMMAND",154:"ENABLE.COMMAND",155:"CHECK.COMMAND",156:"RENAME.COMMAND",157:"SHOW.BAR",158:"DELETE.MENU",159:"DELETE.COMMAND",160:"GET.CHART.ITEM",161:"DIALOG.BOX",162:"CLEAN",163:"MDETERM",164:"MINVERSE",165:"MMULT",166:"FILES",167:"IPMT",168:"PPMT",169:"COUNTA",170:"CANCEL.KEY",171:"FOR",172:"WHILE",173:"BREAK",174:"NEXT",175:"INITIATE",176:"REQUEST",177:"POKE",178:"EXECUTE",179:"TERMINATE",180:"RESTART",181:"HELP",182:"GET.BAR",183:"PRODUCT",184:"FACT",185:"GET.CELL",186:"GET.WORKSPACE",187:"GET.WINDOW",188:"GET.DOCUMENT",189:"DPRODUCT",190:"ISNONTEXT",191:"GET.NOTE",192:"NOTE",193:"STDEVP",194:"VARP",195:"DSTDEVP",196:"DVARP",197:"TRUNC",198:"ISLOGICAL",199:"DCOUNTA",200:"DELETE.BAR",201:"UNREGISTER",204:"USDOLLAR",205:"FINDB",206:"SEARCHB",207:"REPLACEB",208:"LEFTB",209:"RIGHTB",210:"MIDB",211:"LENB",212:"ROUNDUP",213:"ROUNDDOWN",214:"ASC",215:"DBCS",216:"RANK",219:"ADDRESS",220:"DAYS360",221:"TODAY",222:"VDB",223:"ELSE",224:"ELSE.IF",225:"END.IF",226:"FOR.CELL",227:"MEDIAN",228:"SUMPRODUCT",229:"SINH",230:"COSH",231:"TANH",232:"ASINH",233:"ACOSH",234:"ATANH",235:"DGET",236:"CREATE.OBJECT",237:"VOLATILE",238:"LAST.ERROR",239:"CUSTOM.UNDO",240:"CUSTOM.REPEAT",241:"FORMULA.CONVERT",242:"GET.LINK.INFO",243:"TEXT.BOX",244:"INFO",245:"GROUP",246:"GET.OBJECT",247:"DB",248:"PAUSE",251:"RESUME",252:"FREQUENCY",253:"ADD.TOOLBAR",254:"DELETE.TOOLBAR",255:"User",256:"RESET.TOOLBAR",257:"EVALUATE",258:"GET.TOOLBAR",259:"GET.TOOL",260:"SPELLING.CHECK",261:"ERROR.TYPE",262:"APP.TITLE",263:"WINDOW.TITLE",264:"SAVE.TOOLBAR",265:"ENABLE.TOOL",266:"PRESS.TOOL",267:"REGISTER.ID",268:"GET.WORKBOOK",269:"AVEDEV",270:"BETADIST",271:"GAMMALN",272:"BETAINV",273:"BINOMDIST",274:"CHIDIST",275:"CHIINV",276:"COMBIN",277:"CONFIDENCE",278:"CRITBINOM",279:"EVEN",280:"EXPONDIST",281:"FDIST",282:"FINV",283:"FISHER",284:"FISHERINV",285:"FLOOR",286:"GAMMADIST",287:"GAMMAINV",288:"CEILING",289:"HYPGEOMDIST",290:"LOGNORMDIST",291:"LOGINV",292:"NEGBINOMDIST",293:"NORMDIST",294:"NORMSDIST",295:"NORMINV",296:"NORMSINV",297:"STANDARDIZE",298:"ODD",299:"PERMUT",300:"POISSON",301:"TDIST",302:"WEIBULL",303:"SUMXMY2",304:"SUMX2MY2",305:"SUMX2PY2",306:"CHITEST",307:"CORREL",308:"COVAR",309:"FORECAST",310:"FTEST",311:"INTERCEPT",312:"PEARSON",313:"RSQ",314:"STEYX",315:"SLOPE",316:"TTEST",317:"PROB",318:"DEVSQ",319:"GEOMEAN",320:"HARMEAN",321:"SUMSQ",322:"KURT",323:"SKEW",324:"ZTEST",325:"LARGE",326:"SMALL",327:"QUARTILE",328:"PERCENTILE",329:"PERCENTRANK",330:"MODE",331:"TRIMMEAN",332:"TINV",334:"MOVIE.COMMAND",335:"GET.MOVIE",336:"CONCATENATE",337:"POWER",338:"PIVOT.ADD.DATA",339:"GET.PIVOT.TABLE",340:"GET.PIVOT.FIELD",341:"GET.PIVOT.ITEM",342:"RADIANS",343:"DEGREES",344:"SUBTOTAL",345:"SUMIF",346:"COUNTIF",347:"COUNTBLANK",348:"SCENARIO.GET",349:"OPTIONS.LISTS.GET",350:"ISPMT",351:"DATEDIF",352:"DATESTRING",353:"NUMBERSTRING",354:"ROMAN",355:"OPEN.DIALOG",356:"SAVE.DIALOG",357:"VIEW.GET",358:"GETPIVOTDATA",359:"HYPERLINK",360:"PHONETIC",361:"AVERAGEA",362:"MAXA",363:"MINA",364:"STDEVPA",365:"VARPA",366:"STDEVA",367:"VARA",368:"BAHTTEXT",369:"THAIDAYOFWEEK",370:"THAIDIGIT",371:"THAIMONTHOFYEAR",372:"THAINUMSOUND",373:"THAINUMSTRING",374:"THAISTRINGLENGTH",375:"ISTHAIDIGIT",376:"ROUNDBAHTDOWN",377:"ROUNDBAHTUP",378:"THAIYEAR",379:"RTD",380:"CUBEVALUE",381:"CUBEMEMBER",382:"CUBEMEMBERPROPERTY",383:"CUBERANKEDMEMBER",384:"HEX2BIN",385:"HEX2DEC",386:"HEX2OCT",387:"DEC2BIN",388:"DEC2HEX",389:"DEC2OCT",390:"OCT2BIN",391:"OCT2HEX",392:"OCT2DEC",393:"BIN2DEC",394:"BIN2OCT",395:"BIN2HEX",396:"IMSUB",397:"IMDIV",398:"IMPOWER",399:"IMABS",400:"IMSQRT",401:"IMLN",402:"IMLOG2",403:"IMLOG10",404:"IMSIN",405:"IMCOS",406:"IMEXP",407:"IMARGUMENT",408:"IMCONJUGATE",409:"IMAGINARY",410:"IMREAL",411:"COMPLEX",412:"IMSUM",413:"IMPRODUCT",414:"SERIESSUM",415:"FACTDOUBLE",416:"SQRTPI",417:"QUOTIENT",418:"DELTA",419:"GESTEP",420:"ISEVEN",421:"ISODD",422:"MROUND",423:"ERF",424:"ERFC",425:"BESSELJ",426:"BESSELK",427:"BESSELY",428:"BESSELI",429:"XIRR",430:"XNPV",431:"PRICEMAT",432:"YIELDMAT",433:"INTRATE",434:"RECEIVED",435:"DISC",436:"PRICEDISC",437:"YIELDDISC",438:"TBILLEQ",439:"TBILLPRICE",440:"TBILLYIELD",441:"PRICE",442:"YIELD",443:"DOLLARDE",444:"DOLLARFR",445:"NOMINAL",446:"EFFECT",447:"CUMPRINC",448:"CUMIPMT",449:"EDATE",450:"EOMONTH",451:"YEARFRAC",452:"COUPDAYBS",453:"COUPDAYS",454:"COUPDAYSNC",455:"COUPNCD",456:"COUPNUM",457:"COUPPCD",458:"DURATION",459:"MDURATION",460:"ODDLPRICE",461:"ODDLYIELD",462:"ODDFPRICE",463:"ODDFYIELD",464:"RANDBETWEEN",465:"WEEKNUM",466:"AMORDEGRC",467:"AMORLINC",468:"CONVERT",724:"SHEETJS",469:"ACCRINT",470:"ACCRINTM",471:"WORKDAY",472:"NETWORKDAYS",473:"GCD",474:"MULTINOMIAL",475:"LCM",476:"FVSCHEDULE",477:"CUBEKPIMEMBER",478:"CUBESET",479:"CUBESETCOUNT",480:"IFERROR",481:"COUNTIFS",482:"SUMIFS",483:"AVERAGEIF",484:"AVERAGEIFS"},lte={2:1,3:1,10:0,15:1,16:1,17:1,18:1,19:0,20:1,21:1,22:1,23:1,24:1,25:1,26:1,27:2,30:2,31:3,32:1,33:1,34:0,35:0,38:1,39:2,40:3,41:3,42:3,43:3,44:3,45:3,47:3,48:2,53:1,61:3,63:0,65:3,66:3,67:1,68:1,69:1,70:1,71:1,72:1,73:1,74:0,75:1,76:1,77:1,79:2,80:2,83:1,85:0,86:1,89:0,90:1,94:0,95:0,97:2,98:1,99:1,101:3,102:3,105:1,106:1,108:2,111:1,112:1,113:1,114:1,117:2,118:1,119:4,121:1,126:1,127:1,128:1,129:1,130:1,131:1,133:1,134:1,135:1,136:2,137:2,138:2,140:1,141:1,142:3,143:4,144:4,161:1,162:1,163:1,164:1,165:2,172:1,175:2,176:2,177:3,178:2,179:1,184:1,186:1,189:3,190:1,195:3,196:3,197:1,198:1,199:3,201:1,207:4,210:3,211:1,212:2,213:2,214:1,215:1,225:0,229:1,230:1,231:1,232:1,233:1,234:1,235:3,244:1,247:4,252:2,257:1,261:1,271:1,273:4,274:2,275:2,276:2,277:3,278:3,279:1,280:3,281:3,282:3,283:1,284:1,285:2,286:4,287:3,288:2,289:4,290:3,291:3,292:3,293:4,294:1,295:3,296:1,297:3,298:1,299:2,300:3,301:3,302:4,303:2,304:2,305:2,306:2,307:2,308:2,309:3,310:2,311:2,312:2,313:2,314:2,315:2,316:4,325:2,326:2,327:2,328:2,331:2,332:2,337:2,342:1,343:1,346:2,347:1,350:4,351:3,352:1,353:2,360:1,368:1,369:1,370:1,371:1,372:1,373:1,374:1,375:1,376:1,377:1,378:1,382:3,385:1,392:1,393:1,396:2,397:2,398:2,399:1,400:1,401:1,402:1,403:1,404:1,405:1,406:1,407:1,408:1,409:1,410:1,414:4,415:1,416:1,417:2,420:1,421:1,422:2,424:1,425:2,426:2,427:2,428:2,430:3,438:3,439:3,440:3,443:2,444:2,445:2,446:2,447:6,448:6,449:2,450:2,464:2,468:3,476:2,479:1,480:2,65535:0};function ute(e){return("of:="+e.replace(Eee,"$1[.$2$3$4$5]").replace(/\]:\[/g,":")).replace(/;/g,"|").replace(/,/g,";")}function hte(e){return e.replace(/\./,"!")}var dte="undefined"!==typeof Map;function fte(e,t,n){var r=0,a=e.length;if(n){if(dte?n.has(t):Object.prototype.hasOwnProperty.call(n,t))for(var i=dte?n.get(t):n[t];r<i.length;++r)if(e[i[r]].t===t)return e.Count++,i[r]}else for(;r<a;++r)if(e[r].t===t)return e.Count++,r;return e[a]={t:t},e.Count++,e.Unique++,n&&(dte?(n.has(t)||n.set(t,[]),n.get(t).push(a)):(Object.prototype.hasOwnProperty.call(n,t)||(n[t]=[]),n[t].push(a))),a}function pte(e,t){var n={min:e+1,max:e+1},r=-1;return t.MDW&&(K9=t.MDW),null!=t.width?n.customWidth=1:null!=t.wpx?r=Y9(t.wpx):null!=t.wch&&(r=t.wch),r>-1?(n.width=$9(r),n.customWidth=1):null!=t.width&&(n.width=t.width),t.hidden&&(n.hidden=!0),null!=t.level&&(n.outlineLevel=n.level=t.level),n}function mte(e,t){if(e){var n=[.7,.7,.75,.75,.3,.3];"xlml"==t&&(n=[1,1,1,1,.5,.5]),null==e.left&&(e.left=n[0]),null==e.right&&(e.right=n[1]),null==e.top&&(e.top=n[2]),null==e.bottom&&(e.bottom=n[3]),null==e.header&&(e.header=n[4]),null==e.footer&&(e.footer=n[5])}}function gte(e,t,n){var r=n.revssf[null!=t.z?t.z:"General"],a=60,i=e.length;if(null==r&&n.ssf)for(;a<392;++a)if(null==n.ssf[a]){j5(t.z,a),n.ssf[a]=t.z,n.revssf[t.z]=r=a;break}for(a=0;a!=i;++a)if(e[a].numFmtId===r)return a;return e[i]={numFmtId:r,fontId:0,fillId:0,borderId:0,xfId:0,applyNumberFormat:1},i}function vte(e,t,n){if(e&&e["!ref"]){var r=t7(e["!ref"]);if(r.e.c<r.s.c||r.e.r<r.s.r)throw new Error("Bad range ("+n+"): "+e["!ref"])}}var bte=["objects","scenarios","selectLockedCells","selectUnlockedCells"],yte=["formatColumns","formatRows","formatCells","insertColumns","insertRows","insertHyperlinks","deleteColumns","deleteRows","sort","autoFilter","pivotTables"];function xte(e,t,n,r){if(e.c&&n["!comments"].push([t,e.c]),void 0===e.v&&"string"!==typeof e.f||"z"===e.t&&!e.f)return"";var a="",i=e.t,o=e.v;if("z"!==e.t)switch(e.t){case"b":a=e.v?"1":"0";break;case"n":a=""+e.v;break;case"e":a=j7[e.v];break;case"d":r&&r.cellDates?a=o6(e.v,-1).toISOString():((e=c6(e)).t="n",a=""+(e.v=Q5(o6(e.v)))),"undefined"===typeof e.z&&(e.z=i5[14]);break;default:a=e.v}var s=D6("v",x6(a)),c={r:t},l=gte(r.cellXfs,e,r);switch(0!==l&&(c.s=l),e.t){case"n":case"z":break;case"d":c.t="d";break;case"b":c.t="b";break;case"e":c.t="e";break;default:if(null==e.v){delete e.t;break}if(e.v.length>32767)throw new Error("Text length must not exceed 32767 characters");if(r&&r.bookSST){s=D6("v",""+fte(r.Strings,e.v,r.revStrings)),c.t="s";break}c.t="str"}if(e.t!=i&&(e.t=i,e.v=o),"string"==typeof e.f&&e.f){var u=e.F&&e.F.slice(0,t.length)==t?{t:"array",ref:e.F}:null;s=L6("f",x6(e.f),u)+(null!=e.v?s:"")}return e.l&&n["!links"].push([t,e.l]),e.D&&(c.cm=1),L6("c",s,c)}function wte(e,t,n,r){var a,i=[m6,L6("worksheet",null,{xmlns:$6[0],"xmlns:r":q6})],o=n.SheetNames[e],s="",c=n.Sheets[o];null==c&&(c={});var l=c["!ref"]||"A1",u=t7(l);if(u.e.c>16383||u.e.r>1048575){if(t.WTF)throw new Error("Range "+l+" exceeds format limit A1:XFD1048576");u.e.c=Math.min(u.e.c,16383),u.e.r=Math.min(u.e.c,1048575),l=e7(u)}r||(r={}),c["!comments"]=[];var h=[];!function(e,t,n,r,a){var i=!1,o={},s=null;if("xlsx"!==r.bookType&&t.vbaraw){var c=t.SheetNames[n];try{t.Workbook&&(c=t.Workbook.Sheets[n].CodeName||c)}catch(_a){}i=!0,o.codeName=A6(x6(c))}if(e&&e["!outline"]){var l={summaryBelow:1,summaryRight:1};e["!outline"].above&&(l.summaryBelow=0),e["!outline"].left&&(l.summaryRight=0),s=(s||"")+L6("outlinePr",null,l)}(i||s)&&(a[a.length]=L6("sheetPr",s,o))}(c,n,e,t,i),i[i.length]=L6("dimension",null,{ref:l}),i[i.length]=function(e,t,n,r){var a={workbookViewId:"0"};return(((r||{}).Workbook||{}).Views||[])[0]&&(a.rightToLeft=r.Workbook.Views[0].RTL?"1":"0"),L6("sheetViews",L6("sheetView",null,a),{})}(0,0,0,n),t.sheetFormat&&(i[i.length]=L6("sheetFormatPr",null,{defaultRowHeight:t.sheetFormat.defaultRowHeight||"16",baseColWidth:t.sheetFormat.baseColWidth||"10",outlineLevelRow:t.sheetFormat.outlineLevelRow||"7"})),null!=c["!cols"]&&c["!cols"].length>0&&(i[i.length]=function(e,t){for(var n,r=["<cols>"],a=0;a!=t.length;++a)(n=t[a])&&(r[r.length]=L6("col",null,pte(a,n)));return r[r.length]="</cols>",r.join("")}(0,c["!cols"])),i[a=i.length]="<sheetData/>",c["!links"]=[],null!=c["!ref"]&&(s=function(e,t){var n,r,a=[],i=[],o=t7(e["!ref"]),s="",c="",l=[],u=0,h=0,d=e["!rows"],f=Array.isArray(e),p={r:c},m=-1;for(h=o.s.c;h<=o.e.c;++h)l[h]=$8(h);for(u=o.s.r;u<=o.e.r;++u){for(i=[],c=X8(u),h=o.s.c;h<=o.e.c;++h){n=l[h]+c;var g=f?(e[u]||[])[h]:e[n];void 0!==g&&null!=(s=xte(g,n,e,t))&&i.push(s)}(i.length>0||d&&d[u])&&(p={r:c},d&&d[u]&&((r=d[u]).hidden&&(p.hidden=1),m=-1,r.hpx?m=Z9(r.hpx):r.hpt&&(m=r.hpt),m>-1&&(p.ht=m,p.customHeight=1),r.level&&(p.outlineLevel=r.level)),a[a.length]=L6("row",i.join(""),p))}if(d)for(;u<d.length;++u)d&&d[u]&&(p={r:u+1},(r=d[u]).hidden&&(p.hidden=1),m=-1,r.hpx?m=Z9(r.hpx):r.hpt&&(m=r.hpt),m>-1&&(p.ht=m,p.customHeight=1),r.level&&(p.outlineLevel=r.level),a[a.length]=L6("row","",p));return a.join("")}(c,t,0,0),s.length>0&&(i[i.length]=s)),i.length>a+1&&(i[i.length]="</sheetData>",i[a]=i[a].replace("/>",">")),c["!protect"]&&(i[i.length]=function(e){var t={sheet:1};return bte.forEach(function(n){null!=e[n]&&e[n]&&(t[n]="1")}),yte.forEach(function(n){null==e[n]||e[n]||(t[n]="0")}),e.password&&(t.password=H9(e.password).toString(16).toUpperCase()),L6("sheetProtection",null,t)}(c["!protect"])),null!=c["!autofilter"]&&(i[i.length]=function(e,t,n,r){var a="string"==typeof e.ref?e.ref:e7(e.ref);n.Workbook||(n.Workbook={Sheets:[]}),n.Workbook.Names||(n.Workbook.Names=[]);var i=n.Workbook.Names,o=Z8(a);o.s.r==o.e.r&&(o.e.r=Z8(t["!ref"]).e.r,a=e7(o));for(var s=0;s<i.length;++s){var c=i[s];if("_xlnm._FilterDatabase"==c.Name&&c.Sheet==r){c.Ref="'"+n.SheetNames[r]+"'!"+a;break}}return s==i.length&&i.push({Name:"_xlnm._FilterDatabase",Sheet:r,Ref:"'"+n.SheetNames[r]+"'!"+a}),L6("autoFilter",null,{ref:a})}(c["!autofilter"],c,n,e)),null!=c["!merges"]&&c["!merges"].length>0&&(i[i.length]=function(e){if(0===e.length)return"";for(var t='<mergeCells count="'+e.length+'">',n=0;n!=e.length;++n)t+='<mergeCell ref="'+e7(e[n])+'"/>';return t+"</mergeCells>"}(c["!merges"]));var d,f,p=-1,m=-1;return c["!links"].length>0&&(i[i.length]="<hyperlinks>",c["!links"].forEach(function(e){e[1].Target&&(d={ref:e[0]},"#"!=e[1].Target.charAt(0)&&(m=G7(r,-1,x6(e[1].Target).replace(/#.*$/,""),W7.HLINK),d["r:id"]="rId"+m),(p=e[1].Target.indexOf("#"))>-1&&(d.location=x6(e[1].Target.slice(p+1))),e[1].Tooltip&&(d.tooltip=x6(e[1].Tooltip)),i[i.length]=L6("hyperlink",null,d))}),i[i.length]="</hyperlinks>"),delete c["!links"],null!=c["!margins"]&&(i[i.length]=(mte(f=c["!margins"]),L6("pageMargins",null,f))),t&&!t.ignoreEC&&void 0!=t.ignoreEC||(i[i.length]=D6("ignoredErrors",L6("ignoredError",null,{numberStoredAsText:1,sqref:l}))),h.length>0&&(m=G7(r,-1,"../drawings/drawing"+(e+1)+".xml",W7.DRAW),i[i.length]=L6("drawing",null,{"r:id":"rId"+m}),c["!drawing"]=h),c["!comments"].length>0&&(m=G7(r,-1,"../drawings/vmlDrawing"+(e+1)+".vml",W7.VML),i[i.length]=L6("legacyDrawing",null,{"r:id":"rId"+m}),c["!legacy"]=m),i.length>1&&(i[i.length]="</worksheet>",i[1]=i[1].replace("/>",">")),i.join("")}function kte(e,t,n,r){var a=function(e,t,n){var r=z8(145),a=(n["!rows"]||[])[e]||{};r.write_shift(4,e),r.write_shift(4,0);var i=320;a.hpx?i=20*Z9(a.hpx):a.hpt&&(i=20*a.hpt),r.write_shift(2,i),r.write_shift(1,0);var o=0;a.level&&(o|=a.level),a.hidden&&(o|=16),(a.hpx||a.hpt)&&(o|=32),r.write_shift(1,o),r.write_shift(1,0);var s=0,c=r.l;r.l+=4;for(var l={r:e,c:0},u=0;u<16;++u)if(!(t.s.c>u+1<<10||t.e.c<u<<10)){for(var h=-1,d=-1,f=u<<10;f<u+1<<10;++f)l.c=f,(Array.isArray(n)?(n[l.r]||[])[l.c]:n[Q8(l)])&&(h<0&&(h=f),d=f);h<0||(++s,r.write_shift(4,h),r.write_shift(4,d))}var p=r.l;return r.l=c,r.write_shift(4,s),r.l=p,r.length>r.l?r.slice(0,r.l):r}(r,n,t);(a.length>17||(t["!rows"]||[])[r])&&W8(e,0,a)}var Ste=T7,Nte=_7;function Cte(e){return[g7(e),A7(e),"n"]}var Ete=T7,Ite=_7;var Tte=["left","right","top","bottom","header","footer"];function _te(e,t,n,r,a,i,o){if(void 0===t.v)return!1;var s="";switch(t.t){case"b":s=t.v?"1":"0";break;case"d":(t=c6(t)).z=t.z||i5[14],t.v=Q5(o6(t.v)),t.t="n";break;case"n":case"e":s=""+t.v;break;default:s=t.v}var c={r:n,c:r};switch(c.s=gte(a.cellXfs,t,a),t.l&&i["!links"].push([Q8(c),t.l]),t.c&&i["!comments"].push([Q8(c),t.c]),t.t){case"s":case"str":return a.bookSST?(s=fte(a.Strings,t.v,a.revStrings),c.t="s",c.v=s,o?W8(e,18,function(e,t,n){return null==n&&(n=z8(8)),v7(t,n),n.write_shift(4,t.v),n}(0,c)):W8(e,7,function(e,t,n){return null==n&&(n=z8(12)),m7(t,n),n.write_shift(4,t.v),n}(0,c))):(c.t="str",o?W8(e,17,function(e,t,n){return null==n&&(n=z8(8+4*e.v.length)),v7(t,n),l7(e.v,n),n.length>n.l?n.slice(0,n.l):n}(t,c)):W8(e,6,function(e,t,n){return null==n&&(n=z8(12+4*e.v.length)),m7(t,n),l7(e.v,n),n.length>n.l?n.slice(0,n.l):n}(t,c))),!0;case"n":return t.v==(0|t.v)&&t.v>-1e3&&t.v<1e3?o?W8(e,13,function(e,t,n){return null==n&&(n=z8(8)),v7(t,n),E7(e.v,n),n}(t,c)):W8(e,2,function(e,t,n){return null==n&&(n=z8(12)),m7(t,n),E7(e.v,n),n}(t,c)):o?W8(e,16,function(e,t,n){return null==n&&(n=z8(12)),v7(t,n),R7(e.v,n),n}(t,c)):W8(e,5,function(e,t,n){return null==n&&(n=z8(16)),m7(t,n),R7(e.v,n),n}(t,c)),!0;case"b":return c.t="b",o?W8(e,15,function(e,t,n){return null==n&&(n=z8(5)),v7(t,n),n.write_shift(1,e.v?1:0),n}(t,c)):W8(e,4,function(e,t,n){return null==n&&(n=z8(9)),m7(t,n),n.write_shift(1,e.v?1:0),n}(t,c)),!0;case"e":return c.t="e",o?W8(e,14,function(e,t,n){return null==n&&(n=z8(8)),v7(t,n),n.write_shift(1,e.v),n.write_shift(2,0),n.write_shift(1,0),n}(t,c)):W8(e,3,function(e,t,n){return null==n&&(n=z8(9)),m7(t,n),n.write_shift(1,e.v),n}(t,c)),!0}return o?W8(e,12,function(e,t,n){return null==n&&(n=z8(4)),v7(t,n)}(0,c)):W8(e,1,function(e,t,n){return null==n&&(n=z8(8)),m7(t,n)}(0,c)),!0}function Ate(e,t){t&&t["!merges"]&&(W8(e,177,function(e,t){return null==t&&(t=z8(4)),t.write_shift(4,e),t}(t["!merges"].length)),t["!merges"].forEach(function(t){W8(e,176,Ite(t))}),W8(e,178))}function Rte(e,t){t&&t["!cols"]&&(W8(e,390),t["!cols"].forEach(function(t,n){t&&W8(e,60,function(e,t,n){null==n&&(n=z8(18));var r=pte(e,t);n.write_shift(-4,e),n.write_shift(-4,e),n.write_shift(4,256*(r.width||10)),n.write_shift(4,0);var a=0;return t.hidden&&(a|=1),"number"==typeof r.width&&(a|=2),t.level&&(a|=t.level<<8),n.write_shift(2,a),n}(n,t))}),W8(e,391))}function Fte(e,t){t&&t["!ref"]&&(W8(e,648),W8(e,649,function(e){var t=z8(24);return t.write_shift(4,4),t.write_shift(4,1),_7(e,t),t}(t7(t["!ref"]))),W8(e,650))}function Dte(e,t,n){t["!links"].forEach(function(t){if(t[1].Target){var r=G7(n,-1,t[1].Target.replace(/#.*$/,""),W7.HLINK);W8(e,494,function(e,t){var n=z8(50+4*(e[1].Target.length+(e[1].Tooltip||"").length));_7({s:J8(e[0]),e:J8(e[0])},n),N7("rId"+t,n);var r=e[1].Target.indexOf("#");return l7((-1==r?"":e[1].Target.slice(r+1))||"",n),l7(e[1].Tooltip||"",n),l7("",n),n.slice(0,n.l)}(t,r))}}),delete t["!links"]}function Ote(e,t,n){W8(e,133),W8(e,137,function(e,t,n){null==n&&(n=z8(30));var r=924;return(((t||{}).Views||[])[0]||{}).RTL&&(r|=32),n.write_shift(2,r),n.write_shift(4,0),n.write_shift(4,0),n.write_shift(4,0),n.write_shift(1,0),n.write_shift(1,0),n.write_shift(2,0),n.write_shift(2,100),n.write_shift(2,0),n.write_shift(2,0),n.write_shift(2,0),n.write_shift(4,0),n}(0,n)),W8(e,138),W8(e,134)}function Lte(e,t){t["!protect"]&&W8(e,535,function(e,t){return null==t&&(t=z8(66)),t.write_shift(2,e.password?H9(e.password):0),t.write_shift(4,1),[["objects",!1],["scenarios",!1],["formatCells",!0],["formatColumns",!0],["formatRows",!0],["insertColumns",!0],["insertRows",!0],["insertHyperlinks",!0],["deleteColumns",!0],["deleteRows",!0],["selectLockedCells",!1],["sort",!0],["autoFilter",!0],["pivotTables",!0],["selectUnlockedCells",!1]].forEach(function(n){n[1]?t.write_shift(4,null==e[n[0]]||e[n[0]]?0:1):t.write_shift(4,null!=e[n[0]]&&e[n[0]]?0:1)}),t}(t["!protect"]))}function Pte(e,t,n,r){var a=U8(),i=n.SheetNames[e],o=n.Sheets[i]||{},s=i;try{n&&n.Workbook&&(s=n.Workbook.Sheets[e].CodeName||s)}catch(_a){}var c=t7(o["!ref"]||"A1");if(c.e.c>16383||c.e.r>1048575){if(t.WTF)throw new Error("Range "+(o["!ref"]||"A1")+" exceeds format limit A1:XFD1048576");c.e.c=Math.min(c.e.c,16383),c.e.r=Math.min(c.e.c,1048575)}return o["!links"]=[],o["!comments"]=[],W8(a,129),(n.vbaraw||o["!outline"])&&W8(a,147,function(e,t,n){null==n&&(n=z8(84+4*e.length));var r=192;t&&(t.above&&(r&=-65),t.left&&(r&=-129)),n.write_shift(1,r);for(var a=1;a<3;++a)n.write_shift(1,0);return F7({auto:1},n),n.write_shift(-4,-1),n.write_shift(-4,-1),y7(e,n),n.slice(0,n.l)}(s,o["!outline"])),W8(a,148,Nte(c)),Ote(a,0,n.Workbook),Rte(a,o),function(e,t,n,r){var a,i=t7(t["!ref"]||"A1"),o="",s=[];W8(e,145);var c=Array.isArray(t),l=i.e.r;t["!rows"]&&(l=Math.max(i.e.r,t["!rows"].length-1));for(var u=i.s.r;u<=l;++u){o=X8(u),kte(e,t,i,u);var h=!1;if(u<=i.e.r)for(var d=i.s.c;d<=i.e.c;++d){u===i.s.r&&(s[d]=$8(d)),a=s[d]+o;var f=c?(t[u]||[])[d]:t[a];h=!!f&&_te(e,f,u,d,r,t,h)}}W8(e,146)}(a,o,0,t),Lte(a,o),function(e,t,n,r){if(t["!autofilter"]){var a=t["!autofilter"],i="string"===typeof a.ref?a.ref:e7(a.ref);n.Workbook||(n.Workbook={Sheets:[]}),n.Workbook.Names||(n.Workbook.Names=[]);var o=n.Workbook.Names,s=Z8(i);s.s.r==s.e.r&&(s.e.r=Z8(t["!ref"]).e.r,i=e7(s));for(var c=0;c<o.length;++c){var l=o[c];if("_xlnm._FilterDatabase"==l.Name&&l.Sheet==r){l.Ref="'"+n.SheetNames[r]+"'!"+i;break}}c==o.length&&o.push({Name:"_xlnm._FilterDatabase",Sheet:r,Ref:"'"+n.SheetNames[r]+"'!"+i}),W8(e,161,_7(t7(i))),W8(e,162)}}(a,o,n,e),Ate(a,o),Dte(a,o,r),o["!margins"]&&W8(a,476,function(e,t){return null==t&&(t=z8(48)),mte(e),Tte.forEach(function(n){R7(e[n],t)}),t}(o["!margins"])),t&&!t.ignoreEC&&void 0!=t.ignoreEC||Fte(a,o),function(e,t,n,r){if(t["!comments"].length>0){var a=G7(r,-1,"../drawings/vmlDrawing"+(n+1)+".vml",W7.VML);W8(e,551,N7("rId"+a)),t["!legacy"]=a}}(a,o,e,r),W8(a,130),a.end()}var Mte=[["allowRefreshQuery",!1,"bool"],["autoCompressPictures",!0,"bool"],["backupFile",!1,"bool"],["checkCompatibility",!1,"bool"],["CodeName",""],["date1904",!1,"bool"],["defaultThemeVersion",0,"int"],["filterPrivacy",!1,"bool"],["hidePivotFieldList",!1,"bool"],["promptedSolutions",!1,"bool"],["publishItems",!1,"bool"],["refreshAllConnections",!1,"bool"],["saveExternalLinkValues",!0,"bool"],["showBorderUnselectedTables",!0,"bool"],["showInkAnnotation",!0,"bool"],["showObjects","all"],["showPivotChartFilter",!1,"bool"],["updateLinks","userSet"]];var jte="][*?/\\".split("");function Bte(e,t){if(e.length>31){if(t)return!1;throw new Error("Sheet names cannot exceed 31 chars")}var n=!0;return jte.forEach(function(r){if(-1!=e.indexOf(r)){if(!t)throw new Error("Sheet name cannot contain : \\ / ? * [ ]");n=!1}}),n}function zte(e){if(!e||!e.SheetNames||!e.Sheets)throw new Error("Invalid Workbook");if(!e.SheetNames.length)throw new Error("Workbook is empty");var t=e.Workbook&&e.Workbook.Sheets||[];!function(e,t,n){e.forEach(function(r,a){Bte(r);for(var i=0;i<a;++i)if(r==e[i])throw new Error("Duplicate Sheet Name: "+r);if(n){var o=t&&t[a]&&t[a].CodeName||r;if(95==o.charCodeAt(0)&&o.length>22)throw new Error("Bad Code Name: Worksheet"+o)}})}(e.SheetNames,t,!!e.vbaraw);for(var n=0;n<e.SheetNames.length;++n)vte(e.Sheets[e.SheetNames[n]],e.SheetNames[n],n)}function Ute(e){var t=[m6];t[t.length]=L6("workbook",null,{xmlns:$6[0],"xmlns:r":q6});var n=e.Workbook&&(e.Workbook.Names||[]).length>0,r={codeName:"ThisWorkbook"};e.Workbook&&e.Workbook.WBProps&&(Mte.forEach(function(t){null!=e.Workbook.WBProps[t[0]]&&e.Workbook.WBProps[t[0]]!=t[1]&&(r[t[0]]=e.Workbook.WBProps[t[0]])}),e.Workbook.WBProps.CodeName&&(r.codeName=e.Workbook.WBProps.CodeName,delete r.CodeName)),t[t.length]=L6("workbookPr",null,r);var a=e.Workbook&&e.Workbook.Sheets||[],i=0;if(a&&a[0]&&a[0].Hidden){for(t[t.length]="<bookViews>",i=0;i!=e.SheetNames.length&&a[i]&&a[i].Hidden;++i);i==e.SheetNames.length&&(i=0),t[t.length]='<workbookView firstSheet="'+i+'" activeTab="'+i+'"/>',t[t.length]="</bookViews>"}for(t[t.length]="<sheets>",i=0;i!=e.SheetNames.length;++i){var o={name:x6(e.SheetNames[i].slice(0,31))};if(o.sheetId=""+(i+1),o["r:id"]="rId"+(i+1),a[i])switch(a[i].Hidden){case 1:o.state="hidden";break;case 2:o.state="veryHidden"}t[t.length]=L6("sheet",null,o)}return t[t.length]="</sheets>",n&&(t[t.length]="<definedNames>",e.Workbook&&e.Workbook.Names&&e.Workbook.Names.forEach(function(e){var n={name:e.Name};e.Comment&&(n.comment=e.Comment),null!=e.Sheet&&(n.localSheetId=""+e.Sheet),e.Hidden&&(n.hidden="1"),e.Ref&&(t[t.length]=L6("definedName",x6(e.Ref),n))}),t[t.length]="</definedNames>"),t.length>2&&(t[t.length]="</workbook>",t[1]=t[1].replace("/>",">")),t.join("")}function Wte(e,t){return t||(t=z8(127)),t.write_shift(4,e.Hidden),t.write_shift(4,e.iTabID),N7(e.strRelID,t),l7(e.name.slice(0,31),t),t.length>t.l?t.slice(0,t.l):t}function Vte(e,t){if(t.Workbook&&t.Workbook.Sheets){for(var n=t.Workbook.Sheets,r=0,a=-1,i=-1;r<n.length;++r)!n[r]||!n[r].Hidden&&-1==a?a=r:1==n[r].Hidden&&-1==i&&(i=r);i>a||(W8(e,135),W8(e,158,function(e,t){return t||(t=z8(29)),t.write_shift(-4,0),t.write_shift(-4,460),t.write_shift(4,28800),t.write_shift(4,17600),t.write_shift(4,500),t.write_shift(4,e),t.write_shift(4,e),t.write_shift(1,120),t.length>t.l?t.slice(0,t.l):t}(a)),W8(e,136))}}function Hte(e,t){var n=U8();return W8(n,131),W8(n,128,function(e,t){t||(t=z8(127));for(var n=0;4!=n;++n)t.write_shift(4,0);return l7("SheetJS",t),l7(C3.version,t),l7(C3.version,t),l7("7262",t),t.length>t.l?t.slice(0,t.l):t}()),W8(n,153,function(e,t){t||(t=z8(72));var n=0;return e&&e.filterPrivacy&&(n|=8),t.write_shift(4,n),t.write_shift(4,0),y7(e&&e.CodeName||"ThisWorkbook",t),t.slice(0,t.l)}(e.Workbook&&e.Workbook.WBProps||null)),Vte(n,e),function(e,t){W8(e,143);for(var n=0;n!=t.SheetNames.length;++n)W8(e,156,Wte({Hidden:t.Workbook&&t.Workbook.Sheets&&t.Workbook.Sheets[n]&&t.Workbook.Sheets[n].Hidden||0,iTabID:n+1,strRelID:"rId"+(n+1),name:t.SheetNames[n]}));W8(e,144)}(n,e),W8(n,132),n.end()}function Gte(e,t,n,r,a){return(".bin"===t.slice(-4)?Pte:wte)(e,n,r,a)}function qte(e,t,n){return(".bin"===t.slice(-4)?See:xee)(e,n)}function Kte(e,t){var n=[];return e.Props&&n.push(function(e,t){var n=[];return K5(n9).map(function(e){for(var t=0;t<Y7.length;++t)if(Y7[t][1]==e)return Y7[t];for(t=0;t<Q7.length;++t)if(Q7[t][1]==e)return Q7[t];throw e}).forEach(function(r){if(null!=e[r[1]]){var a=t&&t.Props&&null!=t.Props[r[1]]?t.Props[r[1]]:e[r[1]];"date"===r[2]&&(a=new Date(a).toISOString().replace(/\.\d*Z/,"Z")),"number"==typeof a?a=String(a):!0===a||!1===a?a=a?"1":"0":a instanceof Date&&(a=new Date(a).toISOString().replace(/\.\d*Z/,"")),n.push(D6(n9[r[1]]||r[1],a))}}),L6("DocumentProperties",n.join(""),{xmlns:J6})}(e.Props,t)),e.Custprops&&n.push(function(e,t){var n=["Worksheets","SheetNames"],r="CustomDocumentProperties",a=[];return e&&K5(e).forEach(function(t){if(Object.prototype.hasOwnProperty.call(e,t)){for(var r=0;r<Y7.length;++r)if(t==Y7[r][1])return;for(r=0;r<Q7.length;++r)if(t==Q7[r][1])return;for(r=0;r<n.length;++r)if(t==n[r])return;var i=e[t],o="string";"number"==typeof i?(o="float",i=String(i)):!0===i||!1===i?(o="boolean",i=i?"1":"0"):i=String(i),a.push(L6(w6(t),i,{"dt:dt":o}))}}),t&&K5(t).forEach(function(n){if(Object.prototype.hasOwnProperty.call(t,n)&&(!e||!Object.prototype.hasOwnProperty.call(e,n))){var r=t[n],i="string";"number"==typeof r?(i="float",r=String(r)):!0===r||!1===r?(i="boolean",r=r?"1":"0"):r instanceof Date?(i="dateTime.tz",r=r.toISOString()):r=String(r),a.push(L6(w6(n),r,{"dt:dt":i}))}}),"<"+r+' xmlns="'+J6+'">'+a.join("")+"</"+r+">"}(e.Props,e.Custprops)),n.join("")}function Xte(e){return L6("NamedRange",null,{"ss:Name":e.Name,"ss:RefersTo":"="+Iee(e.Ref,{r:0,c:0})})}function Yte(e,t,n,r,a,i,o){if(!e||void 0==e.v&&void 0==e.f)return"";var s={};if(e.f&&(s["ss:Formula"]="="+x6(Iee(e.f,o))),e.F&&e.F.slice(0,t.length)==t){var c=J8(e.F.slice(t.length+1));s["ss:ArrayRange"]="RC:R"+(c.r==o.r?"":"["+(c.r-o.r)+"]")+"C"+(c.c==o.c?"":"["+(c.c-o.c)+"]")}if(e.l&&e.l.Target&&(s["ss:HRef"]=x6(e.l.Target),e.l.Tooltip&&(s["x:HRefScreenTip"]=x6(e.l.Tooltip))),n["!merges"])for(var l=n["!merges"],u=0;u!=l.length;++u)l[u].s.c==o.c&&l[u].s.r==o.r&&(l[u].e.c>l[u].s.c&&(s["ss:MergeAcross"]=l[u].e.c-l[u].s.c),l[u].e.r>l[u].s.r&&(s["ss:MergeDown"]=l[u].e.r-l[u].s.r));var h="",d="";switch(e.t){case"z":if(!r.sheetStubs)return"";break;case"n":h="Number",d=String(e.v);break;case"b":h="Boolean",d=e.v?"1":"0";break;case"e":h="Error",d=j7[e.v];break;case"d":h="DateTime",d=new Date(e.v).toISOString(),null==e.z&&(e.z=e.z||i5[14]);break;case"s":h="String",d=((e.v||"")+"").replace(b6,function(e){return v6[e]}).replace(k6,function(e){return"&#x"+e.charCodeAt(0).toString(16).toUpperCase()+";"})}var f=gte(r.cellXfs,e,r);s["ss:StyleID"]="s"+(21+f),s["ss:Index"]=o.c+1;var p=null!=e.v?d:"",m="z"==e.t?"":'<Data ss:Type="'+h+'">'+p+"</Data>";return(e.c||[]).length>0&&(m+=e.c.map(function(e){var t=L6("ss:Data",(e.t||"").replace(/(\r\n|[\r\n])/g,"&#10;"),{xmlns:"http://www.w3.org/TR/REC-html40"});return L6("Comment",t,{"ss:Author":e.a})}).join("")),L6("Cell",m,s)}function $te(e,t){var n='<Row ss:Index="'+(e+1)+'"';return t&&(t.hpt&&!t.hpx&&(t.hpx=eee(t.hpt)),t.hpx&&(n+=' ss:AutoFitHeight="0" ss:Height="'+t.hpx+'"'),t.hidden&&(n+=' ss:Hidden="1"')),n+">"}function Jte(e,t,n){var r=[],a=n.SheetNames[e],i=n.Sheets[a],o=i?function(e,t,n,r){if(!e)return"";if(!((r||{}).Workbook||{}).Names)return"";for(var a=r.Workbook.Names,i=[],o=0;o<a.length;++o){var s=a[o];s.Sheet==n&&(s.Name.match(/^_xlfn\./)||i.push(Xte(s)))}return i.join("")}(i,0,e,n):"";return o.length>0&&r.push("<Names>"+o+"</Names>"),o=i?function(e,t){if(!e["!ref"])return"";var n=t7(e["!ref"]),r=e["!merges"]||[],a=0,i=[];e["!cols"]&&e["!cols"].forEach(function(e,t){J9(e);var n=!!e.width,r=pte(t,e),a={"ss:Index":t+1};n&&(a["ss:Width"]=X9(r.width)),e.hidden&&(a["ss:Hidden"]="1"),i.push(L6("Column",null,a))});for(var o=Array.isArray(e),s=n.s.r;s<=n.e.r;++s){for(var c=[$te(s,(e["!rows"]||[])[s])],l=n.s.c;l<=n.e.c;++l){var u=!1;for(a=0;a!=r.length;++a)if(!(r[a].s.c>l)&&!(r[a].s.r>s)&&!(r[a].e.c<l)&&!(r[a].e.r<s)){r[a].s.c==l&&r[a].s.r==s||(u=!0);break}if(!u){var h={r:s,c:l},d=Q8(h),f=o?(e[s]||[])[l]:e[d];c.push(Yte(f,d,e,t,0,0,h))}}c.push("</Row>"),c.length>2&&i.push(c.join(""))}return i.join("")}(i,t):"",o.length>0&&r.push("<Table>"+o+"</Table>"),r.push(function(e,t,n,r){if(!e)return"";var a=[];if(e["!margins"]&&(a.push("<PageSetup>"),e["!margins"].header&&a.push(L6("Header",null,{"x:Margin":e["!margins"].header})),e["!margins"].footer&&a.push(L6("Footer",null,{"x:Margin":e["!margins"].footer})),a.push(L6("PageMargins",null,{"x:Bottom":e["!margins"].bottom||"0.75","x:Left":e["!margins"].left||"0.7","x:Right":e["!margins"].right||"0.7","x:Top":e["!margins"].top||"0.75"})),a.push("</PageSetup>")),r&&r.Workbook&&r.Workbook.Sheets&&r.Workbook.Sheets[n])if(r.Workbook.Sheets[n].Hidden)a.push(L6("Visible",1==r.Workbook.Sheets[n].Hidden?"SheetHidden":"SheetVeryHidden",{}));else{for(var i=0;i<n&&(!r.Workbook.Sheets[i]||r.Workbook.Sheets[i].Hidden);++i);i==n&&a.push("<Selected/>")}return((((r||{}).Workbook||{}).Views||[])[0]||{}).RTL&&a.push("<DisplayRightToLeft/>"),e["!protect"]&&(a.push(D6("ProtectContents","True")),e["!protect"].objects&&a.push(D6("ProtectObjects","True")),e["!protect"].scenarios&&a.push(D6("ProtectScenarios","True")),null==e["!protect"].selectLockedCells||e["!protect"].selectLockedCells?null==e["!protect"].selectUnlockedCells||e["!protect"].selectUnlockedCells||a.push(D6("EnableSelection","UnlockedCells")):a.push(D6("EnableSelection","NoSelection")),[["formatCells","AllowFormatCells"],["formatColumns","AllowSizeCols"],["formatRows","AllowSizeRows"],["insertColumns","AllowInsertCols"],["insertRows","AllowInsertRows"],["insertHyperlinks","AllowInsertHyperlinks"],["deleteColumns","AllowDeleteCols"],["deleteRows","AllowDeleteRows"],["sort","AllowSort"],["autoFilter","AllowFilter"],["pivotTables","AllowUsePivotTables"]].forEach(function(t){e["!protect"][t[0]]&&a.push("<"+t[1]+"/>")})),0==a.length?"":L6("WorksheetOptions",a.join(""),{xmlns:Q6})}(i,0,e,n)),r.join("")}function Qte(e,t){t||(t={}),e.SSF||(e.SSF=c6(i5)),e.SSF&&(z5(),B5(e.SSF),t.revssf=$5(e.SSF),t.revssf[e.SSF[65535]]=0,t.ssf=e.SSF,t.cellXfs=[],gte(t.cellXfs,{},{revssf:{General:0}}));var n=[];n.push(Kte(e,t)),n.push(""),n.push(""),n.push("");for(var r=0;r<e.SheetNames.length;++r)n.push(L6("Worksheet",Jte(r,t,e),{"ss:Name":x6(e.SheetNames[r])}));return n[2]=function(e,t){var n=['<Style ss:ID="Default" ss:Name="Normal"><NumberFormat/></Style>'];return t.cellXfs.forEach(function(e,t){var r=[];r.push(L6("NumberFormat",null,{"ss:Format":x6(i5[e.numFmtId])}));var a={"ss:ID":"s"+(21+t)};n.push(L6("Style",r.join(""),a))}),L6("Styles",n.join(""))}(0,t),n[3]=function(e){if(!((e||{}).Workbook||{}).Names)return"";for(var t=e.Workbook.Names,n=[],r=0;r<t.length;++r){var a=t[r];null==a.Sheet&&(a.Name.match(/^_xlfn\./)||n.push(Xte(a)))}return L6("Names",n.join(""))}(e),m6+L6("Workbook",n.join(""),{xmlns:Z6,"xmlns:o":J6,"xmlns:x":Q6,"xmlns:ss":Z6,"xmlns:dt":e8,"xmlns:html":r8})}var Zte="e0859ff2f94f6810ab9108002b27b3d9",ene="02d5cdd59c2e1b10939708002b2cf9ae",tne="05d5cdd59c2e1b10939708002b2cf9ae";function nne(e,t){var n=t||{},r=V5.utils.cfb_new({root:"R"}),a="/Workbook";switch(n.bookType||"xls"){case"xls":n.bookType="biff8";case"xla":n.bookType||(n.bookType="xla");case"biff8":a="/Workbook",n.biff=8;break;case"biff5":a="/Book",n.biff=5;break;default:throw new Error("invalid type "+n.bookType+" for XLS CFB")}return V5.utils.cfb_add(r,a,fne(e,n)),8==n.biff&&(e.Props||e.Custprops)&&function(e,t){var n,r=[],a=[],i=[],o=0,s=X5(O7,"n"),c=X5(L7,"n");if(e.Props)for(n=K5(e.Props),o=0;o<n.length;++o)(Object.prototype.hasOwnProperty.call(s,n[o])?r:Object.prototype.hasOwnProperty.call(c,n[o])?a:i).push([n[o],e.Props[n[o]]]);if(e.Custprops)for(n=K5(e.Custprops),o=0;o<n.length;++o)Object.prototype.hasOwnProperty.call(e.Props||{},n[o])||(Object.prototype.hasOwnProperty.call(s,n[o])?r:Object.prototype.hasOwnProperty.call(c,n[o])?a:i).push([n[o],e.Custprops[n[o]]]);var l=[];for(o=0;o<i.length;++o)a9.indexOf(i[o][0])>-1||Z7.indexOf(i[o][0])>-1||null!=i[o][1]&&l.push(i[o]);a.length&&V5.utils.cfb_add(t,"/\x05SummaryInformation",s9(a,Zte,c,L7)),(r.length||l.length)&&V5.utils.cfb_add(t,"/\x05DocumentSummaryInformation",s9(r,ene,s,O7,l.length?l:null,tne))}(e,r),8==n.biff&&e.vbaraw&&function(e,t){t.FullPaths.forEach(function(n,r){if(0!=r){var a=n.replace(/[^\/]*[\/]/,"/_VBA_PROJECT_CUR/");"/"!==a.slice(-1)&&V5.utils.cfb_add(e,a,t.FileIndex[r].content)}})}(r,V5.read(e.vbaraw,{type:"string"==typeof e.vbaraw?"binary":"buffer"})),r}var rne={0:{f:function(e,t){var n={},r=e.l+t;n.r=e.read_shift(4),e.l+=4;var a=e.read_shift(2);e.l+=1;var i=e.read_shift(1);return e.l=r,7&i&&(n.level=7&i),16&i&&(n.hidden=!0),32&i&&(n.hpt=a/20),n}},1:{f:function(e){return[p7(e)]}},2:{f:function(e){return[p7(e),C7(e),"n"]}},3:{f:function(e){return[p7(e),e.read_shift(1),"e"]}},4:{f:function(e){return[p7(e),e.read_shift(1),"b"]}},5:{f:function(e){return[p7(e),A7(e),"n"]}},6:{f:function(e){return[p7(e),c7(e),"str"]}},7:{f:function(e){return[p7(e),e.read_shift(4),"s"]}},8:{f:function(e,t,n){var r=e.l+t,a=p7(e);a.r=n["!row"];var i=[a,c7(e),"str"];if(n.cellFormula){e.l+=2;var o=ate(e,r-e.l,n);i[3]=ete(o,0,a,n.supbooks,n)}else e.l=r;return i}},9:{f:function(e,t,n){var r=e.l+t,a=p7(e);a.r=n["!row"];var i=[a,A7(e),"n"];if(n.cellFormula){e.l+=2;var o=ate(e,r-e.l,n);i[3]=ete(o,0,a,n.supbooks,n)}else e.l=r;return i}},10:{f:function(e,t,n){var r=e.l+t,a=p7(e);a.r=n["!row"];var i=[a,e.read_shift(1),"b"];if(n.cellFormula){e.l+=2;var o=ate(e,r-e.l,n);i[3]=ete(o,0,a,n.supbooks,n)}else e.l=r;return i}},11:{f:function(e,t,n){var r=e.l+t,a=p7(e);a.r=n["!row"];var i=[a,e.read_shift(1),"e"];if(n.cellFormula){e.l+=2;var o=ate(e,r-e.l,n);i[3]=ete(o,0,a,n.supbooks,n)}else e.l=r;return i}},12:{f:function(e){return[g7(e)]}},13:{f:function(e){return[g7(e),C7(e),"n"]}},14:{f:function(e){return[g7(e),e.read_shift(1),"e"]}},15:{f:function(e){return[g7(e),e.read_shift(1),"b"]}},16:{f:Cte},17:{f:function(e){return[g7(e),c7(e),"str"]}},18:{f:function(e){return[g7(e),e.read_shift(4),"s"]}},19:{f:h7},20:{},21:{},22:{},23:{},24:{},25:{},26:{},27:{},28:{},29:{},30:{},31:{},32:{},33:{},34:{},35:{T:1},36:{T:-1},37:{T:1},38:{T:-1},39:{f:function(e,t,n){var r=e.l+t;e.l+=4,e.l+=1;var a=e.read_shift(4),i=k7(e),o=ite(e,0,n),s=x7(e);e.l=r;var c={Name:i,Ptg:o};return a<268435455&&(c.Sheet=a),s&&(c.Comment=s),c}},40:{},42:{},43:{f:function(e,t,n){var r={};r.sz=e.read_shift(2)/20;var a=function(e){var t=e.read_shift(1);return e.l++,{fBold:1&t,fItalic:2&t,fUnderline:4&t,fStrikeout:8&t,fOutline:16&t,fShadow:32&t,fCondense:64&t,fExtend:128&t}}(e);switch(a.fItalic&&(r.italic=1),a.fCondense&&(r.condense=1),a.fExtend&&(r.extend=1),a.fShadow&&(r.shadow=1),a.fOutline&&(r.outline=1),a.fStrikeout&&(r.strike=1),700===e.read_shift(2)&&(r.bold=1),e.read_shift(2)){case 1:r.vertAlign="superscript";break;case 2:r.vertAlign="subscript"}var i=e.read_shift(1);0!=i&&(r.underline=i);var o=e.read_shift(1);o>0&&(r.family=o);var s=e.read_shift(1);switch(s>0&&(r.charset=s),e.l++,r.color=function(e){var t={},n=e.read_shift(1)>>>1,r=e.read_shift(1),a=e.read_shift(2,"i"),i=e.read_shift(1),o=e.read_shift(1),s=e.read_shift(1);switch(e.l++,n){case 0:t.auto=1;break;case 1:t.index=r;var c=M7[r];c&&(t.rgb=q9(c));break;case 2:t.rgb=q9([i,o,s]);break;case 3:t.theme=r}return 0!=a&&(t.tint=a>0?a/32767:a/32768),t}(e),e.read_shift(1)){case 1:r.scheme="major";break;case 2:r.scheme="minor"}return r.name=c7(e),r}},44:{f:function(e,t){return[e.read_shift(2),c7(e)]}},45:{f:oee},46:{f:uee},47:{f:function(e,t){var n=e.l+t,r=e.read_shift(2),a=e.read_shift(2);return e.l=n,{ixfe:r,numFmtId:a}}},48:{},49:{f:function(e){return e.read_shift(4,"i")}},50:{},51:{f:function(e){for(var t=[],n=e.read_shift(4);n-- >0;)t.push([e.read_shift(4),e.read_shift(4)]);return t}},52:{T:1},53:{T:-1},54:{T:1},55:{T:-1},56:{T:1},57:{T:-1},58:{},59:{},60:{f:F9},62:{f:function(e){return[p7(e),h7(e),"is"]}},63:{f:function(e){var t={};t.i=e.read_shift(4);var n={};n.r=e.read_shift(4),n.c=e.read_shift(4),t.r=Q8(n);var r=e.read_shift(1);return 2&r&&(t.l="1"),8&r&&(t.a="1"),t}},64:{f:function(){}},65:{},66:{},67:{},68:{},69:{},70:{},128:{},129:{T:1},130:{T:-1},131:{T:1,f:B8,p:0},132:{T:-1},133:{T:1},134:{T:-1},135:{T:1},136:{T:-1},137:{T:1,f:function(e){var t=e.read_shift(2);return e.l+=28,{RTL:32&t}}},138:{T:-1},139:{T:1},140:{T:-1},141:{T:1},142:{T:-1},143:{T:1},144:{T:-1},145:{T:1},146:{T:-1},147:{f:function(e,t){var n={},r=e[e.l];return++e.l,n.above=!(64&r),n.left=!(128&r),e.l+=18,n.name=b7(e,t-19),n}},148:{f:Ste,p:16},151:{f:function(){}},152:{},153:{f:function(e,t){var n={},r=e.read_shift(4);n.defaultThemeVersion=e.read_shift(4);var a=t>8?c7(e):"";return a.length>0&&(n.CodeName=a),n.autoCompressPictures=!!(65536&r),n.backupFile=!!(64&r),n.checkCompatibility=!!(4096&r),n.date1904=!!(1&r),n.filterPrivacy=!!(8&r),n.hidePivotFieldList=!!(1024&r),n.promptedSolutions=!!(16&r),n.publishItems=!!(2048&r),n.refreshAllConnections=!!(262144&r),n.saveExternalLinkValues=!!(128&r),n.showBorderUnselectedTables=!!(4&r),n.showInkAnnotation=!!(32&r),n.showObjects=["all","placeholders","none"][r>>13&3],n.showPivotChartFilter=!!(32768&r),n.updateLinks=["userSet","never","always"][r>>8&3],n}},154:{},155:{},156:{f:function(e,t){var n={};return n.Hidden=e.read_shift(4),n.iTabID=e.read_shift(4),n.strRelID=S7(e,t-8),n.name=c7(e),n}},157:{},158:{},159:{T:1,f:function(e){return[e.read_shift(4),e.read_shift(4)]}},160:{T:-1},161:{T:1,f:T7},162:{T:-1},163:{T:1},164:{T:-1},165:{T:1},166:{T:-1},167:{},168:{},169:{},170:{},171:{},172:{T:1},173:{T:-1},174:{},175:{},176:{f:Ete},177:{T:1},178:{T:-1},179:{T:1},180:{T:-1},181:{T:1},182:{T:-1},183:{T:1},184:{T:-1},185:{T:1},186:{T:-1},187:{T:1},188:{T:-1},189:{T:1},190:{T:-1},191:{T:1},192:{T:-1},193:{T:1},194:{T:-1},195:{T:1},196:{T:-1},197:{T:1},198:{T:-1},199:{T:1},200:{T:-1},201:{T:1},202:{T:-1},203:{T:1},204:{T:-1},205:{T:1},206:{T:-1},207:{T:1},208:{T:-1},209:{T:1},210:{T:-1},211:{T:1},212:{T:-1},213:{T:1},214:{T:-1},215:{T:1},216:{T:-1},217:{T:1},218:{T:-1},219:{T:1},220:{T:-1},221:{T:1},222:{T:-1},223:{T:1},224:{T:-1},225:{T:1},226:{T:-1},227:{T:1},228:{T:-1},229:{T:1},230:{T:-1},231:{T:1},232:{T:-1},233:{T:1},234:{T:-1},235:{T:1},236:{T:-1},237:{T:1},238:{T:-1},239:{T:1},240:{T:-1},241:{T:1},242:{T:-1},243:{T:1},244:{T:-1},245:{T:1},246:{T:-1},247:{T:1},248:{T:-1},249:{T:1},250:{T:-1},251:{T:1},252:{T:-1},253:{T:1},254:{T:-1},255:{T:1},256:{T:-1},257:{T:1},258:{T:-1},259:{T:1},260:{T:-1},261:{T:1},262:{T:-1},263:{T:1},264:{T:-1},265:{T:1},266:{T:-1},267:{T:1},268:{T:-1},269:{T:1},270:{T:-1},271:{T:1},272:{T:-1},273:{T:1},274:{T:-1},275:{T:1},276:{T:-1},277:{},278:{T:1},279:{T:-1},280:{T:1},281:{T:-1},282:{T:1},283:{T:1},284:{T:-1},285:{T:1},286:{T:-1},287:{T:1},288:{T:-1},289:{T:1},290:{T:-1},291:{T:1},292:{T:-1},293:{T:1},294:{T:-1},295:{T:1},296:{T:-1},297:{T:1},298:{T:-1},299:{T:1},300:{T:-1},301:{T:1},302:{T:-1},303:{T:1},304:{T:-1},305:{T:1},306:{T:-1},307:{T:1},308:{T:-1},309:{T:1},310:{T:-1},311:{T:1},312:{T:-1},313:{T:-1},314:{T:1},315:{T:-1},316:{T:1},317:{T:-1},318:{T:1},319:{T:-1},320:{T:1},321:{T:-1},322:{T:1},323:{T:-1},324:{T:1},325:{T:-1},326:{T:1},327:{T:-1},328:{T:1},329:{T:-1},330:{T:1},331:{T:-1},332:{T:1},333:{T:-1},334:{T:1},335:{f:function(e,t){return{flags:e.read_shift(4),version:e.read_shift(4),name:c7(e)}}},336:{T:-1},337:{f:function(e){return e.l+=4,0!=e.read_shift(4)},T:1},338:{T:-1},339:{T:1},340:{T:-1},341:{T:1},342:{T:-1},343:{T:1},344:{T:-1},345:{T:1},346:{T:-1},347:{T:1},348:{T:-1},349:{T:1},350:{T:-1},351:{},352:{},353:{T:1},354:{T:-1},355:{f:S7},357:{},358:{},359:{},360:{T:1},361:{},362:{f:_9},363:{},364:{},366:{},367:{},368:{},369:{},370:{},371:{},372:{T:1},373:{T:-1},374:{T:1},375:{T:-1},376:{T:1},377:{T:-1},378:{T:1},379:{T:-1},380:{T:1},381:{T:-1},382:{T:1},383:{T:-1},384:{T:1},385:{T:-1},386:{T:1},387:{T:-1},388:{T:1},389:{T:-1},390:{T:1},391:{T:-1},392:{T:1},393:{T:-1},394:{T:1},395:{T:-1},396:{},397:{},398:{},399:{},400:{},401:{T:1},403:{},404:{},405:{},406:{},407:{},408:{},409:{},410:{},411:{},412:{},413:{},414:{},415:{},416:{},417:{},418:{},419:{},420:{},421:{},422:{T:1},423:{T:1},424:{T:-1},425:{T:-1},426:{f:function(e,t,n){var r=e.l+t,a=I7(e),i=e.read_shift(1),o=[a];if(o[2]=i,n.cellFormula){var s=rte(e,r-e.l,n);o[1]=s}else e.l=r;return o}},427:{f:function(e,t,n){var r=e.l+t,a=[T7(e,16)];if(n.cellFormula){var i=ote(e,r-e.l,n);a[1]=i,e.l=r}else e.l=r;return a}},428:{},429:{T:1},430:{T:-1},431:{T:1},432:{T:-1},433:{T:1},434:{T:-1},435:{T:1},436:{T:-1},437:{T:1},438:{T:-1},439:{T:1},440:{T:-1},441:{T:1},442:{T:-1},443:{T:1},444:{T:-1},445:{T:1},446:{T:-1},447:{T:1},448:{T:-1},449:{T:1},450:{T:-1},451:{T:1},452:{T:-1},453:{T:1},454:{T:-1},455:{T:1},456:{T:-1},457:{T:1},458:{T:-1},459:{T:1},460:{T:-1},461:{T:1},462:{T:-1},463:{T:1},464:{T:-1},465:{T:1},466:{T:-1},467:{T:1},468:{T:-1},469:{T:1},470:{T:-1},471:{},472:{},473:{T:1},474:{T:-1},475:{},476:{f:function(e){var t={};return Tte.forEach(function(n){t[n]=A7(e)}),t}},477:{},478:{},479:{T:1},480:{T:-1},481:{T:1},482:{T:-1},483:{T:1},484:{T:-1},485:{f:function(){}},486:{T:1},487:{T:-1},488:{T:1},489:{T:-1},490:{T:1},491:{T:-1},492:{T:1},493:{T:-1},494:{f:function(e,t){var n=e.l+t,r=T7(e,16),a=x7(e),i=c7(e),o=c7(e),s=c7(e);e.l=n;var c={rfx:r,relId:a,loc:i,display:s};return o&&(c.Tooltip=o),c}},495:{T:1},496:{T:-1},497:{T:1},498:{T:-1},499:{},500:{T:1},501:{T:-1},502:{T:1},503:{T:-1},504:{},505:{T:1},506:{T:-1},507:{},508:{T:1},509:{T:-1},510:{T:1},511:{T:-1},512:{},513:{},514:{T:1},515:{T:-1},516:{T:1},517:{T:-1},518:{T:1},519:{T:-1},520:{T:1},521:{T:-1},522:{},523:{},524:{},525:{},526:{},527:{},528:{T:1},529:{T:-1},530:{T:1},531:{T:-1},532:{T:1},533:{T:-1},534:{},535:{},536:{},537:{},538:{T:1},539:{T:-1},540:{T:1},541:{T:-1},542:{T:1},548:{},549:{},550:{f:S7},551:{},552:{},553:{},554:{T:1},555:{T:-1},556:{T:1},557:{T:-1},558:{T:1},559:{T:-1},560:{T:1},561:{T:-1},562:{},564:{},565:{T:1},566:{T:-1},569:{T:1},570:{T:-1},572:{},573:{T:1},574:{T:-1},577:{},578:{},579:{},580:{},581:{},582:{},583:{},584:{},585:{},586:{},587:{},588:{T:-1},589:{},590:{T:1},591:{T:-1},592:{T:1},593:{T:-1},594:{T:1},595:{T:-1},596:{},597:{T:1},598:{T:-1},599:{T:1},600:{T:-1},601:{T:1},602:{T:-1},603:{T:1},604:{T:-1},605:{T:1},606:{T:-1},607:{},608:{T:1},609:{T:-1},610:{},611:{T:1},612:{T:-1},613:{T:1},614:{T:-1},615:{T:1},616:{T:-1},617:{T:1},618:{T:-1},619:{T:1},620:{T:-1},625:{},626:{T:1},627:{T:-1},628:{T:1},629:{T:-1},630:{T:1},631:{T:-1},632:{f:kee},633:{T:1},634:{T:-1},635:{T:1,f:function(e){var t={};t.iauthor=e.read_shift(4);var n=T7(e,16);return t.rfx=n.s,t.ref=Q8(n.s),e.l+=16,t}},636:{T:-1},637:{f:d7},638:{T:1},639:{},640:{T:-1},641:{T:1},642:{T:-1},643:{T:1},644:{},645:{T:-1},646:{T:1},648:{T:1},649:{},650:{T:-1},651:{f:function(e,t){return e.l+=10,{name:c7(e)}}},652:{},653:{T:1},654:{T:-1},655:{T:1},656:{T:-1},657:{T:1},658:{T:-1},659:{},660:{T:1},661:{},662:{T:-1},663:{},664:{T:1},665:{},666:{T:-1},667:{},668:{},669:{},671:{T:1},672:{T:-1},673:{T:1},674:{T:-1},675:{},676:{},677:{},678:{},679:{},680:{},681:{},1024:{},1025:{},1026:{T:1},1027:{T:-1},1028:{T:1},1029:{T:-1},1030:{},1031:{T:1},1032:{T:-1},1033:{T:1},1034:{T:-1},1035:{},1036:{},1037:{},1038:{T:1},1039:{T:-1},1040:{},1041:{T:1},1042:{T:-1},1043:{},1044:{},1045:{},1046:{T:1},1047:{T:-1},1048:{T:1},1049:{T:-1},1050:{},1051:{T:1},1052:{T:1},1053:{f:function(){}},1054:{T:1},1055:{},1056:{T:1},1057:{T:-1},1058:{T:1},1059:{T:-1},1061:{},1062:{T:1},1063:{T:-1},1064:{T:1},1065:{T:-1},1066:{T:1},1067:{T:-1},1068:{T:1},1069:{T:-1},1070:{T:1},1071:{T:-1},1072:{T:1},1073:{T:-1},1075:{T:1},1076:{T:-1},1077:{T:1},1078:{T:-1},1079:{T:1},1080:{T:-1},1081:{T:1},1082:{T:-1},1083:{T:1},1084:{T:-1},1085:{},1086:{T:1},1087:{T:-1},1088:{T:1},1089:{T:-1},1090:{T:1},1091:{T:-1},1092:{T:1},1093:{T:-1},1094:{T:1},1095:{T:-1},1096:{},1097:{T:1},1098:{},1099:{T:-1},1100:{T:1},1101:{T:-1},1102:{},1103:{},1104:{},1105:{},1111:{},1112:{},1113:{T:1},1114:{T:-1},1115:{T:1},1116:{T:-1},1117:{},1118:{T:1},1119:{T:-1},1120:{T:1},1121:{T:-1},1122:{T:1},1123:{T:-1},1124:{T:1},1125:{T:-1},1126:{},1128:{T:1},1129:{T:-1},1130:{},1131:{T:1},1132:{T:-1},1133:{T:1},1134:{T:-1},1135:{T:1},1136:{T:-1},1137:{T:1},1138:{T:-1},1139:{T:1},1140:{T:-1},1141:{},1142:{T:1},1143:{T:-1},1144:{T:1},1145:{T:-1},1146:{},1147:{T:1},1148:{T:-1},1149:{T:1},1150:{T:-1},1152:{T:1},1153:{T:-1},1154:{T:-1},1155:{T:-1},1156:{T:-1},1157:{T:1},1158:{T:-1},1159:{T:1},1160:{T:-1},1161:{T:1},1162:{T:-1},1163:{T:1},1164:{T:-1},1165:{T:1},1166:{T:-1},1167:{T:1},1168:{T:-1},1169:{T:1},1170:{T:-1},1171:{},1172:{T:1},1173:{T:-1},1177:{},1178:{T:1},1180:{},1181:{},1182:{},2048:{T:1},2049:{T:-1},2050:{},2051:{T:1},2052:{T:-1},2053:{},2054:{},2055:{T:1},2056:{T:-1},2057:{T:1},2058:{T:-1},2060:{},2067:{},2068:{T:1},2069:{T:-1},2070:{},2071:{},2072:{T:1},2073:{T:-1},2075:{},2076:{},2077:{T:1},2078:{T:-1},2079:{},2080:{T:1},2081:{T:-1},2082:{},2083:{T:1},2084:{T:-1},2085:{T:1},2086:{T:-1},2087:{T:1},2088:{T:-1},2089:{T:1},2090:{T:-1},2091:{},2092:{},2093:{T:1},2094:{T:-1},2095:{},2096:{T:1},2097:{T:-1},2098:{T:1},2099:{T:-1},2100:{T:1},2101:{T:-1},2102:{},2103:{T:1},2104:{T:-1},2105:{},2106:{T:1},2107:{T:-1},2108:{},2109:{T:1},2110:{T:-1},2111:{T:1},2112:{T:-1},2113:{T:1},2114:{T:-1},2115:{},2116:{},2117:{},2118:{T:1},2119:{T:-1},2120:{},2121:{T:1},2122:{T:-1},2123:{T:1},2124:{T:-1},2125:{},2126:{T:1},2127:{T:-1},2128:{},2129:{T:1},2130:{T:-1},2131:{T:1},2132:{T:-1},2133:{T:1},2134:{},2135:{},2136:{},2137:{T:1},2138:{T:-1},2139:{T:1},2140:{T:-1},2141:{},3072:{},3073:{},4096:{T:1},4097:{T:-1},5002:{T:1},5003:{T:-1},5081:{T:1},5082:{T:-1},5083:{},5084:{T:1},5085:{T:-1},5086:{T:1},5087:{T:-1},5088:{},5089:{},5090:{},5092:{T:1},5093:{T:-1},5094:{},5095:{T:1},5096:{T:-1},5097:{},5099:{},65535:{n:""}};function ane(e,t,n,r){var a=t;if(!isNaN(a)){var i=r||(n||[]).length||0,o=e.next(4);o.write_shift(2,a),o.write_shift(2,i),i>0&&N8(n)&&e.push(n)}}function ine(e,t,n){return e||(e=z8(7)),e.write_shift(2,t),e.write_shift(2,n),e.write_shift(2,0),e.write_shift(1,0),e}function one(e,t,n,r){if(null!=t.v)switch(t.t){case"d":case"n":var a="d"==t.t?Q5(o6(t.v)):t.v;return void(a==(0|a)&&a>=0&&a<65536?ane(e,2,function(e,t,n){var r=z8(9);return ine(r,e,t),r.write_shift(2,n),r}(n,r,a)):ane(e,3,function(e,t,n){var r=z8(15);return ine(r,e,t),r.write_shift(8,n,"f"),r}(n,r,a)));case"b":case"e":return void ane(e,5,function(e,t,n,r){var a=z8(9);return ine(a,e,t),d9(n,r||"b",a),a}(n,r,t.v,t.t));case"s":case"str":return void ane(e,4,function(e,t,n){var r=z8(8+2*n.length);return ine(r,e,t),r.write_shift(1,n.length),r.write_shift(n.length,n,"sbcs"),r.l<r.length?r.slice(0,r.l):r}(n,r,(t.v||"").slice(0,255)))}ane(e,1,ine(null,n,r))}function sne(e,t){var n=t||{};for(var r=U8(),a=0,i=0;i<e.SheetNames.length;++i)e.SheetNames[i]==n.sheet&&(a=i);if(0==a&&n.sheet&&e.SheetNames[0]!=n.sheet)throw new Error("Sheet not found: "+n.sheet);return ane(r,4==n.biff?1033:3==n.biff?521:9,C9(0,16,n)),function(e,t,n,r){var a,i=Array.isArray(t),o=t7(t["!ref"]||"A1"),s="",c=[];if(o.e.c>255||o.e.r>16383){if(r.WTF)throw new Error("Range "+(t["!ref"]||"A1")+" exceeds format limit A1:IV16384");o.e.c=Math.min(o.e.c,255),o.e.r=Math.min(o.e.c,16383),a=e7(o)}for(var l=o.s.r;l<=o.e.r;++l){s=X8(l);for(var u=o.s.c;u<=o.e.c;++u){l===o.s.r&&(c[u]=$8(u)),a=c[u]+s;var h=i?(t[l]||[])[u]:t[a];h&&one(e,h,l,u)}}}(r,e.Sheets[e.SheetNames[a]],0,n),ane(r,10),r.end()}function cne(e,t,n){ane(e,49,function(e,t){var n=e.name||"Arial",r=t&&5==t.biff,a=z8(r?15+n.length:16+2*n.length);return a.write_shift(2,20*(e.sz||12)),a.write_shift(4,0),a.write_shift(2,400),a.write_shift(4,0),a.write_shift(2,0),a.write_shift(1,n.length),r||a.write_shift(1,1),a.write_shift((r?1:2)*n.length,n,r?"sbcs":"utf16le"),a}({sz:12,color:{theme:1},name:"Arial",family:2,scheme:"minor"},n))}function lne(e,t){if(t){var n=0;t.forEach(function(t,r){++n<=256&&t&&ane(e,125,function(e,t){var n=z8(12);n.write_shift(2,t),n.write_shift(2,t),n.write_shift(2,256*e.width),n.write_shift(2,0);var r=0;return e.hidden&&(r|=1),n.write_shift(1,r),r=e.level||0,n.write_shift(1,r),n.write_shift(2,0),n}(pte(r,t),r))})}}function une(e,t,n,r,a){var i=16+gte(a.cellXfs,t,a);if(null!=t.v||t.bf)if(t.bf)ane(e,6,tte(t,n,r,0,i));else switch(t.t){case"d":case"n":ane(e,515,function(e,t,n,r){var a=z8(14);return w9(e,t,r,a),R7(n,a),a}(n,r,"d"==t.t?Q5(o6(t.v)):t.v,i));break;case"b":case"e":ane(e,517,function(e,t,n,r,a,i){var o=z8(8);return w9(e,t,r,o),d9(n,i,o),o}(n,r,t.v,i,0,t.t));break;case"s":case"str":if(a.bookSST)ane(e,253,function(e,t,n,r){var a=z8(10);return w9(e,t,r,a),a.write_shift(4,n),a}(n,r,fte(a.Strings,t.v,a.revStrings),i));else ane(e,516,function(e,t,n,r,a){var i=!a||8==a.biff,o=z8(+i+8+(1+i)*n.length);return w9(e,t,r,o),o.write_shift(2,n.length),i&&o.write_shift(1,1),o.write_shift((1+i)*n.length,n,i?"utf16le":"sbcs"),o}(n,r,(t.v||"").slice(0,255),i,a));break;default:ane(e,513,w9(n,r,i))}else ane(e,513,w9(n,r,i))}function hne(e,t,n){var r,a=U8(),i=n.SheetNames[e],o=n.Sheets[i]||{},s=(n||{}).Workbook||{},c=(s.Sheets||[])[e]||{},l=Array.isArray(o),u=8==t.biff,h="",d=[],f=t7(o["!ref"]||"A1"),p=u?65536:16384;if(f.e.c>255||f.e.r>=p){if(t.WTF)throw new Error("Range "+(o["!ref"]||"A1")+" exceeds format limit A1:IV16384");f.e.c=Math.min(f.e.c,255),f.e.r=Math.min(f.e.c,p-1)}ane(a,2057,C9(0,16,t)),ane(a,13,h9(1)),ane(a,12,h9(100)),ane(a,15,l9(!0)),ane(a,17,l9(!1)),ane(a,16,R7(.001)),ane(a,95,l9(!0)),ane(a,42,l9(!1)),ane(a,43,l9(!1)),ane(a,130,h9(1)),ane(a,128,function(e){var t=z8(8);return t.write_shift(4,0),t.write_shift(2,e[0]?e[0]+1:0),t.write_shift(2,e[1]?e[1]+1:0),t}([0,0])),ane(a,131,l9(!1)),ane(a,132,l9(!1)),u&&lne(a,o["!cols"]),ane(a,512,function(e,t){var n=8!=t.biff&&t.biff?2:4,r=z8(2*n+6);return r.write_shift(n,e.s.r),r.write_shift(n,e.e.r+1),r.write_shift(2,e.s.c),r.write_shift(2,e.e.c+1),r.write_shift(2,0),r}(f,t)),u&&(o["!links"]=[]);for(var m=f.s.r;m<=f.e.r;++m){h=X8(m);for(var g=f.s.c;g<=f.e.c;++g){m===f.s.r&&(d[g]=$8(g)),r=d[g]+h;var v=l?(o[m]||[])[g]:o[r];v&&(une(a,v,m,g,t),u&&v.l&&o["!links"].push([r,v.l]))}}var b=c.CodeName||c.name||i;return u&&ane(a,574,function(e){var t=z8(18),n=1718;return e&&e.RTL&&(n|=64),t.write_shift(2,n),t.write_shift(4,0),t.write_shift(4,64),t.write_shift(4,0),t.write_shift(4,0),t}((s.Views||[])[0])),u&&(o["!merges"]||[]).length&&ane(a,229,function(e){var t=z8(2+8*e.length);t.write_shift(2,e.length);for(var n=0;n<e.length;++n)N9(e[n],t);return t}(o["!merges"])),u&&function(e,t){for(var n=0;n<t["!links"].length;++n){var r=t["!links"][n];ane(e,440,A9(r)),r[1].Tooltip&&ane(e,2048,R9(r))}delete t["!links"]}(a,o),ane(a,442,b9(b)),u&&function(e,t){var n=z8(19);n.write_shift(4,2151),n.write_shift(4,0),n.write_shift(4,0),n.write_shift(2,3),n.write_shift(1,1),n.write_shift(4,0),ane(e,2151,n),(n=z8(39)).write_shift(4,2152),n.write_shift(4,0),n.write_shift(4,0),n.write_shift(2,3),n.write_shift(1,0),n.write_shift(4,0),n.write_shift(2,1),n.write_shift(4,4),n.write_shift(2,0),N9(t7(t["!ref"]||"A1"),n),n.write_shift(4,4),ane(e,2152,n)}(a,o),ane(a,10),a.end()}function dne(e,t,n){var r=U8(),a=(e||{}).Workbook||{},i=a.Sheets||[],o=a.WBProps||{},s=8==n.biff,c=5==n.biff;(ane(r,2057,C9(0,5,n)),"xla"==n.bookType&&ane(r,135),ane(r,225,s?h9(1200):null),ane(r,193,function(e,t){t||(t=z8(e));for(var n=0;n<e;++n)t.write_shift(1,0);return t}(2)),c&&ane(r,191),c&&ane(r,192),ane(r,226),ane(r,92,function(e,t){var n=!t||8==t.biff,r=z8(n?112:54);for(r.write_shift(8==t.biff?2:1,7),n&&r.write_shift(1,0),r.write_shift(4,859007059),r.write_shift(4,5458548|(n?0:536870912));r.l<r.length;)r.write_shift(1,n?0:32);return r}(0,n)),ane(r,66,h9(s?1200:1252)),s&&ane(r,353,h9(0)),s&&ane(r,448),ane(r,317,function(e){for(var t=z8(2*e),n=0;n<e;++n)t.write_shift(2,n+1);return t}(e.SheetNames.length)),s&&e.vbaraw&&ane(r,211),s&&e.vbaraw)&&ane(r,442,b9(o.CodeName||"ThisWorkbook"));ane(r,156,h9(17)),ane(r,25,l9(!1)),ane(r,18,l9(!1)),ane(r,19,h9(0)),s&&ane(r,431,l9(!1)),s&&ane(r,444,h9(0)),ane(r,61,function(){var e=z8(18);return e.write_shift(2,0),e.write_shift(2,0),e.write_shift(2,29280),e.write_shift(2,17600),e.write_shift(2,56),e.write_shift(2,0),e.write_shift(2,0),e.write_shift(2,1),e.write_shift(2,500),e}()),ane(r,64,l9(!1)),ane(r,141,h9(0)),ane(r,34,l9("true"==function(e){return e.Workbook&&e.Workbook.WBProps&&N6(e.Workbook.WBProps.date1904)?"true":"false"}(e))),ane(r,14,l9(!0)),s&&ane(r,439,l9(!1)),ane(r,218,h9(0)),cne(r,0,n),function(e,t,n){t&&[[5,8],[23,26],[41,44],[50,392]].forEach(function(r){for(var a=r[0];a<=r[1];++a)null!=t[a]&&ane(e,1054,I9(a,t[a],n))})}(r,e.SSF,n),function(e,t){for(var n=0;n<16;++n)ane(e,224,T9({numFmtId:0,style:!0},0,t));t.cellXfs.forEach(function(n){ane(e,224,T9(n,0,t))})}(r,n),s&&ane(r,352,l9(!1));var l=r.end(),u=U8();s&&ane(u,140,function(e){return e||(e=z8(4)),e.write_shift(2,1),e.write_shift(2,1),e}()),s&&n.Strings&&function(e,t,n,r){var a=r||(n||[]).length||0;if(a<=8224)return ane(e,t,n,a);var i=t;if(!isNaN(i)){for(var o=n.parts||[],s=0,c=0,l=0;l+(o[s]||8224)<=8224;)l+=o[s]||8224,s++;var u=e.next(4);for(u.write_shift(2,i),u.write_shift(2,l),e.push(n.slice(c,c+l)),c+=l;c<a;){for((u=e.next(4)).write_shift(2,60),l=0;l+(o[s]||8224)<=8224;)l+=o[s]||8224,s++;u.write_shift(2,l),e.push(n.slice(c,c+l)),c+=l}}}(u,252,function(e){var t=z8(8);t.write_shift(4,e.Count),t.write_shift(4,e.Unique);for(var n=[],r=0;r<e.length;++r)n[r]=p9(e[r]);var a=K3([t].concat(n));return a.parts=[t.length].concat(n.map(function(e){return e.length})),a}(n.Strings)),ane(u,10);var h=u.end(),d=U8(),f=0,p=0;for(p=0;p<e.SheetNames.length;++p)f+=(s?12:11)+(s?2:1)*e.SheetNames[p].length;var m=l.length+f+h.length;for(p=0;p<e.SheetNames.length;++p){ane(d,133,E9({pos:m,hs:(i[p]||{}).Hidden||0,dt:0,name:e.SheetNames[p]},n)),m+=t[p].length}var g=d.end();if(f!=g.length)throw new Error("BS8 "+f+" != "+g.length);var v=[];return l.length&&v.push(l),g.length&&v.push(g),h.length&&v.push(h),K3(v)}function fne(e,t){for(var n=0;n<=e.SheetNames.length;++n){var r=e.Sheets[e.SheetNames[n]];if(r&&r["!ref"])Z8(r["!ref"]).e.c>255&&"undefined"!=typeof console&&console.error&&console.error("Worksheet '"+e.SheetNames[n]+"' extends beyond column IV (255).  Data may be lost.")}var a=t||{};switch(a.biff||2){case 8:case 5:return function(e,t){var n=t||{},r=[];e&&!e.SSF&&(e.SSF=c6(i5)),e&&e.SSF&&(z5(),B5(e.SSF),n.revssf=$5(e.SSF),n.revssf[e.SSF[65535]]=0,n.ssf=e.SSF),n.Strings=[],n.Strings.Count=0,n.Strings.Unique=0,Vne(n),n.cellXfs=[],gte(n.cellXfs,{},{revssf:{General:0}}),e.Props||(e.Props={});for(var a=0;a<e.SheetNames.length;++a)r[r.length]=hne(a,n,e);return r.unshift(dne(e,r,n)),K3(r)}(e,t);case 4:case 3:case 2:return sne(e,t)}throw new Error("invalid type "+a.bookType+" for BIFF")}function pne(e,t,n,r){for(var a=e["!merges"]||[],i=[],o=t.s.c;o<=t.e.c;++o){for(var s=0,c=0,l=0;l<a.length;++l)if(!(a[l].s.r>n||a[l].s.c>o)&&!(a[l].e.r<n||a[l].e.c<o)){if(a[l].s.r<n||a[l].s.c<o){s=-1;break}s=a[l].e.r-a[l].s.r+1,c=a[l].e.c-a[l].s.c+1;break}if(!(s<0)){var u=Q8({r:n,c:o}),h=r.dense?(e[n]||[])[o]:e[u],d=h&&null!=h.v&&(h.h||S6(h.w||(r7(h),h.w)||""))||"",f={};s>1&&(f.rowspan=s),c>1&&(f.colspan=c),r.editable?d='<span contenteditable="true">'+d+"</span>":h&&(f["data-t"]=h&&h.t||"z",null!=h.v&&(f["data-v"]=h.v),null!=h.z&&(f["data-z"]=h.z),h.l&&"#"!=(h.l.Target||"#").charAt(0)&&(d='<a href="'+h.l.Target+'">'+d+"</a>")),f.id=(r.id||"sjs")+"-"+u,i.push(L6("td",d,f))}}return"<tr>"+i.join("")+"</tr>"}var mne='<html><head><meta charset="utf-8"/><title>SheetJS Table Export</title></head><body>',gne="</body></html>";function vne(e,t,n){return[].join("")+"<table"+(n&&n.id?' id="'+n.id+'"':"")+">"}function bne(e,t){var n=t||{},r=null!=n.header?n.header:mne,a=null!=n.footer?n.footer:gne,i=[r],o=Z8(e["!ref"]);n.dense=Array.isArray(e),i.push(vne(0,0,n));for(var s=o.s.r;s<=o.e.r;++s)i.push(pne(e,o,s,n));return i.push("</table>"+a),i.join("")}function yne(e,t,n){var r=n||{};var a=0,i=0;if(null!=r.origin)if("number"==typeof r.origin)a=r.origin;else{var o="string"==typeof r.origin?J8(r.origin):r.origin;a=o.r,i=o.c}var s=t.getElementsByTagName("tr"),c=Math.min(r.sheetRows||1e7,s.length),l={s:{r:0,c:0},e:{r:a,c:i}};if(e["!ref"]){var u=Z8(e["!ref"]);l.s.r=Math.min(l.s.r,u.s.r),l.s.c=Math.min(l.s.c,u.s.c),l.e.r=Math.max(l.e.r,u.e.r),l.e.c=Math.max(l.e.c,u.e.c),-1==a&&(l.e.r=a=u.e.r+1)}var h=[],d=0,f=e["!rows"]||(e["!rows"]=[]),p=0,m=0,g=0,v=0,b=0,y=0;for(e["!cols"]||(e["!cols"]=[]);p<s.length&&m<c;++p){var x=s[p];if(wne(x)){if(r.display)continue;f[m]={hidden:!0}}var w=x.children;for(g=v=0;g<w.length;++g){var k=w[g];if(!r.display||!wne(k)){var S=k.hasAttribute("data-v")?k.getAttribute("data-v"):k.hasAttribute("v")?k.getAttribute("v"):R6(k.innerHTML),N=k.getAttribute("data-z")||k.getAttribute("z");for(d=0;d<h.length;++d){var C=h[d];C.s.c==v+i&&C.s.r<m+a&&m+a<=C.e.r&&(v=C.e.c+1-i,d=-1)}y=+k.getAttribute("colspan")||1,((b=+k.getAttribute("rowspan")||1)>1||y>1)&&h.push({s:{r:m+a,c:v+i},e:{r:m+a+(b||1)-1,c:v+i+(y||1)-1}});var E={t:"s",v:S},I=k.getAttribute("data-t")||k.getAttribute("t")||"";null!=S&&(0==S.length?E.t=I||"z":r.raw||0==S.trim().length||"s"==I||("TRUE"===S?E={t:"b",v:!0}:"FALSE"===S?E={t:"b",v:!1}:isNaN(u6(S))?isNaN(d6(S).getDate())||(E={t:"d",v:o6(S)},r.cellDates||(E={t:"n",v:Q5(E.v)}),E.z=r.dateNF||i5[14]):E={t:"n",v:u6(S)})),void 0===E.z&&null!=N&&(E.z=N);var T="",_=k.getElementsByTagName("A");if(_&&_.length)for(var A=0;A<_.length&&(!_[A].hasAttribute("href")||"#"==(T=_[A].getAttribute("href")).charAt(0));++A);T&&"#"!=T.charAt(0)&&(E.l={Target:T}),r.dense?(e[m+a]||(e[m+a]=[]),e[m+a][v+i]=E):e[Q8({c:v+i,r:m+a})]=E,l.e.c<v+i&&(l.e.c=v+i),v+=y}}++m}return h.length&&(e["!merges"]=(e["!merges"]||[]).concat(h)),l.e.r=Math.max(l.e.r,m-1+a),e["!ref"]=e7(l),m>=c&&(e["!fullref"]=e7((l.e.r=s.length-p+m-1+a,l))),e}function xne(e,t){return yne((t||{}).dense?[]:{},e,t)}function wne(e){var t="",n=function(e){return e.ownerDocument.defaultView&&"function"===typeof e.ownerDocument.defaultView.getComputedStyle?e.ownerDocument.defaultView.getComputedStyle:"function"===typeof getComputedStyle?getComputedStyle:null}(e);return n&&(t=n(e).getPropertyValue("display")),t||(t=e.style&&e.style.display),"none"===t}var kne=function(){var e=["<office:master-styles>",'<style:master-page style:name="mp1" style:page-layout-name="mp1">',"<style:header/>",'<style:header-left style:display="false"/>',"<style:footer/>",'<style:footer-left style:display="false"/>',"</style:master-page>","</office:master-styles>"].join(""),t="<office:document-styles "+O6({"xmlns:office":"urn:oasis:names:tc:opendocument:xmlns:office:1.0","xmlns:table":"urn:oasis:names:tc:opendocument:xmlns:table:1.0","xmlns:style":"urn:oasis:names:tc:opendocument:xmlns:style:1.0","xmlns:text":"urn:oasis:names:tc:opendocument:xmlns:text:1.0","xmlns:draw":"urn:oasis:names:tc:opendocument:xmlns:drawing:1.0","xmlns:fo":"urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0","xmlns:xlink":"http://www.w3.org/1999/xlink","xmlns:dc":"http://purl.org/dc/elements/1.1/","xmlns:number":"urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0","xmlns:svg":"urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0","xmlns:of":"urn:oasis:names:tc:opendocument:xmlns:of:1.2","office:version":"1.2"})+">"+e+"</office:document-styles>";return function(){return m6+t}}(),Sne=function(){var e=function(e){return x6(e).replace(/  +/g,function(e){return'<text:s text:c="'+e.length+'"/>'}).replace(/\t/g,"<text:tab/>").replace(/\n/g,"</text:p><text:p>").replace(/^ /,"<text:s/>").replace(/ $/,"<text:s/>")},t="          <table:table-cell />\n",n=function(n,r,a){var i=[];i.push('      <table:table table:name="'+x6(r.SheetNames[a])+'" table:style-name="ta1">\n');var o=0,s=0,c=Z8(n["!ref"]||"A1"),l=n["!merges"]||[],u=0,h=Array.isArray(n);if(n["!cols"])for(s=0;s<=c.e.c;++s)i.push("        <table:table-column"+(n["!cols"][s]?' table:style-name="co'+n["!cols"][s].ods+'"':"")+"></table:table-column>\n");var d="",f=n["!rows"]||[];for(o=0;o<c.s.r;++o)d=f[o]?' table:style-name="ro'+f[o].ods+'"':"",i.push("        <table:table-row"+d+"></table:table-row>\n");for(;o<=c.e.r;++o){for(d=f[o]?' table:style-name="ro'+f[o].ods+'"':"",i.push("        <table:table-row"+d+">\n"),s=0;s<c.s.c;++s)i.push(t);for(;s<=c.e.c;++s){var p=!1,m={},g="";for(u=0;u!=l.length;++u)if(!(l[u].s.c>s)&&!(l[u].s.r>o)&&!(l[u].e.c<s)&&!(l[u].e.r<o)){l[u].s.c==s&&l[u].s.r==o||(p=!0),m["table:number-columns-spanned"]=l[u].e.c-l[u].s.c+1,m["table:number-rows-spanned"]=l[u].e.r-l[u].s.r+1;break}if(p)i.push("          <table:covered-table-cell/>\n");else{var v=Q8({r:o,c:s}),b=h?(n[o]||[])[s]:n[v];if(b&&b.f&&(m["table:formula"]=x6(ute(b.f)),b.F&&b.F.slice(0,v.length)==v)){var y=Z8(b.F);m["table:number-matrix-columns-spanned"]=y.e.c-y.s.c+1,m["table:number-matrix-rows-spanned"]=y.e.r-y.s.r+1}if(b){switch(b.t){case"b":g=b.v?"TRUE":"FALSE",m["office:value-type"]="boolean",m["office:boolean-value"]=b.v?"true":"false";break;case"n":g=b.w||String(b.v||0),m["office:value-type"]="float",m["office:value"]=b.v||0;break;case"s":case"str":g=null==b.v?"":b.v,m["office:value-type"]="string";break;case"d":g=b.w||o6(b.v).toISOString(),m["office:value-type"]="date",m["office:date-value"]=o6(b.v).toISOString(),m["table:style-name"]="ce1";break;default:i.push(t);continue}var x=e(g);if(b.l&&b.l.Target){var w=b.l.Target;"#"==(w="#"==w.charAt(0)?"#"+hte(w.slice(1)):w).charAt(0)||w.match(/^\w+:/)||(w="../"+w),x=L6("text:a",x,{"xlink:href":w.replace(/&/g,"&amp;")})}i.push("          "+L6("table:table-cell",L6("text:p",x,{}),m)+"\n")}else i.push(t)}}i.push("        </table:table-row>\n")}return i.push("      </table:table>\n"),i.join("")};return function(e,t){var r=[m6],a=O6({"xmlns:office":"urn:oasis:names:tc:opendocument:xmlns:office:1.0","xmlns:table":"urn:oasis:names:tc:opendocument:xmlns:table:1.0","xmlns:style":"urn:oasis:names:tc:opendocument:xmlns:style:1.0","xmlns:text":"urn:oasis:names:tc:opendocument:xmlns:text:1.0","xmlns:draw":"urn:oasis:names:tc:opendocument:xmlns:drawing:1.0","xmlns:fo":"urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0","xmlns:xlink":"http://www.w3.org/1999/xlink","xmlns:dc":"http://purl.org/dc/elements/1.1/","xmlns:meta":"urn:oasis:names:tc:opendocument:xmlns:meta:1.0","xmlns:number":"urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0","xmlns:presentation":"urn:oasis:names:tc:opendocument:xmlns:presentation:1.0","xmlns:svg":"urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0","xmlns:chart":"urn:oasis:names:tc:opendocument:xmlns:chart:1.0","xmlns:dr3d":"urn:oasis:names:tc:opendocument:xmlns:dr3d:1.0","xmlns:math":"http://www.w3.org/1998/Math/MathML","xmlns:form":"urn:oasis:names:tc:opendocument:xmlns:form:1.0","xmlns:script":"urn:oasis:names:tc:opendocument:xmlns:script:1.0","xmlns:ooo":"http://openoffice.org/2004/office","xmlns:ooow":"http://openoffice.org/2004/writer","xmlns:oooc":"http://openoffice.org/2004/calc","xmlns:dom":"http://www.w3.org/2001/xml-events","xmlns:xforms":"http://www.w3.org/2002/xforms","xmlns:xsd":"http://www.w3.org/2001/XMLSchema","xmlns:xsi":"http://www.w3.org/2001/XMLSchema-instance","xmlns:sheet":"urn:oasis:names:tc:opendocument:sh33tjs:1.0","xmlns:rpt":"http://openoffice.org/2005/report","xmlns:of":"urn:oasis:names:tc:opendocument:xmlns:of:1.2","xmlns:xhtml":"http://www.w3.org/1999/xhtml","xmlns:grddl":"http://www.w3.org/2003/g/data-view#","xmlns:tableooo":"http://openoffice.org/2009/table","xmlns:drawooo":"http://openoffice.org/2010/draw","xmlns:calcext":"urn:org:documentfoundation:names:experimental:calc:xmlns:calcext:1.0","xmlns:loext":"urn:org:documentfoundation:names:experimental:office:xmlns:loext:1.0","xmlns:field":"urn:openoffice:names:experimental:ooo-ms-interop:xmlns:field:1.0","xmlns:formx":"urn:openoffice:names:experimental:ooxml-odf-interop:xmlns:form:1.0","xmlns:css3t":"http://www.w3.org/TR/css3-text/","office:version":"1.2"}),i=O6({"xmlns:config":"urn:oasis:names:tc:opendocument:xmlns:config:1.0","office:mimetype":"application/vnd.oasis.opendocument.spreadsheet"});"fods"==t.bookType?(r.push("<office:document"+a+i+">\n"),r.push(X7().replace(/office:document-meta/g,"office:meta"))):r.push("<office:document-content"+a+">\n"),function(e,t){e.push(" <office:automatic-styles>\n"),e.push('  <number:date-style style:name="N37" number:automatic-order="true">\n'),e.push('   <number:month number:style="long"/>\n'),e.push("   <number:text>/</number:text>\n"),e.push('   <number:day number:style="long"/>\n'),e.push("   <number:text>/</number:text>\n"),e.push("   <number:year/>\n"),e.push("  </number:date-style>\n");var n=0;t.SheetNames.map(function(e){return t.Sheets[e]}).forEach(function(t){if(t&&t["!cols"])for(var r=0;r<t["!cols"].length;++r)if(t["!cols"][r]){var a=t["!cols"][r];if(null==a.width&&null==a.wpx&&null==a.wch)continue;J9(a),a.ods=n;var i=t["!cols"][r].wpx+"px";e.push('  <style:style style:name="co'+n+'" style:family="table-column">\n'),e.push('   <style:table-column-properties fo:break-before="auto" style:column-width="'+i+'"/>\n'),e.push("  </style:style>\n"),++n}});var r=0;t.SheetNames.map(function(e){return t.Sheets[e]}).forEach(function(t){if(t&&t["!rows"])for(var n=0;n<t["!rows"].length;++n)if(t["!rows"][n]){t["!rows"][n].ods=r;var a=t["!rows"][n].hpx+"px";e.push('  <style:style style:name="ro'+r+'" style:family="table-row">\n'),e.push('   <style:table-row-properties fo:break-before="auto" style:row-height="'+a+'"/>\n'),e.push("  </style:style>\n"),++r}}),e.push('  <style:style style:name="ta1" style:family="table" style:master-page-name="mp1">\n'),e.push('   <style:table-properties table:display="true" style:writing-mode="lr-tb"/>\n'),e.push("  </style:style>\n"),e.push('  <style:style style:name="ce1" style:family="table-cell" style:parent-style-name="Default" style:data-style-name="N37"/>\n'),e.push(" </office:automatic-styles>\n")}(r,e),r.push("  <office:body>\n"),r.push("    <office:spreadsheet>\n");for(var o=0;o!=e.SheetNames.length;++o)r.push(n(e.Sheets[e.SheetNames[o]],e,o));return r.push("    </office:spreadsheet>\n"),r.push("  </office:body>\n"),"fods"==t.bookType?r.push("</office:document>"):r.push("</office:document-content>"),r.join("")}}();function Nne(e,t){if("fods"==t.bookType)return Sne(e,t);var n=p6(),r="",a=[],i=[];return f6(n,r="mimetype","application/vnd.oasis.opendocument.spreadsheet"),f6(n,r="content.xml",Sne(e,t)),a.push([r,"text/xml"]),i.push([r,"ContentFile"]),f6(n,r="styles.xml",kne(e,t)),a.push([r,"text/xml"]),i.push([r,"StylesFile"]),f6(n,r="meta.xml",m6+X7()),a.push([r,"text/xml"]),i.push([r,"MetadataFile"]),f6(n,r="manifest.rdf",function(e){var t=[m6];t.push('<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#">\n');for(var n=0;n!=e.length;++n)t.push(q7(e[n][0],e[n][1])),t.push(K7("",e[n][0]));return t.push(q7("","Document","pkg")),t.push("</rdf:RDF>"),t.join("")}(i)),a.push([r,"application/rdf+xml"]),f6(n,r="META-INF/manifest.xml",function(e){var t=[m6];t.push('<manifest:manifest xmlns:manifest="urn:oasis:names:tc:opendocument:xmlns:manifest:1.0" manifest:version="1.2">\n'),t.push('  <manifest:file-entry manifest:full-path="/" manifest:version="1.2" manifest:media-type="application/vnd.oasis.opendocument.spreadsheet"/>\n');for(var n=0;n<e.length;++n)t.push('  <manifest:file-entry manifest:full-path="'+e[n][0]+'" manifest:media-type="'+e[n][1]+'"/>\n');return t.push("</manifest:manifest>"),t.join("")}(a)),n}function Cne(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)}function Ene(e){return"undefined"!=typeof TextEncoder?(new TextEncoder).encode(e):H3(A6(e))}function Ine(e){var t=e.reduce(function(e,t){return e+t.length},0),n=new Uint8Array(t),r=0;return e.forEach(function(e){n.set(e,r),r+=e.length}),n}function Tne(e,t){var n=t?t[0]:0,r=127&e[n];e:if(e[n++]>=128){if(r|=(127&e[n])<<7,e[n++]<128)break e;if(r|=(127&e[n])<<14,e[n++]<128)break e;if(r|=(127&e[n])<<21,e[n++]<128)break e;if(r+=(127&e[n])*Math.pow(2,28),++n,e[n++]<128)break e;if(r+=(127&e[n])*Math.pow(2,35),++n,e[n++]<128)break e;if(r+=(127&e[n])*Math.pow(2,42),++n,e[n++]<128)break e}return t&&(t[0]=n),r}function _ne(e){var t=new Uint8Array(7);t[0]=127&e;var n=1;e:if(e>127){if(t[n-1]|=128,t[n]=e>>7&127,++n,e<=16383)break e;if(t[n-1]|=128,t[n]=e>>14&127,++n,e<=2097151)break e;if(t[n-1]|=128,t[n]=e>>21&127,++n,e<=268435455)break e;if(t[n-1]|=128,t[n]=e/256>>>21&127,++n,e<=34359738367)break e;if(t[n-1]|=128,t[n]=e/65536>>>21&127,++n,e<=4398046511103)break e;t[n-1]|=128,t[n]=e/16777216>>>21&127,++n}return t.slice(0,n)}function Ane(e){var t=0,n=127&e[t];e:if(e[t++]>=128){if(n|=(127&e[t])<<7,e[t++]<128)break e;if(n|=(127&e[t])<<14,e[t++]<128)break e;if(n|=(127&e[t])<<21,e[t++]<128)break e;n|=(127&e[t])<<28}return n}function Rne(e){for(var t=[],n=[0];n[0]<e.length;){var r,a=n[0],i=Tne(e,n),o=7&i,s=0;if(0==(i=Math.floor(i/8)))break;switch(o){case 0:for(var c=n[0];e[n[0]++]>=128;);r=e.slice(c,n[0]);break;case 5:s=4,r=e.slice(n[0],n[0]+s),n[0]+=s;break;case 1:s=8,r=e.slice(n[0],n[0]+s),n[0]+=s;break;case 2:s=Tne(e,n),r=e.slice(n[0],n[0]+s),n[0]+=s;break;default:throw new Error("PB Type ".concat(o," for Field ").concat(i," at offset ").concat(a))}var l={data:r,type:o};null==t[i]?t[i]=[l]:t[i].push(l)}return t}function Fne(e){var t=[];return e.forEach(function(e,n){e.forEach(function(e){e.data&&(t.push(_ne(8*n+e.type)),2==e.type&&t.push(_ne(e.data.length)),t.push(e.data))})}),Ine(t)}function Dne(e){for(var t,n=[],r=[0];r[0]<e.length;){var a=Tne(e,r),i=Rne(e.slice(r[0],r[0]+a));r[0]+=a;var o={id:Ane(i[1][0].data),messages:[]};i[2].forEach(function(t){var n=Rne(t.data),a=Ane(n[3][0].data);o.messages.push({meta:n,data:e.slice(r[0],r[0]+a)}),r[0]+=a}),(null==(t=i[3])?void 0:t[0])&&(o.merge=Ane(i[3][0].data)>>>0>0),n.push(o)}return n}function One(e){var t=[];return e.forEach(function(e){var n=[];n[1]=[{data:_ne(e.id),type:0}],n[2]=[],null!=e.merge&&(n[3]=[{data:_ne(+!!e.merge),type:0}]);var r=[];e.messages.forEach(function(e){r.push(e.data),e.meta[3]=[{type:0,data:_ne(e.data.length)}],n[2].push({data:Fne(e.meta),type:2})});var a=Fne(n);t.push(_ne(a.length)),t.push(a),r.forEach(function(e){return t.push(e)})}),Ine(t)}function Lne(e,t){if(0!=e)throw new Error("Unexpected Snappy chunk type ".concat(e));for(var n=[0],r=Tne(t,n),a=[];n[0]<t.length;){var i=3&t[n[0]];if(0!=i){var o=0,s=0;if(1==i?(s=4+(t[n[0]]>>2&7),o=(224&t[n[0]++])<<3,o|=t[n[0]++]):(s=1+(t[n[0]++]>>2),2==i?(o=t[n[0]]|t[n[0]+1]<<8,n[0]+=2):(o=(t[n[0]]|t[n[0]+1]<<8|t[n[0]+2]<<16|t[n[0]+3]<<24)>>>0,n[0]+=4)),a=[Ine(a)],0==o)throw new Error("Invalid offset 0");if(o>a[0].length)throw new Error("Invalid offset beyond length");if(s>=o)for(a.push(a[0].slice(-o)),s-=o;s>=a[a.length-1].length;)a.push(a[a.length-1]),s-=a[a.length-1].length;a.push(a[0].slice(-o,-o+s))}else{var c=t[n[0]++]>>2;if(c<60)++c;else{var l=c-59;c=t[n[0]],l>1&&(c|=t[n[0]+1]<<8),l>2&&(c|=t[n[0]+2]<<16),l>3&&(c|=t[n[0]+3]<<24),c>>>=0,c++,n[0]+=l}a.push(t.slice(n[0],n[0]+c)),n[0]+=c}}var u=Ine(a);if(u.length!=r)throw new Error("Unexpected length: ".concat(u.length," != ").concat(r));return u}function Pne(e){for(var t=[],n=0;n<e.length;){var r=e[n++],a=e[n]|e[n+1]<<8|e[n+2]<<16;n+=3,t.push(Lne(r,e.slice(n,n+a))),n+=a}if(n!==e.length)throw new Error("data is not a valid framed stream!");return Ine(t)}function Mne(e){for(var t=[],n=0;n<e.length;){var r=Math.min(e.length-n,268435455),a=new Uint8Array(4);t.push(a);var i=_ne(r),o=i.length;t.push(i),r<=60?(o++,t.push(new Uint8Array([r-1<<2]))):r<=256?(o+=2,t.push(new Uint8Array([240,r-1&255]))):r<=65536?(o+=3,t.push(new Uint8Array([244,r-1&255,r-1>>8&255]))):r<=16777216?(o+=4,t.push(new Uint8Array([248,r-1&255,r-1>>8&255,r-1>>16&255]))):r<=4294967296&&(o+=5,t.push(new Uint8Array([252,r-1&255,r-1>>8&255,r-1>>16&255,r-1>>>24&255]))),t.push(e.slice(n,n+r)),o+=r,a[0]=0,a[1]=255&o,a[2]=o>>8&255,a[3]=o>>16&255,n+=r}return Ine(t)}function jne(e,t){var n=new Uint8Array(32),r=Cne(n),a=12,i=0;switch(n[0]=5,e.t){case"n":n[1]=2,function(e,t,n){var r=Math.floor(0==n?0:Math.LOG10E*Math.log(Math.abs(n)))+6176-20,a=n/Math.pow(10,r-6176);e[t+15]|=r>>7,e[t+14]|=(127&r)<<1;for(var i=0;a>=1;++i,a/=256)e[t+i]=255&a;e[t+15]|=n>=0?0:128}(n,a,e.v),i|=1,a+=16;break;case"b":n[1]=6,r.setFloat64(a,e.v?1:0,!0),i|=2,a+=8;break;case"s":if(-1==t.indexOf(e.v))throw new Error("Value ".concat(e.v," missing from SST!"));n[1]=3,r.setUint32(a,t.indexOf(e.v),!0),i|=8,a+=4;break;default:throw"unsupported cell type "+e.t}return r.setUint32(8,i,!0),n.slice(0,a)}function Bne(e,t){var n=new Uint8Array(32),r=Cne(n),a=12,i=0;switch(n[0]=3,e.t){case"n":n[2]=2,r.setFloat64(a,e.v,!0),i|=32,a+=8;break;case"b":n[2]=6,r.setFloat64(a,e.v?1:0,!0),i|=32,a+=8;break;case"s":if(-1==t.indexOf(e.v))throw new Error("Value ".concat(e.v," missing from SST!"));n[2]=3,r.setUint32(a,t.indexOf(e.v),!0),i|=16,a+=4;break;default:throw"unsupported cell type "+e.t}return r.setUint32(4,i,!0),n.slice(0,a)}function zne(e){return Tne(Rne(e)[1][0].data)}function Une(e,t,n){var r,a,i,o;if(!(null==(r=e[6])?void 0:r[0])||!(null==(a=e[7])?void 0:a[0]))throw"Mutation only works on post-BNC storages!";if((null==(o=null==(i=e[8])?void 0:i[0])?void 0:o.data)&&Ane(e[8][0].data)>0||!1)throw"Math only works with normal offsets";for(var s=0,c=Cne(e[7][0].data),l=0,u=[],h=Cne(e[4][0].data),d=0,f=[],p=0;p<t.length;++p)if(null!=t[p]){var m,g;switch(c.setUint16(2*p,l,!0),h.setUint16(2*p,d,!0),typeof t[p]){case"string":m=jne({t:"s",v:t[p]},n),g=Bne({t:"s",v:t[p]},n);break;case"number":m=jne({t:"n",v:t[p]},n),g=Bne({t:"n",v:t[p]},n);break;case"boolean":m=jne({t:"b",v:t[p]},n),g=Bne({t:"b",v:t[p]},n);break;default:throw new Error("Unsupported value "+t[p])}u.push(m),l+=m.length,f.push(g),d+=g.length,++s}else c.setUint16(2*p,65535,!0),h.setUint16(2*p,65535);for(e[2][0].data=_ne(s);p<e[7][0].data.length/2;++p)c.setUint16(2*p,65535,!0),h.setUint16(2*p,65535,!0);return e[6][0].data=Ine(u),e[3][0].data=Ine(f),s}function Wne(e){return function(t){for(var n=0;n!=e.length;++n){var r=e[n];void 0===t[r[0]]&&(t[r[0]]=r[1]),"n"===r[2]&&(t[r[0]]=Number(t[r[0]]))}}}function Vne(e){Wne([["cellDates",!1],["bookSST",!1],["bookType","xlsx"],["compression",!1],["WTF",!1]])(e)}function Hne(e,t){return"ods"==t.bookType?Nne(e,t):"numbers"==t.bookType?function(e,t){if(!t||!t.numbers)throw new Error("Must pass a `numbers` option -- check the README");var n=e.Sheets[e.SheetNames[0]];e.SheetNames.length>1&&console.error("The Numbers writer currently writes only the first table");var r=Z8(n["!ref"]);r.s.r=r.s.c=0;var a=!1;r.e.c>9&&(a=!0,r.e.c=9),r.e.r>49&&(a=!0,r.e.r=49),a&&console.error("The Numbers writer is currently limited to ".concat(e7(r)));var i=ere(n,{range:r,header:1}),o=["~Sh33tJ5~"];i.forEach(function(e){return e.forEach(function(e){"string"==typeof e&&o.push(e)})});var s={},c=[],l=V5.read(t.numbers,{type:"base64"});l.FileIndex.map(function(e,t){return[e,l.FullPaths[t]]}).forEach(function(e){var t=e[0],n=e[1];2==t.type&&t.name.match(/\.iwa/)&&Dne(Pne(t.content)).forEach(function(e){c.push(e.id),s[e.id]={deps:[],location:n,type:Ane(e.messages[0].meta[1][0].data)}})}),c.sort(function(e,t){return e-t});var u=c.filter(function(e){return e>1}).map(function(e){return[e,_ne(e)]});l.FileIndex.map(function(e,t){return[e,l.FullPaths[t]]}).forEach(function(e){var t=e[0];e[1],t.name.match(/\.iwa/)&&Dne(Pne(t.content)).forEach(function(e){e.messages.forEach(function(t){u.forEach(function(t){e.messages.some(function(e){return 11006!=Ane(e.meta[1][0].data)&&function(e,t){e:for(var n=0;n<=e.length-t.length;++n){for(var r=0;r<t.length;++r)if(e[n+r]!=t[r])continue e;return!0}return!1}(e.data,t[1])})&&s[t[0]].deps.push(e.id)})})})});for(var h,d=V5.find(l,s[1].location),f=Dne(Pne(d.content)),p=0;p<f.length;++p){var m=f[p];1==m.id&&(h=m)}var g=zne(Rne(h.messages[0].data)[1][0].data);for(f=Dne(Pne((d=V5.find(l,s[g].location)).content)),p=0;p<f.length;++p)(m=f[p]).id==g&&(h=m);for(g=zne(Rne(h.messages[0].data)[2][0].data),f=Dne(Pne((d=V5.find(l,s[g].location)).content)),p=0;p<f.length;++p)(m=f[p]).id==g&&(h=m);for(g=zne(Rne(h.messages[0].data)[2][0].data),f=Dne(Pne((d=V5.find(l,s[g].location)).content)),p=0;p<f.length;++p)(m=f[p]).id==g&&(h=m);var v=Rne(h.messages[0].data);v[6][0].data=_ne(r.e.r+1),v[7][0].data=_ne(r.e.c+1);for(var b=zne(v[46][0].data),y=V5.find(l,s[b].location),x=Dne(Pne(y.content)),w=0;w<x.length&&x[w].id!=b;++w);if(x[w].id!=b)throw"Bad ColumnRowUIDMapArchive";var k=Rne(x[w].messages[0].data);k[1]=[],k[2]=[],k[3]=[];for(var S=0;S<=r.e.c;++S){var N=[];N[1]=N[2]=[{type:0,data:_ne(S+420690)}],k[1].push({type:2,data:Fne(N)}),k[2].push({type:0,data:_ne(S)}),k[3].push({type:0,data:_ne(S)})}k[4]=[],k[5]=[],k[6]=[];for(var C=0;C<=r.e.r;++C)(N=[])[1]=N[2]=[{type:0,data:_ne(C+726270)}],k[4].push({type:2,data:Fne(N)}),k[5].push({type:0,data:_ne(C)}),k[6].push({type:0,data:_ne(C)});x[w].messages[0].data=Fne(k),y.content=Mne(One(x)),y.size=y.content.length,delete v[46];var E=Rne(v[4][0].data);E[7][0].data=_ne(r.e.r+1);var I=zne(Rne(E[1][0].data)[2][0].data);if((x=Dne(Pne((y=V5.find(l,s[I].location)).content)))[0].id!=I)throw"Bad HeaderStorageBucket";var T=Rne(x[0].messages[0].data);for(C=0;C<i.length;++C){var _=Rne(T[2][0].data);_[1][0].data=_ne(C),_[4][0].data=_ne(i[C].length),T[2][C]={type:T[2][0].type,data:Fne(_)}}x[0].messages[0].data=Fne(T),y.content=Mne(One(x)),y.size=y.content.length;var A=zne(E[2][0].data);if((x=Dne(Pne((y=V5.find(l,s[A].location)).content)))[0].id!=A)throw"Bad HeaderStorageBucket";for(T=Rne(x[0].messages[0].data),S=0;S<=r.e.c;++S)(_=Rne(T[2][0].data))[1][0].data=_ne(S),_[4][0].data=_ne(r.e.r+1),T[2][S]={type:T[2][0].type,data:Fne(_)};x[0].messages[0].data=Fne(T),y.content=Mne(One(x)),y.size=y.content.length;var R=zne(E[4][0].data);!function(){for(var e,t=V5.find(l,s[R].location),n=Dne(Pne(t.content)),r=0;r<n.length;++r){var a=n[r];a.id==R&&(e=a)}var i=Rne(e.messages[0].data);i[3]=[];var c=[];o.forEach(function(e,t){c[1]=[{type:0,data:_ne(t)}],c[2]=[{type:0,data:_ne(1)}],c[3]=[{type:2,data:Ene(e)}],i[3].push({type:2,data:Fne(c)})}),e.messages[0].data=Fne(i);var u=Mne(One(n));t.content=u,t.size=t.content.length}();var F=Rne(E[3][0].data),D=F[1][0];delete F[2];var O=Rne(D.data),L=zne(O[2][0].data);!function(){for(var e,t=V5.find(l,s[L].location),n=Dne(Pne(t.content)),a=0;a<n.length;++a){var c=n[a];c.id==L&&(e=c)}var u=Rne(e.messages[0].data);delete u[6],delete F[7];var h=new Uint8Array(u[5][0].data);u[5]=[];for(var d=0,f=0;f<=r.e.r;++f){var p=Rne(h);d+=Une(p,i[f],o),p[1][0].data=_ne(f),u[5].push({data:Fne(p),type:2})}u[1]=[{type:0,data:_ne(r.e.c+1)}],u[2]=[{type:0,data:_ne(r.e.r+1)}],u[3]=[{type:0,data:_ne(d)}],u[4]=[{type:0,data:_ne(r.e.r+1)}],e.messages[0].data=Fne(u);var m=Mne(One(n));t.content=m,t.size=t.content.length}(),D.data=Fne(O),E[3][0].data=Fne(F),v[4][0].data=Fne(E),h.messages[0].data=Fne(v);var P=Mne(One(f));return d.content=P,d.size=d.content.length,l}(e,t):"xlsb"==t.bookType?function(e,t){bee=1024,e&&!e.SSF&&(e.SSF=c6(i5));e&&e.SSF&&(z5(),B5(e.SSF),t.revssf=$5(e.SSF),t.revssf[e.SSF[65535]]=0,t.ssf=e.SSF);t.rels={},t.wbrels={},t.Strings=[],t.Strings.Count=0,t.Strings.Unique=0,dte?t.revStrings=new Map:(t.revStrings={},t.revStrings.foo=[],delete t.revStrings.foo);var n="xlsb"==t.bookType?"bin":"xml",r=Nee.indexOf(t.bookType)>-1,a={workbooks:[],sheets:[],charts:[],dialogs:[],macros:[],rels:[],strs:[],comments:[],threadedcomments:[],links:[],coreprops:[],extprops:[],custprops:[],themes:[],styles:[],calcchains:[],vba:[],drawings:[],metadata:[],people:[],TODO:[],xmlns:""};Vne(t=t||{});var i=p6(),o="",s=0;t.cellXfs=[],gte(t.cellXfs,{},{revssf:{General:0}}),e.Props||(e.Props={});if(o="docProps/core.xml",f6(i,o,J7(e.Props,t)),a.coreprops.push(o),G7(t.rels,2,o,W7.CORE_PROPS),o="docProps/app.xml",e.Props&&e.Props.SheetNames);else if(e.Workbook&&e.Workbook.Sheets){for(var c=[],l=0;l<e.SheetNames.length;++l)2!=(e.Workbook.Sheets[l]||{}).Hidden&&c.push(e.SheetNames[l]);e.Props.SheetNames=c}else e.Props.SheetNames=e.SheetNames;e.Props.Worksheets=e.Props.SheetNames.length,f6(i,o,e9(e.Props)),a.extprops.push(o),G7(t.rels,3,o,W7.EXT_PROPS),e.Custprops!==e.Props&&K5(e.Custprops||{}).length>0&&(f6(i,o="docProps/custom.xml",t9(e.Custprops)),a.custprops.push(o),G7(t.rels,4,o,W7.CUST_PROPS));for(s=1;s<=e.SheetNames.length;++s){var u={"!id":{}},h=e.Sheets[e.SheetNames[s-1]];(h||{})["!type"];if(f6(i,o="xl/worksheets/sheet"+s+"."+n,Gte(s-1,o,t,e,u)),a.sheets.push(o),G7(t.wbrels,-1,"worksheets/sheet"+s+"."+n,W7.WS[0]),h){var d=h["!comments"],f=!1,p="";d&&d.length>0&&(f6(i,p="xl/comments"+s+"."+n,qte(d,p,t)),a.comments.push(p),G7(u,-1,"../comments"+s+"."+n,W7.CMNT),f=!0),h["!legacy"]&&f&&f6(i,"xl/drawings/vmlDrawing"+s+".vml",yee(s,h["!comments"])),delete h["!comments"],delete h["!legacy"]}u["!id"].rId1&&f6(i,V7(o),H7(u))}null!=t.Strings&&t.Strings.length>0&&(f6(i,o="xl/sharedStrings."+n,function(e,t,n){return(".bin"===t.slice(-4)?W9:z9)(e,n)}(t.Strings,o,t)),a.strs.push(o),G7(t.wbrels,-1,"sharedStrings."+n,W7.SST));o="xl/workbook."+n,f6(i,o,function(e,t,n){return(".bin"===t.slice(-4)?Hte:Ute)(e,n)}(e,o,t)),a.workbooks.push(o),G7(t.rels,1,o,W7.WB),o="xl/theme/theme1.xml",f6(i,o,mee(e.Themes,t)),a.themes.push(o),G7(t.wbrels,-1,"theme/theme1.xml",W7.THEME),o="xl/styles."+n,f6(i,o,function(e,t,n){return(".bin"===t.slice(-4)?pee:tee)(e,n)}(e,o,t)),a.styles.push(o),G7(t.wbrels,-1,"styles."+n,W7.STY),e.vbaraw&&r&&(f6(i,o="xl/vbaProject.bin",e.vbaraw),a.vba.push(o),G7(t.wbrels,-1,"vbaProject.bin",W7.VBA));return o="xl/metadata."+n,f6(i,o,function(e){return(".bin"===e.slice(-4)?gee:vee)()}(o)),a.metadata.push(o),G7(t.wbrels,-1,"metadata."+n,W7.XLMETA),f6(i,"[Content_Types].xml",U7(a,t)),f6(i,"_rels/.rels",H7(t.rels)),f6(i,"xl/_rels/workbook."+n+".rels",H7(t.wbrels)),delete t.revssf,delete t.ssf,i}(e,t):Gne(e,t)}function Gne(e,t){bee=1024,e&&!e.SSF&&(e.SSF=c6(i5)),e&&e.SSF&&(z5(),B5(e.SSF),t.revssf=$5(e.SSF),t.revssf[e.SSF[65535]]=0,t.ssf=e.SSF),t.rels={},t.wbrels={},t.Strings=[],t.Strings.Count=0,t.Strings.Unique=0,dte?t.revStrings=new Map:(t.revStrings={},t.revStrings.foo=[],delete t.revStrings.foo);var n="xml",r=Nee.indexOf(t.bookType)>-1,a={workbooks:[],sheets:[],charts:[],dialogs:[],macros:[],rels:[],strs:[],comments:[],threadedcomments:[],links:[],coreprops:[],extprops:[],custprops:[],themes:[],styles:[],calcchains:[],vba:[],drawings:[],metadata:[],people:[],TODO:[],xmlns:""};Vne(t=t||{});var i=p6(),o="",s=0;if(t.cellXfs=[],gte(t.cellXfs,{},{revssf:{General:0}}),e.Props||(e.Props={}),f6(i,o="docProps/core.xml",J7(e.Props,t)),a.coreprops.push(o),G7(t.rels,2,o,W7.CORE_PROPS),o="docProps/app.xml",e.Props&&e.Props.SheetNames);else if(e.Workbook&&e.Workbook.Sheets){for(var c=[],l=0;l<e.SheetNames.length;++l)2!=(e.Workbook.Sheets[l]||{}).Hidden&&c.push(e.SheetNames[l]);e.Props.SheetNames=c}else e.Props.SheetNames=e.SheetNames;e.Props.Worksheets=e.Props.SheetNames.length,f6(i,o,e9(e.Props)),a.extprops.push(o),G7(t.rels,3,o,W7.EXT_PROPS),e.Custprops!==e.Props&&K5(e.Custprops||{}).length>0&&(f6(i,o="docProps/custom.xml",t9(e.Custprops)),a.custprops.push(o),G7(t.rels,4,o,W7.CUST_PROPS));var u=["SheetJ5"];for(t.tcid=0,s=1;s<=e.SheetNames.length;++s){var h={"!id":{}},d=e.Sheets[e.SheetNames[s-1]];(d||{})["!type"];if(f6(i,o="xl/worksheets/sheet"+s+"."+n,wte(s-1,t,e,h)),a.sheets.push(o),G7(t.wbrels,-1,"worksheets/sheet"+s+"."+n,W7.WS[0]),d){var f=d["!comments"],p=!1,m="";if(f&&f.length>0){var g=!1;f.forEach(function(e){e[1].forEach(function(e){1==e.T&&(g=!0)})}),g&&(f6(i,m="xl/threadedComments/threadedComment"+s+"."+n,wee(f,u,t)),a.threadedcomments.push(m),G7(h,-1,"../threadedComments/threadedComment"+s+"."+n,W7.TCMNT)),f6(i,m="xl/comments"+s+"."+n,xee(f)),a.comments.push(m),G7(h,-1,"../comments"+s+"."+n,W7.CMNT),p=!0}d["!legacy"]&&p&&f6(i,"xl/drawings/vmlDrawing"+s+".vml",yee(s,d["!comments"])),delete d["!comments"],delete d["!legacy"]}h["!id"].rId1&&f6(i,V7(o),H7(h))}return null!=t.Strings&&t.Strings.length>0&&(f6(i,o="xl/sharedStrings."+n,z9(t.Strings,t)),a.strs.push(o),G7(t.wbrels,-1,"sharedStrings."+n,W7.SST)),f6(i,o="xl/workbook."+n,Ute(e)),a.workbooks.push(o),G7(t.rels,1,o,W7.WB),f6(i,o="xl/theme/theme1.xml",mee(e.Themes,t)),a.themes.push(o),G7(t.wbrels,-1,"theme/theme1.xml",W7.THEME),f6(i,o="xl/styles."+n,tee(e,t)),a.styles.push(o),G7(t.wbrels,-1,"styles."+n,W7.STY),e.vbaraw&&r&&(f6(i,o="xl/vbaProject.bin",e.vbaraw),a.vba.push(o),G7(t.wbrels,-1,"vbaProject.bin",W7.VBA)),f6(i,o="xl/metadata."+n,vee()),a.metadata.push(o),G7(t.wbrels,-1,"metadata."+n,W7.XLMETA),u.length>1&&(f6(i,o="xl/persons/person.xml",function(e){var t=[m6,L6("personList",null,{xmlns:W6,"xmlns:x":$6[0]}).replace(/[\/]>/,">")];return e.forEach(function(e,n){t.push(L6("person",null,{displayName:e,id:"{54EE7950-7262-4200-6969-"+("000000000000"+n).slice(-12)+"}",userId:e,providerId:"None"}))}),t.push("</personList>"),t.join("")}(u)),a.people.push(o),G7(t.wbrels,-1,"persons/person.xml",W7.PEOPLE)),f6(i,"[Content_Types].xml",U7(a,t)),f6(i,"_rels/.rels",H7(t.rels)),f6(i,"xl/_rels/workbook.xml.rels",H7(t.wbrels)),delete t.revssf,delete t.ssf,i}function qne(e,t){var n="";switch((t||{}).type||"base64"){case"buffer":case"array":return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7]];case"base64":n=B3(e.slice(0,12));break;case"binary":n=e;break;default:throw new Error("Unrecognized type "+(t&&t.type||"undefined"))}return[n.charCodeAt(0),n.charCodeAt(1),n.charCodeAt(2),n.charCodeAt(3),n.charCodeAt(4),n.charCodeAt(5),n.charCodeAt(6),n.charCodeAt(7)]}function Kne(e,t){switch(t.type){case"base64":case"binary":break;case"buffer":case"array":t.type="";break;case"file":return q5(t.file,V5.write(e,{type:z3?"buffer":""}));case"string":throw new Error("'string' output type invalid for '"+t.bookType+"' files");default:throw new Error("Unrecognized type "+t.type)}return V5.write(e,t)}function Xne(e,t){var n={},r=z3?"nodebuffer":"undefined"!==typeof Uint8Array?"array":"string";if(t.compression&&(n.compression="DEFLATE"),t.password)n.type=r;else switch(t.type){case"base64":n.type="base64";break;case"binary":n.type="string";break;case"string":throw new Error("'string' output type invalid for '"+t.bookType+"' files");case"buffer":case"file":n.type=r;break;default:throw new Error("Unrecognized type "+t.type)}var a=e.FullPaths?V5.write(e,{fileType:"zip",type:{nodebuffer:"buffer",string:"binary"}[n.type]||n.type,compression:!!t.compression}):e.generate(n);if("undefined"!==typeof Deno&&"string"==typeof a){if("binary"==t.type||"base64"==t.type)return a;a=new Uint8Array(G3(a))}return t.password&&"undefined"!==typeof encrypt_agile?Kne(encrypt_agile(a,t.password),t):"file"===t.type?q5(t.file,a):"string"==t.type?_6(a):a}function Yne(e,t,n){n||(n="");var r=n+e;switch(t.type){case"base64":return j3(A6(r));case"binary":return A6(r);case"string":return e;case"file":return q5(t.file,r,"utf8");case"buffer":return z3?U3(r,"utf8"):"undefined"!==typeof TextEncoder?(new TextEncoder).encode(r):Yne(r,{type:"binary"}).split("").map(function(e){return e.charCodeAt(0)})}throw new Error("Unrecognized type "+t.type)}function $ne(e,t){switch(t.type){case"string":case"base64":case"binary":for(var n="",r=0;r<e.length;++r)n+=String.fromCharCode(e[r]);return"base64"==t.type?j3(n):"string"==t.type?_6(n):n;case"file":return q5(t.file,e);case"buffer":return e;default:throw new Error("Unrecognized type "+t.type)}}function Jne(e,t){F3(),zte(e);var n=c6(t||{});if(n.cellStyles&&(n.cellNF=!0,n.sheetStubs=!0),"array"==n.type){n.type="binary";var r=Jne(e,n);return n.type="array",G3(r)}var a=0;if(n.sheet&&(a="number"==typeof n.sheet?n.sheet:e.SheetNames.indexOf(n.sheet),!e.SheetNames[a]))throw new Error("Sheet not found: "+n.sheet+" : "+typeof n.sheet);switch(n.bookType||"xlsb"){case"xml":case"xlml":return Yne(Qte(e,n),n);case"slk":case"sylk":return Yne(O9.from_sheet(e.Sheets[e.SheetNames[a]],n),n);case"htm":case"html":return Yne(bne(e.Sheets[e.SheetNames[a]],n),n);case"txt":return function(e,t){switch(t.type){case"base64":return j3(e);case"binary":case"string":return e;case"file":return q5(t.file,e,"binary");case"buffer":return z3?U3(e,"binary"):e.split("").map(function(e){return e.charCodeAt(0)})}throw new Error("Unrecognized type "+t.type)}(are(e.Sheets[e.SheetNames[a]],n),n);case"csv":return Yne(rre(e.Sheets[e.SheetNames[a]],n),n,"\ufeff");case"dif":return Yne(L9.from_sheet(e.Sheets[e.SheetNames[a]],n),n);case"dbf":return $ne(D9.from_sheet(e.Sheets[e.SheetNames[a]],n),n);case"prn":return Yne(M9.from_sheet(e.Sheets[e.SheetNames[a]],n),n);case"rtf":return Yne(G9.from_sheet(e.Sheets[e.SheetNames[a]],n),n);case"eth":return Yne(P9.from_sheet(e.Sheets[e.SheetNames[a]],n),n);case"fods":return Yne(Nne(e,n),n);case"wk1":return $ne(j9.sheet_to_wk1(e.Sheets[e.SheetNames[a]],n),n);case"wk3":return $ne(j9.book_to_wk3(e,n),n);case"biff2":n.biff||(n.biff=2);case"biff3":n.biff||(n.biff=3);case"biff4":return n.biff||(n.biff=4),$ne(fne(e,n),n);case"biff5":n.biff||(n.biff=5);case"biff8":case"xla":case"xls":return n.biff||(n.biff=8),function(e,t){var n=t||{};return Kne(nne(e,n),n)}(e,n);case"xlsx":case"xlsm":case"xlam":case"xlsb":case"numbers":case"ods":return function(e,t){var n=c6(t||{});return Xne(Hne(e,n),n)}(e,n);default:throw new Error("Unrecognized bookType |"+n.bookType+"|")}}function Qne(e){if(!e.bookType){var t=e.file.slice(e.file.lastIndexOf(".")).toLowerCase();t.match(/^\.[a-z]+$/)&&(e.bookType=t.slice(1)),e.bookType={xls:"biff8",htm:"html",slk:"sylk",socialcalc:"eth",Sh33tJS:"WTF"}[e.bookType]||e.bookType}}function Zne(e,t,n,r,a,i,o,s){var c=X8(n),l=s.defval,u=s.raw||!Object.prototype.hasOwnProperty.call(s,"raw"),h=!0,d=1===a?[]:{};if(1!==a)if(Object.defineProperty)try{Object.defineProperty(d,"__rowNum__",{value:n,enumerable:!1})}catch(_a){d.__rowNum__=n}else d.__rowNum__=n;if(!o||e[n])for(var f=t.s.c;f<=t.e.c;++f){var p=o?e[n][f]:e[r[f]+c];if(void 0!==p&&void 0!==p.t){var m=p.v;switch(p.t){case"z":if(null==m)break;continue;case"e":m=0==m?null:void 0;break;case"s":case"d":case"b":case"n":break;default:throw new Error("unrecognized type "+p.t)}if(null!=i[f]){if(null==m)if("e"==p.t&&null===m)d[i[f]]=null;else if(void 0!==l)d[i[f]]=l;else{if(!u||null!==m)continue;d[i[f]]=null}else d[i[f]]=u&&("n"!==p.t||"n"===p.t&&!1!==s.rawNumbers)?m:r7(p,m,s);null!=m&&(h=!1)}}else{if(void 0===l)continue;null!=i[f]&&(d[i[f]]=l)}}return{row:d,isempty:h}}function ere(e,t){if(null==e||null==e["!ref"])return[];var n={t:"n",v:0},r=0,a=1,i=[],o=0,s="",c={s:{r:0,c:0},e:{r:0,c:0}},l=t||{},u=null!=l.range?l.range:e["!ref"];switch(1===l.header?r=1:"A"===l.header?r=2:Array.isArray(l.header)?r=3:null==l.header&&(r=0),typeof u){case"string":c=t7(u);break;case"number":(c=t7(e["!ref"])).s.r=u;break;default:c=u}r>0&&(a=0);var h=X8(c.s.r),d=[],f=[],p=0,m=0,g=Array.isArray(e),v=c.s.r,b=0,y={};g&&!e[v]&&(e[v]=[]);var x=l.skipHidden&&e["!cols"]||[],w=l.skipHidden&&e["!rows"]||[];for(b=c.s.c;b<=c.e.c;++b)if(!(x[b]||{}).hidden)switch(d[b]=$8(b),n=g?e[v][b]:e[d[b]+h],r){case 1:i[b]=b-c.s.c;break;case 2:i[b]=d[b];break;case 3:i[b]=l.header[b-c.s.c];break;default:if(null==n&&(n={w:"__EMPTY",t:"s"}),s=o=r7(n,null,l),m=y[o]||0){do{s=o+"_"+m++}while(y[s]);y[o]=m,y[s]=1}else y[o]=1;i[b]=s}for(v=c.s.r+a;v<=c.e.r;++v)if(!(w[v]||{}).hidden){var k=Zne(e,c,v,d,r,i,g,l);(!1===k.isempty||(1===r?!1!==l.blankrows:l.blankrows))&&(f[p++]=k.row)}return f.length=p,f}var tre=/"/g;function nre(e,t,n,r,a,i,o,s){for(var c=!0,l=[],u="",h=X8(n),d=t.s.c;d<=t.e.c;++d)if(r[d]){var f=s.dense?(e[n]||[])[d]:e[r[d]+h];if(null==f)u="";else if(null!=f.v){c=!1,u=""+(s.rawNumbers&&"n"==f.t?f.v:r7(f,null,s));for(var p=0,m=0;p!==u.length;++p)if((m=u.charCodeAt(p))===a||m===i||34===m||s.forceQuotes){u='"'+u.replace(tre,'""')+'"';break}"ID"==u&&(u='"ID"')}else null==f.f||f.F?u="":(c=!1,(u="="+f.f).indexOf(",")>=0&&(u='"'+u.replace(tre,'""')+'"'));l.push(u)}return!1===s.blankrows&&c?null:l.join(o)}function rre(e,t){var n=[],r=null==t?{}:t;if(null==e||null==e["!ref"])return"";var a=t7(e["!ref"]),i=void 0!==r.FS?r.FS:",",o=i.charCodeAt(0),s=void 0!==r.RS?r.RS:"\n",c=s.charCodeAt(0),l=new RegExp(("|"==i?"\\|":i)+"+$"),u="",h=[];r.dense=Array.isArray(e);for(var d=r.skipHidden&&e["!cols"]||[],f=r.skipHidden&&e["!rows"]||[],p=a.s.c;p<=a.e.c;++p)(d[p]||{}).hidden||(h[p]=$8(p));for(var m=0,g=a.s.r;g<=a.e.r;++g)(f[g]||{}).hidden||null!=(u=nre(e,a,g,h,o,c,i,r))&&(r.strip&&(u=u.replace(l,"")),(u||!1!==r.blankrows)&&n.push((m++?s:"")+u));return delete r.dense,n.join("")}function are(e,t){t||(t={}),t.FS="\t",t.RS="\n";var n=rre(e,t);if("undefined"==typeof O3||"string"==t.type)return n;var r=O3.utils.encode(1200,n,"str");return String.fromCharCode(255)+String.fromCharCode(254)+r}function ire(e,t,n){var r,a=n||{},i=+!a.skipHeader,o=e||{},s=0,c=0;if(o&&null!=a.origin)if("number"==typeof a.origin)s=a.origin;else{var l="string"==typeof a.origin?J8(a.origin):a.origin;s=l.r,c=l.c}var u={s:{c:0,r:0},e:{c:c,r:s+t.length-1+i}};if(o["!ref"]){var h=t7(o["!ref"]);u.e.c=Math.max(u.e.c,h.e.c),u.e.r=Math.max(u.e.r,h.e.r),-1==s&&(s=h.e.r+1,u.e.r=s+t.length-1+i)}else-1==s&&(s=0,u.e.r=t.length-1+i);var d=a.header||[],f=0;t.forEach(function(e,t){K5(e).forEach(function(n){-1==(f=d.indexOf(n))&&(d[f=d.length]=n);var l=e[n],u="z",h="",p=Q8({c:c+f,r:s+t+i});r=ore(o,p),!l||"object"!==typeof l||l instanceof Date?("number"==typeof l?u="n":"boolean"==typeof l?u="b":"string"==typeof l?u="s":l instanceof Date?(u="d",a.cellDates||(u="n",l=Q5(l)),h=a.dateNF||i5[14]):null===l&&a.nullError&&(u="e",l=0),r?(r.t=u,r.v=l,delete r.w,delete r.R,h&&(r.z=h)):o[p]=r={t:u,v:l},h&&(r.z=h)):o[p]=l})}),u.e.c=Math.max(u.e.c,c+d.length-1);var p=X8(s);if(i)for(f=0;f<d.length;++f)o[$8(f+c)+p]={t:"s",v:d[f]};return o["!ref"]=e7(u),o}function ore(e,t,n){if("string"==typeof t){if(Array.isArray(e)){var r=J8(t);return e[r.r]||(e[r.r]=[]),e[r.r][r.c]||(e[r.r][r.c]={t:"z"})}return e[t]||(e[t]={t:"z"})}return ore(e,Q8("number"!=typeof t?t:{r:t,c:n||0}))}function sre(){return{SheetNames:[],Sheets:{}}}function cre(e,t,n,r){var a=1;if(!n)for(;a<=65535&&-1!=e.SheetNames.indexOf(n="Sheet"+a);++a,n=void 0);if(!n||e.SheetNames.length>=65535)throw new Error("Too many worksheets");if(r&&e.SheetNames.indexOf(n)>=0){var i=n.match(/(^.*?)(\d+)$/);a=i&&+i[2]||0;var o=i&&i[1]||n;for(++a;a<=65535&&-1!=e.SheetNames.indexOf(n=o+a);++a);}if(Bte(n),e.SheetNames.indexOf(n)>=0)throw new Error("Worksheet with name |"+n+"| already exists!");return e.SheetNames.push(n),e.Sheets[n]=t,n}function lre(e,t,n){return t?(e.l={Target:t},n&&(e.l.Tooltip=n)):delete e.l,e}var ure={encode_col:$8,encode_row:X8,encode_cell:Q8,encode_range:e7,decode_col:Y8,decode_row:K8,split_cell:function(e){return e.replace(/(\$?[A-Z]*)(\$?\d*)/,"$1,$2").split(",")},decode_cell:J8,decode_range:Z8,format_cell:r7,sheet_add_aoa:i7,sheet_add_json:ire,sheet_add_dom:yne,aoa_to_sheet:o7,json_to_sheet:function(e,t){return ire(null,e,t)},table_to_sheet:xne,table_to_book:function(e,t){return a7(xne(e,t),t)},sheet_to_csv:rre,sheet_to_txt:are,sheet_to_json:ere,sheet_to_html:bne,sheet_to_formulae:function(e){var t,n="",r="";if(null==e||null==e["!ref"])return[];var a,i=t7(e["!ref"]),o="",s=[],c=[],l=Array.isArray(e);for(a=i.s.c;a<=i.e.c;++a)s[a]=$8(a);for(var u=i.s.r;u<=i.e.r;++u)for(o=X8(u),a=i.s.c;a<=i.e.c;++a)if(n=s[a]+o,r="",void 0!==(t=l?(e[u]||[])[a]:e[n])){if(null!=t.F){if(n=t.F,!t.f)continue;r=t.f,-1==n.indexOf(":")&&(n=n+":"+n)}if(null!=t.f)r=t.f;else{if("z"==t.t)continue;if("n"==t.t&&null!=t.v)r=""+t.v;else if("b"==t.t)r=t.v?"TRUE":"FALSE";else if(void 0!==t.w)r="'"+t.w;else{if(void 0===t.v)continue;r="s"==t.t?"'"+t.v:""+t.v}}c[c.length]=n+"="+r}return c},sheet_to_row_object_array:ere,sheet_get_cell:ore,book_new:sre,book_append_sheet:cre,book_set_sheet_visibility:function(e,t,n){e.Workbook||(e.Workbook={}),e.Workbook.Sheets||(e.Workbook.Sheets=[]);var r=function(e,t){if("number"==typeof t){if(t>=0&&e.SheetNames.length>t)return t;throw new Error("Cannot find sheet # "+t)}if("string"==typeof t){var n=e.SheetNames.indexOf(t);if(n>-1)return n;throw new Error("Cannot find sheet name |"+t+"|")}throw new Error("Cannot find sheet |"+t+"|")}(e,t);switch(e.Workbook.Sheets[r]||(e.Workbook.Sheets[r]={}),n){case 0:case 1:case 2:break;default:throw new Error("Bad sheet visibility setting "+n)}e.Workbook.Sheets[r].Hidden=n},cell_set_number_format:function(e,t){return e.z=t,e},cell_set_hyperlink:lre,cell_set_internal_link:function(e,t,n){return lre(e,"#"+t,n)},cell_add_comment:function(e,t,n){e.c||(e.c=[]),e.c.push({t:t,a:n||"SheetJS"})},sheet_set_array_formula:function(e,t,n,r){for(var a="string"!=typeof t?t:t7(t),i="string"==typeof t?t:e7(t),o=a.s.r;o<=a.e.r;++o)for(var s=a.s.c;s<=a.e.c;++s){var c=ore(e,o,s);c.t="n",c.F=i,delete c.v,o==a.s.r&&s==a.s.c&&(c.f=n,r&&(c.D=!0))}return e},consts:{SHEET_VISIBLE:0,SHEET_HIDDEN:1,SHEET_VERY_HIDDEN:2}};C3.version;var hre=n(9019),dre=n(764),fre=n.n(dre);const pre=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Sheet1";const r=ure.book_new(),a=ure.json_to_sheet(e);ure.book_append_sheet(r,a,n),function(e,t,n){var r=n||{};r.type="file",r.file=t,Qne(r),Jne(e,r)}(r,"".concat(t,".xlsx"))},mre=e=>e.map(e=>{const t=e.checkIns.filter(e=>!e.late).map(e=>new Date(e.time).toLocaleTimeString()).join(", "),n=[...e.checkIns.filter(e=>e.late),...e.checkOuts].map(e=>new Date(e.time).toLocaleTimeString()).join(", "),r=new Date(e.date);return{date:"".concat(String(r.getDate()).padStart(2,"0"),"/").concat(String(r.getMonth()+1).padStart(2,"0"),"/").concat(r.getFullYear().toString().slice(-2)),checkIns:t||"-",checkOuts:n||"-",duration:e.duration||"00:00:00"}}),gre=()=>{var e;const[t,n]=(0,c.useState)(null),[r,a]=(0,c.useState)([]),[i,o]=(0,c.useState)(!0),[s,l]=(0,c.useState)(""),[u,h]=(0,c.useState)(""),[d,f]=(0,c.useState)(null),[p,m]=(0,c.useState)(!1),[g,v]=(0,c.useState)([]),b=(0,c.useRef)(null),[y,x]=(0,c.useState)(!1),[w,k]=(0,c.useState)(null),[S,N]=(0,c.useState)(null),[C,E]=(0,c.useState)(!1),[I,T]=(0,c.useState)(null),[_,A]=(0,c.useState)([]),[R,F]=(0,c.useState)(!1),[D,O]=(0,c.useState)({startDate:"",endDate:""});(0,c.useEffect)(()=>{(async()=>{try{Yw().flagRegistry.GPGPU&&Yw().set("WEBGL_FORCE_F16_TEXTURES",!0),await Promise.all([Fx.ssdMobilenetv1.loadFromUri("/models"),Fx.faceLandmark68Net.loadFromUri("/models"),Fx.faceRecognitionNet.loadFromUri("/models")]),x(!0)}catch(e){console.error("Error loading face-api models:",e)}})(),L(),P()},[]);const L=async()=>{try{o(!0);const{data:e}=await ya.get("/attendance/all");a(e)}catch(Cie){l("Failed to fetch attendance records.")}finally{o(!1)}},P=async()=>{try{const{data:e}=await ya.get("/fighters/rfids");v(e)}catch(Cie){console.error("Failed to fetch RFIDs for autosuggest.",Cie)}},M=e=>{h(""),f(null),N(null),n(e),"face"===e&&B()},j=()=>{z(),n(null)},B=()=>{if(w)return;const e=setInterval(async()=>{if(b.current&&y){const r=b.current.getScreenshot();if(!r)return;const a=await Hb(r),i=await Zx(a,new Jy({minConfidence:.75})).withFaceLandmarks().withFaceDescriptor();if(i){z(),m(!0);try{const e=Array.from(i.descriptor),{data:t}=await ya.post("/attendance/admin/face-recognition",{faceDescriptor:e});f({type:"success",message:t.msg,fighter:t.fighter}),L()}catch(Cie){var e,t,n;const a=(null===(e=Cie.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.msg)||"Recognition failed.";if(f({type:"error",message:a}),400===(null===(n=Cie.response)||void 0===n?void 0:n.status))return void m(!1)}finally{m(!1),setTimeout(()=>j(),3e3)}}}},1e3);k(e)},z=()=>{w&&(clearInterval(w),k(null))},U=async e=>{F(!0);try{let t="/attendance/fighter/".concat(e);const n=new URLSearchParams;D.startDate&&D.endDate&&(n.append("startDate",D.startDate),n.append("endDate",D.endDate)),n.toString()&&(t+="?".concat(n.toString()));const{data:r}=await ya.get(t);A(r)}catch(Cie){console.error("Failed to fetch fighter attendance:",Cie)}finally{F(!1)}};(0,c.useEffect)(()=>{C&&I&&(D.startDate&&D.endDate||!D.startDate&&!D.endDate)&&U(I.id)},[D,C,I]);return(0,xa.jsxs)("div",{className:"p-4 md:p-8 bg-gray-50 min-h-screen",children:[(0,xa.jsx)("h2",{className:"text-3xl font-bold text-gray-800 mb-6",children:"Attendance Management"}),(0,xa.jsxs)("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:[(0,xa.jsxs)("div",{className:"flex justify-between items-center p-6",children:[(0,xa.jsx)("h3",{className:"text-xl font-semibold text-gray-700",children:"Recent Attendance Records"}),(0,xa.jsxs)("div",{className:"flex gap-4",children:[(0,xa.jsxs)("button",{onClick:()=>M("rfid"),className:"flex items-center gap-2 bg-blue-500 text-white px-4 py-2 rounded-lg font-semibold hover:bg-blue-600 transition duration-300",children:[(0,xa.jsx)(Wt,{})," RFID"]}),(0,xa.jsxs)("button",{onClick:()=>M("face"),className:"flex items-center gap-2 bg-teal-500 text-white px-4 py-2 rounded-lg font-semibold hover:bg-teal-600 transition duration-300",disabled:!y,children:[(0,xa.jsx)(it,{})," ",y?"Face ID":"Loading..."]})]})]}),(0,xa.jsx)("div",{className:"overflow-x-auto",children:i?(0,xa.jsx)("div",{className:"text-center p-8 text-gray-500",children:"Loading records..."}):s?(0,xa.jsx)("div",{className:"text-center p-8 text-red-500",children:s}):(0,xa.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,xa.jsx)("thead",{className:"bg-gray-50",children:(0,xa.jsxs)("tr",{children:[(0,xa.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Fighter Name"}),(0,xa.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"RFID"}),(0,xa.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),(0,xa.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Check In"}),(0,xa.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Check Out"}),(0,xa.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Duration"})]})}),(0,xa.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:r.length>0?r.map(e=>(0,xa.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,xa.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:(0,xa.jsx)("button",{onClick:()=>(async(e,t)=>{let n=t.fighterId;!n&&t.id&&(n=t.id.split("-")[0]),n&&(T({name:e,id:n}),E(!0),await U(n))})(e.fighterName,e),className:"text-blue-600 hover:text-blue-800 hover:underline",children:e.fighterName})}),(0,xa.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.rfid}),(0,xa.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:(()=>{const t=new Date(e.date),n=String(t.getUTCDate()).padStart(2,"0"),r=String(t.getUTCMonth()+1).padStart(2,"0"),a=t.getUTCFullYear().toString().slice(-2);return"".concat(n,"/").concat(r,"/").concat(a)})()}),(0,xa.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:(0,xa.jsx)("div",{children:e.checkIns.map((e,t)=>(0,xa.jsxs)("div",{className:"flex items-center gap-2",children:[e.missed&&(0,xa.jsx)(gt,{className:"text-red-500",title:"Indicates a missed punch-out on the previous day"}),(0,xa.jsx)("span",{className:"text-green-600 font-semibold",children:new Date(e.time).toLocaleTimeString()})]},"in-".concat(t)))})}),(0,xa.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:(0,xa.jsx)("div",{children:e.checkOuts.map((e,t)=>(0,xa.jsx)("div",{className:"flex items-center gap-2",children:e.late?(0,xa.jsxs)(xa.Fragment,{children:[(0,xa.jsx)("span",{className:"text-gray-500 font-semibold",children:new Date(e.time).toLocaleTimeString()}),(0,xa.jsx)(gt,{className:"text-yellow-400",title:"Indicates a late punch-out from a previous day"})]}):(0,xa.jsx)("span",{className:"text-red-600 font-semibold",children:new Date(e.time).toLocaleTimeString()})},"out-".concat(t)))})}),(0,xa.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-semibold text-gray-700",children:e.duration})]},e.id)):(0,xa.jsx)("tr",{children:(0,xa.jsx)("td",{colSpan:"6",className:"px-6 py-4 text-center text-sm text-gray-500",children:"No attendance records found."})})})]})})]}),C&&I&&(0,xa.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4",children:(0,xa.jsxs)("div",{className:"bg-white rounded-lg shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-hidden flex flex-col",children:[(0,xa.jsxs)("div",{className:"flex justify-between items-center p-6 border-b",children:[(0,xa.jsxs)("h3",{className:"text-xl font-semibold text-gray-800",children:["Attendance Report for ",I.name]}),(0,xa.jsx)("button",{onClick:()=>{E(!1),T(null),A([]),O({startDate:"",endDate:""})},className:"text-gray-500 hover:text-gray-800 text-2xl",children:(0,xa.jsx)(Lt,{})})]}),(0,xa.jsx)("div",{className:"p-6 border-b bg-gray-50",children:(0,xa.jsxs)("div",{className:"flex items-center gap-4 flex-wrap",children:[(0,xa.jsxs)("div",{className:"flex items-center gap-2",children:[(0,xa.jsx)(rt,{className:"text-gray-500"}),(0,xa.jsx)("span",{className:"font-medium text-gray-700",children:"Date Filter:"})]}),(0,xa.jsxs)("div",{className:"flex gap-2 flex-wrap",children:[(0,xa.jsx)("input",{type:"date",value:D.startDate,onChange:e=>O(Kt(Kt({},D),{},{startDate:e.target.value})),className:"px-3 py-2 border border-gray-300 rounded-md text-sm",placeholder:"Start Date"}),(0,xa.jsx)("span",{className:"flex items-center text-gray-500",children:"to"}),(0,xa.jsx)("input",{type:"date",value:D.endDate,onChange:e=>O(Kt(Kt({},D),{},{endDate:e.target.value})),className:"px-3 py-2 border border-gray-300 rounded-md text-sm",placeholder:"End Date"})]}),(0,xa.jsxs)("div",{className:"flex gap-2",children:[(0,xa.jsxs)("button",{onClick:async()=>{D.startDate&&D.endDate?new Date(D.startDate)>new Date(D.endDate)?alert("Start date cannot be after end date."):I&&await U(I.id):alert("Please select both start and end dates.")},className:"flex items-center gap-2 bg-blue-500 text-white px-4 py-2 rounded-md text-sm hover:bg-blue-600",children:[(0,xa.jsx)(wt,{})," Apply Filter"]}),(0,xa.jsx)("button",{onClick:async()=>{O({startDate:"",endDate:""}),I&&setTimeout(async()=>{await U(I.id)},100)},className:"flex items-center gap-2 bg-gray-500 text-white px-4 py-2 rounded-md text-sm hover:bg-gray-600",children:"Reset"})]})]})}),(0,xa.jsx)("div",{className:"flex-grow overflow-auto",children:R?(0,xa.jsx)("div",{className:"text-center p-8 text-gray-500",children:"Loading attendance report..."}):(0,xa.jsx)("div",{className:"overflow-x-auto",children:(0,xa.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,xa.jsx)("thead",{className:"bg-gray-50 sticky top-0",children:(0,xa.jsxs)("tr",{children:[(0,xa.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),(0,xa.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Check-Ins"}),(0,xa.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Check-Outs"}),(0,xa.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Duration"})]})}),(0,xa.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:_.length>0?_.map(e=>{const t=e.checkIns.filter(e=>!e.late),n=[...e.checkIns.filter(e=>e.late),...e.checkOuts];return(0,xa.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,xa.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:(()=>{const t=new Date(e.date),n=String(t.getDate()).padStart(2,"0"),r=String(t.getMonth()+1).padStart(2,"0"),a=t.getFullYear().toString().slice(-2);return"".concat(n,"/").concat(r,"/").concat(a)})()}),(0,xa.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:t.map((e,t)=>(0,xa.jsx)("div",{className:"flex items-center gap-2",children:(0,xa.jsx)("span",{className:"text-green-600 font-semibold",children:new Date(e.time).toLocaleTimeString()})},"in-".concat(t)))}),(0,xa.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:(0,xa.jsx)("div",{className:"flex flex-col space-y-0.1",children:n.map((e,t)=>(0,xa.jsx)("div",{className:"flex items-center gap-2",children:e.late?(0,xa.jsxs)("div",{className:"flex items-center gap-2 px-1 rounded w-full",children:[(0,xa.jsx)("span",{className:"text-gray-500 font-semibold",children:new Date(e.time).toLocaleTimeString()}),(0,xa.jsx)(gt,{className:"text-yellow-500",title:"Indicates a late punch-out from a previous day"})]}):(0,xa.jsx)("span",{className:"text-red-600 font-semibold pl-1",children:new Date(e.time).toLocaleTimeString()})},"out-".concat(t)))})}),(0,xa.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-semibold text-gray-800",children:e.duration})]},e.id||e.date)}):(0,xa.jsx)("tr",{children:(0,xa.jsx)("td",{colSpan:"4",className:"px-6 py-4 text-center text-sm text-gray-500",children:"No attendance records found for this fighter."})})})]})})}),(0,xa.jsx)("div",{className:"p-6 border-t bg-gray-50",children:(0,xa.jsxs)("div",{className:"flex justify-between items-center flex-wrap gap-4",children:[(0,xa.jsxs)("div",{className:"flex gap-2 flex-wrap",children:[(0,xa.jsxs)("button",{onClick:()=>{const e=mre(_);pre(e,"attendance_".concat(I.name.replace(/\s+/g,"_")),"Attendance")},className:"flex items-center gap-2 bg-green-500 text-white px-3 py-1 rounded-md font-semibold hover:bg-green-600 transition duration-300 text-sm",disabled:R||0===_.length,children:[(0,xa.jsx)(yt,{})," Excel"]}),(0,xa.jsxs)("button",{onClick:()=>{!function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Attendance Report";const a=new hre.default;a.setFontSize(18),a.text(r,14,20),a.setFontSize(12),a.text("Generated on: ".concat((new Date).toLocaleDateString()),14,30),fre()(a,{head:[t.map(e=>e.header)],body:e.map(e=>t.map(t=>t.key.includes(".")?t.key.split(".").reduce((e,t)=>e&&e[t],e)||"":e[t.key]||"")),startY:40,styles:{fontSize:8,cellPadding:2},headStyles:{fillColor:[66,66,66],textColor:[255,255,255]},alternateRowStyles:{fillColor:[245,245,245]}}),a.save("".concat(n,".pdf"))}(mre(_),[{header:"Date",key:"date"},{header:"Check-Ins",key:"checkIns"},{header:"Check-Outs",key:"checkOuts"},{header:"Duration",key:"duration"}],"attendance_".concat(I.name.replace(/\s+/g,"_")),"Attendance Report - ".concat(I.name))},className:"flex items-center gap-2 bg-red-500 text-white px-3 py-1 rounded-md font-semibold hover:bg-red-600 transition duration-300 text-sm",disabled:R||0===_.length,children:[(0,xa.jsx)(xt,{})," PDF"]})]}),(0,xa.jsxs)("div",{className:"flex flex-col items-end",children:[(0,xa.jsxs)("div",{className:"text-sm text-gray-600",children:["Total Days: ",_.length]}),(0,xa.jsxs)("div",{className:"text-sm text-gray-600",children:["Total Duration: ",(()=>{const e=_.reduce((e,t)=>{const[n,r,a]=t.duration.split(":").map(Number);return e+3600*n+60*r+a},0),t=Math.floor(e/3600),n=Math.floor(e%3600/60),r=e%60;return"".concat(t.toString().padStart(2,"0"),":").concat(n.toString().padStart(2,"0"),":").concat(r.toString().padStart(2,"0"))})()]})]})]})})]})}),t&&(0,xa.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50",children:(0,xa.jsxs)("div",{className:"bg-white rounded-lg shadow-2xl p-6 w-full max-w-md relative",children:[(0,xa.jsx)("button",{onClick:j,className:"absolute top-3 right-3 text-gray-500 hover:text-gray-800 text-2xl",children:(0,xa.jsx)(Lt,{})}),(0,xa.jsx)("h3",{className:"text-xl font-semibold text-gray-800 mb-4",children:"rfid"===t?"RFID Punch In / Out":"Face Recognition"}),"rfid"===t&&(0,xa.jsx)("div",{children:S?(0,xa.jsxs)("div",{className:"text-center",children:[(0,xa.jsxs)("p",{className:"text-lg font-medium text-gray-800",children:["Fighter: ",(0,xa.jsx)("span",{className:"font-bold",children:S.fighter.name})]}),(0,xa.jsxs)("p",{className:"text-sm text-gray-500 mb-4",children:["RFID: ",S.fighter.rfid]}),(0,xa.jsx)("button",{onClick:async()=>{if(S){m(!0),f(null);try{const{data:e}=await ya.post("/attendance/admin/rfid",{rfid:S.fighter.rfid});f({type:"success",message:e.msg,fighter:e.fighter}),h(""),L(),setTimeout(()=>j(),3e3)}catch(Cie){var e,t;const r=(null===(e=Cie.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.msg)||"An error occurred.";f({type:"error",message:r})}finally{m(!1),N(null)}}},className:"w-full px-6 py-3 rounded-lg font-bold text-white text-lg disabled:bg-gray-400 ".concat("in"===S.nextAction?"bg-green-600 hover:bg-green-700":"bg-red-600 hover:bg-red-700"),disabled:p,children:p?"Processing...":"Confirm Punch ".concat(S.nextAction.toUpperCase())})]}):(0,xa.jsxs)("form",{onSubmit:async e=>{e.preventDefault();const t=u.trim();if(t){m(!0),f(null),N(null);try{const{data:e}=await ya.get("/attendance/status/".concat(t));N(e)}catch(Cie){var n,r;const t=(null===(n=Cie.response)||void 0===n||null===(r=n.data)||void 0===r?void 0:r.msg)||"An error occurred.";f({type:"error",message:t})}finally{m(!1)}}else f({type:"error",message:"Please enter a valid RFID."})},className:"flex flex-col gap-4",children:[(0,xa.jsxs)("div",{className:"relative",children:[(0,xa.jsx)(St,{className:"absolute top-1/2 left-3 -translate-y-1/2 text-gray-400"}),(0,xa.jsx)("input",{type:"text",value:u,onChange:e=>h(e.target.value),placeholder:"Enter or select Fighter RFID",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg",disabled:p,autoFocus:!0,list:"rfid-suggestions"}),(0,xa.jsx)("datalist",{id:"rfid-suggestions",children:g.map((e,t)=>(0,xa.jsx)("option",{value:e},t))})]}),(0,xa.jsx)("button",{type:"submit",className:"w-full bg-blue-600 text-white px-6 py-2 rounded-lg font-semibold hover:bg-blue-700 disabled:bg-gray-400",disabled:p,children:p?"Searching...":"Find Fighter"})]})}),"face"===t&&(0,xa.jsxs)("div",{className:"text-center",children:[(0,xa.jsxs)("div",{className:"relative w-full border-4 border-gray-300 rounded-lg overflow-hidden",children:[(0,xa.jsx)(Ia(),{ref:b,audio:!1,screenshotFormat:"image/jpeg",className:"w-full h-auto"}),p&&(0,xa.jsx)("div",{className:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center text-white text-lg font-semibold",children:"Processing..."})]}),(0,xa.jsx)("p",{className:"mt-2 text-sm text-gray-500",children:"Position face in the frame. Scan will start automatically."}),(0,xa.jsx)("p",{className:"mt-1 text-xs text-gray-400",children:"Make sure the fighter's face is well-lit and centered."})]}),d&&(0,xa.jsxs)("div",{className:"mt-4 p-3 rounded-lg flex items-center gap-3 text-sm ".concat("success"===d.type?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:[(0,xa.jsx)(st,{}),(0,xa.jsxs)("div",{children:[(0,xa.jsx)("p",{className:"font-semibold",children:d.message}),(null===(e=d.fighter)||void 0===e?void 0:e.name)&&(0,xa.jsx)("p",{children:"Fighter: ".concat(d.fighter.name)})]})]})]})})]})},vre=e=>{let{user:t}=e;const[n,r]=(0,c.useState)(null),[a,i]=(0,c.useState)(!0),o=ie();(0,c.useEffect)(()=>{(async()=>{try{const e=await ya.get("/fighters/me");r(e.data)}catch(Cie){console.error("Error fetching fighter data:",Cie)}finally{i(!1)}})()},[]);return a?(0,xa.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-100",children:"Loading your profile..."}):n?(0,xa.jsx)("div",{className:"min-h-screen bg-gray-100 p-8",children:(0,xa.jsxs)("div",{className:"max-w-4xl mx-auto bg-white shadow-lg rounded-lg p-6",children:[(0,xa.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,xa.jsx)("h1",{className:"text-3xl font-bold text-red-600",children:"My Fighter Profile"}),(0,xa.jsx)("button",{onClick:()=>{localStorage.removeItem("token"),o("/"),window.location.reload()},className:"px-4 py-2 bg-gray-500 text-white rounded-md hover:bg-gray-600",children:"Logout"})]}),(0,xa.jsx)("h2",{className:"text-2xl font-semibold border-b pb-2 mb-4 text-gray-800",children:"Personal Info"}),(0,xa.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-gray-700 mb-6",children:[(0,xa.jsxs)("div",{children:[(0,xa.jsx)("strong",{children:"NAME:"})," ",n.name]}),(0,xa.jsxs)("div",{children:[(0,xa.jsx)("strong",{children:"FIGHTER BATCH NO:"})," ",n.fighterBatchNo]}),(0,xa.jsxs)("div",{children:[(0,xa.jsx)("strong",{children:"Age:"})," ",n.age]}),(0,xa.jsxs)("div",{children:[(0,xa.jsx)("strong",{children:"Gender:"})," ",n.gender]}),(0,xa.jsxs)("div",{children:[(0,xa.jsx)("strong",{children:"Ph No:"})," ",n.phNo]}),(0,xa.jsxs)("div",{children:[(0,xa.jsx)("strong",{children:"Address:"})," ",n.address]})]}),(0,xa.jsx)("h2",{className:"text-2xl font-semibold border-b pb-2 mb-4 text-gray-800",children:"Fighter Details"}),(0,xa.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-gray-700 mb-6",children:[(0,xa.jsxs)("div",{children:[(0,xa.jsx)("strong",{children:"Height:"})," ",n.height]}),(0,xa.jsxs)("div",{children:[(0,xa.jsx)("strong",{children:"Weight:"})," ",n.weight]}),(0,xa.jsxs)("div",{children:[(0,xa.jsx)("strong",{children:"Blood group:"})," ",n.bloodGroup]}),(0,xa.jsxs)("div",{children:[(0,xa.jsx)("strong",{children:"Occupation:"})," ",n.occupation]}),(0,xa.jsxs)("div",{children:[(0,xa.jsx)("strong",{children:"Date of Joining:"})," ",new Date(n.dateOfJoining).toLocaleDateString()]}),(0,xa.jsxs)("div",{children:[(0,xa.jsx)("strong",{children:"Package:"})," ",n.package]}),(0,xa.jsxs)("div",{children:[(0,xa.jsx)("strong",{children:"Previous Experience:"})," ",n.previousExperience]}),(0,xa.jsxs)("div",{children:[(0,xa.jsx)("strong",{children:"Medical Issue/ Injury:"})," ",n.medicalIssue]}),(0,xa.jsxs)("div",{children:[(0,xa.jsx)("strong",{children:"Motto:"})," ",n.motto]}),(0,xa.jsxs)("div",{children:[(0,xa.jsx)("strong",{children:"Martial Arts Knowledge:"})," ",n.martialArtsKnowledge]})]}),(0,xa.jsx)("h2",{className:"text-2xl font-semibold border-b pb-2 mb-4 text-gray-800",children:"Goals & Referral"}),(0,xa.jsxs)("div",{className:"text-gray-700 mb-6",children:[(0,xa.jsxs)("p",{children:[(0,xa.jsx)("strong",{children:"Goals:"})," ",n.goals.join(", ")]}),(0,xa.jsxs)("p",{children:[(0,xa.jsx)("strong",{children:"How did u know about us?:"})," ",n.referral]})]})]})}):(0,xa.jsxs)("div",{className:"min-h-screen flex flex-col items-center justify-center bg-gray-100 p-8 text-center",children:[(0,xa.jsx)("h1",{className:"text-3xl font-bold text-gray-800 mb-4",children:"Profile Not Found"}),(0,xa.jsx)("p",{className:"text-gray-600",children:"Please contact the administrator for assistance."})]})},bre=e=>{let{user:t}=e;const[n,r]=(0,c.useState)("dashboard");return(0,xa.jsxs)("div",{className:"bg-white p-6 md:p-8 rounded-xl shadow-lg",children:[(0,xa.jsxs)("div",{className:"mb-6",children:[(0,xa.jsxs)("h2",{className:"text-3xl font-bold text-gray-800",children:["Welcome, ",(null===t||void 0===t?void 0:t.name)||"Fighter","!"]}),(0,xa.jsx)("p",{className:"text-gray-500 mt-1",children:"Here's your personal dashboard."})]}),(0,xa.jsx)("div",{className:"border-b border-gray-200 mb-6",children:(0,xa.jsxs)("nav",{className:"-mb-px flex space-x-6",children:[(0,xa.jsx)("button",{onClick:()=>r("dashboard"),className:"py-3 px-1 font-semibold text-lg transition-colors duration-200 ".concat("dashboard"===n?"border-b-2 border-blue-600 text-blue-600":"text-gray-500 hover:text-gray-700"),children:"Dashboard"}),(0,xa.jsx)("button",{onClick:()=>r("fighterLevel"),className:"py-3 px-1 font-semibold text-lg transition-colors duration-200 ".concat("fighterLevel"===n?"border-b-2 border-blue-600 text-blue-600":"text-gray-500 hover:text-gray-700"),children:"Real-Time Level"})]})}),(0,xa.jsx)("div",{children:"dashboard"===n?(0,xa.jsx)(vre,{user:t}):"fighterLevel"===n?(0,xa.jsx)(aw,{fighterData:t}):null})]})},yre=e=>{let{isOpen:t,onClose:n,onSubmit:r,loading:a}=e;const[i,o]=(0,c.useState)("");if(!t)return null;return(0,xa.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50",children:(0,xa.jsxs)("div",{className:"bg-white rounded-lg shadow-xl p-6 w-full max-w-md mx-4",children:[(0,xa.jsxs)("div",{className:"flex justify-between items-center border-b pb-3 mb-4",children:[(0,xa.jsxs)("h3",{className:"text-xl font-semibold text-gray-700 flex items-center",children:[(0,xa.jsx)(St,{className:"mr-3 text-yellow-500"}),"Enter Your RFID"]}),(0,xa.jsx)("button",{onClick:n,className:"text-gray-400 hover:text-gray-600",children:(0,xa.jsx)(Lt,{size:20})})]}),(0,xa.jsxs)("form",{onSubmit:e=>{e.preventDefault(),i&&r(i)},children:[(0,xa.jsx)("p",{className:"text-gray-600 mb-4",children:"Please enter your RFID code below to check your attendance status."}),(0,xa.jsx)("input",{type:"text",value:i,onChange:e=>o(e.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-500",placeholder:"RFID Code",autoFocus:!0}),(0,xa.jsxs)("div",{className:"flex justify-end mt-6 space-x-4",children:[(0,xa.jsx)("button",{type:"button",onClick:n,className:"px-6 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300",children:"Cancel"}),(0,xa.jsx)("button",{type:"submit",disabled:!i||a,className:"px-6 py-2 bg-yellow-500 text-white rounded-lg hover:bg-yellow-600 disabled:bg-yellow-300",children:a?"Checking...":"Check Status"})]})]})]})})},xre=e=>{let{isOpen:t,onClose:n,onConfirm:r,data:a}=e;if(!t||!a)return null;const{punchType:i,fighter:o}=a,s="in"===i;return(0,xa.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex justify-center items-center z-50",children:(0,xa.jsxs)("div",{className:"bg-white rounded-lg shadow-xl p-6 w-full max-w-sm mx-4 text-center",children:[(0,xa.jsx)("div",{className:"flex justify-end",children:(0,xa.jsx)("button",{onClick:n,className:"text-gray-400 hover:text-gray-600",children:(0,xa.jsx)(Lt,{size:20})})}),(0,xa.jsx)(Mt,{className:"text-6xl text-green-500 mx-auto mb-4"}),(0,xa.jsx)("h3",{className:"text-2xl font-bold text-gray-800 mb-2",children:o.name}),(0,xa.jsx)("p",{className:"text-md text-gray-500 mb-6",children:o.fighterBatchNo}),(0,xa.jsx)("div",{className:"p-4 rounded-lg mb-6 ".concat(s?"bg-green-100":"bg-red-100"),children:(0,xa.jsxs)("p",{className:"text-lg font-semibold flex items-center justify-center",children:[s?(0,xa.jsx)(At,{className:"mr-3 text-green-600"}):(0,xa.jsx)(Rt,{className:"mr-3 text-red-600"}),(0,xa.jsxs)("span",{className:s?"text-green-800":"text-red-800",children:["Confirm Punch ",s?"IN":"OUT"]})]})}),(0,xa.jsxs)("div",{className:"flex justify-center space-x-4",children:[(0,xa.jsx)("button",{onClick:n,className:"px-8 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300",children:"Cancel"}),(0,xa.jsx)("button",{onClick:r,className:"px-8 py-2 text-white rounded-lg ".concat(s?"bg-green-500 hover:bg-green-600":"bg-red-500 hover:bg-red-600"),children:"Confirm"})]})]})})},wre=()=>{const[e,t]=(0,c.useState)([]),[n,r]=(0,c.useState)(!0),[a,i]=(0,c.useState)(!1),[o,s]=(0,c.useState)(""),[l,u]=(0,c.useState)("out"),h=ie(),[d,f]=(0,c.useState)(!1),[p,m]=(0,c.useState)(!1),[g,v]=(0,c.useState)(null),b=async()=>{r(!0);try{const{data:e}=await ya.get("/attendance/me"),n=e.map(e=>{const t=(e=>e.duration||"00:00:00")(e);return Kt(Kt({},e),{},{duration:t})});if(t(n),n.length>0){const e=n[0],t=e.checkIns.filter(e=>!e.late).length,r=e.checkOuts.length;u(t>r?"in":"out")}}catch(e){console.error("Error fetching attendance:",e),s("Failed to load attendance data.")}finally{r(!1)}};(0,c.useEffect)(()=>{b()},[]);return n?(0,xa.jsx)("div",{className:"text-center p-8",children:"Loading attendance..."}):(0,xa.jsxs)("div",{className:"p-4 sm:p-6 lg:p-8",children:[(0,xa.jsx)("h1",{className:"text-3xl font-bold text-gray-800 mb-6 border-b pb-2",children:"My Attendance"}),(0,xa.jsxs)("div",{className:"bg-white shadow-lg rounded-lg p-6 mb-8",children:[(0,xa.jsx)("h2",{className:"text-2xl font-semibold text-gray-700 mb-4",children:"Record Your Attendance"}),(0,xa.jsxs)("div",{className:"flex items-center gap-4",children:[(0,xa.jsxs)("button",{onClick:()=>f(!0),className:"bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-2 px-4 rounded-lg transition-transform transform hover:scale-105 duration-300 flex items-center justify-center text-sm shadow-md",children:[(0,xa.jsx)(St,{className:"mr-2"}),"RFID PUNCH"]}),(0,xa.jsxs)("button",{onClick:()=>h("/fighter/attendance/face"),className:"bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg transition-transform transform hover:scale-105 duration-300 flex items-center justify-center text-sm shadow-md",children:[(0,xa.jsx)(it,{className:"mr-2"}),"FACE PUNCH"]})]}),o&&(0,xa.jsx)("p",{className:"mt-6 text-center text-sm font-medium ".concat(o.includes("Error")?"text-red-600":"text-green-600"),children:o})]}),(0,xa.jsxs)("div",{className:"bg-white shadow-lg rounded-lg overflow-hidden",children:[(0,xa.jsx)("div",{className:"p-6",children:(0,xa.jsxs)("h3",{className:"text-xl font-semibold text-gray-700 flex items-center",children:[(0,xa.jsx)(lt,{className:"mr-3 text-gray-500"}),"Attendance History"]})}),(0,xa.jsx)("div",{className:"overflow-x-auto",children:(0,xa.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,xa.jsx)("thead",{className:"bg-gray-50",children:(0,xa.jsxs)("tr",{children:[(0,xa.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"RFID"}),(0,xa.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),(0,xa.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Check-Ins"}),(0,xa.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Check-Outs"}),(0,xa.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Duration"})]})}),(0,xa.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:e.length>0?e.map(e=>{const t=e.checkIns.filter(e=>!e.late),n=[...e.checkIns.filter(e=>e.late),...e.checkOuts];return(0,xa.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,xa.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-700",children:e.rfid}),(0,xa.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:(()=>{const t=new Date(e.date),n=String(t.getDate()).padStart(2,"0"),r=String(t.getMonth()+1).padStart(2,"0"),a=t.getFullYear().toString().slice(-2);return"".concat(n,"/").concat(r,"/").concat(a)})()}),(0,xa.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:t.map((e,t)=>(0,xa.jsx)("div",{className:"flex items-center gap-2",children:(0,xa.jsx)("span",{className:"text-green-600 font-semibold",children:new Date(e.time).toLocaleTimeString()})},"in-".concat(t)))}),(0,xa.jsx)("td",{className:"px-5 py-3 whitespace-nowrap text-sm",children:(0,xa.jsx)("div",{className:"flex flex-col space-y-0.1",children:n.map((e,t)=>(0,xa.jsx)("div",{className:"flex items-center gap-2 ",children:e.late?(0,xa.jsxs)("div",{className:"flex items-center gap-2 px-1 rounded w-full",children:[(0,xa.jsx)("span",{className:"text-gray-500 font-semibold",children:new Date(e.time).toLocaleTimeString()}),(0,xa.jsx)(gt,{className:"text-yellow-500",title:"Indicates a late punch-out from a previous day"})]}):(0,xa.jsx)("span",{className:"text-red-600 font-semibold pl-1",children:new Date(e.time).toLocaleTimeString()})},"out-".concat(t)))})}),(0,xa.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-semibold text-gray-800",children:e.duration})]},e.id||e.date)}):(0,xa.jsx)("tr",{children:(0,xa.jsx)("td",{colSpan:"5",className:"px-6 py-4 text-center text-sm text-gray-500",children:"No attendance records found."})})})]})})]}),d&&(0,xa.jsx)(yre,{isOpen:d,onClose:()=>f(!1),onSubmit:async e=>{i(!0),s("");try{const{data:t}=await ya.post("/attendance/rfid-status",{rfid:e});v(t),f(!1),m(!0)}catch(Cie){var t,n;const r=(null===(t=Cie.response)||void 0===t||null===(n=t.data)||void 0===n?void 0:n.msg)||"An error occurred.";s("Error: ".concat(r)),f(!1)}finally{i(!1)}},loading:a}),p&&g&&(0,xa.jsx)(xre,{isOpen:p,onClose:()=>m(!1),onConfirm:async()=>{m(!1),await(async()=>{i(!0),s("");try{const{data:e}=await ya.post("/attendance/punch");s(e.msg),await b()}catch(Cie){var e,t;const r=(null===(e=Cie.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.msg)||"An error occurred.";s("Error: ".concat(r))}finally{i(!1)}})()},data:g})]})},kre=()=>{ie();const[e,t]=(0,c.useState)({age:"",gender:"male",phNo:"",address:"",height:"",weight:"",bloodGroup:"",occupation:"",package:"monthly",previousExperience:"",medicalIssue:"",motto:"",martialArtsKnowledge:"",goals:[],referral:"",agreement:!1}),[n,r]=(0,c.useState)(""),a=e=>{const{name:n,value:r}=e.target;t(e=>Kt(Kt({},e),{},{[n]:r}))},i=e=>{const{value:n,checked:r}=e.target;t(e=>Kt(Kt({},e),{},r?{goals:[...e.goals,n]}:{goals:e.goals.filter(e=>e!==n)}))};return(0,xa.jsxs)("div",{className:"min-h-screen bg-gray-900 flex items-center justify-center p-4",children:[(0,xa.jsxs)("div",{className:"max-w-4xl w-full bg-gray-800 text-white rounded-lg shadow-xl p-8",children:[(0,xa.jsx)("h1",{className:"text-3xl font-bold text-center mb-6 text-red-500",children:"Complete Your Fighter Profile"}),(0,xa.jsx)("p",{className:"text-center text-gray-400 mb-8",children:"Please fill out your details to access your dashboard."}),(0,xa.jsxs)("form",{onSubmit:async t=>{if(t.preventDefault(),e.agreement){r("");try{await ya.post("/fighters/profile",e),window.location.href="/fighter"}catch(Cie){var n,a;console.error("Profile update error:",Cie),r((null===(n=Cie.response)||void 0===n||null===(a=n.data)||void 0===a?void 0:a.msg)||"Failed to update profile. Please try again.")}}else r("You must agree to the terms and conditions to proceed.")},className:"space-y-8",children:[(0,xa.jsxs)("div",{className:"p-6 bg-gray-700 rounded-lg",children:[(0,xa.jsx)("h2",{className:"text-xl font-semibold mb-4 border-b border-gray-600 pb-2",children:"Personal Info"}),(0,xa.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,xa.jsx)("input",{type:"number",name:"age",placeholder:"Age",onChange:a,required:!0,className:"input-style"}),(0,xa.jsxs)("select",{name:"gender",onChange:a,className:"input-style",children:[(0,xa.jsx)("option",{value:"male",children:"Male"}),(0,xa.jsx)("option",{value:"female",children:"Female"}),(0,xa.jsx)("option",{value:"other",children:"Other"})]}),(0,xa.jsx)("input",{type:"tel",name:"phNo",placeholder:"Phone Number",onChange:a,required:!0,className:"input-style"}),(0,xa.jsx)("input",{type:"text",name:"address",placeholder:"Address",onChange:a,required:!0,className:"input-style"})]})]}),(0,xa.jsxs)("div",{className:"p-6 bg-gray-700 rounded-lg",children:[(0,xa.jsx)("h2",{className:"text-xl font-semibold mb-4 border-b border-gray-600 pb-2",children:"Fighter Details"}),(0,xa.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,xa.jsx)("input",{type:"text",name:"height",placeholder:"Height (cm)",onChange:a,required:!0,className:"input-style"}),(0,xa.jsx)("input",{type:"text",name:"weight",placeholder:"Weight (kg)",onChange:a,required:!0,className:"input-style"}),(0,xa.jsx)("input",{type:"text",name:"bloodGroup",placeholder:"Blood Group",onChange:a,className:"input-style"}),(0,xa.jsx)("input",{type:"text",name:"occupation",placeholder:"Occupation",onChange:a,className:"input-style"}),(0,xa.jsxs)("select",{name:"package",onChange:a,className:"input-style",children:[(0,xa.jsx)("option",{value:"monthly",children:"Monthly"}),(0,xa.jsx)("option",{value:"quarterly",children:"Quarterly"}),(0,xa.jsx)("option",{value:"yearly",children:"Yearly"})]}),(0,xa.jsx)("input",{type:"text",name:"previousExperience",placeholder:"Previous Martial Arts Experience?",onChange:a,className:"input-style"}),(0,xa.jsx)("textarea",{name:"medicalIssue",placeholder:"Any Medical Issues?",onChange:a,className:"input-style md:col-span-2",rows:"2"}),(0,xa.jsx)("textarea",{name:"motto",placeholder:"What is your Motto?",onChange:a,className:"input-style md:col-span-2",rows:"2"}),(0,xa.jsx)("textarea",{name:"martialArtsKnowledge",placeholder:"Knowledge in Martial Arts",onChange:a,className:"input-style md:col-span-2",rows:"2"})]})]}),(0,xa.jsxs)("div",{className:"p-6 bg-gray-700 rounded-lg",children:[(0,xa.jsx)("h2",{className:"text-xl font-semibold mb-4 border-b border-gray-600 pb-2",children:"Goals & Referral"}),(0,xa.jsxs)("div",{children:[(0,xa.jsx)("label",{className:"block mb-2",children:"What are your goals?"}),(0,xa.jsx)("div",{className:"flex flex-wrap gap-4",children:["Fitness","Self-defense","Competition","Discipline"].map(e=>(0,xa.jsxs)("label",{className:"flex items-center space-x-2",children:[(0,xa.jsx)("input",{type:"checkbox",value:e,onChange:i,className:"h-4 w-4 bg-gray-600 border-gray-500 rounded text-red-500 focus:ring-red-500"}),(0,xa.jsx)("span",{children:e})]},e))})]}),(0,xa.jsx)("input",{type:"text",name:"referral",placeholder:"How did you hear about us?",onChange:a,className:"input-style mt-4"})]}),(0,xa.jsx)("div",{className:"p-6 bg-gray-700 rounded-lg",children:(0,xa.jsxs)("label",{className:"flex items-center space-x-3 cursor-pointer",children:[(0,xa.jsx)("input",{type:"checkbox",checked:e.agreement,onChange:e=>{t(t=>Kt(Kt({},t),{},{agreement:e.target.checked}))},className:"h-5 w-5 bg-gray-600 border-gray-500 rounded text-red-500 focus:ring-red-500"}),(0,xa.jsx)("span",{className:"text-gray-300",children:"I agree to the terms and conditions and the gym's code of conduct."})]})}),n&&(0,xa.jsx)("p",{className:"text-red-400 text-center",children:n}),(0,xa.jsx)("button",{type:"submit",className:"w-full bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-4 rounded-lg transition duration-300",children:"Submit Profile"})]})]}),(0,xa.jsx)("style",{children:"\n                .input-style {\n                    background-color: #4A5568; /* gray-700 */\n                    border: 1px solid #718096; /* gray-500 */\n                    color: white;\n                    padding: 0.75rem 1rem;\n                    border-radius: 0.5rem;\n                    width: 100%;\n                }\n                .input-style::placeholder {\n                    color: #A0AEC0; /* gray-400 */\n                }\n                .input-style:focus {\n                    outline: none;\n                    border-color: #F56565; /* red-500 */\n                    box-shadow: 0 0 0 2px #F56565;\n                }\n            "})]})},Sre=()=>{const[e,t]=(0,c.useState)([]),[n,r]=(0,c.useState)(""),[a,i]=(0,c.useState)({}),[o,s]=(0,c.useState)(""),[l,u]=(0,c.useState)(!1),[h,d]=(0,c.useState)(""),f=["stance","jab","straight","left_hook","right_hook","thigh_kick","rib_kick","face_slap_kick","inner_kick","outer_kick","front_kick","rise_kick","boxing_movements","push_ups","cambo"],p=["stamina","speed","flexibility","power","martial_arts_knowledge","discipline"];(0,c.useEffect)(()=>{(async()=>{try{const e=await ya.get("/fighters/roster");t(e.data)}catch(Cie){console.error("Failed to fetch fighters",Cie)}})()},[]),(0,c.useEffect)(()=>{if(!n)return void i({});(async()=>{try{const e=await ya.get("/fighters/".concat(n));i(e.data.assessment||(()=>{const e={specialGradeScore:""};return[...f,...p].forEach(t=>{e[t]={fighterScore:"",masterScore:""}}),e})())}catch(Cie){console.error("Failed to fetch assessment",Cie)}})()},[n]);const m=(e,t,n)=>{i(r=>Kt(Kt({},r),{},{[e]:Kt(Kt({},r[e]||{}),{},{[t]:n})}))},g=e=>{let{skill:t}=e;const n=a[t]||{},r=n.fighterScore||"",i=n.masterScore||"",o=(i||0)-(r||0);return(0,xa.jsxs)("tr",{className:"border-b border-gray-200",children:[(0,xa.jsx)("td",{className:"py-2 px-2 capitalize text-gray-700 font-medium",children:t.replace(/_/g," ")}),(0,xa.jsx)("td",{className:"py-2 px-2",children:(0,xa.jsx)("input",{type:"number",value:r,onChange:e=>m(t,"fighterScore",e.target.value),className:"w-full p-2 bg-white border border-gray-300 rounded-md text-gray-800 text-center focus:ring-red-500 focus:border-red-500"})}),(0,xa.jsx)("td",{className:"py-2 px-2",children:(0,xa.jsx)("input",{type:"number",value:i,onChange:e=>m(t,"masterScore",e.target.value),className:"w-full p-2 bg-white border border-gray-300 rounded-md text-gray-800 text-center focus:ring-red-500 focus:border-red-500"})}),(0,xa.jsx)("td",{className:"py-2 px-2",children:(0,xa.jsx)("div",{className:"w-full p-2 bg-gray-200 border border-gray-300 rounded-md text-gray-800 text-center",children:o})})]})},v=e.filter(e=>e.name.toLowerCase().includes(h.toLowerCase()));return(0,xa.jsx)("div",{className:"p-4 sm:p-6 lg:p-8 text-gray-800 bg-gray-100 min-h-full",children:(0,xa.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,xa.jsx)("div",{className:"mb-6 border-b-2 border-red-500 pb-2",children:(0,xa.jsx)("h1",{className:"text-3xl font-bold text-gray-800",children:"Fighter Level Assessment"})}),(0,xa.jsx)("div",{className:"bg-white p-4 rounded-lg shadow-md mb-8",children:(0,xa.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,xa.jsx)("input",{type:"text",placeholder:"Search for a fighter...",value:h,onChange:e=>d(e.target.value),className:"w-full p-3 bg-white border border-gray-300 rounded-md text-gray-800 placeholder-gray-400 focus:ring-red-500 focus:border-red-500"}),(0,xa.jsxs)("select",{id:"fighter-select",value:n,onChange:e=>r(e.target.value),className:"w-full p-3 bg-white border border-gray-300 rounded-md text-gray-800 focus:ring-red-500 focus:border-red-500",required:!0,children:[(0,xa.jsx)("option",{value:"",children:"-- Select a Fighter --"}),v.map(e=>(0,xa.jsx)("option",{value:e._id,children:e.name},e._id))]})]})}),n?(0,xa.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-md",children:[(0,xa.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),n){u(!0),s("");try{await ya.post("/fighters/assess/".concat(n),a),s("Assessment saved successfully!"),setTimeout(()=>s(""),3e3)}catch(Cie){s("Failed to save assessment. Please try again.")}finally{u(!1)}}else s("Please select a fighter first.")},children:[(0,xa.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-x-8",children:[(0,xa.jsxs)("div",{children:[(0,xa.jsx)("h3",{className:"text-xl font-semibold my-4 text-red-600",children:"Technical Advantage"}),(0,xa.jsxs)("table",{className:"w-full",children:[(0,xa.jsx)("thead",{children:(0,xa.jsxs)("tr",{className:"border-b-2 border-gray-300",children:[(0,xa.jsx)("th",{className:"py-2 px-2 text-left text-sm font-bold text-gray-500",children:"Skill"}),(0,xa.jsx)("th",{className:"py-2 px-2 text-center text-sm font-bold text-gray-500",children:"Fighter Score"}),(0,xa.jsx)("th",{className:"py-2 px-2 text-center text-sm font-bold text-gray-500",children:"Master Score"}),(0,xa.jsx)("th",{className:"py-2 px-2 text-center text-sm font-bold text-gray-500",children:"Diff"})]})}),(0,xa.jsx)("tbody",{children:f.map(e=>(0,xa.jsx)(g,{skill:e},e))})]})]}),(0,xa.jsxs)("div",{children:[(0,xa.jsx)("h3",{className:"text-xl font-semibold my-4 text-red-600",children:"Skill Advantage"}),(0,xa.jsxs)("table",{className:"w-full",children:[(0,xa.jsx)("thead",{children:(0,xa.jsxs)("tr",{className:"border-b-2 border-gray-300",children:[(0,xa.jsx)("th",{className:"py-2 px-2 text-left text-sm font-bold text-gray-500",children:"Skill"}),(0,xa.jsx)("th",{className:"py-2 px-2 text-center text-sm font-bold text-gray-500",children:"Fighter Score"}),(0,xa.jsx)("th",{className:"py-2 px-2 text-center text-sm font-bold text-gray-500",children:"Master Score"}),(0,xa.jsx)("th",{className:"py-2 px-2 text-center text-sm font-bold text-gray-500",children:"Diff"})]})}),(0,xa.jsx)("tbody",{children:p.map(e=>(0,xa.jsx)(g,{skill:e},e))})]})]})]}),(0,xa.jsxs)("div",{className:"mt-8 pt-6 border-t grid grid-cols-1 md:grid-cols-2 gap-8 items-center",children:[(0,xa.jsxs)("div",{children:[(0,xa.jsx)("label",{className:"block text-lg font-medium mb-2 text-gray-700",htmlFor:"special-grade",children:"Special Grade Score"}),(0,xa.jsx)("input",{id:"special-grade",type:"number",value:a.specialGradeScore||"",onChange:e=>{i(t=>Kt(Kt({},t),{},{specialGradeScore:e.target.value}))},className:"w-full p-3 bg-white border border-gray-300 rounded-md",placeholder:"Enter score"})]}),(0,xa.jsx)("div",{className:"text-center md:text-right mt-4 md:mt-0",children:(0,xa.jsx)("button",{type:"submit",className:"bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-8 rounded-lg transition disabled:bg-gray-500 w-full md:w-auto",disabled:l,children:l?"Saving...":"Save Assessment"})})]})]}),o&&(0,xa.jsx)("p",{className:"text-center mt-6 text-green-600 font-medium",children:o})]}):(0,xa.jsx)("div",{className:"bg-white p-6 rounded-lg shadow-md h-64 flex items-center justify-center",children:(0,xa.jsx)("p",{className:"text-xl text-gray-500",children:"Please search and select a fighter to view or edit their assessment."})})]})})},Nre=()=>{const[e,t]=(0,c.useState)(null),[n,r]=(0,c.useState)(!0);if((0,c.useEffect)(()=>{(async()=>{try{const e=await ya.get("/fighters/me");t(e.data)}catch(Cie){console.error("Error fetching fighter data:",Cie)}finally{r(!1)}})()},[]),n)return(0,xa.jsx)("div",{className:"p-8 text-white",children:"Loading Skill Assessment..."});if(!e||!e.assessment)return(0,xa.jsxs)("div",{className:"p-8 text-white",children:[(0,xa.jsx)("h1",{className:"text-3xl font-bold mb-6 text-red-500",children:"My Skill Assessment"}),(0,xa.jsx)("div",{className:"bg-gray-800 p-6 rounded-lg shadow-lg h-64 flex items-center justify-center",children:(0,xa.jsx)("p",{className:"text-xl text-gray-400",children:"Your assessment has not been recorded by an admin yet."})})]});const a=t=>{var n;let{skill:r}=t;const a=(null===(n=e.assessment)||void 0===n?void 0:n[r])||{},i=a.fighterScore||0,o=a.masterScore||0,s=o-i;return(0,xa.jsxs)("tr",{className:"border-b border-gray-700",children:[(0,xa.jsx)("td",{className:"py-2 px-2 capitalize text-gray-300 font-medium",children:r.replace(/_/g," ")}),(0,xa.jsx)("td",{className:"py-2 px-2 text-center text-white",children:i}),(0,xa.jsx)("td",{className:"py-2 px-2 text-center text-white",children:o}),(0,xa.jsx)("td",{className:"py-2 px-2 text-center text-white font-bold",children:s})]})};return(0,xa.jsx)("div",{className:"p-4 sm:p-6 lg:p-8 text-white bg-gray-900 min-h-full",children:(0,xa.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,xa.jsx)("div",{className:"mb-6 border-b-2 border-red-500 pb-2",children:(0,xa.jsx)("h1",{className:"text-3xl font-bold text-white",children:"My Skill Assessment"})}),(0,xa.jsxs)("div",{className:"bg-gray-800 p-6 rounded-lg shadow-lg",children:[(0,xa.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-x-8",children:[(0,xa.jsxs)("div",{children:[(0,xa.jsx)("h3",{className:"text-xl font-semibold mb-4 text-red-400",children:"Technical Advantage"}),(0,xa.jsxs)("table",{className:"w-full",children:[(0,xa.jsx)("thead",{children:(0,xa.jsxs)("tr",{className:"border-b-2 border-gray-600",children:[(0,xa.jsx)("th",{className:"py-2 px-2 text-left text-sm font-bold text-gray-400",children:"Skill"}),(0,xa.jsx)("th",{className:"py-2 px-2 text-center text-sm font-bold text-gray-400",children:"My Score"}),(0,xa.jsx)("th",{className:"py-2 px-2 text-center text-sm font-bold text-gray-400",children:"Master Score"}),(0,xa.jsx)("th",{className:"py-2 px-2 text-center text-sm font-bold text-gray-400",children:"Diff"})]})}),(0,xa.jsx)("tbody",{children:["stance","jab","straight","left_hook","right_hook","thigh_kick","rib_kick","face_slap_kick","inner_kick","outer_kick","front_kick","rise_kick","boxing_movements","push_ups","cambo"].map(e=>(0,xa.jsx)(a,{skill:e},e))})]})]}),(0,xa.jsxs)("div",{children:[(0,xa.jsx)("h3",{className:"text-xl font-semibold mb-4 text-red-400",children:"Skill Advantage"}),(0,xa.jsxs)("table",{className:"w-full",children:[(0,xa.jsx)("thead",{children:(0,xa.jsxs)("tr",{className:"border-b-2 border-gray-600",children:[(0,xa.jsx)("th",{className:"py-2 px-2 text-left text-sm font-bold text-gray-400",children:"Skill"}),(0,xa.jsx)("th",{className:"py-2 px-2 text-center text-sm font-bold text-gray-400",children:"My Score"}),(0,xa.jsx)("th",{className:"py-2 px-2 text-center text-sm font-bold text-gray-400",children:"Master Score"}),(0,xa.jsx)("th",{className:"py-2 px-2 text-center text-sm font-bold text-gray-400",children:"Diff"})]})}),(0,xa.jsx)("tbody",{children:["stamina","speed","flexibility","power","martial_arts_knowledge","discipline"].map(e=>(0,xa.jsx)(a,{skill:e},e))})]})]})]}),(0,xa.jsx)("div",{className:"mt-6 pt-4 border-t border-gray-700",children:(0,xa.jsxs)("p",{className:"text-lg text-white",children:[(0,xa.jsx)("span",{className:"font-bold text-gray-400",children:"My Special Grade Score: "}),e.assessment.specialGradeScore||"N/A"]})})]})]})})};class Cre{constructor(){this.modelsLoaded=!1,this.detectionCount=0,this.maxDetections=5,this.minConfidence=.95,this.matchThreshold=.5}async loadModels(){try{return await Promise.all([Fx.ssdMobilenetv1.loadFromUri("/models"),Fx.faceLandmark68Net.loadFromUri("/models"),Fx.faceRecognitionNet.loadFromUri("/models")]),this.modelsLoaded=!0,!0}catch(e){return console.error("Error loading models:",e),!1}}async detectFace(e){if(!this.modelsLoaded)return null;try{const t=await Hb(e);return await Zx(t,new Jy({minConfidence:this.minConfidence})).withFaceLandmarks().withFaceDescriptor()}catch(t){return console.error("High accuracy face detection error:",t),null}}async recognizeFace(e){try{let t=null;try{navigator.geolocation&&(t=await new Promise((e,t)=>{navigator.geolocation.getCurrentPosition(t=>{e({latitude:t.coords.latitude,longitude:t.coords.longitude})},t=>{console.warn("Location access denied or unavailable:",t.message),e(null)},{enableHighAccuracy:!0,timeout:1e4,maximumAge:6e4})}))}catch(a){console.warn("Location error:",a)}const n=Array.from(e),r=await ya.post("/attendance/punch",{faceDescriptor:n,location:t});return{success:!0,message:r.data.msg||"Attendance marked successfully with PYTHON-BASED high accuracy!",data:r.data}}catch(i){var t,n,r;const e=(null===(t=i.response)||void 0===t||null===(n=t.data)||void 0===n?void 0:n.msg)||"PYTHON-BASED high accuracy face verification failed. Please try again.";return{success:!1,message:e.includes("SECURITY ALERT")||e.includes("Face verification failed")||e.includes("Attendance NOT marked")?e:"Face verification failed. Please ensure good lighting and try again. Attendance NOT marked for security.",status:null===(r=i.response)||void 0===r?void 0:r.status}}}resetDetectionCount(){this.detectionCount=0}incrementDetectionCount(){return this.detectionCount++,this.detectionCount}}const Ere=()=>{const e=(0,c.useRef)(null),t=ie(),[n,r]=(0,c.useState)(!0),[a,i]=(0,c.useState)("Loading models, please wait..."),[o,s]=(0,c.useState)("info"),[l,u]=(0,c.useState)(null),[h,d]=(0,c.useState)(0),[f,p]=(0,c.useState)(!1),[m,g]=(0,c.useState)(!1),[v,b]=(0,c.useState)(0),[y,x]=(0,c.useState)(!1),[w,k]=(0,c.useState)(!1),S=(0,c.useRef)(new Cre).current,N=(0,c.useCallback)(async()=>{try{i("Loading PYTHON-BASED high-accuracy face recognition models..."),s("info"),Yw().flagRegistry.GPGPU&&Yw().set("WEBGL_FORCE_F16_TEXTURES",!0);await S.loadModels()?(i('Models loaded successfully. Click "Start Camera" to begin PYTHON-BASED recognition.'),s("info"),r(!1)):(i("Error loading PYTHON-BASED models. Please refresh the page."),s("error"),r(!1))}catch(e){console.error("Error loading PYTHON-BASED models:",e),i("Error loading PYTHON-BASED models. Please refresh the page."),s("error"),r(!1)}},[S]),C=(0,c.useCallback)(async()=>{try{const e=(await ya.get("/settings")).data;if(!e.location.enabled)return k(!0),i("Location verification is disabled. Camera will activate."),s("info"),!0;if(i("Verifying your location against gym coordinates..."),s("info"),navigator.geolocation){const t=await new Promise((e,t)=>{navigator.geolocation.getCurrentPosition(t=>{e({latitude:t.coords.latitude,longitude:t.coords.longitude})},e=>{t(new Error("Location access denied: ".concat(e.message)))},{enableHighAccuracy:!0,timeout:1e4,maximumAge:6e4})}),n=((e,t)=>{const n=e=>e*Math.PI/180,r=n(e.latitude),a=n(t.latitude),i=n(t.latitude-e.latitude),o=n(t.longitude-e.longitude),s=Math.sin(i/2)*Math.sin(i/2)+Math.cos(r)*Math.cos(a)*Math.sin(o/2)*Math.sin(o/2);return 2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s))*6371e3})(t,{latitude:e.location.latitude,longitude:e.location.longitude}),r=e.location.radius||100;if(n<=r)return k(!0),i("Location verified successfully. You are ".concat(Math.round(n),"m from the gym.")),s("info"),!0;throw new Error("You are too far from the gym (".concat(Math.round(n),"m). Must be within ").concat(r,"m to mark attendance."))}throw new Error("Geolocation is not supported by your browser.")}catch(e){return console.error("Location verification error:",e),i("SECURITY ALERT: Location verification failed. ".concat(e.message," Attendance NOT marked.")),s("error"),!1}},[]),E=(0,c.useCallback)(async()=>{if(!f&&e.current&&S.modelsLoaded&&y)try{const t=e.current.getScreenshot();if(!t)return;const n=await S.detectFace(t);if(n){const e=S.incrementDetectionCount();e>=S.maxDetections?(i("PYTHON-BASED high accuracy verification in progress..."),I(n.descriptor),S.resetDetectionCount()):(i("Face detected (".concat(e,"/").concat(S.maxDetections,") for PYTHON-BASED high accuracy. Keep still...")),s("info"))}else S.resetDetectionCount(),i("No face detected. Ensure good lighting and position your face in the frame for PYTHON-BASED recognition.")}catch(t){console.error("PYTHON-BASED high accuracy face detection error:",t)}},[f,S,y]),I=(0,c.useCallback)(async e=>{if(!f){p(!0),i("Verifying face with PYTHON-BASED high accuracy... Please wait."),s("info"),b(0);try{const n=setInterval(()=>{b(e=>e>=90?(clearInterval(n),90):e+10)},200),r=await S.recognizeFace(e);if(clearInterval(n),b(100),r.success)i(r.message),s("success"),setTimeout(()=>{t("/fighter/attendance")},3e3);else{if(400===r.status)if(r.message.includes("Face verification failed"))i("SECURITY ALERT: PYTHON-BASED face verification failed. Your face does not match the registered face. Attendance NOT marked."),s("error");else{const e=r.message||"Attendance can only be marked once every 2 minutes.";i(e),s("error"),d(120)}else 404===r.status?(i("PYTHON-BASED face verification failed. Please ensure your face is registered in your profile."),s("error")):(i(r.message),s("error"));setTimeout(()=>{b(0)},3e3)}}finally{setTimeout(()=>{p(!1)},3e3)}}},[f,S,t]),T=(0,c.useCallback)(()=>{l&&clearInterval(l);const e=setInterval(()=>{E()},800);u(e)},[E]),_=(0,c.useCallback)(()=>{l&&(clearInterval(l),u(null))},[l]),A=(0,c.useCallback)(async()=>{i("Verifying location before activating camera..."),s("info");await C()&&(x(!0),i("Camera activated. Position your face in the frame."),s("info"))},[C]),R=(0,c.useCallback)(()=>{x(!1),_(),i('Camera deactivated. Click "Start Camera" to begin face recognition.'),s("info"),S.resetDetectionCount(),b(0),k(!1)},[_,S]);(0,c.useEffect)(()=>(N(),()=>{_(),e.current&&e.current.stream&&e.current.stream.getTracks().forEach(e=>e.stop())}),[N,_]),(0,c.useEffect)(()=>(S.modelsLoaded&&!n&&y?T():y||_(),()=>{_()}),[S.modelsLoaded,n,y]),(0,c.useEffect)(()=>{let e;return h>0&&(e=setInterval(()=>{d(t=>t<=1?(clearInterval(e),i("Position your face in the frame."),s("info"),0):t-1)},1e3)),()=>{e&&clearInterval(e)}},[h]);const F=()=>(0,xa.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 p-4",children:(0,xa.jsxs)("div",{className:"bg-white rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[(0,xa.jsxs)("div",{className:"bg-gradient-to-r from-blue-600 to-blue-700 px-6 py-4 flex justify-between items-center",children:[(0,xa.jsx)("h2",{className:"text-xl font-bold text-white",children:"PYTHON-BASED High Accuracy Face Recognition Help"}),(0,xa.jsx)("button",{onClick:()=>g(!1),className:"text-white hover:text-gray-200 text-2xl",children:"\xd7"})]}),(0,xa.jsxs)("div",{className:"p-6",children:[(0,xa.jsxs)("div",{className:"mb-6",children:[(0,xa.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:"How PYTHON-BASED High Accuracy Face Recognition Works"}),(0,xa.jsx)("p",{className:"text-gray-600",children:"Our system now uses advanced Python-based facial recognition technology with enhanced security measures. It captures multiple images of your face and compares them against your registered face data with strict accuracy requirements using the dlib library."})]}),(0,xa.jsxs)("div",{className:"mb-6",children:[(0,xa.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Enhanced Security & Accuracy"}),(0,xa.jsxs)("p",{className:"text-gray-600 mb-2",children:[(0,xa.jsx)("strong",{children:"Critical Security:"})," Attendance is only marked when your face matches your registered face data with extremely high accuracy using Python's dlib library. If your face does not match, attendance will NOT be marked under any circumstances."]}),(0,xa.jsxs)("ul",{className:"list-disc list-inside text-gray-600 space-y-1",children:[(0,xa.jsx)("li",{children:"System requires 5 successful face detections before verification"}),(0,xa.jsx)("li",{children:"Face matching uses a strict distance threshold of 0.5 for high accuracy"}),(0,xa.jsx)("li",{children:"At least 60% of your registered face encodings must match"}),(0,xa.jsx)("li",{children:"Attendance is only marked after successful PYTHON-BASED high accuracy verification"}),(0,xa.jsx)("li",{children:"If face does not match, no attendance record is created"}),(0,xa.jsxs)("li",{children:[(0,xa.jsx)("strong",{children:"HIGH SECURITY:"})," Only your registered face can mark attendance for your profile"]}),(0,xa.jsxs)("li",{children:[(0,xa.jsx)("strong",{children:"ZERO TOLERANCE:"})," Any non-matching face is immediately rejected"]}),(0,xa.jsxs)("li",{children:[(0,xa.jsx)("strong",{children:"PYTHON POWERED:"})," Uses dlib library for superior accuracy"]}),(0,xa.jsxs)("li",{children:[(0,xa.jsx)("strong",{children:"ISOLATED VERIFICATION:"})," Your face data is never compared against other fighters"]}),(0,xa.jsxs)("li",{children:[(0,xa.jsx)("strong",{children:"LOCATION VERIFICATION:"})," Your location is verified to ensure you are at the gym"]})]})]}),(0,xa.jsxs)("div",{className:"mb-6",children:[(0,xa.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Location Verification"}),(0,xa.jsxs)("p",{className:"text-gray-600 mb-2",children:[(0,xa.jsx)("strong",{children:"Geo-Location Security:"})," To ensure attendance is only marked when you are physically at the gym, your location will be verified during the face recognition process."]}),(0,xa.jsxs)("ul",{className:"list-disc list-inside text-gray-600 space-y-1",children:[(0,xa.jsx)("li",{children:"Your location is checked against the gym's registered location"}),(0,xa.jsx)("li",{children:"Attendance is only marked if you are within 100 meters of the gym"}),(0,xa.jsx)("li",{children:"Location data is only used for verification and not stored permanently"}),(0,xa.jsx)("li",{children:"If location access is denied, attendance cannot be marked for security"}),(0,xa.jsx)("li",{children:"Location verification happens automatically during face recognition"})]})]}),(0,xa.jsxs)("div",{className:"mb-6",children:[(0,xa.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:"For Best Results"}),(0,xa.jsxs)("ul",{className:"list-disc list-inside text-gray-600 space-y-1",children:[(0,xa.jsx)("li",{children:"Ensure excellent lighting on your face (natural light works best)"}),(0,xa.jsx)("li",{children:"Remove sunglasses, hats, or face coverings"}),(0,xa.jsx)("li",{children:"Position your face in the center of the frame"}),(0,xa.jsx)("li",{children:"Keep completely still during scanning process"}),(0,xa.jsx)("li",{children:"Make sure your entire face is clearly visible"}),(0,xa.jsx)("li",{children:"Avoid glare or shadows on your face"}),(0,xa.jsx)("li",{children:"Ensure location services are enabled in your browser"})]})]}),(0,xa.jsxs)("div",{className:"mb-6",children:[(0,xa.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Security Assurance"}),(0,xa.jsx)("p",{className:"text-gray-600 mb-2",children:"Our system implements multiple layers of security to ensure only your face can mark attendance:"}),(0,xa.jsxs)("ul",{className:"list-disc list-inside text-gray-600 space-y-1",children:[(0,xa.jsx)("li",{children:"Face data is stored only in your personal profile"}),(0,xa.jsx)("li",{children:"Verification compares only against your registered face encodings"}),(0,xa.jsx)("li",{children:"No cross-matching with other fighters' face data"}),(0,xa.jsx)("li",{children:"Strict threshold prevents false positives"}),(0,xa.jsx)("li",{children:"Multi-encoding verification ensures consistency"}),(0,xa.jsxs)("li",{children:[(0,xa.jsx)("strong",{children:"PYTHON-BASED PROCESSING:"})," Backend uses dlib library for superior accuracy"]}),(0,xa.jsxs)("li",{children:[(0,xa.jsx)("strong",{children:"ZERO TOLERANCE POLICY:"})," Any non-matching face is immediately rejected without marking attendance"]}),(0,xa.jsxs)("li",{children:[(0,xa.jsx)("strong",{children:"SECURITY ALERTS:"})," Explicit notifications when face verification fails"]}),(0,xa.jsxs)("li",{children:[(0,xa.jsx)("strong",{children:"LOCATION SECURITY:"})," Attendance only marked when you're at the gym"]})]})]}),(0,xa.jsx)("div",{className:"flex justify-end",children:(0,xa.jsx)("button",{onClick:()=>g(!1),className:"bg-blue-600 text-white px-6 py-2 rounded-lg font-semibold hover:bg-blue-700 transition duration-300",children:"Close Help"})})]})]})});return(0,xa.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 py-8 px-4 sm:px-6",children:[(0,xa.jsxs)("div",{className:"max-w-2xl mx-auto",children:[(0,xa.jsxs)("div",{className:"text-center mb-8",children:[(0,xa.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"High-Accuracy Face Recognition"}),(0,xa.jsx)("p",{className:"text-gray-600",children:"Position your face in the frame. Attendance is only marked when face and location verification are successful."})]}),(0,xa.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl overflow-hidden",children:[(0,xa.jsxs)("div",{className:"bg-gradient-to-r from-red-600 to-red-700 px-6 py-4 flex justify-between items-center",children:[(0,xa.jsx)("h2",{className:"text-xl font-semibold text-white",children:"Face & Location Scan"}),(0,xa.jsxs)("button",{onClick:()=>g(!0),className:"text-white hover:text-gray-200 flex items-center",title:"Help",children:[(0,xa.jsx)(Nt,{className:"mr-1"})," Help"]})]}),(0,xa.jsx)("div",{className:"p-6",children:(0,xa.jsxs)("div",{className:"flex flex-col items-center",children:[(0,xa.jsxs)("div",{className:"w-full max-w-md rounded-xl overflow-hidden border-2 border-gray-300 shadow-md mb-6 relative",children:[y&&(0,xa.jsx)(Ia(),{ref:e,audio:!1,screenshotFormat:"image/jpeg",videoConstraints:{width:{ideal:1280},height:{ideal:720},facingMode:"user"},className:"w-full"}),!y&&(0,xa.jsx)("div",{className:"absolute inset-0 bg-black bg-opacity-70 flex items-center justify-center",children:(0,xa.jsxs)("div",{className:"text-center p-4",children:[(0,xa.jsx)(it,{className:"text-white text-3xl mx-auto mb-3"}),(0,xa.jsx)("p",{className:"text-white font-medium",children:"Camera is not active"}),(0,xa.jsx)("button",{onClick:A,className:"mt-3 bg-blue-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-blue-700 transition duration-300",children:"Start Camera"})]})}),n&&(0,xa.jsx)("div",{className:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center",children:(0,xa.jsx)(Ft,{className:"text-white text-3xl animate-spin"})})]}),(0,xa.jsxs)("div",{className:"w-full max-w-md p-4 rounded-lg flex items-center ".concat("success"===o?"bg-green-50 border border-green-200":"error"===o?"bg-red-50 border border-red-200":"bg-blue-50 border border-blue-200"),children:[(()=>{switch(o){case"success":return(0,xa.jsx)(st,{className:"mr-3 text-green-500"});case"error":return(0,xa.jsx)(gt,{className:"mr-3 text-red-500"});default:return f?(0,xa.jsx)(Ft,{className:"mr-3 text-blue-500 animate-spin"}):(0,xa.jsx)(it,{className:"mr-3 text-blue-500"})}})(),(0,xa.jsx)("span",{className:"font-medium ".concat((()=>{switch(o){case"success":return"text-green-600";case"error":return"text-red-600";default:return"text-blue-600"}})()),children:a})]}),h>0&&(0,xa.jsx)("div",{className:"w-full max-w-md mt-4 p-4 bg-red-50 border border-red-200 rounded-lg",children:(0,xa.jsxs)("p",{className:"text-red-600 text-lg font-semibold text-center",children:["Next punch available in: ",Math.floor(h/60),":",String(h%60).padStart(2,"0")]})}),S.detectionCount>0&&S.detectionCount<S.maxDetections&&(0,xa.jsxs)("div",{className:"w-full max-w-md mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[(0,xa.jsxs)("p",{className:"text-blue-600 text-center",children:["Detection accuracy: ",S.detectionCount,"/",S.maxDetections," confirmed"]}),(0,xa.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2 mt-2",children:(0,xa.jsx)("div",{className:"bg-blue-600 h-2 rounded-full",style:{width:"".concat(S.detectionCount/S.maxDetections*100,"%")}})})]}),f&&v>0&&(0,xa.jsxs)("div",{className:"w-full max-w-md mt-4",children:[(0,xa.jsxs)("div",{className:"flex justify-between text-sm text-gray-600 mb-1",children:[(0,xa.jsx)("span",{children:"Verifying face & location..."}),(0,xa.jsxs)("span",{children:[v,"%"]})]}),(0,xa.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2.5",children:(0,xa.jsx)("div",{className:"bg-green-600 h-2.5 rounded-full transition-all duration-300",style:{width:"".concat(v,"%")}})})]}),(0,xa.jsx)("div",{className:"mt-6 flex gap-4",children:y?(0,xa.jsx)("button",{onClick:R,className:"px-6 py-3 bg-red-600 text-white rounded-lg font-semibold hover:bg-red-700 transition duration-300",children:"Stop Camera"}):(0,xa.jsxs)("button",{onClick:A,disabled:n,className:"px-6 py-3 rounded-lg font-semibold transition duration-300 ".concat(n?"bg-gray-400 cursor-not-allowed":"bg-green-600 hover:bg-green-700 text-white"),children:[(0,xa.jsx)(it,{className:"inline mr-2"}),"Start Camera"]})}),(0,xa.jsxs)("div",{className:"mt-6 text-center",children:[(0,xa.jsx)("p",{className:"text-sm text-gray-500 font-medium",children:"Security Notice: Attendance is only marked when both face and location verification are successful."}),(0,xa.jsx)("p",{className:"text-xs text-gray-400 mt-1",children:"Your location will be verified to ensure you are at the gym. Only your registered face can mark attendance."})]})]})})]})]}),m&&(0,xa.jsx)(F,{})]})},Ire=Object.create(null);Ire.open="0",Ire.close="1",Ire.ping="2",Ire.pong="3",Ire.message="4",Ire.upgrade="5",Ire.noop="6";const Tre=Object.create(null);Object.keys(Ire).forEach(e=>{Tre[Ire[e]]=e});const _re={type:"error",data:"parser error"},Are="function"===typeof Blob||"undefined"!==typeof Blob&&"[object BlobConstructor]"===Object.prototype.toString.call(Blob),Rre="function"===typeof ArrayBuffer,Fre=e=>"function"===typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer instanceof ArrayBuffer,Dre=(e,t,n)=>{let{type:r,data:a}=e;return Are&&a instanceof Blob?t?n(a):Ore(a,n):Rre&&(a instanceof ArrayBuffer||Fre(a))?t?n(a):Ore(new Blob([a]),n):n(Ire[r]+(a||""))},Ore=(e,t)=>{const n=new FileReader;return n.onload=function(){const e=n.result.split(",")[1];t("b"+(e||""))},n.readAsDataURL(e)};function Lre(e){return e instanceof Uint8Array?e:e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}let Pre;const Mre="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",jre="undefined"===typeof Uint8Array?[]:new Uint8Array(256);for(let n=0;n<64;n++)jre[Mre.charCodeAt(n)]=n;const Bre="function"===typeof ArrayBuffer,zre=(e,t)=>{if("string"!==typeof e)return{type:"message",data:Wre(e,t)};const n=e.charAt(0);if("b"===n)return{type:"message",data:Ure(e.substring(1),t)};return Tre[n]?e.length>1?{type:Tre[n],data:e.substring(1)}:{type:Tre[n]}:_re},Ure=(e,t)=>{if(Bre){const n=(e=>{let t,n,r,a,i,o=.75*e.length,s=e.length,c=0;"="===e[e.length-1]&&(o--,"="===e[e.length-2]&&o--);const l=new ArrayBuffer(o),u=new Uint8Array(l);for(t=0;t<s;t+=4)n=jre[e.charCodeAt(t)],r=jre[e.charCodeAt(t+1)],a=jre[e.charCodeAt(t+2)],i=jre[e.charCodeAt(t+3)],u[c++]=n<<2|r>>4,u[c++]=(15&r)<<4|a>>2,u[c++]=(3&a)<<6|63&i;return l})(e);return Wre(n,t)}return{base64:!0,data:e}},Wre=(e,t)=>"blob"===t?e instanceof Blob?e:new Blob([e]):e instanceof ArrayBuffer?e:e.buffer,Vre=String.fromCharCode(30);function Hre(){return new TransformStream({transform(e,t){!function(e,t){Are&&e.data instanceof Blob?e.data.arrayBuffer().then(Lre).then(t):Rre&&(e.data instanceof ArrayBuffer||Fre(e.data))?t(Lre(e.data)):Dre(e,!1,e=>{Pre||(Pre=new TextEncoder),t(Pre.encode(e))})}(e,n=>{const r=n.length;let a;if(r<126)a=new Uint8Array(1),new DataView(a.buffer).setUint8(0,r);else if(r<65536){a=new Uint8Array(3);const e=new DataView(a.buffer);e.setUint8(0,126),e.setUint16(1,r)}else{a=new Uint8Array(9);const e=new DataView(a.buffer);e.setUint8(0,127),e.setBigUint64(1,BigInt(r))}e.data&&"string"!==typeof e.data&&(a[0]|=128),t.enqueue(a),t.enqueue(n)})}})}let Gre;function qre(e){return e.reduce((e,t)=>e+t.length,0)}function Kre(e,t){if(e[0].length===t)return e.shift();const n=new Uint8Array(t);let r=0;for(let a=0;a<t;a++)n[a]=e[0][r++],r===e[0].length&&(e.shift(),r=0);return e.length&&r<e[0].length&&(e[0]=e[0].slice(r)),n}function Xre(e){if(e)return function(e){for(var t in Xre.prototype)e[t]=Xre.prototype[t];return e}(e)}Xre.prototype.on=Xre.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},Xre.prototype.once=function(e,t){function n(){this.off(e,n),t.apply(this,arguments)}return n.fn=t,this.on(e,n),this},Xre.prototype.off=Xre.prototype.removeListener=Xre.prototype.removeAllListeners=Xre.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n,r=this._callbacks["$"+e];if(!r)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var a=0;a<r.length;a++)if((n=r[a])===t||n.fn===t){r.splice(a,1);break}return 0===r.length&&delete this._callbacks["$"+e],this},Xre.prototype.emit=function(e){this._callbacks=this._callbacks||{};for(var t=new Array(arguments.length-1),n=this._callbacks["$"+e],r=1;r<arguments.length;r++)t[r-1]=arguments[r];if(n){r=0;for(var a=(n=n.slice(0)).length;r<a;++r)n[r].apply(this,t)}return this},Xre.prototype.emitReserved=Xre.prototype.emit,Xre.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},Xre.prototype.hasListeners=function(e){return!!this.listeners(e).length};const Yre="function"===typeof Promise&&"function"===typeof Promise.resolve?e=>Promise.resolve().then(e):(e,t)=>t(e,0),$re="undefined"!==typeof self?self:"undefined"!==typeof window?window:Function("return this")();function Jre(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return n.reduce((t,n)=>(e.hasOwnProperty(n)&&(t[n]=e[n]),t),{})}const Qre=$re.setTimeout,Zre=$re.clearTimeout;function eae(e,t){t.useNativeTimers?(e.setTimeoutFn=Qre.bind($re),e.clearTimeoutFn=Zre.bind($re)):(e.setTimeoutFn=$re.setTimeout.bind($re),e.clearTimeoutFn=$re.clearTimeout.bind($re))}function tae(e){return"string"===typeof e?function(e){let t=0,n=0;for(let r=0,a=e.length;r<a;r++)t=e.charCodeAt(r),t<128?n+=1:t<2048?n+=2:t<55296||t>=57344?n+=3:(r++,n+=4);return n}(e):Math.ceil(1.33*(e.byteLength||e.size))}function nae(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}class rae extends Error{constructor(e,t,n){super(e),this.description=t,this.context=n,this.type="TransportError"}}class aae extends Xre{constructor(e){super(),this.writable=!1,eae(this,e),this.opts=e,this.query=e.query,this.socket=e.socket,this.supportsBinary=!e.forceBase64}onError(e,t,n){return super.emitReserved("error",new rae(e,t,n)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this}send(e){"open"===this.readyState&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const t=zre(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}createUri(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e+"://"+this._hostname()+this._port()+this.opts.path+this._query(t)}_hostname(){const e=this.opts.hostname;return-1===e.indexOf(":")?e:"["+e+"]"}_port(){return this.opts.port&&(this.opts.secure&&Number(443!==this.opts.port)||!this.opts.secure&&80!==Number(this.opts.port))?":"+this.opts.port:""}_query(e){const t=function(e){let t="";for(let n in e)e.hasOwnProperty(n)&&(t.length&&(t+="&"),t+=encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t}(e);return t.length?"?"+t:""}}class iae extends aae{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(e){this.readyState="pausing";const t=()=>{this.readyState="paused",e()};if(this._polling||!this.writable){let e=0;this._polling&&(e++,this.once("pollComplete",function(){--e||t()})),this.writable||(e++,this.once("drain",function(){--e||t()}))}else t()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){((e,t)=>{const n=e.split(Vre),r=[];for(let a=0;a<n.length;a++){const e=zre(n[a],t);if(r.push(e),"error"===e.type)break}return r})(e,this.socket.binaryType).forEach(e=>{if("opening"===this.readyState&&"open"===e.type&&this.onOpen(),"close"===e.type)return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(e)}),"closed"!==this.readyState&&(this._polling=!1,this.emitReserved("pollComplete"),"open"===this.readyState&&this._poll())}doClose(){const e=()=>{this.write([{type:"close"}])};"open"===this.readyState?e():this.once("open",e)}write(e){this.writable=!1,((e,t)=>{const n=e.length,r=new Array(n);let a=0;e.forEach((e,i)=>{Dre(e,!1,e=>{r[i]=e,++a===n&&t(r.join(Vre))})})})(e,e=>{this.doWrite(e,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const e=this.opts.secure?"https":"http",t=this.query||{};return!1!==this.opts.timestampRequests&&(t[this.opts.timestampParam]=nae()),this.supportsBinary||t.sid||(t.b64=1),this.createUri(e,t)}}let oae=!1;try{oae="undefined"!==typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(Cie){}const sae=oae;function cae(){}class lae extends iae{constructor(e){if(super(e),"undefined"!==typeof location){const t="https:"===location.protocol;let n=location.port;n||(n=t?"443":"80"),this.xd="undefined"!==typeof location&&e.hostname!==location.hostname||n!==e.port}}doWrite(e,t){const n=this.request({method:"POST",data:e});n.on("success",t),n.on("error",(e,t)=>{this.onError("xhr post error",e,t)})}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(e,t)=>{this.onError("xhr poll error",e,t)}),this.pollXhr=e}}class uae extends Xre{constructor(e,t,n){super(),this.createRequest=e,eae(this,n),this._opts=n,this._method=n.method||"GET",this._uri=t,this._data=void 0!==n.data?n.data:null,this._create()}_create(){var e;const t=Jre(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");t.xdomain=!!this._opts.xd;const n=this._xhr=this.createRequest(t);try{n.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){n.setDisableHeaderCheck&&n.setDisableHeaderCheck(!0);for(let e in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(e)&&n.setRequestHeader(e,this._opts.extraHeaders[e])}}catch(_a){}if("POST"===this._method)try{n.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(_a){}try{n.setRequestHeader("Accept","*/*")}catch(_a){}null===(e=this._opts.cookieJar)||void 0===e||e.addCookies(n),"withCredentials"in n&&(n.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(n.timeout=this._opts.requestTimeout),n.onreadystatechange=()=>{var e;3===n.readyState&&(null===(e=this._opts.cookieJar)||void 0===e||e.parseCookies(n.getResponseHeader("set-cookie"))),4===n.readyState&&(200===n.status||1223===n.status?this._onLoad():this.setTimeoutFn(()=>{this._onError("number"===typeof n.status?n.status:0)},0))},n.send(this._data)}catch(_a){return void this.setTimeoutFn(()=>{this._onError(_a)},0)}"undefined"!==typeof document&&(this._index=uae.requestsCount++,uae.requests[this._index]=this)}_onError(e){this.emitReserved("error",e,this._xhr),this._cleanup(!0)}_cleanup(e){if("undefined"!==typeof this._xhr&&null!==this._xhr){if(this._xhr.onreadystatechange=cae,e)try{this._xhr.abort()}catch(_a){}"undefined"!==typeof document&&delete uae.requests[this._index],this._xhr=null}}_onLoad(){const e=this._xhr.responseText;null!==e&&(this.emitReserved("data",e),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}}if(uae.requestsCount=0,uae.requests={},"undefined"!==typeof document)if("function"===typeof attachEvent)attachEvent("onunload",hae);else if("function"===typeof addEventListener){addEventListener("onpagehide"in $re?"pagehide":"unload",hae,!1)}function hae(){for(let e in uae.requests)uae.requests.hasOwnProperty(e)&&uae.requests[e].abort()}const dae=function(){const e=fae({xdomain:!1});return e&&null!==e.responseType}();function fae(e){const t=e.xdomain;try{if("undefined"!==typeof XMLHttpRequest&&(!t||sae))return new XMLHttpRequest}catch(_a){}if(!t)try{return new($re[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(_a){}}const pae="undefined"!==typeof navigator&&"string"===typeof navigator.product&&"reactnative"===navigator.product.toLowerCase();class mae extends aae{get name(){return"websocket"}doOpen(){const e=this.uri(),t=this.opts.protocols,n=pae?{}:Jre(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(n.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(e,t,n)}catch(Cie){return this.emitReserved("error",Cie)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const n=e[t],r=t===e.length-1;Dre(n,this.supportsBinary,e=>{try{this.doWrite(n,e)}catch(_a){}r&&Yre(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){"undefined"!==typeof this.ws&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){const e=this.opts.secure?"wss":"ws",t=this.query||{};return this.opts.timestampRequests&&(t[this.opts.timestampParam]=nae()),this.supportsBinary||(t.b64=1),this.createUri(e,t)}}const gae=$re.WebSocket||$re.MozWebSocket;const vae={websocket:class extends mae{createSocket(e,t,n){return pae?new gae(e,t,n):t?new gae(e,t):new gae(e)}doWrite(e,t){this.ws.send(t)}},webtransport:class extends aae{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(Cie){return this.emitReserved("error",Cie)}this._transport.closed.then(()=>{this.onClose()}).catch(e=>{this.onError("webtransport error",e)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(e=>{const t=function(e,t){Gre||(Gre=new TextDecoder);const n=[];let r=0,a=-1,i=!1;return new TransformStream({transform(o,s){for(n.push(o);;){if(0===r){if(qre(n)<1)break;const e=Kre(n,1);i=128===(128&e[0]),a=127&e[0],r=a<126?3:126===a?1:2}else if(1===r){if(qre(n)<2)break;const e=Kre(n,2);a=new DataView(e.buffer,e.byteOffset,e.length).getUint16(0),r=3}else if(2===r){if(qre(n)<8)break;const e=Kre(n,8),t=new DataView(e.buffer,e.byteOffset,e.length),i=t.getUint32(0);if(i>Math.pow(2,21)-1){s.enqueue(_re);break}a=i*Math.pow(2,32)+t.getUint32(4),r=3}else{if(qre(n)<a)break;const e=Kre(n,a);s.enqueue(zre(i?e:Gre.decode(e),t)),r=0}if(0===a||a>e){s.enqueue(_re);break}}}})}(Number.MAX_SAFE_INTEGER,this.socket.binaryType),n=e.readable.pipeThrough(t).getReader(),r=Hre();r.readable.pipeTo(e.writable),this._writer=r.writable.getWriter();const a=()=>{n.read().then(e=>{let{done:t,value:n}=e;t||(this.onPacket(n),a())}).catch(e=>{})};a();const i={type:"open"};this.query.sid&&(i.data='{"sid":"'.concat(this.query.sid,'"}')),this._writer.write(i).then(()=>this.onOpen())})})}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const n=e[t],r=t===e.length-1;this._writer.write(n).then(()=>{r&&Yre(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var e;null===(e=this._transport)||void 0===e||e.close()}},polling:class extends lae{constructor(e){super(e);const t=e&&e.forceBase64;this.supportsBinary=dae&&!t}request(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object.assign(e,{xd:this.xd},this.opts),new uae(fae,this.uri(),e)}}},bae=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,yae=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function xae(e){if(e.length>8e3)throw"URI too long";const t=e,n=e.indexOf("["),r=e.indexOf("]");-1!=n&&-1!=r&&(e=e.substring(0,n)+e.substring(n,r).replace(/:/g,";")+e.substring(r,e.length));let a=bae.exec(e||""),i={},o=14;for(;o--;)i[yae[o]]=a[o]||"";return-1!=n&&-1!=r&&(i.source=t,i.host=i.host.substring(1,i.host.length-1).replace(/;/g,":"),i.authority=i.authority.replace("[","").replace("]","").replace(/;/g,":"),i.ipv6uri=!0),i.pathNames=function(e,t){const n=/\/{2,9}/g,r=t.replace(n,"/").split("/");"/"!=t.slice(0,1)&&0!==t.length||r.splice(0,1);"/"==t.slice(-1)&&r.splice(r.length-1,1);return r}(0,i.path),i.queryKey=function(e,t){const n={};return t.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(e,t,r){t&&(n[t]=r)}),n}(0,i.query),i}const wae="function"===typeof addEventListener&&"function"===typeof removeEventListener,kae=[];wae&&addEventListener("offline",()=>{kae.forEach(e=>e())},!1);class Sae extends Xre{constructor(e,t){if(super(),this.binaryType="arraybuffer",this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,e&&"object"===typeof e&&(t=e,e=null),e){const n=xae(e);t.hostname=n.host,t.secure="https"===n.protocol||"wss"===n.protocol,t.port=n.port,n.query&&(t.query=n.query)}else t.host&&(t.hostname=xae(t.host).host);eae(this,t),this.secure=null!=t.secure?t.secure:"undefined"!==typeof location&&"https:"===location.protocol,t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||("undefined"!==typeof location?location.hostname:"localhost"),this.port=t.port||("undefined"!==typeof location&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},t.transports.forEach(e=>{const t=e.prototype.name;this.transports.push(t),this._transportsByName[t]=e}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},t),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),"string"===typeof this.opts.query&&(this.opts.query=function(e){let t={},n=e.split("&");for(let r=0,a=n.length;r<a;r++){let e=n[r].split("=");t[decodeURIComponent(e[0])]=decodeURIComponent(e[1])}return t}(this.opts.query)),wae&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),"localhost"!==this.hostname&&(this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},kae.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(e){const t=Object.assign({},this.opts.query);t.EIO=4,t.transport=e,this.id&&(t.sid=this.id);const n=Object.assign({},this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return new this._transportsByName[e](n)}_open(){if(0===this.transports.length)return void this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);const e=this.opts.rememberUpgrade&&Sae.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket")?"websocket":this.transports[0];this.readyState="opening";const t=this.createTransport(e);t.open(),this.setTransport(t)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",e=>this._onClose("transport close",e))}onOpen(){this.readyState="open",Sae.priorWebsocketSuccess="websocket"===this.transport.name,this.emitReserved("open"),this.flush()}_onPacket(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":const t=new Error("server error");t.code=e.data,this._onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data)}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this._pingInterval=e.pingInterval,this._pingTimeout=e.pingTimeout,this._maxPayload=e.maxPayload,this.onOpen(),"closed"!==this.readyState&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);const e=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+e,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},e),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,0===this.writeBuffer.length?this.emitReserved("drain"):this.flush()}flush(){if("closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this._getWritablePackets();this.transport.send(e),this._prevBufferLen=e.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&"polling"===this.transport.name&&this.writeBuffer.length>1))return this.writeBuffer;let e=1;for(let t=0;t<this.writeBuffer.length;t++){const n=this.writeBuffer[t].data;if(n&&(e+=tae(n)),t>0&&e>this._maxPayload)return this.writeBuffer.slice(0,t);e+=2}return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;const e=Date.now()>this._pingTimeoutTime;return e&&(this._pingTimeoutTime=0,Yre(()=>{this._onClose("ping timeout")},this.setTimeoutFn)),e}write(e,t,n){return this._sendPacket("message",e,t,n),this}send(e,t,n){return this._sendPacket("message",e,t,n),this}_sendPacket(e,t,n,r){if("function"===typeof t&&(r=t,t=void 0),"function"===typeof n&&(r=n,n=null),"closing"===this.readyState||"closed"===this.readyState)return;(n=n||{}).compress=!1!==n.compress;const a={type:e,data:t,options:n};this.emitReserved("packetCreate",a),this.writeBuffer.push(a),r&&this.once("flush",r),this.flush()}close(){const e=()=>{this._onClose("forced close"),this.transport.close()},t=()=>{this.off("upgrade",t),this.off("upgradeError",t),e()},n=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return"opening"!==this.readyState&&"open"!==this.readyState||(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?n():e()}):this.upgrading?n():e()),this}_onError(e){if(Sae.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&"opening"===this.readyState)return this.transports.shift(),this._open();this.emitReserved("error",e),this._onClose("transport error",e)}_onClose(e,t){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),wae&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){const e=kae.indexOf(this._offlineEventListener);-1!==e&&kae.splice(e,1)}this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this._prevBufferLen=0}}}Sae.protocol=4;class Nae extends Sae{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),"open"===this.readyState&&this.opts.upgrade)for(let e=0;e<this._upgrades.length;e++)this._probe(this._upgrades[e])}_probe(e){let t=this.createTransport(e),n=!1;Sae.priorWebsocketSuccess=!1;const r=()=>{n||(t.send([{type:"ping",data:"probe"}]),t.once("packet",e=>{if(!n)if("pong"===e.type&&"probe"===e.data){if(this.upgrading=!0,this.emitReserved("upgrading",t),!t)return;Sae.priorWebsocketSuccess="websocket"===t.name,this.transport.pause(()=>{n||"closed"!==this.readyState&&(l(),this.setTransport(t),t.send([{type:"upgrade"}]),this.emitReserved("upgrade",t),t=null,this.upgrading=!1,this.flush())})}else{const e=new Error("probe error");e.transport=t.name,this.emitReserved("upgradeError",e)}}))};function a(){n||(n=!0,l(),t.close(),t=null)}const i=e=>{const n=new Error("probe error: "+e);n.transport=t.name,a(),this.emitReserved("upgradeError",n)};function o(){i("transport closed")}function s(){i("socket closed")}function c(e){t&&e.name!==t.name&&a()}const l=()=>{t.removeListener("open",r),t.removeListener("error",i),t.removeListener("close",o),this.off("close",s),this.off("upgrading",c)};t.once("open",r),t.once("error",i),t.once("close",o),this.once("close",s),this.once("upgrading",c),-1!==this._upgrades.indexOf("webtransport")&&"webtransport"!==e?this.setTimeoutFn(()=>{n||t.open()},200):t.open()}onHandshake(e){this._upgrades=this._filterUpgrades(e.upgrades),super.onHandshake(e)}_filterUpgrades(e){const t=[];for(let n=0;n<e.length;n++)~this.transports.indexOf(e[n])&&t.push(e[n]);return t}}class Cae extends Nae{constructor(e){const t="object"===typeof e?e:arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(!t.transports||t.transports&&"string"===typeof t.transports[0])&&(t.transports=(t.transports||["polling","websocket","webtransport"]).map(e=>vae[e]).filter(e=>!!e)),super(e,t)}}const Eae="function"===typeof ArrayBuffer,Iae=Object.prototype.toString,Tae="function"===typeof Blob||"undefined"!==typeof Blob&&"[object BlobConstructor]"===Iae.call(Blob),_ae="function"===typeof File||"undefined"!==typeof File&&"[object FileConstructor]"===Iae.call(File);function Aae(e){return Eae&&(e instanceof ArrayBuffer||(e=>"function"===typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer)(e))||Tae&&e instanceof Blob||_ae&&e instanceof File}function Rae(e,t){if(!e||"object"!==typeof e)return!1;if(Array.isArray(e)){for(let t=0,n=e.length;t<n;t++)if(Rae(e[t]))return!0;return!1}if(Aae(e))return!0;if(e.toJSON&&"function"===typeof e.toJSON&&1===arguments.length)return Rae(e.toJSON(),!0);for(const n in e)if(Object.prototype.hasOwnProperty.call(e,n)&&Rae(e[n]))return!0;return!1}function Fae(e){const t=[],n=e.data,r=e;return r.data=Dae(n,t),r.attachments=t.length,{packet:r,buffers:t}}function Dae(e,t){if(!e)return e;if(Aae(e)){const n={_placeholder:!0,num:t.length};return t.push(e),n}if(Array.isArray(e)){const n=new Array(e.length);for(let r=0;r<e.length;r++)n[r]=Dae(e[r],t);return n}if("object"===typeof e&&!(e instanceof Date)){const n={};for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=Dae(e[r],t));return n}return e}function Oae(e,t){return e.data=Lae(e.data,t),delete e.attachments,e}function Lae(e,t){if(!e)return e;if(e&&!0===e._placeholder){if("number"===typeof e.num&&e.num>=0&&e.num<t.length)return t[e.num];throw new Error("illegal attachments")}if(Array.isArray(e))for(let n=0;n<e.length;n++)e[n]=Lae(e[n],t);else if("object"===typeof e)for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&(e[n]=Lae(e[n],t));return e}const Pae=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],Mae=5;var jae;!function(e){e[e.CONNECT=0]="CONNECT",e[e.DISCONNECT=1]="DISCONNECT",e[e.EVENT=2]="EVENT",e[e.ACK=3]="ACK",e[e.CONNECT_ERROR=4]="CONNECT_ERROR",e[e.BINARY_EVENT=5]="BINARY_EVENT",e[e.BINARY_ACK=6]="BINARY_ACK"}(jae||(jae={}));class Bae{constructor(e){this.replacer=e}encode(e){return e.type!==jae.EVENT&&e.type!==jae.ACK||!Rae(e)?[this.encodeAsString(e)]:this.encodeAsBinary({type:e.type===jae.EVENT?jae.BINARY_EVENT:jae.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id})}encodeAsString(e){let t=""+e.type;return e.type!==jae.BINARY_EVENT&&e.type!==jae.BINARY_ACK||(t+=e.attachments+"-"),e.nsp&&"/"!==e.nsp&&(t+=e.nsp+","),null!=e.id&&(t+=e.id),null!=e.data&&(t+=JSON.stringify(e.data,this.replacer)),t}encodeAsBinary(e){const t=Fae(e),n=this.encodeAsString(t.packet),r=t.buffers;return r.unshift(n),r}}function zae(e){return"[object Object]"===Object.prototype.toString.call(e)}class Uae extends Xre{constructor(e){super(),this.reviver=e}add(e){let t;if("string"===typeof e){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");t=this.decodeString(e);const n=t.type===jae.BINARY_EVENT;n||t.type===jae.BINARY_ACK?(t.type=n?jae.EVENT:jae.ACK,this.reconstructor=new Wae(t),0===t.attachments&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t)}else{if(!Aae(e)&&!e.base64)throw new Error("Unknown type: "+e);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,super.emitReserved("decoded",t))}}decodeString(e){let t=0;const n={type:Number(e.charAt(0))};if(void 0===jae[n.type])throw new Error("unknown packet type "+n.type);if(n.type===jae.BINARY_EVENT||n.type===jae.BINARY_ACK){const r=t+1;for(;"-"!==e.charAt(++t)&&t!=e.length;);const a=e.substring(r,t);if(a!=Number(a)||"-"!==e.charAt(t))throw new Error("Illegal attachments");n.attachments=Number(a)}if("/"===e.charAt(t+1)){const r=t+1;for(;++t;){if(","===e.charAt(t))break;if(t===e.length)break}n.nsp=e.substring(r,t)}else n.nsp="/";const r=e.charAt(t+1);if(""!==r&&Number(r)==r){const r=t+1;for(;++t;){const n=e.charAt(t);if(null==n||Number(n)!=n){--t;break}if(t===e.length)break}n.id=Number(e.substring(r,t+1))}if(e.charAt(++t)){const r=this.tryParse(e.substr(t));if(!Uae.isPayloadValid(n.type,r))throw new Error("invalid payload");n.data=r}return n}tryParse(e){try{return JSON.parse(e,this.reviver)}catch(_a){return!1}}static isPayloadValid(e,t){switch(e){case jae.CONNECT:return zae(t);case jae.DISCONNECT:return void 0===t;case jae.CONNECT_ERROR:return"string"===typeof t||zae(t);case jae.EVENT:case jae.BINARY_EVENT:return Array.isArray(t)&&("number"===typeof t[0]||"string"===typeof t[0]&&-1===Pae.indexOf(t[0]));case jae.ACK:case jae.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class Wae{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const e=Oae(this.reconPack,this.buffers);return this.finishedReconstruction(),e}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}function Vae(e,t,n){return e.on(t,n),function(){e.off(t,n)}}const Hae=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class Gae extends Xre{constructor(e,t,n){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,n&&n.auth&&(this.auth=n.auth),this._opts=Object.assign({},n),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[Vae(e,"open",this.onopen.bind(this)),Vae(e,"packet",this.onpacket.bind(this)),Vae(e,"error",this.onerror.bind(this)),Vae(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected||(this.subEvents(),this.io._reconnecting||this.io.open(),"open"===this.io._readyState&&this.onopen()),this}open(){return this.connect()}send(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.unshift("message"),this.emit.apply(this,t),this}emit(e){var t,n,r;if(Hae.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');for(var a=arguments.length,i=new Array(a>1?a-1:0),o=1;o<a;o++)i[o-1]=arguments[o];if(i.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(i),this;const s={type:jae.EVENT,data:i,options:{}};if(s.options.compress=!1!==this.flags.compress,"function"===typeof i[i.length-1]){const e=this.ids++,t=i.pop();this._registerAckCallback(e,t),s.id=e}const c=null===(n=null===(t=this.io.engine)||void 0===t?void 0:t.transport)||void 0===n?void 0:n.writable,l=this.connected&&!(null===(r=this.io.engine)||void 0===r?void 0:r._hasPingExpired());return this.flags.volatile&&!c||(l?(this.notifyOutgoingListeners(s),this.packet(s)):this.sendBuffer.push(s)),this.flags={},this}_registerAckCallback(e,t){var n,r=this;const a=null!==(n=this.flags.timeout)&&void 0!==n?n:this._opts.ackTimeout;if(void 0===a)return void(this.acks[e]=t);const i=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let t=0;t<this.sendBuffer.length;t++)this.sendBuffer[t].id===e&&this.sendBuffer.splice(t,1);t.call(this,new Error("operation has timed out"))},a),o=function(){r.io.clearTimeoutFn(i);for(var e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];t.apply(r,n)};o.withError=!0,this.acks[e]=o}emitWithAck(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return new Promise((t,r)=>{const a=(e,n)=>e?r(e):t(n);a.withError=!0,n.push(a),this.emit(e,...n)})}_addToQueue(e){var t=this;let n;"function"===typeof e[e.length-1]&&(n=e.pop());const r={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push(function(e){if(r!==t._queue[0])return;if(null!==e)r.tryCount>t._opts.retries&&(t._queue.shift(),n&&n(e));else if(t._queue.shift(),n){for(var a=arguments.length,i=new Array(a>1?a-1:0),o=1;o<a;o++)i[o-1]=arguments[o];n(null,...i)}return r.pending=!1,t._drainQueue()}),this._queue.push(r),this._drainQueue()}_drainQueue(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.connected||0===this._queue.length)return;const t=this._queue[0];t.pending&&!e||(t.pending=!0,t.tryCount++,this.flags=t.flags,this.emit.apply(this,t.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){"function"==typeof this.auth?this.auth(e=>{this._sendConnectPacket(e)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:jae.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(e=>{if(!this.sendBuffer.some(t=>String(t.id)===e)){const t=this.acks[e];delete this.acks[e],t.withError&&t.call(this,new Error("socket has been disconnected"))}})}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case jae.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case jae.EVENT:case jae.BINARY_EVENT:this.onevent(e);break;case jae.ACK:case jae.BINARY_ACK:this.onack(e);break;case jae.DISCONNECT:this.ondisconnect();break;case jae.CONNECT_ERROR:this.destroy();const t=new Error(e.data.message);t.data=e.data.data,this.emitReserved("connect_error",t)}}onevent(e){const t=e.data||[];null!=e.id&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const t=this._anyListeners.slice();for(const n of t)n.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&"string"===typeof e[e.length-1]&&(this._lastOffset=e[e.length-1])}ack(e){const t=this;let n=!1;return function(){if(!n){n=!0;for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];t.packet({type:jae.ACK,id:e,data:a})}}}onack(e){const t=this.acks[e.id];"function"===typeof t&&(delete this.acks[e.id],t.withError&&e.data.unshift(null),t.apply(this,e.data))}onconnect(e,t){this.id=e,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:jae.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const t=this._anyListeners;for(let n=0;n<t.length;n++)if(e===t[n])return t.splice(n,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const t=this._anyOutgoingListeners;for(let n=0;n<t.length;n++)if(e===t[n])return t.splice(n,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const t=this._anyOutgoingListeners.slice();for(const n of t)n.apply(this,e.data)}}}function qae(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}qae.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),n=Math.floor(t*this.jitter*e);e=0==(1&Math.floor(10*t))?e-n:e+n}return 0|Math.min(e,this.max)},qae.prototype.reset=function(){this.attempts=0},qae.prototype.setMin=function(e){this.ms=e},qae.prototype.setMax=function(e){this.max=e},qae.prototype.setJitter=function(e){this.jitter=e};class Kae extends Xre{constructor(e,t){var n;super(),this.nsps={},this.subs=[],e&&"object"===typeof e&&(t=e,e=void 0),(t=t||{}).path=t.path||"/socket.io",this.opts=t,eae(this,t),this.reconnection(!1!==t.reconnection),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor(null!==(n=t.randomizationFactor)&&void 0!==n?n:.5),this.backoff=new qae({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==t.timeout?2e4:t.timeout),this._readyState="closed",this.uri=e;const r=t.parser||o;this.encoder=new r.Encoder,this.decoder=new r.Decoder,this._autoConnect=!1!==t.autoConnect,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,e||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(e){return void 0===e?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return void 0===e?this._reconnectionDelay:(this._reconnectionDelay=e,null===(t=this.backoff)||void 0===t||t.setMin(e),this)}randomizationFactor(e){var t;return void 0===e?this._randomizationFactor:(this._randomizationFactor=e,null===(t=this.backoff)||void 0===t||t.setJitter(e),this)}reconnectionDelayMax(e){var t;return void 0===e?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,null===(t=this.backoff)||void 0===t||t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new Cae(this.uri,this.opts);const t=this.engine,n=this;this._readyState="opening",this.skipReconnect=!1;const r=Vae(t,"open",function(){n.onopen(),e&&e()}),a=t=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",t),e?e(t):this.maybeReconnectOnOpen()},i=Vae(t,"error",a);if(!1!==this._timeout){const e=this._timeout,n=this.setTimeoutFn(()=>{r(),a(new Error("timeout")),t.close()},e);this.opts.autoUnref&&n.unref(),this.subs.push(()=>{this.clearTimeoutFn(n)})}return this.subs.push(r),this.subs.push(i),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(Vae(e,"ping",this.onping.bind(this)),Vae(e,"data",this.ondata.bind(this)),Vae(e,"error",this.onerror.bind(this)),Vae(e,"close",this.onclose.bind(this)),Vae(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(_a){this.onclose("parse error",_a)}}ondecoded(e){Yre(()=>{this.emitReserved("packet",e)},this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,t){let n=this.nsps[e];return n?this._autoConnect&&!n.active&&n.connect():(n=new Gae(this,e,t),this.nsps[e]=n),n}_destroy(e){const t=Object.keys(this.nsps);for(const n of t){if(this.nsps[n].active)return}this._close()}_packet(e){const t=this.encoder.encode(e);for(let n=0;n<t.length;n++)this.engine.write(t[n],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(e,t){var n;this.cleanup(),null===(n=this.engine)||void 0===n||n.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const t=this.backoff.duration();this._reconnecting=!0;const n=this.setTimeoutFn(()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),e.skipReconnect||e.open(t=>{t?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",t)):e.onreconnect()}))},t);this.opts.autoUnref&&n.unref(),this.subs.push(()=>{this.clearTimeoutFn(n)})}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const Xae={};function Yae(e,t){"object"===typeof e&&(t=e,e=void 0);const n=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0,r=e;n=n||"undefined"!==typeof location&&location,null==e&&(e=n.protocol+"//"+n.host),"string"===typeof e&&("/"===e.charAt(0)&&(e="/"===e.charAt(1)?n.protocol+e:n.host+e),/^(https?|wss?):\/\//.test(e)||(e="undefined"!==typeof n?n.protocol+"//"+e:"https://"+e),r=xae(e)),r.port||(/^(http|ws)$/.test(r.protocol)?r.port="80":/^(http|ws)s$/.test(r.protocol)&&(r.port="443")),r.path=r.path||"/";const a=-1!==r.host.indexOf(":")?"["+r.host+"]":r.host;return r.id=r.protocol+"://"+a+":"+r.port+t,r.href=r.protocol+"://"+a+(n&&n.port===r.port?"":":"+r.port),r}(e,(t=t||{}).path||"/socket.io"),r=n.source,a=n.id,i=n.path,o=Xae[a]&&i in Xae[a].nsps;let s;return t.forceNew||t["force new connection"]||!1===t.multiplex||o?s=new Kae(r,t):(Xae[a]||(Xae[a]=new Kae(r,t)),s=Xae[a]),n.query&&!t.query&&(t.query=n.queryKey),s.socket(n.path,t)}Object.assign(Yae,{Manager:Kae,Socket:Gae,io:Yae,connect:Yae});let $ae=null,Jae=null;const Qae=e=>($ae&&$ae.disconnect(),Jae=e,$ae=Yae("http://localhost:5000"),$ae.emit("register_user",{userId:e._id,role:e.role,name:e.name||("admin"===e.role?"Admin":"Fighter")}),console.log("[SOCKET] Initialized socket connection for user:",e._id),$ae),Zae=e=>{$ae&&($ae.off("new_message",e),$ae.on("new_message",e))},eie=e=>{$ae&&($ae.off("new_notification",e),$ae.on("new_notification",e))},tie=()=>{$ae&&($ae.disconnect(),$ae=null,Jae=null,console.log("[SOCKET] Disconnected socket"))};let nie=null;const rie=()=>{try{if(nie||(nie=new(window.AudioContext||window.webkitAudioContext)),!nie)return void console.warn("AudioContext not available");const e=nie.createOscillator(),t=nie.createGain();e.connect(t),t.connect(nie.destination),e.type="sine",e.frequency.value=800,t.gain.value=.3,e.start(),setTimeout(()=>{e.stop()},200)}catch(e){console.warn("Could not play notification sound:",e)}},aie=e=>{let{message:t="Loading..."}=e;return(0,xa.jsxs)("div",{className:"flex items-center justify-center p-8",children:[(0,xa.jsx)(Ft,{className:"animate-spin text-2xl text-blue-500 mr-3"}),(0,xa.jsx)("span",{className:"text-gray-600 mobile-text-base",children:t})]})},iie=e=>{let{icon:t,title:n,description:r,action:a}=e;return(0,xa.jsxs)("div",{className:"flex flex-col items-center justify-center h-full p-8 text-center bg-white",children:[(0,xa.jsx)(t,{className:"text-6xl text-gray-300 mb-4"}),(0,xa.jsx)("h3",{className:"text-xl font-semibold text-gray-600 mb-2 mobile-text-lg",children:n}),(0,xa.jsx)("p",{className:"text-gray-500 mb-4 mobile-text-base",children:r}),a]})},oie=e=>{var t;let{currentUser:n,fighters:r,activeChat:a,setActiveChat:i,adminId:o,unreadCounts:s={},isMobile:l,isSidebarOpen:u,setIsSidebarOpen:h,messages:d}=e;const[f,p]=(0,c.useState)(""),m="admin"===(null===n||void 0===n?void 0:n.role),g=(0,c.useCallback)(()=>{if(!m||!r||!d)return r||[];const e={};return d.forEach(t=>{let n=null;if(t.recipient&&t.recipient._id&&"Fighter"===t.recipientModel?n=t.recipient._id:t.user&&t.user._id&&"Fighter"===t.userModel&&(n=t.user._id),n){const r=new Date(t.timestamp).getTime();(!e[n]||r>e[n])&&(e[n]=r)}}),[...r].sort((t,n)=>{const r=e[t._id]||0;return(e[n._id]||0)-r})},[r,d,m]),v=(0,c.useMemo)(()=>g(),[g]),b=(0,c.useMemo)(()=>v.filter(e=>{var t;return null===e||void 0===e||null===(t=e.name)||void 0===t?void 0:t.toLowerCase().includes(f.toLowerCase())}),[v,f]),y=c.memo(e=>{let{chat:t,isActive:n,onClick:r,icon:a,title:i,subtitle:o,chatId:c}=e;const l=s[c]||0,u=l>0;return(0,xa.jsxs)("div",{onClick:r,className:"flex items-center p-4 cursor-pointer transition-all duration-200 border-b border-gray-200 hover:bg-gray-100 relative ".concat(n?"bg-blue-50 border-l-4 border-l-blue-400":""," ").concat(u&&!n?"bg-blue-50":""),children:[u&&!n&&(0,xa.jsx)("div",{className:"absolute left-2 top-2 w-3 h-3 bg-green-500 rounded-full animate-pulse border-2 border-white"}),(0,xa.jsxs)("div",{className:"relative mr-4",children:[(0,xa.jsx)(a,{className:"text-xl ".concat(n?"text-blue-600":u?"text-green-600":"text-gray-600")}),u&&(0,xa.jsx)("span",{className:"absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center animate-pulse font-bold",children:l>9?"9+":l})]}),(0,xa.jsxs)("div",{className:"flex-grow",children:[(0,xa.jsxs)("h4",{className:"font-medium ".concat(n?"text-blue-700":u?"text-gray-800":"text-gray-700"," mobile-text-lg"),children:[i,u&&(0,xa.jsx)("span",{className:"ml-2 text-green-600 text-sm",children:"\u2022 New"})]}),(0,xa.jsxs)("p",{className:"text-sm ".concat(n?"text-blue-600":u?"text-gray-600":"text-gray-500"," mobile-text-base"),children:[o,u&&(0,xa.jsxs)("span",{className:"ml-2 text-green-600 font-medium",children:["(",l," new)"]})]})]}),n&&(0,xa.jsx)(dt,{className:"text-green-500"})]})},(e,t)=>{const n=e.unreadCounts[e.chatId]||0,r=t.unreadCounts[t.chatId]||0;return e.isActive===t.isActive&&e.title===t.title&&e.subtitle===t.subtitle&&e.chatId===t.chatId&&n===r});return l&&!u?null:(0,xa.jsxs)("div",{className:"bg-white text-gray-800 border-r border-gray-200 flex flex-col ".concat(l?"fixed inset-y-0 left-0 z-50 w-4/5 max-w-sm transform transition-transform duration-300 ease-in-out":"w-80"," ").concat(l&&!u?"-translate-x-full":"translate-x-0"),children:[l&&(0,xa.jsxs)("div",{className:"p-4 border-b border-gray-200 bg-gray-50 flex items-center justify-between",children:[(0,xa.jsx)("h2",{className:"text-xl font-bold",children:m?"\ud83d\udcac Doubt Management":"\ud83e\udd14 Ask Doubts"}),(0,xa.jsx)("button",{onClick:()=>h(!1),className:"p-2 rounded-lg hover:bg-gray-200",children:(0,xa.jsx)(Lt,{})})]}),!l&&(0,xa.jsxs)("div",{className:"p-4 border-b border-gray-200 bg-gray-50",children:[(0,xa.jsx)("h2",{className:"text-xl font-bold text-center",children:m?"\ud83d\udcac Doubt Management":"\ud83e\udd14 Ask Doubts"}),(0,xa.jsx)("p",{className:"text-sm text-gray-600 text-center mt-1",children:m?"Admin Panel":"Get Help & Clarity"})]}),m&&(0,xa.jsx)("div",{className:"p-3 border-b border-gray-200",children:(0,xa.jsxs)("div",{className:"relative",children:[(0,xa.jsx)(_t,{className:"absolute left-3 top-3 text-gray-400 text-sm"}),(0,xa.jsx)("input",{type:"text",placeholder:"Search fighters...",value:f,onChange:e=>p(e.target.value),className:"w-full pl-10 pr-4 py-2 bg-gray-50 text-gray-800 rounded-lg border border-gray-300 focus:outline-none focus:border-blue-500 text-sm"}),f&&(0,xa.jsx)("button",{onClick:()=>p(""),className:"absolute right-3 top-3 text-gray-400 hover:text-gray-600",children:(0,xa.jsx)(Lt,{className:"text-sm"})})]})}),(0,xa.jsxs)("div",{className:"flex-grow overflow-y-auto",children:[(0,xa.jsx)(y,{chat:{type:"common"},isActive:"common"===(null===a||void 0===a?void 0:a.type),onClick:()=>{i({type:"common",peer:{_id:null,name:"Common Group"}}),l&&h(!1)},icon:Ht,title:"Common Group",subtitle:"Group discussion for all members"}),m?b.map(e=>{var t;return(0,xa.jsx)(y,{chat:{type:"private",peer:e},isActive:"private"===(null===a||void 0===a?void 0:a.type)&&(null===a||void 0===a||null===(t=a.peer)||void 0===t?void 0:t._id)===e._id,onClick:()=>{console.log("[CLIENT] Admin selecting chat with fighter:",{fighterName:e.name,fighterId:e._id,adminId:n._id}),i({type:"private",peer:e}),l&&h(!1)},icon:Bt,title:e.name,subtitle:"Doubt-Clarity chat",chatId:e._id},e._id)}):(0,xa.jsx)(y,{chat:{type:"private",peer:{_id:o,name:"Admin"}},isActive:"private"===(null===a||void 0===a?void 0:a.type)&&(null===a||void 0===a||null===(t=a.peer)||void 0===t?void 0:t._id)===o,onClick:()=>{console.log("[CLIENT] Fighter selecting chat with admin:",{adminId:o,fighterId:null===n||void 0===n?void 0:n._id}),i({type:"private",peer:{_id:o,name:"Admin"}}),l&&h(!1)},icon:Ut,title:"Private with Admin",subtitle:"Doubt-Clarity format",chatId:o}),m&&0===b.length&&f&&(0,xa.jsx)("div",{className:"p-4 text-center text-gray-500",children:(0,xa.jsxs)("p",{className:"mobile-text-base",children:['No fighters found matching "',f,'"']})})]})]})},sie=e=>{var t,n,r;let{message:a,currentUser:i,onReply:o,onDelete:s,isAdmin:l,replyingTo:u}=e;const[h,d]=(0,c.useState)(!1),f=(null===a||void 0===a||null===(t=a.user)||void 0===t?void 0:t._id)===(null===i||void 0===i?void 0:i._id),p="Admin"===(null===a||void 0===a?void 0:a.userModel),m=!(null===a||void 0===a||!a.parentDoubt)&&u?u.find(e=>e._id===a.parentDoubt):null;return(0,xa.jsx)("div",{className:"flex ".concat(f?"justify-end":"justify-start"," mb-4 group"),onMouseEnter:()=>d(!0),onMouseLeave:()=>d(!1),children:(0,xa.jsxs)("div",{className:"flex items-end gap-3 max-w-lg ".concat(f?"flex-row-reverse":""," relative"),children:[(0,xa.jsx)("div",{className:"flex-shrink-0",children:(0,xa.jsx)("div",{className:"w-10 h-10 rounded-full flex items-center justify-center shadow-md ".concat(p?"bg-blue-500":"bg-green-500"),children:p?(0,xa.jsx)(Ut,{className:"text-white text-sm"}):(0,xa.jsx)(Bt,{className:"text-white text-sm"})})}),(0,xa.jsxs)("div",{className:"px-4 py-3 rounded-2xl shadow-sm max-w-full transition-all duration-200 ".concat(f?"bg-blue-500 text-white rounded-br-sm":"bg-gray-100 text-gray-800 border border-gray-200 rounded-bl-sm"),children:[m&&(0,xa.jsxs)("div",{className:"mb-2 p-2 bg-blue-100 rounded-lg border-l-2 border-blue-500",children:[(0,xa.jsx)("p",{className:"text-xs font-bold text-blue-800 truncate",children:(null===(n=m.user)||void 0===n?void 0:n.name)||"Unknown User"}),(0,xa.jsx)("p",{className:"text-xs text-blue-700 truncate",children:m.text.length>50?m.text.substring(0,50)+"...":m.text})]}),(0,xa.jsx)("p",{className:"text-xs font-bold mb-2 ".concat(f?"text-blue-100":"text-blue-600"," mobile-text-sm"),children:f?"You":(null===a||void 0===a||null===(r=a.user)||void 0===r?void 0:r.name)||"Unknown User"}),(0,xa.jsx)("p",{className:"text-sm leading-relaxed whitespace-pre-wrap break-words mobile-text-base",children:(null===a||void 0===a?void 0:a.text)||""}),(0,xa.jsx)("div",{className:"flex items-center justify-between mt-2",children:(0,xa.jsx)("p",{className:"text-xs ".concat(f?"text-blue-100":"text-gray-500"," mobile-text-sm"),children:null!==a&&void 0!==a&&a.timestamp?new Date(a.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):""})})]}),h&&(0,xa.jsxs)("div",{className:"absolute bottom-0 ".concat(f?"left-0":"right-0"," transform ").concat(f?"-translate-x-full":"translate-x-full"," flex space-x-1 bg-gray-800 rounded-lg p-2 shadow-lg z-20"),children:[(0,xa.jsx)("button",{onClick:()=>null===o||void 0===o?void 0:o(a),className:"p-2 text-white hover:bg-gray-700 rounded text-xs transition-colors",title:"Reply",children:(0,xa.jsx)(Tt,{})}),l&&(0,xa.jsx)("button",{onClick:()=>null===s||void 0===s?void 0:s(null===a||void 0===a?void 0:a._id),className:"p-2 text-red-400 hover:bg-red-600 hover:text-white rounded text-xs transition-colors",title:"Delete",children:(0,xa.jsx)(Pt,{})})]})]})})},cie=e=>{let{messages:t,currentUser:n,onDelete:r}=e;const a="admin"===(null===n||void 0===n?void 0:n.role),i=(0,c.useRef)(null),o=(0,c.useRef)(null),s=(0,c.useRef)(!0),l=(0,c.useRef)(!1),u=(0,c.useCallback)(()=>{if(!o.current)return!0;const{scrollTop:e,scrollHeight:t,clientHeight:n}=o.current;return Math.abs(t-n-e)<10},[]),h=(0,c.useCallback)(()=>{s.current=u(),s.current?l.current=!1:l.current=!0},[u]);(0,c.useEffect)(()=>{const e=o.current;if(e)return e.addEventListener("scroll",h),!s.current&&l.current||requestAnimationFrame(()=>{i.current&&i.current.scrollIntoView({behavior:"smooth",block:"nearest"})}),()=>{e&&e.removeEventListener("scroll",h)}},[t,h]);const d=t.filter(e=>"doubt"===(null===e||void 0===e?void 0:e.messageType)&&"Fighter"===(null===e||void 0===e?void 0:e.userModel)).sort((e,t)=>new Date(e.timestamp)-new Date(t.timestamp)),f=t.filter(e=>"clarity"===(null===e||void 0===e?void 0:e.messageType)&&"Admin"===(null===e||void 0===e?void 0:e.userModel)).sort((e,t)=>new Date(e.timestamp)-new Date(t.timestamp)),p=Math.max(d.length,f.length,5),m=e=>{var t,i;let{message:o,type:s}=e;if(!o)return(0,xa.jsx)("div",{className:"p-4 border-b border-gray-200 min-h-[80px] bg-white flex items-center justify-center",children:(0,xa.jsx)("span",{className:"text-gray-300",children:"-"})});null===o||void 0===o||o.userModel,null===o||void 0===o||o.userModel;const c=(null===o||void 0===o||null===(t=o.user)||void 0===t?void 0:t._id)===(null===n||void 0===n?void 0:n._id);let l="flex-start";return l=a?c?"flex-end":"flex-start":c?"flex-start":"flex-end",(0,xa.jsxs)("div",{className:"p-4 border-b border-gray-200 min-h-[80px] hover:bg-gray-50 transition-colors",children:[(0,xa.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,xa.jsx)("div",{className:"flex items-center gap-2",children:(0,xa.jsx)("span",{className:"font-medium text-sm text-gray-700 mobile-text-sm",children:(null===o||void 0===o||null===(i=o.user)||void 0===i?void 0:i.name)||"Unknown"})}),(0,xa.jsx)("div",{className:"flex items-center gap-2",children:a&&(0,xa.jsx)("button",{onClick:()=>null===r||void 0===r?void 0:r(null===o||void 0===o?void 0:o._id),className:"p-1 text-red-400 hover:text-red-600 text-xs opacity-0 group-hover:opacity-100 transition-opacity",title:"Delete",children:(0,xa.jsx)(Pt,{})})})]}),(0,xa.jsx)("div",{className:"flex ".concat(l),children:(0,xa.jsxs)("div",{className:"max-w-[80%] p-3 rounded-xl shadow-sm my-2 ".concat(c?"bg-blue-600 text-white":"bg-gray-200 text-gray-900"),children:[(null===o||void 0===o?void 0:o.text)||"",(0,xa.jsx)("span",{className:"block text-xs mt-1 ".concat(c?"text-right text-gray-300":"text-left text-gray-500"),children:null!==o&&void 0!==o&&o.timestamp?new Date(o.timestamp).toLocaleTimeString([],{hour:"numeric",minute:"2-digit",hour12:!0}):""})]})})]})};return(0,xa.jsxs)("div",{className:"flex-grow overflow-hidden bg-gray-50 flex flex-col h-full",children:[(0,xa.jsxs)("div",{className:"grid grid-cols-12 bg-indigo-900 text-white sticky top-0 z-10",children:[(0,xa.jsx)("div",{className:"col-span-1 p-4 border-r border-indigo-700 text-center font-bold",children:"#"}),(0,xa.jsx)("div",{className:"col-span-5 p-4 border-r border-indigo-700 font-bold flex items-center",children:(0,xa.jsx)("span",{children:"Fighter's Doubts (Questions)"})}),(0,xa.jsx)("div",{className:"col-span-6 p-4 font-bold flex items-center",children:(0,xa.jsx)("span",{children:"Admin's Clarity (Answers)"})})]}),(0,xa.jsxs)("div",{className:"flex-grow overflow-y-auto bg-gray-50 chat-container",ref:o,style:{height:"calc(100vh - 250px)"},children:[0===p?(0,xa.jsx)("div",{className:"flex items-center justify-center h-full p-8",children:(0,xa.jsxs)("div",{className:"text-center",children:[(0,xa.jsx)("div",{className:"flex justify-center mb-4",children:(0,xa.jsx)("div",{className:"flex items-center justify-center w-16 h-16 rounded-full bg-gray-100 text-gray-400",children:(0,xa.jsx)(Ht,{className:"text-2xl"})})}),(0,xa.jsx)("h3",{className:"text-xl font-semibold text-gray-700 mb-2",children:"No conversations yet"}),(0,xa.jsx)("p",{className:"text-gray-500",children:"Start a conversation by sending a doubt or clarity"})]})}):Array.from({length:p},(e,t)=>{const n=d[t],r=f[t];return(0,xa.jsxs)("div",{className:"grid grid-cols-12 border-b border-gray-200 hover:bg-gray-50 group",children:[(0,xa.jsx)("div",{className:"col-span-1 p-4 border-r border-gray-200 text-center text-sm font-medium text-gray-600 bg-gray-50 flex items-center justify-center",children:t+1}),(0,xa.jsx)("div",{className:"col-span-5 border-r border-gray-200",children:(0,xa.jsx)(m,{message:n,type:"doubt"})}),(0,xa.jsx)("div",{className:"col-span-6",children:(0,xa.jsx)(m,{message:r,type:"clarity"})})]},t)}),(0,xa.jsx)("div",{ref:i})]})]})},lie=e=>{var t,n;let{currentUser:r,activeChat:a,messages:i,newMessage:o,setNewMessage:s,onSendMessage:l,onDelete:u,loading:h,getNextMessageType:d,notificationsEnabled:f,setNotificationsEnabled:p,replyingTo:m,setReplyingTo:g,isMobile:v,isSidebarOpen:b,setIsSidebarOpen:y}=e;const[x,w]=(0,c.useState)(!1),k=(0,c.useRef)(null),S=(0,c.useRef)(null),N="admin"===(null===r||void 0===r?void 0:r.role),C=(0,c.useRef)(!1),E=(0,c.useRef)(!0),I=(0,c.useCallback)(()=>{if(!S.current)return!0;const{scrollTop:e,scrollHeight:t,clientHeight:n}=S.current;return Math.abs(t-n-e)<10},[]),T=(0,c.useCallback)(()=>{E.current=I(),E.current?C.current=!1:C.current=!0},[I]);(0,c.useEffect)(()=>{if((v||"common"===(null===a||void 0===a?void 0:a.type))&&S.current){const e=S.current;return e.addEventListener("scroll",T),!E.current&&C.current||requestAnimationFrame(()=>{k.current&&k.current.scrollIntoView({behavior:"smooth"})}),()=>{e&&e.removeEventListener("scroll",T)}}var e;null===(e=k.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},[i,v,a,T]),(0,c.useEffect)(()=>{C.current=!1,E.current=!0},[o]);const _=e=>{if(e.preventDefault(),!o.trim())return;const t=d(),n=o.trim();s(""),g(null),console.log("[CLIENT] Sending message with type:",t,"for role:",null===r||void 0===r?void 0:r.role),l({text:n,messageType:t,parentDoubt:null===m||void 0===m?void 0:m._id})};return(0,xa.jsxs)("div",{className:"flex flex-col flex-grow bg-gray-50 transition-all duration-300 ".concat(x?"fixed inset-0 z-50":""),children:[(0,xa.jsx)("div",{className:"bg-indigo-900 p-4 border-b border-gray-200 shadow-sm",children:(0,xa.jsxs)("div",{className:"flex items-center justify-between",children:[(0,xa.jsxs)("div",{className:"flex items-center",children:[v&&(0,xa.jsx)("button",{onClick:()=>y(!b),className:"mr-3 p-2 rounded-lg hover:bg-indigo-800 text-white",children:(0,xa.jsx)(tt,{})}),(()=>{var e;return"common"===(null===a||void 0===a?void 0:a.type)?(0,xa.jsx)(Ht,{className:"text-blue-500 text-2xl"}):"Admin"===(null===a||void 0===a||null===(e=a.peer)||void 0===e?void 0:e.name)?(0,xa.jsx)(Ut,{className:"text-green-500 text-2xl"}):(0,xa.jsx)(Bt,{className:"text-blue-500 text-2xl"})})(),(0,xa.jsxs)("div",{className:"ml-3",children:[(0,xa.jsxs)("h3",{className:"text-xl font-bold text-white flex items-center mobile-text-lg",children:[(()=>{var e;return"common"===(null===a||void 0===a?void 0:a.type)?"Common Group":"Private Chat with ".concat((null===a||void 0===a||null===(e=a.peer)||void 0===e?void 0:e.name)||"Unknown")})(),"private"===(null===a||void 0===a?void 0:a.type)&&(null===a||void 0===a||null===(t=a.peer)||void 0===t?void 0:t._id)&&(0,xa.jsx)("span",{className:"ml-2 w-2 h-2 bg-green-500 rounded-full animate-pulse"})]}),(0,xa.jsx)("p",{className:"text-sm text-indigo-200 mobile-text-base",children:"common"===(null===a||void 0===a?void 0:a.type)?"Group discussion for all members":"Private doubt-clarity conversation"})]})]}),(0,xa.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,xa.jsx)("button",{onClick:()=>p(!f),className:"p-2 rounded-full transition-colors ".concat(f?"text-white bg-indigo-700 hover:bg-indigo-600":"text-indigo-300 bg-indigo-800 hover:bg-indigo-700"),title:f?"Disable notifications":"Enable notifications",children:(0,xa.jsx)(nt,{className:"text-lg"})}),(0,xa.jsx)("button",{onClick:()=>w(!x),className:"p-2 text-white hover:text-indigo-200 hover:bg-indigo-800 rounded-lg transition-colors",title:x?"Exit fullscreen":"Enter fullscreen",children:x?(0,xa.jsx)(ht,{className:"text-xl"}):(0,xa.jsx)(vt,{className:"text-xl"})})]})]})}),(0,xa.jsx)("div",{className:"flex-grow overflow-hidden flex flex-col",style:{height:"calc(100vh - 200px)"},children:h?(0,xa.jsx)(aie,{message:"Loading messages..."}):i.length>0?"common"===(null===a||void 0===a?void 0:a.type)?(0,xa.jsxs)("div",{className:"flex-grow overflow-y-auto p-4 bg-gray-100 chat-container",ref:S,style:{height:"calc(100vh - 250px)"},children:[i.map(e=>(0,xa.jsx)(sie,{message:e,currentUser:r,onReply:g,onDelete:u,isAdmin:N,replyingTo:i},e._id)),(0,xa.jsx)("div",{ref:k})]}):(0,xa.jsx)("div",{className:"h-full flex flex-col",children:v?(0,xa.jsxs)("div",{className:"flex-grow overflow-y-auto bg-white",style:{height:"calc(100vh - 180px)"},ref:S,children:[i.sort((e,t)=>new Date(e.timestamp)-new Date(t.timestamp)).map((e,t)=>{var n,a;const i="doubt"===(null===e||void 0===e?void 0:e.messageType)&&"Fighter"===(null===e||void 0===e?void 0:e.userModel),o="clarity"===(null===e||void 0===e?void 0:e.messageType)&&"Admin"===(null===e||void 0===e?void 0:e.userModel),s=(null===e||void 0===e||null===(n=e.user)||void 0===n||n._id,null===r||void 0===r||r._id,N&&o||!N&&i);return(0,xa.jsxs)("div",{className:"border-b border-gray-200 p-4",children:[(0,xa.jsxs)("div",{className:"flex items-center justify-between mb-2 ".concat(s?"flex-row-reverse":""),children:[(0,xa.jsx)("div",{className:"flex items-center gap-2 ".concat(s?"flex-row-reverse":""),children:(0,xa.jsx)("span",{className:"font-medium text-sm text-gray-700",children:(null===e||void 0===e||null===(a=e.user)||void 0===a?void 0:a.name)||"Unknown"})}),(0,xa.jsx)("div",{className:"flex items-center gap-2 ".concat(s?"flex-row-reverse":""),children:N&&(0,xa.jsx)("button",{onClick:()=>null===u||void 0===u?void 0:u(null===e||void 0===e?void 0:e._id),className:"p-1 text-red-400 hover:text-red-600 text-xs",title:"Delete",children:(0,xa.jsx)(Pt,{})})})]}),(0,xa.jsx)("div",{className:"flex ".concat(s?"justify-end":"justify-start"),children:(0,xa.jsxs)("div",{className:"max-w-[80%] p-3 rounded-xl shadow-sm my-2 ".concat(s?"bg-blue-600 text-white":"bg-gray-200 text-gray-900"),children:[(null===e||void 0===e?void 0:e.text)||"",(0,xa.jsx)("span",{className:"block text-xs mt-1 ".concat(s?"text-right text-gray-300":"text-left text-gray-500"),children:null!==e&&void 0!==e&&e.timestamp?new Date(e.timestamp).toLocaleTimeString([],{hour:"numeric",minute:"2-digit",hour12:!0}):""})]})})]},e._id)}),(0,xa.jsx)("div",{ref:k})]}):(0,xa.jsx)(cie,{messages:i,currentUser:r,onDelete:u})}):(0,xa.jsx)(iie,{icon:Ht,title:"No messages yet",description:"common"===(null===a||void 0===a?void 0:a.type)?"Start the group conversation":"Ask your first doubt or provide clarity"})}),"private"===(null===a||void 0===a?void 0:a.type)&&(0,xa.jsx)("div",{className:"bg-gray-50 border-t border-gray-200 p-4",children:(0,xa.jsx)("div",{className:"flex items-center justify-center space-x-6"})}),(0,xa.jsxs)("div",{className:"bg-white p-4 border-t border-gray-300",children:[m&&"common"===(null===a||void 0===a?void 0:a.type)&&(0,xa.jsx)("div",{className:"mb-3 p-3 bg-gray-100 rounded-lg border border-gray-300 relative",children:(0,xa.jsxs)("div",{className:"flex items-start",children:[(0,xa.jsx)("div",{className:"flex-shrink-0 mr-2",children:(0,xa.jsx)("div",{className:"w-6 h-6 rounded-full flex items-center justify-center text-xs ".concat("Admin"===m.userModel?"bg-blue-500 text-white":"bg-green-500 text-white"),children:"Admin"===m.userModel?(0,xa.jsx)(Ut,{className:"text-xs"}):(0,xa.jsx)(Bt,{className:"text-xs"})})}),(0,xa.jsxs)("div",{className:"flex-grow min-w-0",children:[(0,xa.jsx)("p",{className:"text-xs font-bold text-gray-700 truncate",children:(null===(n=m.user)||void 0===n?void 0:n.name)||"Unknown User"}),(0,xa.jsx)("p",{className:"text-xs text-gray-600 truncate",children:m.text.length>60?m.text.substring(0,60)+"...":m.text})]}),(0,xa.jsx)("button",{onClick:()=>g(null),className:"flex-shrink-0 text-gray-500 hover:text-gray-700 ml-2",title:"Cancel reply",children:(0,xa.jsx)(Lt,{className:"text-sm"})})]})}),(0,xa.jsxs)("form",{onSubmit:_,className:"flex items-end space-x-3",children:[(0,xa.jsx)("div",{className:"flex-grow",children:(0,xa.jsx)("textarea",{value:o,onChange:e=>s(e.target.value),placeholder:"common"===(null===a||void 0===a?void 0:a.type)?"Type a message...":N?"Type your clarity (answer)...":"Type your doubt (question)...",className:"w-full p-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none transition-all duration-200",rows:"1",style:{minHeight:"48px",maxHeight:"120px"},onInput:e=>{e.target.style.height="auto",e.target.style.height=e.target.scrollHeight+"px"},onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),_(e))}})}),(0,xa.jsx)("button",{type:"submit",disabled:!o.trim(),className:"p-3 rounded-full text-white focus:outline-none focus:ring-4 disabled:bg-gray-400 disabled:cursor-not-allowed transition-all duration-200 shadow-lg hover:shadow-xl flex-shrink-0 transform hover:scale-105 ".concat("common"===(null===a||void 0===a?void 0:a.type)?"bg-blue-600 hover:bg-blue-700 focus:ring-blue-300":N?"bg-green-600 hover:bg-green-700 focus:ring-green-300":"bg-orange-600 hover:bg-orange-700 focus:ring-orange-300"),children:(0,xa.jsx)(It,{className:"text-lg"})})]})]})]})},uie=e=>{let{notification:t,onClose:n,onNavigate:r,setReadMessages:a}=e;return t?(0,xa.jsx)("div",{className:"fixed top-4 right-4 z-50 animate-slide-in-right",children:(0,xa.jsxs)("div",{className:"bg-white rounded-lg shadow-2xl border border-gray-200 p-4 max-w-sm min-w-[300px] transform transition-all duration-300 hover:scale-105",children:[(0,xa.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,xa.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,xa.jsx)("div",{className:"w-3 h-3 bg-green-500 rounded-full animate-pulse"}),(0,xa.jsx)("span",{className:"font-bold text-gray-800 text-sm",children:"New Message"})]}),(0,xa.jsx)("button",{onClick:n,className:"text-gray-400 hover:text-gray-600 text-lg",children:(0,xa.jsx)(Lt,{className:"text-xs"})})]}),(0,xa.jsxs)("div",{className:"flex items-center space-x-2 mb-2",children:[(0,xa.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center ".concat("clarity"===t.messageType?"bg-green-100 text-green-600":"bg-orange-100 text-orange-600"),children:"clarity"===t.messageType?(0,xa.jsx)(Ut,{className:"text-xs"}):(0,xa.jsx)(Bt,{className:"text-xs"})}),(0,xa.jsxs)("div",{children:[(0,xa.jsx)("p",{className:"font-medium text-gray-800 text-sm",children:t.senderName}),(0,xa.jsxs)("p",{className:"text-xs text-gray-500",children:["clarity"===t.messageType?"\ud83d\udca1 Clarity":"\ud83e\udd14 Doubt"," \u2022 ",t.timestamp.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]})]})]}),(0,xa.jsx)("div",{className:"bg-gray-50 rounded-lg p-3 border border-gray-100",children:(0,xa.jsx)("p",{className:"text-sm text-gray-700 line-clamp-2",children:t.text.length>80?t.text.substring(0,80)+"...":t.text})}),(0,xa.jsxs)("div",{className:"mt-3 flex space-x-2",children:[(0,xa.jsx)("button",{onClick:n,className:"flex-1 text-center py-2 text-gray-600 hover:text-gray-800 text-sm font-medium border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:"Dismiss"}),(0,xa.jsx)("button",{onClick:()=>{a(e=>{const n=new Set(e);return n.add(t.id),n}),r()},className:"flex-1 text-center py-2 bg-blue-600 text-white text-sm font-medium rounded-lg hover:bg-blue-700 transition-colors",children:"View Chat"})]})]})}):null},hie=e=>{let{notifications:t,onClose:n,onClearAll:r,onNotificationClick:a,setReadMessages:i}=e;return t&&0!==t.length?(0,xa.jsx)("div",{className:"fixed bottom-4 right-4 z-50",children:(0,xa.jsxs)("div",{className:"bg-white rounded-lg shadow-2xl border border-gray-200 p-4 max-w-sm w-full max-h-96 overflow-y-auto",children:[(0,xa.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,xa.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,xa.jsx)(nt,{className:"text-blue-500"}),(0,xa.jsx)("span",{className:"font-bold text-gray-800",children:"Notifications"}),(0,xa.jsx)("span",{className:"bg-blue-100 text-blue-800 text-xs font-medium px-2 py-0.5 rounded-full",children:t.length})]}),(0,xa.jsxs)("div",{className:"flex space-x-2",children:[(0,xa.jsx)("button",{onClick:r,className:"text-xs text-gray-500 hover:text-gray-700",children:"Clear All"}),(0,xa.jsx)("button",{onClick:n,className:"text-gray-400 hover:text-gray-600",children:(0,xa.jsx)(Lt,{})})]})]}),(0,xa.jsx)("div",{className:"space-y-2",children:t.map((e,t)=>(0,xa.jsx)("div",{className:"p-3 bg-gray-50 rounded-lg border border-gray-100 hover:bg-gray-100 transition-colors cursor-pointer",onClick:()=>{i(t=>{const n=new Set(t);return n.add(e.id),n}),a(e)},children:(0,xa.jsxs)("div",{className:"flex items-start space-x-2",children:[(0,xa.jsx)("div",{className:"w-6 h-6 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5 ".concat("clarity"===e.messageType?"bg-green-100 text-green-600":"bg-orange-100 text-orange-600"),children:"clarity"===e.messageType?(0,xa.jsx)(Ut,{className:"text-xs"}):(0,xa.jsx)(Bt,{className:"text-xs"})}),(0,xa.jsxs)("div",{className:"flex-grow",children:[(0,xa.jsx)("p",{className:"font-medium text-gray-800 text-sm",children:e.senderName}),(0,xa.jsx)("p",{className:"text-xs text-gray-600 mt-1 line-clamp-2",children:e.text}),(0,xa.jsx)("p",{className:"text-xs text-gray-400 mt-1",children:e.timestamp.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})]})},t))})]})}):null},die=e=>{let{currentUser:t,setCurrentUser:n,adminId:r,setAdminId:a,fighters:i,setFighters:o,messages:s,setMessages:l,activeChat:u,setActiveChat:h,newMessage:d,setNewMessage:f,loading:p,setLoading:m,error:g,setError:v,unreadCounts:b,setUnreadCounts:y,lastSeenMessages:x,setLastSeenMessages:w,readMessages:k,setReadMessages:S,replyingTo:N,setReplyingTo:C,handleSendMessage:E,handleDeleteMessage:I,getFilteredMessages:T,getNextMessageType:_,notification:A,setNotification:R,notifications:F,setNotifications:D,notificationsEnabled:O,setNotificationsEnabled:L}=e;const[P,M]=(0,c.useState)(!1),[j,B]=(0,c.useState)(!1),[z,U]=(0,c.useState)(!1),W=(0,c.useRef)(null),V=(0,c.useRef)(new Set);null===t||void 0===t||t.role;(0,c.useEffect)(()=>{const e=()=>{M(window.innerWidth<=768)};return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e),V.current.clear()}},[]),(0,c.useEffect)(()=>{P&&B(!1)},[u,P]),(0,c.useEffect)(()=>{var e;null===(e=W.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},[s]);const H=(0,c.useCallback)((e,t)=>{var n,r;console.log("[NOTIFICATION] Showing for:",t,null===(n=e.text)||void 0===n?void 0:n.substring(0,30)),O&&rie();const a={id:e._id,senderId:null===(r=e.user)||void 0===r?void 0:r._id,senderName:t,text:e.text,timestamp:new Date(e.timestamp),messageType:e.messageType};R(a),D(e=>e.some(e=>e.id===a.id)?e:[a,...e.slice(0,9)]),setTimeout(()=>{R(null)},4e3)},[O,R,D]);(0,c.useEffect)(()=>{var e,n;if(!t||!s.length)return;const r=s[s.length-1];if(!((null===r||void 0===r||null===(e=r.user)||void 0===e||null===(n=e._id)||void 0===n?void 0:n.toString())===t._id.toString())&&r){var a;const e=(null===(a=r.user)||void 0===a?void 0:a.name)||"Unknown User";let t=!1;var i,o,c,l;if("private"===(null===u||void 0===u?void 0:u.type)&&r.recipientId)t=(null===u||void 0===u||null===(i=u.peer)||void 0===i||null===(o=i._id)||void 0===o?void 0:o.toString())===(null===(c=r.user)||void 0===c||null===(l=c._id)||void 0===l?void 0:l.toString());else"common"!==(null===u||void 0===u?void 0:u.type)||r.recipientId||(t=!0);const n=r.isRead||k.has(r._id);if(!t&&!n){const t=F.some(e=>e.id===r._id),n=V.current.has(r._id);t||n||(H(r,e),V.current.add(r._id))}}},[s,t,u,F,k,H]),(0,c.useEffect)(()=>{let e=!0;return u&&(async()=>{var n;if("private"===(null===u||void 0===u?void 0:u.type)&&null!==u&&void 0!==u&&null!==(n=u.peer)&&void 0!==n&&n._id){const n=u.peer._id;try{if(await ya.post("/doubts/mark-chat-read",{chatUserId:n}),!e)return;w(e=>Kt(Kt({},e),{},{[n]:Date.now()})),y(e=>{const t=Kt({},e);return delete t[n],t});const{data:r}=await ya.get("/doubts");if(!e)return;l(r),S(e=>{const n=new Set(e);return r.forEach(e=>{var r,a;(e.isRead||(null===(r=e.user)||void 0===r||null===(a=r._id)||void 0===a?void 0:a.toString())!==t._id.toString())&&n.add(e._id)}),n})}catch(g){console.error("Error marking chat as read:",g)}}else if("common"===(null===u||void 0===u?void 0:u.type)){const e=s.filter(e=>!e.recipientId);S(n=>{const r=new Set(n);return e.forEach(e=>{var n,a;(null===(n=e.user)||void 0===n||null===(a=n._id)||void 0===a?void 0:a.toString())!==t._id.toString()&&r.add(e._id)}),r})}})(),()=>{e=!1,V.current.clear()}},[u,l,S,w,y,s,t]);const G=(0,c.useCallback)(()=>_(),[_]);if((0,c.useEffect)(()=>{const e=Object.values(b).reduce((e,t)=>e+t,0);document.title=e>0?"(".concat(e,") Chat App"):"Chat App"},[b]),p)return(0,xa.jsx)("div",{className:"h-screen flex items-center justify-center bg-gray-50",children:(0,xa.jsx)(aie,{message:"Initializing chat..."})});if(g)return(0,xa.jsx)("div",{className:"h-screen flex items-center justify-center bg-gray-50",children:(0,xa.jsxs)("div",{className:"text-center p-8 bg-white rounded-xl shadow-lg max-w-md",children:[(0,xa.jsx)(mt,{className:"text-6xl text-red-500 mb-4 mx-auto"}),(0,xa.jsx)("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Something went wrong"}),(0,xa.jsx)("p",{className:"text-gray-600 mb-4",children:g}),(0,xa.jsx)("button",{onClick:()=>window.location.reload(),className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Retry"})]})});const q=T();return(0,xa.jsxs)("div",{className:"flex h-screen bg-gray-100",children:[P&&j&&(0,xa.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-40",onClick:()=>B(!1)}),(0,xa.jsx)(oie,{currentUser:t,fighters:i,activeChat:u,setActiveChat:h,adminId:r,unreadCounts:b,isMobile:P,isSidebarOpen:j,setIsSidebarOpen:B,messages:s}),(0,xa.jsx)(lie,{currentUser:t,activeChat:u,messages:q,newMessage:d,setNewMessage:f,onSendMessage:async e=>{E(e)},onDelete:async e=>{I(e)},loading:p,getNextMessageType:G,replyingTo:N,setReplyingTo:C,isMobile:P,isSidebarOpen:j,setIsSidebarOpen:B,notificationsEnabled:O,setNotificationsEnabled:L}),A&&(0,xa.jsx)(uie,{notification:A,onClose:()=>R(null),onNavigate:()=>{A.senderId&&h({type:"private",peer:{_id:A.senderId,name:A.senderName}}),R(null)},setReadMessages:S}),(0,xa.jsxs)("button",{onClick:()=>U(!z),className:"fixed bottom-4 right-4 bg-blue-600 text-white rounded-full p-3 shadow-lg hover:bg-blue-700 transition-colors z-40",children:[(0,xa.jsx)(nt,{className:"text-lg"}),F.length>0&&(0,xa.jsx)("span",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center animate-pulse",children:F.length})]}),z&&(0,xa.jsx)(hie,{notifications:F,onClose:()=>U(!1),onClearAll:()=>{D([]),localStorage.setItem("notifications",JSON.stringify([]))},onNotificationClick:e=>{e.senderId&&h({type:"private",peer:{_id:e.senderId,name:e.senderName}}),U(!1),R(null)},setReadMessages:S})]})},fie=e=>{let{message:t="Loading..."}=e;return(0,xa.jsxs)("div",{className:"flex items-center justify-center p-8",children:[(0,xa.jsx)(Ft,{className:"animate-spin text-2xl text-blue-500 mr-3"}),(0,xa.jsx)("span",{className:"text-gray-600 mobile-text-base",children:t})]})},pie=e=>{let{icon:t,title:n,description:r,action:a}=e;return(0,xa.jsxs)("div",{className:"flex flex-col items-center justify-center h-full p-8 text-center bg-white",children:[(0,xa.jsx)(t,{className:"text-6xl text-gray-300 mb-4"}),(0,xa.jsx)("h3",{className:"text-xl font-semibold text-gray-600 mb-2 mobile-text-lg",children:n}),(0,xa.jsx)("p",{className:"text-gray-500 mb-4 mobile-text-base",children:r}),a]})},mie=e=>{var t;let{currentUser:n,messages:r,newMessage:a,setNewMessage:i,onSendMessage:o,onDelete:s,loading:l,getNextMessageType:u,replyingTo:h,setReplyingTo:d,isAdmin:f,isMobile:p,isSidebarOpen:m,setIsSidebarOpen:g}=e;const v=(0,c.useRef)(null),b=(0,c.useRef)(null);(0,c.useEffect)(()=>{v.current&&b.current&&requestAnimationFrame(()=>{var e;null===(e=v.current)||void 0===e||e.scrollIntoView({behavior:"smooth"}),b.current&&(b.current.scrollTop=b.current.scrollHeight)})},[r]);const y=e=>{if(e.preventDefault(),!a.trim())return;const t=u(),n=a.trim();i(""),d(null),o({text:n,messageType:t,parentDoubt:null===h||void 0===h?void 0:h._id})},x=e=>{var t,n,r;let{message:a,currentUser:i,onReply:o,onDelete:s,isAdmin:l,replyingTo:u}=e;const[h,d]=(0,c.useState)(!1),f=(null===a||void 0===a||null===(t=a.user)||void 0===t?void 0:t._id)===(null===i||void 0===i?void 0:i._id),p="Admin"===(null===a||void 0===a?void 0:a.userModel),m=!(null===a||void 0===a||!a.parentDoubt)&&u?u.find(e=>e._id===a.parentDoubt):null;return(0,xa.jsx)("div",{className:"flex ".concat(f?"justify-end":"justify-start"," mb-3 group"),onMouseEnter:()=>d(!0),onMouseLeave:()=>d(!1),children:(0,xa.jsxs)("div",{className:"flex items-end gap-2 max-w-full ".concat(f?"flex-row-reverse":""," relative"),children:[(0,xa.jsx)("div",{className:"flex-shrink-0",children:(0,xa.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center shadow-sm ".concat(p?"bg-blue-500":"bg-green-500"),children:p?(0,xa.jsx)(Ut,{className:"text-white text-xs"}):(0,xa.jsx)(Bt,{className:"text-white text-xs"})})}),(0,xa.jsxs)("div",{className:"px-3 py-2 rounded-2xl shadow-sm max-w-[80%] transition-all duration-200 ".concat(f?"bg-blue-500 text-white rounded-br-sm":"bg-gray-100 text-gray-800 border border-gray-200 rounded-bl-sm"),children:[m&&(0,xa.jsxs)("div",{className:"mb-1 p-2 bg-blue-100 rounded-lg border-l-2 border-blue-500",children:[(0,xa.jsx)("p",{className:"text-xs font-bold text-blue-800 truncate mobile-text-xs",children:(null===(n=m.user)||void 0===n?void 0:n.name)||"Unknown User"}),(0,xa.jsx)("p",{className:"text-xs text-blue-700 truncate mobile-text-xs",children:m.text.length>30?m.text.substring(0,30)+"...":m.text})]}),(0,xa.jsx)("p",{className:"text-xs font-bold mb-1 ".concat(f?"text-blue-100":"text-blue-600"," mobile-text-sm"),children:f?"You":(null===a||void 0===a||null===(r=a.user)||void 0===r?void 0:r.name)||"Unknown User"}),(0,xa.jsx)("p",{className:"text-sm leading-relaxed whitespace-pre-wrap break-words mobile-text-base",children:(null===a||void 0===a?void 0:a.text)||""}),(0,xa.jsx)("div",{className:"flex items-center justify-between mt-1",children:(0,xa.jsx)("p",{className:"text-xs ".concat(f?"text-blue-100":"text-gray-500"," mobile-text-xs"),children:null!==a&&void 0!==a&&a.timestamp?new Date(a.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):""})})]}),h&&(0,xa.jsxs)("div",{className:"absolute bottom-0 ".concat(f?"left-0":"right-0"," transform ").concat(f?"-translate-x-full":"translate-x-full"," flex space-x-1 bg-gray-800 rounded-lg p-1 shadow-lg z-20"),children:[(0,xa.jsx)("button",{onClick:()=>null===o||void 0===o?void 0:o(a),className:"p-1 text-white hover:bg-gray-700 rounded text-xs transition-colors",title:"Reply",children:(0,xa.jsx)(Tt,{})}),l&&(0,xa.jsx)("button",{onClick:()=>null===s||void 0===s?void 0:s(null===a||void 0===a?void 0:a._id),className:"p-1 text-red-400 hover:bg-red-600 hover:text-white rounded text-xs transition-colors",title:"Delete",children:(0,xa.jsx)(Pt,{})})]})]})})};return(0,xa.jsxs)("div",{className:"flex flex-col h-full",children:[(0,xa.jsx)("div",{ref:b,className:"flex-grow overflow-y-auto p-3 bg-gray-100 mobile-padding-sm chat-container",style:{height:"calc(100vh - 180px)"},children:l?(0,xa.jsx)(fie,{message:"Loading messages..."}):r.length>0?(0,xa.jsxs)(xa.Fragment,{children:[r.map(e=>(0,xa.jsx)(x,{message:e,currentUser:n,onReply:d,onDelete:s,isAdmin:f,replyingTo:r},e._id)),(0,xa.jsx)("div",{ref:v})]}):(0,xa.jsx)(pie,{icon:Ht,title:"No messages yet",description:"Ask your first doubt or provide clarity"})}),(0,xa.jsxs)("div",{className:"bg-white p-3 border-t border-gray-300",children:[h&&(0,xa.jsx)("div",{className:"mb-3 p-3 bg-gray-100 rounded-lg border border-gray-300 relative",children:(0,xa.jsxs)("div",{className:"flex items-start",children:[(0,xa.jsx)("div",{className:"flex-shrink-0 mr-2",children:(0,xa.jsx)("div",{className:"w-6 h-6 rounded-full flex items-center justify-center text-xs ".concat("Admin"===h.userModel?"bg-blue-500 text-white":"bg-green-500 text-white"),children:"Admin"===h.userModel?(0,xa.jsx)(Ut,{className:"text-xs"}):(0,xa.jsx)(Bt,{className:"text-xs"})})}),(0,xa.jsxs)("div",{className:"flex-grow min-w-0",children:[(0,xa.jsx)("p",{className:"text-xs font-bold text-gray-700 truncate mobile-text-sm",children:(null===(t=h.user)||void 0===t?void 0:t.name)||"Unknown User"}),(0,xa.jsx)("p",{className:"text-xs text-gray-600 truncate mobile-text-sm",children:h.text.length>60?h.text.substring(0,60)+"...":h.text})]}),(0,xa.jsx)("button",{onClick:()=>d(null),className:"flex-shrink-0 text-gray-500 hover:text-gray-700 ml-2",title:"Cancel reply",children:(0,xa.jsx)(Lt,{className:"text-sm"})})]})}),(0,xa.jsxs)("form",{onSubmit:y,className:"flex items-end space-x-2",children:[(0,xa.jsx)("div",{className:"flex-grow",children:(0,xa.jsx)("textarea",{value:a,onChange:e=>i(e.target.value),placeholder:"Type a message...",className:"w-full p-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none transition-all duration-200 mobile-text-base",rows:"1",style:{minHeight:"40px",maxHeight:"100px"},onInput:e=>{e.target.style.height="auto",e.target.style.height=e.target.scrollHeight+"px"},onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),y(e))}})}),(0,xa.jsx)("button",{type:"submit",disabled:!a.trim(),className:"p-3 rounded-full text-white focus:outline-none focus:ring-4 disabled:bg-gray-400 disabled:cursor-not-allowed transition-all duration-200 shadow-lg hover:shadow-xl flex-shrink-0 transform hover:scale-105 ".concat("bg-blue-600 hover:bg-blue-700 focus:ring-blue-300"),children:(0,xa.jsx)(It,{className:"text-lg"})})]})]})]})},gie=e=>{var t;let{currentUser:n,fighters:r,activeChat:a,setActiveChat:i,adminId:o,unreadCounts:s={},isAdmin:l}=e;const[u,h]=(0,c.useState)(""),d=(0,c.useMemo)(()=>r.filter(e=>{var t;return null===e||void 0===e||null===(t=e.name)||void 0===t?void 0:t.toLowerCase().includes(u.toLowerCase())}),[r,u]),f=c.memo(e=>{let{chat:t,isActive:n,onClick:r,icon:a,title:i,subtitle:o,chatId:c}=e;const l=s[c]||0,u=l>0;return(0,xa.jsxs)("div",{onClick:r,className:"flex items-center p-4 cursor-pointer transition-all duration-200 border-b border-gray-200 hover:bg-gray-100 relative ".concat(n?"bg-blue-50 border-l-4 border-l-blue-400":""," ").concat(u&&!n?"bg-blue-50":""),children:[u&&!n&&(0,xa.jsx)("div",{className:"absolute left-2 top-2 w-3 h-3 bg-green-500 rounded-full animate-pulse border-2 border-white"}),(0,xa.jsxs)("div",{className:"relative mr-4",children:[(0,xa.jsx)(a,{className:"text-xl ".concat(n?"text-blue-600":u?"text-green-600":"text-gray-600")}),u&&(0,xa.jsx)("span",{className:"absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center animate-pulse font-bold",children:l>9?"9+":l})]}),(0,xa.jsxs)("div",{className:"flex-grow",children:[(0,xa.jsxs)("h4",{className:"font-medium ".concat(n?"text-blue-700":u?"text-gray-800":"text-gray-700"," mobile-text-lg truncate"),children:[i,u&&(0,xa.jsx)("span",{className:"ml-2 text-green-600 text-sm",children:"\u2022 New"})]}),(0,xa.jsxs)("p",{className:"text-sm ".concat(n?"text-blue-600":u?"text-gray-600":"text-gray-500"," mobile-text-base truncate"),children:[o,u&&(0,xa.jsxs)("span",{className:"ml-2 text-green-600 font-medium",children:["(",l," new)"]})]})]}),n&&(0,xa.jsx)(dt,{className:"text-green-500"})]})},(e,t)=>{const n=e.unreadCounts[e.chatId]||0,r=t.unreadCounts[t.chatId]||0;return e.isActive===t.isActive&&e.title===t.title&&e.subtitle===t.subtitle&&e.chatId===t.chatId&&n===r});return(0,xa.jsxs)("div",{className:"flex flex-col h-full bg-white",children:[(0,xa.jsxs)("div",{className:"p-4 border-b border-gray-200 bg-gray-50",children:[(0,xa.jsx)("h2",{className:"text-xl font-bold text-center mobile-text-lg",children:l?"\ud83d\udcac Doubt Management":"\ud83e\udd14 Ask Doubts"}),(0,xa.jsx)("p",{className:"text-sm text-gray-600 text-center mt-1 mobile-text-base",children:l?"Admin Panel":"Get Help & Clarity"})]}),l&&(0,xa.jsx)("div",{className:"p-3 border-b border-gray-200",children:(0,xa.jsxs)("div",{className:"relative",children:[(0,xa.jsx)(_t,{className:"absolute left-3 top-3 text-gray-400 text-sm"}),(0,xa.jsx)("input",{type:"text",placeholder:"Search fighters...",value:u,onChange:e=>h(e.target.value),className:"w-full pl-10 pr-4 py-2 bg-gray-50 text-gray-800 rounded-lg border border-gray-300 focus:outline-none focus:border-blue-500 text-sm mobile-text-base"}),u&&(0,xa.jsx)("button",{onClick:()=>h(""),className:"absolute right-3 top-3 text-gray-400 hover:text-gray-600",children:(0,xa.jsx)(Lt,{className:"text-sm"})})]})}),(0,xa.jsxs)("div",{className:"flex-grow overflow-y-auto h-[calc(100vh-120px)]",children:[(0,xa.jsx)(f,{chat:{type:"common"},isActive:"common"===(null===a||void 0===a?void 0:a.type),onClick:()=>i({type:"common",peer:{_id:null,name:"Common Group"}}),icon:Ht,title:"Common Group",subtitle:"Group discussion for all members"}),l?d.map(e=>{var t;return(0,xa.jsx)(f,{chat:{type:"private",peer:e},isActive:"private"===(null===a||void 0===a?void 0:a.type)&&(null===a||void 0===a||null===(t=a.peer)||void 0===t?void 0:t._id)===e._id,onClick:()=>{i({type:"private",peer:e})},icon:Bt,title:e.name,subtitle:"Doubt-Clarity chat",chatId:e._id},e._id)}):(0,xa.jsx)(f,{chat:{type:"private",peer:{_id:o,name:"Admin"}},isActive:"private"===(null===a||void 0===a?void 0:a.type)&&(null===a||void 0===a||null===(t=a.peer)||void 0===t?void 0:t._id)===o,onClick:()=>{i({type:"private",peer:{_id:o,name:"Admin"}})},icon:Ut,title:"Private with Admin",subtitle:"Doubt-Clarity format",chatId:o}),l&&0===d.length&&u&&(0,xa.jsx)("div",{className:"p-4 text-center text-gray-500",children:(0,xa.jsxs)("p",{className:"mobile-text-base",children:['No fighters found matching "',u,'"']})})]})]})},vie=e=>{let{messages:t,currentUser:n,onDelete:r}=e;const a="admin"===(null===n||void 0===n?void 0:n.role),i=(0,c.useRef)(null),o=(0,c.useRef)(null),s=(0,c.useRef)(!1),l=(0,c.useRef)(!0),u=(0,c.useCallback)(()=>{if(!o.current)return!0;const{scrollTop:e,scrollHeight:t,clientHeight:n}=o.current;return Math.abs(t-n-e)<10},[]),h=(0,c.useCallback)(()=>{l.current=u(),l.current||(s.current=!0)},[u]);(0,c.useEffect)(()=>{const e=o.current;if(e)return e.addEventListener("scroll",h),s.current&&!l.current||requestAnimationFrame(()=>{i.current&&i.current.scrollIntoView({behavior:"smooth"})}),()=>{e&&e.removeEventListener("scroll",h)}},[t,h]),(0,c.useEffect)(()=>{const e=s.current;s.current=!1,e&&setTimeout(()=>{if(o.current){const{scrollTop:e,scrollHeight:t,clientHeight:n}=o.current;Math.abs(t-n-e)<100&&(s.current=!1)}},100)},[t.length]);const d=[...t].sort((e,t)=>new Date(e.timestamp)-new Date(t.timestamp));return(0,xa.jsx)("div",{ref:o,className:"flex-grow overflow-y-auto bg-white chat-container",style:{height:"calc(100vh - 180px)"},children:0===d.length?(0,xa.jsx)("div",{className:"flex items-center justify-center h-full p-8",children:(0,xa.jsxs)("div",{className:"text-center",children:[(0,xa.jsx)("div",{className:"flex justify-center mb-4",children:(0,xa.jsx)("div",{className:"flex items-center justify-center w-16 h-16 rounded-full bg-gray-100 text-gray-400",children:(0,xa.jsx)(Ht,{className:"text-2xl"})})}),(0,xa.jsx)("h3",{className:"text-xl font-semibold text-gray-700 mb-2 mobile-text-lg",children:"No conversations yet"}),(0,xa.jsx)("p",{className:"text-gray-500 mobile-text-base",children:"Start a conversation by sending a doubt or clarity"})]})}):(0,xa.jsxs)(xa.Fragment,{children:[d.map(e=>{var t,i;const o="doubt"===(null===e||void 0===e?void 0:e.messageType)&&"Fighter"===(null===e||void 0===e?void 0:e.userModel),s="clarity"===(null===e||void 0===e?void 0:e.messageType)&&"Admin"===(null===e||void 0===e?void 0:e.userModel),c=(null===e||void 0===e||null===(t=e.user)||void 0===t||t._id,null===n||void 0===n||n._id,a&&s||!a&&o);return(0,xa.jsxs)("div",{className:"border-b border-gray-200 p-4",children:[(0,xa.jsxs)("div",{className:"flex items-center justify-between mb-2 ".concat(c?"flex-row-reverse":""),children:[(0,xa.jsx)("div",{className:"flex items-center gap-2 ".concat(c?"flex-row-reverse":""),children:(0,xa.jsx)("span",{className:"font-medium text-sm text-gray-700 mobile-text-sm",children:(null===e||void 0===e||null===(i=e.user)||void 0===i?void 0:i.name)||"Unknown"})}),(0,xa.jsx)("div",{className:"flex items-center gap-2 ".concat(c?"flex-row-reverse":""),children:a&&(0,xa.jsx)("button",{onClick:()=>null===r||void 0===r?void 0:r(null===e||void 0===e?void 0:e._id),className:"p-1 text-red-400 hover:text-red-600 text-xs mobile-text-sm",title:"Delete",children:(0,xa.jsx)(Pt,{})})})]}),(0,xa.jsx)("div",{className:"flex ".concat(c?"justify-end":"justify-start"),children:(0,xa.jsxs)("div",{className:"max-w-[80%] p-3 rounded-xl shadow-sm my-2 ".concat(c?"bg-blue-600 text-white":"bg-gray-200 text-gray-900"),children:[(null===e||void 0===e?void 0:e.text)||"",(0,xa.jsx)("span",{className:"block text-xs mt-1 ".concat(c?"text-right text-gray-300":"text-left text-gray-500"),children:null!==e&&void 0!==e&&e.timestamp?new Date(e.timestamp).toLocaleTimeString([],{hour:"numeric",minute:"2-digit",hour12:!0}):""})]})})]},e._id)}),(0,xa.jsx)("div",{ref:i})]})})},bie=e=>{let{currentUser:t,activeChat:n,messages:r,newMessage:a,setNewMessage:i,onSendMessage:o,onDelete:s,loading:c,getNextMessageType:l,isAdmin:u}=e;const h=e=>{if(e.preventDefault(),!a.trim())return;const t=l(),n=a.trim();i(""),o({text:n,messageType:t})};return(0,xa.jsxs)("div",{className:"flex flex-col h-full",children:[(0,xa.jsx)("div",{className:"bg-indigo-900 p-4 border-b border-gray-200 shadow-sm",children:(0,xa.jsx)("div",{className:"flex items-center",children:(0,xa.jsxs)("div",{className:"ml-0",children:[(0,xa.jsx)("h3",{className:"text-xl font-bold text-white flex items-center mobile-text-lg",children:(()=>{var e;return"Private Chat with ".concat((null===n||void 0===n||null===(e=n.peer)||void 0===e?void 0:e.name)||"Unknown")})()}),(0,xa.jsx)("p",{className:"text-sm text-indigo-200 mobile-text-base",children:"Private doubt-clarity conversation"})]})})}),(0,xa.jsx)("div",{className:"flex-grow overflow-hidden",children:c?(0,xa.jsx)(fie,{message:"Loading messages..."}):r.length>0?(0,xa.jsx)(vie,{messages:r,currentUser:t,onDelete:s}):(0,xa.jsx)(pie,{icon:Ht,title:"No messages yet",description:"Ask your first doubt or provide clarity"})}),(0,xa.jsx)("div",{className:"bg-gray-50 border-t border-gray-200 p-3"}),(0,xa.jsx)("div",{className:"bg-white p-3 border-t border-gray-200",children:(0,xa.jsxs)("form",{onSubmit:h,className:"flex items-end space-x-2",children:[(0,xa.jsx)("div",{className:"flex-grow",children:(0,xa.jsx)("textarea",{value:a,onChange:e=>i(e.target.value),placeholder:u?"Type your clarity (answer)...":"Type your doubt (question)...",className:"w-full p-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none transition-all duration-200 mobile-text-base",rows:"1",style:{minHeight:"40px",maxHeight:"100px"},onInput:e=>{e.target.style.height="auto",e.target.style.height=e.target.scrollHeight+"px"},onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),h(e))}})}),(0,xa.jsx)("button",{type:"submit",disabled:!a.trim(),className:"p-3 rounded-full text-white focus:outline-none focus:ring-4 disabled:bg-gray-400 disabled:cursor-not-allowed transition-all duration-200 shadow-lg hover:shadow-xl flex-shrink-0 transform hover:scale-105 ".concat(u?"bg-green-600 hover:bg-green-700 focus:ring-green-300":"bg-orange-600 hover:bg-orange-700 focus:ring-orange-300"),children:(0,xa.jsx)(It,{className:"text-lg"})})]})})]})},yie=e=>{let{notifications:t,setNotification:n,onNotificationClick:r,setReadMessages:a}=e;return t&&0!==t.length?(0,xa.jsxs)("div",{className:"flex flex-col h-full bg-white",children:[(0,xa.jsxs)("div",{className:"p-4 border-b border-gray-200 bg-gray-50 flex items-center justify-between",children:[(0,xa.jsx)("h2",{className:"text-xl font-bold mobile-text-lg",children:"Notifications"}),(0,xa.jsx)("button",{onClick:()=>{n(null)},className:"text-sm text-blue-600 hover:text-blue-800",children:"Clear All"})]}),(0,xa.jsx)("div",{className:"flex-grow overflow-y-auto h-[calc(100vh-120px)]",children:t.map((e,t)=>(0,xa.jsx)("div",{className:"p-4 border-b border-gray-200 cursor-pointer hover:bg-gray-50",onClick:()=>{a(t=>{const n=new Set(t);return n.add(e.id),n}),r(e)},children:(0,xa.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,xa.jsx)("div",{className:"w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0 ".concat("clarity"===e.messageType?"bg-green-100 text-green-600":"bg-orange-100 text-orange-600"),children:"clarity"===e.messageType?(0,xa.jsx)(Ut,{className:"text-sm"}):(0,xa.jsx)(Bt,{className:"text-sm"})}),(0,xa.jsxs)("div",{className:"flex-grow",children:[(0,xa.jsxs)("div",{className:"flex items-center justify-between",children:[(0,xa.jsx)("p",{className:"font-medium text-gray-800 mobile-text-base",children:e.senderName}),(0,xa.jsx)("span",{className:"text-xs text-gray-500",children:e.timestamp.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),(0,xa.jsx)("p",{className:"text-sm text-gray-600 mt-1 mobile-text-sm",children:"clarity"===e.messageType?"\ud83d\udca1 Clarity":"\ud83e\udd14 Doubt"}),(0,xa.jsx)("p",{className:"text-sm text-gray-800 mt-2 line-clamp-2 mobile-text-base",children:e.text})]})]})},t))})]}):(0,xa.jsxs)("div",{className:"flex flex-col items-center justify-center h-full p-8 text-center bg-white",children:[(0,xa.jsx)(nt,{className:"text-6xl text-gray-300 mb-4"}),(0,xa.jsx)("h3",{className:"text-xl font-semibold text-gray-600 mb-2 mobile-text-lg",children:"No notifications"}),(0,xa.jsx)("p",{className:"text-gray-500 mobile-text-base",children:"You're all caught up!"})]})},xie=e=>{let{currentUser:t,setCurrentUser:n,adminId:r,setAdminId:a,fighters:i,setFighters:o,messages:s,setMessages:l,activeChat:u,setActiveChat:h,newMessage:d,setNewMessage:f,loading:p,setLoading:m,error:g,setError:v,unreadCounts:b,setUnreadCounts:y,lastSeenMessages:x,setLastSeenMessages:w,readMessages:k,setReadMessages:S,replyingTo:N,setReplyingTo:C,handleSendMessage:E,handleDeleteMessage:I,getFilteredMessages:T,getNextMessageType:_,notification:A,setNotification:R,notifications:F,setNotifications:D,notificationsEnabled:O,setNotificationsEnabled:L}=e;const[P,M]=(0,c.useState)("common"),[j,B]=(0,c.useState)(!0),[z,U]=(0,c.useState)(!1),W=((0,c.useRef)(null),(0,c.useRef)(new Set)),V="admin"===(null===t||void 0===t?void 0:t.role),H=(0,c.useCallback)((e,t)=>{var n,r;console.log("[NOTIFICATION] Showing for:",t,null===(n=e.text)||void 0===n?void 0:n.substring(0,30)),O&&rie();const a={id:e._id,senderId:null===(r=e.user)||void 0===r?void 0:r._id,senderName:t,text:e.text,timestamp:new Date(e.timestamp),messageType:e.messageType};R(a),D(e=>e.some(e=>e.id===a.id)?e:[a,...e.slice(0,9)]),setTimeout(()=>{R(null)},4e3)},[O,R,D]);(0,c.useEffect)(()=>{var e,n;if(!t||!s.length)return;const r=s[s.length-1];if(!((null===r||void 0===r||null===(e=r.user)||void 0===e||null===(n=e._id)||void 0===n?void 0:n.toString())===t._id.toString())&&r){var a;const e=(null===(a=r.user)||void 0===a?void 0:a.name)||"Unknown User";let t=!1;var i,o,c,l;if("private"===(null===u||void 0===u?void 0:u.type)&&r.recipientId)t=(null===u||void 0===u||null===(i=u.peer)||void 0===i||null===(o=i._id)||void 0===o?void 0:o.toString())===(null===(c=r.user)||void 0===c||null===(l=c._id)||void 0===l?void 0:l.toString());else"common"!==(null===u||void 0===u?void 0:u.type)||r.recipientId||(t=!0);const n=r.isRead||k.has(r._id);if(!t&&!n){const t=F.some(e=>e.id===r._id),n=W.current.has(r._id);t||n||(H(r,e),W.current.add(r._id))}}},[s,t,u,F,k,H]),(0,c.useEffect)(()=>{let e=!0;return u&&(async()=>{var n;if("private"===(null===u||void 0===u?void 0:u.type)&&null!==u&&void 0!==u&&null!==(n=u.peer)&&void 0!==n&&n._id){const n=u.peer._id;try{if(await ya.post("/doubts/mark-chat-read",{chatUserId:n}),!e)return;w(e=>Kt(Kt({},e),{},{[n]:Date.now()})),y(e=>{const t=Kt({},e);return delete t[n],t});const{data:r}=await ya.get("/doubts");if(!e)return;l(r),S(e=>{const n=new Set(e);return r.forEach(e=>{var r,a;(e.isRead||(null===(r=e.user)||void 0===r||null===(a=r._id)||void 0===a?void 0:a.toString())!==t._id.toString())&&n.add(e._id)}),n})}catch(g){console.error("Error marking chat as read:",g)}}else if("common"===(null===u||void 0===u?void 0:u.type)){const e=s.filter(e=>!e.recipientId);S(n=>{const r=new Set(n);return e.forEach(e=>{var n,a;(null===(n=e.user)||void 0===n||null===(a=n._id)||void 0===a?void 0:a.toString())!==t._id.toString()&&r.add(e._id)}),r})}})(),()=>{e=!1,W.current.clear()}},[u,l,S,w,y,s,t]);const G=e=>{e.senderId&&(h({type:"private",peer:{_id:e.senderId,name:e.senderName}}),M("private")),R(null)};return(0,c.useEffect)(()=>{const e=Object.values(b).reduce((e,t)=>e+t,0);document.title=e>0?"(".concat(e,") Chat App"):"Chat App"},[b]),p?(0,xa.jsx)("div",{className:"h-screen flex items-center justify-center bg-gray-50",children:(0,xa.jsx)(fie,{message:"Initializing chat..."})}):g?(0,xa.jsx)("div",{className:"h-screen flex items-center justify-center bg-gray-50",children:(0,xa.jsxs)("div",{className:"text-center p-8 bg-white rounded-xl shadow-lg max-w-md",children:[(0,xa.jsx)(mt,{className:"text-6xl text-red-500 mb-4 mx-auto"}),(0,xa.jsx)("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Something went wrong"}),(0,xa.jsx)("p",{className:"text-gray-600 mb-4",children:g}),(0,xa.jsx)("button",{onClick:()=>window.location.reload(),className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Retry"})]})}):(0,xa.jsxs)("div",{className:"flex flex-col h-screen bg-gray-100",children:[(0,xa.jsx)("div",{className:"bg-white p-4 border-b border-gray-200 shadow-sm",children:(0,xa.jsxs)("div",{className:"flex items-center justify-between",children:[(0,xa.jsxs)("div",{className:"flex items-center",children:[(()=>{var e;return"common"===P&&"common"!==(null===u||void 0===u?void 0:u.type)||!("private"!==P||"private"!==(null===u||void 0===u?void 0:u.type)||null===u||void 0===u||null===(e=u.peer)||void 0===e||!e._id)})()&&(0,xa.jsx)("button",{onClick:()=>{var e;("common"===P&&"common"!==(null===u||void 0===u?void 0:u.type)||"private"===P&&"private"===(null===u||void 0===u?void 0:u.type)&&null!==u&&void 0!==u&&null!==(e=u.peer)&&void 0!==e&&e._id)&&h({type:"common",peer:{_id:null,name:"Common Group"}})},className:"mr-3 p-2 rounded-lg hover:bg-gray-100",children:(0,xa.jsx)(ct,{})}),(0,xa.jsx)("h3",{className:"text-xl font-bold text-gray-800 mobile-text-lg",children:"common"===P?"Common Chat":"private"===P?"Private Chats":"Notifications"})]}),"notifications"===P&&F.length>0&&(0,xa.jsx)("button",{onClick:()=>D([]),className:"text-sm text-blue-600 hover:text-blue-800",children:"Clear All"})]})}),(0,xa.jsx)("div",{className:"flex-grow overflow-hidden",children:(()=>{var e;switch(P){case"notifications":return(0,xa.jsx)(yie,{notifications:F,setNotification:R,onNotificationClick:G,setReadMessages:S});case"private":return u&&"private"===u.type&&null!==(e=u.peer)&&void 0!==e&&e._id?(0,xa.jsx)(bie,{currentUser:t,activeChat:u,messages:T(),newMessage:d,setNewMessage:f,onSendMessage:E,onDelete:I,loading:p,getNextMessageType:_,isAdmin:V}):(0,xa.jsx)(gie,{currentUser:t,fighters:i,activeChat:u,setActiveChat:h,adminId:r,unreadCounts:b,isAdmin:V});default:return"common"===(null===u||void 0===u?void 0:u.type)?(0,xa.jsx)(mie,{currentUser:t,messages:T(),newMessage:d,setNewMessage:f,onSendMessage:E,onDelete:I,loading:p,getNextMessageType:_,replyingTo:N,setReplyingTo:C,isAdmin:V,isMobile:j,isSidebarOpen:z,setIsSidebarOpen:U}):(0,xa.jsx)(gie,{currentUser:t,fighters:i,activeChat:u,setActiveChat:e=>{h(e),"common"===(null===e||void 0===e?void 0:e.type)&&M("common")},adminId:r,unreadCounts:b,isAdmin:V})}})()}),(0,xa.jsxs)("div",{className:"flex justify-around items-center bg-white border-t border-gray-200 p-2",children:[(0,xa.jsxs)("button",{onClick:()=>{M("common"),h({type:"common",peer:{_id:null,name:"Common Group"}})},className:"flex flex-col items-center p-2 rounded-lg ".concat("common"===P?"text-blue-600":"text-gray-500"),children:[(0,xa.jsx)(Ht,{size:20}),(0,xa.jsx)("span",{className:"text-xs mt-1",children:"Common"})]}),(0,xa.jsxs)("button",{onClick:()=>{var e;M("private"),"private"===(null===u||void 0===u?void 0:u.type)&&null!==u&&void 0!==u&&null!==(e=u.peer)&&void 0!==e&&e._id&&h({type:"common",peer:{_id:null,name:"Common Group"}})},className:"flex flex-col items-center p-2 rounded-lg ".concat("private"===P?"text-blue-600":"text-gray-500"),children:[(0,xa.jsx)(Ut,{size:20}),(0,xa.jsx)("span",{className:"text-xs mt-1",children:"Private"})]}),(0,xa.jsxs)("button",{onClick:()=>M("notifications"),className:"flex flex-col items-center p-2 rounded-lg ".concat("notifications"===P?"text-blue-600":"text-gray-500"),children:[(0,xa.jsxs)("div",{className:"relative",children:[(0,xa.jsx)(nt,{size:20}),F.length>0&&(0,xa.jsx)("span",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-4 w-4 flex items-center justify-center",children:F.length})]}),(0,xa.jsx)("span",{className:"text-xs mt-1",children:"Notifications"})]})]})]})},wie=()=>{const[e,t]=(0,c.useState)(!1),[n,r]=(0,c.useState)(null),[a,i]=(0,c.useState)(null),[o,s]=(0,c.useState)([]),[l,u]=(0,c.useState)([]),[h,d]=(0,c.useState)({type:"common",peer:{_id:null,name:"Common Group"}}),[f,p]=(0,c.useState)(""),[m,g]=(0,c.useState)(!0),[v,b]=(0,c.useState)(""),[y,x]=(0,c.useState)({}),[w,k]=(0,c.useState)({}),[S,N]=(0,c.useState)(new Set),[C,E]=(0,c.useState)(null),[I,T]=(0,c.useState)(null),[_,A]=(0,c.useState)([]),[R,F]=(0,c.useState)(!0),D=(0,c.useRef)(!1),O=((0,c.useRef)(null),(0,c.useRef)(null)),L=(0,c.useRef)(null);(0,c.useEffect)(()=>{const e=()=>{t(window.innerWidth<=768)};return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}},[]),(0,c.useEffect)(()=>{const e=localStorage.getItem("notificationsEnabled");if(null!==e)try{F(JSON.parse(e))}catch(_a){console.error("Failed to parse notification preference from localStorage",_a),F(!0)}},[]),(0,c.useEffect)(()=>{try{localStorage.setItem("notificationsEnabled",JSON.stringify(R))}catch(_a){console.error("Failed to save notification preference to localStorage",_a)}},[R]),(0,c.useEffect)(()=>((async()=>{if(!D.current){D.current=!0;try{g(!0);const{data:e}=await ya.get("/auth/user");r(e);Qae(e);if(Zae(e=>{console.log("[SOCKET] Received new message:",e),u(t=>{if(!t.some(t=>{var n,r;return t._id===e._id||t.isTemporary&&t.text===e.text&&(null===(n=t.user)||void 0===n?void 0:n._id)===(null===(r=e.user)||void 0===r?void 0:r._id)})){return[...t.filter(e=>!e.isTemporary||e._id!=="temp_"+Date.now()),e]}return t.map(t=>{var n,r;return t.isTemporary&&t.text===e.text&&(null===(n=t.user)||void 0===n?void 0:n._id)===(null===(r=e.user)||void 0===r?void 0:r._id)?Kt(Kt({},e),{},{isTemporary:!1}):t})})}),eie(e=>{console.log("[SOCKET] Received notification:",e),console.log("[SOCKET] New message notification received but notifications are disabled")}),"admin"===(null===e||void 0===e?void 0:e.role)){const{data:e}=await ya.get("/fighters/roster");s(e||[])}else{const{data:{adminId:e}}=await ya.get("/auth/admin-id");console.log("[CLIENT] *** CRITICAL: Fighter received admin ID:",e),console.log("[CLIENT] *** This MUST be:","68bc3872c7f20dc76f9da534","for chat to work"),console.log("[CLIENT] *** IDs match:","68bc3872c7f20dc76f9da534"===e),i(e)}const{data:t}=await ya.get("/doubts");u(t),g(!1)}catch(Cie){console.error("Failed to initialize data:",Cie),b("Failed to load data"),g(!1)}}})(),()=>{tie(),$ae&&($ae.removeAllListeners("new_message"),$ae.removeAllListeners("new_notification"),$ae.removeAllListeners("users_updated"))}),[]);const P=(0,c.useCallback)((e,t)=>{var n,r;console.log("[NOTIFICATION] Showing for:",t,null===(n=e.text)||void 0===n?void 0:n.substring(0,30)),R&&rie();const a={id:e._id,senderId:null===(r=e.user)||void 0===r?void 0:r._id,senderName:t,text:e.text,timestamp:new Date(e.timestamp),messageType:e.messageType};T(a),A(e=>e.some(e=>e.id===a.id)?e:[a,...e.slice(0,9)]),setTimeout(()=>{T(null)},4e3)},[R,T,A]);(0,c.useEffect)(()=>{if(n&&l.length)return L.current&&clearTimeout(L.current),L.current=setTimeout(()=>{var e,t;const r=l[l.length-1];if(!((null===r||void 0===r||null===(e=r.user)||void 0===e||null===(t=e._id)||void 0===t?void 0:t.toString())===n._id.toString())&&r){var a;const e=(null===(a=r.user)||void 0===a?void 0:a.name)||"Unknown User";let t=!1;var i,o,s,c;if("private"===(null===h||void 0===h?void 0:h.type)&&r.recipientId)t=(null===h||void 0===h||null===(i=h.peer)||void 0===i||null===(o=i._id)||void 0===o?void 0:o.toString())===(null===(s=r.user)||void 0===s||null===(c=s._id)||void 0===c?void 0:c.toString());else"common"!==(null===h||void 0===h?void 0:h.type)||r.recipientId||(t=!0);const n=r.isRead||S.has(r._id);if(!t&&!n){_.some(e=>e.id===r._id)||P(r,e)}}},300),()=>{L.current&&clearTimeout(L.current)}},[l,n,h,_,S,P]);const M=(0,c.useCallback)(()=>{if(!n||!l.length)return{};const e={},t=n._id;if("admin"===n.role){o.forEach(n=>{const r=l.filter(e=>{var r,a,i;return(null===(r=e.user)||void 0===r||null===(a=r._id)||void 0===a?void 0:a.toString())===n._id.toString()&&(null===(i=e.recipientId)||void 0===i?void 0:i.toString())===t.toString()&&!e.isRead&&!S.has(e._id)}).length;r>0&&(e[n._id]=r)});const n=l.filter(e=>{var n,r;return!e.recipientId&&(null===(n=e.user)||void 0===n||null===(r=n._id)||void 0===r?void 0:r.toString())!==t.toString()&&!e.isRead&&!S.has(e._id)}).length;n>0&&(e.common=n)}else if(a){const n=l.filter(e=>{var n,r,i;return(null===(n=e.user)||void 0===n||null===(r=n._id)||void 0===r?void 0:r.toString())===a.toString()&&(null===(i=e.recipientId)||void 0===i?void 0:i.toString())===t.toString()&&!e.isRead&&!S.has(e._id)}).length;n>0&&(e[a]=n);const r=l.filter(e=>{var n,r;return!e.recipientId&&(null===(n=e.user)||void 0===n||null===(r=n._id)||void 0===r?void 0:r.toString())!==t.toString()&&!e.isRead&&!S.has(e._id)}).length;r>0&&(e.common=r)}return e},[n,l,o,a,S]),j=(0,c.useCallback)(()=>{if(!n||!l.length)return[];n._id;if("common"===(null===h||void 0===h?void 0:h.type)){const e=l.filter(e=>!e.recipient&&!e.recipientId&&e.isVisible).sort((e,t)=>new Date(e.timestamp)-new Date(t.timestamp));return e}if("private"===(null===h||void 0===h?void 0:h.type)){var e;const t=null===h||void 0===h||null===(e=h.peer)||void 0===e?void 0:e._id;if(!t)return[];const r=l.filter(e=>{var r,a,i,o,s;if(!e.isVisible)return!1;if(!e.recipient&&!e.recipientId)return!1;const c=null===(r=e.user)||void 0===r||null===(a=r._id)||void 0===a?void 0:a.toString(),l=(null===(i=e.recipient)||void 0===i||null===(o=i._id)||void 0===o?void 0:o.toString())||(null===(s=e.recipientId)||void 0===s?void 0:s.toString()),u=n._id.toString(),h=t.toString();return c===u&&l===h||c===h&&l===u}).sort((e,t)=>new Date(e.timestamp)-new Date(t.timestamp));return r}return[]},[l,h,n]),B=(0,c.useCallback)(()=>"common"===(null===h||void 0===h?void 0:h.type)?"doubt":"admin"===(null===n||void 0===n?void 0:n.role)?"clarity":"doubt",[h,n]),z=(0,c.useCallback)(async e=>{if(!n||!e.text.trim())return;const t={_id:"temp_"+Date.now(),text:e.text,messageType:e.messageType||"doubt",user:{_id:n._id,name:n.name},userModel:"admin"===n.role?"Admin":"Fighter",timestamp:new Date,isTemporary:!0};u(e=>[...e,t]);try{var r;const a={text:e.text,messageType:e.messageType||"doubt"};e.parentDoubt&&(a.parentDoubt=e.parentDoubt),"private"===(null===h||void 0===h?void 0:h.type)&&null!==h&&void 0!==h&&null!==(r=h.peer)&&void 0!==r&&r._id?(a.recipientId=h.peer._id,"admin"===n.role?console.log("[CLIENT] Admin sending CLARITY (answer) to fighter:",h.peer.name):console.log("[CLIENT] Fighter sending DOUBT (question) to admin")):console.log("[CLIENT] Sending common message"),console.log("[CLIENT] Message payload:",a);const{data:i}=await ya.post("/doubts",a);console.log("[CLIENT] Message saved:",i),u(e=>e.map(e=>e._id===t._id?Kt(Kt({},i),{},{isTemporary:!1}):e))}catch(Cie){console.error("Failed to send message:",Cie),b("Failed to send message"),u(e=>e.filter(e=>e._id!==t._id))}},[n,h]),U=(0,c.useCallback)(async e=>{if(e&&window.confirm("Are you sure you want to delete this message?"))try{await ya.delete("/doubts/".concat(e)),u(t=>t.filter(t=>t._id!==e))}catch(Cie){console.error("Failed to delete message:",Cie),b("Failed to delete message")}},[]);(0,c.useEffect)(()=>(O.current&&clearTimeout(O.current),O.current=setTimeout(()=>{const e=M();x(e);const t=Object.values(e).reduce((e,t)=>e+t,0);document.title=t>0?"(".concat(t,") Chat App"):"Chat App"},300),()=>{O.current&&clearTimeout(O.current)}),[l,n,o,a,w,S,M]);const W={currentUser:n,setCurrentUser:r,adminId:a,setAdminId:i,fighters:o,setFighters:s,messages:l,setMessages:u,activeChat:h,setActiveChat:d,newMessage:f,setNewMessage:p,loading:m,setLoading:g,error:v,setError:b,unreadCounts:y,setUnreadCounts:x,lastSeenMessages:w,setLastSeenMessages:k,readMessages:S,setReadMessages:N,replyingTo:C,setReplyingTo:E,handleSendMessage:z,handleDeleteMessage:U,getFilteredMessages:j,getNextMessageType:B,notification:I,setNotification:T,notifications:_,setNotifications:A,notificationsEnabled:R,setNotificationsEnabled:F};return e?(0,xa.jsx)(xie,Kt({},W)):(0,xa.jsx)(die,Kt({},W))},kie=e=>{let{handleLogout:t,closeSidebar:n}=e;const[r,a]=(0,c.useState)(!1),i="flex items-center w-full px-4 py-3 text-gray-300 hover:bg-gray-700 hover:text-white rounded-lg transition-colors duration-200",o="bg-red-600 text-white",s="flex items-center w-full pl-11 pr-4 py-2 text-sm text-gray-400 hover:bg-gray-700 hover:text-white rounded-lg transition-colors duration-200",l="bg-red-600/50 text-white",u=()=>{n()};return(0,xa.jsxs)("div",{className:"flex flex-col h-full",children:[(0,xa.jsxs)("div",{className:"p-4 mb-4 text-center",children:[(0,xa.jsx)("img",{src:"/logo.png",alt:"Logo",className:"w-24 h-24 mx-auto mb-2 rounded-full object-cover border-2 border-gray-600"}),(0,xa.jsx)("h1",{className:"text-xl font-bold text-white tracking-wider",children:"ADMIN"})]}),(0,xa.jsxs)("nav",{className:"flex-grow px-4 space-y-2",children:[(0,xa.jsxs)(je,{to:"/admin/dashboard",className:e=>{let{isActive:t}=e;return t?"".concat(i," ").concat(o):i},onClick:u,children:[(0,xa.jsx)(Ot,{className:"mr-3"})," Dashboard"]}),(0,xa.jsxs)("div",{children:[(0,xa.jsxs)("button",{onClick:()=>a(!r),className:"".concat(i," justify-between"),children:[(0,xa.jsxs)("div",{className:"flex items-center",children:[(0,xa.jsx)(Ht,{className:"mr-3"})," Manage Fighters"]}),r?(0,xa.jsx)(et,{}):(0,xa.jsx)(Ze,{})]}),r&&(0,xa.jsxs)("div",{className:"mt-2 space-y-2",children:[(0,xa.jsxs)(je,{to:"/admin/add-fighter",className:e=>{let{isActive:t}=e;return"".concat(s," ").concat(t?l:"")},onClick:u,children:[(0,xa.jsx)(zt,{className:"mr-3"})," Add Fighter"]}),(0,xa.jsxs)(je,{to:"/admin",end:!0,className:e=>{let{isActive:t}=e;return"".concat(s," ").concat(t?l:"")},onClick:u,children:[(0,xa.jsx)(Ct,{className:"mr-3"})," View Fighters"]})]})]}),(0,xa.jsxs)(je,{to:"/admin/fighter-level",className:e=>{let{isActive:t}=e;return"".concat(i," ").concat(t?o:"")},onClick:u,children:[(0,xa.jsx)(ot,{className:"mr-3"})," Fighter Level"]}),(0,xa.jsxs)(je,{to:"/admin/attendance",className:e=>{let{isActive:t}=e;return"".concat(i," ").concat(t?o:"")},onClick:u,children:[(0,xa.jsx)(at,{className:"mr-3"})," Attendance"]}),(0,xa.jsxs)(je,{to:"/admin/ask-doubt",className:e=>{let{isActive:t}=e;return"".concat(i," ").concat(t?o:"")},onClick:u,children:[(0,xa.jsx)(pt,{className:"mr-3"})," Ask Doubt"]}),(0,xa.jsxs)(je,{to:"/admin/settings",className:e=>{let{isActive:t}=e;return"".concat(i," ").concat(t?o:"")},onClick:u,children:[(0,xa.jsx)(ut,{className:"mr-3"})," Settings"]})]}),(0,xa.jsx)("div",{className:"p-4",children:(0,xa.jsxs)("button",{onClick:()=>{t(),u()},className:i,children:[(0,xa.jsx)(Rt,{className:"mr-3"})," Logout"]})})]})},Sie=e=>{let{handleLogout:t,closeSidebar:n}=e;const r="flex items-center px-4 py-3 text-gray-300 hover:bg-gray-700 hover:text-white rounded-lg transition-colors duration-200",a="bg-blue-600 text-white";return(0,xa.jsxs)("div",{className:"flex flex-col h-full",children:[(0,xa.jsxs)("div",{className:"p-4 mb-4 text-center",children:[(0,xa.jsx)("img",{src:"/logo.png",alt:"Logo",className:"w-24 h-24 mx-auto mb-2 rounded-full object-cover border-2 border-gray-600"}),(0,xa.jsx)("h1",{className:"text-xl font-bold text-white tracking-wider",children:"FIGHTER"})]}),(0,xa.jsxs)("nav",{className:"flex-grow px-4 space-y-2",children:[(0,xa.jsxs)(je,{to:"/fighter",end:!0,className:e=>{let{isActive:t}=e;return"".concat(r," ").concat(t?a:"")},onClick:n,children:[(0,xa.jsx)(kt,{className:"mr-3"})," Home"]}),(0,xa.jsxs)(je,{to:"/fighter/attendance",className:e=>{let{isActive:t}=e;return"".concat(r," ").concat(t?a:"")},onClick:n,children:[(0,xa.jsx)(at,{className:"mr-3"})," My Attendance"]}),(0,xa.jsxs)(je,{to:"/fighter/level",className:e=>{let{isActive:t}=e;return"".concat(r," ").concat(t?a:"")},onClick:n,children:[(0,xa.jsx)(ot,{className:"mr-3"})," Fighter Level"]}),(0,xa.jsxs)(je,{to:"/fighter/ask-doubt",className:e=>{let{isActive:t}=e;return"".concat(r," ").concat(t?a:"")},onClick:n,children:[(0,xa.jsx)(pt,{className:"mr-3"})," Ask Doubt"]})]}),(0,xa.jsx)("div",{className:"p-4",children:(0,xa.jsxs)("button",{onClick:()=>{t(),n()},className:"w-full flex items-center justify-center px-4 py-3 text-gray-300 bg-gray-700 hover:bg-red-700 hover:text-white rounded-lg transition-colors duration-200",children:[(0,xa.jsx)(Rt,{className:"mr-3"})," Logout"]})})]})},Nie=()=>{const[e,t]=(0,c.useState)(null),[n,r]=(0,c.useState)(!0);(0,c.useEffect)(()=>{(async()=>{if(localStorage.getItem("token"))try{const{data:e}=await ya.get("/auth/user");t(e)}catch(e){console.error("Session expired or token is invalid."),t(null)}r(!1)})()},[]);const a=()=>{localStorage.removeItem("token"),t(null),window.location.href="/"},i=t=>{let{children:n,role:r}=t;const a=re();return e?r&&e.role!==r?(0,xa.jsx)(we,{to:"/",replace:!0}):"fighter"!==e.role||e.profile_completed||"/fighter/complete-profile"===a.pathname?"fighter"===e.role&&e.profile_completed&&"/fighter/complete-profile"===a.pathname?(0,xa.jsx)(we,{to:"/fighter",replace:!0}):n:(0,xa.jsx)(we,{to:"/fighter/complete-profile",replace:!0}):(0,xa.jsx)(we,{to:"/",replace:!0})},o=e=>{let{children:t}=e;const[n,r]=(0,c.useState)(!1),i=()=>r(!1);return(0,xa.jsxs)("div",{className:"relative min-h-screen bg-gray-100",children:[n&&(0,xa.jsx)("div",{className:"fixed inset-0 z-20 bg-black opacity-50 lg:hidden",onClick:i}),(0,xa.jsxs)("div",{className:"lg:hidden flex justify-between items-center bg-gray-800 text-white p-4 sticky top-0 z-10",children:[(0,xa.jsx)("h1",{className:"text-xl font-bold",children:"Admin Panel"}),(0,xa.jsx)("button",{onClick:()=>r(!n),children:n?(0,xa.jsx)(Lt,{size:24}):(0,xa.jsx)(tt,{size:24})})]}),(0,xa.jsx)("aside",{className:"fixed inset-y-0 left-0 z-30 w-64 bg-gray-800 text-white transform ".concat(n?"translate-x-0":"-translate-x-full"," transition-transform duration-300 ease-in-out lg:translate-x-0"),children:(0,xa.jsx)(kie,{handleLogout:a,closeSidebar:i})}),(0,xa.jsx)("main",{className:"lg:ml-64 p-4 sm:p-6 lg:p-8 min-h-screen",children:t})]})},s=e=>{let{children:t}=e;const[n,r]=(0,c.useState)(!1),i=()=>r(!1);return(0,xa.jsxs)("div",{className:"relative min-h-screen bg-gray-100",children:[n&&(0,xa.jsx)("div",{className:"fixed inset-0 z-20 bg-black opacity-50 lg:hidden",onClick:i}),(0,xa.jsxs)("div",{className:"lg:hidden flex justify-between items-center bg-gray-800 text-white p-4 sticky top-0 z-10",children:[(0,xa.jsx)("h1",{className:"text-xl font-bold",children:"Fighter Portal"}),(0,xa.jsx)("button",{onClick:()=>r(!n),children:n?(0,xa.jsx)(Lt,{size:24}):(0,xa.jsx)(tt,{size:24})})]}),(0,xa.jsx)("aside",{className:"fixed inset-y-0 left-0 z-30 w-64 bg-gray-800 text-white transform ".concat(n?"translate-x-0":"-translate-x-full"," transition-transform duration-300 ease-in-out lg:translate-x-0"),children:(0,xa.jsx)(Sie,{handleLogout:a,closeSidebar:i})}),(0,xa.jsx)("main",{className:"lg:ml-64 p-4 sm:p-6 lg:p-8 min-h-screen",children:t})]})};return n?(0,xa.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-900 text-white",children:(0,xa.jsx)("h1",{className:"text-2xl",children:"Loading Gym..."})}):(0,xa.jsx)(Oe,{children:(0,xa.jsxs)(Ne,{children:[(0,xa.jsx)(ke,{path:"/",element:(0,xa.jsx)(ka,{setUser:t,user:e})}),(0,xa.jsx)(ke,{path:"/fighter/level",element:(0,xa.jsx)(i,{role:"fighter",children:(0,xa.jsx)(s,{children:(0,xa.jsx)(Nre,{})})})}),(0,xa.jsx)(ke,{path:"/admin/dashboard",element:(0,xa.jsx)(i,{role:"admin",children:(0,xa.jsx)(o,{children:(0,xa.jsx)(Ca,{})})})}),(0,xa.jsx)(ke,{path:"/admin",element:(0,xa.jsx)(i,{role:"admin",children:(0,xa.jsx)(o,{children:(0,xa.jsx)(Na,{})})})}),(0,xa.jsx)(ke,{path:"/admin/add-fighter",element:(0,xa.jsx)(i,{role:"admin",children:(0,xa.jsx)(o,{children:(0,xa.jsx)(tw,{})})})}),(0,xa.jsx)(ke,{path:"/admin/edit-fighter/:id",element:(0,xa.jsx)(i,{role:"admin",children:(0,xa.jsx)(o,{children:(0,xa.jsx)(rw,{})})})}),(0,xa.jsx)(ke,{path:"/admin/fighter/:id",element:(0,xa.jsx)(i,{role:"admin",children:(0,xa.jsx)(o,{children:(0,xa.jsx)(ow,{})})})}),(0,xa.jsx)(ke,{path:"/admin/attendance",element:(0,xa.jsx)(i,{role:"admin",children:(0,xa.jsx)(o,{children:(0,xa.jsx)(gre,{})})})}),(0,xa.jsx)(ke,{path:"/admin/settings",element:(0,xa.jsx)(i,{role:"admin",children:(0,xa.jsx)(o,{children:(0,xa.jsx)(sw,{})})})}),(0,xa.jsx)(ke,{path:"/fighter/attendance/face",element:(0,xa.jsx)(i,{role:"fighter",children:(0,xa.jsx)(s,{children:(0,xa.jsx)(Ere,{})})})}),(0,xa.jsx)(ke,{path:"/admin/ask-doubt",element:(0,xa.jsx)(i,{role:"admin",children:(0,xa.jsx)(o,{children:(0,xa.jsx)(wie,{})})})}),(0,xa.jsx)(ke,{path:"/admin/fighter-level",element:(0,xa.jsx)(i,{role:"admin",children:(0,xa.jsx)(o,{children:(0,xa.jsx)(Sre,{})})})}),(0,xa.jsx)(ke,{path:"/fighter/ask-doubt",element:(0,xa.jsx)(i,{role:"fighter",children:(0,xa.jsx)(s,{children:(0,xa.jsx)(wie,{})})})}),(0,xa.jsx)(ke,{path:"/fighter/complete-profile",element:(0,xa.jsx)(i,{role:"fighter",children:(0,xa.jsx)(kre,{})})}),(0,xa.jsx)(ke,{path:"/fighter",element:(0,xa.jsx)(i,{role:"fighter",children:(0,xa.jsx)(s,{children:(0,xa.jsx)(bre,{user:e})})})}),(0,xa.jsx)(ke,{path:"/fighter/attendance",element:(0,xa.jsx)(i,{role:"fighter",children:(0,xa.jsx)(s,{children:(0,xa.jsx)(wre,{user:e})})})})]})})};u.createRoot(document.getElementById("root")).render((0,xa.jsx)(c.StrictMode,{children:(0,xa.jsx)(Nie,{})}))})()})();